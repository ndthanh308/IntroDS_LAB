\section{ADDITIONAL ALGORITHMS IN IMPLEMENTATION}

\subsection{A \textsf{Peace}-based Robust Algorithm}
\label{sec:modified_algo}

In this section, we briefly explain how we design \textsf{P1-Peace} based on intuition similar to \textsf{P1-RAGE} and make it computationally efficient. First, we propose another subroutine, called \textsf{Peace-Elimination}, based on the elimination strategy in \textsf{Peace} \citet{katz2020empirical}, which has the same spirit as \textsf{RAGE}. Similar to \textsf{RAGE-Elimination}, \textsf{Peace-Elimination} also repeatedly computes $\mc{XY}$-allocation, but (virtually) eliminate arms so that the value of the remaining arms' optimal $\mc{XY}$-design is halved. In addition, in \textsf{P1-Peace}, we only update the sampling distribution $\lambda_t$ after a period of time. The intuition is that if the environment is stationary, then we do not need to update our allocation probability frequently just like \textsf{RAGE} and \textsf{Peace}; if the environment is non-stationary, then the non-stationarity is handled by the mixed G-optimal design $\lambda^*$, which is fixed from the very beginning. Therefore, updating $\lambda_t$ in a low frequency should not severely harm the performance. The new algorithm and elimination subroutine are summarized in Algorithm \ref{algo:p1_peace} and \ref{algo:peace_elimination}.

For convenience of presentation, for arm set $\mc{Z}\subset\R^d$ and distribution $\lambda\in\triangle_{\X}$, we define
\begin{equation}
    \label{equ:rho_z}
    \rho(\mc{Z}, \lambda)=\max_{x, x'\in\mc{Z}}\Norm{x-x'}^2_{A(\lambda)^{-1}}.
\end{equation}

% \begin{algorithm}[ht]
%     \caption{P1-Peace}
%     \label{algo:p1_peace}
%     \SetAlgoLined
%     \KwIn{budget, $T\in\mathbb{N}$; arm set $\mc{X}\subset\R^d$}
%     Compute epoch length $R\leftarrow\floor{\frac{T}{\log_2(\inf_{\lambda\in\triangle_{\X}}\rho(\X, \lambda))}}$\\
%     Compute G-optimal design $\lambda^*$ based on equation \eqref{equ:g_design} and initialize $\lambda_1=\lambda^*$\\
%     \For{$t=1, 2, \dots, T$}{
%         Sample $x_t\sim\lambda_t$ and receive reward $r_t$\\
%         Estimate $\widehat{\theta}_t\leftarrow\frac{1}{t}\sum_{s=1}^t\E_{x\sim\lambda_s}\Mp{xx^\top}^{-1}x_s r_s$\\
%         $\lambda_{t+1}\leftarrow\lambda_t$\\
%         \If{$t-1=cR$ for some integer $c$}{
%             Update $\lambda_{t+1}\leftarrow$\textsf{Peace-Elimination}$(\htheta_t)$\\
%         }
%     }
%     \textbf{return} $\argmax_{x\in\X}x^\top\widehat{\theta}_T$\\
%     \SetKwFunction{proc}{\textsf{Peace-Elimination}}
%     \SetKwProg{myproc}{Subroutine}{}{}
%     \myproc{\proc{$\htheta_t$}}{\label{algo:peace_elimination}
%         Find index $\widehat{(k)}_t$ such that $x_{\widehat{(1)}_t}^\top\htheta_t\geq x_{\widehat{(2)}_t}^\top\htheta_t\geq\dots\geq x_{\widehat{(K)}_t}^\top\htheta_t$\\
%         Initialize $\X_t^{(0)}\leftarrow\X$ and $i\leftarrow 0$\\
%         \While{$|\X_{t}^{(i)}|> 1$}{
%             Compute $\lambda^{(i)}_t\leftarrow\arginf_{\lambda\in\triangle_{\X}}\rho(\X_t^{(i)}, \lambda)$\\
%             Find the largest index $k_i$ such that
%             $$\inf_{\lambda\in\triangle_{\X}}\rho\Sp{\{x_{\widehat{(1)}_t}, \dots, x_{\widehat{(k_i)}_t}\}}\leq \frac{1}{2}\cdot\inf_{\lambda\in\triangle_{\X}}\rho(\X_t^{(i)}, \lambda)$$\\
%             Update $\X_{t}^{(i+1)}\leftarrow\Bp{x_{\widehat{(1)}_t}, \dots, x_{\widehat{(k_i)}_t}}$\\
%             % Eliminate and obtain $\mc{X}_{i+1}^{(t)} \leftarrow \Bp{ x \in \mc{X}_i^{(t)}\mid  \htheta_t^\top(\hat{x}^*_t-x) \leq 2^{-i} }$\\
%             $i\leftarrow i+1$\\
%         }
%         % Compute $\bar{\lambda}_t\leftarrow \frac{1}{i}\sum_{i'=0}^{i-1}\lambda_t^{(i')}$\\
%         \textbf{return} $(\bar{\lambda}_t+\lambda^*)/2$, where $\bar{\lambda}_t= \frac{1}{i}\sum_{i'=0}^{i-1}\lambda_t^{(i')}$
%     }
% \end{algorithm}

\begin{algorithm}[ht]
    \caption{P1-Peace}
    \label{algo:p1_peace}
    \begin{algorithmic}[1]
        \STATE \textbf{Input:} budget, $T\in\mathbb{N}$; arm set $\mc{X}\subset\R^d$
        \STATE Compute epoch length $R\leftarrow\floor{\frac{T}{\log_2(\inf_{\lambda\in\triangle_{\X}}\rho(\X, \lambda))}}$
        \STATE Compute G-optimal design $\lambda^*$ based on equation \eqref{equ:g_design} and initialize $\lambda_1=\lambda^*$
        \FOR{$t=1, 2, \dots, T$}
            \STATE Sample $x_t\sim\lambda_t$ and receive reward $r_t$
            \STATE Estimate $\widehat{\theta}_t\leftarrow\frac{1}{t}\sum_{s=1}^t\E_{x\sim\lambda_s}\Mp{xx^\top}^{-1}x_s r_s$
            \STATE $\lambda_{t+1}\leftarrow\lambda_t$
            \IF{$t-1=cR$ for some integer $c$}
                \STATE Update $\lambda_{t+1}\leftarrow$\textsf{Peace-Elimination}$(\htheta_t)$
            \ENDIF
        \ENDFOR
        \RETURN $\argmax_{x\in\X}x^\top\widehat{\theta}_T$
    \end{algorithmic}
\end{algorithm}

\begin{algorithm}
    \caption{Peace-Elimination}
    \label{algo:peace_elimination}
    \begin{algorithmic}[1]
        \STATE \textbf{Input:} arm set $\mc{X}\subset\R^d$; current estimate $\htheta_t$
        \STATE Find index $\widehat{(k)}_t$ such that $x_{\widehat{(1)}_t}^\top\htheta_t\geq x_{\widehat{(2)}_t}^\top\htheta_t\geq\dots\geq x_{\widehat{(K)}_t}^\top\htheta_t$
        \STATE Initialize $\X_t^{(0)}\leftarrow\X$ and $i\leftarrow 0$
        \WHILE{$|\X_{t}^{(i)}|> 1$}
            \STATE Compute $\lambda^{(i)}_t\leftarrow\arginf_{\lambda\in\triangle_{\X}}\rho(\X_t^{(i)}, \lambda)$
            \STATE Find the largest index $k_i$ such that
            $$\inf_{\lambda\in\triangle_{\X}}\rho\Sp{\{x_{\widehat{(1)}_t}, \dots, x_{\widehat{(k_i)}_t}\}}\leq \frac{1}{2}\cdot\inf_{\lambda\in\triangle_{\X}}\rho(\X_t^{(i)}, \lambda)$$
            \STATE Update $\X_{t}^{(i+1)}\leftarrow\Bp{x_{\widehat{(1)}_t}, \dots, x_{\widehat{(k_i)}_t}}$
            \STATE $i\leftarrow i+1$
        \ENDWHILE
        \RETURN $(\bar{\lambda}_t+\lambda^*)/2$, where $\bar{\lambda}_t= \frac{1}{i}\sum_{i'=0}^{i-1}\lambda_t^{(i')}$
    \end{algorithmic}
\end{algorithm}

\subsection{A Naive Baseline Mixed Algorithm}
\label{sec:naive_algo}
In this section, we present a naive mixture of \textsf{Peace} and the G-optimal design, called \textsf{Mixed-Peace}, which eliminates arms and computes design $\lambda_k$ during each epoch exactly the same as \textsf{Peace}. The only differences are that \textsf{Mixed-Peace} uses IPS estimator and when pulling an arm, it will pull an arm by following $x_t\sim(\lambda_k+\lambda^*)/2$, where $\lambda^*$ is the G-optimal design defined in equation \eqref{equ:g_design}. Its details are summarized in Algorithm \ref{algo:mixed_peace}.

% \begin{algorithm}[ht]
%     \caption{Mixed-Peace}
%     \label{algo:mixed_peace}
%     \SetAlgoLined
%     \KwIn{budget, $T\in\mathbb{N}$; arm set $\mc{X}\subset\R^d$}
%     Initialize $R\leftarrow\ceil{\log_2\Sp{\inf_{\lambda\in\triangle_{\X}}\rho(\X, \lambda)}}$, $N\leftarrow\floor{\frac{T}{R}}$, $\mc{X}_0\leftarrow\X$, $\htheta_0\leftarrow\ve{0}$ and $t\leftarrow 1$\\
%     Compute G-optimal design $\lambda^*$ using equation \eqref{equ:g_design}\\
%     \For{$r=0, \dots, R$}{
%         Find $\lambda_r\leftarrow(\arginf_{\lambda\in\triangle_{\X}}\rho(\X_r, \lambda)+\lambda^*)/2$\\
%         \While{$t\leq\min\Bp{T, (r+1)N}$}{
%             Sample $x_t\sim \lambda_r$ and receive reward $r_t$\\
%             Estimate $\widehat{\theta}_t\leftarrow \frac{t-1}{t}\cdot \htheta_{t-1}+\frac{1}{t}\cdot\E_{x\sim\lambda_r}\Mp{xx^\top}^{-1}x_t r_t$\\
%             $t\leftarrow t+1$\\
%         }
%         \If{$\abs{\X_r}>1$}{
%             Reindex $\X_r$ such that $x_1^\top\htheta_t\geq x_2^\top\htheta_t\geq\dots\geq x_{n_r}^\top\htheta_t$, where $n_r=\abs{\X_r}$\\
%             Find the largest index $k_r$ such that 
%             $$\inf_{\lambda\in\triangle_{\X}}\rho(\Bp{x_1, \dots, x_{k_r}}, \lambda)\leq \frac{1}{2}\cdot\inf_{\lambda\in\triangle_{\X}}\rho(\X_r, \lambda)$$\\
%             Update $\X_{r+1}\leftarrow\Bp{x_1, \dots, x_{k_r}}$
%         }
%     }
%     \textbf{return} $\argmax_{x\in\X}x^\top\htheta_T$
% \end{algorithm}

\begin{algorithm}
    \caption{Mixed-Peace}
    \label{algo:mixed_peace}
    \begin{algorithmic}[1]
        \STATE \textbf{Input:} budget, $T\in\mathbb{N}$; arm set $\mc{X}\subset\R^d$
        \STATE Initialize $R\leftarrow\ceil{\log_2\Sp{\inf_{\lambda\in\triangle_{\X}}\rho(\X, \lambda)}}$, $N\leftarrow\floor{\frac{T}{R}}$, $\mc{X}_0\leftarrow\X$, $\htheta_0\leftarrow\ve{0}$ and $t\leftarrow 1$
        \STATE Compute G-optimal design $\lambda^*$ using equation \eqref{equ:g_design}
        \FOR{$r=0, \dots, R$}
            \STATE Find $\lambda_r\leftarrow(\arginf_{\lambda\in\triangle_{\X}}\rho(\X_r, \lambda)+\lambda^*)/2$
            \WHILE{$t\leq\min\Bp{T, (r+1)N}$}
                \STATE Sample $x_t\sim \lambda_r$ and receive reward $r_t$
                \STATE Estimate $\widehat{\theta}_t\leftarrow \frac{t-1}{t}\cdot \htheta_{t-1}+\frac{1}{t}\cdot\E_{x\sim\lambda_r}\Mp{xx^\top}^{-1}x_t r_t$
                \STATE $t\leftarrow t+1$
            \ENDWHILE
            \IF{$\abs{\X_r}>1$}
                \STATE Reindex $\X_r$ such that $x_1^\top\htheta_t\geq x_2^\top\htheta_t\geq\dots\geq x_{n_r}^\top\htheta_t$, where $n_r=\abs{\X_r}$
                \STATE Find the largest index $k_r$ such that 
                $$\inf_{\lambda\in\triangle_{\X}}\rho(\Bp{x_1, \dots, x_{k_r}}, \lambda)\leq \frac{1}{2}\cdot\inf_{\lambda\in\triangle_{\X}}\rho(\X_r, \lambda)$$
                \STATE Update $\X_{r+1}\leftarrow\Bp{x_1, \dots, x_{k_r}}$
            \ENDIF
        \ENDFOR
        \textbf{return} $\argmax_{x\in\X}x^\top\htheta_T$
    \end{algorithmic}
\end{algorithm}