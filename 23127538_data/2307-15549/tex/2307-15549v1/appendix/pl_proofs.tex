%!TEX root = ../main.tex

\section{Proofs of Section~\ref{Section:CAReasoning}}
\label{sec:pl-proofs}

\begin{proof}[Proof of Lemma~\ref{Lemma:Mediation}]
The base case holds by assumption.
Assume $\casem{\astmt}{\bullet}$, $\casem{\astmt_1}{\bullet}$, $\casem{\astmt_2}{\bullet}$ satisfy \eqref{Equation:Mediation}.  
 \\[0.2cm]
{\bfseries Case $\choiceof{\astmt_1}{\astmt_2}$.}\quad
Let $\apred, \apredpp, \apredppp\in\setpreds$:
\begin{align*}
&\ \casemof{\choiceof{\astmt_1}{\astmt_2}}{\apredpp}{\apred\mstar\apredppp}\\
\explain{Definition}\ =&\ \casemof{\astmt_1}{\apredpp}{\apred\mstar\apredppp}\predjoin\casemof{\astmt_2}{\apredpp}{\apred\mstar\apredppp}\\
\explain{IH}\ \predleq&\ (\casemof{\astmt_1}{\apredpp\mstar\apredppp}{\apred}\mstar\apredppp)\predjoin (\casemof{\astmt_2}{\apredpp\mstar\apredppp}{\apred}\mstar\apredppp)\\
\explain{Distributivity}\ =&\ (\casemof{\astmt_1}{\apredpp\mstar\apredppp}{\apred}\predjoin \casemof{\astmt_2}{\apredpp\mstar\apredppp}{\apred})\mstar\apredppp\\
\explain{Definition}\ =&\ \casemof{\choiceof{\astmt_1}{\astmt_2}}{\apredpp\mstar\apredppp}{\apred}\mstar\apredppp. 
\end{align*}
% --------------------------------------------------------------------------------------
% --------------------------------------------------------------------------------------
% --------------------------------------------------------------------------------------
% --------------------------------------------------------------------------------------
{\bfseries Case $\seqof{\astmt_1}{\astmt_2}$.}\quad Let $\apred, \apredpp, \apredppp\in\setpreds$:
\begin{align*}
&\ \casemof{\seqof{\astmt_1}{\astmt_2}}{\apredpp}{\apred\mstar\apredppp}\\
\explain{Definition}=&\ \casemof{\astmt_2}{\apredpp}{\casemof{\astmt_1}{\apredpp}{\apred\mstar\apredppp}}\\
\explain{IH for $\astmt_1$ + monotonicity of $\casem{\astmt_2}{\apredpp}$}\predleq&\ \casemof{\astmt_2}{\apredpp}{\casemof{\astmt_1}{\apredpp\mstar\apredppp}{\apred}\mstar\apredppp}\\
\explain{IH for $\astmt_2$}\predleq&\ \casemof{\astmt_2}{\apredpp\mstar\apredppp}{\casemof{\astmt_1}{\apredpp\mstar\apredppp}{\apred}}\mstar\apredppp\\
\explain{Definition}\predleq&\  \casemof{\seqof{\astmt_1}{\astmt_2}}{\apredpp\mstar\apredppp}{\apred}\mstar\apredppp.
\end{align*}
{\bfseries Case $\loopof{\astmt}$.}\quad We first show that $\casem{\astmt^i}{\bullet}$ satisfies \eqref{Equation:Mediation} for all $i$. 
In the base case, we have $\casemof{\astmt^0}{\apredpp}{\apred\mstar\apredppp}=\apred\mstar\apredppp=\casemof{\astmt^0}{\apredpp\mstar\apredppp}{\apred}\mstar\apredppp$ for all $\apred, \apredpp, \apredppp\in\setpreds$, because $\astmt^0$ is always interpreted as the identity. 
Assume $\casem{\astmt^i}{\bullet}$ satisfies \eqref{Equation:Mediation}. 
Then $\casem{\astmt^{i+1}}{\bullet} = \casem{\seqof{\astmt}{\astmt^{i}}}{\bullet}$ and the reasoning proceeds like in the previous case. 

Let $\apred, \apredpp, \apredppp\in\setpreds$. 
Then 
\begin{align*}
&\ \casemof{\loopof{\astmt}}{\apredpp}{\apred\mstar\apredppp}\\
\explain{Definition}=&\ (\bigpredtransjoin\casem{\astmt^i}{\apredpp})(\apred\mstar\apredppp)\\
\explain{Predicate transformers ordered pointwise}=&\ \bigpredjoin_{i\in\nat}\casemof{\astmt^i}{\apredpp}{\apred\mstar\apredppp}\\
\explain{\eqref{Equation:Mediation} for all $\casem{\astmt^i}{\bullet}$} \predleq&\ \bigpredjoin_{i\in\nat}(\casemof{\astmt^i}{\apredpp\mstar\apredppp}{\apred}\mstar\apredppp)\\
\explain{Distributivity} =&\ (\bigpredjoin_{i\in\nat}\casemof{\astmt^i}{\apredpp\mstar\apredppp}{\apred})\mstar\apredppp\\
\explain{As before}=&\ \casemof{\loopof{\astmt}}{\apredpp\mstar\apredppp}{\apred}\mstar\apredppp. \qedhere
\end{align*}
\end{proof}
% -----------------------------------------------------------
% -----------------------------------------------------------
% -----------------------------------------------------------
% -----------------------------------------------------------
\begin{proof}[Proof of Lemma~\ref{Lemma:Strictness}]
This follows from $\apredpp\septract\semof{\acom}{\abort\mstar\apredpp} =\apredpp\septract\abort=\abort$.
\end{proof}
% -----------------------------------------------------------
% -----------------------------------------------------------
% -----------------------------------------------------------
% -----------------------------------------------------------
\begin{lemma}\label{Lemma:BasicDistributivity}
$\apredpp\septract\semof{\acom}{(\apred\predjoin\apredp)\mstar\apredpp}=(\apredpp\septract\semof{\acom}{\apred\mstar\apredpp})\predjoin
(\apredpp\septract\semof{\acom}{\apredp\mstar\apredpp})$. 
\end{lemma}
\begin{proof}
\begin{align*}
&\ \apredpp\septract\semof{\acom}{(\apred\predjoin\apredp)\mstar\apredpp}\\
=&\ \apredpp\septract\semof{\acom}{(\apred\mstar\apredpp)\predjoin(\apredp\mstar\apredpp)}\\
\explain{$\sem{\acom}$ distributive}=&\ \apredpp\septract(\semof{\acom}{\apred\mstar\apredpp}\predjoin\semof{\acom}{\apredp\mstar\apredpp})\\
\explain{$\septract$ distributes over $\predjoin$}=&\ (\apredpp\septract\semof{\acom}{\apred\mstar\apredpp})\predjoin
(\apredpp\septract\semof{\acom}{\apredp\mstar\apredpp}). \qedhere
\end{align*}
\end{proof}
% -----------------------------------------------------------
% -----------------------------------------------------------
% -----------------------------------------------------------
% -----------------------------------------------------------
\begin{proof}[Proof of Lemma~\ref{Lemma:Distributivity}]
We show the binary case. 
By Lemma~\ref{Lemma:OverDist}, we have $\overapproxof{\acom}{\apredpp}{\apred\predjoin\apredp}$ if and only if both $\overapproxof{\acom}{\apredpp}{\apred}$ and $\overapproxof{\acom}{\apredpp}{\apredp}$ hold. 
If $\overapproxof{\acom}{\apredpp}{\apred\predjoin\apredp}$ fails, then $\icasemof{\acom}{\apredpp}{\apred\predjoin\apredp}=\abort=\icasemof{\acom}{\apredpp}{\apred}\predjoin\icasemof{\acom}{\apredpp}{\apredp}$ by this equivalence. 
If $\overapproxof{\acom}{\apredpp}{\apred\predjoin\apredp}$ holds, then
\begin{align*}
&\ \icasemof{\acom}{\apredpp}{\apred\predjoin\apredp}\\
=&\ \apredpp\septract\semof{\acom}{(\apred\predjoin\apredp)\mstar\apredpp}\\
\explain{Lemma~\ref{Lemma:BasicDistributivity}}=&\ (\apredpp\septract\semof{\acom}{\apred\mstar\apredpp})\predjoin(\apredpp\septract\semof{\acom}{\apredp\mstar\apredpp})\\
\explain{Equiv. on $\overapprox(-)$ + $\overapproxof{\acom}{\apredpp}{\apred\predjoin\apredp}$}=&\ 
\icasemof{\acom}{\apredpp}{\apred}\predjoin \icasemof{\acom}{\apredpp}{\apredp}. \qedhere
\end{align*}
\end{proof}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../main"
%%% End:
