\begin{algorithm}
\caption{Annealed MCMC with MH-like correction for score-based diffusion models}
\label{alg:annealed_mcmc_sampling}
\begin{algorithmic}[1]
\Require Score function $\epsP(\cdot, t)$, schedule parameters $\beta_t$, $\alpha_t$, $\sigma_t$, total steps $T$, MCMC steps $L_t$, kernel step size $\langStep_t$, integration segments $n$
\State $\x_T \sim \mathcal{N}(0, I)$ \Comment{Initialize from prior}
\For{$t = T$ \textbf{to} $1$}
    \State $\eps \sim \mathcal{N}(0, I)$
    \State $\x_{t-1} = \frac{1}{\sqrt{\alpha_t}} \left( \x_t - \frac{\beta_t}{\sigma_t} \epsilon_\theta(\x_t, t) \right) + \sqrt{\beta_t} \eps$ 
    \Comment{(Optional) reverse step}
    \If{$t > 1$}
        \State $\x^0 = \x_{t-1}$ \Comment{Initialize MCMC chain}
        \For{$\tau = 1$ \textbf{to} $L_t$}
            \State Propose candidate $\x^\tau \sim k_{t{-}1}(\cdot \mid \x^{\tau-1}; \epsP, \langStep_{t{-}1}, \sigma_{t{-}1})$ \Comment{$k_{t{-}1}$: LA or HMC kernel}
            \State Compute $f(\x^\tau, \x^{\tau-1}, t{-}1)$ via $n$-segment line integral
            \State Compute MH-like acceptance probability $\alpha$ using Eq.~(\ref{eq:fake_mh})
            \State Accept/reject: $\x^\tau \leftarrow \x^\tau$ with prob. $\alpha$, else $\x^\tau \leftarrow \x^{\tau-1}$
        \EndFor
        \State $\x_{t-1} = \x^L$ \Comment{Use final sample from MCMC}
    \EndIf
\EndFor
\State \Return $\x_0$ \Comment{Final denoised sample}
\end{algorithmic}
\end{algorithm}