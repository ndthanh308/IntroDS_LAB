
\vspace*{-0.25cm}
\section{Existence of Maximal Winning \Odd Strategy Templates}\label{sec:strat-templates}

This section proves the existence of maximal winning \Odd strategy templates\footnote{In the rest of this section, we will sometimes call \Odd strategy templates simply, \emph{strategy templates}, since these are the only strategy templates we will be dealing with.} in \Odd-fair parity games, formalized in the following theorem.

\begin{theorem}\label{thm:existence-maximaloddstrategytemplates}
    Given an \Odd-fair parity game $\mathcal{G}^\ell$, there exists a maximal winning \Odd strategy template. 
\end{theorem}

We prove Thm.~\ref{thm:existence-maximaloddstrategytemplates} by giving an algorithm which constructs $\mathcal{S}$ from a ranking function induced by a fixed-point algorithm in the $\mu$-calculus which computes \Wo. Towards this goal, Sec.~\ref{sec:assump:prelim} first introduces necessary preliminaries, Sec.~\ref{sec:templates:solving} gives the fixed-point algorithm to compute \Wo and Sec.~\ref{sec:templates:ranking} formalizes how to extract a strategy template $\mathcal{S}$ from the ranking induced by this fixed-point and proves that $\mathcal{S}$ is indeed maximal and winning. % from this computation and Sec.~\ref{sec:templates:result} finally shows how this ranking can be used to construct maximal winning strategy templates and proves their correctness. 

While this section uses fixed-point algorithms extensively to \emph{construct} a maximal winning \Odd strategy template towards a \emph{proof} of Thm.~\ref{thm:existence-maximaloddstrategytemplates}, we note again that the proof of the new Zielonka's algorithm given in Sec.~\ref{sec:zielonka} only uses the \emph{existence} of templates (i.e., the fact that Thm.~\ref{thm:existence-maximaloddstrategytemplates} holds) and does not utilize their \emph{construction} via the algorithm presented here. %.\todo{But in the proofs we sometimes construct a strategy template, no? Maybe we can say "does not construct one" instead of "does not require the construction"}

\input{mucalculus}

\vspace{-0.1cm}
\subsection{A Fixed-Point Algorithm for $\mathcal{W}_{\Odd}$}\label{sec:templates:solving}


Given an  \Odd-fair parity game $\mathcal{G}^\ell = \ltup{\langle V, \Ve, \Vo, E, \chi \rangle, E^\ell}$ this section presents a fixed-point algorithm in the $\mu$-calculus which computes the winning region $\Wo$ of player $\Odd$ in \Odd-fair parity games. It is obtained by negating the fixed-point formula computing \We \,in~\cite{banerjee2022fast}, formalized in the following proposition and proven in App.~\ref{app:fp-proof}.

\begin{proposition}\label{prop: W_Odd}
Given an \Odd-fair parity game $\mathcal{G}^\ell = (\ltup{V, \Ve, \Vo, E, \chi}, E^\ell)$ with least even upperbound $l\geq 0$ it holds that $Z=\Wo$, where
\begin{small}
\begin{align}\label{eq:fp-odd}
    Z &:=\textstyle \mu {Y_l}.~  \nu {X_{l-1}}.~  \ldots \mu{Y_2}.~  \nu{X_1}.~  \bigcap_{j \in \ev{2}{l}} \B_j[Y_j, X_{j-1}], \\ \vspace{0.1cm}
    &\text{ where} \quad
    \B_j[\mathbf{Y}, \mathbf{X}] := \left(\textstyle\bigcup_{i \in [j+1,l]} C_i\right) \cup \left(\overline{C_j} \cap \Npre(\mathbf{Y}, \mathbf{X}) \right) \cup \left(C_j \cap \Cpre_\Odd(\mathbf{Y})\right).\nonumber
\end{align}
\end{small}
% 
\end{proposition}


Before utilizing \eqref{eq:fp-odd} we illustrate its computations via an example. %IRMAAAAK IRMAK


\begin{example}\label{ex:1}
Consider the \Odd-fair parity game $\mathcal{G}^\ell $ depicted in Fig.~\ref{fig:ex1} (left). Here, the name of the vertices coincide with their priorities, e.g., $C_2=\set{2a, 2b, 2c}$. $\Ve$ and $\Vo$ are indicated by circles and squares, respectively. Edges in $E^\ell$ are shown by dashed lines. 
% 
As the least even upperbound in this example is $l=4$, 

\vspace*{-0.3cm}
\begin{small}
\begin{align}\label{equ:fpexample}
    &Z = \mu Y_4.~ \nu X_3.~ \mu Y_2.~ \nu X_1.~ \Phi^{Y_4, X_3, Y_2, X_1}~\quad  \text{where}\\
    &\Phi^{Y_4, X_3, Y_2, X_1}:= (\overline{C_4} \cap \Npre(Y_4, X_3)) \cup (C_4 \cap \Cpre_\Odd(Y_4)))\nonumber\\
    & \hspace{2.03cm}\cap (\overline{C_2} \cap \Npre(Y_2, X_1)) \cup (C_2 \cap \Cpre_\Odd(Y_2)) \cup C_4 \cup C_3)\nonumber.
\end{align}
\end{small}

\vspace{-0.2cm}

% Figure environment removed

\vspace{-0.2cm}

Using the notation defined in Sec.~\ref{sec:assump:prelim}, we initialize  \eqref{equ:fpexample} by $Y_4^{0} = \emptyset$, $X_3^{0, 0} = V$, $Y_2^{0,0,0} = \emptyset$ and $X_1^{0,0,0,0} = V$ and observe from \eqref{equ:combindedPres} that  $\Cpre_\Odd(\emptyset)=\emptyset$ and $\Npre(\emptyset, V)=V$. We obtain 
\begin{small}
\begin{align*}
 X_1^{0,0,0,1} &= \Phi^{Y_4^{0}, X_3^{0, 0}, Y_2^{0,0,0}, X_1^{0,0,0,0} }
 =((\overline{C_4} \cap \Npre(\emptyset, V)) \cup (C_4 \cap \Cpre_\Odd(\emptyset)))\cap ((\overline{C_2} \cap \Npre(\emptyset, V)) \\ 
 & \quad \,\, \cup (C_2 \cap \Cpre_\Odd(\emptyset)) \cup C_4 \cup C_3) =(\overline{C_4} ) \cap (\overline{C_2} \cup C_4 \cup C_3) =C_3 \cup C_1\\
%   
%   
  X_1^{0,0,0,2} &= \Phi^{Y_4^{0}, X_3^{0, 0}, Y_2^{0,0,0}, X_1^{0,0,0,1} }\\
  &= C_3 \cup (C_1 \cap \Npre(Y_2^{0,0,0}, X_1^{0,0,0,1})) = C_3 \cup (C_1 \cap \Npre(\emptyset, C_3\cup C_1))=C_3
%   
\end{align*}
\end{small}

\vspace{-0.1cm}

where $ \Npre(\emptyset, C_3\cup C_1)=\emptyset$ as $v \in \Npre(\emptyset, C_3 \cup C_1)$ implies $v\in \Cpre_\Odd(C_3 \cup C_1) = \{2b,4a\}$ and $v\in \Ve \cup \Lpre^\forall(C_3 \cup C_1)$. However, $2b, 4a$ are \Odd vertices with live outgoing edges to $2a,2c\in (V \setminus (C_3 \cup C_1))$.
% 
In the next iteration, we again get $X_1^{0,0,0,3} = C_3$ and thus $X_1$ saturates with $C_3$. Therefore, $Y_2^{0,0,1}=C_3$. Now the next round of computations of $\Phi$ results in 
\begin{small}
\begin{align*}
   X_1^{0,0,1,1} &= \Phi^{Y_4^{0}, X_3^{0, 0}, Y_2^{0,0,1}, X_1^{0,0,1,0} } =  C_3 \cup (C_1 \cap \Npre(Y_2^{0,0,1}, X_1^{0,0,1,0})) \cup (C_2 \cap \Cpre_\Odd(Y_2^{0,0,1}))\\
 & =C_3 \cup (C_1 \cap \Npre(C_3, V)) \cup (C_2 \cap \Cpre_\Odd(C_3))=C_3 \cup C_1 \cup \{2b\}\\
    X_1^{0,0,1,2} &= \Phi^{Y_4^{0}, X_3^{0, 0}, Y_2^{0,0,1}, X_1^{0,0,1,1} } = C_3 \cup \{2b\}=X_1^{0,0,1,3} 
% 
\end{align*}
\end{small}
Here $C_1$ and $\{2b\}$ get added in $X_1^{0,0,1,1}$ as $1a \in \Npre(C_3, V)$ trivially and $2b \in \Cpre_\Odd (C_3)$ due to the edge $(2b,3b)$. $C_1$ is removed from $X_1^{0,0,1,2}$ since
$1a$ cannot be forced by \Odd to $C_1 \cup C_3 \cup \{2b\}$ in the next step.
%$1a \not \in ( C_1 \cap \Npre(Y_2^{0,0,1}, X_1^{0,0,1,1} )) = (C_1 \cap \Npre(C_3, C_1 \cup C_3 \cup \{2b\}))$ since $1a \not \in \Cpre_\Odd(C_1\cup C_3 \cup \{2b\})$.
The fixed-point calculation proceeds in a similar fashion, until $Y_4$ reaches its saturation value $V \setminus \{2a\}$. 
The full computation of $Z$ is given in App.~\ref{app:example}. %\vspace{-2mm}
\end{example}


\subsection{Construction of a Rank-based Strategy Template}\label{sec:templates:ranking}
Given an \Odd-fair parity game $\mathcal{G}^\ell$ with least even upperbound $l\geq 0$, we define a ranking function $\rank{}: \Wo \to \mathbb{N}^{l}$. Intuitively, $\rank{v}$ indicates in which iteration $v$ was added to $Z$ in \eqref{eq:fp-odd} and  never got removed from $Z$ again, as illustrated by the following example. %We show that there exists a strategy template $\Sc=(V',\Ve',\Vo', E')$ of $\mathcal{G}^\ell$, constructed according to $r$, for which all compliant player \Odd strategies are winning in $\mathcal{G}^\ell$.


\begin{example}\label{ex:2}
 Consider again the \Odd-fair parity game depicted in Fig.~\ref{fig:ex1}. Here, $\rank{v}$ of each $v \in \Wo = V \setminus \{2a\}$ is shown in red next to the node in the figure. Intuitively, the $4-$tuple is associated with the subscript $Y_4,Y_3,Y_2,Y_1$ of $\Phi$ in \eqref{equ:fpexample}. For instance $\rank{3a}=(2,0,1,0)$ indicates that $3a$ was added to $Z$ 
 during the first iteration of $Y_2$ inside the second iteration of $Y_4$.
 More concretely, $3a \not \in Y_4^{0}, 3a \not \in Y_4^1, 3a \in Y_4^2$. So $2$ is the first iteration of the $Y_4$ variable in which $3a$ got included in the variable. For $Y_2$, $3a \not \in Y_2^{2,0, 0}$ and $3a \in Y_2^{2,0,1}$, and therefore $\rank{3a} =  (2,0,1,0)$.
\end{example}

The intuition of Ex.~\ref{ex:2} is formalized in the following definition.

\begin{definition}[rank]\label{def:rank}
Given an \Odd-fair parity game $\mathcal{G}^\ell = (\ltup{V, \Ve, \Vo, E, \chi}, E^\ell)$ with least even upperbound $l\geq 0$ and winning region $\Wo\subseteq V$, we define the ranking function $\rank{}: \Wo \to \mathbb{N}^{l}$ for $v\in \Wo$ such that 
 \begin{equation}\label{eq:rank}
  \textstyle\rank{v}=(r_l,0,r_{l-1},0\hdots r_2, 0) \quad\text{if}\quad v\in \bigcap_{j\in\ev{2}{l}}Y_j^{r_l,0,\hdots ,r_j}\setminus Y_j^{r_l,0,\hdots ,r_j-1}.
 \end{equation}
where the valuations of $Y_j$ variables are obtained from the iterations of the fixed-point calculation in~\eqref{eq:fp-odd} as illustrated in Ex.~\ref{ex:1}.
\end{definition}


% \section{Strategy Templates}
A ranking function obtained from a fixed-point computation as in \eqref{eq:rank} naturally gives rise to a positional winning strategy for the respective player in (normal) $\omega$-regular games that allow for positional strategies. The corresponding positional strategy is obtained by always choosing a \emph{minimum ranked successor} in the winning region\footnote{See \cite{banerjee2022fast} for a similar construction of the positional winning strategy of \Even in \Odd-fair parity games}.
% 
We use this insight to obtain a \emph{candidate} maximal strategy template for player \Odd (which we prove to be also \emph{winning} in Prop.~\ref{prop:mainresult}) as follows.
% 
We start with a subgraph on \Wo defining the minimum ranked successor strategy for \Odd induced by the ranking in \eqref{eq:rank}, and then iteratively add all live edges of nodes that lie on a cycle in the subgraph, to the subgraph. The saturated subgraph then defines a strategy template for \Odd, as formalized next. 

\begin{definition}[Rank-based Strategy Template]\label{def:S}
    Given an \Odd-fair parity game $\mathcal{G}^\ell = (\ltup{V, \Ve, \Vo, E, \chi}, E^\ell)$ with least even upper bound $l\geq 0$ on the priorities of nodes, winning region $\Wo\subseteq V$ and the ranking function $\rank{}: \Wo \to \mathbb{N}^{l}$ from Defn.~\ref{def:rank}, we define a strategy template $\Sc^{\mathcal{G}^\ell}=(\Wo,E')$ where $E'$ is constructed as follows:
   \begin{enumerate}\label{const:S}
   \item[(S1)] for all $v \in \Ve \cap \Wo$, add all $(v, w)\in E$ to $E'$;
   \item[(S2)] for all $v \in \Vo \cap \Wo$, add $(v,w)\in E$ to $E'$ for a $w$ with %$w$ is the successor of $v$ with minimum rank, i.e., 
   $w=argmin_{w'\in E(v)}\rank{w'}$ ($w$ is arbitrarily picked amongst the successors with the mimimum ranking);
   \item[(S3)] for all $v \in V^\ell\cap \Wo$, add all $(v,w)\in E^\ell$ to $E'$ if $v$ lays on a cycle in $\mathcal{S}^{\mathcal{G}^\ell}$;
   \item[(S4)] repeat item (S3) until no new edges are added.
   \end{enumerate}
   We call $\Sc^{\mathcal{G}^\ell}$ the \emph{minimum rank based maximal \Odd strategy template of $\mathcal{G}^\ell$}.
   \end{definition}
   
      \begin{example}\label{ex:3}
    $\Sc^{\mathcal{G}^\ell}$ for $\mathcal{G}^\ell$ from Ex.~\ref{ex:1} is depicted in Fig.~\ref{fig:ex1} (right). %We see that the live edges originating from vertex $4a$ are not contained in the template as $4a$ cannot be seen infinitely often if player \Odd chooses the minimal rank successor (i.e., moves to $2b$) upon the first visit to $4a$. After that, $4a$ cannot be visited again if player \Odd plays a strategy compliant with the strategy template.
   \end{example}
   
   It is clear from the definition that $\Sc^{\mathcal{G}^\ell}$ is an \Odd strategy template in $\mathcal{G}^\ell$. It is also maximal since each $v \in \Wo$ is assigned a rank. %The next subsection proves that it is also \emph{winning}.
   It remains to show that it is winning:
   
   
    \begin{proposition}\label{prop:mainresult}
        Every player \Odd strategy compliant with $\Sc^{\mathcal{G}^\ell}$ is winning for \Odd in $\mathcal{G}^\ell$.
    \end{proposition}
    
    \noindent The full proof of Prop.~\ref{prop:mainresult} can be found in App.~\ref{app:counter-strategy-templates} and we only give a proof-sketch here.
    
    First, recall that $\Sc^{\mathcal{G}^\ell}$ is obtained by extending a minimum-rank based strategy as formalized in Def.~\ref{def:S}. Based on this we call a play $v_1 v_2 \ldots$ in $\Sc^{\mathcal{G}^\ell}$ \emph{minimal} if for all $v_i \in V_\Odd$, $v_{i+1}$ is the minimum ranked successor of $v_i$. We further call a cycle minimal, if it is a section of a minimal play.
%     
    Now consider a play $\pi= v_0v_1\ldots$ which is compliant with $\Sc^{\mathcal{G}^\ell}$ and $v_0 \in \Wo$.  Since $\pi$ is compliant with an \Odd strategy template, it obeys the fairness condition. It is left to show that $\pi$ is \Odd winning.
    %
    We do this by a chain of three observations,% formally proven in App.~\ref{app:counter-strategy-templates}:
    \begin{enumerate}
     \item If $\Wo \neq \emptyset$, there exists a non empty set $M := \{ v \in \Wo \mid \rank{v} = (1, 0, 1, 0, \ldots, 1, 0)\}$ (see Prop.~\ref{app-prop:Mexists}).
     \item All cycles in $\Sc^{\mathcal{G}^\ell}$ that pass through a vertex in $M$ are \Odd winning (see Prop.~\ref{app-prop:cycle-through-M}).
     \item All infinite minimal plays in $\Sc^{\mathcal{G}^\ell}$ visit $M$ infinitely often (see Prop.~\ref{app-prop:minimal-play-visits-M}).
    \end{enumerate}
    
    While item 1 simply follows from the observation that $(1,0,1,0 ,\ldots, 1, 0)$ is the minimum rank the ranking function assigns to a vertex and the set of nodes with this rank cannot be empty due to the monotonicity of \eqref{eq:fp-odd}, the proofs for item 2 and 3 are rather technical. %They require a careful analysis of the fixed-point algorithm in \eqref{eq:fp-odd} w.r.t.\ ranks over cycles within $\Sc^{\mathcal{G}^\ell}$ and are given in full detail in App.~\ref{app:counter-strategy-templates}.
    
    With the observations in item 1-3 being proven, we are ready to show that $\pi$ is \Odd winning. 
    Observe that $\pi$ \enquote{embeds} an infinite minimal play, that is, there exists a subsequence $\pi' = v_{j_1} v_{j_2} \ldots$ of $\pi$ where $j_1 < j_2 < \ldots$ that is a minimal play. This is because whenever a $v \in V_\Odd \cap \Wo$ is seen infinitely often in $\pi$, $(v, v_{\min})$ should be seen infinitely often as well, where $v_{\min}$ is the minimum-rank successor of $v$ in $\Sc^{\mathcal{G}^\ell}$.
    Since $\pi'$ visits $M$ infinitely often (from item 3), $\pi$ does so too.
    %
    Then due to pigeonhole principle, there exists an $x\in M$ that is visited infinitely often by $\pi$. Thus, a tail of $\pi$ can be seen as consecutive cycles over $x$. Since all cycles that pass through $M$ are \Odd winning (from item 2), we conclude that $\pi$ is \Odd winning.  
    
    Thm.~\ref{thm:existence-maximaloddstrategytemplates} now follows as a corollary of Prop.~\ref{prop:mainresult}.
    
