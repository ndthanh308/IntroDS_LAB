\begin{algorithm} \label{Alg_Multi}
\begin{remark}
    This algorithm may easily be extended for byzantine tolerance by replacing the standard averaging step with a byzantine-resilient aggregation step.
\end{remark}
    \textit{Initialization:} Set $s = 0 \in \mathbb{R}^d$, $v = 0 \in \mathbb{R}^{M \times d}$. Define $z_{ij}[t]$ as the state vector of node $j$ in network $i$ at iteration $t$, and similarly for $m_{ij}[t]$
    
    \begin{center}
        On each client $j\in \calV_i$: 
    \end{center}
    % \textbf{Algorithm \ref{Alg_Single}}
        
    \For{$t = 1,... ,T$} {
    \textbf{Mass-Preserving Broadcast}
        
        $\sigma_j^+[t] \gets \sigma_j[t-1] + \frac{z_j[t-1]}{d_j^o+1}$
        
        $\Tilde{\sigma}_j^+[t] \gets \Tilde{\sigma}_j[t-1] + \frac{m_j[t-1]}{d_j^o+1}$
        
        Broadcast $(\sigma_j^+[t], \Tilde{\sigma}_j^+[t])$ to all outgoing neighbors of agent $j$ in network $i$
        
        \For{each incoming link $(k, j)$} {
            \State \uIf{message $(\sigma_j^+[t], \Tilde{\sigma}_j^+[t])$ received} {
                $\rho_{kj}[t] \gets \sigma_j^+[t]$, $\Tilde{\rho}_{kj}[t] \gets \Tilde{\sigma}_j^+[t]$
            }
            \Else{
                 $\rho_{kj}[t] \gets \rho_{kj}[t-1]$, $\Tilde{\rho}_{kj}[t] \gets \Tilde{\rho}_{kj}[t-1]$
            }
        }
        
        $z_j^+[t] \gets \frac{z_j[t-1]}{d_j^o+1} + \sum_{k \in I_j} (\rho_{kj}[t] - \rho_{kj}[t-1])$, $m_j^+[t] \gets \frac{m_j[t-1]}{d_j^o+1} + \sum_{k \in I_j} (\Tilde{\rho}_{kj}[t] - \Tilde{\rho}_{kj}[t-1])$
        
        $\sigma_j[t] \gets \sigma_j^+[t] + \frac{z_j^+[t]}{d_j^o+1}$, $\Tilde{\sigma}_j[t] \gets \Tilde{\sigma}_j^+[t] + \frac{m_j^+[t]}{d_j^o+1}$
        
        $z_j[t] \gets \frac{z_j^+[t]}{d_j^o+1}$, $m_j[t] \gets \frac{m_j^+[t]}{d_j^o+1}$
        
        \textbf{Dual Averaging Update Step} 
        \begin{itemize}
            \item Obtain measurement $y_i[t-1]$ according to Equation \ref{eqn: local observation}
            \item Compute a subgradient $g_j[t-1] \in \partial H_j(w_j[t-1])$ according to Equation \ref{eq: local client stochastic gradient}
            \item $z_j[t] \gets z_j[t] + g_j[t-1]$
            \item $w_j[t] \gets \prod_{w\in \calW}^{\varphi}(\frac{z_j[t]}{m_j[t]}, \alpha[t-1])$
        \end{itemize}

    }
    \begin{center}
    On each designated agent: 
\end{center}
\If{$t\mod \Gamma =0$}
{
% $\sigma_j^i[t^+] \gets \sigma_j^i[t] + \frac{1}{2}z_j^i[t]$\; 
% $\tilde{\sigma}_j^i[t^+] \gets \tilde{\sigma}_j^i[t] + \frac{1}{2}\omega_j^i[t]$\; 
Send $\frac{1}{2}z_j^i[t^+]$ and $\frac{1}{2}m_j^i[t^+]$ to the PS\; 

}

\begin{center}
    On the PS: 
\end{center}
\If{$t\mod \Gamma =0$}
{
Compute and send $\frac{1}{M}\sum_{i=1}^M \frac{1}{2}z_{i_0}^i[t^+]$ and $\frac{1}{M}\sum_{i=1}^M \frac{1}{2}m_{i_0}^i[t^+]$\; 
to all designated agents $i_0$ for $i=1, \cdots, M$. 
} 

\begin{center}
    On each designated agent: 
\end{center}
\If{$t\mod \Gamma =0$}
{
Upon receiving messages from the PS: updates 

$z_i[t]\gets \frac{1}{2}z_i[t^+] + \frac{1}{2M}\sum_{i=1}^M z_{i_0}^i[t^+]$\; 
$m_i[t]\gets \frac{1}{2}m_i[t^+] + \frac{1}{2M}\sum_{i=1}^M m_{i_0}^i[t^+]$\;
}
    
 \caption{Multi-network optimization (for network $i$)}
\end{algorithm}