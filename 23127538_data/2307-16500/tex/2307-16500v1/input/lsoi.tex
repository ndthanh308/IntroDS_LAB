%\documentclass[12pt]{article}
%
%\topmargin=0cm
%\headheight=0cm
%\headsep=0cm
%\oddsidemargin=0cm
%\textheight=22cm
%\textwidth=16.6cm
%\evensidemargin=0cm
%\usepackage{amsmath,amssymb,amsthm}
%\usepackage{cleveref}
%\usepackage{comment}
%\usepackage{enumerate}
%\allowdisplaybreaks
%
%%% For TikZs
%\usepackage[dvipdfmx]{graphicx}
%\usepackage{tikz}

%\input{macro}
%\newcommand\LMTT{\text{LMTT}}
%\newcommand\LSI{\text{LSI}}
%\newcommand\LSOI{\text{LSOI}}
%\newcommand\LBIS{\text{LBIS}}
%\newcommand\MSOTT{\text{MSOTT}}

%\theoremstyle{plain}
%\theoremstyle{definition}
%\newtheorem{defn}{Definition}
%\newtheorem{thm}[defn]{Theorem}
%\newtheorem{lem}[defn]{Lemma}
%\newtheorem{prp}[defn]{Proposition}


%\theoremstyle{definitionn}
%\newtheorem{dfn}{Definition}

%\newcommand\dom[1]{\mathit{dom}(#1)}
%\newcommand\rhs{\mathit{rhs}}
%\newcommand\Nat{\mathbb{N}}
%\newcommand\Size[1]{\mathrm{size}(#1)}
%\newcommand\Rank[1]{\mathrm{rank}(#1)}
%\newcommand\Maxr[1]{\mathrm{maxrank}(#1)}
%\newcommand\Root[1]{\mathrm{root}(#1)}
%\newcommand\Sub[1]{\mathrm{sub}(#1)}

%\DeclareSymbolFont{bbsymbol}{U}{bbold}{m}{n} 
%\DeclareMathSymbol\comp{\mathbin}{bbsymbol}{"3B}
%\newcommand\hole{\scalebox{0.7}{\(\square\)}}
%
%\begin{document}
%
%\title{From MTT to ATT --- Sendai Notes (2)}
%\author{By Sebastian and Keisuke}
%\maketitle

%\begin{defn}
%Let \(\Sub{t}\) be the set of subtrees of \(t\).
%\begin{itemize}
%\item
%\(f:T_\Sigma\to T_\Delta\) is said to be \emph{linear size increase (LSI)}
%if there exists \(c>0\) such that \(|f(t)|\le c\cdot|t|\) for all \(t\in T_\Sigma\).
%\item
%\(f:T_\Sigma\to T_\Delta\) is said to be \emph{linear bounded input (LBI)}
%if there exists \(c>0\) such that \(|t|\le c\cdot|f(t)|\) for all \(t\in T_\Sigma\).
%\item 
%\(f:T_\Sigma\to T_\Delta\) is said to be
%\emph{linear size-to-number-of-distinct output subtree increase (LSOI)}
%if there exists \(c>0\) such that \(|\Sub{f(t)}|\le c\cdot|t|\) for all \(t\in T_\Sigma\).
%\item
%\(f:T_\Sigma\to T_\Delta\) is said to be 
%\emph{linear bounded input on the number of distinct output subtrees (LBIS)}
%if there exists \(c>0\) such that \(|t|\le c\cdot|\Sub{f(t)}|\) for all \(t\in T_\Sigma\).
%\item 
%\(f:T_\Sigma\to T_\Delta\) is said to be
%\emph{linear subtree increase (LSTI)}
%if there exists \(c>0\) such that \(|\Sub{f(t)}|\le c\cdot|\Sub{t}|\) for all \(t\in T_\Sigma\).
%\item 
%\(f:T_\Sigma\to T_\Delta\) is said to be
%\emph{linear bounded subtree (LBST)}
%if there exists \(c>0\) such that \(|\Sub{t}|\le c\cdot|\Sub{f(t)}|\) for all \(t\in T_\Sigma\).
%\end{itemize}
%\end{defn}
%
%\begin{prp}
%Let \(f:T_\Sigma\to T_\Delta\) be a function.
%Then
%\begin{itemize}
%\item if \(f\) is LSI, then it is LSOI;
%\item if \(f\) is LSTI, then it is LSOI;
%\item if \(f\) is LBIS, then it is LBI;
%\item if \(f\) is LBST, then it is LBI;
%\item LSI, LBI, LBIS, and LSTI are closed under composition.
%\end{itemize}
%\end{prp}
%
%\begin{lem}
%\label{lem:comp-lsoi}
%Let \(f:T_\Sigma\to T_\Delta\) and \(g:T_\Delta\to T_\Gamma\) be
%tree transformations such that
%\(f\comp g\) is LSOI and \(g\) is LBIS.
%Then \(f\) is LSI.
%\end{lem}
%%
%\begin{proof}
%Since \(g\) is LBIS, there exists \(c\) such that
%\(|t| \le c\cdot|\Sub{g(t)}|\) for all \(t\in T_\Delta\).
%In particular, we have \(|f(t)| \le c\cdot|\Sub{g(f(t))}|\) for all \(t\in T_\Sigma\).
%Furthermore, since \(f\comp g\) is LSOI, there exists \(c'\) such that
%\(|\Sub{g(f(t))}|\le c'\cdot|t|\) for all \(t\in T_\Sigma\).
%Therefore, 
%\(|f(t)|\le c\cdot|\Sub{g(f(t))}|\le cc'\cdot|t|\) for all \(t\in T_\Sigma\),
%and hence \(f\) is LSI.
%\end{proof}
%
%\begin{lem}
%Suppose that \(\MTT^2\cap\LSOI\subseteq\MTT\comp(\LMTT\cap\LBIS)\).
%Then we have \(\MTT^2\cap\LSOI = \MTT\cap\LSOI\).
%\end{lem}
%%
%\begin{proof}
%\begin{align*}
%\MTT^{2}\cap\LSOI &\subseteq (\MTT\comp(\LMTT\cap\LBIS))\cap\LSOI
%\\&\subseteq ((\MTT\cap\LSI)\comp\LMTT)\cap\LSOI
%\\&\subseteq (\MSOTT\comp\LMTT)\cap\LSOI
%\\&\subseteq (\MSOTT\comp\ATTR)\cap\LSOI
%\\&\subseteq \ATTR\cap\LSOI
%\\&\subseteq \MTT\cap\LSOI
%\end{align*}
%\end{proof}
%
%\begin{lem}
%Let \(f:T_\Sigma\to T_\Delta\) and \(g:T_\Delta\to T_\Gamma\) be
%tree transformations such that
%\(f\comp g\) is LSOI and \(g\) is LBST.
%Then \(f\) is LSOI.
%\end{lem}
%%
%\begin{proof}
%Since \(g\) is LBST, there exists \(c\) such that
%\(|\Sub{t}| \le c\cdot|\Sub{g(t)}|\) for all \(t\in T_\Delta\).
%In particular, we have \(|\Sub{f(t)}| \le c\cdot|\Sub{g(f(t))}|\) for all \(t\in T_\Sigma\).
%Furthermore, since \(f\comp g\) is LSOI, there exists \(c'\) such that
%\(|\Sub{g(f(t))}|\le c'\cdot|t|\) for all \(t\in T_\Sigma\).
%Therefore, 
%\(|\Sub{f(t)}|\le c\cdot|\Sub{g(f(t))}|\le cc'\cdot|t|\) for all \(t\in T_\Sigma\),
%and hence \(f\) is LSOI.
%\end{proof}

\section{Complexity of Deciding LSOI}

In this section we consider \emph{linear size-to-number-of-distinct-output-subtrees increase} (``LSOI'').
Let us first define LSOI more formally.
Let $\tau$ be a total function from $T_\Sigma$ to $T_\Delta$ for some
ranked alphabets $\Sigma,\Delta$.
For a tree $t$ let us define its set $\text{sub}(t)$ of subtrees 
as $\{ t/u\mid u\in V(t)\}$.
Then $\tau$ is of \emph{LSOI} if there exists a number $c$ such that for
every input tree $s\in T_\Sigma$ it holds that $|\text{sub}(\tau(s))|\leq c\cdot |s|$.

Without explaining details about attributed tree transducers, the intuition is: with each node of the
input tree a fixed number of attributes are associated and attributes define output trees in
terms of other attributes. This implies that there can only be at most the product of the number
of attributes and the size of the input tree many distinct output subtrees. Therefore
the translation of every attributed tree transducer is of LSOI.
Since every attributed transducer can be transformed into an equivalent macro tree transducer
(even without look-ahead, see, e.g., the proof of Lemma~6.1 of~\cite{DBLP:series/eatcs/FulopV98})
it suffices to consider mtts that are of LSOI.
Here, we do not need look-ahaed. In our terminology, an ``mtt'' is an mttr
$(Q,P,\Sigma,\Delta,q_0,R,h)$ for which $(P,\Sigma,h)$ is the trivial automaton with $P=\{p\}$ and
$\hat{h}(s)=p$ for every $s\in T_\Sigma$. 

\begin{thm}
\label{thm:lsoi-hard}
The decision problem whether a given mtt is of LSOI is as hard as
the equivalence problem of mtts that are of LSOI.
\end{thm}

\begin{proof}
Let \(M_1=(\Sigma,\Delta,Q_1,q_1,R_1)\)
and \(M_2=(\Sigma,\Delta,Q_2,q_2,R_2)\)
be LSOI MTTs to be decided their equivalence \(M_1=M_2\), i.e.,
%\(\dom{M_1}=\dom{M_2}\) and 
\(M_1(t)=M_2(t)\) for every \(t\in T_\Sigma\). %\(t\in\dom{M_1}\).
Without loss of generality, we assume that \(Q_1\) and \(Q_2\) are disjoint.
We construct an MTT \(M\) which should be LSOI if and only if \(M_1=M_2\).

Let \(M=(\Sigma',\Delta',Q,q_0,R)\) be an MTT where
\begin{itemize}
\item
\(\Sigma' = \Sigma\cup\{a^{(1)}\}\) with \(a\not\in\Sigma\)
\item
\(\Delta' = \Delta\cup\{f^{(2)},e^{(0)}\}\) with \(f,e\not\in\Delta\)
\item
\(Q = Q_1\cup Q_2\cup \{q_0^{(0)},q^{(3)}\}\) with \(q_0,q\not\in Q_1\cup Q_2\)
\item
\(R = R_1\cup R_2
\begin{array}[t]{l@{~}l}
%\cup & \{q_0(a(x)) \to f(q(x,q_1(x),q_2(x),f(q_1(x),e)),q(x,q_1(x),q_2(x),f(q_2(x),e))) \}
\cup & \{\<q_0,a(x)> \to \<q,x>(\<q_1,x>,\<q_2,x>,e)\}
\\
\cup & \{\<q_0,\sigma(x_1,\dots,x_n)> \to e \mid \sigma\in\Sigma \}
\\
\cup & \{\<q,a(x)>(y_1,y_2,y_3) \to f(\<q,x>(y_1,y_2,f(y_1,y_3)),\<q,x>(y_1,y_2,f(y_2,y_3))) \}
\\
\cup & \{\<q,\sigma(x_1,\dots,x_n)>(y_1,y_2,y_3) \to y_3 \mid \sigma\in\Sigma \}
\\
%\cup & \{q_i(a(x)) \to q_i(x) \mid i\in\{1,2\} \}
%\cup & \{q_1(a(x)) \to q_1(x),~ q_2(a(x)) \to q_2(x)\}
%\\
%\cup & \{p(a(x),y_1,\dots,y_m) \to e \mid p\in (Q_1\cup Q_2)\setminus\{q_1,q_2\}\} 
\cup & \{\<q',a(x)>(y_1,\dots,y_m) \to \<q',x>(y_1,\dots,y_m) \mid q'\in Q_1^{(m)}\cup Q_2^{(m)}\}
\end{array}
\)
\end{itemize}
Now we shall make the semantics of \(M\) clear.
If the root symbol of an input tree \(t\) is not \(a\),
then \(M(t)=e\).
If the root symbol of an input tree is \(a\),
it has the form of \(a^{n+1}(t)\) with \(n\in\N\), \(t\in T_{\Sigma'}\) and \(\Root{t}\in\Sigma\).
In the case where \(t\) contains \(a\),
we have \(M(a^{n+1}(t))=M(a^{n+1}(t'))\)
where \(t'\) is obtained by skipping all \(a\)'s in \(t\).
Thereby, we need to consider the case where \(t\) does not contain \(a\), that is, \(t\in T_\Sigma\).
We can see that
\(M(a^{n+1}(t))\) with \(t\in T_\Sigma\) is 
a full binary tree of height \(n\) whose leaves are replaced with `cons-list-like` trees
that are determined by the reversed Dewey path to the root~(\Cref{fig:expdewey}).
If the path to a leaf is \(i_1.i_2.\dots.i_{n-1}.i_n\) with \(i_k\in\{1,2\}\),
then the leaf is replaced with a tree
\(f(t_{i_n},f(t_{i_{n-1}},\dots
f(t_{i_2},f(t_{i_1},e))\dots))\)
where \(t_1=M_1(t)\) and \(t_2=M_2(t)\).

First, suppose that \(M_1\ne M_2\).
Since our transducers are total (i.e., the domains of $M_1$ and of $M_2$ 
coincide and equal $T_\Sigma$), there must exist a tree \(t\in T_\Sigma\)
such that \(M_1(t)\ne M_2(t)\).
Then considering \(t'=a^{n+1}(t)\) with \(n\in\N\),
the output tree \(M(a^{n+1}(t))\) is a full binary tree of height \(n\)
whose ``leaves'' all contain distinct output trees; hence the number of subtrees is 
at least \(2^n\).
Therefore, the MTT \(M\) is not of LSOI.

On the other hand, suppose that \(M_1=M_2\).
We only consider the case where the input has the form of \(a^{n+1}(t)\) with \(t\in T_\Sigma\)
because the other cases do not increase the size of the output more that this case.
Then 
\(M(a^{n+1}(t))\) with \(t\in T_\Sigma\) is 
a full binary tree of height \(n\) 
whose leaves are replaced with the cons-list-like trees.
Note that all of the replaced trees are equal 
because \(M_1=M_2\).
Therefore all the nodes of the full binary tree that are on the same level
are roots of the same subtree.
Since \(M_1\) and \(M_2\) are of LSOI,
the number of subtrees of the output tree \(M(a^{n+1}(t))\) is
linear in \(n+\Size{t}\), that is, linear in \(\Size{a^{n+1}(t)}\).
Therefore, the MTT \(M\) is of LSOI.
%\end{comment}
\end{proof}

\def\Tcons#1[#2]#3#4{node {#1} [sibling distance = 5mm, level distance = 10mm] 
                     edge from parent [#2]
                     child {node {#3}}
                     child {#4}
                     child {node {} edge from parent [draw=none]}}
\def\Tvdots#1#2{node {#1} [level distance = 4mm]
                child {node {\(\vdots\)} edge from parent [draw = none] [level distance = 6mm]
                       child {#2}}}

% Figure environment removed

As mentioned above, every attributed tree transducer can be (effectively) realized by
an mtt that is of LSOI. Therefore, we obtain from Theorem~\ref{thm:lsoi-hard}
the following corollary.

\begin{corollary}
The decision problem whether a given mtt is of LSOI is as hard as
the equivalence problem of attributed tree transducers.
\end{corollary}
