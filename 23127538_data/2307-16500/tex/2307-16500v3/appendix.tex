\section*{Appendix}


\subsection*{Proof of Lemma~\ref{lm:dec}}

Statement of the lemma:
Let $M=(Q,P,\Sigma,\Delta,q_0,R,h)$ be an mttr and let
$q\in Q^{(m)}$, $m\geq 1$, $j\in[m]$, and $p\in P$.
It is decidable whether or not 
$\lcop{M_q(L_p)}_{\{y_j\}}$ is finite.
In case of finiteness, 
$\lcop{M_q(L_p)}_{\{y_j\}}$ can be constructed.

\smallskip

\begin{proof}
Let $T_Z = (\{q_1^{(0)}\},P',\Delta\cup Y_m,\Delta',q_1,R',h')$ where
$P'={\cal P}(Y_m)$ and
$\Delta'=\Delta\cup \{ S^{(0)}\mid S\in P'\}\cup Y_m$.
For $y\in Y_m$ let $h'_y()=\{y\}$ and for
$a\in\Delta^{(0)}$ let $h'_a()=\emptyset$.
Further, for $\delta\in\Delta^{(k)}$, $k\geq 1$, and 
$S_1,\dots,S_k\in P'$ let 
$h'_\delta(S_1,\dots,S_k)=\bigcup_{i\in[k]}S_i$.
For $a\in\Delta^{(0)}$ let the rule
$\< q_1,a>\to\emptyset$ be in $R$.
Let $y\in Y_m$.
If $y\in Z$ then let the rule
$\< q_1,y>\to y$ be in $R$ and otherwise let the rule
$\< q_1,y>\to \{y\}$ be in $R$.
For $\delta\in\Delta^{(k)}$ with $k\geq 1$ 
and $S_1,\dots,S_k\in P'$
we define the rule
$\< q_1,\delta(x_1:S_1,\dots,x_k:S_k)>\to\zeta$ where $\zeta$ is define as:
\[
\begin{array}{lcll}
  \zeta & = &
\left\{ 
  \begin{array}{ll}
  S & \text{if }S= (\bigcup_{i\in[k]} S_i)\cap Z=\emptyset\\
  \delta(\< q_1,x_1>,\dots,\<q_1,x_k>) & \text{otherwise.}
  \end{array}
\right. 
\end{array}
\]

\noindent
\textbf{Claim.}\quad
For every $t\in T_{\Delta\cup Y_m}$, $h'(t)=\paras{t}$ and
$T_Z(t)=\lcop{t}_Z$.

\medskip

It is straightforward to prove this claim by induction on the structure of $t$.
By the Claim,
$T_{\{y_j\}}(M_q(L_p)) = \lcop{M_q(L_p)}_{\{y_j\}}$.
The tree language $L_p$ can be represented by a partial nondeterministic
top-down tree transducer that realizes the identity on trees in $L_p$
(and is undefined otherwise; its rules are obtained by reading the
definitions of $h$ from right to left). 
In this way $T_{\{y_j\}}(M_q(L_p))$ is represented
so that its finiteness is decidable by Proposition~\ref{prop:finite}
(and in case of finiteness the set can be constructed).
\qed
\end{proof}


\subsection*{Proof of Lemma~\ref{lm:decidable}}

Statement of the lemma:
Let $M$ be an mttr.
Then 
(1)~it is decidable whether or not $M$ is finite nesting and
(2)~it is decidable whether or not $M$ is finite yield nesting.

\smallskip

\begin{proof}
Let $M=(Q,P,\Sigma,\Delta,q_0,R,h)$.
We use the extension 
$\hat{M}=(\hat{Q},P,\hat{\Sigma},\hat{\Delta},q_0,$ $\hat{R},h)$
of $M$ with input trees in $s\in T_\Sigma[P]$ which contain
(1)~exactly one or
(2)~arbitrarily many occurrences of elements of $P$.
We then use a nondeterministic top-down tree transducer $T$ which chooses
any path in the tree $\hat{M}(s)$ and outputs only the elements from
$\< Q,P>$ on that path, now seen as unary symbols.
The resulting output language $T(\hat{M}(T_\Sigma))$ is finite if and only
if $M$ is (1)~fnest or (2)~fynest.

Formally, 
$T=(\{q_1^{(0)}\},\hat{\Delta},\Gamma,q_1,R')$ where
$\Gamma=\< Q,P>\cup\{e^{(0)}\}$.
For every $\delta\in\Delta^{(k)}$, $k\geq 1$, and $i\in k$
we let the rule
$\<q_1,\delta(x_1,\dots,x_k)>\to\<q_1,x_i>$ be in $R'$.
For every $\delta\in\Delta^{(0)}$ we let the rule
$\<q_1,\delta>\to e$ be in $R'$.
For every $\<q,p>\in \<Q,P>^{(m)}$, $m\geq 1$, and $i\in[m]$
we let the rule
$\<q_1,\langle q,p\rangle(x_1,\dots,x_m)>\to \<q,p>(\<q_1,x_i>)$ be in $R'$.
For every $\<q,p>\in\<Q,P>^{(0)}$ we let the rule
$\<q_1,\langle q,p\rangle>\to \<q,p>$ be in $R'$.
It is straightforward to show (by induction on the structure of $s$), that
$T(\hat{M}(T_\Sigma[P]))$ is finite if and only if $M$ is fynest.
Let $L$ be the set of trees in $T_\Sigma[P]$ which contain exactly one occurrence
of an element of $P$. 
It is straightforward to show (by induction on the structure of $s$), that
$T(\hat{M}(L))$ is finite if and only if $M$ is fnest.
\qed
\end{proof}

