%!TEX root = main.tex

% macros (will be moved later)

%\section{Termination of the procedure}

We are now ready to show that the iteration of the construction $\pi(M)$ will
terminate with a transducer that is depth-proper.
We do not present a firm bound but use a K{\"o}nigs Lemma-like argument
for termination.

\begin{lemma}\label{lm:term}
Let \(M\) be a nondeleting mttr with improper states of rank at most \(m\).
There exists \(n\) such that 
any reachable improper state of \(\pi^n(M)\) has rank at most \((m-1)\).
\end{lemma}
%
\begin{proof}
Let \(Q_0\) be the set of states of \(M\).
From the construction, 
every look-ahead of \(\pi^k(M)\) has the form: \((p,\varphi_1,\dots,\varphi_k)\)
with a look-ahead state \(p\) of \(M\).
Since each application of \(\pi\) makes no improper states proper,
we may have an infinite sequence
$ F_p\cap Q_0 \subseteq F_{(p,\varphi_1)}\cap Q_0 \subseteq \dots \subseteq
   F_{(p,\varphi_1,\dots,\varphi_k)}\cap Q_0 \subseteq \dots $
for any maps \(\varphi_i\) introduced in the look-ahead of \(\pi^i(M)\).
Since \(Q_0\) is finite, the chain contains only finitely many strict inclusions.
Hence there is \(n\) such that 
%the set of improper states in \(Q_0\) becomes stable, that is,
\( F_{(p,\varphi_1,\dots,\varphi_n)}\cap Q_0 = F_{(p,\varphi_1,\dots,\varphi_{n'})} \cap Q_0 \)
for any \(n'>n\) and any maps \(\varphi_i\) with \(i\in[n']\).
%Let \(Q_t\) be a set of improper states of \(\pi^n(M)\).
Since no more improper states in \(Q_0\) will be added by another application of \(\pi\),
every reachable improper states of \(\pi^n(M)\) is a helper state, 
which has rank at most \((m-1)\).
\qed
\end{proof}

\begin{theorem}
  \label{th:proper}
For every mttr \(M\), there is a proper mttr \(M'\) equivalent to \(M\).
\end{theorem}
%
\begin{proof}
There is a nondeleting mttr \(M_0\) equivalent to \(M\) 
(\cite{DBLP:journals/iandc/EngelfrietM99} or Proposition~\ref{prop:nondeleting}).
We repeatedly construct equivalent trunsducers $\pi(M)$, $\pi(\pi(M))$, etc.
until a proper mttr is obtained (which is decidable by
Lemma~\ref{lm:dec}). The repetition terminates by Lemma~\ref{lm:term}
(first eleminating all reachable calls of improper states of the highest rank $m$, then
those or rank $m-1$, etc.).
\qed
\end{proof}
