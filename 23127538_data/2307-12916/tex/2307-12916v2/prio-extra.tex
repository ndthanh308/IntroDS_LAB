%\section{Details on MMS with Agent Priority Ranking}
%\label{sec:prio-extra}

\input{hard2.tex}

\subsection{Bounding Sums using Integrals}
\label{sec:prio-extra:calculations}

\begin{lemma}
\label{thm:int-bound}
Let $f: [a, b] \to \mathbb{R}_{\ge 0}$ be a non-increasing function
and let $F$ be its antiderivative. Then
\[ f(b) + \int_a^b f(x)dx \le \sum_{i=a}^b f(i) \le f(a) + \int_a^b f(x)dx. \]
\end{lemma}

\rthmRbfAvg*
\begin{proof}
Define $f: [0, n-1] \to \mathbb{R}_{\ge 0}$ as
\[ f(x) \defeq \max\left(\frac{2n}{2n+x},\,\frac{3}{4} + \frac{1}{12n}\right). \]
Let $\beta \defeq 2n(3n-1)/(9n+1)$. Then
\[ \frac{2n}{2n+x} \ge \frac{3}{4} + \frac{1}{12n} \iff x \le \beta. \]
Hence,
\[ f(x) \defeq \begin{cases}
\displaystyle \frac{2n}{2n+x} & \textrm{ if } x \in [0, \beta)
\\[1em] \displaystyle \frac{3}{4} + \frac{1}{12n} & \textrm{ if } x \in (\beta, n-1]
\end{cases}. \]
Therefore,
\newcommand*{\longNegSpace}{\!\!\!\!\!\!}
\begin{align*}
\gamma &= \frac{1}{n}\sum_{i=0}^{n-1} f(i)
    \ge \frac{1}{n}\left(\frac{3}{4} + \frac{1}{12n} + \int_0^{n-1}\longNegSpace f(x)dx\right)
    \tag{by \cref{thm:int-bound}}
\\ &= \frac{1}{n}\left(2n\ln\left(\frac{2n+\beta}{2n}\right)
    + \left(\frac{3}{4} + \frac{1}{12n}\right)(n-\beta)\right)
\\ &= 2\ln\left(\frac{4}{3}\right) + \frac{1}{4} + \frac{1}{4n} - 2\ln\left(1 + \frac{1}{9n}\right)
\\ &\ge 2\ln\left(\frac{4}{3}\right) + \frac{1}{4} + \frac{1}{4n} - \frac{2}{9n}
    \tag{since $\ln(1+x) \le x$ for all $x > -1$}
\\ &= 2\ln\left(\frac{4}{3}\right) + \frac{1}{4} + \frac{1}{36n}.
\qedhere
\end{align*}
\end{proof}

\rthmHardIExa*
\begin{proof}
\begin{align*}
& \frac{1}{n}\left(2 + \sum_{i=3}^n \frac{3n}{3n+i-2}\right)
= \frac{1}{n}\left(1 + \sum_{i=0}^{n-2} \frac{3n}{3n+i}\right)
\\ &\le \frac{1}{n}\left(2 + 3n\int_0^{n-2} \frac{dx}{3n+x}\right)
    \tag{by \cref{thm:int-bound}}
\\ &= \frac{2}{n} + 3\ln\left(\frac{4}{3}\right) + 3\ln\left(1 - \frac{1}{2n}\right)
\\ &\le \frac{2}{n} + 3\ln\left(\frac{4}{3}\right) - \frac{3}{2n}
    \tag{since $\ln(1-x) \le -x$ for all $x < 1$}
\\ &= 3\ln\left(\frac{4}{3}\right) + \frac{1}{2n}.
\qedhere
\end{align*}
\end{proof}

\rthmHardIIExa*
\begin{proof}
Define $f: [0, n-1] \to \mathbb{R}_{\ge 0}$ as
\[ f(x) \defeq \min\left(\frac{3n}{3n+x-1}, \max\left(\frac{5}{6}, 1 - \frac{x}{3n}\right)\right). \]
Then for $x \ge 0$,
\[ \frac{3n}{3n+x-1} - \left(1 - \frac{x}{3n}\right)
= \frac{x(x-1) + 3n}{3n(3n+i-2)} > 0. \]
\[ \frac{5}{6} \ge 1 - \frac{x}{3n} \iff x \ge \frac{n}{2}. \]
\[ \frac{5}{6} \le \frac{3n}{3n+x-1} \iff x \le \frac{3n}{5}+1. \]
Hence,
\[ f(x) = \begin{cases}
1 - x/3n & \textrm{ if } x \in [0, n/2]
\\ 5/6 & \textrm{ if } x \in \big(\frac{n}{2}, \frac{3n}{5}+1\big]
\\ \displaystyle \frac{3n}{3n+x-1} & \textrm{ if } x \in \big(\frac{3n}{5}+1, n-1\big]
\end{cases}. \]
Therefore,
\begin{align*}
& \frac{1}{n}\sum_{i=1}^n f(i-1)
\le \frac{1}{n}\left(f(0) + \int_0^{n-1} f(x)dx\right)
    \tag{by \cref{thm:int-bound}}
\\ &= \frac{1}{n}\left(1 + \int_0^{\frac{n}{2}}\left(1 - \frac{x}{3n}\right)dx
    + \int_{\frac{n}{2}}^{\frac{3n}{5}+1} \frac{5}{6}dx + \int_{\frac{3n}{5}+1}^{n-1} \frac{3n}{3n+x-1}dx\right)
\\ &= \frac{1}{n}\left(\frac{11}{6} + \frac{13}{24}n
    + 3n\ln\left(\frac{10}{9}\left(1 - \frac{1}{2n}\right)\right)\right)
\\ &\le \frac{13}{24} + 3\ln\left(\frac{10}{9}\right) + \frac{1}{3n}.
    \tag{since $\ln(1-x) \le -x$ for all $x < 1$}
\end{align*}
\end{proof}
