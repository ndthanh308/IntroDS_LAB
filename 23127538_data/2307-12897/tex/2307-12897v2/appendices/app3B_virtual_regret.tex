\subsection{Proof of Virtual Regret}
\begin{proposition}\label{prop:CI_oracle}
For any fixed $\tilde \lambda > 0$, there exists an absolute constant $C_1$ such that
    \[
    \sP \left( \forall t\geq 1: \, \norm{\hat\vbeta_{t,j^\star} - \vtheta_{j^\star}}_2 \leq \omega(t,\delta, d)  \right) \geq 1-\delta.
    \]
    where 
    \[
    \omega(t, \delta, d) \coloneqq C_1 \sqrt{\tfrac{\sigma^2d\log\left(\tfrac{t}{\tilde\lambda d}+1\right) + 2\sigma^2\log(1/\delta) + \tilde\lambda B^2}{\tilde \lambda + \cmin t^{3/4}}}\left( 1+ \cmin^{-1}t^{-3/8} \sqrt{\log(Md/\delta) + (\log\log t)_+}\right).
    \]
    Moreover, for $u_{t,j^\star}(\cdot) \coloneqq \hat\vbeta_{t,j^\star}^\top \vphi_{j^\star}(\cdot) + \omega(t, \delta, d)$,
    \[
    \sP\left(\forall t \geq 1, \,\vx\in \calX: r(\vx) \leq u_{t, j^\star}(\vx)\right) \geq 1-\delta.
    \]
\end{proposition}
\begin{proof}[Proof of \cref{prop:CI_oracle}]
Define for convenience $V_t = \Phi_{t,j^\star}^\top \Phi_{t,j^\star} +  \tilde\lambda \boldsymbol{I}$. We first observe that
\begin{equation*}
    \hat \vbeta_{t,j^\star} = V_t^{-1} {(\Phi_{t,j^\star})^\top \vy_t}
\end{equation*} 
We can apply results from \cite{abbasi2011improved} to get an anytime-valid confidence set. Their Theorem 2 asserts that with probability $1-\delta$, for all $t \geq 1$ we have\footnote{Their theorem statement is slightly different, but they prove the stronger version we state below.}
\begin{equation*}
\norm{\hat \vbeta_{t,j^\star} - \vtheta_{j^\star}}_{V_t}^2 \leq \beta_t
\end{equation*}
where
\begin{equation*}
    \beta_t = 2\sigma^2\log \left(\frac{\det(V_t)^{1/2}}{\det(\tilde\lambda \boldsymbol I)^{1/2}\delta}\right) + \tilde\lambda B^2
\end{equation*}
Clearly, $V_t \succeq \lambda_{\mathrm{min}}(V_t)I$, and therefore with high probability,
\begin{equation*}
\norm{\hat \vbeta_{t,j^\star} - \vtheta_{j^\star}}_2 \leq \sqrt{\frac{\beta_t}{\lambda_{\mathrm{min}}(V_t)}}
\end{equation*}
uniformly over time.
Our assumption is that $\norm{\vphi_j(\vx)} \leq 1$, and hence, denoting by $\nu_i$ the eigenvalues of $V_t$, the geometric-arithmetic mean inequality yields
$$
    \det(V_t) \leq \prod_{i=1}^d \nu_i \leq \left(\frac{1}{d}\mathrm{trace}(V_t)\right)^d.
$$
Given that $$
\mathrm{trace}(V_t) = \sum_{i=1}^d \sum_{s=1}^t (\vphi_{j^\star}(x))_i^2 + \tilde \lambda d \leq t + \tilde\lambda d
$$
we can conclude that
\begin{equation*}
    \beta_t \leq 2\sigma^2\log \left(\frac{(t/d+\tilde\lambda )^{d/2}}{\tilde\lambda ^{d/2}\delta}\right) + \tilde\lambda B^2 = d\sigma^2 \log\left(\frac{t}{\tilde\lambda d}+1\right) + 2\sigma^2\log(1/\delta) + \tilde\lambda B^2
\end{equation*}
We note that 
\begin{equation*}
    \lambda_{\min}(V_t) = \lambda_{\mathrm{min}}(\Phi^\top_{t,j}\Phi_{t,j}) + \tilde \lambda.
\end{equation*}
Then due to \cref{lem:lambda_min_virtual}, there exist absolute constants $C_1$ and $C_2$ such that for all $t \geq 1$,
\begin{equation*}
 \lambda_{\min}(V_t) \geq \tilde \lambda + C_1\cmin t^{3/4} - C_2t^{3/8} \sqrt{\log(Md/\delta) + (\log\log t)_+}
\end{equation*}
therefore, there exists $C_3$ and $C_4$ such that
\begin{align*}
\frac{1}{\sqrt{\lambda_{\mathrm{min}}(V_t)}} & \leq \frac{1}{\sqrt{\tilde \lambda + C_1\cmin t^{3/4} - C_2t^{3/8} \sqrt{\log(Md/\delta) + (\log\log t)_+}}}\\
& \leq  \frac{C_3}{\sqrt{\tilde \lambda + C_1\cmin t^{3/4}}}\left( 1+ \frac{t^{3/8} \sqrt{\log(Md/\delta) + (\log\log t)_+}}{\tilde \lambda +  C_1\cmin t^{3/4}}\right)\\
& \leq \frac{C_4}{\sqrt{\tilde \lambda + C_1\cmin t^{3/4}}}\left( 1+ \cmin^{-1}t^{-3/8} \sqrt{\log(Md/\delta) + (\log\log t)_+}\right)
\end{align*}
with high probability for all $t \geq 1$. Setting
\begin{align*}
    \omega(t, \delta, d) = C_5\sqrt{\tfrac{\sigma^2d\log\left(\frac{t}{\tilde\lambda d}+1\right) + 2\sigma^2\log(1/\delta) + \tilde\lambda B^2}{\tilde \lambda + \cmin t^{3/4}}}\left( 1+ \cmin^{-1}t^{-3/8} \sqrt{\log(Md/\delta) + (\log\log t)_+}\right)
\end{align*}
where $C_5$ is an absolute constant concludes the parametric confidence bound. The upper confidence bound then simply follows: for any $\vx\in \calX$
\begin{align*}
    r(\vx) - \hat\vbeta^\top_{t,j^\star}\vphi_{j^\star}(\vx)  = \langle \vtheta_{j^\star} - \hat\vbeta_{t,j^\star}, \vphi_{j^\star}(\vx)\rangle \leq \norm{\vtheta_{j^\star} - \hat\vbeta_{t,j^\star}}_2 \norm{\vphi_{j^\star}(\vx)}_2
     \leq \omega(t, \delta, d)
\end{align*}
where the last inequality holds with high probability simultaneously for all $t \geq 1$.
\end{proof}


% \begin{lemma}[Virtual Regret]\label{thm:virtual_regret} Let $\delta \in (0, 1]$ and choose $\tilde \lambda >0$. Then, by setting $\gamma_t$, $\eta_t$ and $\lambda_t$ as prescribed by \cref{thm:anytime_regret_MS}, the oracle agent satisfies,
% \begin{align*}
% \sP\left(\forall n\geq 1:\, \tilde R_{j^\star}(n) = \calO\left( \cmin^{-1/2}n^{5/8}\sqrt{\sigma^2d\log\left(n\right) + 2\sigma^2\log(1/\delta) + \tilde\lambda B^2}\right)\right) \geq 1-\delta.
% \end{align*}
% \end{lemma}



\begin{proof}[\textbf{Proof of \cref{thm:virtual_regret_rigorous}}] Using \cref{prop:CI_oracle} and the Cauchy-Schwarz inequality we obtain,
\begin{align*}
    \tilde R_{j^\star}(n) & = \sum_{t=1}^n r(\vx^\star) - r(\tilde \vx_{t,j})\\
    & = \sum_{t=1}^n r(\vx^\star) - \hat r_t(\vx^\star) + \hat r_t(\vx^\star) - \hat r_t(\tilde \vx_{t,j}) +\hat r_t(\tilde \vx_{t,j})-  r(\tilde \vx_{t,j})\\
    & \leq \sum_{t=1}^n \norm{ \vtheta_j - \hat \vtheta_{t,j}}_2 \left( \norm{\vphi_j(\vx^\star)}_2 + \norm{\vphi_j(\tilde \vx_{t,j})}_2\right) + \hat r_t(\vx^\star) - \hat r_t(\tilde \vx_{t,j})\\
    & \leq \sum_{t=1}^n  \omega(t, \delta, d)\left( \norm{\vphi_j(\vx^\star)}_2 + \norm{\vphi_j(\tilde \vx_{t,j})}_2\right) + \hat r_t(\vx^\star) - \hat r_t(\tilde \vx_{t,j})
\end{align*}
with probability $1-\delta$. 
If the agent selects actions greedily, then $\hat r_t(\vx^\star)  \leq \hat r_t(\tilde \vx_{t,j})$, and
\begin{align*}
    \tilde R_{j^\star}(n) \leq \sum_{t=1}^n  \omega(t, \delta, d)\left( \norm{\vphi_j(\vx^\star)}_2 + \norm{\vphi_j(\tilde \vx_{t,j})}_2\right) \leq \sum_{t=1}^n  2\omega(t, \delta, d)
\end{align*}
since the feature map is normalized to satisfy $\norm{\vphi_j(\cdot)}\leq 1$. If the agent selects actions optimistically according to the upper confidence bound of \cref{prop:CI_oracle}, then
\[
\hat r_t(\tilde \vx_{t,j}) + \omega(t, \delta, d)\norm{\vphi_j(\tilde \vx_{t,j})} \geq \hat r_t(\vx^\star) + \omega(t, \delta, d)\norm{\vphi_j(\vx^\star)}
\]
which implies
\[
\hat r_t(\vx^\star) - \hat r_t(\tilde \vx_{t,j})  \leq \omega(t, \delta, d)\norm{\vphi_j(\tilde \vx_{t,j})} - \omega(t, \delta, d)\norm{\vphi_j(\vx^\star)}
\]
and therefore,
\begin{align*}
    \tilde R_{j^\star}(n) \leq \sum_{t=1}^n 2 \omega(t, \delta, d) \norm{\vphi_j(\tilde \vx_{t,j})}_2 \leq \sum_{t=1}^n 2  \omega(t, \delta, d).
\end{align*}
Then due to \cref{prop:CI_oracle}, with probability greater than $1-\delta$, simultaneously for all $n \geq 1$,
{\small
\begin{align*}
    \sum_{t=1}^n \omega(t, \delta, d) & \leq \sum_{t=1}^n C_1 \sqrt{\tfrac{\sigma^2d\log\left(\tfrac{t}{\tilde\lambda d}+1\right) + 2\sigma^2\log(1/\delta) + \tilde\lambda B^2}{\tilde \lambda + \cmin t^{3/4}}}\left( 1+ t^{-3/8} \sqrt{\log(\tfrac{Md}{\delta}) + (\log\log t)_+}\right)\\
    % & \leq \sum_{t=1}^nC_1 \sqrt{\tfrac{\sigma^2d\log\left(\tfrac{n}{\tilde\lambda d}+1\right) + 2\sigma^2\log(1/\delta) + \tilde\lambda B^2}{\tilde \lambda + \cmin t^{3/4}}}\left( 1+ t^{-3/8} \sqrt{\log(\tfrac{Md}{\delta}) + (\log\log n)_+}\right)\\
    & \leq \tilde C_1n^{5/8}\sqrt{\tfrac{\sigma^2d\log\left(\tfrac{n}{\tilde\lambda d}+1\right) + 2\sigma^2\log(1/\delta) + \tilde\lambda B^2}{\cmin}}\left( 1+ \cmin^{-1}n^{\tfrac{-3}{8}} \sqrt{\log(\tfrac{Md}{\delta}) + (\log\log n)_+}\right)
\end{align*}
}
concluding the proof.
\end{proof}


