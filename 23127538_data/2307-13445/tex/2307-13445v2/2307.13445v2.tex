\documentclass[11pt]{amsart}
 \usepackage[foot]{amsaddr}
\usepackage[T1]{fontenc}
\numberwithin{equation}{section}

%Package block 

%\usepackage{natbib}
\usepackage{float}
\usepackage{tikz-cd}
\usepackage{amsmath}%
\usepackage{amsfonts}%
\usepackage{amsthm}
\usepackage{amssymb}%
\usepackage{graphicx}
%\usepackage{titling}
\usepackage{hyperref}


%\usepackage{natbib}
\usepackage{float}
\usepackage{tikz-cd}
\usepackage{amsmath}%
\usepackage{amsfonts}%
\usepackage{amsthm}
\usepackage{amssymb}%
\usepackage{graphicx}
%\usepackage{titling}
\usepackage{hyperref}
\usepackage{enumerate}
\usepackage{comment}



\usepackage{geometry}
%\usepackage{a4wide}
\usepackage{layout}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{graphicx}
\usepackage{url}
\usepackage{MnSymbol}
\usepackage{arydshln}
\usepackage{outlines}
\usepackage{tikz-cd}
\newcommand{\gp}{\mathfrak{p}}
\usepackage{subfig}
\usepackage{amsthm}

\newcommand{\Fbar}{\overline{\mathbb{F}}}
\newcommand{\gc}{\mathfrak{c}}
\newcommand{\gm}{\mathfrak{m}}
\newcommand{\gr}{\mathfrak{r}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\cA}{\mathcal{A}}
\newcommand{\cH}{\mathcal{H}}
\newcommand{\bZ}{\overline{Z}}
\newcommand{\cM}{\mathcal{M}}
\newcommand{\cS}{\mathcal{S}}
\newcommand{\cJ}{\mathcal{J}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\PGL}{\mathrm{PGL}}
\renewcommand{\O}{\mathcal{O}}
\renewcommand{\epsilon}{\varepsilon}
\newcommand{\R}{\mathbb{R}}
\renewcommand{\P}{\mathbb{P}}
\renewcommand{\H}{\mathbb{H}}
\newcommand{\cMbar}{\overline{\mathcal{M}}}
\renewcommand{\cJ}{\mathcal{J}}
\newcommand{\Jac}{\mathcal{J}}
\newcommand{\codim}{\mathrm{codim}}
\newcommand{\dirlim}{\varinjlim}
\newcommand{\invlim}{\varprojlim}
\renewcommand{\o}{\varnothing}
\newcommand{\Dmod}{Dieudonn\'e module}
\renewcommand{\o}{\varnothing}
\newcommand{\Car}{\mathcal{C}}
\newcommand{\Cl}{\mathrm{Cl}}
\newcommand{\GL}{\mathrm{GL}}
\newcommand{\Pic}{\mathrm{Pic}}
\newcommand{\Spec}{\mathrm{Spec}}
\newcommand{\Stab}{\mathrm{Stab}}
\newcommand{\Orbit}{\mathrm{Orbit}}
\newcommand{\rank}{\mathrm{rank}}
\newcommand{\coker}{\mathrm{coker}}
\newcommand{\im}{\mathrm{im}}
\newcommand{\Div}{\mathrm{Div}}
\newcommand{\Aut}{\mathrm{Aut}}
\newcommand{\End}{\mathrm{End}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\anum}{a\mathrm{-num}}
\newcommand{\prank}{p\text{-}\rank}
\newcommand{\tworank}{2\text{-}\rank}
\newcommand{\dd}{\mathrm{d}}
\usepackage{multirow}


\newcommand{\floor}[1]{\lfloor #1 \rfloor}
\newcommand{\blokje}{\hfill $\Box$\\}
\newcommand{\<}{\left \langle}
\renewcommand{\>}{\right \rangle}

\usepackage{xcolor}

%Preamble



\makeatletter
\newtheorem*{rep@thm}{\rep@title}
\newcommand{\newrepthm}[2]{%
\newenvironment{rep#1}[1]{%
 \def\rep@title{#2 \ref{##1}}%
 \begin{rep@thm}}%
 {\end{rep@thm}}}
\makeatother

\newtheorem{thmx}{Theorem}
\renewcommand{\thethmx}{\Alph{thmx}}


\newtheorem{thm}{Theorem}[section]


\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{conj}[thm]{Conjecture}
\newtheorem{que}[thm]{Question}

\newrepthm{thm}{Theorem}

\theoremstyle{definition}
\newtheorem{dfn}[thm]{Definition}
\newtheorem{ntn}[thm]{Notation} 
\newtheorem{ass}[thm]{Assumption}
\newtheorem{cons}[thm]{Consequence}

\theoremstyle{remark}
\newtheorem{rem}[thm]{Remark}
\newtheorem{exmp}[thm]{Example}




\begin{document}


\author{Du\v san Dragutinovi\'c}
\keywords{Curves, Jacobians, Ekedahl-Oort type, $\prank$, $a$-number}
\address{Mathematical Institute, Utrecht University, 3508 TA Utrecht, The Netherlands}
\email{d.dragutinovic@uu.nl}

\title[Ekedahl-Oort types of stable curves]{Ekedahl-Oort types of stable curves}

\maketitle

\begin{abstract}
We extend Moonen's definition of Ekedahl-Oort types of smooth curves in terms of Hasse-Witt triples to all stable curves and show that it matches Ekedahl and van der Geer's definition of Ekedahl-Oort types of their generalized Jacobians as semi-abelian varieties. Using this intrinsic insight, we can compute the dimensions of certain Ekedahl-Oort loci of curves and generalize some previously known results about the dimensions of the $\prank$ and $a$-number loci of curves.
\end{abstract}

\section{Introduction}
The purpose of this article is to extend Moonen's definition of the Ekedahl-Oort type of smooth curves in \cite{moonen} to all stable curves and to use the intrinsic description it gives us to present the full potential of the inductive technique of \cite[Theorem 2.3]{fabervdgeer}. Namely, we compute the bounds on the dimensions of Ekedahl-Oort loci satisfying certain technical conditions, and in particular, of all $\prank \leq f$ and $a$-number $\geq a$ loci of $\cMbar_g$, the moduli space of stable curves of genus $g$ in characteristic $p$.
So far, this technique has been used in \cite{fabervdgeer}, \cite{achterpries}, and \cite{pries_a_number} to describe and compute the dimensions of the components of the $\prank \leq f$ loci in $\cMbar_g$,  and to bound the dimensions of some of their $a$-number $\geq 2$ subloci; similarly in \cite{glasspries} and \cite{achterprieshe} in the context of hyperelliptic curves.  
Let us introduce some notation and briefly present the results.

 Let $k$ be an algebraically closed field of characteristic $p>0$ and $g\geq 2$.
For a principally polarized $g$-dimensional abelian variety $A$ over $k$, the $\prank$ of $A$ and the {$a$-number} of $A$, are the numbers $\prank(A)$ and $a(A)$, defined by 
$$\prank(A) = \dim_{\F_p}\Hom(\mu_p, A[p])\quad \text{and}\quad a(A) = \dim_k\Hom(\alpha_p, A[p]),$$ where $\mu_p$ and $\alpha_p$ are the kernels of the Frobenius morphism on respectively the multiplicative group $\mathbb{G}_m$ and the additive group $\mathbb{G}_a$.  The isomorphism class of the $p$-torsion group scheme $A[p]$ corresponds, for some $g\geq \mu_1 > \ldots > \mu_n > 0$,  to the Young diagram  $$\mu = [\mu_1, \mu_2, \ldots, \mu_n], $$ which we call the \textit{Ekedahl-Oort type} of $A$ and write $\mu(A) = \mu$. Note that $\prank(A) = g - \mu_1$ and $a(A) = n$. For a  smooth curve $C$, we can define these invariants in terms of the ones of its Jacobian $\Jac_C$: $\prank(C) = \prank(\Jac_C)$, $a(C) = a(\Jac_C)$, and $\mu(C) = \mu(\Jac_C)$.

Let $\cMbar_g$, $\cM^{ct}_g$, and $\cM_g$ be the moduli spaces of respectively stable genus-$g$ curves, stable genus-$g$ curves of compact type (i.e., stable genus-$g$ curves whose dual graph is a tree), and smooth genus-$g$ curves; we have the following inclusions $$\cMbar_g \supset \cM^{ct}_g\supset \cM_g.$$ 
The boundary $\cMbar_g - \cM_g$ consists of the components $\Delta_0, \Delta_1, \ldots, \Delta_{\left \lfloor \frac{g }{2} \right \rfloor}$ and $\cM_g^{ct}$ equals $\cMbar_g - \Delta_0$. The generic point of $\Delta_0$ corresponds to an irreducible curve $C_0$ with an ordinary double point, whose normalization $\Tilde{C}_0$ is a genus-$(g - 1)$ curve, while the generic point of $\Delta_i$ corresponds to a reducible curve with components of genus $i$ and $g - i$ for any $1\leq i \leq \left \lfloor \frac{g }{2} \right \rfloor$.  

Let $\cA_g$ be the moduli space of principally polarized $g$-dimensional abelian varieties. Attaching to a genus-$g$ stable curve of compact type $C$ its Jacobian variety $\Jac_C$ induces the Torelli morphism $j: \cM^{ct}_g \to \cA_g$. Lastly, we consider a fixed smooth toroidal compactification $\Tilde{\cA}_g$ of $\cA_g$, for which the Torelli morphism extends, e.g., as in \cite[Theorem 4.1]{alexeev}, to 
\begin{equation}
 j: \cMbar_g \to \Tilde{\cA}_g.
 \label{eqn:torelli}
\end{equation}
We write $\Jac_C$ for the image of a stable curve $C$ under  \eqref{eqn:torelli}, which is a generalized Jacobian. 

%By $\Jac_C$ we denote the generalized Jacobian of a stable curve $C$, i.e., its image under \eqref{eqn:torelli}.

An equivalent way to define the Ekedahl-Oort type of a smooth curve to the above-mentioned is via Hasse-Witt triples as Moonen did in \cite{moonen}; see Section \ref{subsec:eo_smooth}.  
For an arbitrary stable curve (or a finite union of smooth curves) $C$, we analyze the action
\begin{equation}
F: H^{1}(C, \O_C) \to H^{1}(C, \O_C)    
\label{eqn:Frob}
\end{equation}
 of the Frobenius operator
and observe that we can extend Moonen's definition to such $C$. On the other hand, in \cite{ekedahlvdgeer}, Ekedahl and van der Geer introduce the Ekedahl-Oort type of an arbitrary semi-abelian variety, and in particular, of the generalized Jacobian $\Jac_C$ of a stable curve $C$; their definition is a foundational one in this context. 
In Theorem \ref{thm:muCnorm}, we show the equivalence of these two definitions and find the following description.

\begin{thmx}
The definition of the Ekedahl-Oort type of a stable curve $C$ over $k$ via the Hasse-Witt triples extends the definition for smooth curves from Section \ref{subsec:eo_smooth}, and we get $\mu(C) = \mu(\Jac_C)$, with $\Jac_C$ the generalized Jacobian of $C$. Moreover, if $h: \Tilde{C} \to C$ is the normalization of $C$, we find that $\mu(C) = \mu(\Tilde{C})$. 
\label{thm:thmA}
\end{thmx}

For a Young diagram $\mu = [\mu_1, \ldots, \mu_n]$ with $g\geq \mu_1$, we denote by $Z_{\mu}$ the locus of principally polarized abelian (resp. semi-abelian) varieties $A$ with $\mu(A) = \mu$, by $\bZ_{\mu}$ its closure in $\cA_g$ (resp. in $\Tilde{\cA}_g$). This introduces the Ekedahl-Oort stratification of $\cA_g$ (resp. of $\Tilde{\cA}_g$); see \cite[Proposition 12.5]{oort} (resp. \cite[Section 5]{ekedahlvdgeer}). We can define the Ekedahl-Oort stratification of $\cMbar_g$ as the pullback of the one on $\Tilde{\cA}_g$ via the Torelli morphism \eqref{eqn:torelli}; we denote the corresponding Ekedahl-Oort strata $Z_{\mu}\cMbar_g$ and $\bZ_{\mu}\cMbar_g$. Due to our intrinsic description of this stratification, we obtain Theorem \ref{thm:main1}, which we present in Theorem \ref{thm:thmB} under a slightly less general assumption on $\mu$ for which its conclusion holds. Note that the loci $\bZ_{\mu}\cMbar_g$ defined by $\mu = [\mu_1, \mu_2, \mu_2 - 1, \ldots, 2, 1]$ are the loci of stable curves with $\prank \leq g - \mu_1$ and $a$-number $\geq \mu_2 + 1$.

\begin{thmx}
For any $g\geq \mu_1 > \mu_2 \geq 0$, let $\mu = [\mu_1, \mu_2, \mu_2 - 1, \ldots, 2, 1]$ be a Young diagram and let $d$ be the number defined by $3g - 3 -d = \max \{\dim\Gamma':\Gamma' \text{ a component of }\bZ_{\mu}\cMbar_g\}$. If $\Gamma$ is a component of $\bZ_{\mu}\cMbar_{g + 1}$ that meets $\Delta_0$, the codimension of $\Gamma$ in $\cMbar_{g + 1}$ is at least $d$.
\label{thm:thmB}
\end{thmx}

Theorem \ref{thm:main1} (presented here as Theorem \ref{thm:thmB}) generalizes the technique of \cite[Theorem~2.3]{fabervdgeer}, which was used to show that any component of the locus $V_f\cMbar_g$ of stable curves with $\prank \leq f$ in $\cMbar_g$ is of codimension at least $g - f$ in $\cMbar_g$. In particular, Theorem \ref{thm:main1} recovers \cite[Theorem~2.3]{fabervdgeer} for the choice $\mu = [g]$ (and using a purity result) and \cite[Proposition 3.7]{pries_a_number} for the choice $\mu = [g, 1]$. In Remarks \ref{rem:ordering}, \ref{rem:codim_d_general}, and \ref{rem:anymu_pured_nonempty}, we comment on the technical conditions appearing in Theorem \ref{thm:main1}. 
In particular, the assumption $\Gamma \cap \Delta_0 \neq 0$ is automatically satisfied if $g\geq \sum \mu_i$. Therefore, if we would know the upper bounds on the dimension of components of $\bZ_{\mu}\cMbar_{g'}$ for $\mu_1 \leq g' \leq \sum \mu_i$, we would get an upper bound on dimensions of \textit{all} the components of $\bZ_{\mu}\cMbar_g$ for \textit{any} $g > \sum \mu_i$.
%; see Examples \ref{exmp:32inGenus4} and  \ref{exmp:321inGenus4}, where we discuss this observation for the choices $\mu = [3, 2]$ and $\mu = [3, 2, 1]$. 


%In the absence of a purity result for the Ekedahl-Oort types, using 
%Since we are unaware of the existence of a purity result for the Ekedahl-Oort types, in general, 
%Theorem \ref{thm:main1}, 
%can only give us an upper bound on the dimension of certain Ekedahl-Oort loci. However, in some specific cases, 
%we can compute the exact dimensions of the components of $Z_{\mu}\cM_g = Z_{\mu}\cMbar_g \cap \cM_g$. 
A result by Pries, \cite[Theorem 6.4]{pries_current_results}, is that the existence of a non-empty component of $Z_{\mu}\cM_{g_0} = Z_{\mu}\cMbar_{g_0} \cap \cM_{g_0}$ of codimension $d = \sum \mu_i$ in $\cM_{g_0}$ implies the existence of a non-empty component of $Z_{\mu}\cM_g$ of codimension $d = \sum \mu_i$ in $\cM_g$, for any $g\geq g_0$.  Using Theorem \ref{thm:main1}, in Corollary \ref{cor:smootheoloci} we compute the dimension of all the components of some $Z_{\mu}\cM_g$. 
We comment on differences between  \cite[Theorem 6.4]{pries_current_results} and  Corollary \ref{cor:smootheoloci} in Remark \ref{rem:priessmootheo}, and indicate how one can combine them to describe all the components of $Z_{\mu}\cM_g$ in some cases.

The third main result of this article is a criterion we obtain in Theorem \ref{thm:he_implies_eo} and present below. In Proposition \ref{prop:eo_conclusion_char3}, we show its application in the case $p = 3$.

\begin{thmx}
Let $\mathrm{char}(k) = p>2$. If the locus of smooth hyperelliptic curves of genus $4$ over $k$ with Ekedahl-Oort type $[4, 3]$ is non-empty and finite, then all components of $V_0\cMbar_4$ (and thus of $V_{g-4}\cMbar_g$) have generic $a$-number $1$. Moreover, then $Z_{\mu}\cM_4$ is pure of codimension $\sum \mu_i$ in $\cM_4$ if non-empty, for any $\mu = [\mu_1]$ or $\mu = [\mu_1, \mu_2]$, with $1\leq \mu_1 \leq 4$ and $ 1\leq \mu_2 \leq 2$.
\label{thm:thmC}
\end{thmx}

Here is the outline of the paper. 
In Section \ref{sec:eo_types}, we present some equivalent ways to define the Ekedahl-Oort types of principally polarized abelian varieties and smooth curves and discuss their main properties. In Section \ref{sec:hwpart}, we introduce the Hasse-Witt partitions to combinatorially describe the action of the Frobenius operator on $H^{1}(C, \mathcal{O}_C)$ for a stable curve $C$. In Section \ref{sec:bdry}, we consider the Ekedahl-Oort types of semi-abelian varieties and stable curves, and using Moonen's Hasse-Witt triples, we obtain Theorem \ref{thm:muCnorm} (here Theorem \ref{thm:thmA}). Its intrinsic perspective offers us a way to prove Theorem \ref{thm:main1} (here Theorem \ref{thm:thmB}) in Section~\ref{sec:inductiveres}, where we also present Corollary \ref{cor:fvgdp} and comment on how they generalize some results from the literature and present Theorem \ref{thm:he_implies_eo} (here Theorem \ref{thm:thmC}). 
Finally, in Section~\ref{sec:exm}, we consider the loci $\bZ_{[4, 1]}\cMbar_4, \bZ_{[3, 2]}\cMbar_4, \bZ_{[3, 2]}\cMbar_5$, and $\bZ_{[3, 2, 1]}\cMbar_g$ for any $g\geq 3$, about which there were no results so far. We describe some of the cases in characteristics $p = 2, 3$ and give an idea of how to generalize the arguments to an arbitrary characteristic $p>0$. 


\subsection*{Acknowledgment}
The author is grateful to Carel Faber for all the discussions and valuable comments, to Valentijn Karemaker for the feedback and helpful remarks, and to Rachel Pries for insightful suggestions. The author is supported by the Mathematical Institute of Utrecht University. 

\section{Ekedahl-Oort types of abelian varieties}
\label{sec:eo_types}
In this section, we first recall the definition of the Ekedahl-Oort type of an arbitrary principally polarized abelian variety following \cite{oort} and \cite{vdgeercycle}. Then, we present its equivalent form in terms of the Dieudonn\'e modules and discuss Moonen's work on Hasse-Witt triples from \cite{moonen}. We define the Ekedahl-Oort type of a smooth curve as the Ekedahl-Oort type of its Jacobian and comment on equivalent ways of defining it. Finally, we comment on when an Ekedahl-Oort locus is contained in the closure of the other one in terms of elements of the Weyl group; we use this in Section \ref{sec:inductiveres} to explain the technical condition appearing in Theorem \ref{thm:main1}.

Let $A$ be a $g$-dimensional principally polarized abelian variety over an algebraically closed field $k$ of characteristic $p>0$, and let $\sigma: k \to k$ be the Frobenius morphism on $k$. Its first de Rham cohomology $H^1_{dR}(A)$ is equipped with $\sigma$- and $\sigma^{-1}$- linear operators $F$ and $V$, such that $FV = VF = 0$ and they are adjoints with respect to the symplectic form $\<\text{ }, \>$ on  $H^1_{dR}(A)$, i.e., $\<V\omega, \omega'\> = \<\omega, F\omega'\>.$ 

For any subspace $N \subseteq H_{dR}^1(A)$, it holds that $(VN)^{\perp} = F^{-1}(N^{\perp})$. Starting from the filtration $0 \subset H^1_{dR}(A)$ and adding the repeated images of $V$ as well as their orthogonal complements gives us the so-called \textit{canonical filtration}
$$0 \subset N_1' \subset \ldots \subset N_r' \subset N_{r + 1}' \subset \ldots \subset N_{2r}' = H^1_{dR}(A)$$
which stabilizes, and by construction satisfies $N_r' = V(N_{2r}')$ and $N_{r-i}'^{\perp} = N_{r+i}'$ for any $i$; see also \cite[Section 3.2]{ekedahlvdgeer}. One can further refine this to a \textit{final filtration} by choosing a maximal filtration that is stable under $V$ and $\perp$,
$$0 \subset N_1 \subset \ldots \subset N_g \subset N_{g + 1} \subset \ldots \subset N_{2g} = H^1_{dR}(A), $$
i.e., such that $V(N_{2g}) = N_g$ and $N_{g-i}^{\perp} = N_{g+i}$ for all $i$. 

The \textit{final type} of $A$ is the increasing surjective map $\nu: \{0, 1, \ldots, 2g\} \to \{0, 1, \ldots, g\}$ defined by 
\begin{equation}
\nu(i) = \dim_k V(N_i) 
\label{eqn:nu_def}
\end{equation}
and $\nu(0) = 0$ satisfying $\nu(2g - i) = \nu(i) - i + g$ for $0\leq i\leq g$. Using these properties, we can see that $\nu$ is determined by its values $\nu(i)$ for $1\leq i\leq g$, and hence, we will write it as $\nu = (\nu(1), \ldots, \nu(g))$  (and say that $\nu$ is of degree $g$). The final type of $A$ is unique. 

An alternative combinatorial description of the same property uses Young diagrams $\mu = \mu(A) = [\mu_1, \mu_2, \ldots, \mu_n]$ with $g\geq \mu_1 > \ldots \mu_n > 0$ defined in terms of $\nu = \nu(A)$ by 
\begin{equation}
\mu_j = \#\{i: 1\leq i\leq g \text{ and } j\leq i - \nu(i)\}.
\label{eqn:nu_to_mu}
\end{equation}
We can read off the $\prank$ and the $a$-number of $A$ from $\mu(A)$ as $$\prank(A) = g - \mu_1 \quad \text{and} \quad a(A) = n.$$ From this, one can also deduce the basic property $$1\leq \prank(A) + a(A) \leq g.$$ 


By the Ekedahl-Oort type of $A$, we refer to its Young diagram $\mu(A)$. Considering all $A$ in $\cA_g$ such that $\mu(A) = \mu$ defines the locally closed subsets $Z_{\mu}$ of $\cA_g$ called the Ekedahl-Oort strata. It is well known by \cite[Corollary 11.2]{oort} that $Z_{\mu}$ is pure of codimension $$\sum_{i = 1}^n \mu_i$$  in $\cA_g$. By \cite[Proposition 11.1]{oort}, if we introduce a partial ordering by $$\mu = [\mu_1, \ldots, \mu_n] \geq \mu'= [\mu'_1, \ldots, \mu'_m] \text{ if } n\leq m \text{ and } \mu_i \leq \mu_i' \text{ for all } 1\leq i\leq n, $$ for any $g$ as long as $g  \geq \max\{\mu_1, \mu_1'\}$, we get 
\begin{equation}
\mu' \leq \mu \quad \implies Z_{\mu'} \subseteq \bZ_{\mu} \text{ in } \cA_g.
\label{eq:finaltypes_EOclosure}    
\end{equation}
The reverse implication does not hold in general; see \cite[14.3]{oort} or \cite[page 611]{ekedahlvdgeer}. We comment more on the relations between the Ekedahl-Oort strata in {Section~ \ref{sec:weyl}}.  

A polarized Dieudonn\'e module over $k$ is a quadruple $(M, F, V, b)$, where \begin{itemize}
    \item $M$ is a $2g$-dimensional $k$-vector space;
    \item $F: M \to M$ is a $\sigma$-linear operator, while $V: M \to M$ is a $\sigma^{-1}$-linear operator;
    \item $\ker(F) = \im(V)$ and $\ker(V) = \im(F)$;
    \item $b: M\times M \to k$ is a polarization, i.e., a non-degenerate alternating bilinear form such that $b(F(x), y) = b(x, V(y))^p$ for all $x, y \in M$.
\end{itemize}
If we denote by $\mathbb{D}_A = \mathbb{D}(A[p])$ the (polarized) Dieudonn\'e  module of $A[p]$, \cite[Section~5]{oda} gives us that $$\mathbb{D}(A[p]) \cong H_{dR}^1(A).$$ More precisely, we take $M$ to be $H_{dR}^1(A)$ as a $k$-vector space, $F$ and $V$ the considered operators on $H_{dR}^1(A)$, while the polarization $b$ is defined by $\<\text{ }, \>$. The mentioned equivalence and what we presented above give us that we can refer to $\mathbb{D}_{A} = (M, F, V, b)$ as the Ekedahl-Oort type of $A$.

An important notion that Moonen introduced is the \textit{Hasse-Witt triple} over a perfect field $K$ of characteristic $p>0$, which is a triple $(Q, \Phi, \Psi)$ such that \begin{itemize}
    \item $Q$ is a finite-dimensional $K$-vector space;
    \item $\Phi: Q \to Q$ is a $\sigma$-linear map;
    \item $\Psi: \ker(\Phi) \overset{\cong}{\to} \im(\Phi)^{\perp}$ is a $\sigma$-linear bijective map; 
\end{itemize} 
where $\im(\Phi)^{\perp} = \{\lambda \in Q^{\vee}: \lambda(q) = 0 \text{ for all }q \in \im(\Phi)\}$ and $\sigma: K \to K$ is the Frobenius morphism on $K$. Here, we choose $K = k$ and recall the following result.  

\begin{thm}[{\cite[Theorem 2.8]{moonen}}]
There is a bijection $$\left\{ \begin{matrix} 
\text{ isomorphism classes of }\\ (M, F, V, b),\text{ } \dim_k(M) = 2g \end{matrix} \right \} \longleftrightarrow \left\{ \begin{matrix} 
\text{ isomorphism classes of }\\ (Q, \Phi, \Psi),\text{ } \dim_k(Q) = g \end{matrix} \right \}, $$
given by $(M, F, V, b) \mapsto (Q, \Phi, \Psi)$ where $Q = M/\ker F$, $\Phi = \Bar{F}:  Q\to Q$ is the map induced by $F$, and $\Psi(x) = b(-, F(x))$.
\label{thm:moonen}
\end{thm}
\begin{proof}
See \cite[2.5 and 2.6]{moonen} for constructing this bijection and its inverse.    
\end{proof}

\subsection{Ekedahl-Oort types of smooth curves} 
\label{subsec:eo_smooth}
Let $C$ be a smooth curve over $k$ and let $\Jac_C$ be its Jacobian. Using the above, we define the Ekedahl-Oort type of $C$ either as the isomorphism class of the Dieudonn\'e module $\mathbb{D}(\Jac_C[p])$ or as the Young diagram $$\mu(C) = \mu(\Jac_C).$$ We also say $\prank(C) = \prank(\Jac_C)$ and $a(C) = a(\Jac_C)$. Let us mention below some other equivalent ways to define the Ekedahl-Oort type of $C$. 

Note that by \cite[Section 5]{oda}, we have $\mathbb{D}(\Jac_C[p]) \cong H_{dR}^1(\Jac_C) \cong H_{dR}^1(C).$ Furthermore, by, e.g., \cite[Proposition 3.1]{kocktait}, we have the Hodge-de Rham short exact sequence $$0 \to H^0(C, \Omega_C^1) \to H_{dR}^1(C) \to H^{1}({C, \O_C}) \to 0, $$
and the operator $V$ on $H_{dR}^1(C)$ essentially acts as the Cartier operator $\Car$ on $ H^0(C, \Omega_C^1)$, i.e.,  $V(H_{dR}^1(C)) = H^0(C, \Omega_C^1)$ and $V\mid_{H^0(C, \Omega_C^1)} = \Car$. Using the preceding definitions, we can naturally define the Ekedahl-Oort type of $C$ using $V$ and $\perp$. 

Lastly, as Moonen observed in \cite{moonen}, we can take $Q$ to be $H^1(C, \O_C)$, $\Phi$ to be the Frobenius operator $F_C$  on $H^1(C, \O_C)$, and take $\Psi$ as above to define the Ekedahl-Oort type of $C$ via the Hasse-Witt triple $(Q, \Phi, \Psi)$ using the equivalence from Theorem \ref{thm:moonen}. 

\subsection{On the Weyl group and the inclusion of Ekedahl-Oort loci}
\label{sec:weyl}
Let $S_g$ be the symmetric group on $g$ letters, let $W_g$ be the Weyl group defined by 
$$W_{g} = \{\omega \in S_{2g}: \omega(i) + \omega(2g + 1 - i) = 2g + 1 \text{ for }i = 1, 2, \ldots, g\} \cong S_g \ltimes (\Z/2\Z)^{g}.$$ 
The length of an element $\omega \in W_g$ is the number $$l(\omega) = \#\{i < j \leq g: \omega(i)>\omega(j)\} + \#\{1 \leq j \leq g: \omega(i) + \omega(j)> 2g + 1\}.$$
For any $\omega \in W_g$, $\omega(i)$ determines $\omega(2g + 1 - i)$ for $1\leq i\leq g$, so we can write  $\omega = [a_1 a_2\ldots a_g]$ if $\omega(i) = a_i$, for $1\leq i\leq g$.
Let $\omega = [a_1a_2\ldots a_g]$ and $\omega' = [b_1b_2\ldots b_g]$. Using \cite[Lemma~2.1]{ekedahlvdgeer}, we write $\omega \leq \omega'$, which is the Bruhat-Chevalley order, if for all $1\leq i \leq d \leq g$, the $i$th largest element of $\{a_1, \ldots, a_d\}$ is $\leq$ the $i$th largest element of $\{b_1, \ldots, b_d\}$. 



Let $W_I = \{\omega \in W_g: \omega\{1, 2, \ldots, g\} = \{1, 2, \ldots, g\}\} \cong S_g$ be a subgroup of $W_g$ and note that $|W_g|/|W_I| = 2^g$. If we denote by $^IW$ and $W^{I}$ the sets of minimal length coset representatives of $W_I\backslash W_g$ and $W_g/W_I$, the map $\omega \mapsto \omega^{-1}$ is an order preserving bijection of $^IW$ and $W^{I}$ by \cite[page 260]{pinkwedhornziegler} (or \cite[Lemma 1.5]{wedhorn}). There is a one-to-one correspondence between the cosets in $W_I\backslash W_g$ and the final types $\nu$ (of degree $g$). It is
induced by the map $\omega \mapsto \nu_{\omega} = (\nu_{\omega}(1), \ldots, \nu_{\omega}(g))$, with $\nu_{\omega}(i) = i - \#\{a \leq g: \omega^{-1}(a)\leq i\}$, which depends only on the cosets; see \cite[page 575]{ekedahlvdgeer} for more details. For a Young diagram $\mu$ associated to $\nu$ by \eqref{eqn:nu_to_mu}, let $\omega_{\mu} \in {^{I}{W}}$ be such that  $\nu_{\omega_{\mu}} = \nu$. 

If $\omega_{0, I}\in W_I$ is the element defined by $\omega_{0, I}(i) = g + 1 - i$, $1 \leq i \leq g$, by \cite[Corollary~6.5]{wedhorn}, we get the following equivalence for any two Young diagrams $\mu$ and $\mu'$ and any $p>0$:
\begin{equation}
\text{there is }u \in W_I\text{ such that } u\cdot \omega_{\mu'}\cdot (\omega_{0, I}u\omega_{0, I}) \leq \omega_{\mu} \Leftrightarrow  
Z_{\mu'} \subseteq \overline{Z_{\mu}} \text{ in }\cA_g,  
\label{eqn:shuffle}
\end{equation}
This claim follows from \cite[Theorem 5.4]{wedhorn}; see \cite[Theorem 6.2]{pinkwedhornziegler} for the published reference. The element $u\cdot \omega_{\mu'}\cdot (\omega_{0, I}u\omega_{0, I})$ occurring in \eqref{eqn:shuffle} is called the \textit{shuffle} of $\omega_{\mu'}$.

\section{On Hasse-Witt partitions}
\label{sec:hwpart}
Let $k$ be an algebraically closed field of characteristic $p>0$, and write $\sigma: k \to k$ for the Frobenius morphism on $k$. Given a $g\times g$ matrix $H \in \mathrm{Mat}_{g\times g}(k)$ let us denote $$\rho_i = \rho_i(H) = \rank_k (H\cdot H^{\sigma}\cdot \ldots \cdot H^{\sigma^{i-1}}), $$ for any $i\geq 0$ (where $\rho_0 = g$). Motivated by \cite[Satz 11]{hassewitt}, we define $\delta_i = \rho_{i-1} - \rho_i$ for any $i\geq 1$. Note that $\delta_1\geq \delta_2\geq \ldots \delta_g \geq 0$. If $\delta_n \neq 0, \delta_{n+1} = 0$, we say that the partition $$\delta = \delta(H) = \delta_1\ldots \delta_n$$ is the Hasse-Witt partition associated with $H$. Conversely, we see that the numbers
\begin{equation}
\rho_j = f + \sum_{i = j + 1}^n \delta_i \quad \text{ for }\quad   0\leq j \leq n  
\label{eq:rho_delta}
\end{equation}
satisfy $\rho_{j - 1} - \rho_{j} = \delta_j$  and $\rho_0 = g.$

In the rest of this section, to the objects parametrized by $\cA_g$ and $\cMbar_g$, we will associate the partitions $\delta$ just as above, which we call the \textit{Hasse-Witt partition} $\delta$. Then, in the next section, following \cite[Section 5]{ekedahlvdgeer}, we consider a natural extension of this definition to $\Tilde{\cA}_g$ and observe that it behaves well with respect to $j: \cMbar_g \to \Tilde{\cA}_g$. 


\subsection{On Hasse-Witt partitions and $\cA_g$}
\label{subsection:hwAg}
Let $\delta = \delta_1\ldots\delta_n$, with $\delta_1\geq \delta_2\geq \ldots \geq \delta_n >0$, be a partition of $g - f$ into $n$ parts, for $g\geq 1$ and $0\leq f\leq g$, and $\rho_j$ for $0\leq j \leq n$ be as in \eqref{eq:rho_delta}. Consider a $g$-dimensional principally polarized abelian variety $A$ whose final type $\nu$  satisfies 
\begin{equation}
\nu(f + \sum_{i = j}^n\delta_i) = f + \sum_{i = j + 1}^n\delta_i,
\label{eq:deltanu}
\end{equation}
for any $j = 1, \ldots, n+1$; in other words, the final type of $A$ is of the form \begin{equation*}
     (\underbrace{1, 2, \ldots, f}_{f}, \underbrace{*, \ldots, *, f}_{\delta_n}, \underbrace{*, \ldots, *, f + \delta_n}_{\delta_{n-1}}, \underbrace{*, \ldots, *, f + \sum_{i = n-1}^n\delta_i}_{\delta_{n-2}}, \ldots,  \underbrace{*, \ldots, *, f + \sum_{i = 2}^n \delta_i}_{\delta_1});
\end{equation*} 
note that $\prank(A) = f$ by \eqref{eqn:nu_to_mu}. 

We say that a $g$-dimensional principally polarized abelian variety $A$ has \textit{Hasse-Witt partition} $\delta = \delta_1\ldots\delta_n$ if its final type $\nu = \nu(A)$ satisfies \eqref{eq:deltanu}. In other words, writing $N_g = V(H^{1}_{dR}(A))$ and using \eqref{eqn:nu_def}, we see that $$\delta(A) = \delta_1\ldots\delta_n \Longleftrightarrow \dim_k V^{j}(N_g) = \rho_j \text{ for all }0\leq j\leq n.$$

In Table \ref{tab:HWEO}, we show how the Hasse-Witt partitions $\delta$ of abelian varieties correspond to their Ekedahl-Oort types $\mu$ in some simple cases. For $g\geq 3$, not every Ekedahl-Oort type $\mu$ of a $g$-dimensional abelian variety $A$ can be completely determined only in terms of $\rank_k V^{j}|_{N_g}$ for $0\leq j \leq g$.

\begin{table}[H]
    \centering
    \begin{tabular}{cc}
    \begin{minipage}{.4\linewidth}
        \begin{tabular}{ |c|c|}
    \hline
\small{H-W partition} $\delta$ & \small{E-O type(s)}  $\mu$\\

 \hline
 $\delta = 1$ & $\mu = [1]$\\
 \hline
 \hline
 $\delta = 11$ & $\mu = [2]$\\
 \hline
 $\delta = 2$ & $\mu = [2, 1]$\\
 \hline
 \hline
 $\delta = 111$ & $\mu = [3]$\\
 \hline
 $\delta = 21$ & $\mu = [3, 1]$ or $[3, 2]$\\
 \hline
 $\delta = 3$ & $\mu = [3, 2, 1]$\\
 \hline
 
 \end{tabular}
    \end{minipage} &

    \begin{minipage}{.6\linewidth}
        \begin{tabular}{ |c|c|}
    \hline
\small{H-W partition} $\delta$ & \small{E-O type(s)}  $\mu$\\
 \hline
 $\delta = 1111$ & $\mu = [4]$\\
\hline
 $\delta = 211$ & $\mu = [4, 1]$ or $[4, 2]$\\
 \hline
 $\delta = 22$ & $\mu = [4, 3]$\\
 \hline
 $\delta = 31$ & $\mu = [4, 2, 1], [4, 3, 1],$ or $[4, 3, 2]$\\
 \hline
 $\delta = 4$ & $\mu = [4, 3, 2, 1]$\\
 \hline
  \end{tabular}
    \end{minipage} 
\end{tabular}

    \caption{Correspondence between some Hasse-Witt partitions and Ekedahl-Oort types}
    \label{tab:HWEO}
\end{table}

\begin{rem}
  In fact, given a partition $\delta = \delta_1\ldots\delta_n$, it is not hard to see that there are $\prod_{i = 1}^{n-1}{\delta_i \choose \delta_{i + 1}}$ Ekedahl-Oort types $\mu$ whose corresponding final types satisfy \eqref{eq:deltanu}. If we further choose $f = 0$, consider the Hasse-Witt partitions of $g$, and note that there are $2^{g - 1}$ different Ekedahl-Oort types of $g$-dimensional principally polarized abelian varieties with $\prank$ zero, we find a nice combinatorial identity for any $g \geq 1$: $$ \sum_{\delta \vdash g }\prod_{i = 1}^{|\delta| - 1} {\delta_{i} \choose \delta_{i + 1}} = 2^{g - 1}, $$ where the sum goes over all partitions $\delta$ of $g$ and $|\delta| = n$ if $\delta = \delta_1\ldots\delta_n$. 
   
\end{rem}


\subsection{On Hasse-Witt partitions and $\cMbar_g$}
\label{subsection:hwMg}
Let $C$ be either a stable curve or a union of smooth curves over $k$; see also Section \ref{subsec:hwstablecurves}. Denote by $F$ the Frobenius operator on $H^{1}(C, \O_C)$ as in \eqref{eqn:Frob} and let $\rho_i = \rho_i(C)$  be the rank (over $k$) of $F^i = F^{\circ i}$ for any $i\geq 1$ and $\rho_0 = \rho_0(C) = \dim_k H^{1}(C, \O_C)$. We define the \textit{Hasse-Witt partition} $\delta$ of $C$ as $$\delta(C) = \delta_1\ldots\delta_n, $$ where $\delta_i = \rho_{i - 1} - \rho_i$ for $1\leq i \leq g$ and $n$ is such that $\delta_n \neq 0$ and $\delta_{n + 1} = 0$. 

Let us now consider the case when $C$ is a smooth curve of genus $g$ over $k$ and show that, in this case, the notions introduced here and in Section \ref{subsection:hwAg} match.
\begin{prop}
Let $C$ be a smooth curve of genus $g$ over $k$ and let $\Jac_C$ be its Jacobian. If $\delta(C)$ is defined as above and $\delta(\Jac_C)$ is as in Section \ref{subsection:hwAg}, then $\delta(C) = \delta(\Jac_C)$.
\end{prop}

\begin{proof}
Denote by  $H = H_C = [F]$ its Hasse-Witt matrix, i.e., the matrix of Frobenius $F$ on $H^1(C, \O_C)$ and $M = [\Car]$ its Cartier-Manin matrix, i.e., the matrix of the Cartier operator $\Car$ acting on $H^0(C, \Omega^1_C)$ as in Section \ref{sec:eo_types}. The matrix of $F^m$ on $H^1(C, \O_C)$ is given by $$H^{(m)} = H\cdot H^{\sigma} \ldots H^{\sigma^{m -1}},$$ where $H^{\sigma^{i}}$ is the matrix obtained by raising each of the entries of $H$ to the power $p^{i}$. If we denote $\rho_m = \rho_m(C) = \rank_k H^{(m)}$ for $1\leq m \leq g$, and $\delta_i = \rho_{i - 1} - \rho_i$ for $0\leq i\leq g$, then the Hasse-Witt partition of $C$ equals $$\delta(C) = \delta_1\ldots\delta_n,$$ with $n$ such that $\delta_n \neq 0$ and $\delta_{n + 1} = 0$.  
Since the operators $F$ and $\Car$ are adjoint, we have $$M = (H^{\sigma^{-1}})^t \quad \text{and}\quad H = (M^{\sigma})^t;$$ for more details, see \cite{achterhowe}. Similarly, if $H^{(i)} = [\mathcal{F}^{\circ i}] = H\cdot H^{\sigma}\cdot \ldots\cdot H^{\sigma^{i-1}}$ and $M^{(i)} = [\Car^{\circ i}]$, then $$M^{(i)} = ({H^{(i)}}^{(\sigma^{-1})^i})^t\quad \text{ and }\quad H^{(i)} = ({M^{(i)}}^{\sigma^i})^t.$$ In particular, for any $i$ we have $$\rank_k M^{(i)} = \rank_k H^{(i)}.$$ Therefore, the partition $\delta$ associated with $C$ is exactly the one associated with $\Jac_C$, so the introduced notions match.
\end{proof}



\section{Going to the boundary}
\label{sec:bdry}
In this section, we first define the Hasse-Witt partition and then the Ekedahl-Oort type of an arbitrary semi-abelian variety or an arbitrary stable curve in terms of Hasse-Witt triples. We carefully prove that these definitions are equivalent to the ones in the literature.   

\subsection{Hasse-Witt partitions of stable curves}
\label{subsec:hwstablecurves}
Let first $A$ be a semi-abelian variety of dimension $g$ that is an extension of an abelian variety $A_0$ by a torus of toric rank $l$. In \cite[Section 5]{ekedahlvdgeer}, Ekedahl and van der Geer defined the final type $\nu_A$ of $A$ by 
\begin{equation}
  \nu_A(i + l) = \nu_{A_0}(i) + l, \quad \text{for any}\quad  0\leq i\leq g - l
  \label{eq:evdg_final_type_semiab}
\end{equation}
(and $\nu_A(i) = i$ for $1\leq 1\leq l$). 
Essentially, this introduces the Ekedahl-Oort loci on $\Tilde{\cA}_g$ that they study. 
Here, we define the Hasse-Witt partition of $A$ as follows.

\begin{dfn}
The Hasse-Witt partition of a semi-abelian variety $A$ that is an extension of an abelian variety $A_0$ by a torus of toric rank $l$ is $\delta(A) = \delta(A_0)$, where $\delta(A_0)$ is as in Section \ref{subsection:hwAg}.    
\end{dfn}

\noindent
By \eqref{eq:deltanu}, this definition naturally extends the one for abelian varieties and fits into Ekedahl and van der Geer's description \eqref{eq:evdg_final_type_semiab}. 

Recall that in Section \ref{subsection:hwMg} we introduced $\delta(C)$ for $C$ either a stable curve or a finite union of smooth curves. We are interested in the latter case because we would like to compute the Hasse-Witt partition (and later the Ekedahl-Oort type) of the normalization of a stable curve, which does not have to be connected. Furthermore, if $C$ is a union of smooth curves $C_i$ for $1\leq i \leq n$, we naturally have 
\begin{equation}
\Jac_C = \prod_{i = 1}^n \Jac_{C_i}.
\label{eqn:jac_disc}
\end{equation} 

Below, we show that the Hasse-Witt partitions of a stable curve $C$ and its (generalized) Jacobian $\Jac_C$ match. Furthermore, we find that the Hasse-Witt partition of $C$ coincides with the one of its normalization. Namely, we have the following results. 


\begin{prop}
Let $h: \Tilde{C} \to C$ be the normalization of a stable curve $C$ defined over an algebraically closed field $k$ of characteristic $p>0$. Then the Hasse-Witt partitions of $C$ and $\Tilde{C}$ coincide:  $$\delta(C) = \delta(\Tilde{C}).$$ 
Furthermore, under the Torelli morphism $j: \cMbar_g \to \Tilde{\cA}_g$, sending a stable curve of genus $g$ to its (generalized) Jacobian, we get $\delta(C) = \delta(\Jac_C)$.
\label{prop:deltaCnorm}
\end{prop}

\begin{proof}
   
Let $C$ be a stable curve with $n$ irreducible components and $m$ singular points, and let $h: \Tilde{C} \to C$ be its normalization. Similarly as in \cite{bouw}, we get the short exact sequence of sheaves $$0 \to \O_C \to h_{*}\O_{\Tilde{C}} \to Q \to 0, $$ with $Q = h_{*}\O_{\Tilde{C}}/\O_C $ the quotient sheaf; note that $Q$ is constant and supported at the nodes of $C$. The maps above are given by $$f \mapsto f\circ h \quad \text{and}\quad f' \mapsto (f'(P_1) - f'(P_2))_Q,$$ for  $P_1$ and $P_2$ the points over a node $Q$ of $C$. Taking the long exact sequence in cohomology, we get $$0 \to H^0(C, \O_C) \to H^0(\Tilde{C}, \O_{\Tilde{C}}) \to H^{0}(C, Q) \to H^1(C, \O_C) \to H^1(\Tilde{C}, \O_{\Tilde{C}}) \to H^{1}(C, Q) = 0. $$ Since $H^0(C, \O_C) = k$, $H^0(\Tilde{C}, \O_{\Tilde{C}}) = k^n$ and $H^{0}(C, Q) = k^m$, and noting that $l = 1 - n + m$ is the number of loops in $C$, we get the short exact sequence 
\begin{equation}
0 \to k^l \to H^1(C, \O_C) \to H^1(\Tilde{C}, \O_{\Tilde{C}}) \to 0,    
\label{eq:shortseq}
\end{equation}
which gives us the isomorphism of $k$-vector spaces $H^1(C, \O_C) \cong k^l\oplus H^1(\Tilde{C}, \O_{\Tilde{C}})$. Even more is true: consider the following diagram
\begin{center}
\begin{tikzcd}
0\arrow[r] & \O_C \arrow[r] \arrow[d, "F"] &  h_{*}\O_{\Tilde{C}} \arrow[r] \arrow[d, "F"] &  Q \arrow[r] \arrow[d, "F"] &  0\\
0\arrow[r] & \O_C \arrow[r]  &  h_{*}\O_{\Tilde{C}} \arrow[r]  &  Q \arrow[r]  &  0
\end{tikzcd}
\end{center}
and let us show that all the squares in it commute. Once we consider the stalks, we see that $F$ commutes with the integral closure for the left square since both $\O_{C, P}$ and $(h_*\O_{\Tilde{C}})_P$ are subrings of $k(C)$, and with the evaluation for the right one. Therefore, we obtain that 
\begin{equation}
H^1(C, \O_C) \cong k^l\oplus H^1(\Tilde{C}, \O_{\Tilde{C}})    
\label{eq:kFmods}
\end{equation}
is an isomorphism of $k[F]$-modules so that the iterations of the Frobenius respect sequence \eqref{eq:shortseq}. Since the Frobenius acts as a bijection on $k$, for any $i\in \Z_{>0}$ we get $$\rho_i(C) = \rho_i(\Tilde{C}) + l,$$ which  for $i = 1$ and $i = g$ recovers $a(C) = a(\Tilde{C})$ and $\prank(C) = \prank(\Tilde{C}) + l$, and moreover, is equivalent to $\delta(C) = \delta(\Tilde{C})$.

Finally, the second claim follows from the defining equality \eqref{eq:evdg_final_type_semiab} after we use \cite[Corollary 4.2]{oort:genjac} for the description of $\Jac_C$, the (generalized) Jacobian of $C$, as an extension of $\Jac_{\tilde{C}}$, by a torus of toric rank $l$, with $\Jac_{\tilde{C}}$ as in \eqref{eqn:jac_disc}.
\end{proof}


In particular, from now on, for either a semi-abelian $g$-dimensional variety or a stable genus-$g$ curve $X$ of Hasse-Witt type $\delta = \delta_1\ldots\delta_n$ defined as above, we can say that $$a(X) = \delta_1 \quad \text{and} \quad \prank(X) = g - \sum_{i = 1}^n\delta_i.$$ 
\subsection{Ekedahl-Oort types of stable curves}
Below, we describe the Ekedahl-Oort types intrinsically for stable curves in a way that matches Ekedahl and van der Geer's extension of the Ekedahl-Oort types to the boundary of $\Tilde{\cA}_g$. 
We consider Moonen's definition of the Ekedahl-Oort type of a smooth curve as in \cite{moonen}, described in Section \ref{sec:eo_types}, and observe that it extends to all stable curves. This gives us a nice description of the Ekedahl-Oort type of a stable curve $C$ in terms of its normalization $\Tilde{C}$.  

Let $A$ be a semi-abelian variety, which is an extension of an abelian variety $A_0$ by a torus of toric rank $l$. As we mentioned, one can follow Ekedahl and van der Geer's work in \cite{ekedahlvdgeer} and define by \eqref{eq:evdg_final_type_semiab} the final type of $A$; another way to express this is $$\mu(A) = \mu(A_0).$$
In terms of the Dieudonn\'e modules, one can define the Ekedahl-Oort type of $A$ as the isomorphism class of 
\begin{equation}
\mathbb{D}_A = (M, F, V, b)    
\label{dfneq:evdg_semiab}
\end{equation}
with $M = M_{l, \text{ord}}\oplus M_{A_{0}}$, $F = (F_{l, \text{ord}}, F_{A_{0}})$, $V = (V_{l, ord}, V_{A_{0}})$ and $b = b_{l, ord} + b_{A_0}$, where $$(M_{l, \text{ord}}, F_{l, \text{ord}}, V_{l, \text{ord}}, b_{l, \text{ord}})\cong (k\oplus k^{\vee}, \sigma, \sigma^{-1}, b_{ord})^{\oplus l}$$ is the polarized Dieudonn\'e module of any ordinary $l$-dimensional principally polarized abelian variety, and $$(M_{A_0}, F_{A_0}, V_{A_0}, b_{A_0})$$ the Dieudonn\'e module of $A_0$. We also write $$\mathbb{D}_A = \mathbb{D}_{l, \text{ord}}\oplus \mathbb{D}_{A_0}$$ to indicate that $\mathbb{D}_A$ is the direct sum of the Dieudonn\'e modules defined by the torus and $A_0$. It is not hard to see that this definition of the Ekedahl-Oort type of $A$ coincides with the one given by Ekedahl and van der Geer, which we point out below.

\begin{prop} Let $A$ be a $g$-dimensional semi-abelian variety which is an extension of an abelian variety $A_0$ by a torus of toric rank $l$. If $\mathbb{D}_A$ is defined as above, then the final type of $A$ is given by \eqref{eq:evdg_final_type_semiab}. 
\label{prop:semi_eo}
\end{prop}
\noindent
Using the equivalence of the notions, we also refer to $\mu(A)$ as the Ekedahl-Oort types of respectively $A$, for $A$ as above.

On the other hand, we introduce the Ekedahl-Oort type of a stable curve $C$ via the Hasse-Witt triples below. 

\begin{dfn}
The \textit{Hasse-Witt triple of }$C$, where $C$ is either a stable curve or a finite union of smooth curves over $k$, is the triple $(Q, \Phi, \Psi)$ over $k$ with 
\begin{itemize}
    \item $Q = H^{1}(C, \O_C)$,
    \item $\Phi = F_C$ the Frobenius operator on $H^{1}(C, \O_C)$, and
    \item  $\Psi: \ker(F) \overset{\cong}{\to} \im(F)^{\perp}$ a $\sigma$-linear bijective map. 
\end{itemize} 
\label{dfn:hw_stable}
\end{dfn}

Note that this is an intrinsic definition. This also gives us a way to define the Ekedahl-Oort type of a stable curve in an intrinsic way, as we do below.

\begin{dfn}
Let  $\mathbb{D}_C$ be the Dieudonn\'e module associated with the Hasse-Witt triple of $C$ by Theorem \ref{thm:moonen},  and denote by $\mu(C)$ the Young diagram associated with $\mathbb{D}_C$ as in Section \ref{sec:eo_types}. 
We say that the \textit{Ekedahl-Oort type} of $C$ is either the isomorphism class of $\mathbb{D}_C$,  or,  using the equivalence of notions, that it equals $\mu(C)$.

\label{dfn:eo_stable}
\end{dfn}

Consider a stable curve $C$ over $k$. In the theorem below, we show that the Ekedahl-Oort types of $\Jac_C$ as introduced in \eqref{dfneq:evdg_semiab} (which is the same as the way Ekedahl and van der Geer define it by Proposition \ref{prop:semi_eo}) and of $C$ as in Definition \ref{dfn:eo_stable} match. Furthermore, we find a nice description of the Ekedahl-Oort type of $C$ in terms of the one of its normalization. Namely, we have the following result. 

\begin{thm}
Let $h: \Tilde{C} \to C$ be the normalization of a stable curve $C$ over $k$. Definitions~\ref{dfn:hw_stable} and ~\ref{dfn:eo_stable} are correct, they extend the definition for smooth curves from Section~~\ref{subsec:eo_smooth}, and we have  $$\mu(C) = \mu(\Tilde{C}).$$ 
Furthermore, under the Torelli morphism $j: \cMbar_g \to \Tilde{\cA}_g$, sending a stable genus-$g$ curve to its (generalized) Jacobian, we get $\mu(C) = \mu(\Jac_C)$.
\label{thm:muCnorm}
\end{thm}

\begin{proof}
First, for $C$ a smooth curve, we know that the Ekedahl-Oort type of $C$ and its Jacobian $\Jac_C$ coincide, and Moonen's work in \cite{moonen} tells us thus that the Dieudonn\'e module $(\mathbb{D}(\Jac_C[p]), F, V, b)$ corresponds to the Hasse-Witt triple $$(H^1(C, \O_C), \Phi_C, \Psi_C)$$ for $\Phi_C = F_C$ the Frobenius operator on $H^1(C, \O_C)$ and $\Psi_C: \ker(F_C) \to \im(F_C)^{\perp}$ the $\sigma$-linear bijection. As Moonen observes in \cite[2.5]{moonen}, $\im(F_C)^{\perp} = \coker (F_C)^{\vee}$, so we can and will think of $\Psi_C$ as a fixed $\sigma$-linear bijection $\Psi_C: \ker(F_C) \to  \coker (F_C)^{\vee}$.

Let $C$ now be an arbitrary stable curve with $n$ irreducible components and $m$ singular points, let $l = 1 - n + m$ (be the number of \textit{loops} in $C$), and recall that we understand $H^1(C, \O_C)$ as a $k[F_C]$-module by \eqref{eq:kFmods} and Proposition \ref{prop:deltaCnorm}. Giving a $\sigma$-linear bijection $$\Psi_C:  \ker(F_C) \to \coker(F_C)^{\vee}$$ only depends on $H^1(\Tilde{C}, \O_{\Tilde{C}})$ and $\Psi_{\Tilde{C}}$: since $F_C$ on $k$ coincides with $\sigma$ and is a bijection, we can consider the following diagram
\begin{center}
\begin{tikzcd}
\ker(F_C) = 0^{\oplus l}\oplus \ker(F_{\Tilde{C}})   \arrow[rr, "\cong"] \arrow[d, "\Psi_{C}"]                                                                                          &  & \ker(F_{\Tilde{C}}) \arrow[ "\Psi_{\Tilde{C}}", d]                                                                                       \\
{\coker(F_C) = \frac{k^{\oplus l}\oplus H^{1}(\Tilde{C}, \O_{\Tilde{C}})}{\sigma(k)^{\oplus l}\oplus F_{\Tilde{C}}(H^{1}(\Tilde{C}, \O_{\Tilde{C}}))} } \arrow[rr, "\cong"] &  & {\frac{H^{1}(\Tilde{C}, \O_{\Tilde{C}})}{F_{\Tilde{C}}(H^{1}(\Tilde{C}, \O_{\Tilde{C}}))} = \coker(F_{\Tilde{C}}) }
\end{tikzcd}    
\end{center} 
where the top and the bottom isomorphisms exist and are fixed, so that $\Psi_{\Tilde{C}}$ defines $\Psi_{C}$ in a unique way. 
Now, note that $\Psi_{C_i}$ exists as a $\sigma$-linear bijection for each component $C_i$ of $\Tilde{C}$ and that $\Psi_{\Tilde{C}}$ is defined by the collection $(\Psi_{C_i})_i$. In particular, $\Psi_{C}$ exists so that the Ekedahl-Oort type of $C$ is well-defined and the given description tells us that the Dieudonn\'e module of $C$ is the direct sum $$\mathbb{D}_{l, \text{ord}}\oplus \bigoplus_{i = 1}^n \mathbb{D}_{i},$$ where $\mathbb{D}_i$ is the Dieudonn\'e module of $C_i$, so that $$\mu(C) = \mu(\Tilde{C}).$$ Finally, by \cite[Corollary 4.2]{oort:genjac}, we have that $\Jac_C$ is an extension of $\Jac_{\Tilde{C}} = \prod_{i = 1}^n\Jac_{C_i}$ by a torus of toric rank $l$, so that $\mu(C) = \mu(\Jac_C)$ follows as well.   
\end{proof}

\begin{rem}
Let us point out that the information about the loops of a stable curve (or equivalently, the toric part of its generalized Jacobian) in the Hasse-Witt triple is fully described by the operator $\Phi = F$, while $\Psi$ only depends on its normalization since $F$ acts as a bijection on $k$. Taking into account Proposition \ref{prop:deltaCnorm}, one can also see Theorem \ref{thm:muCnorm} as its refinement by the  map $\Psi$. In other words, one can distinguish different $\mu$'s defined by a  fixed type $\delta$ as in \eqref{eq:deltanu}, which indeed was one of the intentions of the definition of a Hasse-Witt triple in \cite{moonen}. 
\end{rem}

\begin{rem}
Let $A = \prod_{i = 1}^nA_i$ be a principally polarized abelian variety, e.g., $A = \prod_{i = 1}^n\Jac_{C_i}$, as in the proof of Theorem \ref{thm:muCnorm}. 

For any  $1\leq i\leq n$, let $\delta(A_i) = \delta^{(i)}_1\ldots\delta^{(i)}_{N_i}$ be the Hasse-Witt partition of $A_i$ and let $N = \max\{N_i: 1\leq i\leq n\}$. The advantage of using the Hasse-Witt partitions is that the description from Section \ref{sec:hwpart} gives us that the Hasse-Witt partition of $A$ equals $$\delta(A) = \delta_1\ldots\delta_N,$$ where $\delta_j = \sum_{i = 1}^n\Tilde{\delta}^{(i)}_j$, with $\Tilde{\delta}^{(i)}_j = \delta_{j}^{(i)}$ if $1\leq j\leq N_i$ and $\Tilde{\delta}^{(i)}_j = 0$ if $N_i + 1\leq j\leq N$. 

In general, we are not aware of a straightforward combinatorial description of $\mu(A)$ in terms of $\mu(A_i)$ for $1\leq i \leq n$. However, note that the collection of $\mu(A_i)$ for $1\leq i\leq n$ uniquely determines $\mu(A)$ and that $\mu(A)$ can be  computed  explicitly using \cite[9.1]{oort}. Similarly, for $C = \cup_{i = 1}^n C_i$ a finite union of smooth curves $C_i$, we can compute $\mu({C})$ in terms of $\mu(C_i)$ for $1\leq i\leq n$. 
\end{rem}

\section{Inductive results}
\label{sec:inductiveres}

Using what was observed in Section \ref{sec:bdry}, we get an inductive result telling us how the dimensions of components of certain $\bZ_{\mu}\cMbar_{g+1}$ that intersect the divisor $\Delta_0$ depend on the dimensions of the components of $\bZ_{\mu}\cMbar_{g}$. We present it below and show how it generalizes some well-known inductive results about the $\prank$ and $a$-number stratifications of $\cMbar_g$.  

Throughout this section, we use that $\cMbar_g$ and $\cA_g$ are smooth stacks so that the codimension of an intersection of two of their closed subvarieties is the sum of the codimensions at most.  We denote $j(\cM_g^{ct}) = \cJ_g$ and $j(\cM_g) = \cJ_g^0 \subset \cJ_g.$ Furthermore, we denote by $\cMbar_{g, n}$ the moduli space of $n$-pointed stable curves of genus $g$, and we use $\kappa$ as the notation for any of the finite clutching morphisms; see \cite[Section 3]{knudsen}. For example,  $$\kappa_{1, 1}: \cMbar_{g, 1} \times \cMbar_{g', 1} \to \cMbar_{g + g'}$$ is obtained by identifying the labeled points on a stable genus-$g$ curve $C$ and a stable genus-$g'$ curve $C'$, while $$\kappa_{2}: \cMbar_{g - 1, 2}  \to \cMbar_{g}$$ is obtained by identifying the labeled points on a stable genus-$(g - 1)$ curve $C$.
For any $n\geq 1$, by $Z_{\mu}\cMbar_{g, n}$ we denote the inverse image of $Z_{\mu}\cMbar_g$ under the forgetful morphism $\cMbar_{g, n} \to \cMbar_g$ and we write  $Z_{\mu}\cM_g = Z_{\mu}\cMbar_g \cap \cM_g$.

Fix $g \geq 2$ and let $\mu$ and $\mu'$ be two Young diagrams. We have seen in Section \ref{sec:weyl} that we can deduce whether there is an inclusion $ Z_{\mu'} \subseteq \bZ_{\mu}$ of the Ekedahl-Oort loci in $\cA_g$ by looking at the combinatorial description given by \eqref{eqn:shuffle}. This description involves certain relations between elements in the Weyl group $W_g$ (and the so-called shuffles). By \cite[page 599]{ekedahlvdgeer}, there is an injective group homomorphism $\rho: W_{g} \to W_{g + 1}$, which respects the Bruhat-Chevalley order and the shuffling. Therefore, it respects \eqref{eqn:shuffle}, so we can see that  
$ Z_{\mu'} \subseteq \bZ_{\mu}$ in $\cA_{g}$ implies  $Z_{\mu'} \subseteq \bZ_{\mu}$  in $\cA_{g + 1}$ for any $g$. On the other hand, let us consider the condition that \textit{Young diagram $\mu$ satisfies}
\begin{equation}
    Z_{\mu'} \subseteq \bZ_{\mu} \text{ in } \cA_{g + 1} \implies Z_{\mu'} \subseteq \bZ_{\mu} \text{ in } \cA_{g} \text{ for each }\mu'  = [\mu_1', \ldots, \mu_{n'}']\text{ with } \mu_1' < g + 1.
\label{eqn:technical_cond}
\end{equation}
Note that \eqref{eqn:shuffle} essentially depends on $g$ and the structure of $W_g$. Namely, the condition that $Z_{\mu'} \subseteq \bZ_{\mu}$  in $\cA_{g + 1}$ is given by a relation in $W_{g + 1}$ involving shuffles of elements in $W_{g + 1}$, while the condition $Z_{\mu'} \subseteq \bZ_{\mu}$  in $\cA_{g}$ is described in terms of the elements of $W_g$. Therefore, \eqref{eqn:technical_cond} is, a priori, non-trivial.
Because of this, to present Theorem \ref{thm:main1} in full generality, we have to be careful and consider only the situation when this condition holds. 
Below, we mention some cases when \eqref{eqn:technical_cond} is automatically satisfied. 

\begin{rem} Note that   \eqref{eqn:technical_cond} is satisfied for all $\mu$ such that $\bZ_{\mu} = \cup_{\mu'\leq \mu} Z_{\mu'}$ in $\cA_{g + 1}$ with $g\geq \mu_1$; see \eqref{eq:finaltypes_EOclosure}.
Using \cite[Proposition 12.5]{oort}, we find that for any Young diagram 
\begin{equation}
\mu = [\mu_1, \underbrace{\mu_2, \mu_2 - 1, \ldots, 2, 1}_{\mu_2}]   
\label{eqn:mu_prank_anum_great}
\end{equation}
with $\mu_1 > \mu_2 \geq 0$ and for any $g\geq \mu_1$, it holds that $\bZ_{\mu} = \cup_{\mu'\leq \mu} Z_{\mu'}$ in $\cA_{g}$.  
This follows from the fact that $\bZ_{\mu}$ defines the closed locus of principally polarized abelian varieties with $\prank \leq g - \mu_1$ and $a$-number $\geq 1 + \mu_2$; for more details, see \cite[Corollary 1.5]{oort_subv} and \cite[page 44]{koblitz}. Therefore, for $\mu$ as in $\eqref{eqn:mu_prank_anum_great}$, technical condition \eqref{eqn:technical_cond} is automatically satisfied for any $g$, as long as $g \geq \mu_1$.
\label{rem:ordering}
\end{rem}

Now that we commented on the technical conditions appearing in it, we can present our second main result, which relies on the intrinsic nature of Definition \ref{dfn:eo_stable} and Theorem \ref{thm:muCnorm}, and shows the full potential of technique used in the proof of \cite[Theorem 2.3]{fabervdgeer}.

\begin{thm}
For any $g\geq \mu_1$, let $\mu = [\mu_1, \ldots, \mu_n]$ be a Young diagram such that \eqref{eqn:technical_cond}, and let $d$ be the number defined by $3g - 3 -d = \max \{\dim\Gamma':\Gamma' \text{ a component of }\bZ_{\mu}\cMbar_g\}$. If $\Gamma$ is a component of $\bZ_{\mu}\cMbar_{g + 1}$ that meets $\Delta_0$, the codimension of $\Gamma$ in $\cMbar_{g + 1}$ is at least $d$.
\label{thm:main1}
\end{thm}
\begin{proof}
Let $C$ be any stable curve that corresponds to a point of $\Gamma\cap \Delta_0 \neq \o$ and denote by $\mu' = [\mu_1', \ldots, \mu_{n'}']$ its Ekedahl-Oort type. Note that $\mu'$ satisfies $Z_{\mu'} \subseteq \bZ_{\mu}$ in $\cA_{g + 1}$.
Furthermore, recall that $\Delta_0 = \kappa_2(\cMbar_{g, 2})$ and note that $\mu'_1 < g + 1$ since the $\prank$ of a curve lying in $\Delta_0$ has to be at least $1$, while $\prank(C) = g + 1 - \mu_1'$.

Now, Theorem \ref{thm:muCnorm} implies that the normalization of any such singular curve $C$ with Ekedahl-Oort type $\mu'$ has Ekedahl-Oort type $\mu'$ as well. By the assumption, i.e., by \eqref{eqn:technical_cond},  $Z_{\mu'} \subseteq \bZ_{\mu} \text{ in } \cA_{g + 1}$ implies  $Z_{\mu'}\subseteq \bZ_{\mu}$ in $\cA_g$, and therefore, $$\Gamma\cap \Delta_0\subseteq \kappa_2(\bZ_{\mu}\cMbar_{g, 2}).$$ In particular, this gives us that $$\dim \Gamma  \leq \dim ({\Gamma}\cap \Delta_0) + 1 \leq  (3g - 3 -d + 2) + 1 = 3(g + 1) - 3  - d.$$ In other words, the codimension of $\Gamma$ in $\cMbar_{g + 1}$ is at least $d$. 
\end{proof}

In the remarks below, we further comment on the preceding theorem.

\begin{rem}
Note that $\Gamma \cap \Delta_0 \neq \o$ in Theorem \ref{thm:main1} is \textit{automatically} satisfied if $g \geq \sum \mu_i$. This follows from the Diaz-Looijenga bound and we discuss this in Proposition \ref{prop:loopscomplete}. Furthermore, note that a chain of $g$ supersingular elliptic curves is a superspecial stable curve, i.e., a stable curve with Ekedahl-Oort type $[g, g-1, \ldots, 2, 1]$. Therefore, we find that $\bZ_{\mu}\cMbar_g$ is always non-empty, using that $Z_{[g, g-1, \ldots, 2, 1]}\cMbar_g \subseteq \bZ_{\mu}\cMbar_g$, but $Z_{\mu}\cMbar_g$ might be empty. 
\label{rem:codim_d_general}
\end{rem}

\begin{rem} We have the following observations about the number $d$ from Theorem \ref{thm:main1}.
\begin{enumerate}
    \item In principle, we could formulate Theorem \ref{thm:main1} in a way that it holds for any Young diagram $\mu$, but then, we would have to define $d$ as $3g - 3 - \max\{\dim \Gamma'\}$ for $\Gamma'$ either a component of $\bZ_{\mu}\cMbar_g$ or a component of $\bZ_{\mu'}\cMbar_g$ for each $\mu'$ for which the implication in \eqref{eqn:technical_cond} does not hold.
    \item It will usually be enough to have a slightly less general assumption that  $\bZ_{\mu}\cMbar_g$ is pure of codimension $d$ in $\cMbar_g$  in Theorem \ref{thm:main1}, instead of choosing $d$ to be the smallest codimension of $\Gamma'$ in $\cMbar_g$ from the set of all components $\Gamma'$  of $\bZ_{\mu}\cMbar_g$.
\end{enumerate}
\label{rem:anymu_pured_nonempty}
\end{rem}

\begin{rem}
Note that Theorem \ref{thm:thmB} from the introduction follows from Theorem \ref{thm:main1} for the choice of $\mu$ as in \eqref{eqn:mu_prank_anum_great}. In Remark \ref{rem:ordering}, we clarify why such a $\mu$ satisfies condition \eqref{eqn:technical_cond}, and we use this observation below without further comment.
\end{rem}

Let $V_f\cMbar_g = \bZ_{[g - f]}\cMbar_g$ be the locus of stable curves of genus $g$ with $\prank$ at most $f$. Note that its sublocus consisting of stable curves with $a$-number at least $2$ is $\bZ_{[g - f, 1]}\cMbar_g$.
As a consequence of the preceding theorem, we reprove some results about the $p$-rank loci obtained by Faber and van der Geer in  \cite{fabervdgeer} and by Pries in \cite{pries_a_number}.

\begin{cor} The following results hold. 
\begin{enumerate}
    \item \cite[Theorem 2.3]{fabervdgeer} For any $g\geq 2$ and $0\leq f \leq g$, the locus $V_f\cMbar_g$ is pure of codimension $g - f$ in $\cMbar_g$.
    \item \cite[Proposition 3.7]{pries_a_number} Let $g_0 \geq 2$ and $0\leq f_0 \leq g_0$. If every generic point of $V_{f_0}\cMbar_{g_0}$ has $a$-number $1$ then for any $g> g_0$ and $f = g - (g_0 - f_0)>0$, any generic point of $V_{f}\cMbar_{g}$ has $a$-number $1$.
\end{enumerate}
\label{cor:fvgdp}
\end{cor}

\begin{proof}
For part $1$, if $f \leq g - 2$, in our unified framework, we take $$\mu = [g - f]$$ and note that $V_0\cMbar_{g- f} = \bZ_{\mu}\cMbar_{g - f}$ is pure of codimension $g - f$ in $\cMbar_{g - f}$ (as a complete subset of $\cM_{g - f}^{ct}$ and since $V_0\cA_{g - f}$ is of codimension ${g - f}$ in $\cA_{g - f}$). 
A purity result (\cite[Lemma 2.1]{fabervdgeer} as a variant of \cite[Lemma 1.6]{oort_subv}) gives that the codimension in $\cMbar_g$ of any component $\Gamma$ of $$V_f\cMbar_{g} = \bZ_{\mu}\cMbar_{g}$$ is at most $g - f<g$. On the other hand, Theorem \ref{thm:main1} and induction on $g$ with $g - f$ fixed (since $V_1\cMbar_{g- f + 1} = \bZ_{\mu}\cMbar_{g - f + 1}, V_2\cMbar_{g- f + 2} = \bZ_{\mu}\cMbar_{g - f + 2},$ etc.) using Remark \ref{rem:codim_d_general} for $\Gamma \cap \Delta_0 \neq \o$ for any $\Gamma$ as above, imply that its  codimension in $\cMbar_{g}$ is at least $g - f$. 

The result for $f = g$ is immediate, while for $f = g - 1$ follows in a similar manner using $\mu = [1]$ and $V_1\cMbar_2 = \bZ_{[1]}\cMbar_2$ as the base case of induction.

For part $2$, we use induction on $g$ with $g - f = g_0 - f_0$ fixed and take $$\mu = [g_0 - f_0, 1].$$ Note that the assumption that every generic point of $V_{f_0}\cMbar_{g_0}$ has $a$-number $1$ is equivalent to the assumption that any component of $\bZ_{\mu}\cMbar_{g_0}$ has codimenion at least $g_0 - f_0 + 1$ in $\cMbar_{g_0}$. 
If $\Gamma$ is a component of $V_f\cMbar_g$ with generic $a$-number at least $2$, then it is a component of $\bZ_{\mu}\cMbar_g$. Part $1$ gives us that the codimension of $\Gamma$ in $\cMbar_g$ is $g_0 - f_0$. Since $g_0 - f_0 = g - f < g,$ we find that $$\Gamma \cap \Delta_0 \neq \o$$ by the Diaz-Looijenga bound in Remark \ref{rem:codim_d_general}. However, we can then use Theorem $\ref{thm:main1}$ to get that the codimension of $\Gamma$ in $\cMbar_g$ is at least $g_0 - f_0 + 1$. This is a contradiction, so such a $\Gamma$ cannot exist.   
\end{proof}

Let us now see an application of how one can compute the exact dimensions of certain components of $\bZ_{\mu}\cM_g$ consisting of smooth curves, and not only their upper bounds. With $\Delta_{0, l}$ we denote the codimension $l$ locus of stable curves with at least $l$ loops in $\cMbar_g$, i.e., $\Delta_{0, l} = \kappa_{2l}(\cMbar_{g - l, 2l})$; for example, $\Delta_{0, 1} = \Delta_0$. 



\begin{cor}
Let $\mu_1, g_0$, and $g$ be integers such that $\mu_1\leq g_0 \leq g$, let $\mu = [\mu_1, \ldots, \mu_n]$ be a Young diagram and let $d = 3g - 3 - \max \{\dim\Gamma':\Gamma' \text{ a component of }\bZ_{\mu}\cMbar_g\}$.
Assume that  $d = \sum \mu_i$ and that for all $\mu' = [\mu_1', \ldots, \mu_{n'}']$ with $\mu_1' < g_0 + 1$, $$Z_{\mu'} \subseteq \bZ_{\mu} \text{ in } \cA_{g} \implies Z_{\mu'} \subseteq \bZ_{\mu} \text{ in }\cA_{g_0}.$$ 
If $\Gamma$ is a component of $\bZ_{\mu}\cM_{g}$ whose closure $\overline{\Gamma}$ in $\cMbar_g$ satisfies $\overline{\Gamma}\cap \Delta_{0, l} \neq \o$, then the codimension of $\Gamma$ in $\cM_g$ equals $d = \sum \mu_i$.
\label{cor:smootheoloci}
\end{cor}

\begin{proof}
Since $\overline{j(\Gamma)}$ is a component of $\cJ_g \cap \bZ_{\mu} \subseteq \cA_g,$ its codimension in $\cJ_g$ is at most $d$, and we get that $\Gamma$ is of codimension at most $d$ in $\cM_g$. On the other hand, the dimension of $\Gamma$ is at most $$\dim (\Gamma \cap \Delta_{0, l}) + l = \dim \kappa_{2l}(\bZ_{\mu}\cMbar_{g_0, 2l}) + l = 3g_0 - 3 + 2l - d + l = 3g - 3 - d,$$ i.e., $\Gamma$ is of codimension at least $d$ in $\cM_g$.  Therefore, the codimension of $\Gamma$ in $\cM_g$ has to be exactly $d = \sum \mu_i$. 
\end{proof}

In the following remark, we compare the preceding corollary and \cite[Theorem 6.4]{pries_current_results}.

\begin{rem}
In addition to the preceding corollary, and keeping the notation, note that  Pries in \cite[Theorem 6.4]{pries_current_results} obtains that the existence of a non-empty component $\Gamma_0$ of $Z_{\mu}\cM_{g_0}$ of codimension $d = \sum \mu_i$ in $\cM_{g_0}$ implies the existence of a non-empty component $\Gamma$ of $Z_{\mu}\cM_{g}$, which is of codimension $d = \sum \mu_i$ in $\cM_g$ for any $g\geq g_0$. 


In particular, for $\mu = [\mu_1, \ldots, \mu_n]$ and any $g\geq \max\{2, \mu_1\}$,  \cite[3.3.1, 3.3.2, and Theorem 6.4]{pries_current_results} tell us that $Z_{\mu}\cM_{g}$ has a non-empty component of the expected dimension in characteristic $p$ in the following cases:
\begin{enumerate}
    \item $\mu  \in \{[1], [2], [3], [3, 1]\}$ for any prime $p>0$, 
    \item $\mu = [2, 1]$, for $g = 2$, $p>3$  or $g \geq 3$, $p>0$, or
    \item $\mu  \in \{[3, 2], [3, 2, 1]\}$ and $p>2$.
\end{enumerate} 
\label{rem:priessmootheo}
See also \cite[Theorem 5.12]{oort_hess}, especially for the case $g = 3$ and $\mu = [3, 2, 1]$.

Let us mention the differences between \cite[Theorem 6.4]{pries_current_results} and Corollary \ref{cor:smootheoloci} assuming all the necessary technical conditions on $\mu$ with $d = \sum \mu_i$ and $g = g_0 + 1$; note that the hypotheses of \cite[Theorem 6.4]{pries_current_results} and Corollary \ref{cor:smootheoloci} are slightly different. 
By the construction in \cite[Theorem 6.4]{pries_current_results}, each $\Gamma_0$ as above gives us a $\Gamma$ whose closure in $\cMbar_g$
contains the image of $$\cMbar_{1, 1}\times \Gamma_0'$$ under the clutching morphism $\kappa_{1, 1}$, with $\Gamma_0'$ the pullback of $\Gamma_0$ under the forgetful morphism $\cMbar_{g_0, 1} \to \cMbar_{g_0}.$ A priori, it is not clear that all the components of $Z_{\mu}\cM_g$ can be described in this way. On the other hand, using the method of Theorem \ref{thm:main1}, we cannot deduce the existence of a smooth curve with a prescribed Ekedahl-Oort type $\mu$ in general. However, once we know there is one such curve (e.g., with the help of \cite[Theorem 6.4]{pries_current_results}), using Corollary \ref{cor:smootheoloci}, we can compute the dimension of all the non-empty components $\Gamma$ of $\bZ_{\mu}\cM_g$ whose closures $\bar{\Gamma}$ in $\cMbar_g$ intersect $\Delta_0$; the condition $\bar{\Gamma} \cap \Delta_0 \neq \o$ is automatically satisfied if $g > \sum \mu_i.$
\end{rem}





To indicate when the conditions of the preceding corollary are satisfied, we consider the following result, which one can find in \cite[Lemma 2.4, Lemma 2.5]{fabervdgeer} in case $l = 1$. Note that \cite[Lemma 2.4]{fabervdgeer} was first observed (in characteristic $0$) by Diaz in \cite[page~80]{diaz}  and follows from the Diaz-Looijenga bound in \cite[page 412]{looijenga}.

\begin{prop}
Let $\Gamma$ be an irreducible, closed subset of $\cMbar_{g, n}$ of dimension $2g - 3 + n + l$, for $l\geq 1$. Then $\Gamma \cap \Delta_{0, l} \neq 0$. Furthermore, $\Gamma$ contains a point corresponding to a stable curve with $m \leq g - l$ elliptic curves as irreducible components and $g - m \geq l$ loops.
\label{prop:loopscomplete}
\end{prop}
\begin{proof}
Similarly as in \cite[Lemma 2.4]{fabervdgeer}, it is enough to prove the claim for $g \geq 2$ and $n = 0$. We use induction on $l$ with \cite[Lemma 2.4]{fabervdgeer}  as the base case $l = 1$. Let $l \geq 2$, then $\Gamma$ intersects $\Delta_0$ by \cite[Lemma 2.4]{fabervdgeer}, and any component $\Gamma'$ of $\Gamma \cap \Delta_0$ is of dimension $$\dim \Gamma' \geq 2g - 3 + l - 1.$$
Let $\Gamma''$ be a component of its preimage under $\kappa_2$ in $\cMbar_{g - 1, 2}$. Since $\kappa_2$ is a finite map, we have
$$\dim \Gamma'' = \dim \Gamma' \geq 2g - 3 + l - 1,$$ so \cite[Lemma 2.4]{fabervdgeer} applied to $\Gamma''$ gives us that $\Gamma''\cap \Delta_0 \neq \o$. Now we have $\kappa_2(\Gamma'') \subseteq \Gamma$, and by induction $\Gamma'' \cap \Delta_{0, l - 1}\neq \o$, so we find that $\Gamma \cap \Delta_{0, l} \neq \o.$ Lastly, \cite[Lemma 2.5]{fabervdgeer} with the preceding discussion implies the second claim.
\end{proof}

We illustrate the general approach for computing the dimensions of certain Ekedahl-Oort strata of $\cM_g$ by the following result observed by Pries and examples in Section \ref{sec:exm}.

    
\begin{cor}[{\cite{pries_a_number}}] For any $g\geq 3$ and $p > 0$, the following results hold. 
\begin{enumerate}
    \item The locus of curves in $V_{g - 2}\cM_g$ with $a$-number $\geq 2$ is non-empty and is pure of codimension $1$ in $V_{g - 2}\cM_g$. 
    \item The locus of curves in $V_{g - 3}\cM_g$ with $a$-number $\geq 2$ is non-empty and is pure of codimension $1$ in $V_{g - 3}\cM_g$.
\end{enumerate}
\label{cor:pries_anum}
\end{cor}
\begin{proof}
The non-emptiness follows from Remark \ref{rem:priessmootheo}, i.e., from \cite[3.3.1, 3.3.2, and Theorem 6.4]{pries_current_results}, while parts $1$ and $2$ are essentially obtained in the proofs of \cite[Corollary~4.5]{pries_a_number} and \cite[Proposition~4.9]{pries_a_number}, using  \cite[Proposition~3.7]{pries_a_number}. 

Another way to prove these claims assuming the non-emptiness of the considered loci is to use that the $a$-number $\geq 2$ locus of $V_{g - 2}\cM_g$ and the $a$-number $\geq 2$ locus of $V_{g - 3}\cM_g$ are, respectively, equal to  $$\bZ_{[2, 1]}\cM_g \quad \text{and}\quad \bZ_{[3, 1]}\cM_g,$$
 as we noted above. Now, dimension computations and Proposition \ref{prop:loopscomplete} tell us that any component $\Gamma$ of these Ekedahl-Oort loci satisfies the conditions of Corollary \ref{cor:smootheoloci}, so the result follows after applying Corollary \ref{cor:smootheoloci} to $\Gamma$.  
\end{proof}


Let $Z_{[4, 3]}\mathcal{H}_{4}$ be the locus of smooth hyperelliptic curves of genus $4$ over $k$ with Ekedahl-Oort type $[4, 3]$. In Theorem \ref{thm:he_implies_eo}, we present the criterion for computing dimensions of certain loci $\Gamma$ in  $\cM_4$ such that $Z_{[4, 3]} \subset j({\Gamma})$ in $\cA_4$. We show it below in case $\Gamma = \bZ_{\mu}$ with $\mu > [4, 3]$, though it can also be used to compute the dimension of any non-supersingular Newton polygon locus since $Z_{[4, 3]}$ is completely contained in the supersingular locus of $\cA_4$.  


\begin{thm}
Let $\mathrm{char}(k) = p>2$. If the locus of smooth hyperelliptic curves of genus $4$ over $k$ with Ekedahl-Oort type $[4, 3]$ is non-empty and finite, then all components of $V_0\cMbar_4$ (and thus of $V_{g-4}\cMbar_g$) have generic $a$-number $1$. Moreover, then $Z_{\mu}\cM_4$ is pure of codimension $\sum \mu_i$ in $\cM_4$ if non-empty, for any $\mu = [\mu_1, \ldots, \mu_n]$ with $\mu > [4, 3]$.
\label{thm:he_implies_eo}
\end{thm}

\begin{proof}
Let $\mu $ be a Young diagram with $\mu > [4, 3]$. Since $\cJ_4$ is of codimension $1$ in $\cA_4$ and $\cA_4$ is smooth, 
$\bZ_{\mu}\cap \cJ_4$ is either pure of the expected codimension in $\cJ_4$, or it is of codimension one less, irreducible by \cite[Theorem 11.5]{ekedahlvdgeer}, and thus coincides with $\bZ_{\mu}$ in $\cA_4$. 

Assume the latter is true and let $\Gamma$ and $\Gamma'$ be components of $\bZ_{\mu}\cMbar_4$ and $\bZ_{[4, 3]}\cMbar_4$ containing a point of $Z_{[4, 3]}\mathcal{H}_4$ which corresponds to a smooth hyperelliptic curve $C$ with Ekedahl-Oort type $[4, 3]$, and such that $\Gamma' \subseteq \Gamma$. By assumption, we get that $j(\Gamma\cap \cM_g^{ct}) = \bZ_{\mu}$ and that $\dim\Gamma' = 3$ since $j(\Gamma')$ is a component of the locus $\bZ_{[4, 3]}$, which is pure of dimension $3$. Since it is non-empty, any component of the locus $\Gamma' \cap \overline{\cH}_{4}$ must be of dimension at least  $3 - 2 = 1$. However, as we noted, there is a component of $\Gamma' \cap \overline{\cH}_{4}$ which is $0$-dimensional, namely, the one consisting of the point corresponding to the curve $C$. 

As before, the result for $V_0\cMbar_4$ follows for the choice $\mu = [4, 1]$ and we conclude that every component of $V_{g - 4}\cMbar_g$ has generic $a$-number $1$ for any $g \geq 4$ using Corollary \ref{cor:fvgdp}~(2).
\end{proof}

\begin{rem}
The proof of Theorem \ref{thm:he_implies_eo} in principle works in any characteristic. However, by Lemma \ref{lem:eo_conclusion_char2_prel} it turns out there are no smooth curves of genus $4$ with Ekedahl-Oort type $[4, 3]$ in characteristic $2$, so that $Z_{[4, 3]}\cH_4$ is empty. 
\end{rem}

\section{Applications and examples}
\label{sec:exm}

In this section, we present some results about the Ekedahl-Oort stratification of the moduli spaces of genus-$g$ curves for $g\geq 4$ in characteristics $p = 2$ and $p = 3$ and give an idea of how to generalize them in an arbitrary characteristic $p>0$. The main idea consists of computing the dimensions of Ekedahl-Oort loci $Z_{\mu}\cMbar_4$ and then using our Theorem \ref{thm:main1} to obtain the conclusions about $Z_{\mu}\cMbar_g$ for $g \geq 4$. In particular, this way, we could also approach the types, such as $[3, 2]$ or $[3, 2, 1]$, that we could not before. 


For $p = 2$, we recall the result which describes the Ekedahl-Oort loci of Jacobians $Z_{\mu}\cap \cJ_4$ inside the $2$-rank zero locus $V_0$, i.e., in the case $\mu_1 = 4$. 

\begin{lem}[{\cite[Corollary 6.6]{dd2}}] In characteristic $p = 2$, the Ekedahl-Oort strata $Z_{[4]}\cap \cJ_4$, $Z_{[4, 1]}\cap \cJ_4$, and $Z_{[4, 2]}\cap \cJ_4$ are respectively of the expected codimensions $4, 5,$ and $6$ in $\cJ_4$, while $Z_{\mu}\cap \cJ_4^0 = \o$ for $\mu \in \{[4, 3], [4, 2, 1], [4, 3, 1], [4, 3, 2], [4, 3, 2, 1]\}$.  
\label{lem:eo_conclusion_char2_prel}
\end{lem}
 
By Remark \ref{rem:priessmootheo}, there is a smooth curve of genus $4$ with Ekedahl-Oort type $\mu < [3, 2]$ in any characteristic $p > 0$, while it exists a smooth curve of genus $4$ with Ekedahl-Oort type $\mu \leq [3, 2]$ in characteristic $p > 2$. We consider the remaining case $\mu = [3, 2]$ and $p = 2$ below. 

\begin{lem} 
In characteristic $p = 2$, there is a smooth genus $4$ curve with Ekedahl-Oort type $[3, 2]$.   
\label{lem:char2_eo32_genus4}
\end{lem}
\begin{proof}
From the list of all genus $4$ curves defined over $\F_2$ (up to an $\F_2$-isomorphism) made by Xarles in \cite{xarles}, we find the hyperelliptic curve $C: y^2 + x^2y = x^9 + x$ as the potential candidate. After the change of coordinates, we can put $C$ in the form of  \cite[Notation~1.1]{elkinpries}, $C: y^2 - y = \sum_{\alpha \in \{0, 1\} } f_{\alpha}(x_{\alpha})$, for $\alpha \in \{0, 1\}$ with $x_{\alpha}  = (x - \alpha)^{-1}$ and $f_{\alpha}(x) \in \F_2[x]$ the polynomials of degree $\deg f_{\alpha} = d_{\alpha}$, where $d_{1} = 5$ and $d_{0} = 3$. Now, \cite[Theorem 5.2]{elkinpries} tells us that $\mu(C) = [3, 2]$.
\end{proof}

With a proof similar to the one of Lemma \ref{lem:eo_conclusion_char2_prel}, we prove below a slight generalization of that claim.

\begin{prop}
In characteristic $p = 2$, for any Young diagram $\mu = [\mu_1, \ldots, \mu_n]$ with $\mu > [4, 3]$, $Z_{\mu}\cM_4$ is non-empty and is pure of codimension $\sum \mu_i$ in $\cM_4$. For any other Young diagram $\mu$, namely $\mu = [4, 3]$ or $\mu \leq [3, 2, 1]$, $Z_{\mu}\cM_4$ is empty.
\label{prop:eo_conclusion_char2}
\end{prop}

\begin{proof}
In characteristic $2$, $Z_{\mu}\cM_4$ is non-empty for $\mu \in \{[4], [4, 1], [4, 2]\}$ by Lemma \ref{lem:eo_conclusion_char2_prel}, for $\mu = [3, 2]$ by Lemma \ref{lem:char2_eo32_genus4}, and for the Young diagrams $\mu$ with $\mu > [3, 2]$ by Remark~\ref{rem:priessmootheo}. On the other hand, $Z_{\mu}\cM_4$ is empty for $\mu = [3, 2, 1]$ by  \cite[Theorem 1.1]{zhou_a_number} and for the remaining ones, which do not satisfy $\mu > [4, 3]$, by Lemma \ref{lem:eo_conclusion_char2_prel}.

Fix $\mu > [4, 3]$ and note that $\bZ_{\mu}$ is irreducible in $\cA_4$ by \cite[Theorem 11.5]{ekedahlvdgeer}. Again using that $\cA_4$ is a smooth stack and $\cJ_4$ is a divisor in $\cA_4$, the dimension of any component $\Gamma$ of $\bZ_{\mu}\cap \cJ_4$ is either $\dim \Gamma = 9 - \sum \mu_i$ or $\dim \Gamma =  10 - \sum \mu_i$. If the latter is true for a component $\Gamma$, then $\Gamma = \bZ_{\mu} \subset \cJ_4$. This is not possible since $Z_{[4, 3]} \subseteq \bZ_{\mu}$. Namely, $Z_{[4, 3]}\cap \cJ_4^0 = \o$ and the locus of Jacobians of singular curves with Ekedahl-Oort type $[4, 3]$ is at most $2$-dimensional, while $\dim Z_{[4, 3]} = 3$. This implies the result.
\end{proof}

\begin{cor}
In characteristic $p = 2$, there is a smooth genus $g$ curve with Ekedahl-Oort type $[3, 2]$, for any $g \geq 4$.
\end{cor}
\begin{proof}
By Proposition \ref{prop:eo_conclusion_char2}, $Z_{[3, 2]}\cM_4$ is non-empty and is pure of the expected codimension~$5$. Therefore, \cite[Theorem 6.4]{pries_current_results} implies the result.
\end{proof}


Let us now consider the case $p = 3$. Zhou has studied the Ekedahl-Oort loci of hyperelliptic genus-$4$ curves in characteristic $3$ in \cite{zhou_genus4}. One can either use that or explicitly obtain that there is a unique such curve with Ekedahl-Oort type $[4, 3]$ as we do in the following example.

\begin{exmp}
Any hyperelliptic genus-$4$ curve $C$ over an algebraically closed field $k$ with characteristic $\neq 2$ can be written in the following normal form $$y^2 = f(x) = x^9 + a_8x^8 + \ldots + a_2x^2 + x,$$ with $a_i \in k$, for $2\leq i\leq 8$, obtained by choosing $0$ and $\infty$ to be the branch points and by scaling. Let here $\mathrm{char}(k) = 3$, when we can write the Hasse-Witt matrix of $C$ in quite a simple form: $$\begin{pmatrix}
a_2 & a_5 & a_8 &0 \\ 
1 & a_4 & a_7 & 0\\ 
0 & a_3 & a_6 & 1\\ 
0 & a_2 & a_5 & a_8
\end{pmatrix}.$$  The condition that $C$ has Ekedahl-Oort type $[4, 3]$ is equivalent to the fact that its Hasse-Witt partition is $\delta = 22$, i.e., that $$\rank_k H = 2 \quad \text{and} \quad HH^{(3)} = 0.$$ It is not hard to check that the first condition is equivalent to $a_2 = a_5 = a_8 = 0$ using that the discriminant of $f$ should be non-zero, while the second one gives us $a_3 = a_4 = a_6 = a_7 = 0$. Hence, there is a unique hyperelliptic curve $$y^2 = x^9 + x$$ with Ekedahl-Oort type $[4, 3]$ up to isomorphism. In particular, there is a zero-dimensional component of $$\bZ_{[4, 3]}\cMbar_4 \cap \overline{\cH}_4,$$ where $\overline{\cH}_4$ is the (closed) locus of stable hyperelliptic curves of genus $4$, which is of codimension $4 - 2 = 2$ in $\cMbar_4$.
\label{exmp:he43}
\end{exmp}

\begin{prop}
In characteristic $p = 3$, for any Young diagram $\mu = [\mu_1, \ldots, \mu_n]$ with $\mu~>~[4, 3]$, the Ekedahl-Oort locus $Z_{\mu}\cM_4$ is non-empty and is pure of the expected codimension $\sum \mu_i$ in $\cM_4$.
\label{prop:eo_conclusion_char3}
\end{prop}

\begin{proof}
By \cite[Theorem 1.1]{zhou_genus4}, $Z_{\mu}\cM_4$ is non-empty in characteristic $3$ if $\mu > [4, 3]$. Moreover, Example \ref{exmp:he43} shows that $Z_{[4, 3]}\cH_4$ consists only of one point, and in particular, that it is finite. Therefore, Theorem \ref{thm:he_implies_eo} finishes the proof. 
\end{proof}

Now, we combine the conclusions for $p = 2$ and $p = 3$ and describe the generic behavior of the components of $V_{g - 4}\cMbar_g$ for any $g \geq 4$.

\begin{cor}
In characteristics $p \in \{ 2, 3\}$, all the components of $V_{g - 4}\cMbar_g$ have generic $a$-number $1$, for any $g\geq 4$.     
\end{cor}
\begin{proof}
Use Corollary \ref{cor:fvgdp} (2) together with Proposition \ref{prop:eo_conclusion_char2} and Proposition \ref{prop:eo_conclusion_char3} to obtain the result.    
\end{proof}






Let us present how we can use Theorem \ref{thm:main1} to make some new observations about the loci that one could not approach using the previously known results from the literature. We need the following lemma. 

\begin{lem}
In any characteristic $p>0$, all the components of $\bZ_{[1]}\cMbar_2$, $\bZ_{[2]}\cMbar_3$, and $\bZ_{[2, 1]}\cMbar_3$ have a non-empty intersection with $\Delta_0$.   
\label{lem:intersect_delta0}
\end{lem}
\begin{proof}
First, $\Gamma = \bZ_{[1]}\cM_2$ is irreducible since $\overline{j(\Gamma)} = \bZ_{[1]}$ is irreducible in $\cA_2$ by \cite[Theorem~11.5]{ekedahlvdgeer}; in fact,  $\overline{j(\Gamma)}$ coincides with the $\prank \leq 1$ locus $V_1$ in $\cA_2$ so its irreducibility was observed even before. Furthermore, we have $\overline{\Gamma} = \bZ_{[1]}\cMbar_2$ by the dimension count so that $\bZ_{[1]}\cMbar_2 \cap \Delta_0 \neq \o$ follows from the Diaz-Looijenga bound in Remark \ref{rem:anymu_pured_nonempty}. A similar argument gives a proof for $\bZ_{[2]}\cMbar_3$; see also \cite[Lemma 3.3]{achterpries}.

On the other hand, note that we cannot use the Diaz-Looijenga bound to obtain the result for $\bZ_{[2, 1]}\cMbar_3$. However, we can explicitly discuss all the possibilities and show the claim in this case. By \cite[Theorem 11.5]{ekedahlvdgeer}, which implies that $\bZ_{[2, 1]}$ is irreducible in $\Tilde{\cA}_3$, $\bZ_{[2, 1]}\cMbar_3$ has only one component $\Gamma$ that is generically smooth and $\Gamma$ has a non-empty intersection with $\Delta_0$. All the other components of $\bZ_{[2, 1]}\cMbar_3$, which are $3$-dimensional, lie in $\kappa_{1, 1}(\bZ_{[1]}\cMbar_{2, 1}\times \bZ_{[1]}\cMbar_{1, 1})$, so by the first part of proof they have a non-empty intersection with $\Delta_0$. This finishes the proof.
\end{proof}



In the following two examples, we find the upper bounds on the dimensions of the components of $\bZ_{[3, 2]}\cMbar_4$ and $\bZ_{[3, 2]}\cMbar_5$ in arbitrary characteristic $p>0$ and comment on special cases. We note that the type $\mu = [3, 2]$ gives us the first case when there are components of $\bZ_{\mu}\cMbar_g$, $g\geq 3$ whose dimension is not the expected one $3g - 3 - \sum \mu_i$. Namely, note that $\bZ_{[3, 2]}\cMbar_3$ contains $\kappa_{1, 1}(\bZ_{[1]}\cMbar_{1, 1} \times \bZ_{[2]}\cMbar_{2, 1})$, which is a $2$-dimensional locus.

\begin{exmp}[{Ekedahl-Oort type $\left [3, 2\right ]$ and $\cMbar_4$.}] 
Let $\mu = [3, 2]$. In this example, we give an upper bound on $\dim \Gamma$ for any component $\Gamma$ of $\bZ_{\mu}\cMbar_4$ in characteristic $p>0$. 

Because of the remark that there is a component of $\bZ_{[3, 2]}\cMbar_3$ which is $2$-dimensional, if ${\Gamma}\cap \Delta_0 \neq \o$, Theorem \ref{thm:main1} gives us that $$\dim \Gamma \leq \dim \kappa_{2}(\bZ_{\mu}\cMbar_{3, 2}) + 1 \leq 5.$$ 

Assume now that component $\Gamma$ generically consists of smooth curves and $\Gamma \subset \cM_4^{ct}$, i.e., that $\Gamma \cap \Delta_0 = \o$. Since $\Jac_4$ is of codimension $1$ in $\cA_4$ and $\cA_4$ is smooth, it follows that $\dim \Gamma = \dim j({\Gamma}) \geq 4$, and thus $$4\leq \dim \Gamma \leq 5.$$
If $\dim \Gamma = 5$, then $\Gamma$ is a complete subvariety of $\cM_4^{ct}$ of dimension $5$ and thus contains a point corresponding to a stable curve that is a chain of elliptic curves by \cite[Lemma~2.5]{fabervdgeer}. In particular, it intersects $\Delta_1$ and $\Delta_2$, and we get that ${\Gamma}\cap \Delta$ consists of the union of some components of:
\begin{itemize}
    \item  $3$-dimensional $\kappa_{1, 1}(\cMbar_{1, 1} \times \bZ_{[3, 2]}\cMbar_{3, 1})$, or 
    \item  $4$-dimensional $\kappa_{1, 1} (\bZ_{[2]}\cMbar_{2, 1} \times \bZ_{[2]}\cMbar_{2, 1})$.
\end{itemize}
Note that all the components of  $\kappa_{1, 1} (\bZ_{[1]}\cMbar_{1, 1} \times \bZ_{[2]}\cMbar_{3, 1})$, $\kappa_{1, 1} (\bZ_{[1]}\cMbar_{1, 1} \times \bZ_{[2, 1]}\cMbar_{3, 1})$, $\kappa_{1, 1} (\bZ_{[1]}\cMbar_{2, 1} \times \bZ_{[2]}\cMbar_{2, 1})$, and $\kappa_{1, 1} (\bZ_{[1]}\cMbar_{2, 1} \times \bZ_{[2, 1]}\cMbar_{2, 1})$ have a non-empty intersection with $\Delta_0$ by Lemma \ref{lem:intersect_delta0}.


Because of its irreducibility, if $\dim {\Gamma} = 5$, it follows by \cite[Theorem 11.5]{ekedahlvdgeer} that 
\begin{equation}
j({\Gamma}) = \bZ_{[3, 2]} = Z_{[3, 2]} \cup \bZ_{[4, 2]}.
\label{eqn:mu32_discussion}
\end{equation}
Finally, note that we also obtained $\dim \Gamma \leq 4$ in the remaining case $\Gamma \subseteq \Delta_1 \cup \Delta_2$. 

In general, we can conclude that that $\dim \Gamma \leq 5$. 
\label{exmp:32inGenus4}
\end{exmp}

\begin{exmp}[{Ekedahl-Oort type $\left [3, 2\right ]$ and $\cMbar_5$.}] 
\label{exmp:mu32_genus5}
In this example, we give an upper bound on $\dim \Gamma$ for any component $\Gamma$ of $\bZ_{[3, 2]}\cMbar_5$ in characteristic $p>0$. 

Note that $\mu = [3, 2]$ satisfies for $g = 4$ the technical condition on the Young diagrams in Theorem \ref{thm:main1}. This follows from the first observation in Remark \ref{rem:ordering} and the fact that $Z_{[4, 1]} \not \subset \bZ_{[3, 2]}$ since $Z_{[3, 2]}$ and $Z_{[4, 1]}$ have the same dimension in $\cA_5$ and are both irreducible by \cite[Theorem 11.5]{ekedahlvdgeer}.

Let $\Gamma$ be a component of $\bZ_{[3, 2]}\cMbar_5$. If $\Gamma$ is generically smooth and ${\Gamma}\cap \Delta_0 = \o$, then ${\Gamma} \subset \cM_5^{ct}$ and $\dim \Gamma \geq 7$ since $\cJ_{5}\cap \bZ_{[3, 2]}$ is of codimension at most $5$ in $\cJ_5$. By \cite[Lemma 2.4 and Lemma 2.5]{fabervdgeer}, it follows that it has to be $\dim \Gamma = 7$, and one can use that $\Gamma$ contains a point corresponding to a chain of elliptic curves to find an upper bound on its dimension. We cover the  case $\Gamma \subseteq \Delta_1 \cup \Delta_2$ similarly as in Example \ref{exmp:32inGenus4}.

Otherwise ${\Gamma}\cap \Delta_0 \neq \o$, and one can compute an upper bound on its dimension using Theorem \ref{thm:main1} applied to $\bZ_{[3, 2]}\cMbar_4$. Explicitly, $\dim \bZ_{[3, 2]}\cMbar_4 \leq 5$ implies $\dim \bZ_{[3, 2]}\cMbar_5\leq 8$.
\end{exmp}

\begin{rem} In Proposition \ref{prop:eo_conclusion_char2} and Proposition \ref{prop:eo_conclusion_char3} we have seen that in characteristic $p \in \{2, 3\}$, the locus $Z_{[3, 2]}\cM_4$ is pure of dimensions $4$. Let us compare this with Example~\ref{exmp:32inGenus4} and let $\Gamma$ be a component of this locus in characteristic $p \in \{2, 3\}$. While it could happen that $\overline{\Gamma} \cap \Delta_0 \neq \o$ so that the first part of Example \ref{exmp:32inGenus4} only gives us $\dim \Gamma \leq 5$, the fact that $\cJ_4$ is a divisor in $\cA_4$ gives us a stronger bound in this case. 

On the other hand, $\cJ_5$ is of codimension $3$ in $\cA_5$ so the upper bound on the dimension of the components of $Z_{[3, 2]}\cM_5$ that we get in Example \ref{exmp:mu32_genus5} could not be improved using an analogous argument to the one above.
\end{rem}

We end this section by giving an upper bound on the dimension of any component of $\bZ_{[3, 2, 1]}\cMbar_g$ for any $g\geq 4$.

\begin{exmp}[{Ekedahl-Oort type $\left [3, 2, 1\right ]$.}]
Let $\Gamma$ be a component of $\bZ_{[3, 2, 1]}\cMbar_4$. Even though the locus of smooth curves of genus $3$ with Ekedahl-Oort type $[3, 2, 1]$, the superspecial ones, is finite if non-empty, note that $\kappa_{1, 1}(\bZ_{[1]}\cMbar_{1, 1}\times \bZ_{[2, 1]}\cMbar_{2, 1}) \subseteq \bZ_{[3, 2, 1]}\cMbar_3$ is $1$-dimensional. Therefore, if $\Gamma$ satisfies ${\Gamma}\cap \Delta_0 \neq \o$, then Theorem \ref{thm:main1} gives us that $$\dim \Gamma \leq \dim \kappa_{2}(\bZ_{[3, 2, 1]}\cMbar_{3, 2}) + 1 \leq 4.$$ 
Otherwise, $\Gamma \subset \cM_4^{ct}$ and if its generic point is smooth, using the smoothness of $\cA_4$ as before, we find $3\leq \dim {\Gamma} \leq 4$ since $\dim \Gamma = \dim j({\Gamma})$. Similarly as in Example \ref{exmp:32inGenus4}, if $\dim \Gamma = 4$, then it has to be 
\begin{equation}
 j({\Gamma}) = \bZ_{[3, 2, 1]} = Z_{[3, 2, 1]} \cup \bZ_{[4, 2, 1]}
\label{eqn:321condition_dim4}   
\end{equation}
Finally, let $\Gamma \subseteq \Delta_1 \cup \Delta_2$. We can consider all possibilities and find that $\dim \Gamma \leq 2$. Namely, the only possible ones with dimension at least $3$ are either the components of the $4$-dimensional locus $\kappa_{1, 1}(\bZ_{[1]}\cMbar_{2, 1} \times \bZ_{[2, 1]}\cMbar_{2, 1})$ or the components of the $3$-dimensional locus $\kappa_{1, 1}(\bZ_{[1]}\cMbar_{1, 1}\times \bZ_{[2, 1]}\cMbar_{3, 1})$. However, by Lemma \ref{lem:intersect_delta0}, all of them have a non-empty intersection with $\Delta_0$, while our assumption is that $\Gamma \cap \Delta_0 \neq \o$.


This gives us an upper bound on the dimension of any component $\Gamma \subseteq \bZ_{[3, 2, 1]}\cMbar_4$; namely, $\dim \Gamma \leq 4$. Using this observation and  Theorem \ref{thm:main1}, we can first find some upper bounds on the dimensions of the components of $\bZ_{[3, 2, 1]}\cMbar_5$ and then of $\bZ_{[3, 2, 1]}\cMbar_6$ in a similar manner: $\dim \bZ_{[3, 2, 1]}\cMbar_5 \leq 7$ and $\dim \bZ_{[3, 2, 1]}\cMbar_6 \leq 10.$ Namely, if $\Gamma$ is a component $\bZ_{[3, 2, 1]}\cMbar_5$ with $\Gamma \cap \Delta_0 \neq \o$ (resp.  $\Gamma \cap \Delta_0 = \o$) it follows $\dim \Gamma \leq 7$ by Theorem \ref{thm:main1} (resp. by the Diaz-Looijenga bound in Remark~\ref{rem:anymu_pured_nonempty}). Similarly, if $\Gamma$ is a component $\bZ_{[3, 2, 1]}\cMbar_6$ with $\Gamma \cap \Delta_0 \neq \o$ (resp.  $\Gamma \cap \Delta_0 = \o$) it follows $\dim \Gamma \leq 10$ by Theorem~\ref{thm:main1} (resp. $\dim \Gamma \leq 9$ by the Diaz-Looijenga bound).


By the Diaz-Looijenga bound, every component of $\bZ_{[3, 2, 1]}\cMbar_g$, for $g \geq 7$, has a non-empty intersection with $\Delta_0$. Therefore, Theorem~\ref{thm:main1} and the preceding computations imply that for any $g \geq 3$, it holds that $$\dim \bZ_{[3, 2, 1]}\cMbar_g \leq 3g - 8.$$ 
\label{exmp:321inGenus4}
\end{exmp}
Finally, let us denote by $T_a\cM_g$ the locus of smooth curves of genus $g$ with $a$-number $\geq a$. We sum up some of the conclusions we made.  
\begin{cor}
In any characteristic $p>0$ and for any $g\geq 3$, we have $\dim T_{1}\cM_g  = 3g - 4$, $\dim T_{2}\cM_g  = 3g - 6$, and $\dim T_{3}\cM_g  \leq 3g - 8$.
\end{cor}
\begin{proof}
The conclusion for $T_{1}\cM_g  = V_{g - 1}\cM_g$ follows from \cite[Theorem 2.3]{fabervdgeer} (here Corollary \ref{cor:fvgdp} (1)). The upper bound for $\dim T_2\cM_g$ is given by \cite[Corollary~4.5]{pries_a_number}, while the lower bound is discussed in Corollary \ref{cor:pries_anum} (1). Lastly, the conclusion  $\dim T_{3}\cM_g  \leq 3g - 8$ follows from Example \ref{exmp:321inGenus4} since $T_{3}\cM_g = \bZ_{[3, 2, 1]}\cM_g$.  
\end{proof}
\begin{thebibliography}{vdGvdV95}


\bibitem[Ale05]{alexeev}
{Alexeev, V.}, \emph{Compactified Jacobians and Torelli map.},
Publ. Res. Inst. Math. Sci., 40(4), pp.~12411265, 2004.

\bibitem[AH19]{achterhowe}
{Achter, J. and Howe, E.}, \emph{Hasse-Witt and Cartier-Manin matrices: a warning and a request.},
Arithmetic geometry: computation and applications, pp.~118, 
Contemp. Math., 722, Amer. Math. Soc., 2019.

\bibitem[AP08]{achterpries}
{Achter, J. and Pries, R.}, \emph{Monodromy of the $p$-rank strata of the moduli space of curves.},
Int. Math. Res. Not. IMRN, 15, Art. ID rnn053, 25 pp., 2008.

\bibitem[AP11]{achterprieshe}
{Achter, J. and Pries, R.}, \emph{The {$p$}-rank strata of the moduli space of hyperelliptic curves.},
Adv. Math., 227, no. 5, pp.~1846-1872, 2011.


\bibitem[Bou98]{bouw}
{Bouw, I.}, \emph{The p-rank of curves and covers of curves.},
Progr. Math 187, pp. ~403-412, 1998.



\bibitem[Dia87]{diaz}
{Diaz, S.}, \emph{Complete subvarieties of the moduli space of smooth curves. In Algebraic
geometry}, In Algebraic
geometry, Bowdoin 1985 (S. Bloch, ed.), Proc. Sympos. Pure Math., 46, Part 1,
Amer. Math. Soc., Providence, RI, pp.~7781, 1987.


\bibitem[Dra23]{dd2}
{Dragutinovi\'c, D.}, \emph{Supersingular curves of genus four in characteristic two},
arxiv:2301.12897.   


\bibitem[EvdG09]{ekedahlvdgeer}
{Ekedahl, T. and van der Geer, G.}, \emph{Cycle Classes of the E-O Stratification on the Moduli of Abelian Varieties.}, sIn: Algebra, Arithmetic, and Geometry: Volume I: In Honor of Yu. I. Manin, pp. ~567-636. Birkhuser Boston, Boston, 2009.



\bibitem[EP07]{elkinpries}
{Elkin, A. and Pries, R.}, \emph{Hyperelliptic curves with $a$-number 1 in small characteristic.}, Albanian Journal of Math, 1 (4), pp. ~245-252, 2007.


\bibitem[FvdG04]{fabervdgeer}
{Faber, C. and van der Geer, G.}, \emph{Complete subvarieties of moduli spaces and the Prym map},
 J. Reine Angew. Math., 573, pp.~117-137, 2004.

\bibitem[GP05]{glasspries}
{Glass, D. and Pries, R.}, \emph{Hyperelliptic curves with prescribed {$p$}-torsion},
Manuscripta Math., 117, no. 3, pp.~299-317, 2005.


\bibitem[HW36]{hassewitt}
{Hasse, H. and Witt, E.}, \emph{Zyklische unverzweigte Erweiterungskrper vom Primzahlgrade p ber einem algebraischen Funktionenkrper der Charakteristik p.},
 Monatsh. Math. Phys. 43, no. 1, pp. 477492., 1936.  


\bibitem[Knu83]{knudsen}
{Knudsen, F.}, \emph{The projectivity of the moduli space of stable curves. II. The stacks $M_{g,n}$}, Math. Scand. 52, no. 2, pp.~161199., 1983.

\bibitem[Kob75]{koblitz}
{Koblitz, N.}, \emph{$p$-adic variation of the zeta-function over families of varieties defined over
finite fields.}, Compositio Math. 31, pp.~119-218., 1975.

\bibitem[KT18]{kocktait}
{Kck, B. and Tait, J.}, \emph{On the de-Rham cohomology of hyperelliptic curves.},
Res. Number Theory, 4, Paper No. 19, 17 pp., 2018.


\bibitem[Loo95]{looijenga}
{Looijenga, E.}, \emph{On the tautological ring of $\cM_g$.},
Invent. Math. 121, pp.~411419., 1995.

\bibitem[Moo22]{moonen}
{Moonen, B.}, \emph{Computing discrete invariants of varieties in positive characteristic I. Ekedahl-Oort types of curves.},
Journal of Pure and Applied Algebra, Volume 226, Issue 11, Paper No. 107100, 19 pp.,  2022.

\bibitem[Oda69]{oda}
{Oda, T.}, \emph{The first de Rham cohomology group and Dieudonn modules},
Annales scientifiques de l'cole Normale Suprieure, Serie 4, Volume 2, no. 1, pp. 63-135., 1969.

\bibitem[Oor62]{oort:genjac}
Oort, F., \emph{A construction of generalized Jacobian varieties by group extensions}, Mathematische Annalen,
vol. 147, pp.~277-286., 1962.

\bibitem[Oor74]{oort_subv}
Oort, F., \emph{Subvarieties of moduli spaces}, Invent. Math., 24, pp.~95-119., 1974.

\bibitem[Oor91]{oort_hess}
Oort, F., \emph{Hyperelliptic supersingular curves},
In: van der Geer, G., Oort, F., Steenbrink, J. (eds) Arithmetic Algebraic Geometry. Progress in Mathematics, vol 89. Birkhuser, Boston, MA., pp.~247-284., 1991.

\bibitem[Oor01]{oort}
Oort, F., \emph{A stratification of a moduli space of abelian varieties},
Moduli of abelian varieties
(Texel Island, 1999), vol. 195 of Progr. Math., Birkh\"auser, Basel, pp.~345-416., 2001.

\bibitem[PWZ11]{pinkwedhornziegler}
{Pink, R. and Wedhorn, T. and Ziegler P.}, \emph{Algebraic zip data},  Doc. Math., vol. 16, pp.~253-300, 2011.

\bibitem[Pri09]{pries_a_number}
Pries, R., \emph{The $p$-torsion of curves with large $p$-rank},
Int. J. Number Theory 5, 6: pp.~1103-1115, 2009.  

\bibitem[Pri19]{pries_current_results}
Pries, R., \emph{Current results on Newton polygons of curves.},
Open Problems in Arithmetic Algebraic Geometry, editor Oort, Advanced Lectures in Mathematics, 46, ch. 6, pp.~179-208, 2019.

\bibitem[vdG99]{vdgeercycle}
{van der Geer, G.}, \emph{Cycles on the moduli space of abelian varieties},
 Aspects Math., E33. {pp.~65-89}, 1999.

\bibitem[Wed05]{wedhorn} Wedhorn, T., \emph{Specialization of F-zips.}, 	arXiv:math/0507175, 2005.



\bibitem[Xar20]{xarles}
Xarles, X., {\emph{A census of all genus 4 curves over the field with 2 elements}, arXiv:2007.07822}, 
2020. Repository: \url{https://github.com/XavierXarles/Censusforgenus4curvesoverF2} 


\bibitem[Zho19]{zhou_a_number}
Zhou, Z., \emph{A bound on the genus of a curve with Cartier operator of small rank.},
Rend. Circ. Mat. Palermo, II. Ser 68, 569577, 2019. https://doi.org/10.1007/s12215-018-0379-1

\bibitem[Zho20]{zhou_genus4}
Zhou, Z., \emph{Ekedahl-Oort strata on the moduli space of curves of genus four.},
Rocky Mountain J. Math. 50, no. 2, pp. 747761, 2020.




\end{thebibliography} 
\end{document}