%!TEX root = ../main.tex

\newcommand{\init}{\mathsf{init}}
\newcommand{\Qbar}{\overline{Q}}
\newcommand{\Qst}{{Q}^\star}

\newcommand{\fhat}{\hat{f}}

\section{Setting}
Let $\xi$ encode initial conditions and random seeds of the policy. We assume deterministic dynamics
\begin{align}
    x_{h+1} = f(x_h,u_h),
\end{align}
and $f$ is known. We let 
\begin{align}
    x_{h+1}^\star(\xi) = f(x_h^\star(\xi ),\tilde{u}),\quad \tilde{u} = \pi^\star(x_h^\star(\xi) ; \xi), \quad x_1^\star(\xi) = \init(\xi).
\end{align}
Let $z_{h}^\star(\xi) = (x_h^\star(\xi),u_h^\star(\xi))$.
We let $\xi \sim Q^\star_{\xi}$. And so we can sample
\begin{align}
    Q^\star := \mathrm{Law}(z_{1:H}^\star(\xi), \mid \xi \sim Q^\star_{\xi})
\end{align}
We also define
\begin{align}
\Qst_{h;l}(x) := \mathrm{Law}(z_{h:h+\ell}^\star(\xi), \mid z_{1:H}^\star(\xi) \sim \Qst, x_h^\star(\xi) = x)
\end{align}
For $h = 1$, we note that we have
\begin{align}
\Qst_{1;l}(x) := \mathrm{Law}(z_{h:h+\ell}^\star(\xi), \mid z_{1:H}^\star(\xi) \sim \Qst, \init(\xi) = x)
\end{align}


\paragraph{Oracle Model}
\newcommand{\epsorac}{\epsilon_{\mathrm{orac}}}
We consider size $\ell$ chunks of a horizon $H$, and set $\tau := H/\ell$. 
\begin{oracle} We assume that we can learn a sampler $\fhat_{h}$ such that
\begin{align}
    \Exp_{x_h^\star \sim Q^\star} \cW_2 ( Q^{\sigma}_{h;\ell}(x) ; \fhat_h(x)) \le \epsorac.
\end{align}
$Q^{\sigma}_{h;\ell}(x) := \mathsf{Conv}_{w\sim \cN(0,\sigma^2 \eye)} Q^*_{h;\ell}(x+w)$
\end{oracle}

\begin{definition}[Incremental Stability]
\end{definition}

\newcommand{\gamstab}{\gamma_{\mathrm{stab}}}
\newcommand{\betastab}{\beta_{\mathrm{stab}}}

\begin{assumption}We assume that, with probability $1$ over $\xi \sim \Qst_{\xi}$, the (deterministic) policy $\pi_h(\cdot \mid \xi)$ is $(\gamstab,\betastab)$-IISS.
\end{assumption}

\subsection{What can we imitate?}
Let's define $Q^{\otimes_{\tau} \sigma}$ is the distirbution induced by sampling inputs from $Q^{\sigma}_{1+k\ell;\ell}$ for $k = 1,2,\dots,\tau-1$.


\mscomment{REach goal: smoothing on subset of stuff might give less wavy trajs. E.g. smooth on position rather input.}

\input{body/dan_notes}
