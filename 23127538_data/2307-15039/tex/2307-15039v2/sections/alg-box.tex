\begin{algorithm}
\caption{EyeO Autocalibration}
\begin{algorithmic}[1]
\renewcommand{\COMMENT}[1]{\hfill\textcolor{gray}{// #1}}
\REQUIRE{Stream of gaze coordinates $(x_t, y_t)$ detected by an eye tracker; window size $w$ for running average; detected calibration error bound $b$; calibration zone threshold $\tau$; $y$-coordinate for lower boundary of text box $y_\mathrm{text\_box\_bottom}$}
\STATE Initialize $\tau := \tau_\mathrm{init}$ 
\COMMENT{threshold pixel distance of gaze coordinates from last typed character}\\
\STATE Initialize $n_\mathrm{char} := 0$ \COMMENT{number of characters visible in text box}\\
\STATE Initialize $\epsilon_{x_0} := 0, \epsilon_{y_0} := 0$ \COMMENT{calibration error in $x$ and $y$ directions}\\
% Compute d
\FOR{raw gaze coordinates $(x_t, y_t)$:}
\STATE Receive $n_\mathrm{char} %, s
$from typing application
\IF{$y < y_\mathrm{text\_box\_bottom}$  \textbf{and} $n_\mathrm{char} > 0$}
\STATE{Receive location of last type character ($x_c, y_c$) from typing application}
\IF{fixation detected \textbf{and} $\sqrt{(x_c-x_t)^2 + (y_c-y_t)^2} < \tau$}
\STATE{$\delta_{x_t} := x_c-x_t, \quad \delta_{y_t} := y_c-y_t$} \COMMENT{infer user is reading at $(x_c, y_c)$}\\
\STATE{$\delta_{x_t} := \frac{1}{\min(w,t)} \sum_{j=\max(0,t-w+1)}^{t} \delta_{x_t}$, \quad $\delta_{y_t} := \frac{1}{\min(w,t)} \sum_{j=\max(0,t-w+1)}^{t} \delta_{y_t}$} \COMMENT{sliding window estimate}\\
\STATE{$\epsilon_{x_t} := \mathrm{clip}(\delta_{x_t}, -b, b), \quad \epsilon_{y_t} := \mathrm{clip}(\delta_{y_t}, -b, b)$} \COMMENT{clip to maximum allowed offset}\\
\ENDIF
\ELSE
\STATE{$\epsilon_{x_t} := \epsilon_{x_{t-1}}, \quad \epsilon_{y_t} = \epsilon_{y_{t-1}}$} \COMMENT{infer user is typing; keep current error calibration}\\
\ENDIF
\STATE \textbf{return} calibrated gaze coordinates $(\widehat x_t, \widehat y_t) := (x_t+\epsilon_{x_t} + y_t+\epsilon_{y_t})$
\ENDFOR
\end{algorithmic}
\label{alg:main}
\end{algorithm}