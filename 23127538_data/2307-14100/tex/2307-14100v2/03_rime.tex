\section{RIME simulations}
\label{sec:rime}

The key to a deep learning-based analysis of radio observations are the training data sets for the deep learning models.
An accurate simulation chain is essential for the training data to have the same properties as actual measurements.
In addition to the source simulations, see \autoref{sec:gan-simulations}, the simulation of the radio interferometer plays a central role and forms the second large block in our analysis chain presented in \autoref{fig:analysis-chain}.
To describe the signal path from the sources towards measured data, we use the Radio Interferometer Measurement Equation (RIME) \citep{rime}.
The RIME utilizes Jones matrices \citep{jones} for the processing of the source signals.
For each corruption effect a new Jones matrix is defined.
The GAN-simulated sources described in \autoref{sec:gan-simulations} are the input for the RIME calculations.
Please note that matrices are marked with bold letters in the following.

As we focus on imaging tasks, we assume calibrated data for our simulations, so no direction-dependent effects are taken into account.
Hence, only the geometric signal delay between the antennas and the characteristic of the individual antenna responses are considered.
Thus, the RIME to calculate the complex visibility measured by the antenna pair $pq$ at time $t$ results in
\begin{equation}
    \mathbf{V}_{\mathrm{pq}}(l, m) = \sum_{l, m} \mathbf{E}_{\mathrm{p}}(l, m) \, \mathbf{K}_{\mathrm{p}}(l, m) \, \mathbf{B}(l, m) \, \mathbf{K}_{\mathrm{q}}^{\mathrm{H}}(l, m) \, \mathbf{E}_{\mathrm{q}}^{\mathrm{H}}(l, m).
\end{equation}
Here, $\mathbf{B}(l, m)$ describes the source's brightness distribution given in the direction cosines $l, m$.
At this stage, we do not simulate polarization data.
Generated visibilities correspond to full intensity data, known as Jones I.
Furthermore, $\mathbf{K}(l, m)$ describes the phase delay kernel defined as
\begin{align}
    \mathbf{K}(l, m) &= \exp \left(-2\pi \cdot i \cdot \left(ul + vm\right)\right).
\end{align}
The phase delay kernel takes into account the signal's propagation lengths to the different telescopes inside the interferometer array.
While $(l, m)$ are used for describing the source distribution, the antenna positions are given in the direction cosines $(u, v)$.
The effects of the phase delay kernel $\mathbf{K}(l, m)$ for different baseline lengths is illustrated in \autoref{fig:phase_delay}.
The characteristics of the VLA's \SI{25}{\meter} antennas are encoded in $\mathbf{E}(l, m)$, which is defined as
\begin{align}
    &\mathbf{E}(l, m) = \mathrm{jinc} \left(\frac{2\pi}{\lambda_{\mathrm{obs}}} d \cdot \theta_{lm}\right),\\
    &\mathrm{with}~\mathrm{jinc} = \frac{J_1(x)}{x}.
\end{align}
Again, $(u, v)$ and $(l, m)$ are the coordinate system in Fourier and image space, respectively.
Furthermore, the telescope's diameter $d$ and the angular distance between pointing position and source structure $\theta_{lm}$ are considered.
$J_1$ is the Bessel function of the first kind \citep{rime}.
The telescope response $\mathbf{E}(l, m)$ is illustrated in \autoref{fig:telescope_response}.
$\mathbf{X}_{\mathrm{q}}^{\mathrm{H}}$ corresponds to the conjugate transpose of the matrix $\mathbf{X}_{\mathrm{q}}$.
The summation over all image pixels is performed to calculate one complex visibility.

In this analysis, we use the B-configuration layout of the VLA, which was utilized for the FIRST observations.
The antenna positions are listed in \autoref{tab:antennas-vla}.
Utilizing the RIME enables the simulation of exact $(u, v)$ coverages.
\autoref{fig:example-visibilities} shows a simulated $(u, v)$ coverage using the above RIME formalism.
% The measurement settings used for the observational data are listed in \autoref{tab:parameters-obs}.

% \begin{table}
%     \centering
%     \caption{Parameters for the observational data from the VLA}
%     \begin{tabular}{lc}
%     \toprule
%     Parameter & Value \\
%     \midrule
%     Base frequency & \SI{1.0425}{\giga\hertz} \\
%     \# Frequency bands & \num{16} \\
%     Bandwidth & \SI{8}{\mega\hertz} \\
%     Channel offset & \SI{64}{\mega\hertz} \\
%     \bottomrule
%     \end{tabular}
%     \label{tab:parameters-obs}
% \end{table}

% The comparison reveals the agreement of scales and degree of coverage.
One of the characteristics of the VLA is directly visible in this image:
While the center of the image is well covered, the edges are poorly sampled owing to the relatively short baselines compared for example to the VLBA.
This property complicates the reconstruction at the edge of the visibility space.

% Figure environment removed

Since real observation depend on multiple observation parameters such as the correlator integration time or the number of scans per pointing, these parameters can be altered in our simulation framework.
\autoref{tab:parameters-vla} summarizes the parameters used for the simulations in this work.
In cases where multiple values are specified, these values serve as bounds of random values that are drawn within these bounds.
The parameters are altered for each new simulated observation.

\begin{table}
    \centering
    \caption{
    Observation parameters applied to simulate the data sets used in this work.
    In cases where multiple values are specified, these values serve as bounds of random values that are drawn within these bounds.
    }
    \begin{tabular}{lc}
    \toprule
    Sampling option & Value \\
    \midrule
    Image size & \SI{128}{\pixel} \\
    FOV center ra & [\SI{100}{\degree}, \SI{110}{\degree}] \\
    FOV center dec & [\SI{30}{\degree}, \SI{40}{\degree}] \\
    FOV size & 350 \\
    Corr. int. time & \SI{30}{\second} \\
    Scans & 2 \\
    Scan separation & \SI{360}{\second} \\
    Base frequency & \SI{1.365}{\giga\hertz} \\
    Bandwidths & \SI{3}{\mega\hertz} \\
    \# Bandwidths & 4 \\
    Channel offset & \SI{64}{\mega\hertz} \\
    \bottomrule
    \end{tabular}
    \label{tab:parameters-vla}
\end{table}

An additional noise corruption effect that occurs during radio interferometer observations results from the system noise.
This noise effect changes when using different bandwidths or correlator accumulation times.
The noise originating from a specific measurement process is Gaussian distributed with a standard deviation that is defined by
\begin{equation}
    \Delta S = \frac{1}{\eta_s} \frac{S_{\mathrm{SE}}}{\sqrt{2 \, \Delta\nu \, \tau_{\mathrm{acc}}}}.
\end{equation}
Here, $\eta_s$ is the system efficiency factor, $\Delta\nu$ corresponds to the observation's bandwidth, $\tau_{\mathrm{acc}}$ is the correlator accumulation time, and $S_{\mathrm{SE}}$ denotes the system equivalent flux density \citep{taylor}.
Values for $\Delta\nu$ and $\tau_{\mathrm{acc}}$ are taken from \autoref{tab:parameters-vla}, while $\eta_s = 0.93$ and $S_{\mathrm{SE}} = \SI{420}{\jansky}$ are taken from the VLA's specifications \cite{sefd}.
The noise drawn this way, which is in the order of \SI{10}{mJy}, is added separately to the real and the imaginary part of the simulated visibilities.
This noise handling technique enables the simulation of observed radio galaxies with different signal-to-noise ratios depending on the peak flux densities of the simulated radio galaxies.

Finally, the visibilities are saved to FITS files together with the meta data of the simulated observations.
We use our implementation of a FITS writer, which follows the specifications in AIPS Memo 117 \footnote{\url{http://www.aips.nrao.edu/aipsmemo.html}}.
Saving the simulations like this enables their readability and interpretability of established imaging tools like CASA \citep{casa} and \texttt{WSCLEAN} \citep{wsclean}.

Both established imaging software and our deep learning-based approach require input data on a regular grid or two-dimensional image data.
Therefore, the simulated visibilities have to be gridded.
In the context of the RIME simulations, we have implemented our own gridder which is slightly different from the established approach.
As with the gridder implemented in \texttt{WSCLEAN}, the grid can be defined with the help of the selected pixel size and number of pixels.
Afterwards our implementation does not perform a convolutional gridding, as \texttt{WSCLEAN} does, but we apply a two-dimensional histogram to grid the visibilities.
In this work, we choose a pixel size \SI{1.56}{\arcsecond} and an image size of $\SI{128}{\pixel} \times \SI{128}{\pixel}$, which corresponds to a field of view of \SI{200}{\arcsecond}.

Together with our college Stefan Fr√∂se, we have published our simulation routine as an open-source Python package called \texttt{pyvisgen} \citep{pyvisgen}.
With this RIME simulation framework, we have built a flexible basis for future simulations of radio interferometer observations.
Different corruption effects can be easily added.
Furthermore, our method can readily be adapted for other radio interferometer arrays by updating the interferometer characteristics and the antenna positions.