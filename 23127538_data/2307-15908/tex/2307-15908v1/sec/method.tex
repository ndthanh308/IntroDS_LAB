\section{Contact Model}


We begin construction of our contact model with the barrier energy,
\[
b(d, \hat{d})=
\Bigg\{\begin{array}{lr}
-\kappa \left(\frac{d}{\hat{d}} - 1\right)^2\ln \left(\frac{d}{\hat{d}}\right), & 0<d<\hat{d} \\
0 & d \geq \hat{d},
\end{array}
\]
evaluated on unsigned distances $d$, with a stiffness parameter $\kappa$ in units of \si{\pascal\cdot\meter}. Note that for larger distances the barrier is not active, it then activates when $d$ decreases below the small activation threshold $\hat{d}>0$. The barrier diverges as the distances tend to zero, preventing interpenetrations.

Assigning the barrier to distances $d(x_1,x_2) = \|x_1-x_2\|$ evaluated between material point pairs $x_1$ and $x_2$, we define the corresponding smoothed, contact energy density
$$b\big(d(x_1,x_2), \hat{d} \big).$$
For contact between a point $x \in \R^d$ and a curve $c(s):[0,1] \rightarrow \mathbb{R}^{d}$ the barrier is likewise defined by the unsigned distance between the point and curve  
$$d(x,c) = \min_{s\in [0,1]} d\big(x, c(s) \big).$$
This gives us a corresponding point-to-curve barrier energy 
$$b(d(x,c), \hat{d}),$$
or equivalently, as $b$ is monotonically decreasing, we can define it as
$$\max_{s\in [0,1]} b\big( d\big(x, c(s)\big),\hat{d} \big).$$

The contact energy for a curve $c_1$, with respect to a curve $c_2$, is then 
$$ P_{\to c_2}(c_1) = \int_{\ct \in [0,1]} \left(\max_{\cs \in [0,1]} b\left( d\big(c_1(\ct), c_2(s) \big),\hat{d} \right) \right) d\ct.$$
We correspondingly define the total contact potential between the two curves as  
\[P(c_1,c_2) = \tfrac{1}{2}\Big( P_{\to c_2}(c_1) + P_{\to c_1}(c_2) \Big).\]

Remark: in the limit, as $\hat{d}\rightarrow 0$, the energies $P_{\to c_2}(c_1)$ and $P_{\to c_1}(c_2)$ equivalently measure the total contact potential between the curves $c_1$ and $c_2$ while, for finite $\hat{d}$, we take their average.

With deformation we must consider self-contact. For a single curve $c$ the self-contact energy is then 
\[
\frac{1}{2} \int_{\ct \in [0,1]} \left(\max_{\cs \in [0,1] \excluderadius{r} \ct} b\left( d\big(c(\ct), c(\cs) \big), \hat{d} \right) \right) d\ct,
\]
where we define $\excluderadius{r}: \{x~|~a \leq x \leq b\} \times \R \times \R \mapsto \mathcal{P}(\R)$ as 
\[
[a,b] \excluderadius{r} \ct \defeq \{s \in [a, b]~|~|t - s| > r\},
\]
with $r\rightarrow0$.

With self-contact defined we are now able to directly generalize the contact potential to an arbitrary number of curves $\mathcal C = \{ c_i\}$ by treating all contacts in the domain as \emph{self-contacts}. We first (re)parameterize the domains across all curves in $\mathcal C$ with $s \in [0,1]$ so that $\mathcal C(s)$ traverses the material points across all curves $\{ c_i\}$ contiguously. The total contact potential is then simply
\[
P(\mathcal C) = \frac{1}{2} \int_{\ct\in [0,1]} \left(\max_{s\in [0,1] \excluderadius{r} \ct} b\left( d\big(\mathcal C(\ct), \mathcal C(\cs) \big),\hat{d} \right) \right) d\ct.
\]

For contact in $\R^3$, we extend our barrier potential to a set of surfaces $\mathcal S = \{S_i\}$.  We parameterize these surfaces by common (possibly discontinuous) coordinates $u \in \tilde M \subset \R^2$, so that $\mathcal S(u)$ traverses the material points across all surfaces $\{ S_i\}$ contiguously. The total contact potential is then 
\begin{align}
\label{eq:cont-3D-barrier=potential}
P(\mathcal S) = \frac{1}{2} \int_{u \in \tilde M} \left(\max_{v \in \tilde M \excluderadius{r} u} b\left( d\big(\mathcal S(u), \mathcal S(v) \big),\hat{d} \right) \right) du,
\end{align}
where we overload the operator $\excluderadius{r}: \mathcal{P}(\R^2) \times \R \times \R^2 \mapsto \mathcal{P}(\R^2)$ to be 
\[
\tilde{M} \excluderadius{r} u \defeq \{v \in \tilde{M}~|~\|u-v\|_2 > r\},
\]
with $r\rightarrow0$.

Remark: within an infinitesimal region around each point at coordinate $u$ (respectively $\ct$), we do not resolve contact; this region is empty in the limit. In turn this requires that $\hat{d}/r\rightarrow 0$ to ensure that the contact potential will not diverge for all configurations. In the discrete setting, with finite $\hat{d}$ and spatial mesh resolution, this requirement simplifies.




\section{Friction}

Frictional contact adds contact-driven dissipative forcing that opposes sliding. The magnitude and direction of these frictional forces, generated across contacting codomains are determined by choice of a friction model that is, in turn, parameterized by the sliding velocity field, the normal pressures exerted by contact, and the frictional coefficient between the contacting codomains. 

We model friction via the Maximal Dissipation Principle~\cite{moreau73unilateral} which posits frictional forces maximize the rate of dissipation in sliding up to a maximum magnitude imposed by a limit surface; e.g., Coulomb's constraint.

For contacts $k$ formed between any two surface (alternately curve) points $x_1$ and $x_2$, with corresponding velocities $\dot{x}_1$ and $\dot{x}_2$, we extract the sliding velocity as 
$$v_k = P(x_1,x_2)(\dot{x}_1 - \dot{x}_2),$$ 
where the sliding projection is $P = T(x_1,x_2) T(x_1,x_2)^T \in \R^{3 \times 3}$ with $T(x_1,x_2) \in \R^{3 \times 2}$ constructed from the unit column vectors orthogonal to $x_1-x_2$. %

Maximizing dissipation rate subject to the Coulomb constraint defines friction forces $f_k \in \R^3$ applied at $k$ as
\begin{align}
\begin{split}
f_k = \argmin_{f} \> f^T v_k \> \> \text{s.t.} \> \> \|f\| \leq \mu_k \lambda_k,
   \end{split}
 \label{eq:frictionForceDef}
\end{align}
with $\mu_k$ the local frictional coefficient and $\lambda_k$ the magnitude of the normal force exerted by the contact barrier between points $x_1$ and $x_2$.
Equivalently we have 
\begin{align}
\begin{split}
f_k \in -\partial F_k(v_k),
   \end{split}
 \label{eq:frictionPotential}
\end{align}
with a nonsmooth energy  
$$F_k(v_k) = \mu_k \lambda_k \| v_k \|$$
encoding the transitions between sticking and sliding behaviors corresponding to the varying active sets of \cref{eq:frictionForceDef}.

\begin{wrapfigure}{r}{0.3\textwidth}
    \centering
    % Figure removed 
    \vspace*{-15pt}
    \caption{Plot of \cref{eq:friction_mollifier} and its derivatives ($\epsilon_v = 1$ for better visualization).}
    \label{fig:friciton_mollifier}
\end{wrapfigure}

\subsection{Smoothed friction}

We formulate friction with a smooth dissipative pseudo-potential. We start by mollifying $F_k$ with 
$$D_k(v_k) = \mu \lambda_k m_{\epsilon_v}(\|v_k\|), $$
where 
\begin{equation}
\label{eq:friction_mollifier}
m_{\epsilon_v}(s) = 
    \begin{cases} 
      -\frac{s^3}{3\epsilon_v^2} +\frac{s^2}{\epsilon_v} + \frac{\epsilon_v}{3}, & s < \epsilon_v \\
      s, & s \geq \epsilon_v 
   \end{cases}    
\end{equation}
approximates the jump conditions (see \cref{fig:friciton_mollifier}) and $\epsilon_v$ (in units of \si{\meter/\second}) defines the range below which small sliding velocities are resolved as static. Friction forces are then $$f_k = -\nabla D_k(v_k),$$ and better approximate the nonsmooth slip-stick transitions as $\epsilon_v \to 0$.

\subsection{Integration}

For a pair of \emph{contacting} points $x_1$ and $x_2$ the dissipative energy is then 
$$D(\dot x_1, \dot x_2, x_1, x_2) = \mu \ \lambda(x_1, x_2)  \ m_{\epsilon_v}\big( \| P(x_1,x_2)\ (\dot x_1 - \dot x_2)\| \big),$$ where 
$$\lambda(x_1, x_2) = -\frac {\partial b\big(d(x_1, x_2)\big)}{\partial d},$$ is the (positive) contact force magnitude between points $x_1$ and $x_2$, and the friction force applied between points $x_1$ and $x_2$ is correspondingly 
$$f(\dot x_1, \dot x_2, x_1, x_2) = - \nabla_{(\dot x_1, \dot x_2)} D(\dot x_1, \dot x_2, x_1, x_2).$$

We next parameterize collections of curves $\mathcal C = \{c_i\}$ and surfaces $\mathcal S = \{S_i\}$ in both space (respectively $s \in [0,1]$ and  $u \in \tilde M \subset \R^2$) and time $\ct \in \R$. In the following we continue to reserve overdots for \emph{time} derivatives and, unless needed, do not explicitly include time parameters, e.g. we have $c(s) = c(s,\ct)$ and $\dot c(s) = \dot c(s,\ct) = \partial c(s,\ct) / \partial \ct$. 
 Then, the total, dissipative friction potential for a system of curves is 
 \begin{align*}
 D(\dot{\mathcal C}, \mathcal C) = \frac{1}{2} &\int_{s\in [0,1]} D\Big(\dot{\mathcal  C}(s), \dot{\mathcal C}(\ell[s]), \mathcal C(s), \mathcal C(\ell[s]) \Big) \ ds \> \text{with}\\
 &\ell[s] = \argmin_{u\in [0,1] \excluderadius{r} s} d\Big(\mathcal C(s), \mathcal C(u) \Big),
 \end{align*}
 while the corresponding dissipative friction potential for surfaces is
  \begin{align*}
 D(\dot{\mathcal S}, \mathcal S) = \frac{1}{2} & \int_{u \in \tilde M} D\Big(\dot{\mathcal S}(u), \dot{\mathcal S}(\ell[u]), \mathcal S(u), \mathcal S(\ell[u]) \Big) \ du \> \text{with}\\
 &\ell[u] = \argmin_{v \in \tilde M \excluderadius{r} u} d\Big(\mathcal S(u), \mathcal S(v) \Big).
 \end{align*}



\section{Contact Spatial Discretization}
\label{sec:contact-discretization}

In the discrete setting we apply piecewise linear, compatible discretizations of curves with edges, areas (2D) and surfaces (3D) with triangles, and volumes (3D) with tetrahedra. Here we have two tasks. First, we integrate the contact potentials over boundary (edge and triangle) elements and second, we smoothly approximate the $\max$ operator in these integrals so that we can efficiently solve the resulting nonlinear problems (see \cref{sec:numerical-solution}) for statics and dynamic time-stepping with second-order, Newton-type methods. 

In the following we denote the computational mesh for contact and friction potentials over the set of \emph{boundary} vertices $V$, \emph{boundary} edges $E$, and \emph{boundary} triangles (3D) $T$. 

\subsection{Discretization and Numerical Integration}

We begin by defining our curve discretization with polyline geometry. As in the smooth case we can parameterize the domain across all polylines with $s \in [0,1]$ so that $p(s):[0,1] \rightarrow \mathbb{R}^{d}$ traverses all material points, across all edges $e \in E$ in the polylines contiguously. The corresponding curve contact potential is then 
\begin{align}
    \frac{1}{2}\int_{s\in [0,1]} \left(\max_{e\in E\setminus p(s)} b\big( d(p(s), e),\hat{d}\big) \right) \ ds,
    \label{eq:pw_linear_curve}
\end{align}
where $E\setminus p$ is the set of boundary edges that do not contain the point $p$.

Applying polyline vertices as nodes (and quadrature points), we numerically integrate the curve contact potential. For each nodal position $x \in V$ we then have a corresponding material space coordinate $\bar x \in \bar V$. Piecewise linear integration of the curve barrier is then 
\[ \frac{1}{2}\sum_{\bar x \in \bar V} w_{\bar x} \left(\max_{e\in E\setminus x(\bar x)} b\Big( d\big(x(\bar x), e\big),\hat{d} \Big) \right), \]
where $w_{\bar x}$ are the quadrature weights, each given by half the sum of the lengths (in material space) of the two boundary edges incident to ${\bar x}$.
Correspondingly, following the same steps, piecewise-linear integration of the surface barrier over a triangulated boundary mesh in 3D gives the surface contact potential
\begin{align}
    \frac{1}{2} \sum_{\bar x \in \bar V}  w_{\bar x} \left(\max_{\ct \in T\setminus x(\bar x)} b\Big( d\big(x(\bar x), \ct\big),\hat{d} \Big) \right),
    \label{eq:pw_linear_surface}
\end{align}
where $T\setminus x$ is the set of boundary faces that do not contain $x$, and $w_{\bar x}$ are the quadrature weights, each given by one third of the sum of the areas (in material space) of the boundary triangles incident to ${\bar x}$.

\subsection{Smoothly Approximating the Max Function}
Our next step is to smoothly approximate the $\max$ operator in the contact potentials.
A natural option to consider would be a softmax approximator. Using the discrete curve energy as a concrete example we could smooth the max operator with the $p$-norm as
\begin{align*}
    \frac{1}{2} \sum_{\bar x \in \bar V}  w_{\bar x} \left(\sum_{e \in E\setminus x(\bar x)} b\Big( d\big(x(\bar x), e\big),\hat{d} \Big)^p \right)^{1/p}.
\end{align*}
We note, however, that this would significantly decrease sparsity in subsequent numerical solves by increasing stencil-size per contact evaluation.  At the same time, accuracy would require large $p$ and so additional ill-scaling also contributing to significant increase in numerical solver costs. Similar issues arise for LogSumExp approximation, while sparsity increase could be addressed in the $p$-norm formulation, by dropping the outer normalizing $1/p$ term, but doing so would generate increasingly ill-scaled and ill-conditioned problems with the necessary further increases in $p$ required for improved accuracy in the approximation. 


We leave investigations of these above approximators to future work. Here, to smoothly approximate the barrier energies with accuracy \emph{and} computational efficiency we directly consider the boundary geometry. We begin with an evaluation of the max barrier at a point $x$ where at least one edge in $E\setminus x$ (respectively triangle in $T\setminus x$) is closer than $\hat d$. If we consider a rough \emph{starting} approximation by summation over all barriers between $x$ and nonincident boundary elements, clearly one of the nonzero summands corresponds to the desired max. In the lucky case, when all other boundary elements are farther than $\hat d$, this approximation is sharp. However, in cases where more than one boundary element is within the $\hat d$ distance of $x$ this approximation will overestimate the max barrier with the incorrect addition of undesirable barriers from these close-by elements. We require $\hat d$ small with respect to edge length. Then, when this set of ``close-enough'' boundary elements form a convex curve (respectively surface) w.r.t. the evaluation point they each contribute an extra barrier contribution that is exactly evaluated by a distance to a vertex (respectively edges) incident to the closest boundary edge (respectively boundary triangle). 
Likewise, when they form a nonconvex curve (respectively surface) the extraneous barrier contributions are lower-bounded by barriers evaluated with vertices (respectively edges) incident to the closest edge (respectively triangle).

% Figure environment removed

Our resulting approximators for curves and surfaces are then respectively  
\begin{align*}
\Psi_c(x) &= \sum_{e\in E\setminus x} b( d(x, e),\hat{d}) \quad - \sum_{x_2\in V_{int}\setminus x}b( d(x, x_2),\hat{d}) \> \approx \max_{e\in E\setminus x} b( d(x, e),\hat{d}) ,
\end{align*} 
and
\begin{align*}
\Psi_s(x) &= \sum_{t\in T\setminus x} b( d(x, t),\hat{d}) 
\quad - \sum_{e\in E_{int}\setminus x} b( d(x, e),\hat{d})
\quad + \sum_{x_2\in V_{int}\setminus x}b( d(x, x_2),\hat{d}) \\
&\approx \max_{t\in T\setminus x} b( d(x, t),\hat{d}),
\end{align*}
where $\Vint \subseteq V$ is the subset of internal curve/surface nodes (e.g., vertices with valence two for curves) and $\Eint \subseteq E$ is the subset of internal surface edges (i.e., edges incident to two triangles). 
For locally convex regions this estimator is tight while remaining smooth. In turn, for nonconvex regions it improves over direct summation (see \cref{fig:corner,fig:dist_field_comp}). 

% Figure environment removed

The corresponding discrete barrier potentials are then simply
$$P_c(V) = \sum_{x \in V} w_x \Psi_c(x),$$ 
for curves, and 
$$P_s(V) = \sum_{x \in V} w_x \Psi_s(x),$$ for surfaces, where we simplify with $w_x = w_{\bar x}$ defined appropriately, per domain, as covered above.

Remark: For diminishing $\hat{d}$, the (naive) direct summation over all contact pairings, without correction (e.g., $\sum_{t\in T\setminus x} b( d(x, t),\hat{d})$), becomes an increasingly good approximation to the $\max$-based barrier energy density as the number of extraneous (not closest but still within $\hat d$ distance) surface elements becomes smaller and smaller.

\subsection{Edge Quadrature}

With the above discretization, we ensure that modeled geometries will remain free of point-edge and point-triangle interpenetrations independent of the resolution applied. This is because we have defined our barriers on point-edge and point-triangle pairings.   Likewise, as we show in \cref{sec:3D-convergence} this discretization converges under refinement so that edge-edge intersections also vanish. However, in many practical applications, it is desirable to prevent edge-edge intersections even at moderate resolution. To do so we additionally construct an alternate, edge-based quadrature of the surface barrier.


With an edge quadrature we discretize \cref{eq:cont-3D-barrier=potential} with
\[\frac{1}{2}\sum_{\bar{e}\in E} w_{e} (\max_{t\in T\setminus \bar{e}} b( d(e, t),\hat{d})).\]
Here $w_{e}$ are the quadrature weights, each given by one-third of the sum of the areas (in material space) of the boundary triangles incident to ${e}$, using edge-surface distance to approximate the average of the point-surface distances for surface points near each edge. 
For efficiency, we then further approximate edge-surface distances in our barriers with edge-edge distances,
\[\frac{1}{2}\sum_{e \in E} w_{e} (\max_{e_2\in E\setminus e} b( d(e, e_2),\hat{d})),\]
where $E \setminus e$ is the set of surface edges non-adjacent to $e$.
Approximating $\max$ with our summation we then obtain the edge-edge barriers 
\begin{align*}
    \Psi_w(e) &= \sum_{e_2 \in E\setminus e} b(d(e, e_2), \hat{d}) - \sum_{x_1\in V\setminus e} \> \big(\rho(x_1)-1 \big) \> b( d(x_1, e),\hat{d}) \\ 
    & \approx \max_{e_2\in E\setminus e} b( d(e, e_2),\hat{d}),\\
\end{align*}    
where $\rho(x_1)$ gives the number of surface edges incident to node $x_1$, and $V \setminus e$ is the set surface nodes that are not incident to edge $e$. 
The corresponding wireframe edge-barrier potential is then    
\begin{align*}    
    P_w(E) &= \frac{1}{2}\sum_{e\in E} w_{e} \Psi_w(e).
\end{align*}



\subsubsection{Combined Discretization}

When desired, to ensure complete non-in\-tersection of 3D surfaces, independent of discretization resolution, we then jointly employ the above edge-based quadrature in combination with our node-based quadrature. The total, combined contact potential for surfaces is then 
\[\alpha P_s(V) + (1-\alpha)P_w(E),\]
where $\alpha \in (0, 1]$ (averaging with $\alpha = 1/2$ is sufficient) so that under combined spatial ($x$) and distance ($\hat{d}$) refinement both energies converge. Alternately when small edge-edge intersections are acceptable for modeling errors we can apply solely the node-based potential $P_s(V)$.



\input{sec/positivity_proof}







\section{Time Discretization}
\label{sec:time-stepper}

After spatial discretization we start with $n$ nodal positions $x \in \R^d$ in the computational mesh, concatenated as degrees of freedom in the vector, $\bfi{x} \in \R^{d n}$. Correspondingly, we have a finite element mass matrix, $M$, and total deformation energy, $U(\bfi{x})$, defined on the material domain. 

Discretizing in time, we solve time steps variationally (see \cref{sec:numerical-solution} below). To do so we minimize discrete energies whose stationary points give each applied numerical time integration method's positional update \cite{oritz1999variational}. At time $t$, we have prior nodal positions $\bfi x^{t}, \bfi x^{t-1},...$  and velocities $\bfi v^{t}, \bfi v^{t-1},...$ . Applying a time step size of $h$, we then compute the time step update for the next nodal \emph{positions} $\bfi x^{t+1}$ as the minimization of an appropriately constructed Incremental Potential (IP)  \cite{kane2000variational}, $E\left(\bfi x, h \right)$, over valid $\bfi x \in \mathbb{R}^{d n}$ so that 
$$\bfi x^{t+1} = \argmin_{\bfi x} E\left(\bfi x, h \right).$$
For each such IP we accompany it with a velocity update function $v(\cdot)$, that correspondingly defines the time step method's velocity update, $$\bfi v^{t+1} = \bfi v(\bfi x^{t+1}),$$ or, applied per node as $v^{t+1} = v(x^{t+1})$.

As a particular example consider Newmark with $\beta = \tfrac{1}{4}$ and $\gamma = \tfrac{1}{2}$. With  applied external forces, $f_{\text{ext}}$, we have the Newmark IP,  
\begin{align}
E\left(\bfi x, h \right) & = \tfrac{1}{2} \|\bfi x - \tilde {\bfi x}\|_M^2 + \tfrac{h^2}{4} W(\bfi x), \> \text{with}\\
 \tilde {\bfi x} &= \bfi x^t + h \bfi v^t +  \tfrac{h^2}{2} M^{-1}  f{_\text{ext}} - \tfrac{h^2}{4} M^{-1}  \nabla W(\bfi x^t),
\end{align}
and its corresponding velocity update
$$
{\bfi v}(\bfi x) = \tfrac{2}{h} (\bfi x - \bfi x^t) - \bfi v^t, 
$$
with $W(\bfi x)$ the sum of internal ($U$), barrier (see \cref{sec:contact-discretization}) and (when applicable) friction (see \cref{sec:friction-discretization}) energies. 





\section{Friction Discretization}
\label{sec:friction-discretization}

Following our contact barrier discretization we next smoothly approximate friction forces so the we can continue to employ Newton-type methods to solve contact with friction and numerically integrate the corresponding \emph{contact-coupled} energy over the curve and surface domains to form a dissipative potential.


We first construct discrete friction potentials corresponding with piecewise-linear discretizations corresponding to our barrier discretizations. On the polyline and triangular surface meshes they are respectively 
\begin{align*} 
\frac{1}{2}&\sum_{\bar x \in \bar V} w_{\bar x} D\Big( v\big[x(\bar x)\big], v\big[\ell_c[x(\bar x)]\big], x(\bar x), \ell_c[x(\bar x)] \Big) \>\> \text{with} \>\>
\ell_c[x_1] = \argmin_{x_2 \in e, \ e\in E\setminus x_1} d(x_1,x_2), 
\end{align*}
and 
\begin{align*} 
\frac{1}{2}&\sum_{\bar x \in \bar V} w_{\bar x} D\Big( v\big[x(\bar x)\big], v\big[\ell_s[x(\bar x)]\big], x(\bar x), \ell_s[x(\bar x)] \Big) \>\> \text{with} \>\>
\ell_s[x_1] = \argmin_{x_2 \in t, \ t \in T\setminus x_1} d(x_1,x_2). 
\end{align*}

Following the above smooth approximation of the max operator in the contact barrier via differences, our corresponding curve and surface friction energies are then respectively
\begin{align*}
\Phi_c(x) & =\sum_{e \in E \setminus x} D(v(x), v(e, x), x, p(e, x)) \quad-\sum_{x_2 \in V_{i n t} \setminus x} D\left(v(x), v\left(x_2\right), x_1, x_2\right) \\
& \approx D\left(v(x), v\left(\ell_e[x(\bar{x})]\right), x, \ell_e[x(\bar{x})]\right),
\end{align*}
and
\begin{align*}
\Phi_s(x) & =\sum_{t \in T \setminus x} D(v(x), v(t, x), x, p(t, x))-\sum_{e \in E_{i n t} \setminus x} D(v(x), v(e, x), x, p(e, x)) \\
& +\sum_{x_2 \in V_{i n t} \setminus x} D\left(v(x), v\left(x_2\right), x, x_2\right) \\
& \approx D\left(v(x), v\left(\ell_s[x]\right), x, \ell_s[x]\right),
\end{align*}
where $v(s, x)$ and $p(s, x)$ respectively return the discrete velocity and position of the closest point in a simplex $s$ (edge or face) to a point $x$. In turn, the final, discrete, dissipative friction potential is
$$D_c(V) = \sum_{x \in V} w_x \Phi_c(x),$$ 
for curves, and 
$$D_s(V) = \sum_{x \in V} w_x \Phi_s(x),$$ for surfaces, where we simplify with $w_x = w_{\bar x}$ defined appropriately, per domain, as covered above. Corresponding total friction forces are then
$$f_c(V) = -\sum_{x \in V} w_x \frac{\partial \Phi_c(x)}{\partial v},$$ 
and
$$f_s(V) = - \sum_{x \in V} w_x \frac{\partial \Phi_s(x)}{\partial v}.$$

\section{Numerical Solution}
\label{sec:numerical-solution}

As covered in \cref{sec:time-stepper}, after discretization each simulation step solution (dynamic, quasistatic, or static) is generated by \emph{locally} minimizing the applied incremental potential (IP), $E(\bfi x, h)$. To minimize $E$ we apply a Projected Newton solver customized for handling barrier potentials. Projected Newton (PN) methods are second-order unconstrained optimization strategies for minimizing nonlinear, nonconvex functions where the Hessian may be indefinite. At each Newton iteration, we project all \emph{local} energy stencils' (including barrier and friction) Hessians to the cone of symmetric positive semi-definite (PSD) matrices prior to assembly. 

While our barrier energies diverge at contact, this alone does not guarantee that a Newton iteration process will not violate the distance constraints ($d>0$) for all possible contact pairs. Standard line search~\cite{nocedal2006numerical}, e.g., back-tracking with Wolfe conditions, can find an energy decrease in configurations that have passed through intersection, resulting in a step that takes the geometry out of the admissible set. To ensure feasibility for all position updates internal to the solver we apply a continuous, intersection-aware line search filter for 3D meshes. In each line search we first apply a continuous collision detection (CCD)~\cite{li2021codimensional} to conservatively compute a large, but always feasible, step size along the descent direction. We then apply back-tracking line search from this step size upper bound to obtain energy decrease. CCD then certifies that each step taken is always valid. 
When we apply friction we follow Li et al.'s\ \cite{Li2020IPC} lagged-iteration method and supplement the incremental potential over successive iterated Newton solves, per time step, with a pre-scaled pseudo-potential energy that holds contact-force magnitudes and sliding projections fixed from the prior Newton solve, until convergence with current contact forces and projections. When we apply barrier-based energy densities for our elasticity potential, $U$, e.g., neo-Hookean, we combine an inversion-aware line search filter~\cite{smith2015bijective} that additionally pre-filters the search direction for a large but always inversion-free step size. In combination this guarantees that every step of every position change in the Newton iteration process (and so simulation) applies an intersection- and (when desired)  inversion-free update.

\paragraph{Termination} 
For termination of the solver we check convergence with the infinity norm of the Newton search direction (Newton decrement) scaled by time step (but \emph{unscaled} by line-search step size). Specifically we solve each time step's barrier IP to an accuracy satisfying $\frac{1}{h} \| H^{-1} \nabla E(x) \|_\infty < \epsilon_d$. This provides affine invariance and a characteristic measure using the Hessian's natural scaling as metric. Accuracy is then directly defined by $\epsilon_d$ in physical units of velocity (and so is independent of time-step size applied) and consistently measures quadratically approximated distance to local optima across examples with varying scales and conditions.


\paragraph{Solution accuracy} 
Each such numerically converged time-step solution satisfies accuracy criteria for choice of applied numerical time integration method.
Discrete \emph{momentum balance} is directly satisfied as standard after convergence. For example, in a simple illustrative case with implicit Euler we have
\begin{align*}
\label{eq:ie_em}
\nabla_x  E(\bfi x,h) = 0 \implies M\left(\frac{x-\hat{x}}{h^2}\right) = - \nabla W(x),
\end{align*}
Comparable discrete momentum balance follows when we apply alternate time integration methods, e.g. implicit Newmark.
Here contact forces, per surface vertex (and, when applied, edge) stencils $k$ are then  
\begin{align*}
- w_k \frac{\partial \Psi_k(x_k)}{\partial x_k}. 
\end{align*}
In turn \emph{positivity}, of these forces is covered in detail in Section\ \ref{sec:positivity} above.
Line-search filtering then guarantees \emph{admissibility} (non-intersection) and, when applicable, for barrier-type elasticity energy densities, \emph{global injectivity}. Finally, our barrier definition ensures that a \emph{discrete complimentarity} is always satisfied as contact forces can not be applied at distance more than $\hat{d}$ away.


