% \section{Paper structure suggestion}
% \begin{enumerate}
%     \item Intro - discuss primality and the three parameters (dimension, number, size), and that we only talk about the first two. Also discuss Regularity as an almost ``degenerate'' case. Have an example?
%     \item Prelim (defining $k$-CN and $k$-DCN, defining projections on dimensions)
%     \item Primality and dimension minimization: define primality with the two parameters above. Perhaps write that a $d$-CN is Prime$(k,m)$ if it cannot be written as an intersection of at most $m$ $k$-CNs, and call it Prime if it is Prime$(k,m)$ for all $k<d$ and all $m\in \bbN$.
    
%     Give basic result about $k$-DCN and projections, and show that for $k$-DCN minimization and primality are the same. Perhaps discuss unambiguity.
%     \item A Prime 2-CN: example and proof.
%     \item Undecidability of Primality and of Minimization. Reduction using the example to minimization and to primality.
%     \item Regularity of $d$-DCN is decidable
%     \item Examples (possibly with a better section name). Showing the various separation results we have.
%     \item Discussion and Open Problems
% \end{enumerate}
\section{Introduction}
\label{sec:introduction}


% \shtodo{Some intro/motivation ideas:\\
% 1. Regularity is indeed a form of dimension minimization. However, the difference between REG and CN languages is known to be significant, whereas the difference between e.g., 1CN and 2CN is not understood at all.
% More precisely, the difference between REG and 1CN corresponds to ``finite memory'' v.s. ``infinite memory'', whereas differences between e.g., 1CN and 2CN are more delicate, and both lie within infinite memory.

% 2. Given the effort to understand e.g., 3-dim VASS (find references, I think Czerwinski's working on this), it is quite justified to look at small \textbf{nonzero} dimensions. 

% 3. For VASS, 1-dim and 2-dim are related, in that both are flat. Our primality result might suggest that there are more significant differences in the presence of letters.
% }
% \shtodo{The structure of the intro should be something like: \\
% 1. VASS definition (mentioning the term ``dimension''). CN definition (labelled VASS).\\
% 2. VASS and CN are useful and important, but their problems are really difficult.
% 3. We would like to solve the difficult problems by simplifying the model. There are many ways to do that.
% 4. One observation is that problems on VASS become easier in lower dimensions. This gives rise to the idea of somehow decomposing a VASS to lower dimension ones.
% 5. Such decomposition can be done by intersections, as studied in the well known and very interesting notion of primality.
% 6. In particular, we can look at dimension minimization.
% 7. Even more in particular, we can look at regularity.
% 8. We study all the above, showing that bla bla bla.
% }
A \emph{Counter Net of dimension $k$} ($k$-CN) is a finite-state automaton equipped with $k$ integer counters that are not allowed to become negative, but do not have explicit zero tests (see example in \cref{subfig:2CN_intro}). 
% \gatodo{Suggestion: add a sentence that starts with "Technically," and describe the syntax and semantics of $k$-CNs more, well, technically. I think this is good for a reader who is only vaguely familiar in VASS.}
% \shtodo{I think the figure should be enough for the intro.}
This language-recognition model can be thought of as an alphabet-labelled Vector Addition System with States (VASS), some of whose states are accepting~\cite{czerwinski2020universality}. 
A $k$-CN $\cA$ over alphabet $\Sigma$ \emph{accepts} a word $w\in \Sigma^*$ if there is a run of $\cA$ on it that ends in an accepting state in which the counters stay non-negative. The \emph{language} of $\cA$ is the set $\lang(\cA)$ of words accepted by $\cA$.

$k$-CN are a natural model of concurrency and are closely related (and equivalent, in some senses) to labelled Petri Nets. These models have received significant attention over the  years~\cite{cabasino2013diagnosability,czerwinski2020universality,esparza2005decidability,figueira2019co,greibach1978remarks,hack1976petri,render2009rational}, with specific interest in the $k=1$ case, namely One Counter Nets~\cite{hofman2013decidability,hofman2014trace,almagor2020parametrized,almagor2022determinization}. 
Unfortunately, most decision problems for $k$-CN are notoriously difficult, and are often undecidable~\cite{almagor2020parametrized,almagor2022determinization}. In particular, $k$-CN subsume VASS and Petri Nets, for which many problems are known to be Ackermann-complete (e.g., the recent breakthrough for reachability~\cite{czerwinski2022reachability,leroux2022reachability}).

In recent years it was noticed that for low dimensions, decision problems for VASS (and extensions thereof) become more tractable (see, e.g.,~\cite{czerwinski2019new,czerwinski2020reachability,czerwinski2021improved,finkel2018reachability}). For example, reachability in dimensions $1$ and $2$ (and counter updates encoded in binary) the problem is 
\NP-complete~\cite{haase2009reachability} and \PSPACE-complete~\cite{blondin2021reachability}, respectively.

A natural question, therefore, is whether we can \emph{decrease} the dimension of a given a $k$-CN, while maintaining its language, in order to facilitate reasoning about it. 
% \gatodo{"facilitate reasoning" sounds a bit weird}
% \shtodo{Why? the dictionary definition is ``make (an action or process) easy or easier.''}
We tackle this question in this work by introducing two approaches.
% \gatodo{Did you consider flipping the order of presentation: primality then minimality as a special case? I'm not sure myself.} 
% \shtodo{I did, but it becomes awkward -- the definition of primality is not straightforward, so the reader would ponder why not do something much simpler.}
The first is straightforward \emph{dimension minimality}: 
given a $k$-CN, does there exist a $d$-CN $\cB$ with the same language for some $d<k$? 

The second approach is \emph{primality} (and its dual -- \emph{compositeness}), whereby we ask whether there exists some $d<k$ and multiple $d$-CNs $\cB_1,\ldots,\cB_n$ such that $L(\cA)=\bigcap_{i=1}^n \lang(\cB_i)$. That is, we ask whether the language of $\cA$ can be decomposed as an intersection of several smaller-dimension CNs. 
Intuitively, in a composite $k$-CN the usage of the counters can be ``split'' across several smaller-dimension CNs, which then allows checking properties (e.g., universality) on each conjunct separately. 
We illustrate the definition in \cref{fig:composite_2CN_intro}.
% Figure environment removed

The notion of primality has been studied for regular languages in~\cite{kupferman2015prime,jecker2020unary,jecker2021decomposing} (the exact complexity of deciding primality is still open). There, an automaton is composite if it can be written as an intersection of automata with fewer \emph{states}. 

In this work we introduce primality for CNs, and focus on \emph{dimension} as a measure of size, a notion which does not exist for regular languages. Thus, unlike regular languages, the differences between prime and non-prime CNs are not just in succinctness, but actually in expressiveness (as we show). 

We parameterise primality/compositeness by the dimension $d$ and the number $n$ of factors. Thus, a $k$-CN $\cA$ is \emph{$(d,n)$-composite} if it can be written as the intersection above. Then, $\cA$ is \emph{composite} if it is $(d,n)$-composite for some $d<k$ and $n\in \bbN$. Under this view, we can obtain dimension minimality as a particular case: $\cA$ is dimension minimal if it is not $(k-1,1)$-composite. Another particular problem that can be viewed as primality is \emph{regularity}, namely whether $\lang(\cA)$ is regular. Indeed, $\lang(\cA)$ is regular if and only if $\cA$ is $(0,1)$-composite, since a $0$-CN is just an NFA. Since regularity is already undecidable for $1$-CN~\cite{valk1981petri,AlmagorY22}, it follows that deciding whether a $k$-CN is $(d,n)$-composite is undecidable. Moreover, it follows that primality and dimension minimality are undecidable for $1$-CN. 

The easy undecidability above is not surprising: the huge difference in expressive power between $1$-CN and regular languages is well understood. In contrast, the difference between e.g., $1$-CN and $2$-CN (and in general the effect of the dimension on the expressive power beyond regular languages) is poorly understood (e.g., both 1-VASS and 2-VASS are known to be \emph{flat}~\cite{leroux2004flatness,blondin2021reachability}, but differ in their complexity of reachability).

Our goal in this work is to shed light on these differences. In \cref{sec:prime-2vass} we give a concrete example of a prime $2$-CN, which turns out to be technically challenging. Using this example, we obtain in~\cref{sec:primality_undecidable} the undecidability of primality and of dimension minimality for $2$-CN. On a more ``positive'' side, we show in~\cref{sec:decidable_DCN} that regularity of $k$-DCN is decidable. In~\cref{sec:dimension_vs_nondet} we explore the tradeoff in expressiveness between increasing the dimension and introducing nondeterminism. We conclude with a discussion and some open problems in~\cref{sec:discussion}.
%\shtodo{complete this paragraph with paper organization, when we're done.}
\shtodo{Add later: due to space constraints, most proofs appear in the appendix.}



%%%%%%%%%%%%%%%%%%%%%


% \emph{Vector Addition Systems with States} (VASS) are finite state machines equipped with a set of weak counters that cannot decrease below zero. 
% A VASS consists of a finite set of states, a finite number $d$ of integer counters, and a set of transitions. When taking a transition - a VASS can add or subtract from any of the counters, given that the result is non-negative. Optionally, transitions of a VASS can be labeled with a letter from a finite alphabet. We will refer to $d$ as the \emph{dimension} of a VASS, and refer to labeled VASS as \emph{Counter Nets}.
% \shtodo{I think we should start with counter nets, and mention the connection to VASS afterwards (like the abstract). Also mention accepting states.}

% VASSes originated as an essentially equivalent alternative formalism of Petri nets - a well studied model proposed originally by Petri in 1962 \cite{petri1962kommunikation} that has become popular since it is well-suited for modeling various concurrent systems, in fields ranging from biology to economics \cite{heiner2008petri, reddy1996qualitative, van1998application}.
% Over the years, mainstream research about VASS focused on the problem of reachability - given a VASS $\cV$, an initial configuration $s$ and a target configuration $t$, is $t$ reachable from $s$ in $\cV$? This problem troubled researchers from the late 70's and early 80's \cite{lipton1976reachability, mayr1981algorithm} until it was finally put to rest in 2022 by CzerwiÅ„ski and Orlikowski \shtodo{Wasn't there another paper in parallel? It would be good to cite both.} \aytodo{I've done a search on this and couldn't come up with anything that you could be referring to. Which one did you have in mind?}
% \shtodo{This:~\cite{leroux2022reachability}.}
% , who have shown that it is Ackermann-Complete \cite{czerwinski2022reachability}.

% Over the years, as the study of VASSes progressed, it became apparent that indeed, as common sense may indicate, 
% \shtodo{The sentence above is still somewhat a waste of words, since it doesn't really say anything except denote the passage of time.}
% lower VASS dimension
% \shcomm{lower-dimension VASS}
% admits better complexity for several decision problems. Reachability, for example, is, as stated,\shcomm{if it's ``as stated'' then we need to rephrase so that it's only stated once.} Ackermann complete for VASS of unbounded dimension. For lower dimensions, however, the picture is quite different. 1-VASS reachability is NL-complete for unary encoding, and NP-complete for binary encoding \cite{haase2009reachability}. 2-VASS reachability is, likewise, NL-complete for unary encoding \cite{englert2016reachability}, but PSPACE-complete for binary encodings \cite{blondin2015reachability}. 
% \shtodo{The above is problematic, since we're actually looking at CN, not VASS, and things are different. So I think all of this should come under ``related work'' later on, and that here we should be slightly more vague about what exactly is easy/hard, or give concrete examples from CN (e.g., universality of OCN, although it's not clear that it's a good example).}

% VASS of lower dimension admit better complexities. Therefore it is only natural\shcomm{not ``it's only natural'', but maybe ``a natural notion of decomposition is...''} to define and address the notion of decomposing a VASS into VASSes of a lower dimension. In general, the notion of language compositionality has been tackled in the context of regular languages \cite{kupferman2015prime, jecker2020unary}. However, to our knowledge, this notion of compositionality, or conversely, of primality, has never been examined in the context of VASSes. 
% \shtodo{For the paragraph above -- most people aren't really familiar with primality, we should explain what it is first. Moreover, we should explain that this is intuition, and we take it to a different direction by looking at the dimension, rather than number of states.}

% In light of these past works on regular languages, the main approach to VASS simplification that we take is tackling VASS Primality - given a labeled $k$-VASS $\cV$, are there $k'$-VASSes $\cV_1,\ldots \cV_n$ for $k'<k$ such that $\bigcap_{1 \leq i \leq n}\lang(\cV_i)=\lang(\cA)$? While more complex, it is an important problem to address, and its analysis sheds light on some of the complexities behind VASS simplification.
% \shtodo{This needs more emphasis about why we chose this definition.}

% A derivative of this problem is that of dimension minimization - given a labeled $k$-VASS $\cV$ - is there a labeled $k'$-VASS $\cV'$ for some $k'<k$ such that $\lang(\cV')=\lang(\cV)$? At first glance - this may look like a challenge even more complex than VASS regularity - a problem known to be undecidable, but this hypothesis is far from obvious. In its essence - VASS regularity asks whether the language of a VASS can be expressed \emph{with finite memory}, while VASS dimension minimization strives to express a VASS' language with an inifinite, though less expressive type of memory. The essence of VASS dimension minimization, therefore, has to do with the difference between expressiveness of labeled VASS of different dimensions - a difference hardly understood. An example of this gap in understanding is our lack of characterization of languages that can be recognized by a labeled 2-VASS, but not by a labeled 1-VASS. Indeed, to our knowledge, such proper characterization has never been given, although we do know quite a lot about similarities and differences in reachability sets of (non-labeled) 2-VASSes as opposed to 1-VASSes \cite{blondin2015reachability}. For example - we know that reachability sets in both cases are "flat".

% \shtodo{For the above, I think we should start with vanilla primality, then parameterize it by $k,l$, then discuss minimization.}

% In this work we define the several variants of the main problems we discuss - VASS Primality and VASS Minimization. We show that for the general case - both problems are undecidable by presenting a nontrivial prime 2-VASS and utilizing it for relevant reductions. We also prove that in the case of deterministic VASS - the problem of regularity is decidable (as opposed to general VASS). We then elaborate more deeply on various small nuances of the relation between VASS dimension, determinism, and other related concepts.  

% In addition to the benefit that can be gained by tackling these problem for general VASS of unrestricted dimension, we can gain much insight by focusing on VASS of low dimension. This is because there is an active research frontier striving to better understand the delicate differences between VASSes of dimension 1,2 or 3, either labeled or unlabeled \cite{czerwinski2020reachability}.

% Apart from our work, the most prominent discussion already in the literature revolving around decomposing a VASS to simpler, more manageable systems has been the KLM decomposition, named after its three inventors - Kosaraju \cite{kosaraju1982decidability}, Lambert \cite{lambert1992structure} and Mayr \cite{mayr1981algorithm}. Our contribution, however, does not overlap with theirs.  
% \shtodo{This might be good for the related work section, but here it's not really relevant.}

% % As stated, the fragment of VASS Primality that can be referred to as VASS regularity - given a labeled VASS $\cV$ - is $\lang(\cV)$ regular? was shown to be undecidable \cite{bla}. Moreover, it is undecidable even in the case of 1-VASS \cite{bla}. 


% \subsection{Paper Organization and Contribution}

% In \cref{bla} we provide preliminary terminology. In \cref{bla} we formally define the several variants of the main problems we discuss - VASS Primality and VASS Minimization. In \cref{bla} we provide an example of a "prime" 2-VASS, and prove correctness thereof. In \cref{bla} we use the results in \cref{bla} in order to prove that for the general case - both VASS Primality and VASS Minimization are undecidable. In \cref{bla} we prove that in the case of deterministic VASS - the problem of regularity is decidable (as opposed to general VASS). In \cref{bla} we elaborate more deeply on various small nuances of the relation between VASS dimension, determinism, and other related concepts. Lastly, in \cref{bla} we conclude our discussion and present several possible directions forward.  



% \paragraph*{Related Work}
% I think this paper:
% https://hal.science/hal-00600077v1/document (Model Checking Coverability Graphs of Vector Addition Systems)~\cite{BlockeletS11}.
% shows that regularity for VAS is decidable (actually this follows from regularity for Petri nets).
% We know this cannot be extended to VASS, but maybe to DVASS?
% Specifically, they build the ``coverability graph'' (Page 3). Can we extend this to DVASS and possibly answer regularity?

% \hstodo{how do you know VASS regularity is undecidable?}
% \hstodo{{\bf Yes we can, please see Section~\ref{sec:dvass-regularity}}).}