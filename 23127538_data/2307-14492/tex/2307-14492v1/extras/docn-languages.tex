\documentclass[a4paper, UKenglish, cleveref, autoref, thm-restate]{lipics-v2021}
\hideLIPIcs
\bibliographystyle{plainurl}
\usepackage{hyperref, cleveref}
\usepackage{mathtools}
\usepackage[dvipsnames,table,xcdraw]{xcolor}
\usepackage{complexity}
\usepackage{tikz} 
    \usetikzlibrary{automata, positioning, arrows, decorations.pathreplacing}
\usepackage{todonotes}

\input{macros}

\title{2-DCN Recognises 1-DCN Language is Decidable}

\begin{document}

\maketitle

\subsection{Another approach to regularity}

We will show that a 2-DCN $\cV$ recognises a language that is not recognised by any 1-DCN showing that there exists some \emph{characteristic word} $w \in \lang(\cV)$.
First, as a warm up, observe that non-regularity of a $k$-DCN can be characterised by a word\shcomm{Like before -- this is true without accepting states. It's probably true with as well, but we need to prove it if we want to use it.} that is witnessed by a run
\begin{equation*}
    q_0(\vec{v}_0) \overset{\tau_0}{\longrightarrow} q_1(\vec{u}_1) \overset{\gamma_1}{\longrightarrow} q_1(\vec{v}_1) \overset{\tau_1}{\longrightarrow} q_2(\vec{u}_2) \overset{\gamma_2 }{\longrightarrow} q_2(\vec{v}_2) \overset{\tau_2}{\longrightarrow} q_3(\vec{u}_3),
\end{equation*}
where $\vec{u}_1 < \vec{v}_1$\shcomm{$\le$?}, there exists some $i \in \set{1, \ldots, k}$ such that $\vec{u}_2[i] > \vec{v}_2[i]$, and for all $i \in \set{1, \ldots, k}$ such that $\vec{u}_2[i] > \vec{v}_2[i]$ then $\vec{v}_1[i] > \vec{u}_1[i]$ must hold~{\cite[Section 3]{Demri13}}.
A word witnessed by such a run implicates the necessity of at least one counter which is enough to justify non-regularity.
Indeed, if the first cycle $\gamma_1$ has positive effect on the $i$-th component and the second cycle $\gamma_2$ has negative effect on $i$-th component, then there for each $x \in \N$, there exists $y \in \N$ such that $w = w'_0 \, w_1^x \, w'_1 \, w_2^y \, w'_2 \in \lang(\cV)$ and $w = w'_0 \, w_1^x \, w'_1 \, w_2^{y+1} \, w'_2 \notin \lang(\cV)$. 
Such a collection of accepted and rejected words implies that $\lang(\cV)$ is non-regular.

\subsection{NEW -- 2-DCN recognises a 1-DCN language -- NEW}

\begin{lemma}
    Let $\cV$ be a 2-DCN, there is a run of the following form in $\cV$ if and only if there does not exist a 1-DCN $\cU$ such that $\lang(\cU) = \lang(\cV)$.
    \begin{equation*}
        q_0(\vec{0}) \longrightarrow 
        q_1(\vec{v}_1) \longrightarrow
        q_2(\vec{v}_2) \longrightarrow
        q_3(\vec{v}_3) \longrightarrow
        q_4(\vec{v}_4)
    \end{equation*}
    Where 
    \begin{enumerate}[(a)]
        \item $q_0$ is the initial state,
        \item $\vec{v}_1 \geq [|Q|^3, \infty)^2$,
        \item $\vec{v}_2[1] < 0$ and $\vec{v}_2[2] - \vec{v}_2[1] > |Q|^2$,
        \item $\vec{v}_2[2] < 0$ and $\vec{v}_3[1] - \vec{v}_3[2] > |Q|^2$,
        \item and $q_4$ is a final state.
    \end{enumerate}     
    \label{lem:new}
\end{lemma}
\begin{proof}
    Similar to before we need both directions.
    
    {\bf First} is that if there is such a run, then there cannot exist a language equivalent 1-DCN.
    Sketch: will go via contradiction, so assume that a language equivalent 1-DCN exists.
    if such a run exists, then (a) and (b) implies that there is some collection of cycles (might be more than one) that means you can pump the two counter values arbitrarily high.
    Then (b) and (c) implies that there is some cycle that is ``more negative on the first component than the second'', hopefully this suffices to argue that there is a run witnessing a word where the final configuration is $q_4(<|Q|, >2|Q|^2)$.
    In the 1-DCN there must be a negative cycle reading the same subword as the counter 1 negative cycle in the 2-DCN, and the above is enough to tell you the effect of this cycle in the 1-DCN relative to the pumpable cycles before it.
    Then (c) and (d) implies that there is some cycle that is ``more negative on the second component than the first'', again hopefully this suffices to argue that there is a run witnessing a word where the final configuration is $q_4(>2|Q|^2, <|Q|)$.
    In the 1-DCN there must also be a negative cycle reading the same subword as the counter 2 negative cycle in the 2-DC, and the above is enough to tell you the effect of this cycle in the 1-DCN relative to earlier pumpable cycles.
    Now we can find a word rejected in the 1-DCN that is accepted by the 2-DCN.
    Idea: "combine" the two runs, so take the pumpable cycles many + many' times, then take the negative cycles many and many' times, respecteively.
    In the 1-DCN, this will leave you very close to 0 on the counter at the end, so you cannot afford more than $|Q|$ iterations of either of the two negative cycles.
    However, in the 2-DCN, you will have $>|Q|^2$ value on at least one, or both, of the counters, this will allow you to iterate one of the negative cycles some extra number of times, thus finding a word that is accepted by the 2-DCN that is rejected by the 1-DCN.

    {\bf Second} is that if there does not exist such a run, then we can construct a language equivalent 1-DCN.
    Sketch: if no such run exists, then either, you can't pump the value of both counters, so one of them is bounded above by $|Q|$, so you can easily encode this in the state space.
    Otherwise, if you can pump both counter values, you may not be able to depump either counter, so after a counter's value has exceeded $|Q|$, you can ``forget about it''. 
    Otherwise, you may be able to depump one of the counter's values, however, if you cannot separate one counter's value from the other counter's value by more than a $|Q|^2$ amount, then you can invoke Lemma~\ref{lem:close-counter-values}, to construct a 1-DCN witnessing the same language.
    Finally, you may be able to, for instance, get counter 1 to differ from counter 2 by at least $|Q|^2$, so if you can't find such a run, then it cannot be possible to find a cycle that is ``more negative'' on the other counter, otherwise you will be able to find a configuration where counter 2 differs from counter 1 by at least $|Q|^2$ which exactly matches the form of the run we have assumed is not possible. In this case, you can simply forget about the value of the first counter, as it will always be greater than the second counter.
\end{proof}

\begin{lemma}
    Suppose $\cV$ is a 2-DCN such that in all runs the value of the two counters differs by at most $poly(|Q|)$, then there exists a 1-DCN $\cU$ such that $\lang(\cU) = \lang(\cV)$ and $|\cU| \in O(|\cV|\cdot poly(|Q|))$.
    \label{lem:close-counter-values}
\end{lemma}
\begin{proof}
    Sketch: you can store the difference between the two counters in the states and nearly preserve the transition structure.
    Say you store $c_2 - c_1$ in the states and you keep $c_1$ as the one counter in the 1-DCN. 
    The only `risky' case is when $c_2$ has value 0 and you'd like to decrement that counter (that would be an illegal run).
    In this case, since $c_2 = 0$ and $|c_2 - c_1| \leq poly(|Q|)$, you know that $c_1 \leq poly(|Q|)$, so you can ``test'' $c_2 -= 1$ by running a gadget that first first adding $c_1 += c_2 - c_1$, then attempting $c_1 -= 1$, and if successful, revert the value of $c_1$ back by adding $c_1 += 1 + c_1 - c_2$. 
    This will be successful only if $c_2 > 0$ and it can be implemented using polynomial many increments/decrements because $|c_1 - c_2| \leq poly(|Q|)$.
    Intuitively, this is the only potential issue case since if $c_2 > c_1$ then you only need to worry about the value of the one counter in the 1-DCN.
    And if $c_2 < c_1$ by $c_1 > poly(|Q|)$, then you know $c_2 > 0$ so you'll always pass this testing gadget.
\end{proof}

\begin{lemma}
    We can decide if we have a run of the form in Lemma~\ref{lem:new}.
\end{lemma}
\begin{proof}
    {\bf TODO - help!}
    \henry{my idea is to choose a polynomial number of carefully chosen generalised unboundedness queries of Demri13.}
\end{proof}

\subsection{2-DCN recognises a 1-DCN language}

\henry{comment about the fact that this really only works in the deterministic case because this allows us to just construct runs and really words = runs in DCN}.

\begin{definition}[$i$-constrained]
    A cycle $\alpha$ is \emph{constrained} by the $i$-th component of $\beta$ if
    \begin{enumerate}[(a)]
        \item for all $x, y \in \N$, if there exists $j \in \set{1, \ldots, k}$ such that $\effect{\alpha^x}[j]+\effect{\beta^y}[j] < 0$, then $\effect{\alpha^x}[i]+\effect{\beta^y}[i] < 0$, and
        \item there exists $x, y \in \N$ such that $\effect{\alpha^x}[i]+\effect{\beta^y}[i] < 0$ and for all $j \in \set{1, \ldots, k} \setminus \set{i}$, $\effect{\alpha^x}[j]+\effect{\beta^y}[j] \geq 0$.
    \end{enumerate}
    \label{def:constrained}
\end{definition}

\begin{observation}
    A cycle $\alpha$ is constrained by at most one component of a cycle $\beta$.
    \label{obs:single-constraint}
\end{observation}
\begin{proof}
    We will assume, for sake of contradiction, that there exists two distinct components $1 \leq i < j \leq k$ such that $\alpha$ is both $i$-constrained and $j$-constrained by $\beta$.
    Since $\alpha$ is $i$-constrained by $\beta$, then by condition (b) there exists $x, y \in \N$ such that $\effect{\alpha^x}[i]+\effect{\beta^y}[i] < 0$ and, in particular, $\effect{\alpha^x}[j]+\effect{\beta^y}[j] \geq 0$.
    However, if $\alpha$ is also $j$-constrained by $\beta$, then by condition (a) since for the above $x, y \in \N$, it is true that $\effect{\alpha^x}[i]+\effect{\beta^y}[i] < 0$, so it must be the case that $\effect{\alpha^x}[i]+\effect{\beta^y}[j] < 0$ as well.
    This creates a contradiction, so $\alpha$ cannot be $i$-constrained and $j$-constrained by $\beta$ for distinct components $i$ and $j$.
\end{proof}

\hstodo{{\bf example that doens't fit this definition:} cycle reading $a(1,0)$ then a cycle reading $b(-1,1)$, then a cycle reading $c(0, -1)$, this is clearly not a language you can recognise with a 1-DCN, but it misses this definition because the b-cycle is not 2-constrained by the c-cycle. That's because the b-cycle is negative on the first component, so already if you just take one iteration of the b-cycle and zero iterations of the c-cycle, you see that you only violate the first component and not the second component. The `intuitive' work around, is to say that the first component is already ``at some arbitrarily large value'' because you could have compensated with more iterations of the a-cycle... but I really don't know how to easily bake this into my above definition.}

\begin{definition}[Characteristic word]
    Let $\cV$ be a 2-DCN, a word $w \in \lang(\cV)$ is a \emph{a characteristic word of the 2-DCN} if the run $\pi_w$ witnessing $w$ satisfies the following conditions:
    \begin{enumerate}[(a)]
        \item $\pi_w$ contains $\alpha_1$ and $\alpha_2$ that have positive effects on the first component and second components respectively,
        \item $\pi_w$ contains $\beta_1$ and $\beta_2$ that have negative effects on the first component and second components respectively,
        \item $\pi_w$ iterates the cycles $|Q|$ many times, 
        \item $\alpha_1$ is 1-constrained by $\beta_1$, and
        \item $\alpha_2$ is 2-constrained by $\beta_2$. 
    \end{enumerate}
    \label{def:characteristic-word}
\end{definition}

In a run witnessing a characteristic word, it could very well be the case that some of $\alpha_1$, $\beta_1$, $\alpha_2$, and $\beta_2$ coincide.
For example, it may be the case that $\alpha_1 = \alpha_2$, that occurs when the two counter values are pumped by the same cycle; $\beta_1 = \alpha_2$, that occurs when the the cycle that pumps one counter also depumps the other counter; or $\beta_1 = \beta_2$, that occurs when the two counter values are depumped by the same cycle.
However, it is not possible for both $\alpha_1 = \alpha_2$ and $\beta_1 = \beta_2$ by Observation~\ref{obs:single-constraint}.
It may also be the case that the cycles occur in one of many different orders, so there is no single structure of runs witnessing characteristic words depending on the cycles $\alpha_1$, $\beta_1$, $\alpha_2$, and $\beta_2$.

\begin{proposition}
    Let $\cV$ be a 2-DCN that has a characteristic word $w \in \lang(\cV)$ witnessed by $\pi_w$ that as one of the following forms:
    \begin{enumerate}[(i)]
        \item $\pi_w = \tau_0 \alpha_1 \tau_1 \beta_1 \tau_2 \alpha_2 \tau_3 \beta_2 \tau_4$, 
        \item $\pi_w = \tau_0 \alpha_1 \tau_1 \alpha_2 \tau_2 \beta_1 \tau_3 \beta_2 \tau_4$, or
        \item $\pi_w = \tau_0 \alpha_1 \tau_1 \alpha_2 \tau_2 \beta_2 \tau_3 \beta_1 \tau_4$.
    \end{enumerate}
    Where $\alpha_1$, $\beta_1$, $\alpha_2$, and $\beta_2$ are the cycles in Definition~\ref{def:characteristic word} and $\tau_0$, $\tau_1$, $\tau_2$, $\tau_3$, and $\tau_4$ are (possibly empty) simple paths connecting these cycles.
    \label{pro:characteristic-runs}
\end{proposition}

It important to remember that in these forms the cycles $\alpha_1$, $\beta_1$, $\alpha_2$, and $\beta_2$ need not be distinct.
In forms (i) and (ii), it is possible that $\alpha_2 = \beta_1$ with $\tau_2$ being an empty path, this is demonstrated in Example~\ref{}.
In form (iii), it is possible that $\alpha_1 = \alpha_2$ with $\tau_1$ being an empty path, and it is possible that $\beta_1 = \beta_2$ with $\tau_3$ being an empty path, but again, it is not possible for these two possibilities to coincide by Observation~\ref{obs:single-constraint}.

\begin{remark}
    Note that it is possible to permutate of the two components in $\cV$, as this does not alter the set of valid runs in $\cV$, and therefore does not change the language recognised by $\cV$.
    Therefore, in a run witnessing a characteristic word, we may as well assume that the first non-negative cycle has positive effect on the first component, that is $\alpha_1$ in Definition~\ref{def:characteristic-word}.
    \label{rem:permutation}
\end{remark}

\begin{proof}[Proof of Proposition~\ref{pro:characteristic-runs}]
    We will analyse, case by case, what may occur in a run witnessing a characteristic word.
    Observe that for a cycle $\alpha$ to be $i$-constrained by a cycle $\beta$, it must be the case that $\effect{beta}[i]<0$, otherwise neither conditions of being constrained are satisfied.
    Clearly, before a cycle with negative effect on the $i$-th component is iterated at least $|Q|$ many times, a cycle with positive effect on the $i$-th component must be taken, hence $\alpha_1$ appears before $\beta_1$ and $\alpha_2$ appears before $\beta_2$. 
    The first cycle observed will have non-negative effect and will have positive effect on one of the two components and considering Remark~\ref{rem:permutation}, we may assume without loss of generality, that $\alpha_1$ is the first cycle seen in the run $\pi_w$ witnessing the characteristic word $w$.
    Two different cycles may follow, either $\beta_1$ that has negative effect on the first component or $\alpha_2$ that has positive effect on the second component.
    In the former, $\alpha_2$ must occur before $\beta_2$, hence $\pi_w$ may also have form (i).
    In the latter, the cycles $\beta_1$ and $\beta_2$ with negative effects on each component can occur in either order, hence $\pi_w$ may have form (ii) or (iii).

    The paths $\tau_0$, $\tau_1$, $\tau_2$, $\tau_3$, and $\tau_4$ between the cycles are assumed to be simple, since if one of these paths $\tau$ is not simple, then it must contain a cycle $\gamma$.
    If $\effect{\gamma} = \vec{0}$, then we can simply remove $\gamma$ from $\tau$, and we are left with an alternative characteristic word.
    Now, suppose that $\gamma$ has positive or negative effect on one component, here we can use it to construct an alternative characteristic word, either by increasing the number of iterations of $\alpha_1$ and $\alpha_2$ whilst removing $\gamma$, or by replacing one of $\alpha_1$, $\beta_1$, $\alpha_2$, or $\beta_2$ with $\gamma$.
    \hstodo{does this argument need more fleshing out? -- I think it may become a massive mess of cases what effect $\gamma$ has, and whether $\gamma$ occurs in $\tau_0$, $\tau_1$, $\tau_2$, $\tau_3$, or $\tau_4$. I think to formally argue this, one defines a measure on the run witnessing a characteristic word $val(\pi_w) = \max\set{|\tau_0|, |\tau_1|, |\tau_2|, |\tau_3|, |\tau_4|}$, and if the word witnessed by the run with minimum cost satisfies $val(\pi_w) \geq |Q|$, then you can construct a characteristic word that is witnessed by a run with \emph{lower} cost, by removing a cycle and truncating the paths in the run, hence a contradiction. \henry{does this make sense?}}
\end{proof}

\begin{lemma}
    Let $\cV$ be a 2-DCN, there is a characteristic word of $\cV$ if and only if there does not exist a 1-DCN $\cU$ such that $\lang(\cU) = \lang(\cV)$.
    \label{lem:non-1dcn-language}
\end{lemma}
\begin{proof}
    This proof will be split into two parts, one for each implication.
    First, by way of contradiction, we will assume there is a language equivalent 1-DCN $\cU$.
    Here, we will show that if $\cV$ has a characteristic word, then we will be able to find another word that is accepted by $\cV$ but not by $\cU$.
    Second, we will assume that there does not exist a characteristic word of $\cV$ in order to construct a language equivalent 1-DCN $\cU$.

    \subparagraph*{First: characteristic word $\implies$ no language equivalent 1-DCN}
    For sake of contradiction, let us assume that there is a characteristic word $w$ witnessed by a run $\pi_w$
    
    todo: partially construct the language equivalent 1-DCN and find a word accepted by the 2-DCN that is rejected by the 1-DCN.
    
    \subparagraph*{Second: no characteristic word $\implies$ language equivalent 1-DCN exists}
    todo: constract the language equivalent 1-DCN by talking about the structure of the 2-DCN having a zone of 1-constrained cycles and a zone of 2-constrained cycles that are disjoint, then you can ignore the counter effects of the not constraining components by producting all components together.
\end{proof}

% Figure environment removed

% Figure environment removed

\hstodo{\bf below are the old notes about how this works}

The characteristic word that is witnessed by a run that implicates the necessity of at least two counters is of one of a few more involved but comparable forms, one of which is as follows.
\begin{multline*}
    q_0(\vec{v}_0) 
    \overset{\tau_0}{\longrightarrow} q_1(\vec{u}_1) 
    \overset{\gamma_1}{\longrightarrow} q_1(\vec{v}_1) 
    \overset{\tau_1}{\longrightarrow} q_2(\vec{u}_2) 
    \overset{\gamma_2}{\longrightarrow} q_2(\vec{v}_2) 
    \overset{\tau_2}{\longrightarrow} q_3(\vec{u}_3) 
    \overset{\gamma_3}{\longrightarrow} q_2(\vec{v}_3) \cdots \\ \cdots
    \overset{\tau_3}{\longrightarrow} q_3(\vec{u}_4) 
    \overset{\gamma_4}{\longrightarrow} q_2(\vec{v}_4) 
    \overset{\tau_4}{\longrightarrow} q_3(\vec{u}_5)
\end{multline*}
Suppose $\vec{v}_2 > \vec{u}_1$\shcomm{I guess this should be ``much bigger'', otherwise it can be accounted for by $\tau_1$.}, this means that $\gamma_1$ and $\gamma_2$ can together be used to pump the value of the two counters.
Let $\vec{x} = \effect{\gamma_1} + \effect{\gamma_2}$, we will enforce $\effect{\gamma_3}[1] < \vec{x}[1] \cdot \frac{\vec{x}[2]}{\effect{\gamma_3}[2]}$ so that $\gamma_3$ is ``limited by counter one''.
Meaning that for every $x \in \N$, $\effect{\tau_0 \, \gamma_1^x \tau_1 \gamma_2^x \tau_2 \gamma_3^y \tau_3 \gamma_4 \tau_4}[1] < 0 \implies \effect{\tau_0 \, \gamma_1^x \tau_1 \gamma_2^x \tau_2 \gamma_3^y \tau_3 \gamma_4 \tau_4}[2] < 0$ for any $y \in \N$.
Informally, this provides evidence that the value of the first counter is required to determine whether or not some particular words are accepted.
Furthering this, we will enforce $\effect{\gamma_4}[2] < \vec{x}[2] \cdot \frac{\vec{x}[1]}{\effect{\gamma_4}[1]}$ so that $\gamma_4$ is limited by counter two.
Similarly, for every $x \in \N$, $\effect{\tau_0 \, \gamma_1^x \tau_1 \gamma_2^x \tau_2 \gamma_3 \tau_3 \gamma_4^y \tau_4}[2] < 0 \implies \effect{\tau_0 \, \gamma_1^x \tau_1 \gamma_2^x \tau_2 \gamma_3 \tau_3 \gamma_4^y \tau_4}[1] < 0$ for any $y \in \N$.
Note that it could have equivalently been the case that $\gamma_3$ is limited by counter two and $\gamma_4$ is limited by counter one.
Intuitively speaking, the fact this counter net is deterministic, the fact that both counters can be pumped to arbitrarily large values by $\gamma_1$ and $\gamma_2$, and that both counters are limited by $\gamma_3$ and $\gamma_4$, there are words that are accepted or rejected based on the value of each of the two counters. 
It is easiest to observe that such runs implicate the necessity of two counter by assuming that a language equivalent 1-DCN exists.
\hstodo{sketch becomes more rough from here ...}
\begin{itemize}
    \item 1-DCN $\cU$ has:
    \begin{itemize}
        \item a cycle $\rho$ reading $w_1$ (the subword read by $\gamma_1$).
        \item $\rho$ must have non-negative effect (because $\gamma_1$ can be pumped in $\cV$).
        \item a cycle $\rho'$ reading $w_2$ (the subword read by $\gamma_2$). 
        \item $\effect{\rho} + \effect{\rho'} > 0$ (since in $\cV$ the cycles $\gamma_1$ and $\gamma_2$ can be pumped together to facilitate large number of iterations of cycles $\gamma_3$ and $\gamma_4$ containing negative components.
        \item a cycle $\sigma$ reading $w_3$ (the subword read by $\gamma_3$).
        \item $\sigma$ must have negative effect (if the effect is non-negative, then you can just iterate it an arbitrary number of times and accept a word that is rejected by the original 2-DCN)
        \item similarly, exists a cycle $\sigma'$ reading $w_4$ (the subword read by $\gamma_4$).
        \item again, $\sigma'$ must have negative effect (for the same reason).
    \end{itemize}
    \item consider for some really large $p_1 \in \N$, the word $r = w'_0 w_1^{p_1} w'_1 w_2^{p_1} w'_2 w_3^x w'_3 w_4 w'_4 \in L$ such that $s = w'_0 w_1^{p_1} w'_1 w_2^{p_1} w'_2 w_3^{x+1} w'_3 w_4 w'_4 \notin L$.
    \begin{itemize}
        \item since $\gamma_3$ is limited by counter one, the configuration reached after reading $r$ is $(<|Q|, large)$.
        \item from this, should be able to get a very tight bound on $\effect{\sigma}$ that depends on $\effect{\rho}$ and $\effect{\rho'}$, since in $\cU$ the cycle $\sigma$ is the only reason why $r$ is accepted and $s$ is rejected.
    \end{itemize}
    \item do the same thing for $p_2 \in \N$, the word $r = w'_0 w_1^{p_2} w'_1 w_2^{p_2} w'_2 w_3 w'_3 w_4^y w'_4 \in L$ such that $s = w'_0 w_1^{p_2} w'_1 w_2^{p_2} w'_2 w_3 w'_3 w_4^{y+1} w'_4 \notin L$.
    \item now, you know the effect of $\sigma$ and $\sigma'$ relative to $\effect{\rho} + \effect{\rho'}$, and because this is a 1-DCN, it will be the case that $w'_0 w_1^{p_1 + p_2} w'_1 w_2^{p_1 + p_2} w'_2 w_3^x w'_3 w_4^y w'_4 \in L$ but $w'_0 w_1^{p_1 + p_2} w'_1 w_2^{p_1 + p_2} w'_2 w_3^x w'_3 w_4^{y+small} w'_4 \notin L$.
    \item the reason for this is because in a sense the effect from the $p_1$-pumping is nearly completely wiped by $w_3^x$ and the effect from the $p_2$-pumping is nearly completely wiped by $w_4^y$, so the effect after this run in $\cU$ is very small, so you can't append a few extra iterations of $\sigma'$ before the counter is violated.
    \item however, in the original 2-DCN, since the first cycle was only limited by counter one, there is a fair amount of 'extra' counter value left on the second counter, so that extra value and the fact that the second cycle is limited by that counter, means that you will be able to afford the few additional iterations of $\gamma_4$, reading the extra $w_4^{small}$.
    \item this creates a contradiction, because you reject a word with $\cU$ that you should have accepted.
\end{itemize}

``proof by example'' of a 2-DCN $\cV$, below, to get a bit more convinced: 

\begin{tikzpicture}[auto,node distance=1.5cm,scale=1]
\footnotesize
    \node (qs) [initial, state, initial text = {},inner sep=3pt, minimum size=5pt] {};
    \node (q0) [state,inner sep=3pt, minimum size=3pt] at (2,0) {};
    \node (q1) [state,inner sep=3pt, minimum size=3pt] at (4,0) {};
    \node (q2) [state,inner sep=3pt, minimum size=5pt] at (6,0) {};
    \node (q3) [state,inner sep=3pt, minimum size=5pt] at (8,0) {};
    \node (q4) [state,inner sep=3pt, minimum size=5pt] at (10,0) {};
    \path [-stealth]
    (qs) edge [bend left=0] node[below] {$w'_0,(0,0)$} (q0)
    (q0) edge [bend left=0] node[below] {$w'_1,(0,0)$} (q1)
    (q1) edge [bend left=0] node[below] {$w'_2,(0,0)$} (q2)
    (q2) edge [bend left=0] node[below] {$w'_3,(0,0)$} (q3)
    (q3) edge [bend left=0] node[below] {$w'_4,(0,0)$} (q4)
    (q0) edge [loop above] node {$w_1,(2,0)$} (q0)
    (q1) edge [loop above] node {$w_2,(0,2)$} (q1)
    (q2) edge [loop above] node {$w_3,(-2,-1)$} (q2)
    (q3) edge [loop above] node {$w_4,(-1,-2)$} (q3);
    %(q1) edge [in=100,out=135,loop] node {$a$} (q1)
\end{tikzpicture}

For sake of contradiction, consider the language equivalent 1-DCN $\cU$.
Must contain a positive cycle reading $w_1$, later followed by a negative cycle reading $w_3$.
Must contain a positive cycle reading $w_2$, later followed by a negative cycle readign $w_4$.
In this case $x=p_1$ and $y=p_2$ for some large $p_1, p_2 \in \N$, since for each iteration of $\gamma_1$ and $\gamma_2$, you can afford one more iteration of $\gamma_3$.
This would imply something like $\effect{\sigma} = \effect{\rho}+\effect{\rho'}$.
Same is true for $\effect{\sigma'} = \effect{\rho}+\effect{\rho'}$.
Clearly, $r = w'_0 w_1^{p_1+p_2} w'_1 w_2^{p_1+p_2} w'_2 w_3^x w'_3 w_4^y w'_4 \in \lang(\cV)$.
By the above, in $\cU$, the configuration reached at the end of $r$ is $(<|Q|, <|Q|)$.
However, in the original 2-DCN $\cV$, you finish at a configuration $(2p_2 - p_1, 2p_1- p_2) > (|Q|, |Q|)$ because you chose $p_1$ and $p_2$ sufficiently large.
Therefore, you can afford $>|Q|$ many iterations of $\gamma_4$, reading $s = w'_0 w_1^{p_1+p_2} w'_1 w_2^{p_1+p_2} w'_2 w_3^x w'_3 w_4^{y+small} w'_4 \in \lang(\cV)$.
But in the 1-DCN $\cU$, because you end with counter values $(<|Q|, <|Q|)$, you must reject $s$.

\hstodo{\bf{notes}}
there's more to this, I think there's two flavours of `characteristic runs': this flavour is: I easily pumped the counters, and I have two choices of depump, one that's limited by the first counter, and one that is limited by the second counter. The other flavour is the opposite, if I have some double-negative cycle later on, and I have some cycle that pumps the first counter more than the second and another cycle that pumps the second counter more than the first, then I can violate the first counter if I don't pump it's cycle as much, and I can violate the second counter if I don't pump it's cycle as much. I think these two cases are basically symmetric, but I think that's all.

this is not the entire story, you may want to know how I decide this (good question)! ... I plan to implement this as finite number of ``generalised unboundedness'' queries~{\cite[Definition 3.1]{Demri13}}. The idea being that a cycle that is counter 1 limiting and a cycle that is counter 2 limiting means that I should be able to witness a run: $q_1(x_1, y_1) \rightarrow q_1(x_2, y_2) \rightarrow q_1(x_3, y_3)$ where $|Q|^2 < x_1, y_1 < |Q|^3$, then $x_2 < x_1$ and $y_2 - x_2 > |Q|$, then $y_3 < y_2$ and $x_3 - y_3 > |Q|$. I think this kind of a run, where you can pump both cycles, then depump the two counters separately (hence making the two counter value differ by a large value) exactly captures this idea of having two cycles that are counter 1 and counter 2 limiting, since if the counter values differ greatly, you can imagine that you could use this to violate each counter independently. Now the idea is to implement this as generalised unboundedness queries, and this is like asking for a unboundedness query, but you can specify an interval that each of the counter values lie in, so I can query: counter1 $\in [0, v]$ and counter2 $\in (v+|Q|, \infty)$ for all $0 \leq v \leq |Q|^3$, which is like asking for their value to differ by $|Q|$.

The reverse direction is also necessary, if you don't have a characteristic word, then there must exist a 1-DCN recognising the language.
My plan here is to build a 1-DCN, so what's the worst that can happen:
Maybe you have a word that's nearly characteristic, so you maybe pump the two counters, then you have a few cycles that are each counter 1 limiting, in this case it is very obvious: just ignore the second component.
It could be a bit more complicated: imagine you have a cycle that pumps both counters, then you can have one path leading to a counter 1 limiting cycle and a disjoint path leading elsewhere to a counter 2 limiting cycle, this is not an issue, but you have to be careful, see this example:
% Figure removed

The intuitive reason for why this works: because the machine is deterministic, the path leading from the positive pumpable cycle the cycle that is counter one limited cannot then lead to another cycle that is counter two limited (else you'd find a characteristic run), so in a sense, you can "forget" about the not limited counter from that moment forwards. 
This can be implemented by producting the limited components effects to ensure faithful "simulation" of the counter that is limited.

\henry{hope that all of this makes some sense, please let me know -- I'll probably need some help writing this up because it seems quite tricky to formalise!}

\end{document}