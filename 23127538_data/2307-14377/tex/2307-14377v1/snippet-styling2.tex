%% Requires \usepackage{xcolor}
%% Requires \usepackage{lstlistings}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codeblue}{rgb}{.11,.56,1}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}

\definecolor{codeKeyword}{RGB}{211	54	130}
% \definecolor{codeKeyword}{RGB}{133, 153, 0}
\definecolor{codeComment}{RGB}{42	161	152}
\definecolor{codeOmitted}{RGB}{108	113	196}
\definecolor{codeNumbers}{rgb}{0.5,0.5,0.5}
\definecolor{codeString}{RGB}{128, 161, 16}

\definecolor{textusercolor}{RGB}{40 20 10}
\definecolor{textgptcolor}{RGB}{62, 65, 115}

\definecolor{codebackcolour}{RGB}{	253	246	227}
\definecolor{backuserprompt}{RGB}{
253, 250, 250}
%\definecolor{backgptresponse}{rgb}{0.93,0.93,0.98}

\definecolor{backgptresponse}{RGB}{226 228 255}

\newcommand{\gpticon}{figures/formatting/chatgpt-logo.png}
\newcommand{\usericon}{figures/formatting/person-raising-hand.png}



%% Defining custom languages -- try not to put styling here, only keywords/comment signifiers/etc. this way all languages will look the same. 
\lstdefinelanguage{JavaScript}{
  keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break, const},
  ndkeywords={class, export, boolean, throw, implements, import, this, require},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]',
  morestring=[b]"
}

%% consistent styling used for all languages
\lstdefinestyle{codestyle}{
    commentstyle=\color{codeComment},
    keywordstyle=\color{codeKeyword},
    numberstyle=\tiny\color{codeNumbers},
    stringstyle=\color{codeString},
    basicstyle=\linespread{0.85}\footnotesize,
    columns=flexible,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    % numbers=left,                    
    % numbersep=5pt,     
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    escapeinside={\$}{\$},
}

\surroundwithmdframed[
  hidealllines=true,
  backgroundcolor=codebackcolour,
  innerleftmargin=0pt,
  innertopmargin=0pt,
  innerbottommargin=0pt]{gptcodeblock}


\newcommand\colboxcolor{codeComment} % temporary
%% colored box -- takes background color as parameter
\newsavebox{\savedcolorbox}
\newenvironment{colbox}[2]
  {\renewcommand\colboxcolor{#1}%
   \begin{lrbox}{\savedcolorbox}%
    \begin{minipage}{\dimexpr\columnwidth-2\fboxsep\relax}

   \footnotesize
   \bgroup\color{#2}
   }
  {\egroup\end{minipage}\end{lrbox}%
   \begin{center}
   \colorbox{\colboxcolor}{\usebox{\savedcolorbox}}
   \end{center}
}



%% text responses
\newsavebox{\savedfigurebox}
\newenvironment{blurbwithfig}[5]
{
    \newcommand{\figurewidth}{#1}
    \newcommand{\iconwidth}{0.025\textwidth}
    \newcommand{\blurbwidth}{0.982\textwidth - \figurewidth - \iconwidth}
    \newcommand{\imagetoshow}{#2}
    \newcommand{\backgroundcolor}{#3}
    \newcommand{\boxtextcolor}{#4}
    \newcommand{\icontoshow}{#5}

    % collect the to-be-right-aligned figure block
    \begin{lrbox}{\savedfigurebox}%
    \begin{minipage}[t]{\figurewidth}
        \vspace{3pt}
        \ifthenelse{\equal{\imagetoshow}{}}{}{% Figure removed}
        % \captionof{figure}{note}
        % \label{fig:figure2}
    \end{minipage}\end{lrbox}%

    % start the user icon
    \noindent
    \begin{minipage}[t]{\iconwidth}
    \vspace{2pt}
    \centering
    % Figure removed
    \end{minipage}
    %
    % start the left-aligned chat block
    \noindent
    \begin{minipage}[t]{\blurbwidth}
    \vspace{0pt}
    \begin{colbox}{\backgroundcolor}{\boxtextcolor}
}
{
    \end{colbox}
    \end{minipage}
    % end the primary prompt area
    \hfill
    % begin the image portion
    \usebox{\savedfigurebox}
}


\newenvironment{userprompt}[2]
{
    \begin{blurbwithfig}{#1}{#2}{backuserprompt}{textusercolor}{\usericon}
}
{
    \end{blurbwithfig}
}


\newenvironment{gptresponse}[2]
{
    \begin{blurbwithfig}{#1}{#2}{backgptresponse}{textgptcolor}{\gpticon}
}
{

    \end{blurbwithfig}
}


\lstnewenvironment{gptcodeblock}[1]
{
    \lstset{style=codestyle} %% change this to be a local setting, so it doesn't affect others
    \lstset{language=#1}
}
{}



\newenvironment{chat}[1]
{
    \newcommand{\preventbreaks}{#1}
    \begin{center}
    \mdfsetup{nobreak=\preventbreaks}
    \begin{mdframed}[
        linecolor=black,
        innerleftmargin=0.04cm,
        innerrightmargin=0cm
        innertopmargin=0cm
        innerbottommargin=0cm
    ]{}

}
{ 
    \end{mdframed}
    \end{center}
}


%% ============================
%% Macros to be used inside the chat environment, to help shorten/clarify the included chats
%% ============================

\newcommand{\authorremark}[1]{\footnotesize\textit{(Author remark: #1)}}

% parameters: #1 is the summary of the omitted content (will show up in doc if provided; can be left blank), #2 can be placed around the content to omit, so you can leave it in the tex, it just doesn't get rendered anywhere
\newcommand{\omitted}[2]{
    % \textcolor{codeblue}{
    \ifthenelse{\equal{#1}{}}{\textit{(... content omitted by authors ...)}} 
                            {\textit{(... omitted by authors: #1 ...)}}
}

% parameters: #1 is the summary of the omitted code (will show up in doc if provided; can be left blank), #2 can be placed around the content to omit, so you can leave it in the tex, it just doesn't get rendered anywhere
%% IMPORTANT: to use this inside a \gptcodeblock, you must wrap it in $$ to escape into latex mode. For example: 

% for x in range(0,3):
% $\omittedCode{update and output i}{
%.     i = x
%      print("the value of i is " + str(i))
% }$

\newcommand{\omittedCode}[2]{
    \textcolor{codeOmitted}{
    \ifthenelse{\equal{#1}{}}{\textit{(... code omitted by authors ...)}} 
                            {\textit{(... omitted by authors: #1 ...)}}
    }
}

