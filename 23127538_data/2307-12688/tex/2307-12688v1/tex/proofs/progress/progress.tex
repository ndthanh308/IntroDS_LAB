
% \input{tex/defs/configs/iso/well_formed.tex}

\newcommand{\FullChoice}[0]{\left\{\TypComm_i \,\MsgLabel_i\left\langle T_i\right\rangle \left(\delta_i,\lambda_i\right).\TypeS_i\right\}_{i\in I}}

\begin{lemma}\label{lem:cfg_wf_neq_alpha}
   %
   If \CIso*\ is \emph{well-formed} then $\TypeS\neq\alpha$.
   %
\end{lemma}
\begin{proof}
   %
   By the hypothesis \CIso*\ is \emph{well-formed} meaning $\exists\Const$ such that $\ValClocks\models\Const$ and  $\emptyset;\Const~\Entails\TypeS$.

   Consider by contradiction of the hypothesis that $\TypeS=\alpha$.
   If \CIso*;[\alpha]\ is \emph{well-formed} then, by the judgement of rule \LblTypVar*\ $\alpha:\Const;\Const~\Entails\alpha$ and the evaluation shown in~\Cref{eq:cfg_wf_neq_alpha_eval} must hold, where there must be some recursive definition earlier in the derivation tree $\mu\alpha.\TypeS'$ corresponding to $\alpha$.
   %
   \begin{minieq}\label{eq:cfg_wf_neq_alpha_eval}
   \begin{array}[c]{l}
      \infer[\LblTypRec]{%
         \emptyset;\Const~\Entails\mu\alpha.\TypeS'%
      }{%   
         \infer{\alpha:\Const;\Const~\Entails\TypeS'}{%
            \infer[\vdots]{}{%
               \infer[\LblTypVar]{%
                  \alpha:\Const;\Const~\Entails\alpha%
               }{}%
            }%
         }%
      }
    \end{array}
   \end{minieq}
   
   \noindent If $\exists\ValClocks',\mu\alpha.\TypeS'$ such that \CIso*[\ValClocks'];[\mu\alpha.\TypeS']\ is \emph{well-formed} and \Trans*{\CIso[\ValClocks'];[\mu\alpha.\TypeS']}*[\CIso;[\alpha]], then the immediate transition must be via rule \LblCfgIsoUnfold*\ as shown in~\Cref{eq:cfg_wf_neq_alpha_unfold}; where either $\CIso[{\ValClocks}''];[{\TypeS}'']=\CIso;[\alpha]$ or \Trans*{\CIso[{\ValClocks}''];[{\TypeS}'']}*[\CIso;[\alpha]].
   %
   By the premise of rule \LblCfgIsoUnfold*\ any recursive calls following their definition are replaced by the definition of their next unfolding denoted by $\TypeS'\Subst[\mu\alpha.\TypeS'][\alpha]$.
   %
   \begin{minieq}\label{eq:cfg_wf_neq_alpha_unfold}
   \begin{array}[c]{l}
      \infer[\LblCfgIsoUnfold]{%
      \Trans{\CIso[\ValClocks'];[\mu\alpha.\TypeS']}:{\ProgAction}[\CIso[{\ValClocks}''];[{\TypeS}'']]
      }{%
      \Trans{\CIso[\ValClocks'];[{\TypeS}'\Subst[\mu\alpha.\TypeS'][\alpha]]}:{\ProgAction}[\CIso[{\ValClocks}''];[{\TypeS}'']]
      }
    \end{array}
   \end{minieq}
   
   \noindent Therefore, if \CIso*\ is \emph{well-formed} then $\TypeS\neq\alpha$.
   %
\end{proof}

% \input{tex/defs/configs/iso/live.tex}

\begin{lemma}\label{lem:cfg_wf_end}
   %
   \CIso*;[\TypeEnd]\ is always \emph{well-formed}.
   %
\end{lemma}
\begin{proof}
   %
   By the hypothesis $\exists\Const$ such that $\ValClocks\models\Const$ and $\emptyset;\Const~\Entails\TypeS$, and by rule \LblTypEnd*\ $\emptyset;\TypeTrue~\Entails\TypeEnd$.
%   
   Therefore the hypothesis holds as $\ValClocks\models\TypeTrue$ always holds.
   %
\end{proof}

\input{tex/proofs/progress/lem/wf_then_live.tex}

\begin{lemma}\label{lem:init_wf_then_live}
   %
   Given a \emph{well-formed} \TypeS*, \CIso*[\ValClocks_0]\ is \emph{live}.
   %
\end{lemma}
\begin{proof}
   %
   By~\Cref{def:types_wf}, \Sat*[\ValClocks_0]:[\Past]\ holds for any valid \Const*.
   %
\end{proof}

% ~ configuration transitions
% ! 
\input{tex/proofs/progress/lem/configs_iso_trans.tex}
\input{tex/proofs/progress/lem/configs_soc_trans.tex}

% ~ preservation of wf and compat
% \input{tex/defs/configs/sys/compat.tex}
% \input{tex/defs/configs/iso/latest_en.tex}

% ! 
\input{tex/proofs/progress/lem/configs_trans_wf_preserved.tex}

% ~ time passing
% ! 
% \newpage
\input{tex/proofs/progress/lem/sys_compat_time_trans.tex}

\input{tex/proofs/progress/lem/configs_trans_compat_preserved.tex}

% ~ preservation is preserved 
% ! 
\input{tex/proofs/progress/lem/configs_compat_wf_fe.tex}
\input{tex/proofs/progress/lem/configs_trans_compat_wf_preserved.tex}

% ~ system progress
% ! 
\input{tex/proofs/progress/lem/configs_sys_progress.tex}

% ! thm proof
\ThmProgress*
\begin{proof}
   %
   By~\Cref{def:types_wf}, types \TypeS*\ and \Dual*\ are always \emph{well-formed} against \ValClocks*_0.
   %
   By \Cref{lem:init_wf_then_live} and~\Cref{itm:configs_compat_dual_types} of~\Cref{def:configs_compat}, both \CSoc*[\ValClocks_0]:{\emptyset}\ and \CSoc*[\ValClocks_0];[\Dual]:{\emptyset} are \emph{live} and \emph{compatible}.
   %
   It follows~\Cref{lem:configs_compat_wf_fe,lem:configs_trans_compat_wf_pres} that such as system will always perform actions when possible, waiting if necessary (never missing the \emph{latest-enabled} action), until reaching a \emph{final} configuration, and any \emph{non-final} configuration is guaranteed to be \emph{well-formed}, \emph{compatible} and \emph{live}.

   Therefore, it holds that an initial system composed of dual types that are well-formed is compatible, and guaranteed to \emph{satisfy progress}.
   %
\end{proof}
