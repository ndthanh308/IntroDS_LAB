
\NewDocumentCommand{\simplechoice}{E_{i} o}{ \{ \TypeChoice_{#1}.S_{#1} \}_{\lowercase{#1}\in \IfNoValueTF{#2}{\uppercase{#1}}{\uppercase{#2}}} }

% ~ past indicator 
% #1: * mm
% #2: t'
% #3: O
\NewDocumentCommand{\Past}{s t' O{\Const}}{%
   \IfBooleanT{#1}{$}% mm wrap
   \downarrow\!\FmtMathOp{#3}{#2}%
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ message type def
% #1: * mm
% #2: O l
% #3: t'
% #4: e_
% #5: O T
% #6: t'
% #7: e_
\NewDocumentCommand{\DefMsgType}{s O{\MsgLabel} t' e_ O{\DataType} t' e_}{%
   \IfBooleanT{#1}{$}% mm wrap
   \IfNoValueTF{#4}{\FmtMathOp{#2}{#3}}{\FmtMathOp{#2}{#3}_{#4}}
   \left\langle
   \IfNoValueTF{#7}{\FmtMathOp{#5}{#6}}{\FmtMathOp{#5}{#6}_{#7}}
   \right\rangle
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ rec def def
\NewDocumentCommand{\TypRecDef}{s O{\RecDef} O{\TypRecLabel} e: t. O{\TypeS}}{%
   \IfBooleanT{#1}{$}% mm wrap
   {#2}{{#3}\IfValueT{#4}{^{#4}}}%
   \IfBooleanTF{#5}{.}{.#6}% proceeding
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ rec call
\NewDocumentCommand{\TypRecCall}{s O{\TypRecLabel} e:}{%
   \IfBooleanT{#1}{$}% mm wrap
   {{#2}\IfValueT{#3}{^{#3}}}%
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ ~ ~ ~ ~ ~
% ~ templates

% ~
% #1 : s  : mm wrap
% #2 : E1 : rec env
% #3 : t| : past const
% #4 : E2 : const 
% #5 : o  : index
% #6 : Oi : index set
% #7 : E3 : TypInteract
\NewDocumentCommand{\TypJudge}{s E1{{\RecEnv}} t| E2{{\Const}} o O{i} E3{{\TypInteract}}}{%
   \IfBooleanT{#1}{$}% mm wrap
   {#2};\,
   % * if of set?
   \IfNoValueTF{#5}{% * true
      % * if past?
      \IfBooleanTF{#3}{\Past[#4]}{#4}
      \;\Entails\,
      {#7}
   }{% * false
      % * if past?
      \IfBooleanTF{#3}{% * true
         \Past[{\SetOr_{\hspace{-0.5ex}\vspace{0.5ex}\scriptstyle{\AsSet[#5][#6]}}}{#4_{#5}}]
      }{% * false
         {\SetOr_{\hspace{-0.5ex}\vspace{0.5ex}\scriptstyle{\AsSet[#5][#6]}}}{#4_{#5}}
      }
      \;\Entails\,
      {#7[#5][#6]}
   }
   \IfBooleanT{#1}{$}% mm wrap
}

% ~
\NewDocumentCommand{\TypCond}{s t' e_ E1{\Const} E2{\RSet}}{%
   \IfBooleanT{#1}{$}% mm wrap
   \mkTup[\FmtMathOp{#4}{#2}_{#3}][\FmtMathOp{#5}{#2}_{#3}]
   \IfBooleanT{#1}{$}% mm wrap
}

% ~
\NewDocumentCommand{\TypAct}{s t' e_ E1{\TypComm} E2{\MsgType}}{%
   \IfBooleanT{#1}{$}% mm wrap
   \FmtMathOp{#4}{#2}_{#3}\FmtMathOp{\MsgLabel}{#2}_{#3}\left\langle\FmtMathOp{\DataType}{#2}_{#3}\right\rangle
   \IfBooleanT{#1}{$}% mm wrap
}

% ~
% #1 : mm wrap
% #2 : t| : single element?
% #3 : E1 : TypeAct args
% #4 : E2 : TypCond args
% #5 : E3 : TypeS
% #6 : t_ : single element subscript
% #7 : Oi : element subscript
% #8 : Oi : set of elements
% #9 : t~ : dual?
\NewDocumentCommand{\TypInteract}{s t| E1{{}} E2{{}} E3{{\TypeS}} t_ O{i} O{i} t~}{%
\IfBooleanT{#1}{$}% mm wrap
\IfBooleanTF{#2}{% * single element
\IfBooleanTF{#6}{% * subscripted
\IfBooleanTF{#9}{% * dual
\Dual[{\TypAct_{#7}#3}{\TypCond_{#7}#4}\,.{#5_{#7}}]%
}{% * not dual
{\TypAct_{#7}#3}{\TypCond_{#7}#4}\,.{#5_{#7}}%
}%
}{% * not subscripted
\IfBooleanTF{#9}{% * dual
   \Dual[{\TypAct#3}{\TypCond#4}\,.#5]%
}{% * not dual
   {\TypAct#3}{\TypCond#4}\,.#5%
}%
}%
}{% * set
\IfBooleanTF{#9}{% * dual
\InSet[\Dual[{\TypAct_{#7}#3}{\TypCond_{#7}#4}\,.{#5_{#7}}]][#7][#8]%
}{% * not dual
\InSet[{\TypAct_{#7}#3}{\TypCond_{#7}#4}\,.{#5_{#7}}][#7][#8]%
}%
}%
\IfBooleanT{#1}{$}% mm wrap
}

% ~ delegation
% #1 : mm wrap
% #2 : O Const
% #3 : t'
% #4 : e_
% #5 : O TypeS
% #6 : t'
% #7 : e_
\NewDocumentCommand{\TmpTypBTDelegate}{s O{\Const} t' e_ O{\TypeS} t' e_}{%
   \IfBooleanT{#1}{$}% mm wrap
   \mkTup[%
      \IfNoValueTF{#4}{\FmtMathOp{#2}{#3}}{\FmtMathOp{#2}{#3}_{#4}}
   ][%
      \IfNoValueTF{#7}{\FmtMathOp{#5}{#6}}{\FmtMathOp{#5}{#6}_{#7}}
   ]\,
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ future satisfiability
% #1 : mm wrap
% #2 : O typeenv
% #3 : t'
% #4 : e_
% #5 : O resets
\NewDocumentCommand{\TmpTypFutureSat}{s E1{\TypEnv} t' e_ E2{{1{\Const}2{\RSet}}}}{%
\IfBooleanT{#1}{$}% mm wrap
{\Resets#5}%
\subseteq%
\IfNoValueTF{#4}{\FmtMathOp{#2}{#3}}{\FmtMathOp{#2}{#3}_{#4}}%
\IfBooleanT{#1}{$}% mm wrap
}


% ~ ~ ~ ~ ~ ~
% ~ generators
% #1 : mm wrap
% #2 : O typeS
% #3 : O const
% #4 : O tnv
% \NewDocumentCommand{\mkTypJudgement}{s O{\TypeS} O{\Const} O{\RecEnv}}{%
% 	\IfBooleanT{#1}{$}% mm wrap
% 	{#4};\,{#3}\,\Entails\,{#2}
% 	\IfBooleanT{#1}{$}% mm wrap
% }


