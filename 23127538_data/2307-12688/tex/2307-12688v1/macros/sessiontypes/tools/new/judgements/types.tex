
\NewDocumentCommand{\ITJRec}{s O{\emptyset} e:}{%
    \IfBooleanT{#1}{$}%
    {#2}%
    \IfValueT{#3}{% * rec vars in A
        \ListToEnvItems{#3}%
    }%
    \IfBooleanT{#1}{$}%
}

% ~ 
% #1 : s* : mathmode wrap
% #2 : t| : is past?
% #3 : Ot : const
% #4 : e_ : subscript?
% #5 : E: : of set?
\NewDocumentCommand{\ITJCon}{s t| O{\TypeTrue} e_ E:{\SetI}}{%
    \IfBooleanT{#1}{$}%
    \begin{array}[t]{l}%
        \IfValueTF{#4}{% * subscript
            \IfBooleanTF{#2}{% * past
                \IConstOr|[#3]_{#4}:{#5}%
            }{% * not past
                \IConstOr[#3]_{#4}:{#5}%
            }%
        }{% * no subscript
            \IfBooleanTF{#2}{% * past
                \Past[#3]%
            }{% * not past
                {#3}%
            }%
        }%
    \end{array}%
    \IfBooleanT{#1}{$}%
}

\NewDocumentCommand{\TypEnvCond}{s E:{\TypEnv} O{\TypeS}}{%
    \IfBooleanT{#1}{$}%
    \FmtJudgement{#2}{#3}%
    \IfBooleanT{#1}{$}%
}

\NewDocumentCommand{\ITJTyp}{s t| O{\TypeEnd} e_ E<{\SetI}}{%
    \IfBooleanT{#1}{$}%
    \IfBooleanTF{#2}{% * do not wrap in set ?
        \ListToTupleContents{#3}%
    }{% * wrap in set
        \IfValueTF{#4}{% * use set subscript?
            {\begin{array}[t]\{{l}\}%
                \!\ListToTupleContents{#3}%
            \end{array}}_{\AsSet[#4][#5]}%
        }{% * no subscript
            \begin{array}[t]\{{l}\}%
                \!\ListToTupleContents{#3}%
            \end{array}%
        }%
    }%
    \IfBooleanT{#1}{$}%
}

% ~ 
% #1 : s* : part of infer rule?
% #2 : OA : rec environment
% #3 : e: : rec defs in A
% #4 : t| : past?
% #5 : E; : const
% #6 : o  : single type
% #7 : e- : entails interactions (only if #5 not given, default: end)
% #8 : e_ : element in set
% #9 : E< : default i in set I
\NewDocumentCommand{\ITJudgement}{s O{\RecEnv} e: t| E;{\TypeTrue} o e- e_ E<{\SetI}}{%
\IfBooleanTF{#1}{$\FmtJudgement}{\FmtJudgement|}%
{% * A
    \IfNoValueTF{#3}{% * no rec vars, A is empty
        \ITJRec%
    }{% * A rec vars
        \ITJRec[#2]:{#3}%
    }% 
    \!\,;\,%
    % * Const
    \IfBooleanTF{#4}{% * past
        \IfValueTF{#8}{% * set subscript
            \ITJCon|[#5]_{#8}:{#9}%
        }{% * no subscript
            \ITJCon|[#5]%
        }%
    }{% * not past
        \IfValueTF{#8}{% * set subscript
            \ITJCon[#5]_{#8}:{#9}%
        }{% * no subscript
            \ITJCon[#5]%
        }%
    }%
}{% * Type
    \IfNoValueTF{#7}{% * no list of interactions
        \IfValueTF{#6}{% * interaction given
            \IfValueTF{#8}{% * set subscript
                \ITJTyp|[#6]_{#8}<{#9}%
            }{% * no subscript
                \ITJTyp|[#6]%
            }%
        }{% * default interaction
            \IfValueTF{#8}{% * set subscript
                \ITJTyp|[\TypeEnd]_{#8}<{#9}%
            }{% * no subscript
                \ITJTyp|[\TypeEnd]%
            }%
        }%
    }{% * list of interactions given
        \IfValueTF{#8}{% * set subscript
            \ITJTyp[#7]_{#8}<{#9}%
        }{% * no subscript
            \ITJTyp[#7]%
        }%
    }%
}%
\IfBooleanT{#1}{$}%
}
