
% ~ isolated configurations
% #1 : s* : math mode
% #2 : t~ : dual clock valuation
% #3 : Ov : clock valuation
% #4 : e+ : time step over clock valuations
% #5 : t; : sep
% #6 : t~ : dual type
% #7 : Os : type
% #8 : t' : prime 
% #9 : e_ : all subscript
\NewDocumentCommand{\CIso}{s t~ O{\ValClocks} e+ t; t~ O{\TypeS} t' e_}{%
    \IfBooleanT{#1}{$}%
    \IfValueTF{#9}{% * subscripted
        \Tup(\IfBooleanTF{#2}{\Dual[{#3}_{#9}\IfBooleanT{#8}{'}]\IfValueT{#4}{#4}}{{#3}_{#9}\IfBooleanT{#8}{'}\IfValueT{#4}{#4}},\IfBooleanTF{#6}{\Dual[{#7}_{#9}\IfBooleanT{#8}{'}]}{{#7}_{#9}\IfBooleanT{#8}{'}})%
    }{% * no subscript
        \Tup(\IfBooleanTF{#2}{\Dual[{#3}\IfBooleanT{#8}{'}]\IfValueT{#4}{#4}}{{#3}\IfBooleanT{#8}{'}\IfValueT{#4}{#4}},\IfBooleanTF{#6}{\Dual[{#7}\IfBooleanT{#8}{'}]}{{#7}\IfBooleanT{#8}{'}})%
    }%
    \IfBooleanT{#1}{$}%
}

% ~ social configurations
% #1 : s* : math mode
% #2 : Ov : clock valuation
% #3 : e+ : time step over clock valuations
% #4 : t; : sep
% #5 : Os : type
% #6 : E: : queue
% #7 : e+ : messages at the end of the queue
% #8 : t' : all prime
% #9 : e_ : all subscript
\NewDocumentCommand{\CSoc}{s O{\ValClocks} e+ t; O{\TypeS} E:{\Queue} e+ t' e_}{%
    \IfBooleanT{#1}{$}
    \Tup(% * valuation
    {{#2\IfValueT{#9}{_{#9}}\IfBooleanT{#8}{'}}\IfValueT{#3}{#3}},%
    % * type
    {#5\IfValueT{#9}{_{#9}}\IfBooleanT{#8}{'}},%
    % * queue
    {{#6\IfValueT{#9}{_{#9}}\IfBooleanT{#8}{'}}\IfValueT{#7}{;#7}})%
    \IfBooleanT{#1}{$}%
}

\NewDocumentCommand{\CSys}{s O{\VSoc_1} O{\VSoc_2}}{%
    \IfBooleanT{#1}{$}%
    \Parl{{#2},{#3}}%
    \IfBooleanT{#1}{$}%
}

\NewDocumentCommand{\VIso}{s t' e_}{%
    \IfBooleanT{#1}{$}%
    \IfBooleanTF{#2}{% * '
        \IfValueTF{#3}{% * subscripted
            {\IsoCfg}_{#3}'%
        }{% * not sub
            {\IsoCfg'}%
        }%
    }{% * not prime 
        \IfValueTF{#3}{% * subscripted
            {\IsoCfg}_{#3}%
        }{% * not sub
            {\IsoCfg}%
        }%
    }%
    \IfBooleanT{#1}{$}%
}

\NewDocumentCommand{\VSoc}{s t' t' e_}{%
    \IfBooleanT{#1}{$}%
    \IfBooleanTF{#2}{% * '
        \IfBooleanTF{#3}{% * second '
            \IfValueTF{#4}{% * subscripted
                {\SocCfg}_{#4}''%
            }{% * not sub
                {\SocCfg''}%
            }%
        }{% * no second '
            \IfValueTF{#4}{% * subscripted
                {\SocCfg}_{#4}'%
            }{% * not sub
                {\SocCfg'}%
            }%
        }%
    }{% * not prime 
        \IfValueTF{#4}{% * subscripted
            {\SocCfg}_{#4}%
        }{% * not sub
            {\SocCfg}%
        }%
    }%
    \IfBooleanT{#1}{$}%
}

\NewDocumentCommand{\VSys}{s t' e_ t' e_}{%
    \IfBooleanT{#1}{$}%
    \IfBooleanTF{#4}{% * second prime ?
        \IfBooleanTF{#2}{% * first prime ?
            \IfValueTF{#3}{% * first subscript?
                \IfValueTF{#5}{% * second subscript?
                    \Parl{\VSoc'_{#3},\VSoc'_{#5}}%
                }{% * no second subscript
                    \Parl{\VSoc'_{#3},\VSoc'_{2}}%
                }%
            }{% * no first subscript
                \IfValueTF{#5}{% * second subscript?
                    \Parl{\VSoc'_{1},\VSoc'_{#5}}%
                }{% * no second subscript: double prime if no subscripts
                    \Parl{\VSoc''_1,\VSoc''_2}%
                }%
            }%
        }{% * no first prime
            \Parl{%
                \IfValueTF{#3}{\VSoc_{#3}}{\VSoc_1},%
                \IfValueTF{#5}{\VSoc'_{#5}}{\VSoc'_2}%
            }%
        }%
    }{% * no second prime prime
        \IfBooleanTF{#2}{% * first prime ?
            \IfValueTF{#3}{% * first subscript ?
                \Parl{%
                    \VSoc'_{#3},%
                    \IfValueTF{#5}{\VSoc_{#5}}{\VSoc_2}%
                }%
            }{% * no first subscript
                \IfValueTF{#5}{% * second subscript ?
                    \Parl{%
                        \VSoc'_1,%
                        \VSoc'_{#5}%
                    }%
                }{% * no second subscript: use first prime for both
                    \Parl{%
                        \VSoc'_1,%
                        \VSoc'_2%
                    }%
                }%
            }%
        }{% * no first prime
            \Parl{%
                \IfValueTF{#3}{\VSoc_{#3}}{\VSoc_1},%
                \IfValueTF{#5}{\VSoc_{#5}}{\VSoc_2}%
            }%
        }%
    }%
    \IfBooleanT{#1}{$}%
}
