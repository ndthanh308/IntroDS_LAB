
% ~ hybrid macros
\NewDocumentCommand{\CommAction}{s O{\MsgType} t' e_}{{\TypComm\IfValueT{#4}{_{#4}}}{{#2}\IfBooleanT{#3}{'}\IfValueT{#4}{_{#4}}}}

\NewDocumentCommand{\RecvAction}{s O{\MsgType} t' e_}{{\TypRecv\IfValueT{#4}{_{#4}}}{{#2}\IfBooleanT{#3}{'}\IfValueT{#4}{_{#4}}}}

\NewDocumentCommand{\SendAction}{s O{\MsgType} t' e_}{{\TypSend\IfValueT{#4}{_{#4}}}{{#2}\IfBooleanT{#3}{'}\IfValueT{#4}{_{#4}}}}

\NewDocumentCommand{\CommMsg}{s O{\Msg} t' e_}{\CommAction[#2]\IfBooleanT{#3}{'}\IfValueT{#4}{_{#4}}}

\NewDocumentCommand{\RecvMsg}{s O{\Msg} t' e_}{\RecvAction[#2]\IfBooleanT{#3}{'}\IfValueT{#4}{_{#4}}}

\NewDocumentCommand{\SendMsg}{s O{\Msg} t' e_}{\SendAction[#2]\IfBooleanT{#3}{'}\IfValueT{#4}{_{#4}}}

% ~ action
% #1: * mm
% #2: t/
% #3: O
\NewDocumentCommand{\Act}{s t| O{\ProgAction}}{%
   \IfBooleanT{#1}{$}% mm wrap
   \IfBooleanTF{#2}% negate
   {% * true
      \stackrel{#3}{\not\rightarrow}%
   }{% * false
      \xrightarrow{#3}%
   }%
   \IfBooleanT{#1}{$}% mm wrap
}

\NewDocumentCommand{\Trans}{s m t| e: t* o}{%
   \IfBooleanT{#1}{$}% mm wrap
   {#2}\,%
   \IfValueTF{#4}{% * transition label
      \IfBooleanTF{#3}% negate
      {% * true
         {\stackrel{\ListToSpacedTrans{#4}}{\not\rightarrow}}%
         \IfBooleanT{#5}{^{\ast}}%
      }{% * false
         {\xrightarrow{\ListToSpacedTrans{#4}}}%
         \IfBooleanT{#5}{^{\ast}}%
      }%
   }{% * no transition label
      {\IfBooleanTF{#3}{\not\rightarrow}{\rightarrow}}%
      \IfBooleanT{#5}{^{\ast}}%
   }%
   \IfValueT{#6}{\,{#6}}%
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ transition label spacing
\NewDocumentCommand\ListToSpacedTrans{>{\SplitList{,}}m}
{%
   {\ProcessList{#1}{\HeadSpacedTrans}}%
}

% ~ 
\newcommand\HeadSpacedTrans[1]{%
   {#1}%
   \let\HeadSpacedTrans\TailSpacedTrans%
}

% ~ inserts | before each subsequent par item
\newcommand\TailSpacedTrans[1]{%
   \!\;{#1}%
}


% ~ apply resets
% #1: * mm
% #2: O
\NewDocumentCommand{\ApplyReset}{s O{\RSet}}{%
   \IfBooleanT{#1}{$}% mm wrap
   #2\mapsto0%
   \IfBooleanT{#1}{$}% mm wrap
}

% ~  resets
% #1: * mm
% #2: O
% #3: O
\NewDocumentCommand{\Resets}{s E1{{\Const}} E2{{\RSet}}}{%
   \IfBooleanT{#1}{$}% mm wrap
   #2\mkReg[\ApplyReset[#3]]%
   \IfBooleanT{#1}{$}% mm wrap
}

\NewDocumentCommand{\ReSet}{s O{\Const} E:{\RSet} e_}{%
   \IfBooleanT{#1}{$}% mm wrap
   {#2\mkReg[{#3\IfValueT{#4}{_{#4}}}\mapsto0]}%
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ future enabled
% #1: * mm
% #2: t/
% #3: O
\NewDocumentCommand{\FutureEn}{s E1{\IsoCfg} t/ O{\TypComm}}{%
   \IfBooleanT{#1}{$}% mm wrap
   {#2}\stackrel{#4}{\IfBooleanT{#3}{\not}\Rightarrow}
   \IfBooleanT{#1}{$}% mm wrap
}