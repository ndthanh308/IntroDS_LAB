
% ~ 
\NewDocumentCommand{\PBranch}{s E_{\PrcP} O{\PRecv|} e< E>{\PFail}}{%
    \IfBooleanT{#1}{$}%
    \begin{array}[t]{r l}%
        %
        % ~ receive
        \mathtt{on}\;{#2}\;%
        \IfValueTF{#4}{% * within
            \bm{\mathtt{recv}}^{#4}%
        }{% * forever
            \bm{\mathtt{recv}}^{\infty}%
        } & %
        %
        % ~ messages
        \begin{array}[t]\{{l}\}%
            \PrcListToArray{#3}%
        \end{array}%
        %
        % ~ timeout
        \IfValueT{#4}{% * timeout
            \PrcBranchAfterSep \rule{0pt}{3ex}{\mathtt{after}}%
            & \begin{array}[t]{l l}%
                :%
                & \!\begin{array}[t]{l}{#5}\end{array}%
            \end{array}%
        }%
        %
    \end{array}%
    \IfBooleanT{#1}{$}%
}

% ~ returns array
\NewDocumentCommand{\PrcListToArray}{>{\SplitList{,}}m}{%
    \ProcessList{#1}{\HeadPrcItemToArrayElement}%
}

% ~ returns items as line in array
\NewDocumentCommand{\HeadPrcItemToArrayElement}{m}{%
    \rule{0pt}{1.5ex}{#1}%
    \let\HeadPrcItemToArrayElement\TailPrcItemToArrayElement%
}
% ~ inserts new line before entry
\NewDocumentCommand{\TailPrcItemToArrayElement}{m}{%
    \PrcRecvSep\rule{0pt}{1.5ex}{#1}%
}
