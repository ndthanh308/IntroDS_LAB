
% ~ ared
\NewDocumentCommand{\PRedRuleARed}{s}{%
\IfBooleanT{#1}{$}% mm wrap
\infer{%[\LblPrcRedARed]{% * judgement
\RedPrc{\Prc}%
~\PrcRed~%
\RedPrc'{\Qrc}%
}{% * premise
\RedPrc{\Prc}%
~\ARed~%
\RedPrc'{\Qrc}%
}%
\IfBooleanT{#1}{$}% mm wrap
}

% ~ astr
\NewDocumentCommand{\PRedRuleAStr}{s}{%
\IfBooleanT{#1}{$}% mm wrap
\infer{%[\LblPrcRedAStr]{% * judgement
\RedPrc{\Prc}%
~\rightarrow~%
\RedPrc'{\Qrc}%
}{% * premise
\Prc\equiv\Prc'
& %
\RedPrc{\Prc'}%
~\rightarrow~%
\RedPrc'{\Qrc'}%
& %
\Qrc\equiv\Qrc'%
}%
\IfBooleanT{#1}{$}% mm wrap
}

% ~ scope
\NewDocumentCommand{\PRedRuleScope}{s}{%
\IfBooleanT{#1}{$}% mm wrap
\infer{%[\LblPrcRedScope]{% * judgement
\RedPrc{\PCalcScope}%
~\ARed~%
\RedPrc'{\PCalcScope[\Prc']}%
}{% * premise
\RedPrc{\Prc}%
~\ARed~%
\RedPrc'{\Prc'}%
}%
\IfBooleanT{#1}{$}% mm wrap
}

% ~ tred
\NewDocumentCommand{\PRedRuleTRed}{s}{%
\IfBooleanT{#1}{$}% mm wrap
\infer{%[\LblPrcRedTRed]{% * judgement
\RedPrc{\Prc}%
~\PrcRed~%
\RedPrc'{\Qrc}%
}{% * premise
\RedPrc{\Prc}%
~\TRed~%
\RedPrc'{\Qrc}%
}%
\IfBooleanT{#1}{$}% mm wrap
}

% ~ tstr
\NewDocumentCommand{\PRedRuleTStr}{s}{%
\IfBooleanT{#1}{$}% mm wrap
\infer{%[\LblPrcRedTStr]{% * judgement
\RedPrc{\Prc}%
~\TRed~%
\RedPrc'{\Qrc}%
}{% * premise
\Prc\equiv\Prc'
& %
\RedPrc{\Prc'}%
~\TRed~%
\RedPrc'{\Qrc'}%
& %
\Qrc\equiv\Qrc'%
}%
\IfBooleanT{#1}{$}% mm wrap
}

% ~ delay
\NewDocumentCommand{\PRedRuleDelay}{s}{%
   \IfBooleanT{#1}{$}% mm wrap
   \RedPrc{\Prc}
   ~\TRed~%
   \RedPrc[\RedTimers+\ValTime]{\PFuncTime[{\Prc}]}%
   %
   % \quad
   % %
   % \RName[Delay]
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ par
\NewDocumentCommand{\PRedRulePar}{s}{%
\IfBooleanT{#1}{$}% mm wrap
\infer{%[\LblPrcRedPar]{% * judgement
\RedPrc{%
   \Parl{%
      \Prc,%
      \Qrc%
   }%
}%
~\ARed~%
\RedPrc'{%
\Parl{%
   \Prc',%
   \Qrc%
}%
}%
}{% * premise
\RedPrc{\Prc}%
~\ARed~%
\RedPrc'{\Prc'}%
}%
\IfBooleanT{#1}{$}% mm wrap
}

% ~ def
\NewDocumentCommand{\PRedRuleDef}{s}{%
\IfBooleanT{#1}{$}% mm wrap
\infer{%[\LblPrcRedDef]{% * judgement
\RedPrc{\PrcRecDef}%
~\ARed~%
\RedPrc'{\PrcRecDef>{\Qrc'}}%
}{% * premise
\RedPrc{\Qrc}%
~\ARed~%
\RedPrc'{\Qrc'}%
}%
\IfBooleanT{#1}{$}% mm wrap
}

% ~ if true
\NewDocumentCommand{\PRedRuleIf}{s}{%
   \IfBooleanT{#1}{$}% mm wrap
   \infer{%
      \RedPrc{\PCalc{\If*{\Const}~\Then{P}~\Else{Q}}}%
      ~\ARed~%
      \RedPrc{\Prc}%
   }{%
      \RedTimers\models\Const%
   }%
   \IfBooleanT{#1}{$}% mm wrap
}

\NewDocumentCommand{\PRedRuleElse}{s}{%
   \IfBooleanT{#1}{$}% mm wrap
   \infer{%
      \RedPrc{\PCalc{\If*{\Const}~\Then{P}~\Else{Q}}}%
      ~\ARed~%
      \RedPrc{Q}%
   }{%
      \neg \RedTimers\models\Const%
   }%
   \IfBooleanT{#1}{$}% mm wrap
}


% ~ rec
\NewDocumentCommand{\PRedRuleRec}{s}{%
   \IfBooleanT{#1}{$}% mm wrap
   \begin{array}[t]{l r}%
      \RedPrc{%
      \Parl{%
      \PrcRecDef'>{\RecPrcCall},%
      \Qrc%
      }%
      }%
      % \PCalcRecDef2{\PCalcRecVar|1{\RecVar}2{\RecSetMsg'}3{\RecSetChan'}4{\RecSetTimers'}}][\Qrc]
      ~\ARed~%
      & %
      \mbox{\hspace{24ex}}%
      %
      \\[0.5ex]%
      & %
      \mathllap{%
      \RedPrc{%
      \Parl{%
      \PrcRecDef'>{\Prc\RecPrcSubst/'},%
      \Qrc%
      }%
      }%
      % \Par[\PCalcRecDef2{\Prc\mkReg[\sfrac{\RecSetMsg';\RecSetChan';\RecSetTimers'}{\RecSetMsg;\RecSetChan;\RecSetTimers}]}][\Qrc]
      }%
   \end{array}%
   %
   % \quad
   % %
   % \RName[Rec]
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ set timer
\NewDocumentCommand{\PRedRuleSetTimer}{s}{%
   \IfBooleanT{#1}{$}% mm wrap
   \RedPrc{\PCalcSetTimer}%
   ~\ARed~%
   \RedPrc[\RedTimers{}{}{}[x\mapsto 0]]{\Prc}
 %}
   %
   % \quad
   % %
   % \RName[Send]
   \IfBooleanT{#1}{$}% mm wrap
}

% ~ send
\NewDocumentCommand{\PRedRuleSend}{s}{%
\IfBooleanT{#1}{$}% mm wrap
\RedPrc{%
\Parl{%
\PCalc{\On{p}\Send{l}[\pl].{\Prc}},%
% \PCalcSend,%
{{pq}:{h}}%
}%
}%
~\ARed~%
\RedPrc{%
\Parl{%
\Prc,%
{{pq}:{h \cdot {l\pl}}}%
}%
}%
%
% \quad
% %
% \RName[Send]
%\IfBooleanT{#1}{$}% mm wrap
}

% % ~ recv
% \NewDocumentCommand{\PRedRuleRecv}{s}{%
% %\IfBooleanT{#1}{$}% mm wrap
% \infer{%
% \RedPrc{%
% \Parl{%
% \PCalc{\On{p}\Recv{l}[b]:{P}_{i}[i]},%
% % \PCalcRecv,%
% {{qp}:{v \cdot h}}%
% % \PCalcBuffer1{1{\PrcQ}2{\PrcP}}2{\Msg}[\QHead]%
% }%
% }%
% ~\ARed~%
% \RedPrc{%
% \Parl{%
% \Prc_j\Subst[v][\PrcMsg_j],%
% % \PCalcBuffer1{1{\PrcQ}2{\PrcP}}%
% {{qp}:{h}}%
% }%
% }%
% }{%
% j\in IHJBFBJFR%
% }%
% % \quad
% % %
% % \RName[Recv]
% \IfBooleanT{#1}{$}% mm wrap
% }

% ~ recv after
\NewDocumentCommand{\PRedRuleRecvAfter}{s}{%
%\IfBooleanT{#1}{$}% mm wrap
\infer{%
\RedPrc{%
\Parl{%
\PCalc{\On{p}\Recv{l}[\pl]:{P}_{i}[i]~\After<{e}:{Q}},%
% \PCalcRecv,%
{{qp}:{{l\pl} \cdot h}}%
% \PCalcBuffer1{1{\PrcQ}2{\PrcP}}2{\Msg}[\QHead]%
}%
}%
~\ARed~%
\RedPrc{%
\Parl{%
\Prc_j\Subst[\pl][\pl_j],%
% \PCalcBuffer1{1{\PrcQ}2{\PrcP}}%
{{qp}:{h}}%
}%
}%
}{%
j\in I%
& l={l_j}%
}%
% \quad
% %
% \RName[Recv]
\IfBooleanT{#1}{$}% mm wrap
}

% ~ det
\NewDocumentCommand{\PRedRuleDet}{s}{%
   \IfBooleanT{#1}{$}% mm wrap
   \infer{%[\LblPrcRedDet]{% * judgement
      \RedPrc{\PFuncDelay}%
      ~\ARed~%
      \RedPrc{\PFuncDelay[\ValTime]}%
   }{% * premise
      % \ValTime%
      ~\models~%
      \Const\Subst[\ValTime][x]%
   }%
   \IfBooleanT{#1}{$}% mm wrap
}
