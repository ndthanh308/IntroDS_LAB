\usepackage{jms-sections}
\usepackage{local-jmsdelim}
\usepackage{local-abbrv}
\usepackage{mathtools}
\usepackage{local-tikz}
\usepackage{jms-operators}
\usepackage{iblock}
\usepackage{multicol}
\usepackage{stmaryrd}
\usepackage{silence}
\usepackage{mathpartir}
\usepackage{changepage}

\newtheorem{axiom}[theorem]{Axiom}
\theoremstyle{definition}
\newtheorem{construction}[theorem]{Construction}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{computation}[theorem]{Computation}
\newtheorem{exegesis}[theorem]{Exegesis}
\newtheorem{todo}{\textcolor{red}{Todo}}

\WarningFilter{latexfont}{Font shape}
\WarningFilter{latexfont}{Some font}
\WarningFilter{latexfont}{Size substitutions}

\NewDocumentCommand\DefEmph{m}{\textbf{\textit{#1}}}
\NewDocumentCommand\Alert{m}{\begingroup\color{magenta}#1\endgroup}

\NewDocumentCommand\Con{m}{\mathsf{#1}}
\NewDocumentCommand\Kwd{m}{\mathbf{#1}}
\NewDocumentCommand\DOM{m}{\mathsf{0Dom}\Sub{#1}}
\NewDocumentCommand\BCat{}{\mathscr{B}}
\NewDocumentCommand\DCat{}{\mathscr{D}}
\NewDocumentCommand\Ul{m}{\underline{#1}}
\NewDocumentCommand\Idn{m}{1\Sub{#1}}
\NewDocumentCommand\SFib{}{\mathsf{s}}

\NewDocumentCommand\UU{}{\mathcal{U}}
\NewDocumentCommand\PP{}{\mathcal{P}}
\RenewDocumentCommand\SS{}{\mathcal{S}}
\NewDocumentCommand\IsTp{m}{#1~\mathit{type}}
\NewDocumentCommand\Nat{}{\mathbb{N}}
\NewDocumentCommand\SET{m}{\mathsf{Set}\Sub{#1}}
\NewDocumentCommand\NTp{mm}{#1\mathsf{Type}\Sub{#2}}
\NewDocumentCommand\Ltr{o}{\mathord{\blacktriangleright}\IfValueT{#1}{\brk{#1}.}}
\NewDocumentCommand\LtrAp{}{\Con{ap}\Sub{\Ltr}}
\NewDocumentCommand\LtrMap{}{\Con{map}\Sub{\Ltr}}
\NewDocumentCommand\Next{o}{\Con{next}\IfValueT{#1}{\brk{#1}.}}
\NewDocumentCommand\LtrSplit{}{\Con{split}\Sub{\Ltr}}
\NewDocumentCommand\LtrPair{}{\Con{pair}\Sub{\Ltr}}
\NewDocumentCommand\LtrFix{}{\Con{fix}\Sub{\Ltr}}
\NewDocumentCommand\LtrFold{}{\Con{fold}\Sub{\Ltr}}
\NewDocumentCommand\INJ{}{\mathsf{Inj}}
\NewDocumentCommand\InjFinBag{m}{\mathsf{IBag}\Sub{#1}}
\NewDocumentCommand\InjFinFam{m}{\mathsf{IFam}\Sub{#1}}
\NewDocumentCommand\ObjOne{}{\mathbf{1}}
\NewDocumentCommand\ObjTwo{}{\mathbf{2}}
\NewDocumentCommand\ObjZero{}{\mathbf{0}}

\NewDocumentCommand\WCat{}{\mathscr{C}\Sub{\SS}}
\NewDocumentCommand\OpCat{m}{#1\Sup{\mathsf{op}}}
\NewDocumentCommand\Hom{mmm}{\hom\Sub{#1}\prn{#2,#3}}
\NewDocumentCommand\XCat{}{\mathscr{X}}

\NewDocumentCommand\PCat{}{\mathscr{P}\Sub{\SS}}
\NewDocumentCommand\BarPCat{}{\bar{\mathscr{P}}\Sub{\SS}}
\NewDocumentCommand\QCat{}{\mathscr{Q}\Sub{\SS}}
\NewDocumentCommand\NCat{}{\mathscr{N}\Sub{\SS}}

\NewDocumentCommand\Hp{}{\mathscr{H}\Sub{\SS}}
\NewDocumentCommand\FUN{mm}{\Con{Fun}\prn{#1,#2}}
\NewDocumentCommand\HatPCat{}{\hat{\mathscr{P}}\Sub{\SS}}
\NewDocumentCommand\HpProj{}{\pi\Sub{\mathscr{H}}}
\NewDocumentCommand\BarHpProj{}{\bar\pi\Sub{\mathscr{H}}}
\NewDocumentCommand\TpRef{}{\Con{IORef}}
\NewDocumentCommand\TpCell{}{\Con{Cell}}
\NewDocumentCommand\TpT{}{\Con{IO}}
\NewDocumentCommand\TpUnit{}{\prn{}}
\NewDocumentCommand\TpNat{}{\Con{Nat}}
\NewDocumentCommand\TpInt{}{\Con{Int}}

\NewDocumentCommand\TmZero{}{\Con{zero}}
\NewDocumentCommand\TmSucc{}{\Con{succ}}
\NewDocumentCommand\TmIfz{}{\Con{ifz}}
\NewDocumentCommand\TmAx{}{\Con{tt}}
\NewDocumentCommand\TmProj{m}{\Con{prj}\Sub{#1}}
\NewDocumentCommand\TmRec{}{\Con{rec}}
\NewDocumentCommand\TmRecIn{mmm}{\TmRec~#1\,#2~\Con{in}~#3}

\NewDocumentCommand\TmRet{}{\Con{ret}}
\NewDocumentCommand\TmAlloc{}{\Con{alloc}}
\NewDocumentCommand\TmGet{}{\Con{get}}
\NewDocumentCommand\TmSet{}{\Con{set}}
\NewDocumentCommand\TmStep{}{\Con{step}}

\NewDocumentCommand\SetToDom{}{\Con{L}}
\NewDocumentCommand\DomToSet{}{\Con{R}}
\NewDocumentCommand\DomToPsh{}{\Con{R}}
\NewDocumentCommand\PshToDom{}{\Con{L}}

\NewDocumentCommand\IOMap{}{\Con{map}}

\Crefname{paragraph}{Section}{Sections}

\NewDocumentCommand\F{}{\Con{F}}
\NewDocumentCommand\U{}{\Con{U}}
\NewDocumentCommand\Refl{}{\Con{refl}}

\definecolor{Matterhorn}{RGB}{77,77,77}
\definecolor{RegalBlue}{RGB}{3,69,117}
\definecolor{FunGreen}{RGB}{14,87,54}
\definecolor{VerdunGreen}{RGB}{54,87,14}
\definecolor{RedDevil}{RGB}{134,1,17}

\mprset{flushleft}


\NewDocumentCommand\TypedHole{O{?}m}{
  \colorbox{RegalBlue!10}{$\displaystyle {\color{black!75}#1} : #2$}
}

\NewDocumentCommand\At{}{\mathbin{@}}

\DeclareSymbolFont{symbolsC}{U}{pxsyc}{m}{n}
\SetSymbolFont{symbolsC}{bold}{U}{pxsyc}{bx}{n}
\DeclareFontSubstitution{U}{pxsyc}{m}{n}
\DeclareMathSymbol{\medcirc}{\mathord}{symbolsC}{7}
\DeclareMathSymbol{\medbullet}{\mathord}{symbolsC}{8}

\NewDocumentCommand\Rxn{}{\medcirc}
\NewDocumentCommand\RxnUnit{o}{\eta\Sup{\medcirc}\IfValueT{#1}{\Sub{#1}}}


\newcolumntype{L}{>{$}l<{$}} % math-mode version of "l" column type
\newcommand\GrmContinue{\multicolumn{2}{l}{}}
\NewDocumentEnvironment{grammar}{}{
  \medskip
  \begin{tabular}{>{\itshape}lL@{\ \ $::=$\ \ }L}
    }{
  \end{tabular}
  \medskip
}


\NewDocumentCommand\TmRefMap{}{\Con{refmap}}


\NewDocumentCommand\TpCounter{}{\Con{Counter}}
