\section{Preliminaries}
\label{sec:preliminaries}
In this section, we explain some technical difficulties and our approach to the proof.

%%---------------------------------------------------------------------------------------------

\subsection{Localization}
Considering \thmref{thm:mainresult} for $\bx_t^\e$ in the state space $\mathbb R^2$ causes technical difficulties due to the presence of multiple separatrices of the Hamiltonian and to the fact that the process $\bx_t^\e$ is not positive recurrent. 
However, such difficulties can be circumvented by considering the process $\bx_t^\e$ locally. 
Namely, let us cover the plane $\mathbb R^2$ by finitely many bounded domains, each containing one of the separatrices and bounded by up to three connected components of level sets of $H$, and one unbounded domain not containing any critical points. 
For example, as shown in Figure~\ref{fig:local_graph}, we have different parts of the Reeb graph $\mathbb G$ that correspond to the domains in $\mathbb R^2$.
Every point of $\mathbb R^2$ can be assumed to be contained in the interior either one or two domains. 
Since it takes positive time to travel from the boundary of one domain to the boundary of another, it suffices to prove the result up to time of exit from one domain. 
To be more precise, let $\{V_k:1\leq k \leq K\}$ be the open cover. 
Define $\eta_0=\inf\{t\geq0:X_t^\e\in\bigcup_{1\leq k \leq K}\partial V_k\}$ and, for $k$ such that $X_{\eta_{n-1}}^\e\in V_k$, define $\eta_n=\inf\{t>\eta_{n-1}: X_t^\e\not\in V_k\}$, $n\geq 1$. 
In order to prove \eqref{eq:mgprob}, it suffices to prove instead, uniformly in $x$ in any compact set in $\mathbb R^2$ and in $y\in\mathbb T^m$, that
\begin{equation}
\label{eq:martingale_problem_stopped}
    \E_{(x,y)}[f(h(X_{T\wedge\eta_1}^\e))-f(h(x))-\int_0^{T\wedge{\eta_1}}\mathcal Lf(h(X_{t}^\e))dt]\to 0,~~{\rm as}~\varepsilon \downarrow 0,
\end{equation}
%where $\eta$ is the time when the process exits a domain that contains $(x,y)$.
since it also implies that $\Prob(\eta_n<T)\to0$ as $n\to\infty$, uniformly in all $\e$ sufficiently small.
In the unbounded domain without critical points, \eqref{eq:martingale_problem_stopped} can be obtained using the result in bounded domain together with the tightness of $h(X_t^\e)$.
It remains to consider the bounded domains.
Let $V$ be one of the bounded domains. As explained below, the process $X_t^\e$ in $V$ can be extended beyond the time when it reaches the boundary by embedding $V$ into a compact manifold $M$ with an area form and a Hamiltonian such that there are no other separatrices.
%
%by modifying the %system in $\mathbb %R^2\setminus V_k$.
% Figure environment removed
%-------------------------------------Previous Paragraphs--------------------------------------------------
\iffalse
However, such difficulties can be circumvented by considering the process $\bx_t^\e$ locally, i.e., in the neighborhoods of the separatrices and, separately, in the domains not containing the separatrices. Namely, let us cover
the plane $\mathbb R^2$ 
by two types of domains: domains of the first type contain a small neighborhood of one of the separatrices and are bounded by three connected components of the level sets of $H$; domains of the second type contain no separatrices and are 
bounded by finitely many \R{at most two?} connected components of the level sets of $H$. Such domains may contain the critical points of $H$, and one of those domains is unbounded. We choose the covering in such a way that every point of $\mathbb R^2$ is contained in the interior of at least one of the domains. 
It then suffices to prove the weak convergence up to the time when the process exits one domain.  

To be more precise, let us define $|I_k|$ to be the length of $I_k$ except the edge $I_{k^*}$ that has infinite length, and we simply define $|I_{k^*}|=\max_{k\not=k^*}|I_k|$. Then, we define the regions described above in the following way: For each critical point $O_i$, let $V_i=\bigcup_{k:O_i\sim I_k}\{x\in U_k:|H(x)-H(O_i)|< 2/3\cdot|I_k|\}$, and define $V_{0}=\{x\in U^*:|H(x)-H(O_{i^*})|>1\}$. 
Define the stopping time $\eta_n$, $n\geq 0$, recursively: $\eta_0:=\inf\{t>0:X_t^\e\not\in \bigcap_{k:x\in V_k}V_k\}$; $\eta_{n+1}:=\inf\{t>\eta_n:X_t^\e\not\in V_k,~X_{\eta_n}^\e\in V_k\}$. Since $\Prob(\eta_n<T)\to0$ as $n\to\infty$ uniformly in $\e$, followed from the averaging principle inside the edges (\cite{AIHPB_1995__31_3_485_0}), it suffices to show that, for $f\in\mathcal D$, as $\e\downarrow 0$,
\begin{equation}
    \E_{(x,y)}[f(h(X_{\eta_1\wedge T}^\e))-f(h(x))-\int_0^{\eta_1\wedge T}\mathcal Lf(h(X_t^\e))dt]\to0.
\end{equation}
Again, this is true for $x\in V_k$ where $V_k$ does not contain separatrix by the averaging principle inside the edges.
On the other hand, for $x\in V_k$ where $V_k$ indeed contains one separatrix, we embed the process $X_t^\e$ into a compact manifold $M$ by modifying the system in $\mathbb R^2\setminus V_k$. 
\fi 
%-----------------------------------------------------------------------------------------------------------------

Consider the case where $V$ is not simply connected - for example, $V$ is the domain that contains $O_3$ in Figure~\ref{fig:local_graph}. There are three connected components of $\mathbb R^2\setminus V$ as shown in Figure~\ref{fig:three_components} (other situations can be treated similarly). Then we can modify the Hamiltonian and the vector field in $C_1$ and $C_2$ in such  a way that assumptions \hyperlink{H2}{\textit{H(2)}-\textit{H(4)}} hold locally, and there is only one extremum point of $H$ in $C_1$ and one in $C_2$ (this modification is not needed if $V$ is simply connected). 
The unbounded domain $C_3$ outside $V$ can be replaced by a compact surface $S$ so that the resulting state space of $X_t^\e$ is, topologically, a sphere $M = V \bigcup C_1 \bigcup C_2 \bigcup S$. 
Then, the vector field on the surface can be chosen as a smooth extension from $V$ so that the averaged process is a Hamiltonian system on $M$ with respect to an area form $\omega$, which is simply $dx_1\wedge dx_2$ on $V$, $C_1$, and $C_2$. 
Moreover, there exists a chart $(S,\Phi)$ such that the corresponding vector field $b(x,y)$ on $D:=\Phi(S)$ satisfies that $\{b(x,y)-\bar b(x):y\in\mathbb T^m\}$ spans $\mathbb R^2$ for each $x\in D$ and the averaged process is a Hamiltonian system with respect to $dx_1\wedge dx_2$ on $D$.
For example, as shown in Figure~\ref{fig:sphere}, we can modify the vector field on the plane outside $V$ so that there are two disks with the same center $D_1\subset D_2$, and the averaged process is a Hamiltonian system in $D_2$, in particular, rotation between $\partial D_1$ and $\partial D_2$. Then $D_2$ is smoothly glued to a hemisphere and the resulting manifold is $M$, and the vector field can be extended to the surface in such a way that the averaged process is a rotation with certain constant angular velocity on the level sets. 
%----------------------------------------Explicit construction---------------------------------------
\iffalse
For example, as shown in Figure~\ref{fig:sphere}, we can modify the vector field on the plane outside $V_k$ so that there are two disks with the same center $D_1\subset\Tilde{D}$, and the averaged process is a Hamiltonian system in $\Tilde D$, in particular, rotation between $\partial D_1$ and $\partial\Tilde D$. The state space outside $\Tilde D$ is then replaced by a compact surface $S$ and the resulting manifold is $M$. Let us choose a disk $D_2$ that is diffeomorphic to $D_1$ and a chart $\Phi$ from $M\setminus D_1$ to $D_2$, which locally on $\Tilde D\setminus D_1$ is a reflection with respect to $\partial D_1$. Now we are able to define the vector field on $\Phi(\Tilde D\setminus D_1)\subset D_2$ and the averaged process is a Hamiltonian system with $H_1:=H\circ\Phi^{-1}$. The vector field can be then extended to the whole disk $D_2$ such that the averaged process is a Hamiltonian system with $H_1$ which has one extremum point, and the vector field on $M\setminus\Tilde D$ can also be defined accordingly by $\Phi$. Note that the vector field can be chosen such that the assumptions \textit{H(1)}, \textit{H(2)}, and \textit{H(4)} holds on both $\Tilde D$ and $D_2$.
\fi
%-------------------------------------------------------------------------------------------


% Figure environment removed

It is clear that, when restricted to $V\times\mathbb T^m$, the resulting system defined on $M\times\mathbb T^m$ has exactly the same behavior as the original process on $\mathbb R^2\times\mathbb T^m$. Therefore, it suffices to prove \eqref{eq:martingale_problem_stopped} for the new process on $M\times\mathbb T^m$.
Let us formally restate the corresponding assumptions and formulate the result on $M\times\mathbb T^m$. 
%Recall $S$ is the surface replacing $C_3$, $(S,\Phi)$ is the chart such that $\omega=dx\wedge dy$, and $D=\Phi(S)$. Let $U:=M\setminus S$ be the domain that includes $V$ and possible $C_1$ and $C_2$ inside $V$. 
In the remainder of the paper, all the definitions (e.g. the quantities defined in Section~\ref{sec:mainresult}) and statements on $M$ are understood by locally choosing coordinates so that $\omega=dx_1\wedge dx_2$. In particular, on $S$, they are understood in the coordinate $\Phi$, while on the "flat" part that contains $V$, they are understood in the usual way.
Then the assumptions on the coefficients on $M\times\mathbb T^m$ are analogous to those introduced earlier, so we only mention the differences:
\begin{enumerate}
    \item[\hypertarget{H2'}{\textit{(H2$'$)}}]$H(x)$ is a $C^\infty$ function from $M$ to $\mathbb R$  that has three extremum points and one saddle point.
    \item[\hypertarget{H3'}{\textit{(H3$'$)}}] $b(x,y)$ is a $C^\infty$ function from $M\times\mathbb T^m$ to $TM$ such that $\bar b(x)=\nabla^\perp H(x)$. 
    \item[\hypertarget{H4'}{\textit{(H4$'$)}}] $\{b(x,y)-\bar b(x):y\in\mathbb T^m\}$ spans $TM$ for all $x\in M$.
    %\item[\textit{(H4$'$)}] The perturbation is non-degenerate: $\{b(x,y)-\bar b(x):y\in\mathbb T^m\}$ spans $TM$ and is bounded together with its derivatives for all $x\in M$.
\end{enumerate}

%-----------------------------------------------------------------------------------
%------------------------------------------------------------------------------------
From this point on, we denote the process on $M\times\mathbb T^m$ as $(\bx_t^\e,\bxi_t^\e)$, and $(X_t^\e,\xi_t^\e)$ on the time scale $O(\e^{-1})$ (defined by \eqref{eq:theprocess1} and \eqref{eq:rescaled_process1} with $\mathbb R^2$ replaced by $M$), and assume that the conditions \hyperlink{H2'}{\textit{(H2$'$)-(H4$'$)}} replacing \hyperlink{H2}{\textit{(H2)-(H4)}} hold. Then \eqref{eq:mgprob} follows from
\begin{proposition}
\label{prop:main_result}
For each $f\in \mathcal D_{\mathcal L}$ and each $T>0$,
    \begin{equation}
    \label{eq:mg_problem_M}
        \E_{(x,y)}[f(h(X_{\eta}^\e))-f(h(x))-\int_0^{\eta}\mathcal Lf(h(X_t^\e))dt]\to0,
    \end{equation}
    as $\e\to0$, uniformly in $x\in M$, $y\in\mathbb T^m$, and $\eta\leq T$ that is a stopping time w.r.t. $\mathcal F_t^{X^\e_\cdot}$.
\end{proposition}
%%---------------------------------------------------------------------------------------------
\subsection{Auxiliary process}
It turns out that similar results hold for a more general process with a slightly perturbed fast motion:
\begin{equation}
\label{eq:auxiliary}
\begin{aligned}
    d\tbx_t^\e=&\ b(\tbx_t^\e,\tbxi^\e_t)dt,\\
    d\tbxi^\e_t=&\ \frac{1}{\e}v(\tbxi^\e_t)dt+\frac{1}{\sqrt\e}\sigma(\tbxi^\e_t)dW_t+c(\tbx_t^\e,\tbxi^\e_t)dt,
\end{aligned}
\end{equation}
where $c(x,y)$ is infinitely differentiable. 
Namely, $h(\tbx_{t/\e}^\e)$ converges weakly to the Markov process defined by the operator $(\mathcal L_c, D(\mathcal L_c))$ on the Reeb graph. 
Here, the subscript $c$ indicates that $\mathcal L_c$ depends on the choice of $c(x,y)$. If $c(x,y)=0$, then it is clear that $(\tbx_t^\e,\tbxi_t^\e)=(\bx_t^\e,\bxi_t^\e)$, and thus $\mathcal L=\mathcal L_c$. 
However, if $c(x,y)\not=0$, then we have an additional drift term in \eqref{eq:auxiliary}, and thus we need an additional drift term in the generator of the limiting process. 
While a precise definition of $(\mathcal L_c, D(\mathcal L_c))$ is deferred to later sections, we observe that the operators replacing $L_k$ depend on $c(x,y)$, and the domain $D(\mathcal L_c)$ as well as the linear subspace, denoted by $\mathcal D_{\mathcal L_c}$, chosen in Lemma~\ref{lem:martingale_problem} also vary for different $c(x,y)$. 
Therefore, in order to formulate general results, we consider $\mathcal D$, the set of  continuous functions on $\mathbb G$ that are four-times continuously differentiable inside each edge and satisfy conditions (i) and (iii) in Definition~\ref{def:domain_original}, as well as a weaker form of condition (ii), namely, the limits $\lim_{h_k\to O_i} L_k f(h_k)$ exist but are not necessarily independent of the edge $I_k$. 
Note that $\mathcal D$ contains $\mathcal D_{\mathcal L_c}$ for all choices of $c(x,y)$. Define $\mathcal L_c$ on $\mathcal D$ by applying the differential operator ($L_k$ plus an additional drift corresponding to $c(x,y)$) on each edge separately, with the result not being necessarily continuous at the interior vertices. 
%Then $\mathcal L_c$ on $D(\mathcal L_c)$, which is used to define the limiting process on the graph, will simply be defined as the restriction on $D(\mathcal L_c)$. 

%%---------------------------------------------------------------------------------------------

As mentioned before, we need to construct a family of auxiliary processes that, on the one hand, have a common invariant measure for all $\e>0$ and, on the other hand, are very close to the processes of interest. 
The auxiliary process on $M$ can in fact be obtained by choosing a special $c(x,y)$ in \eqref{eq:auxiliary}.
We denote this particular choice of $c(x,y)$ as $\Tilde c(x,y)$. 
%The process is close to $(\bx_t^\e,\bxi_t^\e)$ in the sense that the measures induced are absolutely continuous with density bounded in $L^2$-norm on time scale $O(\e^{-1})$ by Girsanov theorem, given that $\Tilde c(x,y)$ is bounded. 
Now we find $\Tilde c(x,y)$ such that $\lambda\times\mu$ is the invariant measure for the process with every $\e$, where $\lambda$ is the area measure w.r.t. $\omega$ and $\mu$ is the invariant measure for $\bxi_t^\e$ in $\mathbb T^m$. 
\iffalse
Let $L^\e=\frac{1}{\e}L$ be the generator of the process $\bxi_t^\e$:
\[
L^\e f(y)=\frac{1}{\e}v(y)\cdot\nabla_y f(y)+\frac{1}{2\e}\sum_{i,j}(\sigma\sigma^*)_{ij}(y)\frac{\partial^2}{\partial y_i\partial y_j}f(y),
\]
\fi
Let $\Tilde L^\e$ be the generator of the process $(\tbx_t^\e,\tbxi_t^\e)$:
\[
\T L^\e f(x,y)=b(x,y)\cdot\nabla_x f(x,y)+\Tilde c(x,y)\cdot\nabla_y f(x,y)+\frac{1}{\e}L f(x,y).
\]
Hence, $\lambda\times\mu$ is the invariant measure if ${\T L^{\e*}}p(y)=0$, where ${\T L^{\e*}}$ is the adjoint operator of $\T L^\e$ and $p$ is the density of $\mu$, i.e.
\begin{equation}
\label{eq:adjointoperator}
\begin{aligned}
    0={\T L^{\e*}}p(y)=&-\mathrm{div}_x (b(x,y)p(y))-\mathrm{div}_y(\Tilde c(x,y)p(y))+\frac{1}{\e}L^{*}p(y),
\end{aligned}
\end{equation}
where $L^{*}$ is the adjoint operator of $L$. Since $\mu$ is the invariant measure for $\bxi^\e_t$, the last term vanishes. Hence \eqref{eq:adjointoperator} reduces to 
\begin{equation}
\label{eq:added term}
    \mathrm{div}_x b(x,y)p(y)+\mathrm{div}_y(\Tilde c(x,y)p(y))=0.
\end{equation}
To see the existence of the solution, we need the following lemma (cf. Lemma~2.1 in \cite{Freidlin2021}).
\begin{lemma}
\label{lem:solution}
    Let $\Tilde g(x,y)$ be a bounded function on $\mathbb R^2\times\mathbb T^m$ that is infinitely differentiable, and let $\Tilde L$ be the generator of a non-degenerate diffusion on $\mathbb T^m$ with the unique invariant measure $\Tilde\mu$ and suppose that $\int_{\mathbb T^m}\Tilde g(x,y)d\Tilde{\mu}(y)=0$ for each $x\in \mathbb R^2$. Then there exists a unique solution $\Tilde{u}(x,y)$ to the equation
    \begin{equation}
    \label{eq:theequation}
        \Tilde L\Tilde{u}(x,y)=-\Tilde{g}(x,y),~~~\int_{\mathbb T^m}\Tilde u(x,y)d\Tilde{\mu}(y)=0,
    \end{equation}
    and $\Tilde{u}(x,y)$ is also bounded and infinitely differentiable.
    Moreover, if $\tilde g(x,y)$ has uniformly bounded derivatives up to order $K$ in $x$ (or $y)$, the same holds for $\tilde u(x,y)$.
%is bounded together with its partial derivatives in $x$ up to order $K$, continuous in $(x,y)$, and Lipschitz continuous in $y$ uniformly in $x$, then $\Tilde u(x,y)$ is bounded and continuous together with its first derivative in $y$ and higher order derivatives in $x$ up to order $K$.
\end{lemma}
\begin{remark}
\label{rmk:existence_of_c}
The same result also holds for functions on $M\times\mathbb T^m$.
Thus, the existence of the solution to \eqref{eq:added term} immediately follows from Lemma~\ref{lem:solution} applied to $\Tilde g(x,y)=\mathrm{div}_x b(x,y)p(y)$ and $\Tilde L=\Delta_y$, and by taking the gradient of the solution in \eqref{eq:theequation} w.r.t. $y$, and dividing it by $p(y)$.
\end{remark}
As in \eqref{eq:rescaled_process1}, we define $(\tx_t^\e,\txi_t^\e)=(\tbx_{t/\e}^\e,\tbxi_{t/\e}^\e)$ in distribution.
Then, a simple corollary can be obtained by using Lemma~\ref{lem:solution} and then applying Ito's formula to the corresponding solution $\Tilde u(\tbx_t^\e,\tbxi_t^\e)$ and $\Tilde u(\tx_t^\e,\txi_t^\e)$ (cf. Lemma~2.3 in \cite{Freidlin2021}).
\begin{corollary}
    \label{cor:avg}
    Let $\Tilde g$ satisfy the all the conditions in Lemma~\ref{lem:solution} with $\Tilde{L}=L$ and $K=1$, then for fixed $T>0$
    \begin{equation}
        \label{eq:avg_coef}
        \E_{(x,y)}\left|\int_0^{\eta} \Tilde g(\tbx_s^\e,\tbxi_s^\e)ds\right|=O(\sqrt\e),~~~~\E_{(x,y)}\left|\int_0^{\eta} \Tilde g(\tx_s^\e,\txi_s^\e)ds\right|=O(\e),
    \end{equation}
    uniformly in $x\in M$, $y\in\mathbb T^m$, and $\eta$ that is a stopping time bounded by $T$.
\end{corollary}

%%---------------------------------------------------------------------------------------------
\subsection{Diffusion approximation}
Since $\int_{\mathbb T^m}(b(x,y)-\bar b(x))d\mu(y)=0$, by Lemma~\ref{lem:solution}, there exists a function $u$ that is bounded together with its derivatives such that
\begin{equation}
\label{eq:u}
    L u(x,y)=-(b(x,y)-\bar b(x)).
\end{equation}
The equation is understood element-wise. Apply Ito's formula to $u(\tbx_t^\e,\tbxi_t^\e)$:
\begin{equation}
\label{eq:ito_diffusion_approx}
    \begin{aligned}
        u(\tbx_t^\e,\tbxi_t^\e)&=u(x_0,y_0)+\frac{1}{\e}\int_0^tLu(\tbx_s^\e,\tbxi_s^\e)+\frac{1}{\sqrt{\e}}\int_0^t\nabla_y u(\tbx_s^\e,\tbxi_s^\e)\sigma(\tbxi_s^\e)dW_s\\
        &\quad+\int_0^t [\nabla_x u(\tbx_s^\e,\tbxi_s^\e)b(\tbx_s^\e,\tbxi_s^\e)+\nabla_y u(\tbx_s^\e,\tbxi_s^\e)c(\tbx_s^\e,\tbxi_s^\e)]ds.
    \end{aligned}
\end{equation}
Combining \eqref{eq:auxiliary}, \eqref{eq:u}, and \eqref{eq:ito_diffusion_approx}, we obtain
\begin{equation}
\label{eq:slowx}
    \begin{aligned}
        \tbx_t^\e &= x_0+\int_0^t\nabla^\perp H(\tbx_s^\e)ds+\e\int_0^t [\nabla_x u(\tbx_s^\e,\tbxi_s^\e)b(\tbx_s^\e,\tbxi_s^\e)+\nabla_y u(\tbx_s^\e,\tbxi_s^\e)c(\tbx_s^\e,\tbxi_s^\e)]ds\\
        &\quad+\sqrt{\e}\int_0^t \nabla_y u(\tbx_s^\e,\tbxi_s^\e)\sigma(\tbxi_s^\e)dW_s+\e(u(x_0,y_0)-u(\tbx_t^\e,\tbxi_t^\e)).
    \end{aligned}
\end{equation}
Similarly, by applying Ito's formula to $u(\tx_t^\e,\txi_t^\e)$ and repeating the steps above, we have
\begin{equation}
\label{eq:x}
    \begin{aligned}
        \tx_t^\e &= x_0+\frac{1}{\e}\int_0^t\nabla^\perp H(\tx_s^\e)ds+\int_0^t [\nabla_x u(\tx_s^\e,\txi_s^\e)b(\tx_s^\e,\txi_s^\e)+\nabla_y u(\tx_s^\e,\txi_s^\e)c(\tx_s^\e,\txi_s^\e)]ds\\
        &\quad+\int_0^t \nabla_y u(\tx_s^\e,\txi_s^\e)\sigma(\txi_s^\e)dW_s+\e(u(x_0,y_0)-u(\tx_t^\e,\txi_t^\e)).
    \end{aligned}
\end{equation}
\iffalse
The presence of last term prevents us from applying Ito's formula to function of $\tx_t^\e$, so we define rather artificially a process $\hx_t^\e$ by simply discarding the last term:
\begin{equation}
\label{eq:hx}
\begin{aligned}
    \hx_t^\e &= x_0+\frac{1}{\e}\int_0^t\nabla^\perp H(\tx_s^\e)ds+\int_0^t [\nabla_x u(\tx_s^\e,\txi_s^\e)b(\tx_s^\e,\txi_s^\e)+\nabla_y u(\tx_s^\e,\txi_s^\e)c(\tx_s^\e,\txi_s^\e)]ds\\
        &\quad+\int_0^t \nabla_y u(\tx_s^\e,\txi_s^\e)\sigma(\txi_s^\e)dW_s.
\end{aligned}
\end{equation}
\fi
This idea of diffusion approximation is frequently used in the remainder of the paper, and the function $u(x,y)$ always refers to the solution to \eqref{eq:u}.