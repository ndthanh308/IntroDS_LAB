\section{Averaging principle inside one domain}
\label{sec:averaging}
In this section, we consider a general process $(\tx_t^\e,\txi_t^\e)$ defined after Remark~\ref{rmk:existence_of_c}, which is a faster version of the process in \eqref{eq:auxiliary}. 
The process takes values on $M\times\mathbb T^m$.
As a result of localization, $M$ is separated into three domains, each bounded by the separatrix or a part of it.
This section is devoted to the proof of the averaging principle for $(\tx_t^\e,\txi_t^\e)$ on $M\times\mathbb T^m$ up to time when $\tx_t^\e$ exits from one of the three domains. The domain under consideration will be denoted by $U$. 
Therefore, without any ambiguity, the projection $h$ simply reduces to the Hamiltonian $H$.
Let $U(h_1,h_2)$ be the region in $U$ between $\gamma(h_1)$ and $\gamma(h_2)$, $O$ be the saddle point, and $O'$ be the extremum point, and further define stopping times $\tau(h)=\inf\{t:|H(\tx_t^\e)-H(O)|=h\}$ and $\eta(h)=\inf\{t:|H(\tx_t^\e)-H(O')|=h\}$.
Without loss of generality, we assume that $H(O)=0$ and $H(O')=1$.
\subsection{Averaging principle before \texorpdfstring{$\tau(\e^\alpha)\wedge\eta(\delta)$}{}}
\label{sec:Averaging principle before}
We aim to prove the averaging principle between $\gamma(\e^\alpha)$ and $\gamma(1-\delta)$ with constants $0<\alpha<1/4$ and $0<\delta<1$.
Notice that, for technical reasons, we assume that $0<\alpha<1/4$ in this intermediate result and in the proofs that utilize it in this subsection and the next, while we always assume that $0<\alpha<1/2$ elsewhere.
Let us further define another coordinate $\phi$ inside this domain $U$. 
Let $l$ denote the curve that is tangent to $\nabla H$ at each point and connects the saddle point $O$ and the extremum point $O'$, and let $l(h)$ be the intersection of $l$ and $\gamma(h)$.
Let $Q(h)$ denote the time it takes for the averaged process $\bm x_t$ to make one rotation on $\gamma(h)$ and $q(x)$ denote the time it takes for $\bm x_t$ starting from $l(H(x))$ to arrive at $x$. Now we define the coordinate $\phi(x)=q(x)/Q(H(x))$ whose range is $S^1:=\mathbb R\ (\mathrm{mod}\ 1)$. It is easy to see that $\bm x_t$ has constant speed $1/Q(H(\bm{x}_t))$ in $\phi$ coordinate.
Since there is logarithmic delay near the saddle point, the coordinate $\phi$ has exploding derivatives near the separatrix. However, as shown in Appendix~\ref{sec:derivatives}, the order of its derivatives w.r.t. the Euclidean coordinates is under control. 
Let us denote $\Tilde H_t^\e=H(\tx_t^\e)$ and $\Tilde\Phi_t^\e=\phi(\tx_t^\e)$. Along the same lines leading to \eqref{eq:x}, we have the following equations with $u_h=u\cdot\nabla H$, $u_\phi=u\cdot\nabla\phi$, $h_0=H(x_0)$, and $\phi_0=\phi(x_0)$:
\begin{align}
    \Tilde H_t^\e&=h_0+\int_0^t \nabla_y u_h(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)dW_s+\e(u_h(x_0,y_0)-u_h(\tx_t^\e,\txi_t^\e))\nonumber\\
    &\quad+\int_0^t[\nabla_x u_h(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_h(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)]ds,\label{eq:H}\\
    \Tilde\Phi_t^\e&=\phi_0+\int_0^t \nabla_y u_\phi(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)dW_s+\frac{1}{\e}\int_0^t\frac{1}{Q(\tilde H_s^\e)}ds\nonumber\\
    &\quad+\int_0^t[\nabla_x u_\phi(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_\phi(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)]ds\nonumber\\
    &\quad+\e(u_\phi(x_0,y_0)-u_\phi(\tx_t^\e,\txi_t^\e)),\label{eq:phi}
\end{align}
for $\e^\alpha\leq h_0\leq 1-\delta$ and $t\leq\tau(\e^\alpha)\wedge\eta(\delta)$. {The term multiplied by $1/\e$ in \eqref{eq:H} disappears since $\nabla H\cdot\nabla^\perp H=0$.} Define the following coefficients using the original coordinates for all $x\in M$:
\begin{equation}
\begin{aligned}
    \label{eq:definition_of_operator_AB_x}
    A(x)&=\int_{\mathbb T^m}|\nabla_y u_h(x,y)^{\mathsf T}\sigma(y)|^2d\mu(y),\\
    {B_c}(x)&=\int_{\mathbb T^m}[\nabla_xu_h(x,y)\cdot b(x,y)+\nabla_y u_h(x,y)\cdot c(x,y)]d\mu(y);
\end{aligned}
\end{equation}
and $(h,\phi)$ coordinates for $x=(h,\phi)$, where $\e^\alpha\leq h\leq 1-\delta$ and $\phi\in S^1$:
\begin{equation}
    \begin{aligned}
    \label{eq:definition_of_operator_AB}
    A(h,\phi)&= A(x),~~~~~~\bar A(h)=\int_{S^1} A(h,\phi)d\phi,\\
    {B_c}(h,\phi)&= {B_c}(x),~~~~\bar {B_c}(h)=\int_{S^1} {B_c}(h,\phi)d\phi.
\end{aligned}
\end{equation}
Define ${\mathcal L_c}$ by ${\mathcal L_c}f=\frac{1}{2}\bar Af''+\bar {B_c}f'$ for $f\in\mathcal D$ in the interior of each edge. In particular, when $c(x,y)=0$, this definition is consistent with that in \eqref{def:operatorL}. Introduce two processes close to $\Tilde H_t^\e,\Tilde\Phi_t^\e$:
\begin{align}
    \hat H_t^\e&=h_0+\int_0^t \nabla_y u_h(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)dW_s\nonumber\\
    &\quad+\int_0^t[\nabla_x u_h(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_h(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)]ds,\label{eq:h_hat}\\
    \hat \Phi_t^\e&=\phi_0+\int_0^t \nabla_y u_\phi(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)dW_s+\frac{1}{\e}\int_0^t\frac{1}{Q(\tilde H_s^\e)}ds\nonumber\\
    &\quad+\int_0^t[\nabla_x u_\phi(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_\phi(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)]ds.\label{eq:phi_hat}
\end{align}
For each $f\in \mathcal D$, $x\in U(\e^\alpha,1-\delta)$, $y\in\mathbb T^m$, and stopping time {$\sigma'\leq T\wedge\eta(\delta)\wedge\tau(\e^\alpha)$}, by Ito's formula applied to $f(\hat H_{\sigma'}^\e)$, we have
\begin{equation}
    \begin{aligned}
        \E_{(x,y)} f(\hat H_{\sigma'}^\e)&=f(H(x))+\E_{(x,y)}\int_0^{\sigma'}\left(\frac{1}{2} |\nabla_y u_h(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)|^2f''(\hat H_s^\e)\right.\\
        &\quad\left.+ \left[\nabla_x u_h(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_h(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)\right]f'(\hat H_s^\e)\right)ds.
    \end{aligned}
\end{equation}
Since $\sup_{0\leq t\leq\sigma'}|\Tilde H_t^\e-\hat H_t^\e|=O(\e)$,
\begin{equation}
\label{eq:f}
    \begin{aligned}
        \E_{(x,y)} f(\Tilde H_{\sigma'}^\e)&=f(H(x))+\E_{(x,y)}\int_0^{\sigma'}\left(\frac{1}{2} |\nabla_y u_h(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)|^2f''(\Tilde H_s^\e)\right.\\
        &\quad\left.+ \left[\nabla_x u_h(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_h(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)\right]f'(\Tilde H_s^\e)\right)ds+O(\e).
    \end{aligned}
\end{equation}
Combining this with \eqref{eq:definition_of_operator_AB_x} and \eqref{eq:definition_of_operator_AB}, by Lemma~\ref{lem:solution}, as in Corollary~\ref{cor:avg}, we have
\begin{equation}
\label{eq:the_result}
    \E_{(x,y)}\left[f(\Tilde H_{\sigma'}^\e)-f(H(x))-\int_0^{\sigma'}\left(\frac{1}{2}A(\Tilde H_s^\e,\Tilde \Phi_s^\e)f''(\Tilde H_s^\e)+{B_c}(\Tilde H_s^\e,\Tilde \Phi_s^\e)f'(\Tilde H_s^\e)\right)ds\right]=O(\e).
\end{equation}
\begin{lemma}
\label{lem:avg_rotation}
Let $g(h,\phi)$ be either $A(h,\phi)f''(h)$ or ${B_c}(h,\phi)f'(h)$, and $\bar g(h)=\int_{S^1}g(h,\phi)d\phi$. 
Then, for every $T>0$,
\begin{equation}
    \sup_{\substack{x\in U(\e^\alpha, 1-\delta)\\ y\in\mathbb T^m}}\sup_{\sigma'\leq T\wedge\eta(\delta)\wedge\tau(\e^\alpha)}\E_{(x,y)}\left|\int_0^{\sigma'} \left[g(\Tilde H_s^\e,\Tilde \Phi_s^\e)-\bar g(\Tilde H_s^\e)\right]ds\right|\to0,~~\text{as }\e\downarrow0,
\end{equation}where the first supremum is taken over all stopping times {$\sigma'\leq T\wedge\eta(\delta)\wedge\tau(\e^\alpha)$}.
\end{lemma}
\begin{proof}
Fix $\kappa>0$. Since, for fixed $h$, $g(h,\phi)-\bar g(h)$ is a function on $S^1$, we can approximate it by a finite sum of its Fourier series with error less than $\frac{\kappa}{2T}$:
\begin{equation}
    g(h,\phi)-\bar g(h)\approx\sum_{0<|k|\leq K(\e)}g_k(h,\phi):=\sum_{0<|k|\leq K(\e)}G_k(h)\exp(2\pi ik\phi),
\end{equation}for all $\e^\alpha\leq h\leq 1-\delta$ and $\phi\in S^1$,
where
\begin{equation}
    G_k(h)=\int [g(h,\phi)-\bar g(h)]\exp(-2\pi ik\phi)d\phi.
\end{equation}
Since, as shown in Appendix~\ref{sec:derivatives}, $g''_{\phi\phi}=O(|\log h|/h)$, we see that $K(\e)$ can be chosen as $\e^{-\alpha}|\log \e|^2$ for sufficiently small $\e$.
Then it suffices to prove that, for all $0<|k|\leq K(\e)$ and $\e$ sufficiently small,
\begin{equation}
\label{eq:suffice}
    \sup_{\substack{x\in U(\e^\alpha, 1-\delta)\\ y\in\mathbb T^m}}\sup_{\sigma'\leq T\wedge \eta(\delta)\wedge\tau(\e^\alpha)}\E_{(x,y)}\left|\int_0^{\sigma'} g_k(\Tilde H_s^\e,\Tilde \Phi_s^\e)ds\right|=o\left(\frac{\e^\alpha}{|\log \e|^2}\right).
\end{equation}
We define an auxiliary function $v$ for fixed $g_k$, where $0<|k|\leq K(\e)$:
\begin{equation}
    v=\frac{g_k(h,\phi)Q(h)}{2\pi ik},
\end{equation}
which satisfies that $v'_\phi/Q(h)=g_k(h,\phi)$. We formulate the bounds on $\phi$, $v$, $g$, and their derivatives, uniformly in all $\e^\alpha<h<1-\delta$ and $0<|k|\leq K(\e)$ (proved in the Appendix~\ref{sec:derivatives}):
\begin{equation}
\label{eq:bounds}
\begin{aligned}
    \phi&\in[0,1),~\nabla\phi=O(1/h),~\nabla^2\phi=O(1/h^2),\\
    v &= O(|\log h|),~v'_\phi=O(|\log h|),~v''_{\phi\phi}=O(|\log h|^3/h),\\
    v'_h&=O(|\log h|^2/h),~v''_{hh}=O(|\log h|^3/h^3),~v''_{\phi h}=O(|\log h|^2/h),\\
    g'_h&=O(|\log h|/h),~g''_{hh}=O(|\log h|^2/h^3).
\end{aligned}
\end{equation}
By comparing $(\Tilde H_t^\e,\Tilde\Phi_t^\e)$ and $(\hat H_t^\e,\hat \Phi_t^\e)$ in \eqref{eq:H}, \eqref{eq:phi}, \eqref{eq:h_hat}, and \eqref{eq:phi_hat}, and using the bounds in \eqref{eq:bounds}, we know that for all {$\sigma'\leq T\wedge\eta(\delta)\wedge\tau(\e^\alpha)$},
\begin{equation}
\label{eq:gk_close}
    \int_0^{\sigma'}\left|g_k(\Tilde H_s^\e,\Tilde\Phi_s^\e)-\frac{v'_{\phi}(\hat  H_s^\e,\hat \Phi_s^\e)}{Q(\tilde H_s^\e)}\right|ds=\int_0^{\sigma'}\left|\frac{v'_{\phi}(\tilde  H_s^\e,\tilde \Phi_s^\e)-v'_{\phi}(\hat  H_s^\e,\hat \Phi_s^\e)}{Q(\tilde H_s^\e)}\right|ds=O(\e^{1-2\alpha}|\log\e|^3).
\end{equation}
Apply Ito's formula to $v(\hat H_{\sigma'}^\e,\hat \Phi_{\sigma'}^\e)$ and obtain
\begin{align*}
    \frac{1}{\e}\int_0^{\sigma'} \frac{v'_{\phi}(\hat  H_s^\e,\hat \Phi_s^\e)}{Q(\tilde H_s^\e)}ds&=v(\hat H_{\sigma'}^\e,\hat \Phi_{\sigma'}^\e)-v(H(x),\phi(x))-\int_0^{\sigma'}v'_h(\hat H_s^\e,\hat \Phi_s^\e)\nabla_y u_h(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)  dW_s\\
    &\quad-\int_0^{\sigma'} v'_h(\hat H_s^\e,\hat \Phi_s^\e)[\nabla_x u_h(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_h(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)]ds\\
    &\quad-\frac{1}{2}\int_0^{\sigma'}v''_{hh}(\hat H_s^\e,\hat \Phi_s^\e)|\nabla_y u_h(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)|^2ds\\
    &\quad-\int_0^{\sigma'}v'_\phi(\hat H_s^\e,\hat \Phi_s^\e)\nabla_y u_\phi(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)dW_s\\
    &\quad-\int_0^{\sigma'} v'_\phi(\hat H_s^\e,\hat \Phi_s^\e)[\nabla_x u_\phi(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_\phi(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)]ds\\
    &\quad-\frac{1}{2}\int_0^{\sigma'}v''_{\phi\phi}(\hat H_s^\e,\hat \Phi_s^\e)|\nabla_y u_\phi(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)|^2ds\\
    &\quad-\int_0^{\sigma'}v_{\phi h}''\nabla_y u_h(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)\sigma(\txi_s^\e)^{\mathsf T}u_\phi(\tx_s^\e,\txi_s^\e)ds.
\end{align*}
By using the estimates in \eqref{eq:bounds} and the fact that $0<\alpha<1/4$, we know that the expectation of the {right-hand side} is $o(\frac{\e^{\alpha-1}}{|\log\e|^2})$. Combining this with \eqref{eq:gk_close}, we get \eqref{eq:suffice}. {Thus, the desired result follows.}
\end{proof}
Now, applying Lemma~\ref{lem:avg_rotation} to \eqref{eq:the_result}, we get
\begin{lemma}
\label{lem:bounded}
For each $f\in \mathcal D$, $0<\alpha<1/4$, and $0<\delta<1$, as $\e \downarrow 0$,
\begin{equation}
\label{eq:bounded}
    \sup_{\substack{x\in U(\e^\alpha, 1-\delta)\\ y\in\mathbb T^m}}\sup_{\sigma'\leq T\wedge\eta(\delta)\wedge\tau(\e^\alpha)}|\E_{(x,y)}[f(H(\tx_{\sigma'}^\e))-f(H(x))-\int_0^{\sigma'}{\mathcal L_c}f(H(\tx_s^\e))ds]|\to0,
\end{equation}where the first supremum is taken over all stopping times $\sigma'\leq T\wedge\eta(\delta)\wedge\tau(\e^\alpha)$.
\end{lemma}
\begin{remark}
\label{rmk:accessibility}
The diffusion process governed by $\mathcal L_c$ can reach all points inside the edge and the interior vertex but cannot reach the exterior vertex. For example, in the case considered here, the process can reach all points in $[0,1)$ but cannot reach $1$. The reason is that, for each $\delta>0$, on $[0,1-\delta]$, $\bar B_c(h)$ is bounded and $1/\bar A(h)\lesssim|\log h|$ (see Appendix~\ref{sec:derivatives} for details). However, for $\kappa>0$ sufficiently small, on $[1-\kappa,1]$, $B_c$ is uniformly negative while $A(h)\lesssim 1-h$ due to the non-degeneracy of the maximum point (see Lemma~\ref{lemb:non-zero-drift} for details).
\end{remark}
\begin{lemma}
    \label{lem:time_bounded_wo_t}
    For each $\delta>0$ and $0<\alpha<1/4$, $\E_{(x,y)}(\eta(\delta)\wedge\tau(\e^\alpha))$ in uniformly bounded for all $x\in U(\e^\alpha, 1-\delta)$, $y\in\mathbb T^m$, and $\e$ sufficiently small.
\end{lemma}
\begin{proof}
The solution $f^\delta$ to the following equation exists on $[0,1-\delta]$ due to Remark~\ref{rmk:accessibility}:
    \begin{equation}
    \begin{cases}
    {\mathcal L_c}f^\delta=-1\\
    f^\delta(0)=f^\delta(1-\delta)=0
    \end{cases}
    \end{equation}
Let $\Tilde T>3\|f^\delta\|_{\mathrm{sup}}$, then Lemma~\ref{lem:bounded} implies that, for all $x\in U(\e^\alpha, 1-\delta)$, $y\in\mathbb T^m$, and $\e$ small enough,
\begin{equation}
    \E_{(x,y)}(\eta(\delta)\wedge\tau(\e^\alpha)\wedge \Tilde T)<\Tilde T/2.
\end{equation}
Thus, by Markov inequality and strong Markov property, $\E_{(x,y)}(\eta(\delta)\wedge\tau(\e^\alpha))\leq 2\Tilde T$.
\end{proof}
\begin{lemma}
\label{lem:bounded_wo_t}
For each $f\in \mathcal D$, $\delta>0$, and $0<\alpha<1/4$, as $\e\downarrow0$,
\begin{equation}
\label{eq:bounded_wo_t}
    \sup_{\substack{x\in U(\e^\alpha, 1-\delta)\\ y\in\mathbb T^m}}\sup_{\sigma'\leq \eta(\delta)\wedge\tau(\e^\alpha)}|\E_{(x,y)} [f(H(\tx^\e_{\sigma'}))-f(H(x))-\int_0^{\sigma'}{\mathcal L_c} f(H(\tx_s^\e))ds]|\to0,
\end{equation}where the first supremum is taken over all stopping times $\sigma'\leq \eta(\delta)\wedge\tau(\e^\alpha)$.
\end{lemma}
\begin{proof}
The result can be deduced from \lemref{lem:bounded} and \lemref{lem:time_bounded_wo_t} by choosing a sufficiently large $T$ and using the Markov property.
\end{proof}

%%--------------------------------------------------------------------------------------------------





%%-------------------------------------------------------------------------------------------------
\subsection{Averaging principle before \texorpdfstring{$\sigma$}{sigma}}
With estimates on the transition times and probabilities between level sets near the critical points, the result from last subsection can be extended to the time when the process reaches the separatrix, {which is denoted by  $\sigma$.} The main result of this subsection is
\begin{proposition}
\label{prop:up_to_separatrix}
For each $f\in \mathcal D$, as $\e\downarrow0$,
\begin{equation}
\label{eq:main_result_before_sigma}
    \sup_{\substack{x\in U, y\in\mathbb T^m}}\sup_{\sigma'\leq\sigma}|\E_{(x,y)} [f(H(\tx^\e_{\sigma'}))-f(H(x))-\int_0^{\sigma'}{\mathcal L_{c}} f(H(\tx_s^\e))ds]|\to0,
\end{equation}where the first supremum is taken over all stopping times $\sigma'\leq \sigma$.
\end{proposition}
We state a simple corollary of Proposition~\ref{prop:exit_time_from_separatrix}.
\begin{corollary}
\label{cor:exit_time_eps}
    For each $0<\alpha<1/2$, uniformly in $x\in U(0,\e^\alpha)$ and $y\in\mathbb T^m$,
    \begin{equation}
        \E_{(x,y)}\sigma\wedge\tau(\e^\alpha)=O(\e^{2\alpha}|\log\e|).
    \end{equation}
\end{corollary}
\begin{lemma}
\label{lem:lin_prob}
    For each $0<\alpha<1/2$, uniformly in $x\in U(0,\e^\alpha)$ and $y\in\mathbb T^m$,
    \begin{equation}
        |\Prob_{(x,y)}(\tau(\e^\alpha)<\sigma)-H(x)\e^{-\alpha}|=O(\e^{\alpha}|\log\e|).
    \end{equation}
\end{lemma}
\begin{proof}
    As in \eqref{eq:H}, write the equation for $H(\tx_t^\e)=\Tilde H_t^\e$ stopped at ${\sigma\wedge\tau(\e^\alpha)}$, 
    \begin{align*}
        H(\tx_{\sigma\wedge\tau(\e^\alpha)}^\e)&=H(x)+\int_0^{\sigma\wedge\tau(\e^\alpha)}\nabla_x u_h(\tx_s^\e,\txi_s^\e)\cdot b(\tx_s^\e,\txi_s^\e)+\nabla_y u_h(\tx_s^\e,\txi_s^\e)\cdot c(\tx_s^\e,\txi_s^\e)ds\\
        &\quad+\int_0^{\sigma\wedge\tau(\e^\alpha)}\nabla_y u_h(\tx_s^\e,\txi_s^\e)^{\mathsf T}\sigma(\txi_s^\e)dW_s+O(\e).
    \end{align*}
    From Corollary~\ref{cor:exit_time_eps}, it follows that
    \begin{equation*}
        |\Prob_{(x,y)}(\tau(\e^\alpha)<\sigma)-H(x)\e^{-\alpha}|=\e^{-\alpha}|\E_{(x,y)} H(\tx_{\sigma\wedge\tau(\e^\alpha)}^\e)-H(x)|=O(\e^\alpha|\log\e|).\qedhere
    \end{equation*}
\end{proof}
We prove that the process spends finite time (in expectation) inside $U$. The idea is to use the fact that the process on the graph spends little time near the vertices and exits the edge with positive probability once it gets close enough to the interior vertex.
\begin{lemma}
\label{lem:time1}
    For each $0<\alpha<1/4$, $\E_{(x,y)}\tau(\e^\alpha)$ is uniformly bounded for all $x\in U$ such that $H(x)\geq\e^\alpha$, $y\in\mathbb T^m$, and $\e$ sufficiently small.
\end{lemma}
\begin{proof}
    By Lemma~\ref{lem:near_extremum}, fix $\delta>0$ such that $\E_{(x,y)}\eta(2\delta)\leq1$  for all $\e$ sufficiently small and all $x$ satisfying $H(x)>1-2\delta$ ; By Lemma~\ref{lem:bounded_wo_t}, fix $\kappa>0$ such that $\Prob_{(x,y)}(\eta(\delta)<\tau(\e^\alpha))<1-\kappa$ all $x$ satisfying $H(x)=1-2\delta$, all $y\in\mathbb T^m$, and all $\e$ sufficiently small; By Lemma~\ref{lem:time_bounded_wo_t}, fix $T>4(1+\sup_{x\in U(\e^\alpha, 1-\delta), y\in\mathbb T^m}\E_{(x,y)}(\tau(\e^\alpha)\wedge\eta(\delta)))/\kappa$.
    For all $x$ with $H(x)>1-2\delta$ and $y\in\mathbb T^m$,
    \begin{equation}
    \begin{aligned}
        &\Prob_{(x,y)}(\tau(\e^\alpha)>2T)\\ &\leq \Prob_{(x,y)}(\eta(2\delta)>T)
        +\sup_{(x',y')\in\gamma(1-2\delta)\times\mathbb T^m}\left(\Prob_{(x',y')}(\tau(\e^\alpha)\wedge\eta(\delta)>T)+\Prob_{(x',y')}(\eta(\delta)<\tau(\e^\alpha))\right)\\
        &\leq 1-\kappa/2.
    \end{aligned}
    \end{equation}
    For all $x\in U$ with $\e^\alpha\leq H(x)\leq 1-2\delta$, the estimate above holds without the first term on the second line. Then the uniform boundedness follows from the Markov property.
\end{proof}
We can apply the similar idea near the separatrix. Namely, we choose $0<\alpha'<\alpha<1/4$. By Corollary~\ref{cor:exit_time_eps}, the process spent little time spent between $\gamma$ and $\gamma(\e^{\alpha'})$, and by Lemma~\ref{lem:lin_prob}, the process is very likely to exit through the separatrix rather than come back to $\gamma(\e^{\alpha'})$ once it reaches $\gamma(\e^\alpha)$. Then, since $\E_{(x,y)}\tau(\e^\alpha)$ is uniformly bounded, one can prove the following result:
\begin{lemma}
\label{lem:time2}
    $\E_{(x,y)}\sigma$ is uniformly bounded for all $x\in U$, $y\in\mathbb T^m$, and $\e$ sufficiently small.
\end{lemma}
\begin{proof}[Proof of Proposition~\ref{prop:up_to_separatrix}]
     Fix $\kappa>0$ and $0<\alpha<1/4$. By Lemma~\ref{lem:time1}, let $T$ be large enough such that $\Prob_{(x,y)}(\tau(\e^\alpha)>T)<\kappa$ for all $x\in U$ satisfying $H(x)\geq\e^\alpha$, $y\in\mathbb T^m$, and $\e$ sufficiently small.
    By Lemma~\ref{lem:near_extremum}, let $\delta>0$ small enough such that for $\e$ sufficiently small
     \begin{equation}
     \label{eq:cov_near_extremum}
         \sup_{\substack{x\in U:H(x)\geq 1-\delta\\ y\in\mathbb T^m}}\sup_{\sigma'\leq\eta(\delta)}|\E_{(x,y)}[f(H(\tx_{\sigma'}^\e))-f(H(x))-\int_0^{\sigma'}\mathcal L_c f(H(\tx_s^\e))ds]|<\kappa,
     \end{equation}where the first supremum is taken over all stopping times $\sigma'\leq \eta(\delta)$.
     By Remark~\ref{rmk:accessibility} and Lemma~\ref{lem:bounded_wo_t}, let $\delta'>0$ small enough such that $\Prob_{(x,y)}(\eta(\delta')<\tau(\e^\alpha))<\kappa$ for all $x\in U(\e^\alpha,1-\delta)$, $y\in\mathbb T^m$, and $\e$ sufficiently small. 
     For stopping time $\sigma'\leq\tau(\e^\alpha)$, $x\in U(\e^\alpha,1-\delta)$, and $y\in\mathbb T^m$,
     \begin{equation}
     \label{eq:cov_to_eps}
         \begin{aligned}
             &|\E_{(x,y)} [f(H(\tx^\e_{\sigma'})-f(H(x))-\int_0^{\sigma'}{\mathcal L_c} f(H(\tx_s^\e))ds]|\\
             &\leq|\E_{(x,y)} [f(H(\tx^\e_{\eta(\delta')\wedge\sigma'})-f(H(x))-\int_0^{\eta(\delta')\wedge\sigma'}{\mathcal L_c} f(H(\tx_s^\e))ds]\\\
             &\quad+\Prob_{(x,y)}(\eta(\delta')<\sigma')\sup_{\substack{x'\in U:H(x')=\delta'\\ y'\in\mathbb T^m}}|\E_{(x',y')} [f(H(\tx^\e_{\sigma'}))-f(H(x'))-\int_0^{\sigma'}{\mathcal L_c} f(H(\tx_s^\e))ds]|.
         \end{aligned}
     \end{equation}
     Note that the first term converges to $0$ as $\e\downarrow0$ by Lemma~\ref{lem:bounded_wo_t}, the probability in the second term is less than $\kappa$, and the supremum is uniformly bounded for all $\e$ by Lemma~\ref{lem:time2}. Thus, the expression on the left-hand side of \eqref{eq:cov_to_eps} converges to $0$ uniformly. Combining this with \eqref{eq:cov_near_extremum}, we obtain
     \begin{equation}
     \label{eq:cov_to_eps2}
         \sup_{\substack{x\in U:H(x)\geq\e^\alpha\\ y\in\mathbb T^m}}\sup_{\sigma'\leq\tau(\e^\alpha)}|\E_{(x,y)}[f(H(\tx_{\sigma'}^\e))-f(H(x))-\int_0^{\sigma'}\mathcal L_c f(H(\tx_s^\e))ds]|\to0.
     \end{equation}
     Finally, let us choose $0<\alpha'<\alpha$. Apply Corollary~\ref{cor:exit_time_eps} and Lemma~\ref{lem:lin_prob} to obtain that $\E_{(x,y)}\sigma\wedge\tau(\e^{\alpha'})<\e^{\alpha'}$ and $\Prob_{(x,y)}(\sigma<\tau(\e^{\alpha'}))>1/2$ for all $x\in\gamma(\e^\alpha)$, $y\in\mathbb T^m$, and $\e$ sufficiently small. As in \eqref{eq:cov_to_eps}, by stopping the process at $\tau(\e^\alpha)\wedge\sigma'$ and $\tau(\e^{\alpha'})\wedge\sigma'$ and using the strong Markov property, we can conclude that 
     \begin{equation}
         \sup_{\substack{x\in U:H(x)\geq\e^\alpha\\ y\in\mathbb T^m}}\sup_{\sigma'\leq\sigma}|\E_{(x,y)}[f(H(\tx_{\sigma'}^\e))-f(H(x))-\int_0^{\sigma'}\mathcal L_c f(H(\tx_s^\e))ds]|\to0.
     \end{equation}
     Now \eqref{eq:main_result_before_sigma} follows from this by applying Corollary~\ref{cor:exit_time_eps} again.
\end{proof}


\input{avg_from_epsilon.tex}