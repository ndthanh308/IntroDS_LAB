\documentclass[journal,10pt,margin=1in]{IEEEtran}
\usepackage{amsmath,amsfonts,mathtools}
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\usepackage{algorithmic}
\usepackage{algorithm}
\usepackage{array}
\usepackage{textcomp}
\usepackage{stfloats}
\usepackage{url}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{gensymb}
\usepackage{cite}
\usepackage{cases}
\usepackage{glossaries}
\usepackage{multirow}
\usepackage{makecell}
\usepackage{color, colortbl}
\definecolor{mixed}{gray}{0.9}
\definecolor{synth}{gray}{0.8}
\usepackage{multicol}
\usepackage[tableposition=top]{caption}
\usepackage{subcaption}
\usepackage{siunitx}

\usepackage{colortbl}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepgfplotslibrary{fillbetween}
% \usepgfplotslibrary{external}
\usepackage{longtable}
\usepackage{xspace}
\usepackage{arydshln}
\usepackage{booktabs}

\usepackage{soul}

\usepackage[font=scriptsize]{subcaption}
\usepackage[font=footnotesize]{caption}

\usepackage[outdir=./]{epstopdf}
\usepackage{tikz}
\pgfplotsset{compat=newest}
\pgfplotsset{plot coordinates/math parser=false}
\newlength\fheight
\newlength\fwidth
\usetikzlibrary{plotmarks,shapes,patterns,decorations.pathreplacing,backgrounds,calc,arrows,arrows.meta,spy,matrix,external}
% \tikzexternalize[prefix=ext-imgs/]\usepgfplotslibrary{patchplots,groupplots,}
\usepackage{tikzscale}
\usepackage[utf8]{inputenc}
% \DeclareUnicodeCharacter{2212}{âˆ’}

\usepackage[capitalise]{cleveref}
\crefname{section}{Sec.}{Secs.}
\crefname{figure}{Fig.}{Figs.}

\usepackage{eqparbox}

\newcommand{\indices}[2]{{% \indices{<rows>}{<columns>}
  \begin{array}{@{}r@{}}
    \scriptstyle #2~\smash{\eqmakebox[ind]{$\scriptstyle\rightarrow$}} \\[-\jot]  
    \scriptstyle #1~\smash{\eqmakebox[ind]{$\scriptstyle\downarrow$}}
  \end{array}}}
\newcommand{\inputtikz}[1]{%
  \tikzsetnextfilename{#1}%
  \input{#1}%
}
\newcommand*\diff{\mathop{}\!\mathrm{d}}
\newcommand*\Diff[1]{\mathop{}\!\mathrm{d^#1}}
\DeclareMathOperator{\EX}{\mathbb{E}}% expected value

\newcommand{\myp}[1]{{\leavevmode\color{orange}\textbf{UM:} #1}}
\newcommand{\pt}[1]{{\leavevmode\color{red}\textbf{PT:} #1}}
\DeclareCaptionLabelFormat{andtable}{#1~#2  \&  \tablename~\thetable}

% Make the 'export as png' a seperate style, with default density 200
\tikzset{
    export as png/.style={
        external/system call/.add={}{
            && convert -density #1 -transparent white "\image.pdf" "\image.png"
        },
    },
    export as png/.default={200},
}
% -------------------------------------------------------------------------
% copied from <https://tex.stackexchange.com/a/83865/95441>
\hyphenation{op-tical net-works semi-conduc-tor IEEE-Xplore}
% updated with editorial comments 8/9/2021
\input{./acronymsSorted.tex}
\input{myTikz.tex}

\begin{document}

% \title{Do Reflections Count?\\ A Radio-Frequency Interference Analysis for Spectrum Coexistence at Sub-THz Bands}
\title{Modeling Interference for the Coexistence of\\6G Networks and Passive Sensing Systems}



\author{Paolo~Testolina,~\IEEEmembership{Student~Member,~IEEE},  Michele~Polese,~\IEEEmembership{Member,~IEEE},\\Josep M. Jornet,~\IEEEmembership{Senior Member,~IEEE},
    Tommaso~Melodia,~\IEEEmembership{Fellow,~IEEE},
    Michele~Zorzi,~\IEEEmembership{Fellow,~IEEE}
    % <-this % stops a space
    \thanks{P. Testolina and M. Zorzi are with the Department of Information Engineering, University of Padova, Padova, Italy. Email: \{testolina,zorzi\}@dei.unipd.it. M. Polese, J. M. Jornet, and T. Melodia are with the Institute for the Wireless Internet of Things, Northeastern University, Boston, MA. Email: \{m.polese, j.jornet, melodia\}@northeastern.edu. The work of P.\ Testolina was supported by Fondazione CaRiPaRo under grants ``Dottorati di Ricerca'' 2019. This work also partially funded by NSF with award CNS-2225590.}
    % \thanks{Manuscript received xxx, 2022; revised xxx, 2022.}
}

% The paper headers
% \markboth{Journal of \LaTeX\ Class Files,~Vol.~14, No.~8, December~2022}%
% {Shell \MakeLowercase{\textit{et al.}}: A Sample Article Using IEEEtran.cls for IEEE Journals}

% \IEEEpubid{0000--0000/00\$00.00~\copyright~2022 IEEE}

% Remember, if you use this you must call \IEEEpubidadjcol in the second
% column for its text to clear the IEEEpubid mark.

\makeatletter
\patchcmd{\@maketitle}
{\addvspace{0.5\baselineskip}\egroup}
{\addvspace{-1.5\baselineskip}\egroup}
{}
{}
\makeatother


\maketitle

\begin{abstract}

    Future wireless networks and sensing systems will benefit from access to large chunks of spectrum above 100~GHz, to achieve terabit-per-second data rates in \gls{6g} cellular systems and improve accuracy and reach of Earth exploration and sensing and radio astronomy applications. These are extremely sensitive to interference from artificial signals, thus the spectrum above 100~GHz features several bands which are protected from active transmissions under current spectrum regulations. To provide more agile access to the spectrum for both services, active and passive users will have to coexist without harming passive sensing operations. In this paper, we provide the first, fundamental analysis of \gls{rfi} that large-scale terrestrial deployments introduce in different satellite sensing systems now orbiting the Earth. We develop a geometry-based analysis and extend it into a data-driven model which accounts for realistic propagation, building obstruction, ground reflection, for network topology with up to $10^5$ nodes in more than $85$~km$^2$. We show that the presence of harmful \gls{rfi} depends on several factors, including network load, density and topology, satellite orientation, and building density. The results and methodology provide the foundation for the development of coexistence solutions and spectrum policy towards 6G.

\end{abstract}

% \begin{IEEEkeywords}
%     6G, remote sensing, interference, sub-terahertz, data-driven simulation
% \end{IEEEkeywords}

\section{Introduction}

Continuously growing user demand is pushing the \gls{6g} of wireless networks into the \gls{sthz} spectrum of 100-300~GHz~\cite{akyildiz2022terahertz}.
% , which are traditionally used for remote senting applications for \gls{eess} and Radio Astronomy.
%
% The exploitation of \gls{sthz} and \gls{thz} frequencies for communications leads to immediate challenges, including low transmission power (in the order of a few milliwatts per active transmitting element~\cite{sengupta2018terahertz,siles2018new}) and small antenna apertures (because of the millimetric and sub-millimetric wavelengths in this frequency range) that require the adoption of directional antennas to close the link over meaningful distances. This leads to limited coverage per \gls{gnb}, further impacted by blockage~\cite{petrov2017interference,boulogeorgos2021directional}. 
%
% Using \gls{sthz} and \gls{thz} frequencies for communications leads to several challenges, including 
%
% All of these pose challenges to both the performance and the reliability of \gls{sthz} and \gls{thz} communication systems, calling into question their technological and therefore commercial attractiveness. Nevertheless, these difficulties are very much compensated by 
%
The \gls{sthz} spectrum offers theoretically orders of magnitude greater bandwidth than typical communication bands %(tens to hundreds of gigahertz)
depending on the composition of the atmosphere and weather conditions~\cite{itu-p-676}. This makes \gls{sthz} attractive for %next generations of
wireless networks, despite the significant challenges related to blockage, low transmission power, and small antenna apertures, which require directional antennas to increase the \gls{gnb} coverage~\cite{petrov2020ieee}.
% , at least \textit{according to the laws of physics}.

However, this portion of the spectrum is already used by remote (passive) sensing systems in \gls{eess} and radio astronomy, supporting the weather, climate, and astronomy enterprises. Such services can tolerate limited to no interference. For this reason, the spectrum above 100~GHz features a set of channels reserved for passive remote sensing. This results in 12.5~GHz being the largest contiguous bandwidth available for communications under 200~GHz under current spectrum regulations~\cite{polese2021coexistence}.
%
Without sharing portions of the spectrum between \gls{eess} and the \gls{sthz} terrestrial communication systems, there is little benefit in climbing all the way from 71~GHz into \gls{sthz} or \gls{thz} bands, if the resulting bandwidth will be comparable.
% Obviously, there are other advantages to the use of these frequencies (e.g., miniature transceivers and antennas or densely packed compact antenna arrays~\cite{akyildiz2022terahertz}), but they alone might not outweigh the complexity issues without the possibility to achieve orders of magnitude higher data rates and node densities. 
Hence, channels wider than 12.5~GHz are very much desired.
Further, larger chunks of microwave and \gls{sthz} spectrum can also benefit passive sensing systems themselves, e.g., for more precise hyper-spectral remote sensing~\cite{kummerow2022hyperspectral}. The same applies to radio astronomy, to sense molecular shifts in bands outside those traditionally allocated for this use~\cite{polese2021coexistence}.

%\textcolor{red}{VIT: Soften this one, good point, but a bit too aggressive!}
%[Mike] In addition, WRC-23 Agenda Item 1.14/AI1.14 shows that the current allocations for \gls{eess} bands are not a \emph{``permanent truth''} but that the needs for such bands may evolve with new environmental issues and with experience in environmental sensing~\cite{mike_15a,mike_15b} In order to accommodate such new sensing needs, passive bands will have to be created in bands where there are incumbent active users. The sharing research herein will create options to make sharing \emph{a ``2-way street''} between the active and passive services in a way that is not possible in low passive bands.

Therefore, today's {fixed spectrum allocation} is limiting the potential of both communications and remote sensing. While this could be true across the entire radio spectrum, the much more challenging propagation of \gls{sthz} and \gls{thz} signals through the atmosphere and the opportunity to more precisely control the radiation with compact antenna structures opens the door to more {flexible spectrum sharing} strategies~\cite{polese2021coexistence,polese2022dynamic,xing2021terahertz}.
%
To date, however, the literature presents a gap in the modeling and analysis of the \gls{rfi} caused by terrestrial next-generation wireless networks to \gls{eess} systems, as most analyses focus on single-link evaluations, simplified terrestrial network models, and tractable but simplified channel models~\cite{xing2021terahertz,polese2021coexistence}.
% \hl{Gap: no analysis of interference in realistic scenarios in frequencies above 100~GHz of interest for 6G (or mention what is there and limitations)}
%
Modeling \gls{rfi} is key to the development of tailored coexistence techniques. This is a timely need for the passive sensing and \gls{sthz} networking communities, as \gls{rfi} insights can influence \gls{6g} standardization and next-generations of remote sensing systems, allowing coexistence embedded in the technology rather than layered on top as an afterthought.

In this paper, we fill this gap with the first analysis of 6G terrestrial \gls{rfi} to passive sensing systems, based on a large-scale network model (with up to $10^5$ nodes in more than 85~km$^2$) and actual sensors deployed on multiple \gls{eess} missions. Our contributions are as follows:
\begin{itemize}
    \item We model the channel with aggregated interference, ground reflections, terrestrial and \gls{eess} sensors beam patterns, building obstructions, and \gls{sthz} spreading and absorption losses, extending ITU models with deployment-specific details. Our model is extremely scalable and can also be used to analyze and model~\glspl{ntn}.
    \item We analyze the single-link interference probability, %accounting for reflections, satellite, user, and base station gains,
    and show how the peculiar geometry of the terrestrial-satellite \gls{rfi} setup can lead to significant interference from the ground reflection due to the combination of the terrestrial and satellite beam gains.
    \item We extend this into a data-driven large-scale simulation with multiple satellites (i.e., TEMPEST-D and the \gls{mls}~\cite{reising2015overview,waters2006earth}) and device deployments and obstructions based on \gls{osm} and 3D models, including urban cellular and backhaul. The area size and the number of buildings (62512 3D polygons) are unprecedented and showcase how we can model large-scale, site-specific deployments.
    \item We show that dense \gls{sthz} networks can affect \gls{eess} satellites operations.
          % By breaking down the different contributions to the aggregated \gls{rfi}, we show that 
          Specifically, (i) even \glspl{ue} can generate harmful interference, when combined in large numbers; (ii) the secondary reflections (e.g., the ground reflection), although generating lower interference, are significant and not to be neglected; (iii) the attenuation outside the main lobe of directional arrays might not be enough to protect the passive users; whereas (iv) path loss and atmospheric attenuation as well as the building obstruction can shield them more effectively.
\end{itemize}
%
Therefore, there exist regimes in which interference is significant, and other conditions in which it does not lead to any harm to passive satellites. These insights are a starting point for (i) the design of 6G networks; (ii) passive/active sharing, based on an accurate \gls{rfi} understanding; and (iii) data-driven spectrum policy toward 6G.


% Figure environment removed

\section{Related Works}
\label{sec:related}

% \gls{rfi} characterization has been a key research topic in the last decades, as technological advances paved the way for the adoption of new radio frequencies by commercial and scientific users.
\gls{rfi} analyses follow two main approaches.
% to guide policymakers~\cite{marcus2014harmful} and to offer insights for the coexistence of active and passive users of the spectrum~\cite{polese2021coexistence}, following two main approaches.
%
% Two main approaches can be identified for the \gls{rfi} modeling.
Single-link analysis considers the \gls{rfi} generated by a single interferer and a single victim~\cite{park2019modeling,polese2021coexistence,xing2021terahertz,marcus2014harmful}.
Specifically, \cite{bosso2021ultrabroadband} was among the first studies to numerically characterize \gls{rfi} at sub-THz frequencies.
\cite{polese2021coexistence} analyzes it in several scenarios for a single backhaul, terrestrial link.
Similarly, \cite{xing2021terahertz} considers an urban scenario where a receiver on a rooftop is used as a surrogate for the satellite.
The overall attenuation is measured for different ground transmitter locations.
The authors of both studies conclude that, for a single link in an urban area, harmful interference can be avoided if the satellite or the beam direction remains below certain angles.

The second approach relies on Monte Carlo simulations to aggregate interference from multiple interferers modeled through multiple random variables. \gls{rfi} statistics are derived through multiple iterations.~\cite{guidolin2015study,su2014coexistence} consider a \gls{fss} terrestrial station and compute the aggregated interference produced by the \glspl{gnb} of a nearby network at 3.4-3.6~GHz and 18~GHz.
The authors of~\cite{gasiewski2002impacts} analyze the impact of automotive radars on satellite radiometers in the 22-27~GHz frequency range, and conclude that most realistic vehicle densities would generate harmful \gls{rfi}.
The authors of both studies conclude that coexistence between the two systems at \gls{mmwave} frequencies is possible, provided that the base station deployment and configuration respect some conditions.
% Other studies for 3.7-4.2~GHz, 28~GHz and 45.5-47~GHz include\cite{hattab2018interference}  and \cite{hassan2017feasibility}.
% show that, at 3.7-4.2~GHz and 28 and 45.5-47~GHz, an FSS user might be affected by harmful interference generated by the terrestrial network.
\cite{guidolin2015study,hassan2017feasibility,hattab2018interference} consider random deployments of the \glspl{gnb} and \glspl{ue}, realistic antenna and beamforming radiation patterns, and stochastic channel models~\cite{alkhateeb2013hybrid}.
\cite{zhong2020feasibility} provides an analysis of the interference between terrestrial and satellite relays in the 25.25-27.5~GHz bands,
considering \gls{los} propagation and the ITU channel model, and aggregating the interference over extremely wide areas ($\ang{0.5}\times\ang{0.5}$ latitude/longitude).
The authors of~\cite{winter2019statistics} estimate the aggregated \gls{rfi} distribution from a \gls{fs} network to an aircraft at 18~GHz.
In~\cite{cho2018spectral,cho2019modeling,cho2020coexistence}, the coexistence between terrestrial networks and \gls{eess} at \gls{mmwave} frequencies is analyzed.
% The study considers the aggregated interference not only from the satellite 3-dB footprint but also from the coverage area.
% The ground nodes are clustered in \gls{5g} systems which are geographically close.
% In each cluster, the \glspl{gnb} and \glspl{ue} antennas are randomly placed and oriented.
% The interfering power of each cluster is thus computed by summing the contributions of each terrestrial link, and the aggregated power is obtained by summing the cluster power.
% The propagation model in these papers includes the free-space path loss, the clutter and the building entry loss, the attenuation due to atmospheric gases, and other losses (e.g., beam spread, polarization, and body loss).
% Terrain data is also taken into account, to avoid placing networks over the sea areas and to account for the terrain height.
\textit{In these papers, the building blockage and attenuation, the node locations, and the beamforming orientation are modeled through random variables, that are not representative of a real topology.}

% Besides the path loss and the network topology, a key element to correctly estimate the interference is the 
Obstruction by physical obstacles is indeed another key element for \gls{rfi}, particularly at high frequencies.
% Buildings heavily influence the propagation of the signal from the terrestrial network to the satellite.
\cite{ayoubi2023imt} stochastically estimates the aggregated interference from a wide area for the upper 6~GHz band using building statistics from real data for the city of Milan.
% The models include a stochastic characterization of the array gain, the clutter loss, and of the geometrical characteristics of the area.
% The building statistics are derived from the 
%
This paper aims at filling these gaps in the literature, characterizing the \gls{rfi} at sub-THz frequencies with the following original contributions: (i) we propose and validate a ray-based channel model that can scale to footprint-wide areas; (ii) we use it to take a ray-tracing-like approach to an unprecedented scale, in terms of the number of terrestrial nodes, considered area, and building modeling; (iii) thanks to these elements, we analyze in detail the contribution of the multi-path component, in particular of the ground reflection, at the network level; (iv) we perform this analysis using real 3D building models and node distributions.

\section{Propagation Model}
\label{sec:prop_model}
% The frequency of an electromagnetic wave determines its propagation characteristics and its interactions with the environment.
% For this reason, the adoption of new frequencies, e.g., \glspl{mmwave} for \gls{5g} networks, has pushed forward the development of new channel models that can capture the behavior of the communication signal.

In this section, we extend the channel models from~\cite{jakes1994microwave,han2014multi} to improve their scalability and to embed key elements of propagation at frequencies above 100~GHz.
% We also model the ground reflection as the main secondary path at the receiver, 
% The ground reflection is generally regarded as one of the main secondary path that contribute to the overall power at the receiver.
% Thus, we assume the ground reflection as representative of the \gls{nlos} paths, 
% and characterize its contribution to the overall \gls{rfi} experienced at the satellite.
%
% In the model, we determine the ray path according the classical 2-ray ground-reflection model~\cite{jakes1994microwave}.
We model the propagation through two paths: the direct or \gls{los} ray and the ray reflected by the ground (\gls{gr}),
% According to Snell Law, the reflection is specular, i.e., the incidence angle $\alpha_i$ equals the reflection angle $\alpha_r$.
% Based on this, the method of images allows a complete characterization of the problem geometry, thus providing 
to provide key insights on the multipath contribution to the overall \gls{rfi} at the satellite.
Thus, the ray power takes into account (a) the reflection loss (for the reflected ray); (b) the free-space spreading loss; (c) the ``atmospheric'' loss due to the molecular absorption of the atmosphere layers crossed by the ray; and (d) the absorption loss due to obstacles.

\subsection{Ground-to-Satellite Path}
\label{ssec:g2s_geom}
% Figure environment removed
The traditional 2-ray model~\cite{jakes1994microwave} is based on the flat-Earth assumption %, i.e., the Earth's surface can be considered approximately flat
when considering short distances.
The effect of this simplification has been evaluated in several works~\cite{kotz2004experimental,fund2016how,loyka2001using,feuerstein1994path,dottling2001two}.
However, the distance between the satellite and the ground node can be hundreds of kilometers not only on the altitude but also on the longitudinal plane.
Here, we verify whether the flat-Earth assumption holds when considering the path reflected on the ground from the terrestrial node to the satellite.

Consider a satellite at altitude $h_a$, which points the main lobe of its sensor towards the ground with an angle $\alpha_{n}$ with respect to nadir.
By definition, the nadir at a given point is the direction pointing toward the center of the Earth.
As shown in Fig.~\ref{fig:nadir}, we distinguish between the \textit{nadir} angle $\alpha_{n}$, i.e., the angle between the pointing direction and nadir, and the \textit{apparent nadir} angle $\alpha_{s}$ seen from the ground, i.e., the angle between the pointing direction of the satellite and the normal to the horizon.
The relation between the two angles can be expressed as \cite{soler1994determination}
\begin{equation}
    \alpha_{s} = \arcsin{\left(\frac{r}{R}\sin{\alpha_{n}}\right)},
    \label{eq:alpha_sat}
\end{equation}
where $R$ is the Earth radius and $r = R+h_a$ is the distance of the satellite from the center of the Earth, here assumed to be a perfect sphere for simplicity.
Thus, a satellite at the horizon, with $\alpha_{s}=\ang{90}$, has a nadir angle $\alpha_{n}=\arcsin\left(\frac{R}{r}\right)$, that for a satellite at $h_a = 400$~km of altitude corresponds to about \ang{70.21}.
Conversely, the same satellite looking at a \ang{65} angle with respect to nadir has an apparent look-angle $\alpha_{s} = \ang{74.41}$.


From $\alpha_{s}$ it is straightforward to derive the incidence angle $\alpha_i$, the \gls{los} angle $\alpha_{1,s}^{LoS}$ between the ground node and the satellite, the distance $x_{1R}$ ($x_{RS}$) between the ground node (satellite) and the reflection point, and the overall length of the reflected path $x$:
\begin{align}
    \alpha_i           & = \arctan\left(\frac{h_{s}}{h_{s}+h_1}\tan{\alpha_{s}}\right) \simeq \alpha_s\label{eq:alpha_i}          \\
    \alpha_{1,s}^{LoS} & = \arctan\left(\frac{h_{s}-h_1}{\left(h_{s}+h_1\right)\tan{\alpha_{i}}}\right) + \frac{\pi}{2}           \\
                       & \simeq \arctan\left(\frac{1}{\tan{\alpha_{s}}}\right)+ \frac{\pi}{2} = \pi-\alpha_s \label{eq:alpha_los} \\
    x_{1R}             & = h_1\tan{\alpha_i} \;\;\;\;\;\;\;\;\; x_{RS} = h_s\tan{\alpha_i} \nonumber                              \\
    x_{GR}             & = x_{1R} + x_{RS}
    % & \begin{cases}
    %     x_{1R} & = h_1\tan{\alpha_i} \\
    %     x_{RS} & = h_s\tan{\alpha_i} \\
    %     x_{GR}   & = x_{1R} + x_{RS}
    % \end{cases}.
\end{align}
We define the flat-Earth error at distance $x$ from node 1 as $e_{FE}(x) = \left|h_{FE}(x)-h_E(x)\right|$, where $h_{FE}(x)$ and $h_E(x)$ are the flat and spherical Earth ground height at distance $x$, respectively.
The error can be computed as
% \begin{align}
$e_{FE}(x) = x^2 + x_c^2 -2 x x_c \cos{\left(\frac{\gamma}{2}\right)},$
% \end{align}
where $x_c= 2R\sin{\left(\frac{\gamma}{2}\right)}$ and $\gamma=\arctan {\left(\frac{x}{R}\right)}$ are defined as in \cref{fig:nadir}.
\cref{fig:flat_earth} shows the distance $x_{1R}$ (blue) of the reflection point from the ground node, and the corresponding flat-Earth error $e_{FE}(x_{1R})$, for a ground node at $10$~m and a satellite at $400$~km altitude at different look-angles $\alpha_{s}$.
As long as the satellite is above the horizon ($\alpha_{s}<\ang{80}$), the ray is reflected on the ground closer than $30$~m from the ground node, a distance small enough so that the flat-Earth approximation holds, with an error in the order of $10^{-5}$~m.
For $\alpha_s > \ang{80}$, the reflection point is so far from the ground node that the curvature of the Earth needs to be accounted for.
In that case, the approximations for the reflected path do not hold, whereas the model for the \gls{los} remains valid.
However, since in this work we are interested in analyzing also the effect of multipath, we limit our analysis to elevation angles $\alpha_s \le \ang{80}$.

% % Figure environment removed

\subsection{Ray Power}
As represented in \cref{fig:geom_setup}, in our channel model we consider the direct ray ($j=0$: \gls{los}) and the ray reflected on the ground ($j=1$), representing the two main propagation paths from the source to the receiver. Each ray is associated with a path loss $L_{j}$ that depends on a number of elements, detailed in the following paragraphs.

\paragraph{Reflection Loss} If the ray $j$ is reflected, a reflection loss $L_{R,j}$ is applied, which changes with the incidence angle, with the polarization of the wave, and with the material of the reflecting surface. In this paper, we consider the reflection loss presented in \cite{han2014multi}, derived from \cite{piesiewicz2007scattering}.

The Fresnel reflection coefficients $r_{TE}$ and $r_{TM}$ model the power loss in the specular direction when the wave is reflected on a smooth surface %of impedance $Z$ 
for the \gls{te} and \gls{tm} polarized waves, respectively.
We present only the derivation for \gls{te}-polarized waves, without polarization loss, as the formulation for the \gls{tm} mode is analogous.
% For simplicity, we consider only \gls{te}-polarized waves, and neglect the polarization loss.
% The formulation for the \gls{tm} mode is analogous.
The reflection coefficient $r=r_{TE}$ can be computed, considering the refraction index $n$ and the absorption coefficient $\alpha$, as
\begin{equation}
    r = \frac{\cos{\alpha_i}-n\sqrt{1-\left(\frac{1}{n}\sin{\alpha_i}\right)^2}}{\cos{\alpha_i}+n\sqrt{1-\left(\frac{1}{n}\sin{\alpha_i}\right)^2}}  = \left|r\right|e^{j\phi_R}
    \label{eq:fresnel}
\end{equation}
where $n=\sqrt{\epsilon}$ is the refractive index and $\phi_R$ is the phase shift that occurs during the reflection.
Relative permittivity coefficients $\epsilon\in \mathbb{C}$ for common building materials in the frequency range of interest are reported in \cite{itu-r-2040}.
For simplicity, throughout this work we assume that $\phi_R = \pi$, i.e., $r = -\left|r\right|$.

% The Fresnel coefficients accurately model the reflection loss in the case of smooth incidence surfaces.
% However, 
When considering outdoor propagation, particularly at high frequencies, reflections occur on rough materials, where scattering becomes relevant.
%In this case, the modified reflection coefficient can be used 
To include the scattering loss in the specular direction, %which is computed by
we multiply the Fresnel coefficient by the Rayleigh roughness factor
\begin{align}
    L_{R,j} & = \left(\rho \cdot r\right)^{-1}, \;\;\; \mbox{with} \;\;\;
    \rho = e^{-\frac{g}{2}},
\end{align}
where the roughness $g$ of the material ($g\ll1$: smooth, $g\simeq 1$ moderately rough, $g>1$ very rough) is defined as
% \begin{equation}
$g = \left(\frac{4\pi \sigma \cos{\alpha_i}}{\lambda}\right)^2$,
% \end{equation}
where $\sigma$ is the standard deviation of the surface roughness~\cite{piesiewicz2007scattering}.
Note that the dependence of $g$ on the incident angle $\alpha_i$ accounts for the effective roughness seen by the incoming wave.
\cref{fig:refl_loss} reports the reflection loss as a function of the incident angles for different values of $\sigma$, computed with the relative permittivity for the concrete $\epsilon=5.24$~\cite{itu-r-2040}, that is used throughout the rest of this work.

% Figure environment removed


\paragraph{Free-Space Loss}
As the $j$-th ray propagates through the space, the signal is attenuated proportionally to the distance $d_j$ and to the center frequency $f_c$.
The free-space loss for ray $j$ is thus computed as
\begin{equation}
    L_{fs,j} = \frac{4\pi f_c d_j}{c}.
\end{equation}
Clearly, the \gls{los} path is the shortest, with length $d_0<d_j, j\in \mathbb{N}^+$. The length difference $\Delta d$ between the \gls{los} and the ground-reflected ray is approximated for the case of ground-to-satellite propagation in \cref{eq:approx}.
An approximation for the phase difference in the two-ray model commonly adopted in the literature~\cite{jakes1994microwave} is
% \begin{equation}
$\Delta d \simeq 2\frac{h_1 h_{s}}{x},$
% \end{equation}
which holds when $x\gg h_1+h_{s}$.
However, in the considered case, this assumption is not verified, and the approximation is not valid.
Thus, we derived an approximation that can be applied to satellite communication:
\begin{align}
    \Delta d & = \sqrt{x^2+(h_1+h_{s})^2} - \sqrt{x^2+(h_{s}-h_1)^2} =\nonumber                                                                                                             \\
             & = \frac{x^2+(h_1+h_{s})^2 - (x^2+(h_{s}-h_1)^2)}{\sqrt{x^2+(h_1+h_{s})^2} + \sqrt{x^2+(h_{s}-h_1)^2}}\nonumber                                                               \\
             & = \frac{4 h_1}{\sqrt{\left(\frac{x}{h_{s}}\right)^2+\left(\frac{h_1}{h_{s}}+1\right)^2} + \sqrt{\left(\frac{x}{h_{s}}\right)^2+\left(1-\frac{h_1}{h_{s}}\right)^2}}\nonumber \\
             & = \simeq \frac{4 h_1}{\left(\sqrt{\left(\frac{x}{h_{s}}\right)^2 + 1} + \sqrt{\left(\frac{x}{h_{s}}\right)^2 + 1 }\right)}\nonumber                                          \\
             & = \frac{2 h_1}{\sqrt{\left(\frac{x}{h_{s}}\right)^2 + 1}} = \frac{2 h_1}{\sqrt{\left(\tan\left(\alpha_{s}\right)\right)^2 + 1}}
    \label{eq:approx}
\end{align}
where the approximation holds for $h_{s}\gg h_1$, which applies to ground-to-satellite scenarios.
% We evaluate the approximation by plotting the approximation error $\textrm{err}\left(\Delta d\right) = \Delta d-(\Delta d)'$ defined as the difference between the 
% where $(\Delta d)'=\frac{2 h_1}{\sqrt{(\tan{\alpha_{s}})^2 + 1}}$ denotes the approximated path difference.
% \cref{fig:approx_err} reports the approximation error for different apparent look-angles and different frequencies for a satellite at $400$~km altitude, showing the approximation holds for all the valid angles and considered frequencies.
% As expected, the error is well below the considered wavelengths.

\cref{fig:losses} compares the path loss of the direct and of the reflected ray.
Note from \cref{eq:approx} that $\Delta d$ varies between $0$ (satellite at the horizon) and $2 h_1$ (satellite directly above the ground node), that makes the difference between the free-space loss of the two paths negligible.

\paragraph{Atmospheric Loss}
Electromagnetic waves propagating through the atmosphere interact with the molecules, transferring part of their energy to the medium.
This effect is accounted for through the atmospheric absorption coefficient $L_{A,j}$, which depends on the composition of the atmospheric layers and on the propagation angle of the $j$-th ray~\cite{polese2021coexistence,polese2022dynamic}:
% We model the atmospheric loss as in:%, which in turn are based on the ITU channel models~\cite{itu-p-453,itu-p-525,itu-p-676,itu-p-835}:
\begin{equation}
    L_{A,j} = \left(\int_{0}^{h_a} \frac{\gamma(h)}{\sqrt{1-\cos^2(\theta(h)})}\diff h\right)^{-1}
\end{equation}
where $\gamma(h) = \gamma_o(h) + \gamma_w(h)$ is the attenuation given by oxygen ($\gamma_o$) and water vapor ($\gamma_w$) at height $h$, $h_a$ is the satellite altitude, and $\theta(h)$ is the local apparent elevation angle at height $h$.

\paragraph{Absorption Loss}
% The absorption loss of materials increases with frequency. 
In the sub-THz bands, the transmitted power through materials is negligible~\cite{du2021sub}.
Thus, for large obstacles, e.g., buildings, with multiple, thick, non-reflective layers, a hard, on/off loss can be applied.
Specifically, we model the building blockage as $L_B = +\infty$ if the ray is obstructed, or $L_B = 1$ otherwise.
% \begin{equation}
%     L_B = \begin{cases}
%         +\infty & \text{ if the ray is obstructed} \\
%         1 & \text{ otherwise}
%     \end{cases}.
% \end{equation}

Factoring in these elements, the overall loss for ray $j$ is
\begin{equation}
    L_{j} = L_{fs,j}L_{R,j}L_{A,j}L_{B,j}.
    \label{eq:tot_pathloss}
\end{equation}
\cref{fig:losses} shows the different contributions to the path loss at $f_c=178$~GHz for a satellite at $400$~km of altitude, for different apparent look-angles $\alpha_{s}$.

\subsection{Ray combining}
\label{ssec:ray_comb}
Considering the propagation of a generic electric signal $E_s\in \mathbb{C}$ from the source to the receiver, the signal $E$ at the receiver antenna is given by the superposition of the electric fields of the \gls{los} and ground-reflected rays
\begin{equation}
    \begin{aligned}
         & E = \sum_{j=0,1}{E_j} =                                                                                                                                            % \frac{E_s}{L_{PL,0}} e^{j2\pi \tau_{0} f_c} + \frac{E_s}{L_{PL,1}} e^{j2\pi \tau_{1} f_c} =\\
        \left(\frac{E_s e^{j2\pi \tau_{0} f_c}}{L_{B,0} L_{fs,0} L_{A,0}} + \frac{E_s e^{j2\pi \tau_{1} f_c + \phi_R}}{L_{B,1} L_{fs,1} \left|L_R\right| L_{A,1}}\right)      \\ & = E_s e^{j2\pi \tau_{0} f_c}\left(\frac{1}{L_{B,0} L_{fs,0}L_{A,0}} + \frac{ e^{j2\pi \frac{\Delta d}{\lambda} + \phi_R}}{L_{B,1} L_{fs,1} \left|L_R\right| L_{A,1}}\right)\\
         & \simeq \frac{E_s}{L_{fs,0}L_{A,0}}e^{j2\pi \tau_{0} f_c}\left(\frac{1}{L_{B,0}} + \frac{e^{j2\pi \frac{\Delta d}{\lambda} + \pi}}{L_{B,1}\left|L_R\right|} \right)
        \label{eq:ef_superposition}
    \end{aligned}
\end{equation}
where $\Delta d = d_1-d_0>0$ is the difference between the length of the two paths; and $f_c$ and $\lambda = \frac{c}{f_c}$ are the central frequency and the wavelength of the signal.

The approximations $L_{fs,0}=L_{fs,1}$ and $L_{A,0}=L_{A,1}$ are justified by the fact that for very long propagation distances, e.g., when considering the transmission from the ground to the satellite, the difference in path length $\Delta d$ is small, making the atmospheric and the free-space losses experienced by the two rays almost equal.
On the contrary, this kind of approximation does not hold in general for the phase.
This is particularly true when considering high frequencies/short wavelengths, as the two rays are in phase opposition when
% \begin{align}
%     & 2\pi\frac{\Delta d}{\lambda} + \phi = 2\pi\frac{\Delta d}{\lambda} + \pi = (2k+1)\pi \nonumber\\ 
%     & \Rightarrow 
$\Delta d = 2k\frac{\lambda}{2}, k \in \mathbb{N}$,
% \end{align}
i.e., a path difference of $\frac{\lambda}{2}$, in the order of millimeters or less for frequencies above 100~GHz, determines whether the rays combine constructively or destructively.
% From \cref{eq:approx}, we can define $\Delta\alpha_{s}$ as the variation in the apparent look-angle required for a full phase inversion, i.e.,
% \begin{align}
%     \Delta d            & = \frac{2 h_1}{\sqrt{(\tan(\alpha_{s})^2 + 1}} = 2k\frac{\lambda}{2} \\
%     & \implies \alpha_{s}(k) = \arctan\left(\frac{2k\lambda}{\sqrt{(4h_1)^2-(2k\lambda)^2}}\right) \nonumber\\
%     \Delta\alpha_{s}(k) & = \alpha_{s}(k+1)-\alpha_{s}(k).
% \end{align}

% Figure environment removed
\section{Single Link Analysis}
\label{sec:geometry}
In this section, we present a brief geometry-based analysis of the problem, that serves as the basis for the simulation setup, considering a single terrestrial link and an incumbent \gls{eess}.
We analytically demonstrate that
%, in a terrestrial link, the \gls{gr} the satellite is amplified with greater probability than the \gls{los} ray. Thus, we make the case that 
(i) reflections play a significant role in the \gls{rfi} analysis, and that (ii) narrow beams, while successfully suppressing the direct interference, might amplify the undesired interfering multipath components.

% Given the ray-tracing nature of the channel model, we are interested in studying the interactions of the rays with the \gls{eess} satellite.

The two factors that come into play when considering the propagation of electromagnetic waves at such high frequencies are (i) their interaction with the environment, described by the propagation model introduced in~\cref{sec:prop_model}, and (ii) the spatial distribution of the power, determined by the radiation and beamforming patterns of the antennas.
%Specifically, future \gls{6g} cellular networks will adopt antenna arrays with a high number of antenna elements, which allow focusing the transmitted power in narrower beams to compensate for the harsh propagation conditions at high frequencies and reduce the interference in the network.
% This factor is particularly relevant when studying the interference that ground cellular networks produce on passive services.
% Indeed, 



% Specifically, the latter plays a key role in \gls{5g} and in future \gls{6g} cellular networks, where the adoption of high frequencies allowed shrinking the dimension of the antennas.
% Increasing the number of elements of the antenna arrays allows focusing the transmitted power in narrower beams that, on one hand, compensate for the harsh propagation conditions at high frequencies, and, on the other, reduce the interference in the network through spatial multiplexing.
% This is particularly relevant when studying the interference that ground cellular networks produce on passive services.
% Indeed, prior work~\cite{xing2021terahertz,polese2021coexistence} makes the case that the narrow beamforming used in \gls{mmwave} and \gls{subthz} networks is enough to reduce the power that leaks in the direction of the passive user enough not to cause any significant interference.

Prior work on \gls{rfi} to satellite systems~\cite{xing2021terahertz,polese2021coexistence} shows, often adopting a \gls{los} channel model, that the narrow beamforming used in \gls{mmwave} and \gls{subthz} networks can reduce enough the power that leaks in the direction of the passive user so as not to cause any significant interference.
However, due to the particular geometry of the ground-to-satellite interference, represented in \cref{fig:geom_setup}, reflections can not be neglected.
In this section, we start by analyzing the geometry of a single link in \cref{ssec:bf_ampl} to show that the power received through the ground reflection---accounting for propagation and beamforming---is not negligible, and comparable to the \gls{los} ray in some cases.
We then derive the corresponding probabilities for a single link in~\cref{ssec:single_link}, and provide some considerations on the impact of the frequency band in \cref{ssec:freqs}.

\subsection{Beamforming Amplification}
\label{ssec:bf_ampl}

% Figure environment removed
Consider the link between a \gls{tx} and a \gls{rx} with heights $h_{tx}$ and $h_{rx}$, respectively, placed in the area illuminated by a passive \gls{eess} satellite with altitude $h_s$.
We define the elevation beamforming angle $\alpha_{BF}$ as the angle between the direction of the beamforming steering angle and the ground.
In the following, we consider geometric beamforming, i.e., the beams of the \gls{tx} and of the \gls{rx} are aligned to the \gls{los} connecting the two, with an inclination $\alpha_{BF}=\alpha_{tx,rx}^{LoS}$, and $\theta_{HB}^{V}$ \gls{hpbw}.

For simplicity, we assume that the nodes and the satellites are aligned and consider the 2D geometry.
Assuming that $h_{s}\gg h_{tx},h_{rx}$, the \gls{los} and the reflected rays emitted by the ground nodes are both amplified with gain $G_{S}$ by the main lobe of the satellite sensor, due to the angular spread~\cite{saggese2022efficient}.
For this reason, in this analysis, we omit it and focus on the beamforming gain of the \gls{tx} node $G_{TX2S}$ toward the satellite.

To evaluate the interplay between the beamforming and the two rays, we consider three representative satellite nadir angles $\alpha_{n}=\left\{\ang{10},\ang{35},\ang{65}\right\}$.
The \gls{tx} is equipped with an antenna array with a \ang{3} \gls{hpbw} and points towards the \gls{los} to the \gls{rx}.
The path losses of the \gls{gr} and the \gls{los} ray are considered separately and combined destructively and constructively.
The full elevation range of the beamforming angle is considered, from \ang{0} (\gls{rx} right below the \gls{tx}) to \ang{180} (\gls{rx} above the \gls{tx}).
\cref{fig:geom_Gtx} shows how the transmitter beamforming gain $G_{TX2S}$ amplifies the \gls{los} (solid) and the reflected ray (dashed) as the beamforming angle changes.
From \cref{eq:alpha_i,eq:alpha_los}, the angular separation between \gls{los} and ground reflection is $\alpha^{LoS}_{tx,s}-\alpha_i\simeq \pi - 2\alpha_s$.
Thus, the only case when both rays are amplified is when $\alpha^{LoS}_{tx,s}-\alpha_i<\theta_{HB}^{V} \implies \frac{\pi-\theta_{HB}^{V}}{2} < \alpha_s$.
Considering the narrow beams that will be adopted at these frequencies, this can happen only when both the satellite and the beamforming direction are at the horizon.
However, as mentioned in~\cref{ssec:g2s_geom}, we only consider satellite angles $\alpha_{s}$ below \ang{80}, thus excluding this case.

We can distinguish three behaviors, according to the geometric characteristics of the link:
\begin{enumerate}
    \item [C1)] $\alpha_{BF}<\ang{90}$ ($h_{tx}>h_{rx}$): In this case, the \gls{tx} focuses its beam towards the ground.
          This is generally the case for the %\textbf{downlink}
          transmission from a \gls{gnb}, placed in high locations for better coverage, to a \gls{ue} at the ground level.
          Indeed, \cref{fig:geom_Gtx} shows that the \gls{los} ray is effectively suppressed, particularly if the satellite is well above the horizon, whereas the ground reflection is greatly amplified.
    \item [C2)] $\alpha_{BF}>\ang{90}$ ($h_{tx}<h_{rx}$): Conversely, in this case, the transmitter points the beam upwards, as can be the case during %an \textbf{uplink} 
          the communication from a \gls{ue} to a \gls{gnb}.
          Here, the ground reflection is strongly attenuated and is negligible when compared to the \gls{los} ray.
    \item [C3)] $\alpha_{BF}\simeq \ang{90}$ ($h_{tx}\simeq h_{rx}$): Here, the transmitter points at the horizon, e.g., to a node at similar height or very far away.
          We do not consider the latter, as at sub-THz frequencies the link length is short, whereas the former can be the case in \gls{d2d} communications or backhaul links.
          As mentioned above, the angular separation between the two rays makes it so that in this region neither of them is amplified.
\end{enumerate}
In \cref{fig:geom_PL}, the overall amplification of each ray is obtained by subtracting the path loss $L$ from the corresponding transmitter gain $G_{TX2S}$.
The role of beamforming is extremely significant, as it can greatly amplify both the interfering rays, depending on the geometry.
The peak power on the left side of \cref{fig:geom_PL}, i.e., when the ground ray is amplified (case C2), is lower than those on the right side (case C3), and their difference corresponds to the reflection loss.
Finally, note that the superposition of the two rays is relevant only when they have similar amplitude and they have opposite phase (destructive).
Specifically, when the \gls{tx} beam amplifies the reflection enough to compensate for the reflection loss, the \gls{los} and the reflected ray have comparable amplitude and cancel out.
On the other hand, their constructive combination increases the aggregated power by at most 3~dB, when their phase is aligned and they have equal amplitude.

\subsection{Probability of Beamforming Amplification}
\label{ssec:single_link}

Starting from the considerations given in the previous section on the interfering power, we derive the probability of ``beamforming amplification,'' identifying the events when the beam amplifies one of the two interfering rays, and the corresponding probabilities under some simplifying assumptions.

% \subsubsection{Vertical Component}
Let us consider only the vertical \gls{hpbw} $\theta_{HB}^{V}$ of the beam generated by \gls{tx}.
Let $\alpha_{tx,s}^{LoS}$ be the angle between the horizontal direction at the \gls{tx} and the \gls{los} connecting the latter to the satellite.
% We can define the event $A_{LoS}$ as
% \begin{subnumcases}{}
%     \frac{\theta_{HB}^{V}}{2} \ge \lvert\alpha_{BF}-\alpha_{tx,s}^{LoS}\rvert & with prob. $P(A_{LoS})$\label{eq:ampl_los}\\
%     \frac{\theta_{HB}^{V}}{2} < \lvert\alpha_{BF}-\alpha_{tx,s}^{LoS}\rvert & with prob. $1-P(A_{LoS})$\label{eq:atten_los},
% \end{subnumcases}
% corresponding to the direct ray being amplified within the 3-dB range of the main lobe (\cref{eq:ampl_los}) or attenuated outside it (\cref{eq:atten_los}).
We define the event ``the direct ray is amplified within the 3~dB range of the main lobe'' ($A_{LoS}$, with probability $P(A_{LoS})$) as $\frac{\theta_{HB}^{V}}{2} \ge \lvert\alpha_{BF}-\alpha_{tx,s}^{LoS}\rvert$.
Similarly, for the reflected ray, the event $A_{GR}$ (with probability $P(A_{GR})$) maps to the condition $\frac{\theta_{HB}^{V}}{2} \ge \lvert\alpha_{BF}-\alpha_{i}\rvert$, where $\alpha_i$ is the reflection incident angle (\cref{eq:alpha_i}).
% Similarly, for the reflected ray, we introduce the event $A_{GR}$:
% \begin{subnumcases}{}
%     \frac{\theta_{HB}^{V}}{2} \ge \lvert\alpha_{BF}-\alpha_{i}\rvert & with prob. $P(A_{GR})$\\
%     \frac{\theta_{HB}^{V}}{2} < \lvert\alpha_{BF}-\alpha_{i}\rvert & with prob. $1-P(A_{GR})$,
% \end{subnumcases}
% where $\alpha_i$ is the reflection incident angle \cref{eq:alpha_i}.
Fixing the elevation angle of the satellite $\alpha_s$, from~\cref{eq:alpha_i} and~\cref{eq:alpha_los} we have:
\begin{align}
     & (A_{LoS}): \nonumber                                                                                                                                                               \\
     & \left|\alpha_{BF}\right| \le \left(\alpha_{tx,s}^{LoS}\pm\frac{\theta_{HB}^{V}}{2}\right) \simeq \left(\pi-\alpha_s\pm\frac{\theta_{HB}^{V}}{2}\right)\coloneqq \theta_{LoS}^{\pm} \\
     & (A_{GR}):\nonumber                                                                                                                                                                 \\
     & \left|\alpha_{BF}\right| \le \left(\alpha_i\pm\frac{\theta_{HB}^{V}}{2}\right) \simeq \left(\alpha_s\pm\frac{\theta_{HB}^{V}}{2}\right)\coloneqq \theta_{GR}^{\pm}
\end{align}
The \gls{pdf} $f^{LoS}_{tx,rx}\left(\alpha_{tx,rx}^{LoS}\right)$ of the \gls{los} angles between the \gls{tx} and the \gls{rx} is fully characterized by the spatial distribution of the ground nodes.
With the assumption of geometric beamforming, we can thus use the \gls{pdf} of $\alpha_{tx,rx}^{LoS}$, easy to derive, in place of $f_{BF}(\alpha_{BF})$.
Thus, %from the distribution of the beamforming angle $\alpha_{BF}$, we can compute
\begin{align}
    P\left(A_{LoS}\right) & = \int_{\theta_{LoS}^-}^{\theta_{LoS}^+} f_{BF}(\alpha)\diff\alpha = \int_{\theta_{LoS}^-}^{\theta_{LoS}^+} f^{LoS}_{tx,rx}(\alpha)\diff\alpha \nonumber \\
    P\left(A_{GR}\right)  & = \int_{\theta_{GR}^-}^{\theta_{GR}^+} f_{BF}(\alpha)\diff\alpha=\int_{\theta_{GR}^-}^{\theta_{GR}^+} f^{LoS}_{tx,rx}(\alpha)\diff\alpha.
    \label{eq:probs}
\end{align}
We can compute the \gls{los} angle \gls{pdf} starting from its \gls{cdf} $F_{BF}$, that can be derived from the distribution $f_d$ and $f_h$ of the \gls{tx}-\gls{rx} distance and of the node heights, respectively:
% Referring to the three cases identified in~\cref{ssec:bf_ampl}, we can factorize the event probability as
% \begin{align}
%     P(A_{LoS}) &= P(A_{LoS}|h_{tx}>h_{rx})P(h_{tx}>h_{rx}) +\\
%     &+ P(A_{LoS}|h_{tx}\simeq h_{rx})P(h_{tx}\simeq h_{rx}) +\\
%     &+ P(A_{LoS}|h_{tx}<h_{rx})P(h_{tx}<h_{rx})
% \end{align}
\begin{align}
    \alpha_{BF}    & = \arctan\left(\frac{d}{\lvert h_{tx}-h_{rx}\rvert}\right) \coloneqq g(d,h_{tx},h_{rx})\label{eq:alpha_bf}                                              \\
    F_{BF}(\alpha) & = \int\limits_{D_{h_{tx}}}\int\limits_{D_{h_{rx}}}\int\limits_{D_{h_{d}}}f_{h_{tx},h_{rx},d}\left(h_{tx},h_{rx},d\right)\diff h_{tx}\diff h_{rx}\diff d
    % &=f_{h_{tx}}\left(\arctan\left(\frac{d}{\lvert h_{tx}-h_{rx}\rvert}\right)\right)f_{h_{rx}}\left(\arctan\left(\frac{d}{\lvert h_{tx}-h_{rx}\rvert}\right)\right)f_d\left(\arctan\left(\frac{d}{\lvert h_{tx}-h_{rx}\rvert}\right)\right).
    \label{eq:f_alpha}
\end{align}
For simplicity, we can fix $h_{tx}$ and limit our analysis to the case C1) identified in~\cref{ssec:bf_ampl} ($h_{tx}>h_{rx}$) and assume that the height of the \gls{rx} $h_{rx}$ and its distance $d$ from the transmitter are statistically independent.
This is representative of a downlink communication from a \gls{gnb} with known height $h_{tx}$ to the served user at unknown distance $d$ and height $h_{rx}$.
Then, from~\cref{eq:f_alpha}
\begin{equation}
    F_{BF}(\alpha) = \int\int\limits_{\alpha_{BF}<\alpha}f_{h_{rx},d}\left(h_{rx},d\right)\diff h_{rx} \diff d,
\end{equation}
which can be computed, if the distributions are known, by subsequently solving the two integrals using~\cref{eq:alpha_bf} to make a change of variable or using the method of transformations.
We compute it for the \gls{tx}-\gls{rx} 2D distance $d$ distributed uniformly in $[d_1,d_2]$, assuming that the links are established between non-overlapping nodes ($d_1>0$) within a maximum radius $d_2$, and $h_{rx}\simeq U[h_1,h_2]$, $0<h_1<h_2<h_{tx}$:
\begin{align}
    F_{BF}(\alpha)= & \int\limits_{h_1}^{h_2}\int\limits_{d_1}^{\min\left(d_2,(h_{tx}-h_{rx})\tan\alpha\right)}f_{h_{rx},d}\left(h_{rx},d\right)\diff h_{rx} \diff d \nonumber \\
    =               & \int\limits_{h_1}^{h_2}(F_d(\min\left(d_2,(h_{tx}-h_{rx})\tan\alpha\right))                                                                              \\
    -               & F_d(d_1))f_{h_{rx}}\left(h_{rx}\right)\diff h_{rx}
\end{align}
\begin{align}
    = & \begin{cases}
        0 \text{\qquad if }  \ang{0}<\alpha<\arctan\left(\frac{d_1}{h_{tx}-h_{rx}}\right)                                               \\
        \frac{\tan\alpha}{2\Delta d}\left(2h_{tx}-(h_2+h_1)\right)                                                                      \\
        \text{\qquad if } \arctan\left(\frac{d_1}{h_{tx}-h_{rx}}\right)<\alpha<\arctan\left(\frac{d_2}{h_{tx}-h_1}\right) \vspace{.5cm} \\
        \frac{h_{tx}-h_1-d_2/\tan\alpha}{\Delta h} + \frac{\tan\alpha((d_2/\tan\alpha)^2-(h_{tx}-h_2)^2)}{2\Delta h \Delta d}           \\\
        \text{\qquad if } \arctan\left(\frac{d_2}{h_{tx}-h_1}\right)<\alpha<\arctan\left(\frac{d_2}{h_{tx}-h_2}\right)\vspace{.5cm}     \\
        1 \text{\qquad if }  \arctan\left(\frac{d_2}{h_{tx}-h_2}\right)<\alpha<\ang{90},
    \end{cases}
\end{align}
where $\Delta h = h_2-h_1$ and $\Delta d = d_2-d_1$.

Then, the probabilities in~\cref{eq:probs} become, for the case under study,
% \begin{equation}
%     \begin{aligned}
$P\left(A_{LoS}|\text{C1}\right) = F_{BF}(\theta_{LoS}^{+})-F_{BF}(\theta_{LoS}^{-})$ and
$P\left(A_{GR}|\text{C1}\right) = F_{BF}(\theta_{GR}^{+})-F_{BF}(\theta_{GR}^{-})$.
%     \end{aligned}
%     \label{eq:P_A}
% \end{equation}
\cref{fig:P_A_alpha} reports their value for different satellite elevation angles $\alpha_{s}$ and $\theta_{HB}^{V}=\ang{3}$.
As expected, for case C1), where $h_{tx}>h_{rx}$, the probability of amplifying the \gls{gr} ray is greater than the corresponding one for \gls{los}.
Specifically, $P\left(A_{LoS}|\text{C1}\right)$ is not negligible only for the edge case when the satellite is at the horizon ($\alpha_{s}\simeq \ang{90}$) and the \gls{tx}'s height is comparable to that of the \gls{rx} ($h_{tx}=2$~m).
On the contrary, $P\left(A_{GR}|\text{C1}\right)$ is significantly larger
\begin{itemize}
    \item when the satellite is above the ground nodes ($\ang{0}<\alpha_{s}\leq \ang{37.5}$) and the \gls{tx} is much higher than the \gls{rx} ($h_{tx}=15$~m), that is within 10~m;
    \item when the satellite is between \ang{37.5} and \ang{75} and the \gls{tx} is much higher ($h_{tx}=15$~m) than an \gls{rx} within 10~m;
    \item when the satellite is at the horizon ($\alpha_{s}>\ang{80}$). In this case, the ground reflection is less representative of practical cases, as explained in \cref{ssec:g2s_geom}.
\end{itemize}

The derivation for cases C2 and C3 is analogous.
%, and the overall amplification probabilities are obtained as
% \begin{equation}
%     \begin{aligned}
%         P\left(A_{LoS}\right) = P\left(A_{LoS}|\text{C1}\right)P(\text{C1}) & + P\left(A_{LoS}|\text{C2}\right)P(\text{C2}) \nonumber\\
%         & + P\left(A_{LoS}|\text{C3}\right)P(\text{C3}) \\
%         P\left(A_{GR}\right) = P\left(A_{GR}|\text{C1}\right)P(\text{C1}) & + P\left(A_{GR}|\text{C2}\right)P(\text{C2}) \nonumber\\
%         & + P\left(A_{GR}|\text{C3}\right)P(\text{C3})
%     \end{aligned}
% \end{equation}
% where C1, C2 and C3 represent the three cases $h_{tx}>h_{rx}$, $h_{tx}\simeq h_{rx}$ and $h_{tx}<h_{rx}$, respectively.

\subsection{Frequency}
\label{ssec:freqs}
% Figure environment removed
% The carrier frequency of the system is a key parameter in the characterization of the \gls{rfi} in the sub-THz band, considering the presence of absorption windows in the spectrum of interest.
In this section, we analyze a basic example to show how the carrier frequency $f_c$ affects the interference to the satellite.
Specifically, we consider a ground node placed at height $h_{tx}=3$~m and a satellite at 400~km of altitude and $\alpha_{n}=\ang{35}$, with antenna gains of $35$~dB and $38.5$~dB and \glspl{hpbw} of $\ang{3}$ and $\ang{2}$, respectively.
In \cref{fig:freqs} we report the interference to the satellite for different frequencies, considering the \gls{los} and the \gls{gr} separately, as well as their superposition.
For the ground node, we considered three beamforming angles, $\ang{90}$ (horizon, case C3), $\ang{125}$ (upwards, case C2), and $\ang{35}$ (downwards, case C1).
% The satellite beam always points to the ground node, thus considering the worst-case scenario where the ground node is in the main lobe of the satellite antenna.
The power of each ray is computed by combining the path loss $L$ derived in \cref{eq:tot_pathloss} with the transmitter and satellite gain $G_{TX2S}(\theta_{AoD},\phi_{AoD})$ and $G_{S}(\theta_{AoA},\phi_{AoA})=G_S$ of the \gls{tx} and \gls{rx} at the \gls{aod} and \gls{aoa}, respectively:
\begin{align}
    I_{LoS} = P_{tx}  & + G_{TX2S}(\theta_{AoD}^{LoS},\phi_{AoD}^{LoS}) + L_{LoS} +  G_{S}    \\
    I_{refl} = P_{tx} & + G_{TX2S}(\theta_{AoD}^{refl},\phi_{AoD}^{refl}) + L_{LoS} +  G_{S},
\end{align}
where $P_{tx}=0$~dBW.
The power of the two rays is then combined according to~\cref{eq:ef_superposition}.

First, we observe the presence of the two absorption peaks at 118 and 183~GHz, due to the presence of the oxygen molecules and of the water vapor, respectively.
Secondly, we observe how the reflected ray can be amplified by the beam of the ground node, as explained in \cref{ssec:bf_ampl}.
Specifically, when the beamforming angle is $\ang{125}$, the \gls{los} ray is amplified, whereas the reflected ray is attenuated, and viceversa when the beamforming angle is $\ang{35}$.
Furthermore, we observe that, in the considered frequency band, the reflection loss remains almost constant, whereas the \gls{los} path loss increases with the frequency and dictates the overall trend.

Finally, the ITU threshold~\cite{itu-r-2017} is exceeded particularly for frequencies below the second absorption peak.
The only exception is when the ground node steers its beam toward the satellite, thus amplifying the \gls{los} ray.

According to this observation, we selected three frequencies for the remainder of this work, 164, 178, and 240~GHz, that are representative of the three regions of the spectrum, i.e., below, close to and above the oxygen absorption peak, respectively.
Accordingly, for our simulations we selected two satellites that operate in those bands, i.e., TEMPEST-D~\cite{reising2015overview} for the former two and the \gls{mls} instrument on board of the Aura mission~\cite{waters2006earth} for the latter.

\section{Simulation Setup}
\label{sec:simulation}
In this and the following section, we report the setup and results of an extensive analysis of the \gls{rfi} in different scenarios.
The mathematical analysis in \cref{ssec:single_link} allows us (i) to gain a deep understanding of the simulation results, identifying the most significant elements that contribute to the overall power that reaches an incumbent satellite.
Further, we (ii) accurately quantify the \gls{rfi} in a realistic and complex scenario.
Finally, we (iii) provide useful insights and guidelines for the study and simulation of the \gls{rfi} at \gls{sthz} frequencies, that will hopefully help the study and design of coexistence solutions.

\subsection{Scenarios}
For this analysis, we consider two representative outdoor scenarios, the \textit{Urban Cellular} and the \textit{Backhaul} scenarios, both set in the city of Boston, MA, USA.
% Urban Cellular represents a classical cellular scenario, where \glspl{ue} are connected to fixed \glspl{gnb}.
% Wireless backhaul is one of the most promising applications for communication at sub-THz frequencies~\cite{polese2021coexistence,petrov2020ieee}.
The two present inherently different characteristics, e.g., different types of nodes and beamforming angle distributions, thus producing different interference patterns.

% Figure environment removed
\begin{table}
    % \begin{minipage}[t]{\columnwidth}
    \centering
    % \vspace{-7cm}
    \footnotesize
    \renewcommand*{\arraystretch}{0.9}
    \begin{tabular}[t]{lll}
        \toprule
                            & \textbf{\gls{gnb}} (Urban/Backhaul) & \textbf{\gls{ue}} (Urban) \\ \midrule
        $P_{TX}$ [dBm]      & 10/30                               & 10                        \\ %\hline
        $G_{MAX}$ [dB]      & 35                                  & 24.5                      \\ %\hline
        $\theta_{HB}$ [deg] & 3                                   & 10                        \\ %\hline
        $N^{SEC}$           & 3                                   & 1                         \\ %\hline
        Height [m]          & $\{3, 5, 8, 10, 15\}$               & $\mathcal{U}([1.6,1.8])$  \\ \bottomrule
    \end{tabular}
    \captionof{table}{Network parameters for the simulation campaign.}
    \label{tab:node_char}
    % \end{minipage}
    % \begin{minipage}[t]{0.45\columnwidth}
    \centering
    \footnotesize
    \renewcommand*{\arraystretch}{0.9}
    \begin{tabular}[t]{lll}\toprule
                                         & TEMPEST \cite{reising2015overview} & Aura \gls{mls}\cite{waters2006earth} \\ \midrule
        $\theta_{HB}$ [deg]              & 1.68/1.72                          & 0.066 \cite{cofield2006design}       \\ %\hline
        $f_c$ [GHz]                      & 164/178                            & 24.5                                 \\ %\hline
        Altitude [km]                    & 400                                & 705                                  \\ %\hline
        Scan Mode                        & Conical                            & Limb                                 \\ %\hline
        $I_{th}$ [dBW] \cite{itu-r-2017} & $-$163                             & $-$194                               \\ \bottomrule
    \end{tabular}
    \setlength\abovecaptionskip{-.5cm}
    \captionof{table}{Specifications of the considered satellites.}
    \label{tab:sat_char}
    % \end{minipage}
\end{table}

\subsubsection{Map}
We use data from the city of Boston to (i) select realistic locations for the terrestrial nodes and to (ii) characterize the path obstruction from the terrestrial network to the satellite.
To do that, we extract terrain data and the road network from \gls{osm} using OSMnx~\cite{boeing2017osmnx} to reject the nodes spawned in invalid locations (e.g., on water surfaces) and to move indoor nodes outside the building footprint, respectively, as explained in the following paragraphs.
To analyze the obstruction of the paths from the terrestrial network to the satellite, we used the 3D model of the buildings published by the Boston Planning \& Development Agency\footnote{\url{www.bostonplans.org/3d-data-maps/3d-smart-model/3d-data-download}}.

% % Figure environment removed



% \begin{table}[t]
%     \centering
%     \footnotesize
%     \begin{tabular}{|c|c|c|c|}\hline
%         % && \textbf{Urban} & \textbf{Backhaul} \\ \hline
%         \multirow{4}{*}{\rotatebox[origin=c]{90}{\gls{gnb}}} & $P_{TX}$ [dBm] & \multicolumn{2}{c|}{30} \\ \cline{2-4}
%         & $G_{MAX}$ [dB] & \multicolumn{2}{c|}{35} \\ \cline{2-4}
%         & $\theta_{HB}$ [deg] & \multicolumn{2}{c|}{3} \\ \cline{2-4}
%         & $N^{SEC}$ & \multicolumn{2}{c|}{3}\\ \cline{2-4} 
%         & height [m] & \multicolumn{2}{c|}{$\{3, 5, 8, 10, 15\}$} \\ \hline
%         \multirow{4}{*}{\rotatebox[origin=c]{90}{\gls{ue}}} & $P_{TX}$ [dBm] & 10 & - \\ \cline{2-4}
%         & $G_{MAX}$ [dB] & 24.5 & - \\ \cline{2-4}
%         & $\theta_{HB}$ [deg] & 3 & - \\ \cline{2-4}
%         & $N^{SEC}$ & 3 & -\\ \cline{2-4} 
%         & height [m] & $\mathcal{U}([1.6,1.8])$ & - \\ \hline
%         \multirow{3}{*}{\rotatebox[origin=c]{90}{Network}} & $\lambda_g$ & \multicolumn{2}{c|}{$\{10,45,100,\text{``real''}\}$} \\ \cline{2-4}
%         & Area [km\textsuperscript{2}] & \multicolumn{2}{c|}{81} \\ \cline{2-4}
%         & Beamforming & \multicolumn{2}{c|}{Geometric}\\ \hline
%     \end{tabular}
%     \caption{Network parameters for the simulation campaign.}
% \end{table}
\subsubsection{Node Characteristics}
We define two types of nodes: the \glspl{gnb} and the \glspl{ue} (see \cref{tab:node_char}).
The former represents a generic fixed node that can transmit %with high power ($P_{tx}=30$~dBm)
using a large antenna array and thus a narrow beam ($\theta_{HB}=\ang{3}$).
Each \gls{gnb} has $N_{gNB}^{SEC}=3$ \ang{120}-wide angular sectors, according to the current \gls{3gpp} guidelines.
The \glspl{ue} represent mobile nodes with more limited beamforming capabilities ($\theta_{HB}=\ang{10}$).
A single sector is available to the \gls{ue}.
For both \glspl{gnb} and \gls{ue}, in each sector a single link at a time can be active.
% The characteristics of the terrestrial nodes are reported in~.

\subsubsection{Node Placement}
First, $N_{gNB}$ tentative \gls{gnb} locations are generated on the map according to a \gls{ppp} with a given density $\lambda_g$.
Then, the nodes are placed according to an iterative procedure loosely based on a Rejection Sampling process: the \glspl{gnb} that overlap with the building footprint (i.e., indoor) or that are in invalid areas (e.g., water bodies) are projected to the nearest street using OSMnx~\cite{boeing2017osmnx}.
The points for which this is not possible (e.g., the nearest street is an underground road, or two points overlap) are rejected, an equal number of new points are generated, and the procedure is iterated until all the nodes are successfully moved outside.
Finally, for the Urban Cellular scenario, $N_{UE}$ \glspl{ue} are placed on the map with the same iterative procedure.
According to~\cite{3GPP38913}, we deterministically set $N_{UE}=N_{gNB}\times N_{gNB}^{SEC} \times 10$.
Thus, the number of nodes for each scenario is fully characterized by $\lambda_g$.

Three \gls{gnb} densities were considered, $\lambda_g\in \{10, 45, 100\}$~\glspl{gnb}/km\textsuperscript{2}.
In addition, we consider the number and location of \glspl{gnb} that were approved by the City of Boston\footnote{The data is available in the Boston Open Data archive at \url{https://tinyurl.com/2xjn9m43}} as a fourth scenario named \textit{Real}, with $\lambda_g\simeq 18$~\glspl{gnb}/km\textsuperscript{2}.

\subsubsection{Attachment}
In the Urban Cellular scenario, the \glspl{ue} are assigned to \glspl{gnb} according to the following algorithm: first, each \gls{ue} is tentatively assigned to the closest \gls{gnb}. If the distance $d$ between the \gls{ue} and the nearest \gls{gnb} is larger than $d_{max}=200$ m, the \gls{ue} can not be served by any \gls{gnb} and remains unattached, and the process is terminated. Otherwise, if the \gls{los} between the \gls{ue} and the \gls{gnb} is unobstructed by the buildings, the assignment is confirmed and the process is terminated. If, on the contrary, the \gls{los} is obstructed, the \gls{ue} is assigned to the second-closest \gls{gnb}, and the procedure is repeated from the distance-check step.
Each \gls{ue} in coverage is thus assigned a single \gls{gnb}, and each sector of the \gls{gnb} is assigned a list of \glspl{ue} that it can serve.

In the Backhaul scenario, links are established between \glspl{gnb}.
First, a list with all the \gls{gnb} pairs that are in \gls{los} is computed.
Then, for each link, a random direction for the data flow is picked.
For each sector of the \glspl{gnb}, a single link can be active at any given time.

\subsubsection{Beamforming}
The beam of each node is simulated using the ITU antenna pattern shown in~\cref{fig:geom_Gtx}.
The choice is justified both by the ITU recommendations and by computational efficiency, as computing the beamforming vectors and gains for the large areas and the corresponding number of nodes considered in this analysis is extremely demanding from a computational point of view.
In both scenarios, geometric beamforming is considered, i.e., the beams of the \gls{tx} and of the \gls{rx} are aligned to the \gls{los} direction connecting the two.

\subsection{Satellite Model}
For the analysis, we consider a conical-scan and a limb radiometer.
The conical scan mode sounds the Earthâ€™s surface, projecting its footprint on the ground.
The limb scan mode views the edge of the atmosphere and terminates in space rather than at the surface.
We model them using the specifications of the TEMPEST-D satellites~\cite{reising2015overview} and of the \gls{mls} on the Aura mission~\cite{waters2006earth}.
The most relevant characteristics for this study are reported in \cref{tab:sat_char}.

Given the importance of the geometry and of the obstruction by the buildings, we consider three representative nadir angles $\alpha_{n}$, as in~\cref{sec:geometry}, and sample the azimuth space $\alpha_{az}$ with a sampling step of \ang{10} for both satellites.
Specifically, for a given nadir angle $\alpha_{n}$, the location of the satellite is determined by considering a conical scan and assuming that its main lobe is centered in the center of the considered area.
That is, we fix $\alpha_{n}$ and thus determine the horizontal $x$ and the vertical distance $h_{sat}$ from the center of the ground network, according to the geometry and notation shown in \cref{fig:g2s_geom}.
The same location is also used for the limb satellite.
However, for the \gls{rfi} computation, the \gls{mls} main beam points 10~km above the network, while the TEMPEST one illuminates it, according to the respective scan mode.

% Figure environment removed
% Figure environment removed

\section{Numerical Results}
In this section, we present the results obtained through numerical simulations employing the setup presented in \cref{sec:simulation}.
Specifically, in \cref{ssec:res_urban} we report the results for the Urban Cellular scenario, evaluating the effect of the obstruction on the number of interfering nodes, the distribution of their gain, the aggregated power, the impact of different carrier frequencies and of different network load factors.
Similarly, in \cref{ssec:res_backahul} we report the beamforming gain of the ground nodes toward the satellite and the aggregated interference of the backhaul network.


\subsection{Urban Cellular}
\label{ssec:res_urban}
\paragraph{Number of Interfering Nodes}
\label{par:n_interf}
\cref{fig:perc_interf} and \cref{fig:n_interf} show the percentage and the number of ground nodes in \gls{los} with the satellite, respectively, thus potentially interfering.

The $x$ axis reports the azimuth of the satellite.
Although the obstruction by the buildings plays a fundamental role, we can observe that the azimuth position of the satellite $\alpha_{az}$ does not significantly affect the considered metrics, as the fluctuations are limited.
This suggests that the building distribution is homogeneous in the azimuth domain, with some variations visible when considering large angles ($\alpha_{n}\simeq \ang{65}$).
%
Considering the percentage of (un)obstructed nodes allows us to draw conclusions that are independent of the absolute number of nodes.
~\cref{fig:perc_interf} shows that the percentage of ground nodes that can interfere with the satellite is strongly correlated to the nadir angle: when the satellite is above the city ($\alpha_{n}\simeq \ang{10}$), the interfering signal propagates in the vertical direction, limiting the number of buildings that block it.
Thus, almost 100\% ground nodes are in \gls{los} with the satellite.
As the satellite moves towards the horizon, the percentage decreases, with almost 80\% of the ground nodes able to reach it when it is at $\alpha_{n}=\ang{35}$, and as little as 50\% when it is at $\alpha_{n}=\ang{65}$.

On the contrary, the absolute number of potential interferers reported in~\cref{fig:n_interf} is grouped by \gls{gnb} density, as expected.
However, the effect of the $\alpha_{n}$ angle is still clearly visible, as for each density the number of potential interferers decreases as the satellite approaches the horizon.
% Figure environment removed
\paragraph{Interfering Nodes Gain}
\label{par:inter_gtx}

% % Figure environment removed

As shown in~\cref{ssec:single_link}, although the \gls{tx} focuses the emitted power toward the \gls{rx} through narrow beams, there is a non-zero probability that also the interfering rays to the satellite are amplified by the beamforming configuration of the \gls{tx}.
\cref{fig:uc_gtx} reports the estimated \gls{pdf} of the transmitter gain experienced by the interfering \gls{los} and reflected rays that reach the satellite.
For all the nadir angles, the vast majority of the rays are successfully suppressed ($G_{TX2S}<0$).

In particular, the \glspl{ue} suppress the \gls{rfi} with the minimum gain with high probability, corresponding to the peak probability in $-8.5$~dBi, that is clearly visible for $\alpha_{n}=\ang{35}$ and $\alpha_{n}=\ang{65}$.
On the contrary, the same behavior is not present when considering the \glspl{gnb}, where a broader interval of $G_{TX2S}$ has a high probability.
This is due to the fact that the interference, and hence the gain reported in~\cref{fig:uc_gtx}, is computed only for the rays emitted by the angular sector containing the satellite.
Given that the \glspl{ue} have a single sector, all the rays are included for the PDF estimation, even when the antenna is pointing in the opposite direction.
On the contrary, only the transmitter gain of the rays in the \gls{gnb} sector containing the satellite is considered, based on the realistic assumption that the power leakage by a sector to the adjacent ones can be effectively suppressed.
Thus, the \gls{gnb} gains reported in \cref{fig:uc_gtx} are computed only in the \ang{120} angular sector containing the satellite instead of the whole \ang{360} azimuth domain, thus increasing the probability of the antenna pointing toward the satellite in the azimuth plane.



Furthermore, \cref{fig:uc_gtx} shows a distinct distribution for the \gls{los} and for the ground-reflected rays when considering the \glspl{gnb} and the \glspl{ue}.
Specifically, the \gls{los} rays of the \glspl{ue} have a greater probability of being amplified than the \gls{gr} rays, and vice-versa for the \glspl{gnb}.
The zoom on the tails of the \gls{pdf} highlights this behavior, with the highest gain being experienced by the \gls{gr} (\gls{los}) rays of the \glspl{gnb} (\glspl{ue}).
This trend can be traced back to the analysis presented in \cref{ssec:single_link}: the \glspl{ue} point upwards to the \glspl{gnb} (case C2), amplifying the \gls{gr} more than the \gls{los}.
Conversely, the \glspl{gnb} point to the \glspl{ue} and thus toward the ground, increasing the probability of amplifying the \gls{gr}.

Moreover, all the estimated \glspl{pdf} have multiple peaks, typical of the multimodal distributions.
Again, referring to the analysis of \cref{ssec:single_link}, we can trace this behavior back to the discrete distribution of the \gls{gnb} heights in relation to the beam characteristics and the satellite positions. This favors some beamforming angles, and thus some $G_{TX2S}$.

Finally, also in this analysis, the elevation of the satellite plays a fundamental role.
Firstly, we can observe the dramatic change in the shape of the distributions in the six plots of \cref{fig:uc_gtx}.
For $\alpha_{n}=\ang{10}$, both the \gls{los} and the \gls{gr} rays are strongly suppressed.
Looking at \cref{fig:geom_Gtx}, this can be explained by the fact that the maximum amplification with this satellite elevation is obtained with extreme beamforming angles ($\alpha_{BF}\simeq \ang{10}$ or $\alpha_{BF}\simeq \ang{172}$), which are not common.
On the contrary, when the satellite is at a lower elevation angle, the interfering \gls{los} and \gls{gr} rays are more often aligned with the beams, resulting in a more uniform distribution of the transmitter gain.
However, a satellite at lower elevation angles also implies that terrestrial signals need to traverse a longer portion of the atmosphere, as we discuss next, and have a higher blockage probability, as discussed above.

% % Figure environment removed
\begin{table*}[t]
    \centering
    \begin{subtable}[t]{0.7\columnwidth}
        \centering
        \scriptsize
        \[
            \begin{array}{cc|cc}
                                                                                                  & \multicolumn{1}{c}{} & \multicolumn{2}{c}{\text{$\alpha_{n}$ [deg]}}                     \\
                                                                                                  &                      & 10                                            & 35                \\
                \cline{2-4}                                                                       & 10                   & 0/0.0371/0.0368                               & 0/0/0             \\
                \smash{\rotatebox[origin=c]{90}{$\lambda_g$ [\glspl{gnb}/km\textsuperscript{2}]}} & 45                   & 0/0.4537/0.4537                               & 0/0.012/0.012     \\
                                                                                                  & Real                 & 0/0.3102/0.3102                               & 0/1.85e-4/1.71e-4 \\
                                                                                                  & 100                  & 0/0.8385/0.8385                               & 0/0.2473/0.2469
            \end{array}
        \]
        \caption{\gls{los} (\gls{gnb}/\gls{ue}/combined)}
    \end{subtable}\hfill
    \begin{subtable}[t]{0.7\columnwidth}
        \centering
        \scriptsize
        \[
            \begin{array}{c|cc}
                \multicolumn{1}{c}{} & \multicolumn{2}{c}{\text{$\alpha_{n}$ [deg]}}                   \\
                                     & 10                                            & 35              \\\hline
                10                   & 0/0/0                                         & 0/0/0           \\
                45                   & 8e-4/0/7e-4                                   & 1.5e-4/0/1e-5   \\
                Real                 & 1.3e-4/0/1.15e-4                              & 0/0/0           \\
                100                  & 0.0124/0/0.0124                               & 0.0011/0/7.5e-4
            \end{array}
        \]
        \caption{Ground Reflection (\gls{gnb}/\gls{ue}/combined)}
    \end{subtable}\hfill
    \begin{subtable}[t]{0.40\columnwidth}
        \centering
        \scriptsize
        \[
            \begin{array}{c|cc}
                \multicolumn{1}{c}{} & \multicolumn{2}{c}{\text{$\alpha_{n}$ [deg]}}          \\
                                     & 10                                            & 35     \\\hline
                10                   & 0.0368                                        & 0      \\
                45                   & 0.4548                                        & 0.0148 \\
                Real                 & 0.3120                                        & 3.3e-4 \\
                100                  & 0.8415                                        & 0.27
            \end{array}
        \]
        \caption{Aggregated}
    \end{subtable}
    \setlength\abovecaptionskip{-0.5cm}
    \setlength\belowcaptionskip{-0.1cm}
    \caption{Probability that the \gls{rfi} is greater than the ITU threshold for the cellular scenario, for the TEMPEST satellite at 178~GHz. For $\alpha_{n} = 65$ degrees, the probability is always 0.}
    \label{tab:P_th}
\end{table*}
\paragraph{Aggregated Power}
\cref{fig:Idbw} reports the \glspl{ecdf} of the aggregated \gls{rfi} power at the satellite for different nadir angles and for different \gls{gnb} densities.
For each Monte Carlo iteration, the total \gls{rfi} is obtained by combining the electric fields at the receiver according to \cref{eq:ef_superposition}, thus accounting also for the phase difference.
In particular, to analyze the different contributions to the overall power, we sum all the interfering power generated by the \gls{los} (solid) and by the reflected (dashed) rays, aggregating the \glspl{gnb} (blue) and of the \glspl{ue} (orange).
The \gls{los} and reflected rays of the individual ground nodes are then combined according to \cref{eq:ef_superposition} (dash-dotted).
Similarly, the overall \gls{rfi} power (yellow) is obtained by combining all the aforementioned contributions.
In each Monte Carlo iteration, we assume that all the \gls{gnb} sectors either transmitting or receiving (with probability $P_{TX}=P_{RX}=0.5$) to a randomly selected \gls{ue} among the one assigned to it.
The sectors without assigned users remain silent.

First, we can observe that the power delivered by the \gls{los} rays of the \glspl{ue} to the satellite dominates the other contributions in almost all of the considered cases.
This is due (i) to the fact that we consider a single \gls{gnb} sector, as previously explained, as we assume that the \glspl{gnb} can effectively suppress the inter-sector leakage.
The same assumption does not hold for the \glspl{ue}, due to the constantly-changing orientation of the hand-held devices.
Furthermore, (ii) the \glspl{ue}' beam amplifies their \gls{los} ray to the satellite.
On the contrary, the \gls{gr} ray of the \glspl{ue} is effectively suppressed.
Conversely, the reflection from the \glspl{gnb} to the satellite is stronger than the corresponding direct ray in almost all scenarios.

Secondly, as the satellite approaches the horizon, the overall \gls{rfi} decreases.
This is due to (i) the lower number of interfering nodes due to the obstruction by the buildings, as illustrated at the beginning of this section, and to (ii) the greater path loss due to the larger distance of the satellite from the ground network.
Furthermore, we observe that for higher nadir angles, the impact of the reflections is also increased, taking over that of the direct rays.
Again, this is due to the considerations on the transmitter gain given in the previous paragraph.

Thirdly, we notice that, as expected, the overall \gls{rfi} increases with the number of nodes.
For reference, \cref{fig:n_interf} reports the potential number of interferers for each density and nadir angle, although not all the nodes are simultaneously active.
In \cref{fig:Idbw}, we report also the average interference generated by a single ground node (dotted).
Note that the gap between the \gls{ecdf} and the corresponding average interference is due to the aggregation of the \gls{rfi} over the network.
Considering the number in \cref{fig:n_interf}, one might expect a larger difference, as we aggregate the power of several thousands of ground nodes, that would correspond to tens of dBs if we just summed the electrical field intensities at the satellite.
However, due to the phase difference among the received signals, the overall interference is reduced, as a large percentage of signals superimpose destructively, canceling out.

Finally, \cref{tab:P_th} reports the probability that the total aggregated \gls{rfi} at the satellite is greater than the ITU threshold for the acceptable \gls{rfi} at the considered frequency ($I_{th} = -163$~dBW~\cite{itu-r-2017}).
The greatest interference is observed when the satellite is orbiting over the terrestrial network ($\alpha_{n}=\ang{10}$) and with $\lambda_g=100$ \glspl{gnb}/km\textsuperscript{2}.
For the same satellite position, even as little as $\lambda_g=10$ \glspl{gnb}/km\textsuperscript{2} is enough to cause significant interference to the satellite.
On the contrary, when the satellite is at the horizon, the \gls{rfi} is well below the safety levels.


% \begin{table}[t]
%     \centering
%     \begin{subtable}[t]{0.45\columnwidth}
%         \centering
%         \scriptsize
%         \[
%             \begin{array}{cc|ccc}
%             & \multicolumn{1}{c}{} & \multicolumn{3}{c}{\text{$\alpha_{n}$ [deg]}}\\
%             & & 10 & 35 & 65 \\
%             \cline{2-5} & 10 & 0/0.0371/0.0368 & 0/0/0 & 0  \\
%                 \smash{\rotatebox[origin=c]{90}{$\lambda_g$ [\glspl{gnb}/km\textsuperscript{2}]}} & 45 & 0/0.4537/0.4537 & 0/0.012/0.012 & 0  \\
%             & Real & 0/0.3102/0.3102 & 0/1.85e-4/1.71e-4 & 0  \\
%             & 100 & 0/0.8385/0.8385 & 0/0.2473/0.2469 & 0
%             \end{array}
%         \]
%         \caption{\gls{los} (\gls{gnb}/\gls{ue}/combined)}
%     \end{subtable}\hfill
%     \begin{subtable}[t]{0.45\columnwidth}
%         \centering
%         \scriptsize
%         \[
%             \begin{array}{c|ccc}
%             \multicolumn{1}{c}{} & \multicolumn{3}{c}{\text{$\alpha_{n}$ [deg]}}\\
%             & 10 & 35 & 65 \\\hline
%             10 & 0/0/0 & 0/0/0 & 0  \\
%             45 & 8e-4/0/7e-4 & 1.5e-4/0/1e-5 & 0  \\
%             Real & 1.3e-4/0/1.15e-4 & 0/0/0 & 0  \\
%             100 & 0.0124/0/0.0124 & 0.0011/0/7.5e-4 & 0
%             \end{array}
%         \]
%         \caption{Ground Reflection (\gls{gnb}/\gls{ue}/combined)}
%     \end{subtable}\\
%     \begin{subtable}[t]{0.33\columnwidth}
%         \centering
%         \scriptsize
%         \[
%             \begin{array}{c|ccc}
%             \multicolumn{1}{c}{} & \multicolumn{3}{c}{\text{$\alpha_{n}$ [deg]}}\\
%             & 10 & 35 & 65 \\\hline
%             10 & 0.0368 & 0 & 0  \\
%             45 & 0.4548 & 0.0148 & 0  \\
%             Real & 0.3120 & 3.3e-4 & 0  \\
%             100 & 0.8415 & 0.27 & 0
%             \end{array}
%         \]
%         \caption{Aggregated}
%     \end{subtable}
%     \caption{Probability of the \gls{rfi} to be greater than the ITU threshold for the cellular scenario, for the TEMPEST satellite at 178~GHz.}
%     \label{tab:P_th}
% \end{table}

\paragraph{Frequency}
% Figure environment removed
% Figure environment removed

The results presented so far in this section were obtained considering $f_c=178$~GHz, where the propagation is characterized by a strong absorption by the atmospheric gases.
% As discussed in \cref{ssec:freqs}, this frequency is close to the $182$~GHz absorption peak, and thus the propagation is characterized by a strong absorption by the atmospheric gases.
Here, we compare the \gls{rfi} observed by TEMPEST at $164$~GHz, which is characterized by a lower absorption, at 178~GHz, and at $240$~GHz, that is used by Aura.
The results for the latter are analyzed in depth in the next paragraph.
\cref{fig:freqs_cellular} reports the aggregated \gls{rfi} for the three frequencies.
Specifically, at 240~GHz it is well below the ITU threshold ($-194$~dBW for limb scanners), even when considering a high \gls{gnb} density ($\lambda_g=100$~\glspl{gnb}/km\textsuperscript{2}) and  $\alpha_{n}=\ang{10}$.
Conversely, for 164~GHz, even when the \gls{rfi} is the weakest ($\alpha_{n}=\ang{65}$ and $\lambda_g=10$~\glspl{gnb}/km\textsuperscript{2}), it is above the threshold with a probability of 0.09.
We can thus conclude that transmitting at frequencies close to the absorption peaks can indeed help mitigate the \gls{rfi}, whereas transmitting in lower-absorption bands can almost certainly cause significant interference to conical-scan satellites.

\paragraph{MLS}
As reported in \cref{fig:freqs}, the \gls{rfi} at the satellite antenna at $240$~GHz can be higher than at $178$~GHz.
The large difference in interfering power observed in~\cref{fig:freqs_cellular} is due to the different altitudes (705~km Aura vs 400~km TEMPEST) and scan modes of the satellites.
While the TEMPEST satellite has a conical scanning sensor, the Aura satellite observes the limb layers of the atmosphere.
Thus, the beam of TEMPEST amplifies the interference coming from the ground with maximum gain, whereas the \gls{mls} strongly attenuates it.



\setcounter{figure}{13}
% Figure environment removed



\setcounter{figure}{12}
% Figure environment removed

\paragraph{Network Load Factor}

In \cref{fig:duty_cycle} we show the total \gls{rfi} for different network load factors.
We define the network load factor through the activation probability $\rho$, which determines whether a \gls{gnb} sector is active, i.e., on average a fraction $\rho$\ of the possible communication links is active.
For instance, the aggregated interference reported in \cref{fig:Idbw} assumes that all the \gls{gnb} sectors are active (either transmitting or receiving), corresponding to $\rho=1$.
\cref{fig:duty_cycle} shows the mean and the 95\textsuperscript{th} percentile of the aggregated \gls{rfi} for $\rho\in\{0.2,0.5,1\}$.
A load factor of 0.2 or 0.5 effectively decreases the average interference $E[I]$ below the ITU threshold for all the considered scenarios.
Conversely, the 95\textsuperscript{th} percentile $I_{95}$ is less affected, remaining above the threshold when considering high density ($\lambda_g=45,100$~\glspl{gnb}/km\textsuperscript{2}) and small nadir angles ($\alpha_{n}$=\ang{10}). Note that \gls{sthz} networks with ultra-wide bandwidths are more likely to operate in scenarios with a small $\rho$, as transmissions can leverage high data rates and thus occupy the channel for reduced periods of time~\cite{akyildiz2022terahertz}.

\begin{table}[b]
    % \begin{minipage}[t]{0.9\columnwidth}
    \centering
    \scriptsize
    \[
        \begin{tabular}{c|ccc}
            \multicolumn{1}{c}{} & \multicolumn{3}{c}{\text{$\alpha_{n}$ [deg]}}              \\
                                 & 10                                            & 35    & 65 \\\hline
            10                   & 0.023                                         & 0.028 & 0  \\
            45                   & 0.655                                         & 0.527 & 0  \\
            Real                 & 0.74                                          & 0.527 & 0  \\
            100                  & 0.9138                                        & 0.872 & 0
        \end{tabular}
    \]
    \setlength\belowcaptionskip{-.1cm}
    \setlength\abovecaptionskip{-.3cm}
    \caption{Probability that the \gls{rfi} is greater than the ITU threshold for the Backhaul scenario.}
    \label{tab:backhaul}
    % \end{minipage}
\end{table}


\subsection{Backhaul}
\label{ssec:res_backahul}
\paragraph{Interfering Nodes Gain}
For the backhaul scenario, links are established between \glspl{gnb}, i.e., between nodes at similar heights.
Thus, the transmitting beams are generally more aligned to the horizontal axis than those of their cellular counterpart.
This behavior can be clearly observed in \cref{fig:gtx_backhaul}, where the histogram for the transmitter gain is reported, considering  the TEMPEST satellite.
We can observe how, due to the horizontal orientation, the beamforming effectively suppresses the interference, particularly when the satellite is above the network area ($\alpha_{BF}\in\{\ang{10},\ang{35}\}$).
As it lowers toward the horizon, larger gains become more probable.
Furthermore, for the same reason, the gain of the \gls{los} and reflected rays present almost the same distribution.

% % Figure environment removed


\paragraph{Aggregated Power}
\cref{fig:I_dbW_backhaul} reports the \gls{ecdf} of the aggregated \gls{rfi} in the considered scenarios, for the TEMPEST satellite at 178~GHz.
We can observe that the aggregated power here is much greater than in the cellular scenario.
This is mainly due to the increase in the transmitting power, which shifts all the distributions by about 20~dB.

The probability of exceeding the threshold in the different scenarios is reported in \cref{tab:backhaul}.
Comparing it with the results reported in \cref{tab:P_th}, we can observe how the backhaul scenario generates much greater interference than the Urban Cellular one.

In conclusion, although the narrow beams suppress the power leaking toward the satellite, a backhaul network with the considered frequency can be potentially harmful to the incumbent satellites.



\section{Conclusions and Future Works}

In this paper, we introduced analytical and simulation methodologies for the evaluation of \gls{rfi} that next-generation terrestrial networks may introduce in passive sensing satellite systems.
We developed a single-link analysis that shows the effect of beam amplification through the combined effect of the problem geometry, of the beam of the terrestrial \gls{tx} and of the satellite.
We then extended this into a large-scale data-driven simulation which relies on topologies for networks and buildings based on real-world data.
The results show that---despite the high propagation and absorption loss at \gls{subthz} frequencies---it is possible to generate \gls{rfi} above ITU thresholds with specific network and satellite configurations.

These insights provide a foundation for our future work, which will focus on developing coexistence methods in a realistic data-driven framework. In addition, we will further extend our analysis by considering models for how \gls{rfi} propagates into the passive sensors measurements.

\bibliographystyle{IEEEtran}
\bibliography{bibl}

\end{document}
