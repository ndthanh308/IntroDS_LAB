\section{Introduction}\label{sec1}
Unmanned aerial vehicles (UAVs) are widely used in various scenarios, including delivery or transportation \cite{Zhang:2021_2}, aerial surveillance and monitoring \cite{Kanistras:2013}, flying base stations (BSs) \cite{Mozaffari:2019}, and data collection and/or power transfer for IoT devices  \cite{Al-Fuqaha:2015,Yu:2021}, due to their high mobility, free movement, and cost-effectiveness  \cite{Mozaffari:2019,Shi:2018,Fotouhi:2019}. It has been actively studied to design the UAV trajectory according to each operational scenario. For UAV-aided communication scenarios \cite{Li:2022,Zeng:2019,Nguyen:2022,Yu:2021,Qi:2020,Li:2019,Cui:2018}, the UAV trajectory has been optimized taking into account various factors, e.g., minimizing energy while satisfying user-specific throughput demands  \cite{Li:2022,Zeng:2019,Nguyen:2022,Yu:2021} or user fairness \cite{Qi:2020}, and improving secrecy rate in the presence of an eavesdropper \cite{Li:2019,Cui:2018}. For delivery or transportation scenarios, it is utmost important  to swiftly and safely transport the given objects to their desired destinations. Thus, for such scenarios, the problem of designing UAV trajectory has been formulated as the minimization of the mission time with some constraints such as connectivity \cite{Zhang:2019,Zhang:2019_2,Chen:2020,Esrafilian:2020,Zhang:2021,Chapnevis:2021,Zeng:2019_2,Khamidehi:2020,Zeng:2021,Wang:2022,Chen:2022}, restricted airspace \cite{Khamidehi:2020,Wang:2022}, collision avoidance between UAVs \cite{Wang:2022,Chen:2022}, and battery constraints \cite{Sundar:2014,Coelho:2017,Fan:2023,Arafat:2022}. In particular, it is important to track the path of UAVs, but maintaining direct communication with the control station becomes challenging when the UAV travels over long distances, due to factors such as large path loss and low line-of-sight probability \cite{Al-Hourani:2014,Al-Hourani:2014_2}. A promising solution to this problem is cellular-enabled UAV communication \cite{Zhang:2019}, wherein the UAV communicates with its control station by connecting  with a close BS and the underlying cellular network \cite{Agyapong:2014}. 

In this paper, we address the problem of path planning for UAVs performing delivery or transportation missions, jointly considering connectivity with the cellular network and UAVâ€™s limited battery capacity. In the absence of battery constraint, the problem of minimizing the mission time while maintaining the connectivity with the cellular network has been extensively studied \cite{Zhang:2019,Zhang:2019_2,Chen:2020,Esrafilian:2020,Zhang:2021,Chapnevis:2021,Zeng:2019_2,Khamidehi:2020,Zeng:2021,Chen:2022,Wang:2022}. %\hs{To derive an optimal trajectory of a UAV with low complexity, analytic approaches such as convex optimization, graph theory, and dynamic programming have been taken in \cite{Zhang:2019,Bulut:2018,Zhang:2019_2,Chen:2020,Esrafilian:2020,Zhang:2021,Chapnevis:2021}.} 
In the work  \cite{Zhang:2019}, the authors focused on optimizing the trajectory between an initial and a final location while maintaining communication with a base station (BS). They simplified the problem by assuming that the UAV can connect with a BS if the distance between them is less than a certain threshold. By doing so, they converted the problem into equivalent convex optimization and graph-theoretic path finding problems, and proposed one optimal (NP-hard) and two sub-optimal (NP-easy) algorithms. %\hs{In graph theoretic approach, a graph is constructed by compressing the communication environment, where the vertex set only consists of finite points which are important for path planning and the edge set is determined by considering the connectivity constraint. Then, an optimal path over the graph is derived by  via the Dijkstra algorithm \cite{Dijkstra:1959}.} 
The study of characterizing an optimal path under the connectivity constraint has been extended in various directions, e.g., allow a certain duration or ratio of communication outage \cite{Zhang:2019_2,Chen:2020}, consider 3-dimensional (3D) space \cite{Esrafilian:2020,Zhang:2021},
%design a 3D path based on 3D building maps \cite{Esrafilian:2020} or 3D radio map \cite{Zhang:2021}, 
and consider the collaboration of multiple UAVs \cite{Chapnevis:2021}. In particular, the work \cite{Chen:2020} introduced an intersection method, which effectively reduces the time complexity by converting the problem into a graph-theoretic path finding problem whose vertex set consists of the intersection points of the coverage boundaries of the BSs. Moreover, the work \cite{Zhang:2021} also used a graph theoretic approach even for 3D path finding problem with a realistic communication environment considering signal blockage and reflection by buildings and interference from other BSs, by quantizing the radio map to finite grid points. 
On the other hand, for scenarios with limited prior knowledge about the communication environment, reinforcement learning (RL) \cite{Sutton:2018} based approaches become effective, as they can approximate the communication environment empirically. The use of RL-based UAV path planning has been explored in several works \cite{Zeng:2019_2,Khamidehi:2020,Zeng:2021,Chen:2022,Wang:2022}. However, note that the optimal path may not always be derived using the RL-based approach, and the training phase of RL can be time-consuming and resource-intensive.

%Unmanned aerial vehicles (UAVs) are widely used in various scenarios, including cargo delivery \cite{Zhang:2021_2}, \hs{aerial surveillance and monitoring \cite{Kanistras:2013}}, \hs{Internet of Things (IoT) communications \cite{Al-Fuqaha:2015}, and flying base stations (BSs) \cite{Mozaffari:2019} because of high and free mobility, low cost, flexibility for poor road infrastructures, and energy efficiency \cite{Mozaffari:2019,Shi:2018,Fotouhi:2019}. Due to their high mobility and limited battery capacity, planning an optimal trajectory from an initial point to a final point is an important challenge for these applications. Trajectory design problems for UAVs have been widely studied subject to various UAV-aided communication issues \cite{Zeng:2017,Li:2022,Zeng:2019,Qi:2020,Nguyen:2022,Yu:2021,Li:2019,Cui:2018}. The works \cite{Zeng:2017,Li:2022,Zeng:2019} considered a UAV-BS scenario that the UAV provides temporary cellular coverage to single or multi-ground node, and optimized the UAV trajectory by jointly considering the communication rate and the propulsion energy consumption. The study of finding an optimal path of UAV-BS has been extended in several works with additional issues such as fair communication coverage for each ground user \cite{Qi:2020}, data collection from IoT devices \cite{Nguyen:2022,Yu:2021}, wireless power transfer from a UAV to ground sensors \cite{Yu:2021}, and UAV-enabled cooperative jamming in the presence of an eavesdropper \cite{Li:2019,Cui:2018}. While performing these missions,} ensuring a continuous connection between the UAV and its control station is crucial for successful completion of the missions, but maintaining persistent communication becomes challenging when the UAV travels over long distances, due to factors such as large path loss and low line-of-sight probability \cite{Al-Hourani:2014,Al-Hourani:2014_2}. A promising solution to this problem is cellular-enabled UAV communication \cite{Zhang:2019}, \hs{wherein the UAV connects with a close BS and the BSs and the backhaul network in the cellular system act as relays for communication between the UAV and its control station \cite{Agyapong:2014}.} Therefore, finding a suitable trajectory for the UAV that enables efficient communication with a BS within the cellular network is of utmost importance.

%Trajectory design problems for cellular-enabled UAVs have been extensively studied in various works \cite{Zhang:2019,Bulut:2018,Zhang:2019_2,Chen:2020,Esrafilian:2020,Zhang:2021,Chapnevis:2021,Zeng:2019_2,Khamidehi:2020,Zeng:2021,Chen:2022,Wang:2022}. \hs{To derive an optimal trajectory of a UAV with low complexity, analytic approaches such as convex optimization, graph theory, and dynamic programming have been taken for path planning studies \cite{Zhang:2019,Bulut:2018,Zhang:2019_2,Chen:2020,Esrafilian:2020,Zhang:2021,Chapnevis:2021}.} In the work  \cite{Zhang:2019}, the authors focused on optimizing the trajectory between an initial and a final location while maintaining communication with a base station (BS). They simplified the problem by assuming that the UAV could connect with a BS if the distance between them was less than a certain threshold. By doing so, they converted the problem into equivalent convex optimization and graph-theoretic shortest path finding problems and proposed one optimal (NP-hard) and two sub-optimal (NP-easy) algorithms. \hs{In graph theoretic approach, a graph is constructed by compressing the communication environment, where the vertex set only consists of finite points which are important for path planning and the edge set is determined by considering the connectivity constraint. Then, an optimal path over the graph is derived by  via the Dijkstra algorithm \cite{Dijkstra:1959}.} The study of characterizing an optimal path \hs{under the connectivity constraint} has been extended in subsequent works to consider factors such as \hs{communication outage duration constraint \cite{Bulut:2018,Zhang:2019_2},  total communication outage time constraint \cite{Chen:2020},} 3D-building maps \cite{Esrafilian:2020}, radio map-based 3D path planning \cite{Zhang:2021}, and the collaboration of multiple UAVs \cite{Chapnevis:2021}. In particular, the work \cite{Chen:2020} introduced the intersection method, which effectively reduces the time complexity by considering only the finite intersection points of the coverage boundaries of the BSs in path optimization. \hs{Moreover, the work \cite{Zhang:2021} used the graph theoretic approach even in the real communication environment considering signal blockage and reflection by buildings, interference of each BS, and 3D-path planning. It proposed a graph theory-based algorithm by quantizing the radio map to finite grid points.} 

%While these analytic approaches can derive an effective path for the \hs{cellular-enabled UAV} with low complexity, they might face challenges when dealing with scenarios with limited prior knowledge about the communication environment. In such cases, reinforcement learning (RL) \cite{Sutton:2018} based approaches become effective, as they can approximate the communication environment empirically. The use of RL-based UAV path planning has been explored in several works \cite{Zeng:2019_2,Khamidehi:2020,Zeng:2021,Chen:2022,Wang:2022}. \hs{In particular, the works \cite{Zeng:2019_2,Khamidehi:2020} considered the scenario that a single-UAV flies between an initial and a final locations while avoiding obstacles like buildings and tried to minimize the travel time of the UAV while reducing the communication outage time. A similar problem with \cite{Zeng:2019_2,Khamidehi:2020} was studied in \cite{Zeng:2021} with additional consideration of creating a radio map when training the path of the UAV. The works \cite{Chen:2022,Wang:2022} reformulated the problem in the multi-UAV case and considered the collision avoidance between the UAVs.} However, it is important to note that the optimal path may not always be derived using the RL-based approach, and the training phase of RL can be time-consuming and resource-intensive.

%%%% trajectory of cellular-enabled UAV with battery constraint %%%%
In practice, it is important to consider the limited battery capacity of the UAV. There have been a few works on designing UAV trajectory performing delivery or transportation missions taking into account the limited battery capacity \cite{Sundar:2014,Coelho:2017,Fan:2023,Arafat:2022}. The work \cite{Sundar:2014} considered a variant of the travelling salesman problem (TSP) that aims to derive a shortest route visiting each target node once, while considering the limited battery capacity of the UAV and charging stations to replenish its energy. Such a UAV route optimization problem with  TSP formulation taking into account the battery constraint has been extended  by considering multiple UAVs \cite{Coelho:2017,Fan:2023} and grouping target nodes into clusters \cite{Arafat:2022}. However, the problem of designing  an optimal UAV path under  both the connectivity and the battery constraints has not been well studied.
%We note that the work \cite{Arafat:2022} solves the routing problem between the clusters. 

 Our key contribution lies in proposing an algorithm that efficiently computes an optimal UAV path in polynomial time (NP-easy)  to deliver a payload from an initial point to a final point as soon as possible, while maintaining connectivity with a BS and adhering to the battery constraint. We assume that the UAV can connect with a BS if they are closer than a certain threshold similarly as in \cite{Zhang:2019}, but we allow that the threshold can be different for each BS due to interference from other BSs. The UAV's battery can be replaced by a fully charged battery at a charging station, which  may take some time depending on waiting time \cite{Lee:2015}. The contributions of this paper are summarized as follows:
\begin{itemize}
\item The primary challenge in this path planning problem is optimizing the route and the speed (since the energy consumption is affected by the speed) with the decisions about when and which charging station to visit. We solve this problem by transforming the problem into an equivalent two-level shortest path finding problem over weighted graphs and leveraging graph theoretic approaches to solve it. More specifically, we first find an optimal path and speed to travel between each pair of charging stations without replacing  the battery. Then, we find the optimal order of visiting charging stations to replace the battery.  To demonstrate the effectiveness of our approach, we analytically compare it with previously proposed algorithms in \cite{Zhang:2019,Chen:2020} that are slightly modified to meet the battery constraint. The results show that our algorithm outperforms these existing approaches in terms of both performance (mission time) and computational complexity.

\item Characterizing the maximum payload weight that the UAV can deliver under the connectivity and battery constraints is another interesting problem of practical importance in delivery missions. We propose a graph theory-based algorithm that yields an optimal solution to this problem NP-easily. It first transforms the delivery environment into a weighted graph and finds the longest connectivity-critical edge between the initial and the final points in the graph. Then, it derives the largest payload weight which can be delivered over the edge without replacing the battery.

\item Various numerical results are provided to show the optimal path and the corresponding delivery time according to environmental parameters and compare with the previously proposed algorithms  \cite{Zhang:2019,Chen:2020}.
\end{itemize}
The remaining of this paper is organized as follows. In Section \ref{sec2}, we present the system model and formulate the optimization problem of finding the fastest UAV route under the connectivity and the battery constraints. Our propose algorithms that output optimal UAV trajectories without and with the battery constraint is presented in Sections \ref{sec3} and \ref{sec4}, respectively. In Section \ref{sec5}, the problem of characterizing the maximum deliverable payload weight is formulated and an optimal algorithm for this problem is presented. We provide various numerical results in Section \ref{sec6}. Finally, the paper is concluded in Section \ref{sec7}.




%%%%%%%%%%% Previous version for conference %%%%%%%%%%%%%%%%%

%Unmanned aerial vehicles (UAVs) are widely used in various scenarios, including cargo delivery \cite{Zhang:2021_2}, aerial surveillance \cite{Kanistras:2013}, and flying base stations (BSs) \cite{Mozaffari:2019}. Ensuring a continuous connection between the UAV and its control station is crucial for successful completion of the missions, but maintaining persistent communication becomes challenging when the UAV travels over long distances, due to factors such as large path loss and low line-of-sight probability \cite{Al-Hourani:2014,Al-Hourani:2014_2}. A promising solution to this problem is cellular-enabled UAV communication \cite{Zhang:2019}, wherein the BSs in the cellular network act as relays for communication. Therefore, finding a suitable trajectory for the UAV that enables efficient communication with a BS within the cellular network is of utmost importance.

%Trajectory design problems for cellular-enabled UAVs have been extensively studied in various works \cite{Zhang:2019,Zhang:2019_2,Chen:2020,Esrafilian:2020,Zhang:2021,Chapnevis:2021,Zeng:2019_2,Zeng:2021,Chen:2022,Wang:2022}. In the work  \cite{Zhang:2019}, the authors focused on optimizing the trajectory between an initial and a final location while maintaining communication with a base station (BS). They simplified the problem by assuming that the UAV could connect with a BS if the distance between them was less than a certain threshold. By doing so, they converted the problem into equivalent convex optimization and graph-theoretic shortest path finding problems and proposed one optimal (NP-hard) and two sub-optimal (NP-easy) algorithms. The study of characterizing an optimal path has been extended in subsequent works to consider factors such as communication outage times \cite{Zhang:2019_2,Chen:2020}, 3D-building maps \cite{Esrafilian:2020}, radio map-based 3D path planning \cite{Zhang:2021}, and the collaboration of multiple UAVs \cite{Chapnevis:2021}. In particular, the work \cite{Chen:2020} introduced the intersection method, which effectively reduces the time complexity by considering only the finite intersection points of the coverage boundaries of the BSs in path optimization. While these analytic approaches can derive an effective path for the UAV with low complexity, they might face challenges when dealing with scenarios with limited prior knowledge about the communication environment. In such cases, reinforcement learning (RL) \cite{Sutton:2018} based approaches become effective, as they can approximate the communication environment empirically. The use of RL-based UAV path planning has been explored in several works \cite{Zeng:2019_2,Zeng:2021,Chen:2022,Wang:2022}. However, it is important to note that the optimal path may not always be derived using the RL-based approach, and the training phase of RL can be time-consuming and resource-intensive.

%In this paper, we address the problem of path planning for a cellular-enabled UAV, considering not only connectivity with a base station (BS) but also the UAV's limited battery capacity. The scenario involves a cellular network with BSs and charging stations. The UAV's mission is to deliver a payload from an initial point to a final point, while maintaining connectivity with a BS and adhering to the battery constraint. The UAV's battery can be replaced by a fully charged battery at a charging station, but this process takes some time \cite{Lee:2015}. The primary challenge in this path planning problem is optimizing the route and the speed (since the energy consumption is affected by the speed) with the decisions about when and which charging station to visit. Our key contribution lies in proposing an algorithm that efficiently computes an optimal path for this problem, solvable in polynomial time (NP-easy). We achieve this by transforming the problem into an equivalent two-level shortest path finding problem over weighted graphs and leveraging graph theoretic approaches to solve it. More specifically, we first find an optimal path and speed to travel between each pair of charging stations without replacing  the battery. Then, we find the optimal order of visiting charging stations to replace the battery.  To demonstrate the effectiveness of our approach, we compare it with previously proposed algorithms in \cite{Zhang:2019,Chen:2020} with slight modifications. The results show that our algorithm outperforms these existing approaches in terms of both computational complexity and performance.





