\section{Technical Background}
\label{sec:background}

We will assume several example types of inputs in this paper. 
All are tied together by having data of the form $f:G \to \R^d$, where $G$ is a finite graph. 
We view each input as a topological graph by treating the graph as a 1-dimensional CW complex.
We call this input an $\R^d$-graph. 
Prior to discussing the specifics of $\R^d$-graphs in our use cases, we  give the necessary categorical framework in order to formulate a precise notion of the interleaving distance.

\subsection{Functors and Cosheaves}
\label{ssec:cosheaf}

We give basic definitions for the category theoretic notions required in this paper, and direct the interested reader to \cite{Riehl2017,Curry2014} for further details. 
A \emph{category} $\cC$ consists of a collection of objects $X,Y,Z,\dots$ and morphisms $f,g,h,\dots$ with the following requirement: morphisms $f:X \to Y$ have designated domain $X$ and codomain $Y$; every object has a designated identity morphism $\1_X: X \to X$, and any pair of morphisms $f:X \to Y$ and $g:Y \to Z$ has a composite morphism $g \circ  f:X \to Z$. 
These objects and morphisms satisfy an identity axiom, where $f:X \to Y$ is the same as the $\1_Y \circ  f$ and $f \circ \1_X$; and composition (denoted by $\circ$ but often dropped when unnecessary) is associative, so $h\circ (g\circ f) = (h\circ g)\circ f$. 
Some example categories are $\Set$ where objects are finite sets and morphisms are set maps; 
$\Top$ where objects are topological spaces and morphisms are continuous functions;
and $\Open(K)$ for a given topological space $K$, where the objects are open sets and morphisms are given by inclusion. 

A \emph{functor} $F:\cC \to \cD$ is a map between categories preserving the relevant structures.
Specifically, for every object $X \in \cC$ there is a an object $F(X) \in \cD$, and for every morphism $f:X \to Y$, there is a morphism $F[f]:F(X) \to F(Y)$. 
To be a functor, $F$ must further satisfy that for  any $X \in \cC$, $F[\1_X] = \1_{F(X)}$ and for any composable pair $f,g \in \cC$, we have $F[gf] = F[g] F[f]$. 
Given functors $F,G: \cC \to \cD$, a \emph{natural transformation} $\eta: F \Rightarrow G$  consists of a map $\eta_X:F(X) \to G(X)$ for every $X \in \cC$ (called the components) so that for any morphism $f:X \to Y$ in $\cC$, the following diagram 
\begin{equation*}
\begin{tikzcd}
X\ar[d,  "f"] 
& F(X) 
    \ar[r, "\eta_X"] 
    \ar[d, "{F[f]}"']
& G(X) 
    \ar[d, "{G[f]}"]
\\
Y 
& F(Y) \ar[r, "\eta_Y"] 
& G(Y)
\end{tikzcd}
\end{equation*}
commutes. 
One example is $\pi_0:\Top \to \Set$, where $\pi_0(\X)$ is the set of path-connected components of $\X$, and morphisms are set maps $\pi_0[f]: \pi_0(\X) \to \pi_0(\Y)$ sending a connected component $A$ in $\X$ to the connected component of $f(A)$ in $\Y$.

A diagram is a functor $F:J \to \cC$ where $J$ is a small category. 
In essence, this construction picks out a collection of objects $F(j)$ and a collection of morphisms $F(j) \to F(k)$. 
A cocone on a given diagram is a natural transformation $\lambda:F \to c$ where we abuse notation to write that $c: J \to \cC$ is the constant functor returning the object $c(j) = c \in \cC$ for all $j \in J$. 
We often call the components $\lambda:F(j) \to c$ the \emph{legs}, and note that this requirement says that for any $f:j \to k$ in $J$, $\lambda_k \circ F[f] = \lambda_j$. 
A cocone $\lambda:F \to c$ is called a colimit if for any other cocone $\lambda':F \to c'$, there is a unique  morphism $u:c \to c'$ such that 
\begin{equation*}
\begin{tikzcd}
F(j) 
    \ar[rr, "{F[f]}"]
    \ar[dr, "\lambda_j"]
    \ar[ddr, "\lambda_j'"']
&& F(k)
    \ar[dl, "\lambda_k"']
    \ar[ddl, "\lambda_k'"]
\\
& c \ar[d, dashed, "u"] \\
& c'
\end{tikzcd}
\end{equation*}
commutes for all $f:j \to k$ in $J$. 

We will be particularly interested in functors of the form $F:\Open(X) \to \Set$, which can also be called \emph{pre-cosheaves}. 
A pre-cosheaf is a \emph{cosheaf} if it satisfies a gluing axiom,  meaning that $F(U)$ is entirely determined by $F(U_\alpha)$ for any cover $\{U_\alpha\}_\alpha$. 
Specifically, given an open set $U$ and a cover $\{ U_\alpha \mid \alpha \in A\}$ of $U$, define a category $\cU = \{U_\alpha \cap U_{\alpha'} \mid \alpha,\alpha' \in A \}$ with morphisms given by inclusion. 
Then we have a diagram $F:\cU \to \Set$, and as such can consider its colimit $\lambda:F \to L$.
If the unique map $L \to F(U)$ given by the colimit definition is an isomorphism, then $F$ is called a \emph{cosheaf}.

\subsection{Functorial Representation of Embedded Data}
\label{ssec:functorGraphs}

We start by defining a cubical complex on $[-B,B]^d$, where $[-B,B]^d$ will be the bounding box for the image of the graphs $f:X\to\R^d$ and $g:Y \to \R^d$ to be compared.
Following \cite{Kaczynski2004}, we define a cubical complex given by diameter $\delta$, with a modification to result in open sets.
For the sake of simplicity, assume that $B$ is a multiple of $\delta$, so that the bounding box can be written as $[-L\delta, L\delta]^d$. 
An \emph{elementary interval} is an open interval in $\R$ of the form 
$(\ell\delta, (\ell+1)\delta)$ or a single point viewed as a degenerate interval
$[\ell]:= [\ell\delta, \ell\delta]$ for $\ell \in [-L,\cdots, L] \subset \Z$.
These are called non-degenerate and degenerate intervals, respectively. 
An elementary cube $Q$ is a finite product of $d$ elementary intervals, i.e.
   $ \sigma = I_1 \times I_2 \times \cdots \times I_d \subset [-B,B]^d$. 
The dimension of a cube $\sigma$ is given by the number of intervals used which are non-degenerate. 
This means that 
$0$-cubes are vertices at grid locations 
$(i\delta, j \delta, \ldots, k \delta) \in \delta \cdot \Z^d$, 
$1$-cubes are edges (not including their endpoints), 
$2$-cubes are squares (not including their boundaries),
$3$-cubes are voxels, etc. 
The collection of elementary cubes discretizing $[-B,B]^d$ is a finite cubical complex $K$.
This construction comes with a face relation which gives a poset structure, where we write $\sigma \leq \tau$ iff $\sigma \subseteq \overline{\tau}$, where $\overline{\tau}$ denotes the closure of the set. 
In order to differentiate between the combintorial and continuous settings, we write $|\sigma|$ for the geometric realization  in $\R^d$ of a combinatorial object $\sigma \in K$. 


We next endow the complex $K$ with the Alexandroff topology, following \cite{Barmak2011}. 
Given the poset $(K,\leq)$, for any set $S \subseteq X$, the up-set is 
$S^{\uparrow} = \{x \mid x \geq y, \, y \in S \}$ and the down-set is
$S^{\downarrow} = \{ x \mid x \leq y, \, y \in S\}$. 
We give $K$ the Alexandroff topology%
\footnote{In the case of finite posets,  either down- or  up-sets can be used to define the topology; while the Alexandroff topology is defined using the down-sets as opens in the textbook we follow \cite{Barmak2011}. However, we choose to use the upsets as opens since we are trying to avoid using the opposite poset as much as possible to alleviate notation woes, and the correspondence with stars in this setting is useful for our purpose.} 
$\Open(K)$, where a set $U\subseteq K$ is open iff the following holds: 
for any $x \in U$ and any $y \geq x$, $y \in U$. 
Equivalently, this means that $U$ is its own up-set, i.e.~$U = U^\uparrow$.
It can be checked that this topology has a basis given by the collection  
$\{U_\sigma\}_{\sigma \in K}$ 
where 
$
    U_\sigma := \{ \sigma\}^{\uparrow} = \{\tau  \mid \tau \geq \sigma \}
$.
This complex is constructed so that for any open set $U \subset K$, the geometric realization $|U| \subseteq \R^d$ is open in the usual sense. 

The example inputs here  are given by $f:G \to \R^d$ where $G$ is a finite topological graph; however the graph assumption is needed only for simplicity of drawing examples. 
For our purpose, we only require that for any open set $U$, the set of connected components $\pi_0 f\inv(|U|)$ is finite. 
Then we can encode $f$ in a functor $F:\Open(K) \to \Set$ given by 
\begin{equation*}
    \begin{matrix}
    F: &  \Open(K) & \to & \Set\\
    & U & \mapsto & \pi_0 f\inv(|U|).
    \end{matrix}
\end{equation*}
Functoriality of $\pi_0$ means that for $U \subseteq V$, there is an induced map
\[F[U \subseteq V] \colon \pi_0f\inv(|U|) \to \pi_0f\inv(|V|),\]
so that $F$ satisfies the requirements of a functor.
Indeed, this functor is actually a cosheaf. 
When the sets involves are obvious in the notation, we will  write the induced map as $F[\subseteq]:F(U) \to F(V)$. 

\subsection{Thickenings}
\label{ssec:thickenings}
% Figure environment removed
Given any set $U \in \Open(K)$, the 1-thickening  is defined by taking the upset of the downset of $U$,  written as 
$   U^1 = (U^{\downarrow})^\uparrow$.
This operation can be thought of as taking the star of the closure of the set; see Fig.~\ref{fig:thickenings} for examples. 
The $n$-thickening is defined to be $n$ repetitions of the process given recursively as
\begin{equation*}
    U^n = 
    \begin{cases}
    U & n = 0\\
    (U^{n-1})^{\downarrow\uparrow} & n \geq 1.
    \end{cases}
\end{equation*}
Each $U^n$ is itself an open set in $\Open(K)$, and that if $U \subseteq V$, then $U^n \subseteq V^n$. 
Thus we can view this operation as a functor on the category $\Open(K)$ with morphisms given by inclusion:
\begin{equation*}
    \begin{matrix}
    (-)^n: & \Open(K)  & \to &  \Open(K)\\
    & U & \mapsto & U^n.
    \end{matrix}
\end{equation*}
In Sec.~\ref{sec:technicalProofs}, 
we show that $(-)^n$ is a functor.
Another useful property of this thickening, proved in Sec.~\ref{sec:technicalProofs}, is described in Lem.~\ref{lem:composedthickenings}.
\begin{restatable}{lemma}{composedThickenings}
\label{lem:composedthickenings}
For any $n, n' \geq 0$ and $U \in \Open(K)$, 
\[(U^{n})^{n'} = U^{n+n'}.\] 
\end{restatable}


We can use this thickening to build an interleaving distance on functors of the form \linebreak
${F:\Open(K) \to \Set}$.
The first necessary ingredient is the composition of functors $F \circ ( - )^n: \Open(K) \to \Set$, which we  denote by $F^n$. 
This means $F^n(U) = F(U^n)$, followed by a similar setup for $G^n$. 
With this notation, an interleaving is a pair of natural transformations $\phi:F \Rightarrow G^n$ and $\psi:G \Rightarrow F^n$, so a component of $\phi$ is a set-map $\phi_U:F(U) \to G(U^n)$. 
There is another component at $U^n$, $\phi_{U^n}:F(U^n) \to G(U^{2n})$, which can also be viewed as a component of a different natural transformation $\phi^n:F^n \Rightarrow G^{2n}$. 
For this reason, we use the notation $\phi_{U^n}$ and $\phi_U^n$ interchangeably when $\phi$ is indeed a natural transformation.\footnote{We are implicitly using Lem.~\ref{lem:composedthickenings} to write the maps this way.}

We are now ready to introduce our notion of interleaving distance. 
\begin{definition}
\label{def:interleavingDistance}
Given cosheaves $F,G:\Open(K) \to \Set$ and $n \geq 0$, an \emph{$n$-interleaving} is a pair of natural transformations 
$\phi:F \Rightarrow G^n$
and 
$\psi:G \Rightarrow F^n$
such that the diagrams 
\begin{equation*}
    \begin{tikzcd}
        F(U) 
            \ar[rr, "{F[U \subseteq U^{2n}]}"]   
            \ar[dr, "\phi_U"',violet] 
            & & F(U^{2n}) & 
        & F(U^n) \ar[dr]
            \ar[dr, "\phi_{U^{n}}",violet]
        & \\
        & G(U^n)\ar[ur, "\psi_{U^n}"', orange]  & & 
        G(U) 
            \ar[rr, "{G[U \subseteq U^{2n}]}"']
            \ar[ur, "\psi_{U}", orange]  
        && G(U^{2n})
    \end{tikzcd}
\end{equation*} 
commute for all $U \in \Open(K)$.
The interleaving distance is given by 
\begin{equation*}
    d_I(F,G) = \inf\{ n \geq 0 \mid \text{there exists an $n$-interleaving} \}, 
\end{equation*}
and is set to be $d(F,G) = \infty$ if there is no interleaving for any $n$.
\end{definition}
As shown in Sec.~\ref{sec:technicalProofs}, this definition fits in the framework built by Bubenik et al.~\cite{Bubenik2014a} and thus it is an extended pseudometric. 
