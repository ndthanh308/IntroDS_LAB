\documentclass[journal=jctc,manuscript=suppinfo,layout=traditional]{achemso}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{tikz,multirow,tabularx}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{shapes.misc}
\usepackage{footmisc}
\usepackage{booktabs}
\newcommand{\Nwalkers}{N_{\mathrm{walkers}}} % number of replicas
\newcommand{\Nopt}{N_{\mathrm{opt}}} % number of molecules undergoing stochastic minimization
\newcommand{\Cinf}{C^{\infty}} % the ``infinitely convex function''
\newcommand{\Vb}{V_{\mathrm{bias}}} % biasing potential used for ``real temperature'' replicas
\newcommand{\biasprop}{\alpha_{b}} % proportionality coefficient for the biasing potential
\newcommand{\JAN}[1]{\textrm{\textcolor{blue}{JAN: #1}}}
\newcommand{\KONSTANTIN}[1]{\textcolor{red}{KONSTANTIN: #1}}
\newcommand{\POSTSUB}[1]{\textcolor{red}{#1}}
\newcommand{\Nmorfconf}{N_{\mathrm{conf}}}
\newcommand{\Nrepeat}{N_{\mathrm{repeat}}}
\newcommand{\rcut}{\rho_{\mathrm{cut}}}
\newcommand{\wb}{w_{B}} % Boltzmann weights generated by MMFF94.
\newcommand{\wbc}{\tilde{w}_{B}} % cut Boltzmann weights used in the averaging.
\usepackage{dcolumn}
\newcommand{\alignedmultrow}[3]{\multirow{#1}{*}{
\begin{tabular}{D{,}{}{#2}}
    #3
\end{tabular}}}
\newcommand{\tworowcell}[2]{\begin{tabular}{@{}c@{}}#1 \\ #2\end{tabular}}
\newcommand{\resstructarr}[2]{\draw [stealth-stealth, line width=0.6mm] (#1) -- (#2)}
\newcommand{\resstructarroneway}[2]{\draw [-stealth, line width=0.6mm] (#1) -- (#2)}
\newcommand{\mutarrend}{Triangle[blue,fill=blue,scale=.5]}
\newcommand{\mutrevarr}[2]{\draw [blue, arrows={\mutarrend-\mutarrend}, line width=2mm] (#1) -- (#2)}
\newcommand{\mutarr}[2]{\draw [blue, arrows={-\mutarrend}, line width=2mm] (#1) -- (#2)}
\usepackage{enumitem}
\newcommand{\mutationlabel}[1]{M#1}
% For minimized quantities.
\newcommand{\dipole}{D}
\newcommand{\dEsolv}{\Delta G_{\mathrm{solv}}}
\newcommand{\gap}{\Delta \epsilon}
\newcommand{\Pacc}{P_{\mathrm{acc}}}
\newcommand{\Pprop}{P_{\mathrm{prop}}}
\newcommand{\bestcand}[1]{$\mathbf{C}_{#1}^{\mathrm{EGP}}$}
% for rotation next to multirow
\newcommand{\STAB}[1]{\begin{tabular}{@{}c@{}}#1\end{tabular}}
\newcommand{\elementarychange}[1]{E#1}
% Notation used in the tables.
\newcommand{\tpreq}{N^{\mathrm{graph}}_{\mathrm{req}}} % number of chemical graphs considered until best compound is found
\newcommand{\tottp}{N^{\mathrm{graph}}_{\mathrm{tot}}} % number of chemical graphs considered during a simulation in total 
\newcommand{\beststepfound}{N^{\mathrm{step}}_{\mathrm{req}}} % number of Monte Carlo steps done before the best candidate is found
\newcommand{\cheapquantnoise}{\Delta_{\mathrm{cheap}}^{\mathrm{conv}}}
\newcommand{\candidate}[2]{$\mathrm{C}_{#1}^{\mathrm{#2}}$}

\newcommand{\mutationexampleblock}[2]{
\hspace{-1.0ex}
\begin{tikzpicture}
        \node[anchor=south west,inner sep=0] (image) at (0.55,0) {% Figure removed};
        \node[anchor=south west,inner sep=0] (image) at (5.05,0) {% Figure removed};
        \mutrevarr{3.7,1.1}{5.0,1.1};
        \node at (1.0,2.75) {#2};
\end{tikzpicture}
}


\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\makeatletter
\def\BState{\State\hskip-\ALG@thistlm}
\makeatother


\SectionNumbersOn


\title{Evolutionary Monte Carlo of QM properties in chemical space: Electrolyte design}


\author{Konstantin Karandashev}
\email{konstantin.karandashev@univie.ac.at}
\affiliation{University of Vienna, Faculty of Physics, Kolingasse 14-16, AT-1090 Wien, Austria}
\author{Jan Weinreich}
\affiliation{University of Vienna, Faculty of Physics, Kolingasse 14-16, AT-1090 Wien, Austria}
\author{Stefan Heinen}
\affiliation{Vector Institute for Artificial Intelligence, Toronto, ON, M5S 1M1, Canada}
\author{Daniel Jose Arismendi Arrieta}
\affiliation{Department of Chemistry-{\AA}ngstr\"om Laboratory, Uppsala University, Box 538, SE-75121 Uppsala, Sweden}
\author{Guido Falk von Rudorff}
\affiliation{University Kassel, Department of Chemistry, Heinrich-Plett-Str.40, 34132 Kassel, Germany}
\alsoaffiliation{Center for Interdisciplinary Nanostructure Science and Technology (CINSaT), Heinrich-Plett-StraÃŸe 40, 34132 Kassel}
\author{Kersti Hermansson}
\affiliation{Department of Chemistry-{\AA}ngstr\"om Laboratory, Uppsala University, Box 538, SE-75121 Uppsala, Sweden}
\author{O. Anatole von Lilienfeld}
\affiliation{Vector Institute for Artificial Intelligence, Toronto, ON, M5S 1M1, Canada}
\alsoaffiliation{Departments of Chemistry, Materials Science and Engineering, and Physics, University of Toronto, St. George Campus, Toronto, ON, Canada}
\alsoaffiliation{Machine Learning Group, Technische Universit\"at Berlin and Institute for the Foundations of Learning and Data, 10587 Berlin, Germany}


\begin{document}

\maketitle

\section{Details of elementary mutation and crossover move implementations}
\label{section:implementation_details}



While in Subsec.~2.3 of the main text it was convenient to speak about invertible elementary mutations, the corresponding procedures were implemented in terms of \emph{elementary changes} listed in the left column of Table~\ref{tab:random_change_choice}, which differ from elementary mutations in treating procedures for creating and destroying nodes separately rather than part of unified mutations changing the number of nodes in a chemical graph. To apply a random mutation to a chemical graph we enumerate all sets of possible elementary change parameters, which is also when we observe constraints on allowed types of covalent bonds and number of nodes. We then randomly choose change parameters among those enumerated, by first choosing the elementary change, and then all other parameters in the order listed in the right column of Table~\ref{tab:random_change_choice}. Lastly, we check that straightforward application of the change yields a molecule without nodes with invalid valences and if that is not the case reject the move automatically. The last step's necessity is illustrated with an example in Figure~\ref{fig:valence_invalid_move}.

In Table~\ref{tab:random_change_choice}, whenever we mention choosing a node or a pair of nodes we mean choosing them among a list of all nodes or pairs of nodes such that none of them are equivalent to any other in the chemical graph. This prevents MOSAiCS from considering several mutations that yield the same chemical graph $X_{2}$ given an initial chemical graph $X_{1}$, making it straightforward to define the unique inverse change parameters that yield $X_{1}$ when applied to $X_{2}$. Enumerating all possible changes for $X_{2}$ analogously to $X_{1}$ allows straightforward calculation of the proposition probability ratio in acceptance probability expression [Eq.~(4) in the main text]. Choosing resonance structure for \elementarychange{2} and \elementarychange{6} is necessary in situations when decreasing bond order, depending on the resonance structure, can yield two distinct molecules corresponding to cases when the changed covalent bond is conserved or broken; such situations are illustrated in Figure~\ref{fig:res_struct_dep_examples}.



 \begin{table}%[htb]
 \centering
\input{tables/mutation_implementation/mutation_choice_order}
\caption{Elementary changes used in this work along with the corresponding order in which random change parameters were chosen.}
\label{tab:random_change_choice}
\end{table}


 % Figure environment removed
 
 % Figure environment removed


Choosing the parameters of a crossover move starts with assigning the ``blue fragments'' (as illustrated in Figure~4) which are defined as the set of nodes separated by a given number of covalent bonds from an ``origin'' node. Origin nodes in the two molecules are chosen randomly; then we enumerate all possible blue fragments such that:
\begin{itemize}
\item a pair of resonance structures chosen for both molecules allows a one-on-one mapping between green (see Figure~4) covalent bonds of the same order;
\item exchanging the blue fragments yields chemical graphs satisfying constraints on the number of nodes in a chemical graph;
\item at least one blue fragment and at least one red (see Figure~4) fragment contain more than one node, ensuring that the crossover move is not a simple combination of two \elementarychange{3} elementary changes;
\item the number of green bonds is not larger than a certain threshold (set 3 in this work); this is done to limit the number of chemical graph pairs enumerated during the next step.
\end{itemize}
With the blue fragments chosen we enumerate all pairs of chemical graphs obtained by exchanging them, \emph{i.e.} taking pairs of green bonds from molecules and exchanging nodes between them, thus connecting each molecule's blue fragment to the red fragment of the other molecule. For each thus generated pair we additionally check that the valences in the exchanged blue and red fragments are valid in the new molecules (to prevent situations analogous to the one illustrated in Figure~\ref{fig:valence_invalid_move}), that none of the newly created green bonds connect the same pair of nodes (to prevent irreversible changes illustrated in Figure~\ref{fig:irrev_cross_coupling_example}), and that none of the newly created bonds violate constraints on which types of heavy atoms can be covalently connected.

Of the resulting pairs of chemical graphs one pair, consisting of chemical graphs $\tilde{X}^{\prime}$ and $\tilde{X}^{\prime\prime}$, is randomly chosen. The chemical graphs are assigned to replicas $i^{\prime}$ and $i^{\prime\prime}$ according to the value of sampled probability $P$ [Eq.~(1) in the main text] corresponding to the ordering. In other words, if both replicas $i^{\prime}$ and $i^{\prime\prime}$ are greedy the assignment is random; if exactly one is greedy it is assigned the chemical graph corresponding to the smaller value of $F$; if both are exploration replicas the probability of assigning $\tilde{X}^{\prime}$ and $\tilde{X}^{\prime\prime}$ to replicas $i^{\prime}$ and $i^{\prime\prime}$ is proportional to
\begin{equation}
    P_{\mathrm{order}}(\tilde{X}^{\prime},
    \tilde{X}^{\prime\prime},i^{\prime},i^{\prime\prime})=\exp\left\{-\beta^{(i^{\prime})}\left[F(\tilde{X}^{\prime})+\Vb^{(i^{\prime})}(\tilde{X}^{\prime})\right]
    -\beta^{(i^{\prime\prime})}\left[F(\tilde{X}^{\prime\prime})+\Vb^{(i^{\prime\prime})}(\tilde{X}^{\prime\prime})\right]
    \right\}.\label{eq:trial_ordering_probability}
\end{equation}
Note that if $i^{\prime}$ and $i^{\prime\prime}$ are a greedy and an exploration replicas and $F(X^{(i^{\prime})})>F(X^{(i^{\prime\prime})})$ then the crossover move has no inverse; we avoided such situations by preceding and following a crossover move with attempting a tempering swap move on replicas $i^{\prime}$ and $i^{\prime\prime}$. The inverse crossover parameters required to calculate acceptance probability $\Pacc$ [Eq.~(4) in the main text] correspond to the same blue fragments being exchanged.


 % Figure environment removed


\section{Experimental details}

\subsection{Estimating quantities of interest}
\label{subsec:quant_eval}

To estimate free energy of solvation $\dEsolv$, dipole $\dipole$, and HOMO-LUMO gap $\gap$ we used the recipe from Ref.~\citenum{Ebejer_Deane:2012}, as implemented in the Morfeus package,\cite{software:Morfeus} to generate the molecule's conformers and Boltzmann weights $\wb^{(k)}$ (where $k$ is conformer index) at $T=298.15\,\mathrm{K}$ with the MMFF94 forcefield\cite{Halgren:1996_I,*Halgren:1996_II,*Halgren:1996_III,*Halgren_Nachbar:1996_IV,*Halgren:1996_V,*Halgren:1999_VI,*Halgren:1999_VII} as implemented\cite{Tosco_Landrum:2014} in RDKit.\cite{software:RDKit} If converting the lower energy conformer's geometry back to a chemical graph using the xyz2mol code\cite{Kim_Kim:2015,software:xyz2mol} proved impossible or yielded a chemical graph different from the initial one we considered conformer generation to have failed. To decrease the number of conformers considered, we introduced ``cut'' Boltzmann weights $\wbc^{(k)}$ obtained by solving w.r.t. $\wbc^{(k)}$ and $\rho_{-}$
    \begin{align}
        \forall k : \wbc^{(k)}&=\max\left(\wb^{(k)}-\rho_{-}, 0\right),\\
        \frac{\sum_{k}\wbc^{(k)}}{\sum_{k}\wb^{(k)}}&=1-\rcut,
    \end{align}
where $\rcut$ is a user-defined parameter. Note that $\wbc^{(k)}$ is exactly zero for higher-energy conformers of the molecule while being a smooth function of $\wb^{(k)}$. Then for each conformer with non-zero $\wbc^{(k)}$ we used xtb code\cite{Bannwarth_Grimme:2021} to run GFN2-xTB\cite{Bannwarth_Grimme:2019} calculations with analytical linearized Poisson-Boltzmann (ALPB) model\cite{Ehlert_Grimme:2021} used to simulate presence of water. For $\dipole$ and $\gap$ we took weighted averages of the resulting dipole and HOMO-LUMO gap estimates with $\wbc^{(k)}$ as weights; for $\dEsolv$ the averaged quantity was the difference between GFN2-xTB electronic energies obtained with and without ALPB. Since there is a randomness to generating conformers with Morfeus, the procedure was repeated $\Nrepeat$ times with the mean taken as final result and the standard deviation used to estimate the latter's root mean square error (RMSE). A molecule was considered invalid if one of the $\Nrepeat$ generations of MMFF94 coordinates failed or if one of the GFN2-xTB calculations done for the molecule did not converge. This \emph{a priori} limited us to molecules that are not geometrically strained, but we did not consider this restriction important for our end goal applications since geometrically strained molecules are in general less thermodynamically stable, making them less desirable as battery electrolyte components. Lastly, we had to restart some EGP* simulations due to our code's failure to handle some xtb code exceptions. Since we encountered such exceptions during less than one in $10^{7}$ of evaluation of EGP* molecules this issue had a negligible impact on the results presented in this work.


The two different sets of calculation parameters mentioned in Subsec.~2.4 of the main text are $\Nmorfconf=32$ and $\Nrepeat=16$ for ``converged,'' with $\Nmorfconf=8$ and $\Nrepeat=1$ for  ``cheap''; $\rcut=0.1$ was chosen for both cases. Quantity estimates obtained with the former exhibited low RMSE's over QM9 and EGP datasets, but sometimes required relatively large computational time to be calculated, hence the cheap set of parameters were used during our simulations.

Properties of $\dEsolv$, $\dipole$, and $\gap$ over molecules in intersections of QM9 with QM9* and EGP with EGP* satisfying $\gap$ constraints are summarized in Table~\ref{tab:dataset_reference}. Note that RMSE's of properties of interest are reasonable over all such molecules. The table also presents reference values used to calculate relative improvements presented in the main text for candidate molecules.

 
 \begin{table}%[htb]
 \centering
\input{tables/dataset_reference_table}
\caption{Properties of sets of molecules at the intersection of QM9 and QM9* or EGP and EGP* that satisfy weak or strong constraint on HOMO-LUMO gap $\gap$, namely their number (num. mol.), standard deviations (STD) of optimized quantities (free energy of solvation $\dEsolv$ and dipole $\dipole$) over these molecules, the maximum root mean square errors (RMSEs) observed $\dEsolv$, $\dipole$, and $\gap$, minimum of $\dEsolv$ and maximum of $\dipole$, along with SMILES of the molecules for which these extrema values were observed. The total number of molecules (tot. num. mol.) is the number of molecules whose chemical graphs, if extractable from QM9 or EGP coordinates with xyz2mol code, satisfied constraints of QM9* or EGP* sets.}
\label{tab:dataset_reference}
\end{table}

\subsection{Accessibility of chemical space}

To guarantee (at least for $\biasprop=0$ when the sampling is Markovian) that MOSAiCS eventually finds the minimum of loss function over the set of chemical graphs of interest the procedures used to propose trial replica configurations should have \emph{connectivity}, \emph{i.e.} it should be possible to morph each pair of members of the set from one into another using these procedures alone and with only other molecules in this set as intermediates. Mutations \mutationlabel{1}-\mutationlabel{4} are enough to guarantee connectivity in a large variety of relevant sets of chemical graphs, for example those obeying an upper bound on the number of heavy atoms and a constraint on which types of non-carbon heavy atoms can share a covalent bond. Connectivity of this kind of sets is easily seen by ``constructing'' and ``deconstructing'' each set member to and from methane. The same argument holds for QM9* but, unfortunately, not for EGP* due to P and S atoms being forbidden to share a covalent bond with a hydrogen atom, making it impossible to use mutation \mutationlabel{4}. Introducing additional mutations \mutationlabel{5} and \mutationlabel{6} alleviates the problem only partially, with an example of an EGP* molecule that cannot be transformed to and from methane using elementary mutations presented in Figure~\ref{fig:connectivity_counterexample}. This molecule can be considered by the simulations used in this work thanks to crossover moves, but we cannot guarantee this is the case for all such examples. However, we note that all such molecules are geometrically strained, which makes them not interesting for our applications due to decreased thermodynamic stability.

 % Figure environment removed


\section{Additional data obtained during optimization in QM9* and EGP*}
\label{sec:add_data}


Full information about QM9* candidates, including the corresponding values of optimized quantities and how often they were proposed by our simulations, is presented in Table~\ref{tab:qm9_candidates}; we see that for all optimization problems but for maximizing $\dipole$ with strong $\gap$ constraint the agreement between simulations in terms of proposed candidates is close to unanimous. Figure~\ref{fig:qm9_runner_ups} presents QM9* candidates that were not plotted in Figure~5; while we once again see MOSAiCS' ability to generate unconventional molecular structures, candidates \candidate{7}{QM9}, \candidate{8}{QM9}, and \candidate{9}{QM9} demonstrate that our criterion for considering a molecule stable was not always realistic. To compare how fast MOSAiCS found candidates for different optimization problems and $\biasprop$ values, we also calculated numbers of chemical graphs considered during a simulation before the candidate was encountered $\tpreq$, total number of chemical graphs considered during a simulation $\tottp$, and the number of global steps (as defined in Subsec.~2.5 of the main text) taken by a simulation before the candidate was encountered $\beststepfound$. For QM9* simulations mean and standard deviation values of these quantities are summarized in Table~\ref{tab:qm9_step_comp}. Changing the bias proportionality coefficient $\biasprop$ did not significantly affect the number of global steps required on average to find a candidate molecule, but did lead to a more thorough (but also costly) exploration of chemical space, as demonstrated by significant increase of $\overline{\tpreq}$ and $\overline{\tottp}$. Another interesting observation is that for a given $\gap$ constraint $\beststepfound$ values are significantly higher for optimization of $\dipole$ than optimization of $\dEsolv$. This is likely due to $\dEsolv$ being easier to optimize since free energy of solvation can be accurately decomposed as the sum of scalar contributions from different functional groups in the molecule,\cite{Chung_Green:2020} while for the dipole moment such contributions would take vector form whose sum would depend on the groups' placement in Cartesian space. Also note that for all optimization problems but for maximizing $\dipole$ with a strong $\gap$ constraint the $\beststepfound$ was typically significantly smaller than the simulation length, which is an indicator of the simulations being converged in these cases. Relative improvement progress plots for optimization problems not shown in the main text are presented in Figure~\ref{fig:qm9_SI_opt_logs}; while they look largely analogous to Figure~6, our simulations look less converged for minimization under strong $\gap$ constraint than under weak $\gap$ constraint. Plots of densities of QM9* molecules analogous to Figure~7 are found in Figures~\ref{fig:qm9_pareto_front_solvation_strong}-\ref{fig:qm9_pareto_front_dipole_strong}; analogously to Figure~7 we observe an increase in diversity of considered molecules largely achieved by increasing exploration of chemical space regions less valuable in terms of properties of interest.

\begin{table}
 \centering
\input{tables/candidate_tables/final_QM9_candidate_table}
\caption{QM9* candidates along with their corresponding optimized quantity values (opt. quant.) and the number of times the molecule was proposed as a candidate by simulations run with different values of the bias proportionality coefficient $\biasprop$ (prop. with $\biasprop$). $\dEsolv$ and $\dipole$ values are in kJ/mol and debye.}
\label{tab:qm9_candidates}
\end{table}

 % Figure environment removed


 \begin{table}%[htb]
 \centering
\input{tables/number_tables/step_comp_table_QM9}
\caption{Mean and standard deviation of number of chemical graphs considered by a simulation before its candidate was encountered [$\overline{\tpreq}$ and $\sigma(\tpreq)$], total number of chemical graphs considered by a simulation [$\overline{\tottp}$ and $\sigma(\tottp)$], and number of global steps taken by a simulation before the candidate was encountered [$\overline{\beststepfound}$ and $\sigma(\beststepfound)$] observed for trajectories in QM9* for different optimization problems (minimize free energy of solvation $\dEsolv$ or maximize dipole $\dipole$ under weak or strong constraint on HOMO-LUMO gap $\gap$) and different values of the bias proportionality coefficient $\biasprop$.}
\label{tab:qm9_step_comp}
\end{table}



 % Figure environment removed


 % Figure environment removed


 % Figure environment removed
 
 % Figure environment removed


Due to the large number of candidates found in EGP* their full lists are left for Subsec.~\ref{subsec:egp_full_candidate_lists}. We summarize how well these molecules were optimized for different optimization problems and $\biasprop$ values in Table~\ref{tab:egp_step_comp}; we observe from the behavior of average optimized property values of candidates $\overline{\dipole^{\mathrm{best}}}$ and $\overline{\dEsolv^{\mathrm{best}}}$ that adding biasing potential at worst did not significantly affect optimization results and at best provided significant improvements. Table~\ref{tab:egp_step_comp} summarizes the behavior of $\tpreq$, $\tottp$, and $\beststepfound$ for our EGP* simulations. Increasing $\biasprop$ consistently increased the number of molecules explored by a trajectory; the $\beststepfound$ values comparable to the total simulation length is an indicator of these simulations not being converged. Analogously to Figure~9, Figure~\ref{fig:egp_SI_opt_logs} shows how using non-zero $\biasprop$ could accelerate finding better candidates w.r.t the number of global Monte Carlo steps. However, we need to underline that, as indicated by $\tpreq$ and $\tottp$ values in Table~\ref{tab:egp_step_comp}, a non-zero $\biasprop$ actually increased the computational time spent on proposing a candidate since MOSAiCS considered more chemical graphs during the corresponding simulations. Plots of densities of EGP* molecules analogous to Figure~10 are found in Figures~\ref{fig:egp_pareto_front_solvation_strong}-\ref{fig:egp_pareto_front_dipole_strong}; analogously to Figure~10 we observe that increasing $\biasprop$ tended to help the simulations explore regions of chemical space more valuable in terms of optimized quantities.

% KK: Cut during revision.
%\begin{table}%[htb]
%\input{tables/number_tables/minimized_averages_table_EGP}
%\caption{Best values of, means of, and standard deviations of optimized quantities of candidate molecules [min. $\dEsolv^{\mathrm{best}}$, $\overline{\dEsolv^{\mathrm{best}}}$, and $\sigma(\dEsolv^{\mathrm{best}})$ for minimization of free energy of solvation $\dEsolv$; max. $\dipole^{\mathrm{best}}$, $\overline{\dipole^{\mathrm{best}}}$, and $\sigma(\dipole^{\mathrm{best}})$ for maximization of dipole $\dipole$] produced by simulations in EGP* with weak or strong constraint on the HOMO-LUMO gap $\gap$ and with different values of bias proportionality coefficient $\biasprop$.}
%\label{tab:egp_min_av}
%\end{table}

\begin{table}%[htb]
\input{tables/number_tables/step_comp_table_EGP}
\caption{Numbers of chemical graphs considered by a trajectory before the candidate molecule was encountered $\tpreq$, total numbers of chemical graphs considered by a trajectory $\tottp$, and numbers of global steps after which the candidate was encountered [$\overline{\beststepfound}$ and $\sigma(\beststepfound)$] observed for EGP* simulations; results are labeled analogously to Table~\ref{tab:qm9_step_comp}.}
\label{tab:egp_step_comp}
\end{table}

 % Figure environment removed



 % Figure environment removed


 % Figure environment removed

 % Figure environment removed


Lastly, the difference between cheap and converged estimates of $\dipole$ and $\dEsolv$ is very small for rigid molecules that only have one local minimum in configuration space (\emph{e.g.} benzene), but it can become significant for larger non-rigid molecules with many valid conformers. To compare how much this difference affected candidate molecules obtained in this work we introduced ``numerical error measure'' $\cheapquantnoise$ defined as the ratio of mean absolute error of the cheap estimate relative to the converged one divided by standard deviation of the converged estimate over the pre-final (as defined in Subsec.~2.5 of the main text) molecules. Its values for QM9* and EGP* simulations are presented in Table~\ref{tab:cheap_quant_noise}. For QM9*, we note that maximizing $\dipole$ under strong $\gap$ constraint was apparently much more affected by using $\dipole^{\mathrm{cheap}}$ in the minimization function, which may be the reason simulations for that optimization problem agreed on candidate molecules much less frequently than for the other three. We also observe that for a given optimization problem simulations in EGP* were much more affected by cheap/converged difference than the ones in QM9*, likely due to EGP* consisting of larger molecules with more conformers to be accounted for. This added to EGP* being the more challenging set of molecules to search through compared to QM9*.

\begin{table}%[htb]
 \centering
\input{tables/cheap_quant_noise_table}
\caption{Measure of error caused by using cheap version of optimized quantity during the simulation $\cheapquantnoise$ (see Sec.~\ref{sec:add_data} for definition) observed during simulations in QM9* or EGP*, while maximizing dipole $\dipole$ or minimizing free energy of solvation $\dEsolv$, under a weak or strong constraint on the HOMO-LUMO gap $\gap$, and with different values of the bias proportionality coefficient $\biasprop$.}
\label{tab:cheap_quant_noise}
\end{table}

\subsection{Effect of initial replica positions on optimization results}
\label{subsec:random_init_mols_results}

It is natural to assume that increasing diversity of molecules initially occupied by replicas should make it easier for MOSAiCS to propose better candidate molecules. We tested this hypothesis on minimizing $\dEsolv$ with strong $\gap$ constraint over QM9*, since it is a problem for which converged results proved easy to obtain and for which improvement over QM9 was observed. For that optimization problem we launched 8 simulations with $\biasprop=0.0$ which only differed from the others presented in this work by the choice of initial molecules: each was chosen with uniform probability from molecules in the intersection of QM9 and QM9* that satisfied strong constraint on $\gap^{\mathrm{cheap}}$, then initial molecules were assigned to replicas in such a way that molecules with larger $\dEsolv^{\mathrm{cheap}}$ were occupied by replicas with smaller $\beta^{(i)}$. The resulting mean optimization progress is plotted in Figure~\ref{fig:init_cond_opt_logs}, with the corresponding values observed when all replicas were initialized in methane added for comparison. Surprisingly, while simulations with random starting molecules had significantly larger starting values of relative improvement, they failed to go beyond those values significantly earlier than simulations initialized with methane, and they all proposed previously mentioned \candidate{2}{QM9} as the candidate. While there might be better ways to choose initial molecules that would make search for candidates tangibly faster, finding them was beyond the scope of this work.

 % Figure environment removed


\subsection{EGP* full candidate list}
\label{subsec:egp_full_candidate_lists}

EGP* candidates proposed by MOSAiCS are listed in Tables~\ref{tab:egp_candidates_solvation_weak}-\ref{tab:egp_candidates_dipole_strong}. Examples of candidates plotted in Figure~\ref{fig:egp_candidate_examples} demonstrate MOSAiCS' ability to produce candidates with complicated structures, including unusual heterocycles (\candidate{14}{EGP}, \candidate{38}{EGP}, and \candidate{82}{EGP}), conjugated heterocycles (\candidate{17}{EGP}, \candidate{40}{EGP}), and caged molecules (\candidate{32}{EGP}).

 % Figure environment removed



 \begin{table}%[htb]
 \centering
\input{tables/candidate_tables/candidate_table_solvation_energy_weak.tex}
\caption{EGP* candidates proposed during minimization of free energy of solvation $\dEsolv$ with weak constraint on the HOMO-LUMO gap $\gap$, the corresponding values of $\dEsolv$, and the number of times a molecule was proposed as a candidate by simulations run with different values of the bias proportionality coefficient $\biasprop$ (prop. with $\biasprop$).}
\label{tab:egp_candidates_solvation_weak}
\end{table}

 \begin{table}%[htb]
 \centering
\input{tables/candidate_tables/candidate_table_solvation_energy_strong.tex}
\caption{EGP* candidates proposed during minimization of free energy of solvation $\dEsolv$ with strong constraint on HOMO-LUMO gap $\gap$; columns are labeled analogously to Table~\ref{tab:egp_candidates_solvation_weak}.}
\label{tab:egp_candidates_solvation_strong}
\end{table}
 
 \begin{table}%[htb]
 \centering
\input{tables/candidate_tables/candidate_table_dipole_weak.tex}
\caption{EGP* candidates proposed during maximization of dipole $\dipole$ with weak constraint on HOMO-LUMO gap $\gap$; columns are labeled analogously to Table~\ref{tab:egp_candidates_solvation_weak}.}
\label{tab:egp_candidates_dipole_weak}
\end{table}

 \begin{table}%[htb]
 \centering
\input{tables/candidate_tables/candidate_table_dipole_strong.tex}
\caption{EGP* candidates proposed during maximization of dipole $\dipole$ with strong constraint on HOMO-LUMO gap $\gap$; columns are labeled analogously to Table~\ref{tab:egp_candidates_solvation_weak}.}
\label{tab:egp_candidates_dipole_strong}
\end{table}


\bibliography{references}


\end{document}