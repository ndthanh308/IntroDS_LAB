% Please make sure you insert your data according to the instructions in PoSauthmanual.pdf
\documentclass[a4paper,11pt]{article}

\usepackage{pos}
%\usepackage{siunitx}
%\usepackage{todonotes}
%\usepackage{placeins}
%\usepackage{graphicx}
%\usepackage{caption}
\usepackage{subcaption}
\usepackage{wrapfig}
%\usepackage{floatrow}
%\usepackage{tikz}

\title{Towards a cosmic ray composition measurement with the IceAct telescopes at the IceCube Neutrino Observatory}

\ShortTitle{IceAct composition measurement}

% Don't change:
\author{The IceCube Collaboration \\{\normalsize \normalfont(a complete list of authors can be found at the end of the proceedings)}\\}

% Your emails:
\emailAdd{larissa.paul@icecube.wisc.edu}

\abstract{

% start of abstract
The IceCube Neutrino Observatory is equipped with the unique possibility to measure cosmic ray induced air showers simultaneously by their particle footprint on the surface with the IceTop detector and by the high-energy muonic shower component at a depth of more than 1.5 km. Since 2019 additionally two Imaging Air Cherenkov Telescopes, called IceAct, measure the electromagnetic component of air showers in the atmosphere above the IceCube detector. This opens the possibility to measure air shower parameters in three independent detectors and allows to improve mass composition studies with the IceCube data. One IceAct camera consists of 61 SiPM pixels in a hexagonal grid. Each pixel has a field of view of 1.5 degree resulting in an approximately 12-degree field of view per camera. A single telescope tube has a diameter of 50 cm, is built robust enough to withstand the harsh Antarctic conditions, and is able to detect cosmic ray particles with energies above approximately 10 TeV. A Graph Neural Network (GNN) is trained to determine the air shower properties from IceAct data. The composition analysis is then performed using Random Forest Regression (RF). Since all three detectors have a different energy threshold, we train several RFs with different inputs, combining the different detectors and taking advantage of the lower energy threshold of the IceAct telescopes. This will result in composition measurements for different detector combinations and enables cross-checks of the results in overlapping energy bands. We present the method, parameters for data selection, and the status of this analysis.
% end of abstract

\vspace{4mm}
{\bfseries Corresponding authors:}
Larissa Paul$^{1,2*}$\\
{$^{1}$ \itshape Marquette University, Milwaukee, Wisconsin}\\
{$^{2}$ \itshape South Dakota School of Mines and Technology, Rapid City, South Dakota}\\\\[4mm]
$^*$ Presenter

\ConferenceLogo{PoS_ICRC2023_logo.pdf}

\FullConference{The 38th International Cosmic Ray Conference (ICRC2023)\\ 26 July -- 3 August, 2023\\ Nagoya, Japan}
}

\begin{document}

%% Define some special code words!
\newcommand{\logEGeV}{$\log_{10}(\frac{E}{GeV})$}
%\newcommand{\logEGeV}{$\log_{10}(E/\mathrm{GeV})$}
\newcommand{\todo}[1]{{\bf \textcolor{red}{#1}}}

\maketitle
%\Large These proceedings are still working in progress there is still text added to them and the formulations are not final.
%\normalsize

\section{Introduction}\label{sec1}
The two IceAct telescopes have been continuously taking data since 2019 during the Austral winter. One -- the "roof telescope" -- is positioned in the center of the IceCube Neutrino Observatory (IceCube)~\cite{Aartsen:2016nxy, icetop2013} on top of the IceCube Laboratory building. The other -- the "field telescope" -- is roughly 220$\,$m west from the roof telescope. % close to the Surface Array Enhancement prototype station\cite{Author:2023icrcShefali}.
The telescopes measure the Cherenkov light which is emitted by the high energy particles of air showers produced in the collision of cosmic ray particles with the Earth's atmosphere. The photons collected by the telescopes are mainly emitted by the electromagnetic part of the extensive air shower. This is a complementary measurement to the standard detectors of IceCube which measure the high energy muon component in the deep ice and the electromagnetic plus low energy muon footprint at the surface with the IceTop detector~\cite{icetop2013}. 

The idea of this analysis is to use a Graph Neural Network (GNN) to reconstruct air shower parameters, described in section \ref{secgnn}. The results of the GNN reconstruction are then used for a mass composition analysis performed with a Random Forest Regression (RF) described in section \ref{secrf}. The input parameters into the RF include the air shower parameters %reconstructed by the GNN 
and the parameters of the IceCube and IceTop detectors. %Each detector has a different energy threshold so the mass composition analysis will have a different energy range depending on which detector components are combined. 
In this proceeding, two mass composition studies will be discussed: one using only input parameters from the IceAct telescopes, and the other one using input parameters from the IceAct telescope and the IceCube detector. Each analysis has their own energy range due to the different detector thresholds. For the final analysis step, a template analysis similar to the previously published three year mass composition analysis from IceCube~\cite{IceCube:2019hmk} is performed, which is described in section \ref{sec5}.
%The typical muon ring which is typically visible in other Imaging Cherenkov telescopes is a too faint signal to be visible in our telescope. We are able to see a muon signal from muons passing through the light guides on the camera board and through the camera board itself in our calibration runs which are performed before and after our data-taking season. For this calibration runs the telescopes are closed. The typical signature of those events is a strong signal in one of the pixels and nearly no signal in the surrounding pixels. 
\section{Data preparation}\label{secdata}%%1 
In 2020, the data acquisition system (DAQ) of both telescopes was unified using the TARGET DAQ which was developed for the Cherenkov Telescope Array \cite{Author:2017Funktarget}. In preparation for the analysis, both telescopes have been calibrated. A detailed description of the calibration runs for the telescopes can be found in \cite{Author:2023icrcLars}. The muon runs and dark count run data described there are used for the calibration of each individual pixel. To perform the calibration, a peak extraction is applied to the data. The peak extraction subtracts the median of the waveform and calculates the parabola through the three highest points of the waveform. If the parabola is pointing upwards the highest point of the parabola is accepted as peak height and peak time. The width of the peak is determined by calculating the time difference between the highest point and the point where the peak reaches half the peak height. %Several cuts on the quality of the data are performed e.g.~the width needs to be at least 2$\,$ns and the peak time needs to be within a time window around the trigger time.
The applied quality cuts are that the pulse width needs to be at least 2$\,$ns and the peak time needs to be within a time window around the trigger time.
%Each pixel's peak heights are then histogrammed separately, and a modified Erlangen function \cite{Biland:2014fqa} is fitted to the histogram. 
The calibration results in an average gain of 7.2$\,$ADC counts per photon.

The typical data-taking period for the telescopes is from the end of April to the beginning of September, which results in a detector uptime of above 30\% of a full year. The data taking is fully automated and the threshold is regularly adjusted for the amount of background light present, accounting for aurora flares and full moon periods. Threshold scans, calibration data taking, and unfavorable weather conditions such as clouds and full moon periods, reduce the good-run uptime to slightly above 20\% of the year since 2021 \cite{Author:paul2021hybrid}. 
%A detailed description of the performance of the telescope since 2020 can be found in these proceedings \cite{Author:2023icrcLars}. 
Quality parameters%, which will be applied to the data, 
are currently being studied, for the selection of stable atmospheric conditions. For this, a commercial fish-eye camera has been installed on top of the IceCube Laboratory, which regularly takes pictures of the night sky above the telescopes. This allows for monitoring the night sky background (NSB) e.g.~aurora activities and cloud coverage by counting the number of stars visible in the camera image. Additionally, monitoring parameters of the telescope itself can be used for the data selection as described in \cite{Author:2023icrcLars}.

\section{Simulation dataset}\label{secsim}
For this study, a dedicated Monte Carlo (MC) data set has been produced. A special module has been implemented into the IceCube software framework icetray \cite{icetray}, to optimize the production of the air shower simulations. The module throws randomly the shower core position in IceCube coordinates and calculates the relative telescope positions in CORSIKA \cite{Author:Heck1998vt} coordinates which reduces the data volume by only storing Cherenkov photons around the telescope positions. The events are thrown in a circle centered on the point between the roof telescope and the field telescope, with a radius which increases with increasing energy: 250$\,$m for events below 10$^4\,$GeV, and increasing by 50$\,$m for each 0.25 in \logEGeV{}. The events are drawn from an $E^{-1}$ spectrum between 10$^{3.5}\,$GeV and 10$^{6.75}\,$GeV. To boost the number of low energy events, several additional data sets have been created with smaller energy ranges, all following the $E^{-1}$ spectrum. Six different types of nuclei are used as primary particles in the simulation: proton, helium~(He), nitrogen~(CNO), neon, aluminum~(MgSi), and iron. 
%To further optimize the efficiency of the MC production additional positions have been added as telescopes positions. The information of those telescope positions are just used for the training and validation of the Graph Neural Network (GNN) which is used for the reconstruction of air shower properties.
The air shower propagation is simulated using CORSIKA with Sibyll2.3c as the interaction model for the high energy interactions and FLUKA for the low energy hadronic interactions. The atmosphere for the CORSIKA simulation uses a layered parameterization of the average South Pole atmosphere in April \cite{sam_thesis}.
The simulation is then processed to include the response of the IceTop and in-ice detectors. 
The Cherenkov photons produced in the atmosphere by CORSIKA are not absorbed or scattered during the simulation. To account for this, an additional module was implemented which calculates the total transmission probability for each photon depending on the production height of the photon, the zenith angle, and wavelength. The transmission probability is calculated by the software package MODTRAN \cite{berk2014modtran} which gets a measured atmosphere at the South Pole as input. %As a next step, the telescope response is simulated including the response depending on the wavelength and zenith angle of the incoming photons, the response of the SiPM, and the DAQ chain.
%As a next step, t
The full telescope simulation includes the response of the telescope optics depending on the wavelength and zenith angle of the incoming photons and the simulation of the silicon photomultiplier (SiPM) response and the DAQ chain. The SiPM response module includes the simulation of the background noise which is mainly produced by the electronic noise and photons of the NSB and cross talk. 
%This simulation uses an amplitude of 0.84mV/PE for the simulation of the SiPM pulses.The IceAct_Target_inverted_Shaper_pulse_m19 pulse is used as template for the SiPM pulse simulation.The shaper simulation has a gain of ~2.4 for this type of pulse.The ADC is not included in the simulation. TARGET_20201113.txt is used as DAQ chain. A conversion factor of 3.6ADC/mV is expected for the conversion to ADC counts. (Yuriy Popovych Masterthesis) 1PE * 0.84mV/PE * 2.4 * 3.6 ADC / mV  ~ 7.26 ADC
%Before the data is then used in the reconstruction and mass composition analysis 
Lastly, the camera images have to be cleaned. An overall threshold of 15$\,$PE will cut away most of the noise signals, but pixels with at least two neighboring pixels above 15$\,$PE will be kept if their peak height is higher than 10$\,$PE and the peak times are within 5$\,$ns. 
%As a next step at least 3 pixels need to survive this image cleaning.  After that, the events are cut
An event overall will be removed if it has less than 3 surviving pixels, or
if the ratio of the sum of charges of the inner pixels divided by the sum of charges of the outer pixels is larger than one, with inner/outer referring to the position on the camera board. This cleans out the showers which are not mostly contained in the camera. 

\section{Graph Neural Network reconstruction of air shower properties}\label{secgnn}
A GNN has been implemented to reconstruct the air shower parameters. A GNN in general consists of nodes that contain the event information and edges which define the relationship between the nodes. Each graph can have a different number of nodes and relationships between the nodes, but the structure is constant between events. 
The GNN has been chosen as machine learning method since it can handle a different number of nodes for each event and it is easily expandable to more telescopes and other detector types in future analysis. 
At this point, the GNN uses just a single telescope for the reconstruction and reconstructs all values in relation to the telescope position. %, and the deployed telescopes can be kept separate for the composition analysis in the test dataset. 
Five of the MC datasets (neon is kept for testing only) are used for training and validation of the GNN, with 50$\%$ used for training and the remaining percentage split equally into a validation and test dataset. %Additionally, the neon Monte Carlo is used as an independent test dataset. 
% Figure environment removed
Input parameters into the GNN nodes are the height and time of the signal peak in a pixel, and the x position and y position of the pixel. The edges of the GNN are constructed in such a way that each pixel knows itself and its neighboring pixel. The GNN structure consists of two convolutional layers which are followed by a pooling layer and 4 dense layers. It reconstructs the following output variables: the cosmic ray primary energy \logEGeV{}, 
the position of the shower core 
(with respect to the position of the telescope, expressed as a distance and an angle), 
the track direction, 
%the distance between the shower core position and the telescope, cos($\theta$) and sin($\theta$), cos(zenith), cos(azimuth), sin(azimuth) 
and the slant depth of the shower maximum ($X_{max}$). 
%E is the energy of the primary particle. 
%$\theta$ is the angle between the x-axis and the shower core direction calculated from the position of the telescope. 
%To improve the training of the of the GNN the \logEGeV{}, the shower maximum, and the distance are normalized. 
To assist the GNN, some variables (the primary energy, the shower maximum, and the distance) are normalized to be centered on zero, by subtraction of the mean of the training data set, and dividing by the standard deviation. 
Additionally, angular variables (the core position angle, and track zenith and azimuth) are treated in cosine or sine form so as to avoid cyclical behavior and to be between -1 and 1.
Note that the GNN is constructed to reconstruct the total energy of the primary particle; the energy visible in the Cherenkov photons comes from just the electromagnetic part of the air shower. 

The resolution of the energy 
(as measured in \logEGeV) and shower maximum reconstruction are shown in Figure~\ref{Plt:GNNresolution}. Below 4.5, the statistic is low because the telescope is not yet sensitive to all nuclei. Above 6.0, the statistic is lower because the relative amount of simulated events is lower. Above 6.5, the energy reconstruction gets biased because there are no simulated events above 6.75, so the GNN tends to reconstruct lower energy because it seems more probable. On average the energy reconstruction between 4.5 and 6.5 has a small constant bias of about 5$\%$ and a resolution of about 50$\%$. 
%Because of this and the facts stated above 
Thus, this energy region has been chosen as the analysis range for the IceAct-only composition analysis. The resolution for the shower maximum reconstruction in this energy range has just a small constant bias of about 2$\%$ and is better than 20$\%$. The shower core position can be reconstructed within 50$\,$m, and the angular reconstruction is better than 1$^{\circ}$ for this energy region. This development stage of the GNN shows promising first results for reconstructing the air shower properties with possibilities for future improvements.% well enough to be used in a mass composition analysis.
%\section{Mass composition sensitive parameters}\label{secinput}
\section{Mass sensitive input parameters into to the Random Forest Regressors}\label{secinput}
% Figure environment removed

Two of the most important mass composition sensitive parameters in this analysis are the position of the shower maximum and the number of muons in the deep ice detector. The position of $X_{max}$ is directly reconstructed with the GNN. 
%The comparison between the shower maximum fitted to the true CORSIKA particle distribution at the top and the reconstructed value for the GNN at the bottom is shown in Figure \ref{Plt:RFinputGhmax}. 
%% Kath's attempt to rewrite:
Figure~\ref{Plt:RFinputGhmax} demonstrates the ability to distinguish masses using $X_{max}$: from the true value using the CORSIKA particle distributions, as if with an ideal detector (upper plot), and from the reconstructed value from the GNN (lower plot).
Overall the tendency of lighter nuclei to have a higher $X_{max}$ is reconstructed well. %As expected, the nuclei are less separable when GNN-reconstructed quantities are used instead of true values. 
As expected, detector resolution and reconstruction lessen the separability when GNN-reconstructed quantities are used instead of true values. The difference between the two plots shows how much room for improvement is possible for the input parameters into the composition analysis. 
The separability also gets visibly smaller above $10^6\,$GeV, probably because the number of events in that region is significantly lower and the GNN has less opportunity to train and validate on outliers.
% Figure environment removed

Additionally, the energy loss of the muons in the in-ice detector is used as a proxy for the number of high-energy muons in the air shower. 
Similar effects to the slant depth of the shower maximum can be seen for the separability of the true number of muons %($E_\mu$>300GeV) 
for each type of nucleus shown in Figure \ref{Plt:RFinputMuon}. The separability is greater for the true number of muons than the separability of the reconstructed deposited energy. The reconstruction of the deposited energy is also not fully efficient for the heavy nuclei for energies below $10^{5.2}\,$GeV, therefore, the composition analysis including IceAct and IceCube is restricted to energies between $10^{5.2}\,$GeV and $10^{6.5}\,$GeV.


%Additional composition sensitive parameters used in this analysis are the zenith angle of the incoming primary particle, the distance between the shower core and the telescope, the energy reconstructed with the telescope, and Cherenkov telescope specific parameters. The Cherenkov specific parameters are the length and width of an ellipse \cite{hillas} fitted to the image cleaned image of the air shower on the telescope camera and the total charge measured with the telescope called image size.  

\section{Mass composition analysis using Random Forest Regressors}\label{secrf}
% Figure environment removed
As a next step, RFs are used to turn these composition-sensitive observables -- together with additional observables from IceAct and/or IceCube -- into a cosmic ray mass estimator and to reconstruct the primary particle energy.  Two versions of this have been explored: one using IceAct observables alone, and one using IceAct observables together with IceCube observables.  Both RF's are provided with Cherenkov telescope specific parameters as inputs: the length and width of an ellipse \cite{hillas} fitted to the cleaned 
image of the air shower on the telescope camera%\footnote{after the image cleaning procedure described in Section 3}
, and the total charge measured with the telescope (called the "image size").  The IceAct-only RF is additionally provided the GNN-reconstructed $X_{max}$, the reconstructed zenith of the incoming primary particle, the distance between the shower core and the telescope, and energy reconstructed with the telescope.  The IceAct-IceCube RF is additionally provided the GNN-reconstructed distance between the shower core and the telescope, the energy reconstructed with the telescope and $X_{max}$, and with IceCube reconstructed cosine zenith of the incoming primary particle and muon energy loss.
Both RFs are trained on a data set containing proton, helium, nitrogen, aluminum, and iron primaries. The neon data set is used for testing the RF results. This work uses just the information obtained from one telescope; the extension to a two-telescope analysis is in preparation. The data set is split in two thirds for training and one third for testing. % All RF in this analysis will contain the Cherenkov telescope specific parameters image size and length and width of the ellipse. 
%Additionally, the IceAct  only the RF is trained on the GNN reconstructed distance to the shower core, the energy, slant depth of the shower maximum, and the cosine zenith. Besides the Cherenkov telescope specific parameters the RF trained on the IceAct and IceCube variables is trained on the GNN reconstructed distance to the shower core, the energy and slant depth of the shower maximum, and with IceCube reconstructed cosine zenith and muon energy loss. 
The performance of the RF containing IceAct and IceCube input parameters is shown in Figure~\ref{Plt:RFoutput}, for true (top) and reconstructed (bottom) input values. 
%%% This bit is redundant -- either elsewhere in text already, or also in the caption.
%The top plot shows the mass output of the RF analysis using the true values for the IceAct and IceCube response as input into the RF. The bottom mass output of the RF using reconstructed values for the IceAct and IceCube response as input into the RF. Plotted are the mean and standard deviation of the mass output for each nucleus. The lines show the true mass-output for proton in red and iron in blue. 
%The top plot shows an ideal analysis which can never be reached with a real detector response. 
%The correct behavior is reconstructed using measured observables, with the average proton (red) reconstructed lighter than the average iron nuclei (blue).
The correct behavior is kept using reconstruced observables, with the average proton (red) determined lighter than the average iron nuclei (blue). This is also true for the IceAct only mass composition analysis, which shows a slightly lower separability for the nuclei than the analysis that includes IceCube parameters. 

\section{Template analysis of mass fractions}\label{sec5}
The mass output is now used to determine the fraction of each nucleus which is present in a data set.
For the template analysis, the remaining data set from testing the RF is split into one third for creating templates that represent the standard output of the RF for each nuclei type and the remaining two thirds of the data for testing different hypotheses of fractions of mass composition. Here, an example composition hypothesis will be constructed to test the overall technique: a mixture in which the fractions of proton, nitrogen, and iron are twice the number of events than the number of events for the helium and aluminum nuclei.  Figure~\ref{Plt:fittedtemplates} shows 
how the template-fitting technique treats this example,
%the example of a fit for the different fractions 
for one energy slice. 
%\iffalse
% Figure environment removed
%\fi
\iffalse
% Figure environment removed
\fi
The fit is strictly required to reconstruct the correct number of total events and not less than zero events for any nucleus, which leads to asymmetric error bars. %Although not all fractions are reconstructed correctly, t
The fitted values agree within the errors with the true number of events used in this hypothesis.

\section{Summary and Outlook}\label{secsummary}
%IceAct is awesome.
Preparation of the data set for performing a mass composition analysis is ongoing and quality parameters to study the atmospheric conditions show promising prospects \cite{Author:2023icrcLars}. Both telescopes have been calibrated and the calibration is stable over the years of operation. %The average gain of the pixels has been found to be 7.2$\,$ADC counts per photon. 
The GNN reconstruction presented in this work yields resolutions that are a promising first step for future mass composition analyses.
%A newly simulated data set has been used to successfully train a GNN to reconstruct the air shower properties with the IceAct telescopes which are deployed at the South Pole. Within the region where the GNN is fully efficient, the GNN reconstructs the energy on average better than 50$\%$, the slant depth of the shower maximum better than 20$\%$, the distance between the telescope and the shower core maximum better than 50m, and the shower direction better than 1$^\circ$. 
More statistics for the higher energies can increase the reconstruction performance. 
%Far-away high energy showers are hard to distinguish from close-by low energy showers in a Cherenkov telescope since the number of detected photons is similar. 
Further improvement might also be achieved by optimizing the GNN parameters.
% used to train the GNN and 
%optimizing the layers and layer settings of the GNN. 

The RFs can successfully reconstruct the general trend of the mass output for a single telescope analysis for the presented simulated data set. %The general trend of mass distributions can be reconstructed. 
Improvements can be achieved by better reconstructed input parameters from the GNN into the RF and more simulated events, especially at high energies. Additionally, the RF settings have not yet been optimized. The template fit method will be used to determine the real fractions for each element group over the whole energy range. 
An example hypothesis has been reconstructed using template fitting. The results show room for improvement achievable by advances in the previous analysis steps. 

A simultaneous reconstruction of two telescopes with one GNN is also in preparation; this should help especially with the energy reconstruction and the reconstruction of the distance between the telescope and the shower core, which are the most difficult to reconstruct with a Cherenkov telescope alone. This should also improve RF analysis where a two-telescope expansion is also in preparation.
%Overall the additional information obtained by the IceAct telescopes shows promising results for low mass composition analysis performed with the IceCube detector.



% Bibtex references:
\bibliographystyle{ICRC}
\bibliography{references}

% Alternatively, you can include references by hand:
%\begin{thebibliography}{99}
%\bibitem{...}
%
%\end{thebibliography}

\clearpage

%The following list of authors, affiliations and funding agencies will be updated at the day of submission. The following template is a placeholder generated via https://authorlist.icecube.wisc.edu/icecube on March 25, 2023 and will be updated.
\input{authorlist_IceCube.tex}

\end{document}
