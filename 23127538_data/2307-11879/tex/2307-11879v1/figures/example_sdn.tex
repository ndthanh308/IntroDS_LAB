\begin{tikzpicture}
    %draw data-plane
    \node[server]                               (h1)    {};
    \node               at ([xshift=-1cm]h1)    (h1l)   {$h_1$};
    \node[l3 switch]    at ([xshift=2cm]h1)     (s1)    {};
    \node               at ([yshift=1cm]s1)     (s1l)   {$r_1$};
    \node[l3 switch]    at ([xshift=2cm]s1)     (s2)    {};
    \node               at ([yshift=1cm]s2)     (s2l)   {$r_2$};
    \node[server]       at ([xshift=2cm]s2)     (h2)    {};
    \node               at ([xshift=.7cm]h2)    (h2l)   {$h_2$};
    \node[l3 switch]    at ([yshift=-1.5cm]s1)  (s3)    {};
    \node               at ([yshift=-1cm]s3)    (s3l)   {$r_3$};
    \node[server]       at ([xshift=-2cm]s3)    (h3)    {};
    \node               at ([xshift=-1cm]h3)    (h3l)   {$h_3$};
    \node[l3 switch]    at ([xshift=2cm]s3)     (s4)    {};
    \node               at ([yshift=-1cm]s4)    (s4l)   {$r_4$};
    \node[server]       at ([xshift=2cm]s4)     (h4)    {};
    \node               at ([xshift=.7cm]h4)    (h4l)   {$h_4$};
        
    %connect hosts to switches
    \draw[thick] (h1)--(s1);
    \draw[thick] (h2)--(s2);
    \draw[thick] (h4)--(s4);
    \draw[thick] (h3)--(s3);
        
    %connect the switches with an "almost" mesh topology
    \draw[thick] (s1.east)--(s2.west);
    \draw[thick] (s3.east)--(s4.west);
    \draw[thick] (s1.south)--(s3.north);
    \draw[thick] (s2.south)--(s4.north);
    \draw[thick] (s2.south west)--(s3.north east);
        
    %draw a dashed box over the data-plane
    \node[rectangle,draw,dashed,fill=none,text height=3.5cm,text width=8cm, minimum width=8cm,minimum height=4cm] at ([xshift=.85cm, yshift=-.8cm]s1) (main)  {\textbf{Data-plane}};
        
    %draw some data paths
    %path 1, h1 s1 s2 h2
    \draw[-Latex,very thick, gray!80, shorten <=0.2cm,shorten >=0.2cm]([yshift=0.15cm,xshift=0.3cm]h1.east)-- ([yshift=0.15cm]s1.west);
    \draw[-Latex,very thick, gray!80, shorten <=0.1cm,shorten >=0.1cm]([yshift=0.15cm,xshift=0.1cm]s1.east)-- ([yshift=0.15cm]s2.west);
    \draw[-Latex,very thick, gray!80, shorten <=0.3cm,shorten >=0.7cm]([yshift=0.15cm]s2.east)-- ([yshift=0.15cm]h2.west);
        
    %path 2, h1 s1 s3 s2 h2
    \draw[-Latex, dashed, very thick, gray!80, shorten <=0.2cm,shorten >=0.2cm]([yshift=-0.15cm,xshift=0.3cm]h1.east)-- ([yshift=-0.15cm]s1.west);
    \draw[-Latex,dashed, very thick, gray!80, shorten <=0.1cm,shorten >=0.3cm]([yshift=-0.15cm, xshift=-0.15cm]s1.west)-- ([yshift=-0.15cm, xshift=-0.15cm]s3.west);
    \draw[-Latex,dashed, very thick, gray!80, shorten <=0.3cm,shorten >=0.1cm]([yshift=-0.15cm]s3.north east)-- ([yshift=-0.15cm]s2.south west);
    \draw[-Latex, dashed, very thick, gray!80, shorten <=0.3cm,shorten >=0.7cm]([yshift=0.15cm]s2.east)-- ([yshift=0.15cm]h2.west);

    %%draw the SDN controller
    \node[server]       at ([yshift=2cm,xshift=1cm]s1)     (ctrl)    {};
    \node               at ([xshift=-2cm]ctrl)  (ctrll)   {SDN controller};
        
    %connect all switches with the controller
    \draw[thick, dotted, gray] (s1.north)--(ctrl.south east);
    \draw[thick, dotted, gray] (s2.north)--(ctrl.south west);
    \draw[thick, dotted, gray] ([xshift=0.1cm]s3.north east)--(ctrl.south);
    \draw[thick, dotted, gray] (s4.north west)--(ctrl.south);
        
    %draw applications
    \node[rectangle,pattern=horizontal lines, minimum width=0.5cm, minimum height=1cm]    at([yshift=1.5cm, xshift=-2cm]ctrl)    (app1)  {};
    \node[] at ([xshift=-1cm]app1)    (app1l) {App. 1};
    \node[] at ([xshift=2cm]app1)   (dots)  {\huge\ldots};
    \node[rectangle,pattern=horizontal lines, minimum width=0.5cm, minimum height=1cm]    at([xshift=2cm]dots)    (app2)  {};
    \node[] at ([xshift=1cm]app2)    (app2l) {App. $N$};
        
    connect applications to ctrl 
    \draw[thick, dotted, gray] (app1.south)--(ctrl.north);
    \draw[thick, dotted, gray] (app2.south)--(ctrl.north);
\end{tikzpicture}
