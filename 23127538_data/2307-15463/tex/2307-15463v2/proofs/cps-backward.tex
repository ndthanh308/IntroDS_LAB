% depends on:: 
\begin{proof}
    By simultaneous induction on the structure of $v$ and $c$.
    \begin{enumit}
        \item
        \begin{description}
            \item[Case $v = x$:] We have $\cps{v} = x$.
            By Lemma \ref{lem:cps:inv}, we have \emph{either}
            \begin{enumerate}
                \item $\jdwf{}{\Gamma}$ and  $\jdsub{\Gamma}{\tyrfn{z}{B}{z = x}}{\tau}$
                    (if $\Gamma(x) = \tyrfn{z}{B}{\phi}$ for some $z, B$ and $\phi$)
                \item $\jdwf{}{\Gamma}$ and $\jdsub{\Gamma}{\Gamma(x)}{\tau}$ (otherwise)
            \end{enumerate}
            \begin{description}
                \item[Case 1:]
                    By Lemma \ref{lem:cps:presv-b-wf}, we have $\jdwf{}{\cpsinv{\Gamma}}$.
                    Also, since $\cps{\tyrfn{z}{B}{\phi'}} = \tyrfn{z}{B}{\phi'}$ for any $\phi'$, we have
                    \begin{itemize}
                        \item $\cpsinv{\Gamma}(x) = \tyrfn{z}{B}{\phi}$ and
                        \item $\jdsub{\Gamma}{\cps{\tyrfn{z}{B}{z = x}}}{\tau}$~.
                    \end{itemize}
                    Then, by \rulename{T-CVar}, we have $\jdty{\cpsinv{\Gamma}}{x}{\tyrfn{z}{B}{z = x}}$.
                    Now we have the conclusion with $T = \tyrfn{z}{B}{z = x}$.
                \item[Case 2:]
                    By Lemma \ref{lem:cps:presv-b-wf}, we have $\jdwf{}{\cpsinv{\Gamma}}$.
                    Then, since
                    $\Gamma(x) = \rmtv(\Gamma)(x) = \cps{\cpsinv{\Gamma}}(x) = \cps{\cpsinv{\Gamma}(x)}$
                    holds by Lemma \ref{lem:cps:cpswf-rmtv},
                    we have $\jdsub{\Gamma}{\cps{\cpsinv{\Gamma}(x)}}{\tau}$.
                    Also, by \rulename{T-Var}, we have $\jdty{\cpsinv{\Gamma}}{x}{\cpsinv{\Gamma}(x)}$.
                    Now we have the conclusion with $T = \cpsinv{\Gamma}(x)$.
            \end{description}
            \item[Case $v = p$:] We have $\cps{v} = \mathit{cps}(p)$.
                By Lemma \ref{lem:cps:inv}, we have
                \begin{itemize}
                    \item $\jdwf{}{\Gamma}$ and
                    \item $\jdsub{\Gamma}{\tycps(\cps{p})}{\tau}$.
                \end{itemize}
                By Lemma \ref{lem:cps:presv-b-wf}, we have $\jdwf{}{\cpsinv{\Gamma}}$.
                Then, by \rulename{T-Prim}, we have $\jdty{\cpsinv{\Gamma}}{p}{\ty(p)}$.
                Also, by Assumption \ref{asm:cps:prim-cps},
                we have $\jdsub{\Gamma}{\cps{\ty(p)}}{\tau}$.
                Now we have the conclusion with $T = \ty(p)$.
            \item[Case $v = \exprec{f^{(x:T_1) \rarr C_1}}{x^{T_2}}{c}$:]
                We have $\cps{v} = \exprec{f:(x:\cps{T_1}) \rarr \cps{C_1}}{x:\cps{T_2}}{\cps{c}}$.
                By Lemma \ref{lem:cps:inv}, we have
                \begin{itemize}
                    \item $\jdty{\Gamma, f:(x:\cps{T_1}) \rarr \cps{C_1}, x: \cps{T_1}}{\cps{c}}{\cps{C_1}}$ and
                    \item $\jdsub{\Gamma}{(x:\cps{T_1}) \rarr \cps{C_1}}{\tau}$~.
                \end{itemize}
                By the IH, we have
                \begin{itemize}
                    \item $\jdty{\cpsinv{\Gamma}, f:(x:T_1) \rarr C_1, x: T_1}{c}{C_1'}$ and
                    \item $\jdsub{\Gamma, f:(x:\cps{T_1}) \rarr \cps{C_1}, x: \cps{T_1}}{\cps{C_1'}}{\cps{C_1}}$
                \end{itemize}
                for some $C_1'$.
                By Lemma \ref{lem:cps:cpsinv-sub}, we have
                \[
                    \jdsub{\cpsinv{\Gamma}, f:(x:T_1) \rarr C_1, x: T_1}{C_1'}{C_1}~.
                \]
                Then, by \rulename{T-CSub} and \rulename{T-Fun}, we have
                \[
                    \jdty{\Gamma}{\exprec{f^{(x:T_1) \rarr C_1}}{x^{T_2}}{c}}{(x:T_1) \rarr C_1}~.
                \]
                Now we have the conclusion with $T = (x:T_1) \rarr C_1$.
        \end{description}
        \item
        \begin{description}
            \item[Case $c = \expret{v^T}$:]
                We have $\cps{c} = \Lambda \alpha. \lambda h:\{\}. \lambda k:\cps{T} \rarr \alpha. k~\cps{v}$~.
                By Lemma \ref{lem:cps:inv-c}, we have
                \begin{itemize}
                    \item $\jdty{\Gamma, \alpha, h:\{\}, k:\cps{T} \rarr \alpha}{k~\cps{v}}{\tau'}$ and
                    \item $\jdsub{\Gamma}{\forall \alpha. \{\} \rarr (\cps{T} \rarr \alpha) \rarr \tau'}{\tau}$
                \end{itemize}
                for some $\tau'$.
                By Lemma \ref{lem:cps:inv}, we have
                \begin{itemize}
                    \item $\jdty{\Gamma, \alpha, h:\{\}, k:\cps{T} \rarr \alpha}{k}{(y:\tau_1) \rarr \tau_2}$,
                    \item $\jdty{\Gamma, \alpha, h:\{\}, k:\cps{T} \rarr \alpha}{\cps{v}}{\tau_1}$, and
                    \item $\jdsub{\Gamma, \alpha, h:\{\}, k:\cps{T} \rarr \alpha}{\tau_2[\cps{v}/y]}{\tau'}$
                \end{itemize}
                for some $y, \tau_1$, and $\tau_2$.
                By Lemma \ref{lem:cps:rm-nonrfn}, we have
                \begin{itemize}
                    \item $\jdty{\Gamma, \alpha}{\cps{v}}{\tau_1}$~.
                \end{itemize}
                Then, by the IH, we have
                \begin{itemize}
                    \item $\jdty{\cpsinv{\Gamma}}{v}{T}$ and
                    \item $\jdsub{\Gamma}{\cps{T}}{\tau_1}$~.
                \end{itemize}
                Therefore, by \rulename{T-Ret}, we have
                \begin{itemize}
                    \item $\jdty{\cpsinv{\Gamma}}{\expret{v}}{\tycomp{\{\}}{T}{\square}}$~.
                \end{itemize}
                On the other hand, by Lemma \ref{lem:cps:inv}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma, \alpha, h:\{\}, k:\cps{T} \rarr \alpha}{\cps{T} \rarr \alpha}{(y:\tau_1) \rarr \tau_2}$~.
                \end{itemize}
                Then, By inversion, we have $\tau_2 = \alpha$.
                By inversion again, we have $\tau' = \alpha$.
                Therefore, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma}{\forall \alpha. \{\} \rarr (\cps{T} \rarr \alpha) \rarr \alpha}{\tau}$,
                \end{itemize}
                that is,
                \begin{itemize}
                    \item $\jdsub{\Gamma}{\cps{\tycomp{\{\}}{T}{\square}}}{\tau}$~.
                \end{itemize}
                Now we have the conclusion with $C = \tycomp{\{\}}{T}{\square}$.
            \item[Case $c = \explet{x}{c_1^{\tycomp{\Sigma}{T_1}{\square}}}{c_2^{\tycomp{\Sigma}{T_2}{\square}}}$:]
                \def\currentprefix{cps-bw:let-pure}
                We have $\cps{c} = \Lambda \alpha. \lambda h: \cps{\Sigma}. \lambda k:\cps{T_2} \rarr \alpha.
                \cps{c_1}~\alpha~h~(\lambda x:\cps{T_1}. \cps{c_2}~\alpha~h~k)$~.
                By Lemma \ref{lem:cps:inv-c}, we have
                \begin{enumrm}
                    \item\llabel{ty-body} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha}
                        {\cps{c_1}~\alpha~h~(\lambda x:\cps{T_1}. \cps{c_2}~\alpha~h~k)}{\tau'}$ and
                    \item\llabel{sub-t} $\jdsub{\Gamma}{\forall \alpha. \cps{\Sigma} \rarr (\cps{T_2} \rarr \alpha) \rarr \tau'}{\tau}$
                \end{enumrm}
                for some $\tau'$.
                By Lemma \ref{lem:cps:inv-c-app} with \lref{ty-body}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-cpsc1} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha}
                        {\cps{c_1}}{\tau''}$,
                    \item\llabel{ty-h} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha}{h}{\tau_1}$, and
                    \item\llabel{ty-fun} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha}
                        {\lambda x:\cps{T_1}. \cps{c_2}~\alpha~h~k}{\tau_2}$
                \end{enumrm}
                for some $\tau'', \tau_1$ and $\tau_2$.
                By Lemma \ref{lem:cps:inv} with \lref{ty-h} and \lref{ty-fun} respectively, we have
                \begin{enumrm}[resume]
                    \item $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha}{\cps{\Sigma}}{\tau_1}$,
                    \item\llabel{ty-body-2} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha, x:\cps{T_1}}
                        {\cps{c_2}~\alpha~h~k}{\tau_3}$, and
                    \item $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha}
                        {(x:\cps{T_1}) \rarr \tau_3}{\tau_2}$
                \end{enumrm}
                for some $\tau_3$.
                Then, by the second half of Lemma \ref{lem:cps:inv-c-app}, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-t''} $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha}
                        {\tau''}{\forall \beta. \cps{\Sigma} \rarr ((x:\cps{T_1}) \rarr \tau_3) \rarr \tau'}$
                \end{enumrm}
                where $\beta$ is fresh.

                On the other hand, by Lemma \ref{lem:cps:inv-c-app} with \lref{ty-body-2}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-cpsc2} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha, x:\cps{T_1}}
                        {\cps{c_2}}{\tau_3'}$,
                    \item\llabel{ty-h-2} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha, x:\cps{T_1}}
                        {h}{\tau_4}$, and
                    \item\llabel{ty-k} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha, x:\cps{T_1}}
                        {k}{\tau_5}$
                \end{enumrm}
                for some $\tau_3', \tau_4$ and $\tau_5$.
                By Lemma \ref{lem:cps:inv} with \lref{ty-h-2} and \lref{ty-k} respectively, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha, x:\cps{T_1}}
                        {\cps{\Sigma}}{\tau_4}$ and
                    \item $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha, x:\cps{T_1}}
                        {\cps{T_2} \rarr \alpha}{\tau_5}$~.
                \end{itemize}
                Then, by the second half of Lemma \ref{lem:cps:inv-c-app}, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-t3'} $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, k:\cps{T_2} \rarr \alpha, x:\cps{T_1}}
                        {\tau_3'}{\forall \gamma. \cps{\Sigma} \rarr (\cps{T_2} \rarr \alpha) \rarr \tau_3}$
                \end{enumrm}
                where $\gamma$ is fresh.

                By Lemma \ref{lem:cps:rm-nonrfn}
                with \lref{ty-cpsc1}, \lref{sub-t''}, \lref{ty-cpsc2} and \lref{sub-t3'}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-cpsc1-2} $\jdty{\Gamma, \alpha}{\cps{c_1}}{\tau''}$,
                    \item\llabel{sub-t''-2} $\jdsub{\Gamma, \alpha}
                        {\tau''}{\forall \beta. \cps{\Sigma} \rarr ((x:\cps{T_1}) \rarr \tau_3) \rarr \tau'}$
                    \item\llabel{ty-cpsc2-2} $\jdty{\Gamma, \alpha, x:\cps{T_1}}{\cps{c_2}}{\tau_3'}$
                    \item\llabel{sub-t3'-2} $\jdsub{\Gamma, \alpha, x:\cps{T_1}}
                        {\tau_3'}{\forall \gamma. \cps{\Sigma} \rarr (\cps{T_2} \rarr \alpha) \rarr \tau_3}$~.
                \end{enumrm}
                Then, by the IHs of \lref{ty-cpsc1-2} and \lref{ty-cpsc2-2} respectively, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-c1} $\jdty{\cpsinv{\Gamma}}{c_1}{C_1}$,
                    \item\llabel{sub-cpsC1} $\jdsub{\Gamma, \alpha}{\cps{C_1}}{\tau''}$,
                    \item\llabel{ty-c2} $\jdty{\cpsinv{\Gamma}, x:T_1}{c_2}{C_2}$, and
                    \item\llabel{sub-cpsC2} $\jdsub{\Gamma, \alpha, x:\cps{T_1}}{\cps{C_2}}{\tau_3'}$
                \end{enumrm}
                for some $C_1$ and $C_2$.
                By Lemma \ref{lem:cps:trans} with ``\lref{sub-t''-2} and \lref{sub-cpsC1}''
                and ``\lref{sub-t3'-2} and \lref{sub-cpsC2}'' respectively, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-cpsC1-2} $\jdsub{\Gamma, \alpha}
                        {\cps{C_1}}{\forall \beta. \cps{\Sigma} \rarr ((x:\cps{T_1}) \rarr \tau_3) \rarr \tau'}$ and
                    \item\llabel{sub-cpsC2-2} $\jdsub{\Gamma, \alpha, x:\cps{T_1}}
                        {\cps{C_2}}{\forall \gamma. \cps{\Sigma} \rarr (\cps{T_2} \rarr \alpha) \rarr \tau_3}$~.
                \end{enumrm}
                By Lemma \ref{lem:cps:sub-pure} with \lref{sub-cpsC2-2}, we have
                \begin{itemize}
                    \item $C_1 = \tycomp{\Sigma_{11}}{T_{11}}{\square}$ and
                    \item $\tau_3 = \alpha$
                \end{itemize}
                for some $\Sigma_{11}$ and $T_{11}$.
                Then, by Lemma \ref{lem:cps:sub-pure} again with \lref{sub-cpsC1-2}, we have
                \begin{itemize}
                    \item $C_2 = \tycomp{\Sigma_{22}}{T_{22}}{\square}$ and
                    \item $\tau' = \alpha$
                \end{itemize}
                for some $\Sigma_{22}$ and $T_{22}$.
                By inversion of \lref{sub-cpsC1-2}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma, \alpha, \beta}{\cps{\Sigma}}{\cps{\Sigma_{11}}}$ and
                    \item $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, \beta}{\cps{T_{11}}}{\cps{T_1}}$~.
                \end{itemize}
                By Lemma \ref{lem:cps:rm-nonrfn}, \ref{lem:cps:rm-unused-tvar} and \ref{lem:cps:cpsinv-sub}, we have
                \begin{itemize}
                    \item $\jdsub{\cpsinv{\Gamma}}{\Sigma}{\Sigma_{11}}$ and
                    \item $\jdsub{\cpsinv{\Gamma}}{T_{11}}{T_1}$~.
                \end{itemize}
                Then, by subsumption on \lref{ty-c1}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-c1-2} $\jdty{\cpsinv{\Gamma}}{c_1}{\tycomp{\Sigma}{T_1}{\square}}$~.
                \end{enumrm}
                In the same way, from \lref{sub-cpsC2-2}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-c2-2} $\jdty{\cpsinv{\Gamma}, x:T_1}{c_2}{\tycomp{\Sigma}{T_2}{\square}}$~.
                \end{enumrm}
                Therefore, by \rulename{T-LetP} with \lref{ty-c1-2} and \lref{ty-c2-2}, we have
                \[
                    \jdty{\cpsinv{\Gamma}}{\explet{x}{c_1}{c_2}}{\tycomp{\Sigma}{T_2}{\square}}~.
                \]
                Also, since $\tau' = \alpha$, \lref{sub-t} implies
                \[
                    \jdsub{\Gamma}{\cps{\tycomp{\Sigma}{T_2}{\square}}}{\tau}~.
                \]
                Now we have the conclusion with $C = \tycomp{\Sigma}{T_2}{\square}$.
            \item[Case $c = \explet{x}{c_1^{\tycomp{\Sigma}{T_1}{\tyctl{x}{C_1}{C_2}}}}{c_2^{\tycomp{\Sigma}{T_2}{\tyctl{z}{C_0}{C_1}}}}$:]
                \def\currentprefix{cps-bw:let}
                We have $\cps{c} = \Lambda \alpha. \lambda h: \cps{\Sigma}. \lambda k:(z:\cps{T_2}) \rarr \cps{C_0}.
                    \cps{c_1}~\cps{C_2}~h~(\lambda x:\cps{T_1}. \cps{c_2}~\cps{C_1}~h~k)$~.
                In the similar way to the previous case, we have
                \begin{enumrm}
                    \item\llabel{sub-t} $\jdsub{\Gamma}
                        {\forall \alpha. \cps{\Sigma} \rarr ((z:\cps{T_2}) \rarr \cps{C_0}) \rarr \tau'}{\tau}$,
                    \item\llabel{ty-c1} $\jdty{\cpsinv{\Gamma}}{c_1}{C_1}$,
                    \item\llabel{sub-cpsC1} $\jdsub{\Gamma, \alpha}{\cps{C_1}}
                        {\forall \beta. \cps{\Sigma} \rarr ((x:\cps{T_1}) \rarr \tau_3) \rarr \tau'}$,
                    \item\llabel{ty-c2} $\jdty{\cpsinv{\Gamma}, x:T_1}{c_2}{C_2}$, and
                    \item\llabel{sub-cpsC2} $\jdsub{\Gamma, \alpha, x:\cps{T_1}}{\cps{C_2}}
                        {\forall \gamma. \cps{\Sigma} \rarr ((z:\cps{T_2}) \rarr \cps{C_0}) \rarr \tau_3}$
                \end{enumrm}
                for some $\tau', \tau_3, C_1$ and $C_2$.
                By Lemma \ref{lem:assume-atm}, we can assume that
                \begin{itemize}
                    \item $C_1 = \tycomp{\Sigma_1}{T_{10}}{\tyctl{x_1}{C_{11}}{C_{12}}}$ and
                    \item $C_2 = \tycomp{\Sigma_2}{T_{20}}{\tyctl{x_2}{C_{21}}{C_{22}}}$
                \end{itemize}
                for some $\Sigma_1, T_{10}, x_1, C_{11}, C_{12}, \Sigma_2, T_{20}, x_2, C_{21}$ and $C_{22}$.
                Then, by inversion of \lref{sub-cpsC1}, we have
                \begin{enumrm}[resume]
                    \item $x_1 = x$
                    \item\llabel{sub-cpssig} $\jdsub{\Gamma, \alpha, \beta}{\cps{\Sigma}}{\cps{\Sigma_1}}$,
                    \item\llabel{sub-cpsT10} $\jdsub{\Gamma, \alpha, \beta, h:\cps{\Sigma}}
                        {\cps{T_{10}}}{\cps{T_1}}$,
                    \item\llabel{sub-t3} $\jdsub{\Gamma, \alpha, \beta, h:\cps{\Sigma}, x:\cps{T_{10}}}
                        {\tau_3}{\cps{C_{11}}}$, and
                    \item\llabel{sub-cpsC12} $\jdsub{\Gamma, \alpha, \beta, h:\cps{\Sigma}, k:(x:\cps{T_1}) \rarr \tau_3}
                        {\cps{C_{12}}}{\tau'}$~.
                \end{enumrm}
                By Lemma \ref{lem:cps:rm-nonrfn}, \ref{lem:cps:rm-unused-tvar} and \ref{lem:cps:cpsinv-sub}
                with \lref{sub-cpssig} and \lref{sub-cpsT10} respectively, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-sig} $\jdsub{\cpsinv{\Gamma}}{\Sigma}{\Sigma_1}$ and
                    \item\llabel{sub-T10} $\jdsub{\cpsinv{\Gamma}}{T_{10}}{T_1}$~.
                \end{enumrm}
                By subsumption on \lref{ty-c1} with \lref{sub-sig}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-c1-2} $\jdty{\cpsinv{\Gamma}}{c_1}{\tycomp{\Sigma}{T_{10}}{\tyctl{x_1}{C_{11}}{C_{12}}}}$~.
                \end{enumrm}
                On the other hand, by inversion of \lref{sub-cpsC2}, we have
                \begin{itemize}
                    \item $x_2 = z$
                    \item $\jdsub{\Gamma, \alpha, x: \cps{T_1}, \gamma}
                        {\cps{\Sigma}}{\cps{\Sigma_2}}$,
                    \item $\jdsub{\Gamma, \alpha, x: \cps{T_1}, \gamma, h:\cps{\Sigma}}
                        {\cps{T_{20}}}{\cps{T_2}}$,
                    \item $\jdsub{\Gamma, \alpha, x: \cps{T_1}, \gamma, h:\cps{\Sigma}, z:\cps{T_{20}}}
                        {\cps{C_0}}{\cps{C_{21}}}$, and
                    \item $\jdsub{\Gamma, \alpha, x: \cps{T_1}, \gamma, h:\cps{\Sigma}, k:(z:\cps{T_2}) \rarr \cps{C_0}}
                        {\cps{C_{22}}}{\tau_3}$~.
                \end{itemize}
                By Lemma \ref{lem:cps:narrow} with \lref{sub-cpsT10}, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-cpssig-2} $\jdsub{\Gamma, \alpha, x: \cps{T_{10}}, \gamma}
                        {\cps{\Sigma}}{\cps{\Sigma_2}}$,
                    \item\llabel{sub-cpsT20} $\jdsub{\Gamma, \alpha, x: \cps{T_{10}}, \gamma, h:\cps{\Sigma}}
                        {\cps{T_{20}}}{\cps{T_2}}$,
                    \item\llabel{sub-cpsC0} $\jdsub{\Gamma, \alpha, x: \cps{T_{10}}, \gamma, h:\cps{\Sigma}, z:\cps{T_{20}}}
                        {\cps{C_0}}{\cps{C_{21}}}$, and
                    \item\llabel{sub-cpsC22} $\jdsub{\Gamma, \alpha, x: \cps{T_{10}}, \gamma, h:\cps{\Sigma}, k:(z:\cps{T_2}) \rarr \cps{C_0}}
                        {\cps{C_{22}}}{\tau_3}$~.
                \end{enumrm}
                By Lemma \ref{lem:cps:rm-nonrfn}, \ref{lem:cps:rm-unused-tvar} and \ref{lem:cps:trans}
                with \lref{sub-t3} and \lref{sub-cpsC22}, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-cpsC22-2} $\jdsub{\Gamma, \alpha, x: \cps{T_{10}}}{\cps{C_{22}}}{\cps{C_{11}}}$~.
                \end{enumrm}
                By Lemma \ref{lem:cps:rm-nonrfn}, \ref{lem:cps:rm-unused-tvar} and \ref{lem:cps:cpsinv-sub}
                with \lref{sub-cpssig-2}, \lref{sub-cpsT20}, \lref{sub-cpsC0} and \lref{sub-cpsC22-2},
                we have
                \begin{itemize}
                    \item $\jdsub{\cpsinv{\Gamma}, x: T_{10}}{\Sigma}{\Sigma_2}$,
                    \item $\jdsub{\cpsinv{\Gamma}, x: T_{10}}{T_{20}}{T_2}$,
                    \item $\jdsub{\cpsinv{\Gamma}, x: T_{10}, z:T_{20}}{C_0}{C_{21}}$, and
                    \item $\jdsub{\cpsinv{\Gamma}, x: T_{10}}{C_{22}}{C_{11}}$~.
                \end{itemize}
                Then, by Lemma \ref{lem:cps:narrow} and subsumption on \lref{ty-c2}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-c2-2} $\jdty{\cpsinv{\Gamma}, x:T_{10}}{c_2}
                        {\tycomp{\Sigma}{T_2}{\tyctl{z}{C_0}{C_{11}}}}$~.
                \end{enumrm}
                Therefore, by \rulename{T-LetIp}, we have
                \[
                    \jdty{\cpsinv{\Gamma}}{\explet{x}{c_1}{c_2}}{\tycomp{\Sigma}{T_2}{\tyctl{z}{C_0}{C_{12}}}}~.
                \]

                Also, by Lemma \ref{lem:cps:rm-nonrfn}, \ref{lem:cps:rm-unused-tvar}, \ref{lem:cps:weaken}, and \ref{lem:cps:trans}
                with \lref{sub-t} and \lref{sub-cpsC12}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma}
                    {\forall \alpha. \cps{\Sigma} \rarr ((z:\cps{T_2}) \rarr \cps{C_0}) \rarr \cps{C_{12}}}{\tau}$,
                \end{itemize}
                that is,
                \[
                    \jdsub{\Gamma}
                    {\cps{\tycomp{\Sigma}{T_2}{\tyctl{z}{C_0}{C_{12}}}}}{\tau}~.
                \]
                Now we have the conclusion with $C = \tycomp{\Sigma}{T_2}{\tyctl{z}{C_0}{C_{12}}}$~.
            \item[Case $c = v_1~v_2$:]
                We have $\cps{c} = \cps{v_1}~\cps{v_2}$~.
                By Lemma \ref{lem:cps:inv}, we have
                \begin{itemize}
                    \item $\jdty{\Gamma}{\cps{v_1}}{(x: \tau_1) \rarr \tau_2}$,
                    \item $\jdty{\Gamma}{\cps{v_2}}{\tau_1}$, and
                    \item $\jdsub{\Gamma}{\tau_2[\cps{v_2}/x]}{\tau}$
                \end{itemize}
                for some $x, \tau_1$ and $\tau_2$.
                By the IHs, we have
                \begin{itemize}
                    \item $\jdty{\cpsinv{\Gamma}}{v_1}{T_1}$,
                    \item $\jdty{\cpsinv{\Gamma}}{v_2}{T_2}$,
                    \item $\jdsub{\Gamma}{\cps{T_1}}{(x: \tau_1) \rarr \tau_2}$, and
                    \item $\jdsub{\Gamma}{\cps{T_2}}{\tau_1}$
                \end{itemize}
                for some $T_1$ and $T_2$.
                By inversion, we have
                \begin{itemize}
                    \item $T_1 = (x: T_{11}) \rarr C_{12}$,
                    \item $\jdsub{\Gamma}{\tau_1}{\cps{T_{11}}}$, and
                    \item $\jdsub{\Gamma, x: \tau_1}{\cps{C_{12}}}{\tau_2}$
                \end{itemize}
                for some $T_{11}$ and $C_{12}$.
                By Lemma \ref{lem:cps:trans}, we have $\jdsub{\Gamma}{\cps{T_2}}{\cps{T_{11}}}$~.
                Then, by Lemma \ref{lem:cps:cpsinv-sub},
                we have $\jdsub{\cpsinv{\Gamma}}{T_2}{T_{11}}$,
                and hence by \rulename{T-VSub} we have $\jdty{\cpsinv{\Gamma}}{v_2}{T_{11}}$~.
                Therefore, by \rulename{T-App},
                we have $\jdty{\cpsinv{\Gamma}}{v_1~v2}{C_{12}[v_2/x]}$~.
                
                On the other hand, by Lemma \ref{lem:cps:subst},
                we have $\jdsub{\Gamma}{\cps{C_{12}}[\cps{v_2}/x]}{\tau_2[\cps{v_2}/x]}$~.
                Then, by Lemma \ref{lem:cps:trans},
                we have $\jdsub{\Gamma}{\cps{C_{12}}[\cps{v_2}/x]}{\tau}$~.

                Now we have the conclusion with $C = C_{12}[v_2/x]$~.
            \item[Case $c = (\expif{v}{c_1}{c_2})^{C'}$:]
                We have $\cps{c} = (\expif{\cps{v}}{\cps{c_1}}{\cps{c_2}} : \cps{C'})$~.
                By Lemma \ref{lem:cps:inv}, we have
                \begin{itemize}
                    \item $\jdty{\Gamma}{\expif{\cps{v}}{\cps{c_1}}{\cps{c_2}}}{\cps{C'}}$ and
                    \item $\jdsub{\Gamma}{\cps{C'}}{\tau}$~.
                \end{itemize}
                By Lemma \ref{lem:cps:inv} again, we have
                \begin{itemize}
                    \item $\jdty{\Gamma}{\cps{v}}{\tyrfn{z}{\tybool}{\phi}}$,
                    \item $\jdty{\Gamma, \cps{v} = \exptrue}{\cps{c_1}}{\tau'}$,
                    \item $\jdty{\Gamma, \cps{v} = \expfalse}{\cps{c_2}}{\tau'}$, and
                    \item $\jdsub{\Gamma}{\tau'}{\cps{C'}}$
                \end{itemize}
                for some $z, \phi$ and $\tau'$.
                By the IHs, we have
                \begin{itemize}
                    \item $\jdty{\cpsinv{\Gamma}}{v}{\tyrfn{z}{\tybool}{\phi}}$,
                    \item $\jdty{\cpsinv{\Gamma}, v = \exptrue}{c_1}{C_1}$,
                    \item $\jdty{\cpsinv{\Gamma}, v = \expfalse}{c_2}{C_2}$,
                    \item $\jdsub{\Gamma, \cps{v} = \exptrue}{\cps{C_1}}{\tau'}$, and
                    \item $\jdsub{\Gamma, \cps{v} = \expfalse}{\cps{C_2}}{\tau'}$
                \end{itemize}
                for some $C_1$ and $C_2$.
                (Note that since $v$ is of a refinement type, it holds that $\cps{v} = v$.)
                By Lemma \ref{lem:cps:weaken} and \ref{lem:cps:trans}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma, \cps{v} = \exptrue}{\cps{C_1}}{\cps{C'}}$ and
                    \item $\jdsub{\Gamma, \cps{v} = \expfalse}{\cps{C_2}}{\cps{C'}}$~.
                \end{itemize}
                By Lemma \ref{lem:cps:cpsinv-sub}, we have
                \begin{itemize}
                    \item $\jdsub{\cpsinv{\Gamma}, v = \exptrue}{C_1}{C'}$ and
                    \item $\jdsub{\cpsinv{\Gamma}, v = \expfalse}{C_2}{C'}$~.
                \end{itemize}
                Then, by \rulename{T-CSub}, we have
                \begin{itemize}
                    \item $\jdty{\cpsinv{\Gamma}, v = \exptrue}{c_1}{C'}$ and
                    \item $\jdty{\cpsinv{\Gamma}, v = \expfalse}{c_2}{C'}$~.
                \end{itemize}
                Therefore by \rulename{T-If}, we have
                $\jdty{\cpsinv{\Gamma}}{\expif{v}{c_1}{c_2}}{C'}$~.
                Now we have the conclusion with $C = C'$~.
            \item[Case $c = (\op^{\rep{\mathit{A}}}~v)^{\tycomp{\Sigma}{T}{\tyctl{y}{C_1}{C_2}}}$:]
                \def\currentprefix{cpsbw:op}
                We have $\cps{c} = \Lambda \alpha. \lambda h:\cps{\Sigma}. \lambda k:(y: \cps{T}) \rarr \cps{C_1}.
                    h\#\op~\rep{A}~\cps{v}~(\lambda y':\cps{T}. k~y')$~.
                By Lemma \ref{lem:cps:inv-c}, we have
                \begin{enumrm}
                    \item\llabel{ty-body} $\jdty{\Gamma, \alpha, h:\cps{\Sigma}, k:(y: \cps{T}) \rarr \cps{C_1}}
                        {h\#\op~\rep{A}~\cps{v}~(\lambda y':\cps{T}. k~y')}{\tau'}$ and
                    \item\llabel{sub-t} $\jdsub{\Gamma}{\forall \alpha. \cps{\Sigma} \rarr ((y: \cps{T}) \rarr \cps{C_1}) \rarr \tau'}{\tau}$
                \end{enumrm}
                for some $\tau'$.
                (Below, we write $\Gamma_{\alpha,h,k}$ for $\Gamma, \alpha, h:\cps{\Sigma}, k:(y: \cps{T}) \rarr \cps{C_1}$~.)

                By Lemma \ref{lem:cps:inv} with \lref{ty-body}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-fun} $\jdty{\Gamma_{\alpha,h,k}}{\lambda y':\cps{T}. k~y'}{\tau_1}$,
                    \item\llabel{ty-cpsv} $\jdty{\Gamma_{\alpha,h,k}}{\cps{v}}{\tau_3}$,
                    \item\llabel{wf-A} $\rep{\jdty{\Gamma_{\alpha,h,k}}{A}{\rep{B}}}$,
                    \item\llabel{sub-cpssig} $\jdsub{\Gamma_{\alpha,h,k}}{\cps{\Sigma}}{\{\ldots, \forall \rep{X:\rep{B}}. \tau_5, \ldots\}}$,
                    \item\llabel{sub-t5} $\jdsub{\Gamma_{\alpha,h,k}}{\tau_5[\rep{A/X}]}{(x: \tau_3) \rarr \tau_4}$,
                    \item\llabel{sub-t4} $\jdsub{\Gamma_{\alpha,h,k}}{\tau_4[\cps{v}/x]}{\tau_1 \rarr \tau_2}$, and
                    \item\llabel{sub-t2} $\jdsub{\Gamma_{\alpha,h,k}}{\tau_2}{\tau'}$~.
                \end{enumrm}
                By Assumption \ref{asm:cps:formula} and \ref{asm:cps:formula-cpsinv} with \lref{wf-A}, we have
                \begin{itemize}
                    \item $\rep{\jdty{\cpsinv{\Gamma}}{A}{\rep{B}}}$~.
                \end{itemize}

                By inversion of \lref{sub-cpssig}, we have
                \begin{itemize}
                    \item $\Sigma = \{\ldots, \op: \forall \rep{X:\rep{B}}.
                        (x_{\op}: T_{\op 1}) \rarr ((y_{\op}: T_{\op 2}) \rarr C_{\op 1}) \rarr C_{\op 2}, \ldots\}$ and
                    \item $\jdsub{\Gamma_{\alpha,h,k}, \rep{X:\rep{B}}}
                        {(x_{\op}: \cps{T_{\op 1}}) \rarr ((y_{\op}: \cps{T_{\op 2}}) \rarr \cps{C_{\op 1}}) \rarr \cps{C_{\op 2}}}{\tau_5}$~.
                \end{itemize}
                By repeatedly inverting this subtyping judgment
                with applying Lemma \ref{lem:cps:subst-pred} with \lref{wf-A},
                Lemma \ref{lem:cps:subst} with \lref{ty-cpsv},
                and Lemma \ref{lem:cps:trans} with \lref{sub-t5}, \lref{sub-t4} and \lref{sub-t2},
                we have
                \begin{enumrm}[resume]
                    \item $x = x_{\op}$,
                    \item\llabel{sub-t3} $\jdsub{\Gamma_{\alpha,h,k}}{\tau_3}{\cps{T_{\op 1}}[\rep{A/X}]}$,
                    \item\llabel{sub-t1} $\jdsub{\Gamma_{\alpha,h,k}}
                        {\tau_1}{(y_{\op}:\cps{T_{\op 2}}[\rep{A/X}][\cps{v}/x]) \rarr \cps{C_{\op 1}}[\rep{A/X}][\cps{v}/x]}$, and
                    \item\llabel{sub-cpsCop2} $\jdsub{\Gamma_{\alpha,h,k}}
                        {\cps{C_{\op 2}}[\rep{A/X}][\cps{v}/x]}{\tau'}$~.
                \end{enumrm}

                By Lemma \ref{lem:cps:rm-nonrfn} with \lref{ty-cpsv}, we have
                \begin{itemize}
                    \item $\jdty{\Gamma, \alpha}{\cps{v}}{\tau_3}$~.
                \end{itemize}
                Then, by the IH, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-v} $\jdty{\cpsinv{\Gamma}}{v}{T_v}$ and
                    \item\llabel{sub-cpsTv} $\jdsub{\Gamma, \alpha}{\cps{T_v}}{\tau_3}$
                \end{enumrm}
                for some $T_v$.
                By Lemma \ref{lem:cps:trans} with \lref{sub-t3} and \lref{sub-cpsTv}
                (using Lemma \ref{lem:cps:rm-nonrfn}), we have
                \begin{itemize}
                    \item $\jdsub{\Gamma, \alpha}{\cps{T_v}}{\cps{T_{\op 1}}[\rep{A/X}]}$~.
                \end{itemize}
                Then, by Lemma \ref{lem:cps:cpsinv-sub}, we have
                \begin{itemize}
                    \item $\jdsub{\cpsinv{\Gamma}}{T_v}{T_{\op 1}[\rep{A/X}]}$
                \end{itemize}
                and hence, by \rulename{T-VSub} with \lref{ty-v}, we have
                \begin{itemize}
                    \item $\jdty{\cpsinv{\Gamma}}{v}{T_{\op 1}[\rep{A/X}]}$~.
                \end{itemize}

                Also, by Lemma~\ref{lem:cps:wfg} and inversion, we have
                $\jdwf{\Gamma, \alpha}{\cps{\Sigma}}$.
                Then by Lemma~\ref{lem:cps:presv-b-wf}, we have
                $\jdwf{\cpsinv{\Gamma}}{\Sigma}$.

                Therefore, by \rulename{T-Op}, we have
                \[
                    \jdty{\cpsinv{\Gamma}}{\op~v}{\tycomp{\Sigma}{T_{\op 2}[\rep{A/X}][v/x]}{\tyctl{y_{\op}}{C_{\op 1}[\rep{A/X}][v/x]}{C_{\op 2}[\rep{A/X}][v/x]}}}~.
                \]

                On the other hand, by Lemma~\ref{lem:cps:inv} with \lref{ty-fun}, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-cpsT-t6} $\jdsub{\Gamma_{\alpha,h,k}}{(y':\cps{T}) \rarr \tau_6}{\tau_1}$,
                    \item\llabel{sub-t8} $\jdsub{\Gamma_{\alpha,h,k}, y':\cps{T}}{\tau_8[y'/y_0]}{\tau_6}$,
                    \item\llabel{sub-cpsT-cpsC1} $\jdsub{\Gamma_{\alpha,h,k}, y':\cps{T}}{(y:\cps{T}) \rarr \cps{C_1}}{(y_0:\tau_7) \rarr \tau_8}$, and
                    \item\llabel{ty-y'} $\jdty{\Gamma_{\alpha,h,k}, y':\cps{T}}{y'}{\tau_7}$~.
                \end{enumrm}
                By inversion of \lref{sub-cpsT-cpsC1}, we have
                \begin{itemize}
                    \item $y = y_0$ and
                    \item $\jdsub{\Gamma_{\alpha,h,k}, y':\cps{T}, y:\tau_7}{\cps{C_1}}{\tau_8}$~.
                \end{itemize}
                Then, by Lemma~\ref{lem:cps:subst} with \lref{ty-y'}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma_{\alpha,h,k}, y':\cps{T}}{\cps{C_1}[y'/y]}{\tau_8[y'/y]}$~.
                \end{itemize}
                Then, by Lemma~\ref{lem:cps:trans} with \lref{sub-t8}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma_{\alpha,h,k}, y':\cps{T}}{\cps{C_1}[y'/y]}{\tau_6}$
                \end{itemize}
                (Note that $y = y_0$).
                Then by \rulename{Sc-Fun}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma_{\alpha,h,k}}{(y':\cps{T}) \rarr \cps{C_1}[y'/y]}{(y':\cps{T}) \rarr \tau_6}$
                \end{itemize}
                and by $\alpha$-renaming we have
                \begin{itemize}
                    \item $\jdsub{\Gamma_{\alpha,h,k}}{(y:\cps{T}) \rarr \cps{C_1}}{(y':\cps{T}) \rarr \tau_6}$~.
                \end{itemize}
                Then, by Lemma~\ref{lem:cps:trans} with \lref{sub-cpsT-t6} and \lref{sub-t1}, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-cpsT-cpsC1-2} $\jdsub{\Gamma_{\alpha,h,k}}{(y:\cps{T}) \rarr \cps{C_1}}{(y_{\op}:\cps{T_{\op 2}}[\rep{A/X}][\cps{v}/x]) \rarr \cps{C_{\op 1}}[\rep{A/X}][\cps{v}/x]}$~.
                \end{enumrm}

                Therefore, by some subtyping rules with \lref{sub-cpsT-cpsC1-2} and \lref{sub-cpsCop2}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma}
                        {\forall \alpha. \cps{\Sigma} \rarr ((y_{\op}:\cps{T_{\op 2}}[\rep{A/X}][\cps{v}/x]) \rarr \cps{C_{\op 1}}[\rep{A/X}][\cps{v}/x]) \rarr \cps{C_{\op 2}}[\rep{A/X}][\cps{v}/x]}
                        {\forall \alpha. \cps{\Sigma} \rarr ((y: \cps{T}) \rarr \cps{C_1}) \rarr \tau'}$~.
                \end{itemize}
                Then by Lemma \ref{lem:cps:trans} with \lref{sub-t}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma}
                        {\forall \alpha. \cps{\Sigma} \rarr ((y_{\op}:\cps{T_{\op 2}}[\rep{A/X}][\cps{v}/x]) \rarr \cps{C_{\op 1}}[\rep{A/X}][\cps{v}/x]) \rarr \cps{C_{\op 2}}[\rep{A/X}][\cps{v}/x]}
                        {\tau}$~,
                \end{itemize}
                that is,
                \[
                    \jdsub{\Gamma}{\cps{\tycomp{\Sigma}{T_{\op 2}[\rep{A/X}][v/x]}{\tyctl{y_{\op}}{C_{\op 1}[\rep{A/X}][v/x]}{C_{\op 2}[\rep{A/X}][v/x]}}}}{\tau}~.
                \]
                Now we have the conclusion with $C = \tycomp{\Sigma}{T_{\op 2}[\rep{A/X}][v/x]}{\tyctl{y_{\op}}{C_{\op 1}[\rep{A/X}][v/x]}{C_{\op 2}[\rep{A/X}][v/x]}}$~.
            \item[Case $c = (\expwith{h}{c})^C$:]
                \def\currentprefix{cpsbw:hndl}
                We have $\cps{c} = \cps{c}~\cps{C}~\cps{h^{\mathit{ops}}}~\cps{h^{\mathit{ret}}}$
                where
                \[
                    \left\{ \begin{aligned}
                        h &= \{ \expret{x_r^{T_r}} \mapsto c_r, \repi{\op_i^{\rep{X_i: \rep{B_i}}}(x_i^{T_{i1}}, k_i^{(y_i:T_{i2}) \rarr C_{i1}}) \mapsto c_i} \} \\
                        \cps{h^{\mathit{ret}}} &= \lambda x_r:\cps{T_r}. \cps{c_r} \\
                        \cps{h^{\mathit{ops}}} &=
                            \{ \repi{\op_i = \Lambda \rep{X_i: \rep{B_i}}. \lambda x_i:\cps{T_{i1}}. \lambda k_i:(y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}. \cps{c_i}} \}
                    \end{aligned} \right.
                \]
                By Lemma \ref{lem:cps:inv-c-app}, we have
                \begin{enumrm}
                    \item\llabel{ty-cpsc} $\jdty{\Gamma}{\cps{c}}{\tau'}$,
                    \item\llabel{ty-cpshops} $\jdty{\Gamma}{\cps{h^{\mathit{ops}}}}{\tau_1}$, and
                    \item\llabel{ty-cpshret} $\jdty{\Gamma}{\cps{h^{\mathit{ret}}}}{\tau_2}$
                \end{enumrm}
                for some $\tau', \tau_1$ and $\tau_2$.

                By Lemma \ref{lem:cps:inv} with \lref{ty-cpshops} and \lref{ty-cpshret}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-cpsopc} $\bigrepi{\jdty{\Gamma}
                        {\Lambda \rep{X_i: \rep{B_i}}. \lambda x_i:\cps{T_{i1}}. \lambda k_i:(y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}. \cps{c_i}}{\tau_i}}$,
                    \item\llabel{sub-t1} $\jdsub{\Gamma}{\{\repi{\op_i: \tau_i}\}}{\tau_1}$,
                    \item\llabel{ty-cpscr} $\jdty{\Gamma, x_r:\cps{T_r}}{\cps{c_r}}{\tau_3}$, and
                    \item\llabel{sub-t2} $\jdsub{\Gamma}{(x_r:\cps{T_r}) \rarr \tau_3}{\tau_2}$~.
                \end{enumrm}
                Then, by the second half of Lemma \ref{lem:cps:inv-c-app}, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-t'} $\jdsub{\Gamma}{\tau'}
                        {\forall \alpha. \{\repi{\op_i: \tau_i}\} \rarr ((x_r:\cps{T_r}) \rarr \tau_3) \rarr \tau}$
                \end{enumrm}
                where $\alpha$ is fresh.

                By the IH of \lref{ty-cpscr}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-cr} $\jdty{\cpsinv{\Gamma}, x_r:T_r}{c_r}{C_r}$ and
                    \item\llabel{sub-cpsCr} $\jdsub{\Gamma, x_r:\cps{T_r}}{\cps{C_r}}{\tau_3}$
                \end{enumrm}
                for some $C_r$.

                By repeatedly inverting \lref{ty-cpsopc} and by Lemma \ref{lem:cps:trans}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-cpsci} $\bigrepi{\jdty{\Gamma, \rep{X_i: \rep{B_i}}, x_i:\cps{T_{i1}}, k_i:(y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}}
                        {\cps{c_i}}{\tau_i'}}$ and
                    \item\llabel{sub-ti} $\bigrepi{\jdsub{\Gamma}
                        {\forall \rep{X_i: \rep{B_i}}. (x_i:\cps{T_{i1}}) \rarr ((y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}) \rarr \tau_i'}{\tau_i}}$
                \end{enumrm}
                for some $\tau_i'$.
                By the IH of \lref{ty-cpsci}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-ci} $\bigrepi{\jdty{\cpsinv{\Gamma}, \rep{X_i: \rep{B_i}}, x_i:T_{i1}, k_i:(y_i:T_{i2}) \rarr C_{i1}}
                    {c_i}{C_i}}$ and
                    \item\llabel{sub-Ci} $\bigrepi{\jdsub{\Gamma, \rep{X_i: \rep{B_i}}, x_i:\cps{T_{i1}}, k_i:(y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}}
                        {\cps{C_i}}{\tau_i'}}$
                \end{enumrm}
                for some $C_i$'s.
                By \rulename{Sc-Fun} and \rulename{Sc-PPoly} with \lref{sub-Ci}, we have
                \begin{itemize}
                    \item {\small $\bigrepi{\jdsub{\Gamma}
                        {\forall \rep{X_i: \rep{B_i}}. (x_i:\cps{T_{i1}}) \rarr ((y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}) \rarr \cps{C_i}}
                        {\forall \rep{X_i: \rep{B_i}}. (x_i:\cps{T_{i1}}) \rarr ((y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}) \rarr \tau_i'}}$~.
                    }
                \end{itemize}
                Then, by Lemma \ref{lem:cps:trans} with \lref{sub-ti}, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-ti-2} $\bigrepi{\jdsub{\Gamma}
                        {\forall \rep{X_i: \rep{B_i}}. (x_i:\cps{T_{i1}}) \rarr ((y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}) \rarr \cps{C_i}}
                        {\tau_i}}$~.
                \end{enumrm}
                Thus, by Lemma \ref{lem:cps:trans}
                and subtyping with \lref{sub-t'}, \lref{sub-cpsCr} and \lref{sub-ti-2}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma}{\tau'}
                    {\forall \alpha. \tau_s \rarr ((x_r:\cps{T_r}) \rarr \cps{C_r}) \rarr \tau}$
                \end{itemize}
                where $\tau_s \defeq \{\repi{\op_i: \forall \rep{X_i: \rep{B_i}}. (x_i:\cps{T_{i1}}) \rarr ((y_i:\cps{T_{i2}}) \rarr \cps{C_{i1}}) \rarr \cps{C_i}}\}$~.
                Here, we define $\Sigma$ to be
                $\{\repi{\op_i: \forall \rep{X_i: \rep{B_i}}. (x_i:T_{i1}) \rarr ((y_i:T_{i2}) \rarr C_{i1}) \rarr C_i}\}$,
                Then, it holds that $\tau_s = \cps{\Sigma}$.
                That is, we have
                \begin{enumrm}[resume]
                    \item\llabel{sub-t'-2} $\jdsub{\Gamma}{\tau'}
                    {\forall \alpha. \cps{\Sigma} \rarr ((x_r:\cps{T_r}) \rarr \cps{C_r}) \rarr \tau}$~.
                \end{enumrm}

                On the other hand, by the IH of \lref{ty-cpsc}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-c} $\jdty{\cpsinv{\Gamma}}{c}{C_0}$ and
                    \item\llabel{sub-C0} $\jdsub{\Gamma}{\cps{C_0}}{\tau'}$
                \end{enumrm}
                for some $C_0$.
                By Lemma \ref{lem:assume-atm}, w.l.o.g., we can assume that
                $C_0 = \tycomp{\Sigma_0}{T_0}{\tyctl{x_0}{C_{01}}{C_{02}}}$~.
                Then, by Lemma \ref{lem:cps:trans} with \lref{sub-t'-2} and \lref{sub-C0}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma}{\forall \beta. \cps{\Sigma_0} \rarr ((x_0:\cps{T_0}) \rarr \cps{C_{01}}) \rarr C_{02}}
                    {\forall \alpha. \cps{\Sigma} \rarr ((x_r:\cps{T_r}) \rarr \cps{C_r}) \rarr \tau}$~.
                \end{itemize}
                Then, by inversion, we have
                \begin{itemize}
                    \item $x_0 = x_r$,
                    \item $\jdsub{\Gamma, \alpha}{\cps{\Sigma}}{\cps{\Sigma_0}}$,
                    \item $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}}{\cps{T_0}}{\cps{T_r}}$,
                    \item $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, x_r:\cps{T_0}}{\cps{C_r}}{\cps{C_{01}}}$,
                \end{itemize}
                and
                \begin{enumrm}[resume]
                    \item\llabel{sub-t} $\jdsub{\Gamma, \alpha, h:\cps{\Sigma}, k:(x_r:\cps{T_0}) \rarr \cps{C_{01}}}{\cps{C_{02}}}{\tau}$~.
                \end{enumrm}
                By Lemma \ref{lem:cps:rm-nonrfn}, we have
                \begin{itemize}
                    \item $\jdsub{\Gamma, \alpha}{\cps{\Sigma}}{\cps{\Sigma_0}}$,
                    \item $\jdsub{\Gamma, \alpha}{\cps{T_0}}{\cps{T_r}}$, and
                    \item $\jdsub{\Gamma, \alpha, x_r:\cps{T_0}}{\cps{C_r}}{\cps{C_{01}}}$~.
                \end{itemize}
                Then, by \ref{lem:cps:cpsinv-sub}, we have
                \begin{itemize}
                    \item $\jdsub{\cpsinv{\Gamma}}{\Sigma}{\Sigma_0}$,
                    \item $\jdsub{\cpsinv{\Gamma}}{T_0}{T_r}$, and
                    \item $\jdsub{\cpsinv{\Gamma}, x_r:T_0}{C_r}{C_{01}}$~.
                \end{itemize}
                Therefore, by subsumption on \lref{ty-c}, we have
                \begin{enumrm}[resume]
                    \item\llabel{ty-c-2} $\jdty{\cpsinv{\Gamma}}{c}{\tycomp{\Sigma}{T_r}{\tyctl{x_r}{C_r}{C_{02}}}}$~.
                \end{enumrm}
                Thus, by \rulename{T-Hndl} with \lref{ty-cr}, \lref{ty-ci} and \lref{ty-c-2}, we have
                \[
                    \jdty{\cpsinv{\Gamma}}{\expwith{h}{c}}{C_{02}}~.
                \]
                Also, by Lemma \ref{lem:cps:rm-nonrfn} and \ref{lem:cps:rm-unused-tvar} with \lref{sub-t}, we have
                \[
                    \jdsub{\Gamma}{\cps{C_{02}}}{\tau}~.
                \]
                Now we have the conclusion with $C = C_{02}$.
        \end{description}
    \end{enumit}
\end{proof}