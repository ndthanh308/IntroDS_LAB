\begin{algorithm}[t]
\SetAlFnt{\small\sf}
\BlankLine
\Fn{$\insertpendingwu{v}{E'}$}{
  $\keyword{let} \ E''.p  \ \mbox{be} \ E'$\;
  \lIf{$v$ is the empty sequence}{\Return{}}
  \lIf{$\exseq''$ was formerly a leaf in a wakeup tree}{\Return{}}\label{alglpwu:former-leaf}
%%   $\keyword{let} \ \mbox{$\nextev{E'}{p}$ be the event following $E'$ in $E$}$\;
  \If{\label{algl:pwu-if-in-wi}$p \in \winits{\exseq''}{v}$}{
    $\keyword{let} \ q \ \mbox{be the message following $E'$ in $E$}$\;
    $\insertpendingwu{v\remove p}{E'.q}$\;\label{alglpwu:recursive-call}
   }
   \Else{
%%      \If{$\nextev{E'}{p} = \fst{p}$} {add the run of $p$ from $\exseq$ in $\done'(\exseq')$}
%%     \lElse{add $p$ to $\done'(\exseq')$}
     $\insertwus{v}{\exseq''}{\emptyseq}$\tcp*{If conflict w. next event, insert into the wakeup tree}\label{alglpwu:event-insert}
   }
}
\caption{Insertion of Parked Wakeup Sequences.}
\label{alg:pendingwus}
\end{algorithm}
