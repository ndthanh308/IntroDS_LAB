\begin{algorithm}[t]
\SetAlFnt{\small\sf}
\BlankLine
\Fn{$\reverserace({E},{\event},{\event'})$}{
  \keyword{let} $E''$ be the subsequence of $E$ consisting of the events $e'''$ with $\event \nhappbf{\hb}{E} \event'''$\;\label{algl:revrace-short-init-notdep}
  \keyword{let} $S$ be a set of pairs of form $\pair{E'}{u.e'}$ which \\
  \quad for each maximal subset of $E''\cup\set{e'}$ that can be linearized \\
  \quad \quad \qquad \qquad to an execution of form $E'.u.e'$ while respecting $\happbf{hb}{E''}$ \\
  \quad contains one such execution $E'.u.e'$ where $E'$ is a maximal prefix of $E$.
  %% \keyword{let} $\event''$ be the $\happbf{\po}{E}$-predecessor of $\event'$\;

  %% $\happbf{sc}{E''} := \weaksatrel{\happbf{hb}{E''}}$\;\label{algl:revrace-short-init-ordering}
  %% \Repeat{convergence}{
  %%   \label{algl:converge-begin}
  %%   \If{a partially executed message includes an event $e'''$ with $e''' \happbf{\hb}{E''} e''$}{\label{algl:revrace-short-rule-must}
  %%     remove all other incomplete messages on same handler from $E''$\;\sdcmt{need to revisit}
  %%   }
  %%   \If{several incomplete messages execute on one handler}{\label{algl:revrace-short-rule-choose}
  %%     remove all but one of them from $E''$ (nondeterministically)\;
  %%   }
  %%   \ForEach{incomplete message $p$}{\label{algl:revrace-short-rule-last}
  %%     add relation $\happbf{sc}{E''}$ from all other messages on same handler to $p$\;
  %%     saturate\;
  %%   }
  %%   \ForEach{cycle in $\happbf{sc}{E''}$}{\label{algl:revrace-short-rule-cycle}
  %%     remove a message in the cycle\;
  %%   }
  %%   remove events that happen-after already removed events\;
  %% }\label{algl:converge-end}
  %% linearize $E''$ to an execution, respecting $\happbf{sc}{E''}$, with maximal prefix $E'$ s.t.\ $E' \leq E''$ and $E' \leq E$\; \label{algl:revrace-short-determine-prefix}
  %% define $u$ by $E'.u = E''$\;
  $\Return(S)$\;
}
\caption{Reversal of a Race.}
\label{alg:reverserace-short}
\end{algorithm}
