%!TEX root = ../main.tex

\begin{tikzpicture}[>=stealth,]
\sffamily
\footnotesize 
\pgfmathsetmacro{\kfirst}{3.421} % actual value
\pgfmathsetmacro{\ffirst}{7.708}  
\pgfmathsetmacro{\ksecond}{3.142} % actual value
\pgfmathsetmacro{\fsecond}{7.755}
\pgfmathsetmacro{\DX}{3.2}

\pgfplotstableread[header=false,col sep=comma]{tikz/qzgv_intensity_time_instances.csv}{\dataTimes}

\pgfplotstablegetelem{0}{[index]0}\of{\dataTimes}
\edef\timeInstant{\pgfplotsretval}% this is necessary in order to use the value inside the axes

\begin{axis}[
    name=qzgvSpec,
    width=2.8cm, height=2.8cm, at={(-\DX cm-2.7cm,0)},
    title={\SI{7.727}{\mega\hertz}},
    title style={yshift=-1ex},
    scale only axis,
    % y dir = reverse,
    xmin=-5,xmax=5, ymin=-5,ymax=5,
    xlabel={$k_X$ in \si{\radian\per\milli\meter}},
    ylabel={$k_Y$ in \si{\radian\per\milli\meter}},
    % yticklabels={,,},
    % xticklabels={,,},
    colorbar,
    colormap name=viridis,
    point meta min=-40, point meta max=0,
    colorbar style={
        % ytick={-1,0,1},
        at={(1.15, 0)},
        ylabel={mag. in \si{\deci\bel} re max.},
        }, 
    ]
    \addplot [forget plot] graphics [xmin=-5,xmax=5.06, ymin=-5.06,ymax=5.0,] {img/fig_qzgv_line_spectrum_full.pdf};
    \draw[thick, red, ->] (axis cs:0,0) -- node[above,rotate=26, xshift=-2ex]{$\mathbf{k}_\mathrm{qZGV}$} (axis cs:2.985,1.496);
    \draw[white,-{Classical TikZ Rightarrow}] (axis cs:-4,-3.5) node[below right, xshift=-2ex]{\color{white}filter} -- (axis cs:-3.5,-2.2);
\end{axis}
\node[fill=viridis1, anchor=south east] (labTheo) at (qzgvSpec.south east) {\color{white}theory};
\draw[red, thick] ([xshift=-2.2ex]labTheo.west) -- +(2ex,0); % baseline=-0.6ex
\node[at={(qzgvSpec.south west)}, anchor=east, outer xsep=2em]{(a)};

\begin{axis}[
    name=qzgvFieldA,
    width=2.8cm, height=2.8cm, at={(0 cm,0)},
    title={\SI{\timeInstant}{\micro\second}},
    title style={yshift=-1ex},
    scale only axis,
    y dir = reverse,
    xmin=-17.85,xmax=17.85, ymin=-17.85,ymax=17.85,
    yticklabels={,,},
    xticklabels={,,},
    ]
    \addplot [forget plot] graphics [xmin=-17.85,xmax=18.1, ymin=-17.85,ymax=18.1,] {img/fig_qzgv_intensity_1.pdf};
    \fill[white] (axis cs:-15,17) rectangle (axis cs:-5,16);
    \node[anchor=south] at (axis cs:-10,16) {\color{white}\SI{10}{\milli\meter}};
    \draw[white,-{Classical TikZ Rightarrow}] (axis cs:-3,-10) node[above]{\color{white}line source} -- (axis cs:-2,-4);
\end{axis}
\node[at={(qzgvFieldA.south west)}, anchor=east, outer xsep=0.5em]{(b)};

\pgfplotstablegetelem{0}{[index]1}\of{\dataTimes}
\edef\timeInstant{\pgfplotsretval}% this is necessary in order to use the value inside the axes
\begin{axis}[
    name=qzgvFieldB,
    width=2.8cm, height=2.8cm, at={(\DX cm,0)},
    title={\SI{\timeInstant}{\micro\second}},
    title style={yshift=-1ex},
    scale only axis,
    y dir = reverse,
    xmin=-17.85,xmax=17.85, ymin=-17.85,ymax=17.85,
    yticklabels={,,},
    xticklabels={,,},
    ]
    \addplot [forget plot] graphics [xmin=-17.85,xmax=18.1, ymin=-17.85,ymax=18.1,] {img/fig_qzgv_intensity_2.pdf};
    \draw[thick, white, ->] (axis cs:5,6) -- node[below,rotate=26]{$\mathbf{k}_\mathrm{S1}$} +(0.5cm,0.25cm);
    \draw[thick, white, ->] (axis cs:-6,11) -- node[below,rotate=26]{$\mathbf{k}_\mathrm{S2b}$} +(0.5cm,0.25cm);
    \draw[thick, white, ->] (axis cs:-5,-6) -- node[above,rotate=26]{$\mathbf{k}_\mathrm{S1}$} +(-0.5cm,-0.25cm);
    \draw[thick, white, ->] (axis cs:6,-11) -- node[above,rotate=26]{$\mathbf{k}_\mathrm{S2b}$} +(-0.5cm,-0.25cm);
\end{axis}

\pgfplotstablegetelem{0}{[index]2}\of{\dataTimes}
\edef\timeInstant{\pgfplotsretval}% this is necessary in order to use the value inside the axes
\begin{axis}[
    name=qzgvFieldC,
    width=2.8cm, height=2.8cm, at={(2*\DX cm,0)},
    title={\SI{\timeInstant}{\micro\second}},
    title style={yshift=-1ex},
    scale only axis,
    y dir = reverse,
    xmin=-17.85,xmax=17.85, ymin=-17.85,ymax=17.85,
    yticklabels={,,},
    xticklabels={,,},
    colorbar,
    colormap name=viridis,
    point meta min=0, point meta max=0.5,
    colorbar style={
        ytick={0,0.5},
        at={(1.15, 0)},
        ylabel={norm. intensity},
        ylabel style={yshift=2ex},
        }, 
    ]
    \addplot [forget plot] graphics [xmin=-17.85,xmax=18.1, ymin=-17.85,ymax=18.1,] {img/fig_qzgv_intensity_3.pdf};
    \draw[white, solid, rotate=26] (0.65cm, -2.4cm) ellipse (0.2cm and 0.3cm);
    \draw[thick, white, ->] (axis cs:3,6) -- +(0.5cm,0.25cm) node[above,rotate=26]{$\mathbf{k}_\mathrm{qZGV}$};
    \draw[thick, white, double distance=1pt, ->] (axis cs:5,10) -- node[below,rotate={-63.44}]{\color{white}flux} +(1.5mm,-3mm);
\end{axis}


\end{tikzpicture}
