\section{Spectral Galerkin discretization}\label{sec:spectral:galerkin}
In this appendix, we describe a spectral Galerkin discretization~\citep{Kopriva:2009} of the PFR model~\eqref{eq:pfr}. As with the finite volume discretization, we disregard the reaction term, $R$, because it is discretized in the same way as the source term, $Q$. That is, we discretize the system
%
\begin{subequations}\label{eq:general:pde}
	\begin{align}
		\partial_t c &= -\partial_z N + Q, \\
		A N \rvert_{z = z_0} &= F.
	\end{align}
\end{subequations}
%
In this appendix, we assume that $z\in[-1, 1]$ (referred to as the computational domain). That is typically not the case. However, the actual physical domain can be mapped onto the computational domain and the system can be transformed accordingly, as described in Appendix~\ref{sec:affine:domain:transformation}.

We approximate the solution, $c$, as a sum of products between time-dependent functions and space-dependent polynomials:
%
\begin{align}\label{eq:spectral:galerkin:approximate:concentration}
	c(t, z)
	&\approx \hat c(t, z) = \sum_{m=0}^M \hat c_m \ell_m.
\end{align}
%
Here, $\hat c_m = \hat c_m(t) = \hat c(t, z_m)$ is the $m$'th time-dependent coefficient, $\{z_m\}_{m=0}^M$ is a set of collocation points, and $\ell_m = \ell_m(z)$ is the $m$'th Lagrange polynomial (see Appendix~\ref{sec:spectral:galerkin:lagrange:polynomials}). An important property of such polynomials is that $\ell_m(z_i) = \delta_{im}$, i.e., it is equal to one when evaluated in the $m$'th collocation point and zero when evaluated in any other collocation point.
%
For brevity of notation, we often omit the dependency on time and space when functions are evaluated at $t$ and $z$.
%
Furthermore, for clarity, we explicitly indicate the arguments of the flux, $N$, and the source term, $Q$.

We require that the approximate solution, $\hat c$, satisfies the PDE weakly. Specifically,
%
\begin{align}\label{eq:spectral:galerkin:weak:form}
	\int_{z_0}^{z_f} \left(\partial_t \hat c + \partial_z N(\hat c) - Q(\hat c)\right) \phi \incr z &= 0
\end{align}
%
must be satisfied for any test function $\phi$ that belongs to the same function space as the approximate solution, i.e., for any polynomial.
%
As for the solution, we write the test function as a Lagrange polynomial:
%
\begin{align}\label{eq:spectral:galerkin:weak:form:test:polynomial}
	\phi(t, z) &= \sum_{n=0}^M \phi_n \ell_n.
\end{align}
%
Here, $\phi_n = \phi_n(t) = \phi_n(t, z_n)$ is the $n$'th time-dependent coefficient. We substitute the expression for the test function in~\eqref{eq:spectral:galerkin:weak:form}:
%
\begin{align}\label{eq:spectral:galerkin:weak:form:2}
	\sum_{n=0}^M \phi_n \int_{z_0}^{z_f} (\partial_t \hat c + \partial_z N(\hat c) - Q(\hat c)) \ell_n \incr z &= 0.
\end{align}
%
This equality must be satisfied for any polynomial $\phi$, which means that it must be satisfied for any combination of values of $\{\phi_n\}_{n=0}^m$ at any point in time. Therefore, the integral must equal zero, i.e.,
%
\begin{align}\label{eq:spectral:galerkin:weak:form:3}
	\int_{z_0}^{z_f} (\partial_t \hat c + \partial_z N(\hat c) - Q(\hat c)) \ell_n \incr z &= 0,
\end{align}
%
for $n = 0, \ldots, M$. Next, we use integration by parts to rewrite the integral of the flux term. The result is
%
\begin{align}
	\int_{z_0}^{z_f} \partial_z N(\hat c) \ell_n \incr z =\,& \left[N(\hat c) \ell_n\right]_{z_0}^{z_f} \nonumber \\
	&- \int_{z_0}^{z_f} N(\hat c) \diff{\ell_n}{z} \incr z,
\end{align}
%
for $n = 0, \ldots, M$. We insert this expression and the expression for the approximate concentration~\eqref{eq:spectral:galerkin:approximate:concentration} into~\eqref{eq:spectral:galerkin:weak:form:3} in order to obtain
%
\begin{align}\label{eq:spectral:galerkin:before:quadrature}
	&\sum_{m=0}^M \diff{\hat c_m}{t} \int_{z_0}^{z_f} \ell_m \ell_n \incr z + \left[N(\hat c) \ell_n\right]_{z_0}^{z_f} \nonumber \\
	&- \int_{z_0}^{z_f} N(\hat c) \diff{\ell_n}{z} \incr z - \int_{z_0}^{z_f} Q(\hat c) \ell_n \incr z = 0,
\end{align}
%
for $n = 0, \ldots, M$. We approximate the integrals using quadrature (see Appendix~\ref{sec:spectral:galerkin:jacobi:polynomials}). Consequently,
%
\begin{align}
	&\sum_{m=0}^M \diff{\hat c_m}{t} \sum_{l=0}^M \ell_m(z_l) \ell_n(z_l) w_l + \left[N(\hat c) \ell_n\right]_{z_0}^{z_f} \nonumber \\
	&- \sum_{l=0}^M N(\hat c(t, z_l)) \diff{\ell_n}{z}(z_l) w_l \nonumber \\
	&- \sum_{l=0}^M Q(\hat c(t, z_l)) \ell_n(z_l) w_l = 0,
\end{align}
%
for $n = 0, \ldots, M$. We exploit that $\ell_m(z_l) = \delta_{ml}$ and that $\hat c(t, z_l) = \hat c_l(t)$:
%
\begin{align}
	&\diff{\hat c_n}{t} w_n + \left[N(\hat c) \ell_n\right]_{z_0}^{z_f} - \sum_{l=0}^M N(\hat c_l) \diff{\ell_n}{z}(z_l) w_l \nonumber \\
	&- Q(\hat c_n) w_n = 0, \quad n = 0, \ldots, M.
\end{align}
%
Finally, we rearrange terms in order to obtain the ODEs for each of the coefficients,
%
\begin{align}\label{eq:spectral:galerkin:final}
	\diff{\hat c_n}{t} =\,& -\frac{1}{w_n} \left[N(\hat c) \ell_n(z)\right]_{z_0}^{z_f} \nonumber \\
	&+ \frac{1}{w_n} \sum_{l=0}^M N(\hat c_l) \diff{\ell_n}{z}(z_l) w_l + Q(\hat c_n),
\end{align}
%
for $n = 0, \ldots, M$.
%
\begin{remark}
When using Gauss-Lobatto quadrature, the boundary contribution in~\eqref{eq:spectral:galerkin:final} (i.e., the first term on the right-hand side) is only nonzero for the boundary coefficient (i.e., for $n=0$) because $z_0$ and $z_f$ are collocation points. For Gauss quadrature, the boundary contribution is nonzero for all of the differential equations because $z_0$ and $z_f$ are not collocation points.
\end{remark}

\input{./appendix/spectral_galerkin/jacobi_polynomials}
\input{./appendix/spectral_galerkin/lagrange_polynomials}
\input{./appendix/spectral_galerkin/affine_domain_transformation}