
\begin{algorithm}
\caption{Our Implementation of StOMP ("IQR"-Mode)}\label{alg:cap}
\begin{algorithmic}
    \Require{compressed measurement: $y$, reconstruction matrix: $\Theta$, 
    maximum stages: $max_{stages}$, filter value: $\gamma$, 
    boundary condition: $b$,
    minimum sparsity ratio: $min_{sparsity}$, maximum sparsity ratio: $max_{sparsity}$}
    
    
    \For{$s = 1, s \leq max_{stages}: i\,+= 1$}
        \State $\kappa_s = \Theta^T r_{s}$                                                     \Comment{Matched Filter}
        
        \If {$s == 1$ or $ J_{s-1} == \{\, \}$}
            \State $t_s = \frac{\Call{treshold}{\kappa_s\,, b\,, \gamma} }{\sigma_s} \text{ for } \kappa_s \in \{b \}$
        \Else
            \State $t_s = t_{s-1}$
        \EndIf
        
        \State $J_s = \{ j:  \lvert \kappa_s(j) \rvert > t_s \sigma_s \}$                        \Comment{Hard Thresholding}
        
        \If {\Call{sparsity ratio}{$\kappa_s$, $I_{s-1}$, $J_s$} $<\;min_{sparsity}$ } 
            \While{\Call{sparsity ratio}{$\kappa_s$, $I_{s-1}$, $J_s$} $<\;min_{sparsity}$ }     \Comment{If sparsity to low increase it until it is ok}
                \State $J_s \cup \{ j:  \lvert \kappa_s(j) \rvert \geq \lvert \kappa_s(n)\rvert\,\forall\,n \}$ 
            \EndWhile
        \EndIf
        
        \State $I_s = I_{s-1} \cup J_s$                                                     \Comment{Updating Index Set}
        \State $(c_s)_{I_s} = (\Theta^T_{I_s} \Theta_{I_s})^{-1} \Theta^T_{I_s} y$          \Comment{Projection}
        \State $r_{s+1} = y - \Theta_{I_s}c_s$                                         \Comment{Updating residual}
        
        \If {\Call{sparsity ratio}{$\kappa_s$, $I_{s-1}$, $J_s$} $\geq\;max_{sparsity}$ }        \Comment{If sparsity ok or to hight stop}
            \State \textbf{end for}                                                 
        \EndIf
        
      \EndFor
      \State \Return{$c_s$}
    
\end{algorithmic}
\end{algorithm}



\begin{algorithm}
\caption{sparsity ratio}\label{func:spratio}
\begin{algorithmic}
    \Function{sparsity ratio}{$\kappa_s$, $I_{s-1}$, $J_s$}
        \State \Return{$\frac{\mid I_{s-1} \mid + \mid J_s \mid}{ dim(\kappa_s)}$}
    \EndFunction
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Threshold $t_\text{IQR}$ Calculation}\label{func:tpc}
\begin{algorithmic}
    \Function{threshold}{$\kappa_s$, $b$, $\gamma$}
        \State $C = \{ \mid \kappa_s(j) \mid: j \in b\}$       \Comment{absolut values with respect to index boundaries}
        \State $Q_1 = P_{25}^{\hspace{0.2em}C}$                                       \Comment{Percentil $0 \text{ to } 25\%$}
        \State $Q_3 = P_{75}^{{\hspace{0.2em}C}}$                                       \Comment{Percentil $75 \text{ to } 100\%$}
        \State $IQR = Q_3 - Q_1$                                    \Comment{Interquartil range calculation}
        \State $ t_\text{IQR} = Q_3 + \gamma \cdot IQR$                        \Comment{threshold calculation}
        
        \State \Return{$t_\text{IQR}$}
    \EndFunction
\end{algorithmic}
\end{algorithm}
