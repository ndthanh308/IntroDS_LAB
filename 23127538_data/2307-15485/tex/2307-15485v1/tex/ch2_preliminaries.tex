\section{Dynamic Epistemic Logic}\label{sec:del}
    This section is organized as follows. The syntax and semantics of DEL~\cite{book/springer/vanDitmarsch2007} are introduced in Section~\ref{sec:epistemic_models}, event models and the product update in Section~\ref{sec:event_models}.
    In Section \ref{sec:s5}, we recall the axioms of the logic S5$_n$.
    In Section~\ref{sec:plan_ex} we define the plan existence problem.

\subsection{Epistemic Models}\label{sec:epistemic_models}
    Let $\atomSet$ be a finite set of atomic propositions and $\agentSet = \{1, \dots, n\} $ a finite set of agents. The language $\Lang{C}$ of \emph{multi-agent epistemic logic on $ \atomSet $ and $ \agentSet $ with common knowledge} is defined by the following BNF:
    \begin{equation*}
        \varphi ::= \atom{p} \mid \neg \varphi \mid \varphi \wedge \varphi \mid \B{i} \varphi \mid \CK{G} \varphi,
    \end{equation*}

    \noindent where $ \atom{p} \in \atomSet $, $ i \in \agentSet $, and $ \varnothing \neq G \subseteq \agentSet $. Formulae $ \B{i} \varphi $ and $ \CK{G} \varphi $ are respectively read as ``agent $ i $ knows that $ \varphi $'' and ``group $G$ has common knowledge that $ \varphi $''.
    We define $\top$, $\bot$, $\vee$, $\rightarrow$ and $\D{i}$ as usual.

    \begin{definition}[Epistemic Model and State]
        An \emph{epistemic model} of $ \Lang{C} $ is a triple $ M = (W, R, V) $ where:
        \begin{compactitem}
            \item $ W \neq \varnothing $ is a finite set of possible worlds; 
            \item $ R: \agentSet \rightarrow 2^{W \times W} $ assigns to each agent $ i $ an accessibility relation $R(i)$ (abbreviated as $R_i$);
            \item $ V: \atomSet \rightarrow 2^W $ assigns to each atom a set of worlds.
        \end{compactitem}
        \noindent An \emph{epistemic state} is a pair $ (M, W_d) $, where $ W_d \subseteq W $ is a non-empty set of designated worlds.
    \end{definition}

    \noindent Intuitively, a designated world in $W_d$ is considered the current ``real" world from the perspective of an external observer (the planner) rather than of agents in $\agentSet$. Thus, $|W_d|>1$ represents the uncertainty of the observer about the real world. 
    
    The pair $(W, R)$ is called the \emph{frame} of $M$. We use the infix notation $ w R_i v $ in place of $ (w, v) \in R_i $.
    We also define $ R_G \doteq \cup_{i \in G} R_i $, where $ G \subseteq \agentSet $. The reflexive and transitive closure of $ R $ is denoted by $ R^* $. 
    Relations $R_i$ capture what agents consider to be possible: $ w R_i v $ denotes the fact that, in $w$, agent $i$ considers $v$ to be possible.
    %Formulae in $\Lang{C}$ are evaluated in worlds of a model. 		
    Throughout the paper, to support our exposition, we consider the example of the \emph{coordinated attack problem} \cite{book/springer/Gray1978,journals/jacm/Halpern1990}. It is a well-known problem that is often analyzed in the distributed systems literature. In what follows, we appeal to the DEL representation of this problem provided in \cite{journals/ai/Bolander2020}.

    \begin{example}[The Coordinated Attack Problem]\label{ex:k_model}
        Two generals, $\mathbf{a}$ and $\mathbf{b}$, are camped with their armies on two hilltops overlooking a common valley, where the enemy is stationed. The only way for them to defeat the enemy is to attack simultaneously. They can only communicate by means of a messenger, who may be captured at any time when crossing the valley. Neither general will attack until he is sure that the other will attack as well.
        
        General $\mathbf{a}$ and the messenger are initially together, and general $\mathbf{a}$ decides to attack at dawn. We use the atomic propositions $d$ to denote that `\emph{general $\mathbf{a}$ will attack at dawn}' and $m_i$, for $i = \mathbf{a}, \mathbf{b}$, to denote that the messenger is currently at the camp of general $i$. In this way, $\neg m_a \land \neg m_b$ expresses the fact that the messenger has been captured.
        
        The initial situation can be described by the epistemic state $s_0$ shown below\footnote{In all figures, the reflexive, symmetric and transitive closures of the relations are left implicit.}. Each bullet represents a world and the designated world is denoted by a circled bullet. There are two possible worlds, denoting the possibility that general $\mathbf{a}$ will attack at dawn ($w_1$), or not ($w_2$). Both generals know that the messenger is camped with general $\mathbf{a}$. The fact that general $\mathbf{b}$ does not know whether general $\mathbf{a}$ has decided to attack is represented by the indistinguishability relations between worlds $w_1$ and $w_2$. In fact, initially, general $\mathbf{b}$ has not enough information to know whether his ally has decided to attack.

        {\centering
            \input{img/s0.tex}
        \par}
    \end{example}

    \begin{definition}[Truth in epistemic states]
        Let $ M = (W, R, V) $ be an epistemic model, $ w \in W $, $i \in \agentSet$, $\varnothing \neq G \subseteq \agentSet$, $p \in \atomSet$ and $\varphi,\psi \in \Lang{C}$ be two formulae. Then,
        
        {\centering
        $
            \begin{array}{@{}lll}                    
                (M, w) \models \atom{p}            & \text{ iff } & w \in V(\atom{p}) \\
                (M, w) \models \neg \varphi        & \text{ iff } & (M, w) \not\models \varphi \\
                (M, w) \models \varphi \wedge \psi & \text{ iff } & (M, w) \models \varphi \text{ and } (M, w) \models \psi \\
                (M, w) \models \B{i} \varphi       & \text{ iff } & \forall v \text{ if } w R_i v \text{ then } (M, v) \models \varphi \\
                (M, w) \models \CK{G} \varphi       & \text{ iff } & \forall v \text{ if } w R_G^* v \text{ then } (M, v) \models \varphi
            \end{array}
        $
        \par}

        \noindent Let $(M, W_d)$ be an epistemic state. Then,

        {\centering
        $
            \begin{array}{@{}lll}                    
                (M, W_d) \models \varphi           & \text{ iff } & (M, w) \models \varphi \textnormal{ for all } w \in W_d
            \end{array}
        $
        \par}
    \end{definition}
	
	\noindent For instance, $(M,w)\models p$ means that $p$ is true in $w$; $(M,w)\models \D{i} p$ means that in $w$ the agent $i$ admits the possibility of $\varphi$ being true, i.e., there exists a world $v$ that $i$ considers possible (i.e., with $w R_i v$) such that $(M,v)\models \varphi$; $(M,w)\models \B{i} \varphi$ means that in $w$ the agent $i$ knows $\varphi$, as $\varphi$ holds in all worlds that $i$ considers possible.
	
    We recall the notion of bisimulation for epistemic states \cite{conf/kr/Bolander2021}. 
                
    \begin{definition}[Bisimulation]
        Let $s=((W, R, V), W_d)$ and $s'=((W', R', V'), W'_d)$ be two epistemic states. We say that $s$ and $s'$ are \emph{bisimilar}, denoted by $s \bisim s'$, if there exists non-empty binary relation $ Z \subseteq W \times W' $ satisfying:

        \begin{compactitem}
            \item \emph{Atoms}: if $(w, w') \in Z$, then for all $ \atom{p} \in \atomSet $, $ w \in V(\atom{p}) $ iff $ w' \in V'(\atom{p}) $.
            \item \emph{Forth}: if $(w, w') \in Z$ and $ w R_i v $, then there exists $ v' \in W' $ such that $ w' R'_i v' $ and $ (v, v') \in Z $.
            \item \emph{Back}: if $(w, w') \in Z$ and $ w' R'_i v' $, then there exists $ v \in W $ such that $ w R_i v $ and $ (v, v') \in Z $.
            \item \emph{Designated}: if $ w \in W_d $, then there exists $w' \in W'_d$ such that $(w, w') \in Z$, and vice versa.
        \end{compactitem}

        \noindent We say that $Z$ is a \emph{bisimulation} between $s$ and $s'$.
    \end{definition}

    \noindent Throughout the rest of the paper, we assume that \emph{each epistemic state is minimal w.r.t. bisimulation}.
    We denote the fact that $(w, w') \in Z$ by $w \bisim w'$.
    Finally, we introduce a notion of $k$-bisimulation for epistemic states. The following definition follows the one in \cite{books/cup/Blackburn2001} and generalizes that of \cite{conf/ijcai/Yu2013} by considering epistemic states with (possibly) multiple designated worlds.

    \begin{definition}[$k$-bisimulation]\label{def:k-bisim}
        Let $k \geq 0$ and let $s=((W, R, V),$ $W_d)$ and $s'=((W', R', V'), W'_d)$ be two epistemic states. We say that $s$ and $s'$ are $k$-bisimilar, denoted by $s \bisim_k s'$, if there exists a sequence of non-empty binary relations $Z_k \subseteq \ldots \subseteq Z_0$ (with $Z_0 \subseteq W \times W'$) satisfying (for any $i < k$):
        \begin{compactitem}
            \item \emph{Atoms}: if $(v, v') \in Z_0$, then for all $ \atom{p} \in \atomSet $, $ v {\in} V(\atom{p}) $ iff $ v' {\in} V'(\atom{p}) $.
            \item \emph{Forth}: if $(v, v') \in Z_{i+1}$ and $ v R_i u $, then there exists $ u' \in W' $ such that $ v' R'_i u' $ and $ (u, u') \in Z_i $.
            \item \emph{Back}: if $(v, v') \in Z_{i+1}$ and $ v' R'_i u' $, then there exists $ u \in W $ such that $ v R_i u $ and $ (u, u') \in Z_i $.
            \item \emph{Designated}: if $ v \in W_d $, then there exists $v' \in W'_d$ such that $(v, v') \in Z_k$, and vice versa.
        \end{compactitem}

        \noindent We say that $Z_k$ is a \emph{$k$-bisimulation} between $s$ and $s'$.
    \end{definition}

    \subsection{Event Models and Product Update}\label{sec:event_models}
        Information change is captured by \emph{product updates} of the current epistemic state with the \emph{event model} of actions. 
        
        \begin{definition}[Event Model and Action]
            An \emph{event model} for $ \Lang{C} $ is a tuple $ \E = (E, Q, pre, post) $ where:
            \begin{compactitem}
                \item $ E \neq \varnothing $ is a finite set of events; %, called \emph{domain}; 
                \item $ Q: \agentSet \rightarrow 2^{E \times E} $ assigns to each agent $ i $ an accessibility relation $ Q(i) $ (abbreviated as $Q_i$); 
                \item $ pre: E \rightarrow \Lang{C} $ assigns to each event a \emph{precondition}; 
                \item $ post: E \rightarrow (\atomSet \rightarrow \Lang{C}) $ assigns to each event and atom a \emph{postcondition}.
            \end{compactitem}
            \noindent An \emph{action} is a pair $ (\E, E_d) $ where $ E_d \subseteq E $ is a non-empty set of designated events.
        \end{definition}

        \noindent Similarly to epistemic states, the designated events in $E_d$ represent the ``real'' events that are taking place from the perspective of an external observer.

        The pair $(E, Q)$ is called the \emph{frame} of $\E$.
 		We use the infix notation $ e Q_i f $ in place of $ (e, f) \in Q_i$. 
 		These relations are analogous to the accessibility relations of epistemic models: they are used to specify how the knowledge of each agent is affected by an action, depending on which events each agent considers possible. 
		Intuitively, the precondition of an event $e$ specify whether $e$ \emph{could happen} in a certain world $w$, whereas the postconditions of $e$ describe how such event might change the factual properties of $w$ (see Definition \ref{def:update_em}). Formally, we say that an event $e$ is \emph{applicable} in a world $w$ of $M$ if $(M,w)\models pre(e)$.
        
        \begin{example}\label{ex:e_model}
            Imagine that general $\mathbf{a}$ decides to send the messenger to general $\mathbf{b}$ (action send$_{ab}$). While doing  so, the general considers two possible outcomes:
            \begin{enumerate*}[label=\arabic*)]
                \item the messenger safely arrives to the other side of the valley, or
                \item the messenger is captured by the enemy. 
            \end{enumerate*}
            %
            In the figure below, these eventualities are represented by events $e^a_1$ and $e^a_2$, respectively. The precondition of $e^a_1$ is $pre(e^a_1) = d \land m_a$, namely the message can only arrive to general $\mathbf{b}$ if general $\mathbf{a}$ has indeed decided to attack at dawn and if the messenger is at $\mathbf{a}$'s camp. The precondition of $e^a_2$ is simply $pre(e^a_2) = \top$, since the messenger could always be captured. We represent the fact that the messenger travels from one hilltop to the other\footnote{For simplicity, we assume that the truth value of each atomic proposition remains unchanged unless explicitly specified.} by having $post(e^a_1)(m_a) = \bot$ and $post(e^a_1)(m_b) = \top$. Finally, we denote the fact that the messenger is captured by having $post(e^a_2)(m_a) = \bot$ and $post(e^a_2)(m_b) = \bot$.

            {\centering
                \input{img/send_ab.tex}
            \par}

            Action send$_{ba}$ is defined similarly, by having $pre(e^b_1) = d \land m_b$, $pre(e^b_2) = \top$, $post(e^b_1)(m_a) = \top$, $post(e^b_1)(m_b) = \bot$, $post(e^b_2)(m_a) = \bot$ and $post(e^b_2)(m_b) = \bot$.

            {\centering
                \input{img/send_ba.tex}
            \par}
        \end{example}
        
        The \emph{product update} formalizes the execution of an action $(\E, E_d)$ on the current epistemic state $(M, W_d)$. Intuitively, the resulting epistemic state $(M', W_d')$ is computed by a cross product between the worlds in $M$ and the events in $\E$. A pair $(w,e)$ represents the world of $M'$ that results from applying the event $e$ on the world $w$.
        %
        We say that $ (\E, E_d) $ is \emph{applicable} in $ (M, W_d) $ iff for each world $ w_d \in W_d $ there exists an event $e_d\in E_d$ that is applicable in $w_d$. 
        
        \begin{definition}[Product Update]\label{def:update_em}
            Let $ (\E, E_d) $ be an action applicable in an epistemic state $ (M, W_d) $, where $ M = (W, R, V) $ and $ \E = (E, Q, pre, post) $. The \emph{product update} of $ (M, W_d) $ with $ (\E, E_d) $ is the epistemic state $ (M, W_d) \otimes (\E, E_d) = ((W', R', V'), W'_d) $, where:

            {\centering
            $
                \begin{array}{l@{\;}ll}
                    W'	         & = \{(w, e) \in W {\times} E \mid (M, w) \models pre(e)\} \\
                    R'_i	     & = \{((w, e), (v, f)) \in W' {\times} W' \mid w R_i v \text{ and } e Q_i f\} \\
                    V'(\atom{p}) & = \{(w, e) \in W' \mid (M, w) \models post(e)(\atom{p})\} \\
                    W'_d	     & = \{(w, e) \in W' \mid w \in W_d \text{ and } e \in E_d\}
                \end{array}
            $
            \par}
        \end{definition}

        
        \begin{example}\label{ex:update}
            Suppose that general $\mathbf{a}$ sends the messenger to general $\mathbf{b}$ (action send$_{ab}$) and that the message is successfully delivered. The situation is represented by epistemic state $s_1$, where $w'_1 = (w_1, e^a_1)$, $w'_2 = (w_1, e^a_2)$ and $w'_3 = (w_2, e^a_2)$ (recall that the reflexive, symmetric and transitive closures of the relations are left implicit).

            {\centering
                \input{img/s1.tex}
            \par}
            
            Now general $\mathbf{b}$ knows about the intentions of his ally ($\B{b}d$), but general $\mathbf{a}$ does not know that general $\mathbf{b}$ knows. So, $\mathbf{b}$ decides to send the messenger back to acknowledge that the message was received (action send$_{ba}$). Here, $d$ assumes the meaning of ``general $\mathbf{b}$ has received the message''. Assume again that the messenger succeeds. We obtain the epistemic state $s_2$, where $w''_1 = (w'_1, e^b_1)$, $w''_2 = (w'_1, e^b_2)$, $w''_3 = (w'_2, e^b_2)$ and $w''_4 = (w'_3, e^b_2)$.
            
            {\centering
                \input{img/s2.tex}
            \par}

            Now it holds that $\B{a}\B{b}d$, but it does not hold that $\B{b}\B{a}\B{b}d$. So, general $\mathbf{a}$ would need to send the messenger once again to general $\mathbf{b}$. However, it can be intuitively seen that, regardless of how many messages the generals exchange, they will never be sure that the other will attack at dawn. This will be stated formally in Section \ref{sec:plan_ex}.
        \end{example}

    \subsection{The logic S5$_n$}\label{sec:s5}
        In the epistemic logic literature there exist many different axiomatizations of the concept of \emph{knowledge}. In this paper, we adopt the multimodal logic S5$_n$. Its axioms are\footnote{Even though \axiom{K}, \axiom{T} and \axiom{5} are sufficient to characterize S5$_n$, we include axiom \axiom{4} as it constitutes an important epistemic principle.}:
        
        {\centering
        $
            \begin{array}{l@{}l@{}r@{}}
                \axiom{K}\;\; & \B{i} (\varphi \rightarrow \psi) \rightarrow
                                (\B{i} \varphi \rightarrow \B{i} \psi)  			& \textnormal{(Distribution)}           \\
                \axiom{T} & \B{i} \varphi \rightarrow \varphi                       & \textnormal{(Knowledge)}              \\
                \axiom{4} & \B{i} \varphi \rightarrow \B{i} \B{i} \varphi           & \textnormal{(Positive introspection)} \\
                \axiom{5} & \neg \B{i} \varphi \rightarrow \B{i} \neg \B{i} \varphi & \textnormal{(Negative introspection)}
            \end{array}
        $
        \par}

        \noindent Axioms \axiom{T}, \axiom{4} and \axiom{5} correspond, to the following \emph{frame properties}: reflexivity ($ \forall u (u R_i u) $), transitivity ($ \forall u, v, w (u R_i v \wedge v R_i w \rightarrow u R_i w) $) and Euclidicity ($ \forall u, v, w (u R_i v \wedge u R_i w \rightarrow v R_i w) $). 
        Moreover, axioms \axiom{T} and \axiom{5} together entail symmetry ($ \forall u, v (u R_i v \rightarrow v R_i u) $). 
        Thus, accessibility relations in S5$_n$ are equivalence relations.
        We refer to epistemic states (resp., epistemic models, actions, frames) satisfying the axioms of a logic $L$ as $L$-states (resp., $L$-models, $L$-actions, $L$-frames). In the rest of the paper, we assume that the accessibility relations of epistemic states and actions are equivalence relations.

\subsection{Plan Existence Problem}\label{sec:plan_ex}
	We now define our problem, adapting the formulation in~\cite{conf/ijcai/Aucher2013}. 

    \begin{definition}[Planning Task]
    \label{def:planning_task}
        An \emph{(epistemic) planning task} is a triple $ T = (s_0, \actionSet,$ $ \varphi_g) $, where $ s_0 $ is an initial epistemic state; $ \actionSet $ is a finite set of actions; $ \varphi_g \in \Lang{C} $ is a \emph{goal formula}.
    \end{definition}

    Given a logic $ L $, an \emph{$L$-planning task} $ (s_0, \actionSet, \varphi_g) $ is a planning task where $s_0$ is an $L$-state and each action in $\actionSet$ is an $L$-action. We denote the class of $L$-planning tasks with $\mathcal{T}_L$.
    We remark that, given a generic logic $L$, the product update of an L-state with an L-action, in general, is not necessarily an L-state. This is not a desired outcome in general, since axioms model some principles of knowledge/belief that always need to be satisfied.
    For instance, this is the case of the logic KD45$_n$, that captures the concept of \emph{belief}. In the literature, there exist different approaches to guarantee the preservation of the KD45$_n$ frame properties after the product update. For instance, some techniques involve belief revision techniques \cite{workshop/nrac/Herzig2005}, whereas others focus on defining some additional conditions to impose to both states and actions \cite{conf/aaai/Son2015}.

    The case of our logic C-S5$_n$ is similar to that of KD45$_n$. In fact, the frame property corresponding to axiom \axiom{C} (see Equation \ref{eq:A-frame} in Section \ref{sec:new_logic}) is not guaranteed to hold after the application of an action. In this paper, rather than devising some technique to guarantee the preservation of frame property \ref{eq:A-frame}, we instead opt for a rollback-style approach: an action is not to be applied in a state if it would lead to violate the axioms of C-S5$_n$.
    This leads to the following definition.

    \begin{definition}[Solution]\label{def:solution}
        A \emph{solution} to an $L$-planning task $(s_0, \actionSet,$ $ \varphi_g)$ is a finite sequence $ \alpha_1, \dots, \alpha_m $ of actions of $\actionSet$ such that:
        \begin{compactenum}
            \item $ s_0 \otimes \alpha_1 \otimes \dots \otimes \alpha_m \models \varphi_g $, and
            \item For each $ 1 \leq k \leq m $, $ \alpha_k $ is applicable in $ s_0 \otimes \alpha_1 \otimes \dots \otimes \alpha_{k-1} $ and $s_0 \otimes \alpha_1 \otimes \dots \otimes \alpha_k$ is an $L$-state.
        \end{compactenum}
    \end{definition}
    
    \begin{definition}[Plan Existence Problem]\label{def:plan_ex_problem}
        Let $n \geq 1$ and $\mathcal{T}_L$ be a class of epistemic planning tasks for a logic $L$. \planex{$\mathcal{T}_L$}{$n$} is the following decision problem: ``Given an $L$-planning task $ T = (s_0, \actionSet, \varphi_g) \in \mathcal{T}_L $, where $|\agentSet|=n$, does $ T $ have a solution?''
    \end{definition}

    
    \begin{example}\label{ex:task}
        In Example~\ref{ex:update} we have seen that, intuitively speaking, the two generals can not coordinate a winning attack. We now state this formally. Let $T_\textnormal{coord} = (s_0, \actionSet, \varphi_g) $ be an S5$_n$-planning task, where $\actionSet = \{\textnormal{send}_{ab}, \textnormal{send}_{ba}\}$ and $\varphi = \CK{\{a,b\}}d$. Then, $T_\textnormal{coord}$ has no solution. In fact, for any number $k \geq 0$ of delivered messages, one can show by induction the following (where $h\geq 0$):
        \begin{compactitem}
            \item $k{=}2h$: $(\B{a}\B{b})^h\B{a} d $ holds in $s_k$, but not $(\B{b}\B{a})^{h+1}d$;
            \item $k{=}2h{+}1$: $(\B{b}\B{a})^{h+1}d $ holds in $s_k$, but not $(\B{a}\B{b})^{h+1}\B{a}d$.
        \end{compactitem}
        \noindent Thus, common knowledge can not be achieved between the two generals in a finite number of steps. However, any search algorithm would never terminate, since at each step there is exactly one applicable action that, when applied, results in a new S5$_n$-state.
    \end{example}
