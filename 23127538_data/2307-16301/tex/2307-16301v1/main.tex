%% 
%% Copyright 2007-2020 Elsevier Ltd
%% 
%% This file is part of the 'Elsarticle Bundle'.
%% ---------------------------------------------
%% 
%% It may be distributed under the conditions of the LaTeX Project Public
%% License, either version 1.2 of this license or (at your option) any
%% later version.  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.2 or later is part of all distributions of LaTeX
%% version 1999/12/01 or later.
%% 
%% The list of all files belonging to the 'Elsarticle Bundle' is
%% given in the file `manifest.txt'.
%% 
%% Template article for Elsevier's document class `elsarticle'
%% with harvard style bibliographic references

%\documentclass[preprint,12pt,authoryear]{elsarticle}

%% Use the option review to obtain double line spacing
\documentclass[authoryear,preprint,review,12pt]{elsarticle}

%% Use the options 1p,twocolumn; 3p; 3p,twocolumn; 5p; or 5p,twocolumn
%% for a journal layout:
%% \documentclass[final,1p,times,authoryear]{elsarticle}
%% \documentclass[final,1p,times,twocolumn,authoryear]{elsarticle}
%% \documentclass[final,3p,times,authoryear]{elsarticle}
%% \documentclass[final,3p,times,twocolumn,authoryear]{elsarticle}
%% \documentclass[final,5p,times,authoryear]{elsarticle}
%% \documentclass[final,5p,times,twocolumn,authoryear]{elsarticle}

%% For including figures, graphicx.sty has been loaded in
%% elsarticle.cls. If you prefer to use the old commands
%% please give \usepackage{epsfig}

%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}
%% The amsthm package provides extended theorem environments
\usepackage{amsthm}
\input{preamble}

%% The lineno packages adds line numbers. Start line numbering with
%% \begin{linenumbers}, end it with \end{linenumbers}. Or switch it on
%% for the whole article with \linenumbers.
%% \usepackage{lineno}

\journal{}

\begin{document}

\begin{frontmatter}

%% Title, authors and addresses

%% use the tnoteref command within \title for footnotes;
%% use the tnotetext command for theassociated footnote;
%% use the fnref command within \author or \affiliation for footnotes;
%% use the fntext command for theassociated footnote;
%% use the corref command within \author for corresponding author footnotes;
%% use the cortext command for theassociated footnote;
%% use the ead command for the email address,
%% and the form \ead[url] for the home page:
%% \title{Title\tnoteref{label1}}
%% \tnotetext[label1]{}
%% \author{Name\corref{cor1}\fnref{label2}}
%% \ead{email address}
%% \ead[url]{home page}
%% \fntext[label2]{}
%% \cortext[cor1]{}
%% \affiliation{organization={},
%%            addressline={}, 
%%            city={},
%%            postcode={}, 
%%            state={},
%%            country={}}
%% \fntext[label3]{}

\title{Using Staged Tree Models for Health Data: Investigating Invasive Fungal Infections by Aspergillus and Other Filamentous Fungi}

%% use optional labels to link authors explicitly to addresses:
%% \author[label1,label2]{}
%% \affiliation[label1]{organization={},
%%             addressline={},
%%             city={},
%%             postcode={},
%%             state={},
%%             country={}}
%%
%% \affiliation[label2]{organization={},
%%             addressline={},
%%             city={},
%%             postcode={},
%%             state={},
%%             country={}}

\author[1]{Maria Teresa Filigheddu} 
\author[IE]{Manuele Leonelli}
\author[UV]{Gherardo Varando} 
\author[4]{Miguel Ángel Gómez-Bermejo}
\author[4]{Sofía Ventura-Díaz}
\author[4]{Luis Gorospe}
\author[1,5]{Jesús Fortún}

\affiliation[1]{organization={Infectious Diseases Department, Hospital Ramón y Cajal, IRYCIS (Instituto
Ramón y Cajal de Investigación Sanitaria); Universidad de Alcalá}, city =  {Madrid}, country =  {Spain}}
\affiliation[IE]{organization={School of Science and Technology, IE Univeristy},
city = {Madrid},%Department and Organization
            country={Spain}}
\affiliation[UV]{organization={Image Processing Laboratory (IPL), Universitat de València},%Department and Organization
            city={Valencia},
            country={Spain}}
\affiliation[4]{organization = {Radiology Department, Hospital Universitario Ramón y Cajal}, city = {Madrid}, country = {Spain}}
\affiliation[5]{organization = {Microbiology Department, Hospital Universitario Ramón y Cajal}, city = {Madrid}, country = {Spain}}



\begin{abstract}
Machine learning models are increasingly used in the medical domain to study the association between risk factors and diseases to support practitioners in predicting health outcomes. In this paper, we showcase the use of machine-learned staged tree models for investigating complex asymmetric dependence structures in health data. Staged trees are a specific class of generative, probabilistic graphical models that formally model asymmetric conditional independence and non-regular sample spaces. An investigation of the risk factors in invasive fungal infections demonstrates the insights staged trees provide to support medical decision-making.
\end{abstract}

%%Graphical abstract
%\begin{graphicalabstract}
%% Figure removed
%\end{graphicalabstract}

%%Research highlights
%\begin{highlights}
%\item Research highlight 1
%\item Research highlight 2
%\end{highlights}

\begin{keyword}
%% keywords here, in the form: keyword \sep keyword
Diagnostic criteria \sep Invasive aspergillosis\sep Machine learning \sep Probabilistic graphical models \sep Staged trees
%% PACS codes here, in the form: \PACS code \sep code

%% MSC codes here, in the form: \MSC code \sep code
%% or \MSC[2008] code \sep code (2000 is the default)

\end{keyword}

\end{frontmatter}

%% \linenumbers

%% main text
\section{Introduction}
Risk factors increase an individual's likelihood of negative outcomes for a  particular disease or condition. 
They can range from demographic factors such as age, gender, and ethnicity to behavioral factors such as physical inactivity, smoking, and unhealthy diet. Environmental factors, such as air and water pollution, exposure to radiation, and access to healthcare, also play a role in determining an individual's risk for certain diseases. The study of risk factors and their relationship to medical outcomes is critical in medicine as it can provide insights into the causes of diseases, help identify populations at high risk, and inform the development of prevention and treatment strategies.

Machine learning techniques have emerged as powerful tools for modeling and predicting the relationships between risk factors and medical outcomes. These techniques can analyze large and complex datasets, identify patterns and relationships that are not immediately apparent, and provide predictions with high accuracy. For example, machine learning algorithms have been used to predict the risk of cardiovascular disease in individuals based on electronic health records~\citep{ahsan2022machine} and to identify the risk of developing diabetes in a large population-based cohort~\citep{liao2022development}. As a result, machine learning has become an essential tool for medical research, helping health practitioners, researchers, and policymakers to understand better the impact of risk factors on health outcomes and to develop targeted interventions to prevent or mitigate these risks.

Machine learning techniques have emerged as powerful tools for modeling and predicting the relationships between risk factors and medical outcomes. Recent trends in applied machine learning focused on developing highly complex and black-box models that, while providing high levels of prediction accuracy, lack interpretability and intuitiveness \citep[e.g.][]{alam2019random,painuli2022recent,sun2022deep}. However, there is an increasing awareness of the criticality of developing AI systems that can provide clear and interpretable explanations for their decision-making process. Explainable AI (XAI) can help address the trust and interpretability issues associated with black-box models and increase users' trust and adoption \citep{amiri2021peeking,lime:kdd16}.

Probabilistic graphical models \citep{koller2009probabilistic} are generative machine learning models that visually represent the overall dependence structure using graphs. They do not simply model the conditional distribution of the output of interest given the available risk factors, as in discriminative models, but the overall probability distribution. They thus provide an intuitive platform to perform inferential and independence queries, sensitivity analyses, and risk factors' rankings: all critical activities in applied machine learning modeling \citep{kjaerulff2008bayesian}.

This article showcases the use in medical research of a relatively new class of graphical models called \textit{staged trees} \citep{collazo2018chain,smith2008conditional}. They are probability trees whose inner vertices are colored to embed conditional independence information formally. Recent critical advances have made them a viable, efficient, and highly informative alternative to competitor models in health applications. In particular: (i) a comprehensive software package now implements staged trees for the e of practitioners in any area of science \citep{Carli2022}; (ii) faster and more flexible algorithms to learn staged trees from data have been recently developed, scaling them up to dozen of variables \citep[e.g.][]{leonelli2022highly,shenvi2022beyond}; (iii) novel visualization frameworks allow for an intuitive depiction of the underlying dependence structure between the variables \citep{varando2021staged}; (iv) recent theoretical advances have formalized the use of staged trees for classification problems \citep{carli2020new} and causal reasoning and discovery \citep{leonelli2023context,thwaites2013causal}.

We showcase the use of staged trees for health data by studying the risk factors associated with invasive fungal infections. Invasive fungal infections by aspergillus and other filamentous fungi (henceforth called AFF-IFI) have become a critical public health problem in recent decades~\citep{bongomin2017global}, with an increase in filamentous fungal infections mainly due to Aspergillus spp, and to a lesser extent, Mucor spp and Fusarium spp \citep{lass2009changing}. AFF-IFIs are significantly related to impaired host immune response, having generally affected patients with hematological malignancies, those undergoing hematopoietic stem cell transplantation, or solid organ transplantation under immunosuppressive treatment \citep{de2008revised}.

The most widely used diagnostic criteria \citep{de2008revised,donnelly2020revision} include host factors (mainly immunocompromised conditions), radiological findings (highly specific but also very strict and, as such, are unsuitable for less immunocompromised patients), and microbiological tests. They have been validated on oncohematological patients with a high level of immunosuppression only. However, an increasing number of patients with impaired immunity from other causes have been observed, with various systemic or bronchopulmonary pathologies \citep[among others, critically ill patients admitted to the intensive care unit (ICU) with severe influenza or other viral infections, repeated use of corticosteroids, poorly controlled diabetes, etc.;][]{latge2019aspergillus} with the consequent progressive increase in AFF-IFI in non-oncohematological patients and increased mortality, possibly due to lack of clinical suspicion \citep{menzin2009mortality}.

Diagnosing these patients is not always easy because the AFF-IFI of non-oncohematological patients differs considerably in the degree of immunosuppression and underlying pathologies. Although they have as a common denominator the development of respiratory forms more frequently with bronchopulmonary expression, they are not always identifiable, unlike oncohematological patients who more frequently favor more evident forms of hematogenous expression to diagnose \citep{de2008revised,donnelly2020revision}.

The progressive increase in AFF-IFI in non-oncohematological patients with various systemic or bronchopulmonary pathologies has been associated, contrary to expectations, with an increase in mortality, possibly due to a lack of clinical suspicion \citep{menzin2009mortality}. In particular, due to its prevalence and expensive treatment, it has become the most expensive fungal disease in the hospital setting \citep{benedict2019estimation}.


The emergent threat of invasive fungal diseases is driven by antifungal resistance and limited global access to diagnostic tools and treatments \citep{brown2012hidden, whoFungal}.
This menace has vast implications for public health worldwide. It usually gives on to more extended hospital stays and treatments, including the need for expensive antifungal medicines, which are often unavailable in developing countries~\citep{van2011clinical, whoFungal},
Even if fungal infections have been recently recognized as a growing threat to human health worldwide, 
their study and clinical monitoring receive little resources at a global level~\citep{bongomin2017global}.
This fact hinders our understanding of the problem and makes it impossible to understand its exact burden on public health \citep{whoFungal}.


Machine learning techniques for risk prediction and factor identification have only recently started to be used in AFF-IFIs \citep{li2022machine,mayer2022machine,yan2022machine,yuan2021using}. Only \citet{potter2019combat} developed a decision support system based on probabilistic graphical models for combat-related AFF-IFI patients.  With the present study, we contribute to developing robust and interpretable machine-learning approaches to understanding AFF-IFI diseases.

The two case studies below highlight the critical need to devise new diagnostic criteria, more widely applicable than the gold standard~\citep{de2008revised,donnelly2020revision}, including the overlooked non-conventional group and broncoinvasive patterns, instead of angioinvasive ones only.

\subsection{Health Applications}

Data-driven algorithms for discovering the genetic causes of various diseases are most commonly based on DAGs \citep[e.g.][]{corander2022causal,foraita2020causal,pingault2022causal}. Applications of such causal discovery algorithms for understanding clinical risk factors have also recently started to appear \citep{tennant2021use,VELIKOVA201459}. Conversely, the use of BNs as a decision-support tool for practitioners and as a platform for the study of risk factors is not as widespread \citep{kyrimi2020bayesian, kyrimi2021comprehensive,kyrimi2021bayesian, mclachlan2020bayesian}, although recently they have been more frequently used \citep[e.g.][]{song2023using,tian2023bayesian,van2022feasibility}.

Tree-based machine learning algorithms are standard in health, for instance, decision trees \citep{doupe2019machine,kilic2020artificial}. However, these are not probability trees formally and highly differ from staged trees. 
Simple probability (or frequency) trees are vastly used in 
health and medical literature~\citep{ LEFRANCQ2021} 
and are helpful to practitioners in computing probability queries~\citep{detsky1997primer, binder2018visualizing}.
Staged trees have been used in four medical applications in the past to investigate: type I diabetes \citep{keeble2017learning}, the effect of social and economic factors on kids' health \citep{barclay2013refining}, covid-19 trajectories \citep{leonelli2023context}, and data missingness patterns in health data \citep{barclay}. 

\section{Materials and Methods}

\subsection{Data}

Retrospectively included in the study were all non-oncohaematological patients diagnosed with proven, probable, or possible pulmonary AFF-IFI according to different diagnostic scales during 1998-2021 in 3 hospitals in the
Community of Madrid, Spain (Hospital Ramón y Cajal, Hospital Doce de Octubre, Hospital Universitario Fundación Alcorcón) 
and two hospitals in the metropolitan city of Cagliari, Autonomous Region of Sardinia (Ospedale Santissima Trinitá di Dio and Ospedale Azienda Sanitaria G. Brotzu). 
The radiological findings were reviewed and described by three radiologists blinded to patients' characteristics.

The chest CT findings and radiological pattern (RP, categorized as angioinvasive or broncoinvasive)) of 146 patients\footnote{The small sample size is due to the limited widespread of AFF-IFI. Related studies include comparable  patients" samples if not smaller~\citep{liu2020airway,park2010clinical}.} with pulmonary AFF-IFI and its prognostic value in non-oncohaematological patients divided into three groups (GR) according to the degree of immunosuppression have been assessed. The first group includes patients with neutropenia not related to haematological diseases (neutropenic group); the second includes patients who do not have neutropenia and have at least one of the following: solid organ transplant and/or tumour, inflammatory/autoimmune diseases, congenital or acquired immunodeficiency, or use of corticosteroids (conventional group); the third includes patients who, in the absence of neutropenia or another ``conventional" immunosuppression factor, present alterations in innate and/or adaptive immunity described in the literature as related to specific populations at risk of AFF-IFI (non-conventional group). Despite the known relationship between this group and AFF-IFI mortality, their risk factors are not included in the most widely used diagnostic scales. Therefore they are often not diagnosed with AFF-IFI. 

Moreover, we consider the patient trajectory as recorded in the hospital: if entered the intensive care unit (ICU), if intubation is performed (IN) and finally the 
survival outcome (DTH).

In a second case study, we consider additional risk factors for AFF-IFI that are known to be individually associated with an increase in mortality~\citep{gioia2021invasive,park2010clinical}. These are reported in Table~\ref{table:variables} together with 
previous variables.


\begin{table}
  \caption{Variables considered for the population under study, acronyms, and variables' levels. Sample distribution in each level is shown in parentheses.\label{table:variables}}
  
  \scalebox{0.6}{
   \renewcommand{\arraystretch}{1.2}
\begin{tabular}{c|c|c}
\hline
Variable & Acronym & Levels\\
\hline
\textbf{\cellcolor{gray!6}{GROUP}} & \cellcolor{gray!6}{GR}& \cellcolor{gray!6}{Neutropenic (9), Conventional (105), Non-conventional (32)}\\
\hline
\textbf{RADIOLOGICAL PATTERN} & RP & Angioinvasive (80), Broncoinvasive (66)\\
\hline
\textbf{\cellcolor{gray!6}{ICU}} & \cellcolor{gray!6}{ICU}& \cellcolor{gray!6}{No (74), Yes (72)}\\
\hline
\textbf{INTUBATION} & INT & No (80), Yes (66)\\
\hline
\textbf{\cellcolor{gray!6}{DEATH}} & \cellcolor{gray!6}{DTH}& \cellcolor{gray!6}{No (91), Yes (55)}\\
\hline
\textbf{IMMUNOTHERAPY} & IM & No (54), Yes (77) \\
\hline
\textbf{\cellcolor{gray!6}{SYSTEMIC CORTICOIDS}} & \cellcolor{gray!6}{SC}& \cellcolor{gray!6}{No (91), Yes (40)}\\
\hline
\textbf{PREVIOUS NEUTROPENIA} & PN & No (123), Yes (8)\\
\hline
\textbf{\cellcolor{gray!6}{VIRAL PNEUMONIA}} & \cellcolor{gray!6}{VP}& \cellcolor{gray!6}{No (103), Yes (28)}\\
\hline
\textbf{CMV INFECTION} & CMV & No (99), Yes (32)\\
\hline
\textbf{\cellcolor{gray!6}{DIAGNOSTIC TIME}} &\cellcolor{gray!6}{DT}& \cellcolor{gray!6}{$<16$ (54), $\geq 16$ (77)}\\
\hline
\textbf{SOLID ORGAN TRANSPLANT} & SOT & No (79), Yes (52)\\
\hline
\textbf{\cellcolor{gray!6}{MALNUTRITION}} & \cellcolor{gray!6}{MN}& \cellcolor{gray!6}{No (46), Yes (85)}\\
\hline
\end{tabular}
}
\end{table}


\subsection{Logistic Regression}

Simple univariate logistic regressions for variables ICU, INT, and DTH are fitted to data, using as predictor GR, RP, and the preceding variables in the trajectory (ICU $\rightarrow$ INT $\rightarrow$ DTH).  

To study the relationship between the predictors and their effect on the probability of death, we fitted a group LASSO logistic regression~\citep{yang2015fast}, where the regularization parameter was chosen via a 5-fold cross-validation. The model includes as predictors also all 2-way interactions.

\subsection{Bayesian Networks}

Evolving from the path coefficients
method of~\cite{wright1934method}, 
Bayesian Network (BN) 
models~\citep{pearl1988probabilistic} have become
powerful tools in data science and 
statistics~\citep{bielza2014discrete, bielza2014bayesian}. 
A BN defines a factorization of a random vector's probability mass function (pmf) using a directed acyclic graph (DAG). More formally, let $[p]=\{1,\dots,p\}$ and $\bm{Y}=(Y_i)_{i\in[p]}$ be a random vector of interest with sample space $\mathbb{Y}=\times_{i\in[p]}\mathbb{Y}_i$. A BN defines the pmf $P(\bm{Y}=\bm{y})$, for $\bm{y}\in\mathbb{Y}$, as a product of simpler conditional pmfs as follows:
%
\begin{equation}
P(\bm{Y}=\bm{y}) = \prod_{i\in[p]}P(Y_i=y_i\;|\; \bm{Y}_{\Pi_i}=\bm{y}_{\Pi_i}),
\end{equation}
%
where ${\Pi_i}$ are the parents of $i$ in the DAG associated to the BN. Assuming variables are topologically ordered, the BN is moreover, defined by the (symmetric) conditional independence statements $Y_i\independent Y_{[i-1]}|Y_{\Pi_i}$.

The DAG associated with a BN provides an intuitive overview of the relationships between variables of interest. However, it also provides a framework to assess if any generic conditional independence holds for a specific subset of the variables via the so-called d-separation criterion \citep[e.g.][]{pearl1988probabilistic}. Furthermore, the DAG provides a framework for the efficient propagation of probabilities and evidence via algorithms that take advantage of the structure of the underlying DAG~\citep{cowell2007probabilistic}.

Although the underlying DAG can be elicited using expert judgment, it is most commonly learned from data using nuanced optimization algorithms~\citep[e.g.][]{scutari2019learns, glymour2019review}.
Moreover, BNs and DAGs are the gold standards for representing and learning causality from data, providing an intuitive framework for defining causal interventions and predicting their effects~\citep{pearl2009causality,peters2017elements,glymour2019review}.

%Bor build classifier N can be  defined for general random variables; they are extensively used,  for instance, with Gaussian distributions~\citep{geiger1994learning,koller2009probabilistic}. 

We fit a BN over the same five variables as the logistic regression (GR, RP, ICU, INT and DTH). Since BNs are generative models, they estimate a full probability distribution over all variables, formally modelling their dependence. In particular, a BN is learned using 5000 bootstrap replications of the \texttt{tabu} algorithm implemented in \texttt{bnlearn}~\citep{Scutari2010}, enforcing the causal order GR, RP, ICU, INT, and DTH. Arcs appearing in more than 50\% of the replications are then retained in the final model. 

Similarly in the second case study (Section~\ref{sec:case2}) a 
BN is fitted using the same procedure over all the variables in Table~\ref{table:variables} but INT. 

\subsection{Staged Trees}

There is an increasing awareness that the stringent assumption of \emph{symmetric} conditional independence of DAGs may be too restrictive in applications~\citep{mokhtarian2022causal,pensar2016role,tikka2019identifying}. The most common non-symmetric conditional independence is \emph{context-specific}~\citep{Boutilier1996}: the independence between two variables holds only for  specific values (called this context) of conditioning variables: e.g. $Y_i\independent Y_j | Y_k = y_k$ for a specific $y_k\in \mathbb{Y}_k$. 
More flexible and generic types of independence statements have been defined, namely partial and local~\citep{pensar2016role}.

Although models accounting for non-symmetric independence have been defined, staged trees~\citep{collazo2018chain,smith2008conditional} are the only ones 
 extensively studied and implemented in user-friendly software~\citep{Carli2022}. Since a precise definition of staged trees is beyond this paper's scope and can be found elsewhere~\citep{duarte2021representation,varando2021staged}, we introduce them next with an example.

% Figure environment removed


Figure~\ref{fig:st} reports a staged tree over four binary random variables $A, B, C, D$, each taking values in $\{0,1\}$. Each root-to-leaf path represents an atomic event (an assignment of all four variables), and inner vertices with corresponding emanating edges are associated with conditional probabilities. For instance, $v_1$ is associated with the conditional distribution of $B$ conditional on $A=0$. Colors of the inner vertices are interpreted as equality of conditional distributions: the blue vertices $v_1$ and $v_2$ denote that $P(B|A=0)=P(B|A=1)$, or equivalently $A\independent B$.

The flexibility of the coloring allows for asymmetric forms of independence. For instance the cyan colored vertices $v_{7}-v_{10}$ denote the context-specific independence $D\independent B, C|A=1$. 
Instead, the yellow and green vertices represent 
$D\independent B| C, A=0$.
Finally, red and orange vertices (at depth 2 from the root) are associated with so-called local independences~\citep{pensar2016role}, where no discernable patterns can be identified since they imply 
equalities $P(C|A=0, B=0)=P(C|A=1, B=1)$ and $P(C|A=0, B=1)=P(C|A=1, B=0)$.
Every BN can be represented exactly as a staged tree~\citep{varando2021staged}, while the reverse does not hold since the coloring allows for non-symmetric independence statements which have no graphical representation in a DAG. 

Although, as for BNs, staged trees could be elicited from experts, they are most often learned from data using heuristic algorithms~\citep{Carli2022, leonelli2022highly}.

%The stringent assumption of symmetric conditional independence in standard BNs, which are not flexible enough to learn complex dependence patterns, could 
%in general result in more sparse (or simpler) models. 
We employ a staged tree model to provide a flexible picture of patients' trajectories and outcomes. A priori, we fix the ordering of the variables as GR, RP, ICU, INT, and DTH to represent the actual steps of the patient's trajectory.

For the second case study, learning a staged tree over eleven binary and one ternary variable is challenging because of the exponentially growing model space size \citep[e.g.][]{duarte2021representation}. Visualizing the staged tree would also be impossible as it would include $2^{11}\cdot 3=6144$ leaves. To circumvent the visualization issue,
\citet{varando2021staged} defined the so-called \textbf{minimal DAG}: a DAG representation of the staged tree such that two variables are d-separated in the minimal DAG if and only if the coloring of the staged tree embeds the associated conditional independence. 

Because of the high flexibility of the coloring of staged trees, minimal DAGs of staged trees are usually fully connected unless some sparsity is imposed in the structural learning algorithms. Sparsity is the gold standard in Gaussian probabilistic graphical models \citep[e.g.][]{friedman2008sparse}. In the context of discrete BNs, one of the first attempts to impose sparsity was to limit the number of parents each variable can have \citep{friedman1999learning,tsamardinos2006max}. This makes sense from an applied point of view since, most often, only a limited number of variables can be expected to influence another directly. Setting a maximum number of parents is also available in the standard \texttt{bnlearn} software \citep{Scutari2010}. 


Limiting the maximum number of parents further decreases the size of the possible models, speeding up structural learning algorithms. For this reason, \citet{leonelli2022highly} introduced learning algorithms for \textbf{$k$-parents} staged trees: staged trees whose minimal DAG has a maximum in-degree less or equal to $k$.

\section{Results}

\subsection{1st Case Study}

\begin{table}
  \caption{Odds ratios, confidence intervals and p-values for univariate logistic regressions to predict death. \label{table:logistic}}
  \scalebox{0.6}{
  \renewcommand{\arraystretch}{1.2}
\begin{tabular}{ccccccc}
\toprule
Response & Predictor & Term & OR & CI.Low & CI.High & P-value\\
\midrule
{\cellcolor{gray!6}{DEATH}}&{\cellcolor{gray!6}{GROUP}} & \cellcolor{gray!6}{Neutropenic (Intercept)} & \cellcolor{gray!6}{0.80} & \cellcolor{gray!6}{0.20} & \cellcolor{gray!6}{3.02} & \cellcolor{gray!6}{0.74}\\
{DEATH}&{GROUP} & Conventional & 0.71 & 0.18 & 3.01 & 0.62\\
{\cellcolor{gray!6}{DEATH}}&{\cellcolor{gray!6}{GROUP}} & \cellcolor{gray!6}{Non-Conventional} & \cellcolor{gray!6}{1.10} & \cellcolor{gray!6}{0.25} & \cellcolor{gray!6}{5.18} & \cellcolor{gray!6}{0.90}\\
{DEATH}&{RADIOLOGICAL PATTERN} & Bronco. (Intercept) & 0.51 & 0.32 & 0.80 & 0.00\\
{\cellcolor{gray!6}{DEATH}}&{\cellcolor{gray!6}{RADIOLOGICAL PATTERN}} & \cellcolor{gray!6}{Angio.} & \cellcolor{gray!6}{1.64} & \cellcolor{gray!6}{0.84} & \cellcolor{gray!6}{3.22} & \cellcolor{gray!6}{0.15}\\
{DEATH}&{ICU} & No (Intercept) & 0.37 & 0.22 & 0.61 & 0.00\\
{\cellcolor{gray!6}{DEATH}}&{\cellcolor{gray!6}{ICU}} & \cellcolor{gray!6}{Yes} & \cellcolor{gray!6}{2.85} & \cellcolor{gray!6}{1.44} & \cellcolor{gray!6}{5.77} & \cellcolor{gray!6}{0.00}\\
{DEATH}&{INTUBATION} & No (Intercept) & 0.40 & 0.24 & 0.65 & 0.00\\
{\cellcolor{gray!6}{DEATH}}&{\cellcolor{gray!6}{INTUBATION}} & \cellcolor{gray!6}{Yes} & \cellcolor{gray!6}{2.63} & \cellcolor{gray!6}{1.34} & \cellcolor{gray!6}{5.27} & \cellcolor{gray!6}{0.01}\\
\midrule
{INTUBATION}&{GROUP} & Neutropenic (Intercept) & 0.13 & 0.01 & 0.68 & 0.05\\
{\cellcolor{gray!6}{INTUBATION}}&{\cellcolor{gray!6}{GROUP}} & \cellcolor{gray!6}{Conventional} & \cellcolor{gray!6}{5.77} & \cellcolor{gray!6}{1.00} & \cellcolor{gray!6}{109.0} & \cellcolor{gray!6}{0.10}\\
{INTUBATION}&{GROUP} & Non-Conventional & 15.2 & 2.37 & 302.8 & 0.02\\
{\cellcolor{gray!6}{INTUBATION}}&{\cellcolor{gray!6}{RADIOLOGICAL PATTERN}} & \cellcolor{gray!6}{Bronco. (Intercept)} & \cellcolor{gray!6}{0.95} & \cellcolor{gray!6}{0.61} & \cellcolor{gray!6}{1.48} & \cellcolor{gray!6}{0.82}\\
{INTUBATION}&{RADIOLOGICAL PATTERN} & Angio. & 0.73 & 0.37 & 1.40 & 0.34\\
{\cellcolor{gray!6}{INTUBATION}}&{\cellcolor{gray!6}{ICU}} & \cellcolor{gray!6}{No (Intercept)} & \cellcolor{gray!6}{0.00} & \cellcolor{gray!6}{0.00} & \cellcolor{gray!6}{Inf} & \cellcolor{gray!6}{0.99}\\
{INTUBATION}&{ICU} & Yes & 0.00 & 0.00 & Inf & 0.99\\
\midrule
{\cellcolor{gray!6}{ICU}}&{\cellcolor{gray!6}{GROUP}} & \cellcolor{gray!6}{Neutropenic (Intercept)} & \cellcolor{gray!6}{0.29} & \cellcolor{gray!6}{0.04} & \cellcolor{gray!6}{1.18} & \cellcolor{gray!6}{0.12}\\
{ICU}&{GROUP} & Conventional & 2.95 & 0.67 & 20.4 & 0.19\\
{\cellcolor{gray!6}{ICU}}&{\cellcolor{gray!6}{GROUP}} & \cellcolor{gray!6}{Non-Conventional} & \cellcolor{gray!6}{7.70} & \cellcolor{gray!6}{1.54} & \cellcolor{gray!6}{58.3} & \cellcolor{gray!6}{0.02}\\
{ICU}&{RADIOLOGICAL PATTERN} & Bronco. (Intercept) & 0.95 & 0.61 & 1.48 & 0.82\\
{\cellcolor{gray!6}{ICU}}&{\cellcolor{gray!6}{RADIOLOGICAL PATTERN}} & \cellcolor{gray!6}{Angio.} & \cellcolor{gray!6}{1.05} & \cellcolor{gray!6}{0.55} & \cellcolor{gray!6}{2.02} & \cellcolor{gray!6}{0.88}\\
\bottomrule
\end{tabular}
}
\end{table}


\label{sec:case1}
We start investigating the effect of the groups' allocation and the radiological pattern on the patient trajectory in the hospital: first, if they enter the ICU; second, if they are intubated; and, ultimately, whether they die.

Table \ref{table:logistic} reports the results of the univariate logistic regression analysis, suggesting that access to ICU (OR = 2.85) and intubation (OR = 2.63) are the only two significant predictors of death. Concerning intubation and access to ICU, patients of the non-conventional group have a much higher risk (OR INTUBATION = 15.2; OR ICU = 7.70), possibly because they tend to have longer diagnosis times since they are usually not considered at risk of AFF-IFI.

 Table \ref{table:lasso} reports the estimated ORs and, except for the interaction RP:ICU, all two-way interactions are estimated not to be relevant (OR = 1). Moreover, as a discriminative model, logistic regression cannot provide additional information about the relationships between risk predictors.


\begin{table}
\centering
  \caption{Estimated ORs for LASSO logistic regression with 2-way interactions to predict DEATH. Only ORs different from 1 are reported.\label{table:lasso}}
  \scalebox{0.8}{
 %\renewcommand{\arraystretch}{1.5}
\begin{tabular}{cc}
\toprule
Term & OR\\
\midrule
{{Intercept}} & {0.47}\\
%{GROUP = conventional} & 1.00\\
%{\cellcolor{gray!6}{GROUP = non-conventional}} & \cellcolor{gray!6}{1.00}\\
%{RADIOLOGICAL PATTERN = Angio.} & 1.00\\
{\cellcolor{gray!6}{ICU = yes}} & \cellcolor{gray!6}{1.65}\\
%{INTUBATION = yes} & 1.00\\
%{\cellcolor{gray!6}{GROUP = conventional \& RADIOLOGICAL PATTERN = Angio.}} & \cellcolor{gray!6}{1.00}\\
%{GROUP = non-conventional \& RADIOLOGICAL PATTERN = Angio.} & 1.00\\
%{\cellcolor{gray!6}{GROUP = conventional \& ICU = yes}} & \cellcolor{gray!6}{1.00}\\
%{GROUP = non-conventional \& ICU = yes} & 1.00\\
%{\cellcolor{gray!6}{GROUP = conventional \& INTUBATION = yes}} & \cellcolor{gray!6}{1.00}\\
%{GROUP = non-conventional \& INTUBATION = yes} & 1.00\\
{{RP = Angio. \& ICU = yes}} & {1.28}\\
%{RADIOLOGICAL PATTERN = Angio. \& INTUBATION = yes} & 1.00\\
%{\cellcolor{gray!6}{ICU = yes \& INTUBATION = yes}} & \cellcolor{gray!6}{1.00}\\
\bottomrule
\end{tabular}
}
\end{table}


Figure~\ref{fig:bn1} reports the learned BN, which suggests that the group (GR) and the radiological pattern (RP) are independent of the patient's trajectory. Indeed, the group affects the radiological pattern and intubation is independent of death conditional on ICU. 
For completeness, we also try other classical DAG learning algorithms, such as the order stable version of the PC algorithm~\citep{colombo14a} and 
the max-min hill-climbing hybrid algorithm~\citep{tsamardinos2006max}, which both obtain the simpler DAG with the only edges GR$\rightarrow$RP and 
ICU$\rightarrow$INT.


Figure \ref{fig:lifehc} reports the staged tree learned with a hill-climbing greedy algorithm minimizing the BIC  \citep{gorgen2022curved} using the \texttt{stagedtrees} R package \citep{Carli2022}.


% Figure environment removed

The tree is highly expressive and intuitively shows:
\begin{itemize}
    \item The presence of combinations of variables not observed in the data. For instance, all patients in the neutropenic group with a broncoinvasive pattern enter the ICU.
    \item A non-product sample space. It is known that patients who do not enter the ICU cannot be intubated. For this reason, after the edge ICU = no, the edge INT = no 
    is always the only option.
    \item A highly non-symmetric pattern of dependence by the coloring of internal vertices, which BNs cannot generally represent.
\end{itemize}

Clinically we observe the following.
Patients in the non-conventional and conventional groups are equally likely to have the same radiological pattern ($v_2$-$v_3$). In particular, these two groups of patients are more likely to have a broncoinvasive pattern (58\%), whereas neutropenic patients are more likely to have an angioinvasive pattern (89\%). Admission to the ICU does not depend on the radiological pattern in the case of unconventional and conventional patients ($v_6$-$v_9$), but admission itself is higher in unconventional patients (70\%). On the other hand, the radiological pattern does affect the probability of admission to the ICU in the case of neutropenic patients. Neutropenic patients with a broncoinvasive pattern have a higher probability (70\%) of accessing the ICU than patients with an angioinvasive pattern (43\%). Thanks to the colors, we can see that the probability of ICU admission of neutropenic patients with a broncoinvasive pattern and non-conventional patients is the same. The same observation holds for neutropenic patients with an angioinvasive pattern, and conventional patients.

Upon admission to the ICU, patients with a broncoinvasive pattern have a 100\% chance of being intubated regardless of the group ($v_{10},v_{12},v_{14}$). Patients in the non-conventional and conventional groups are estimated to have the same chance of being intubated (82\%), while no neutropenic patients with an angioinvasive pattern are intubated.

Intubated patients with an angioinvasive pattern from the not-conventional and conventional groups have the same estimated  chance of dying, which reaches 63\% ($v_{24}$ and $v_{29}$). In contrast, the patients with the highest survival (82\%) are non-intubated individuals from the not-conventional group with an angioinvasive pattern and ICU admission ($v_{30}$) or conventional patients with a broncoinvasive pattern without ICU admission ($v_{28}$). Patients in the non-conventional group who have not been admitted to the ICU have a survival of 56\%, regardless of the radiological pattern ($v_{31}, v_{33}$). Not-conventional and conventional patients with a broncoinvasive pattern admitted to the ICU and intubated  ($v_{27},v_{32}$) have the same estimated survival probability of 56\%. Equally 56\% survival probability is found in not intubated ICU patients with an angioinvasive pattern in the conventional group ($v_{25}$). Conventional and neutropenic patients who have not been admitted to the ICU with an angioinvasive pattern have instead a 71\% probability of survival 
($v_{22}$, $v_{26}$). All neutropenic patients admitted to the ICU have died regardless of the radiological pattern and intubation 
($v_{21}$, $v_{23}$).

% Figure environment removed

\subsection{2nd Case Study}

\label{sec:case2}
The previous case study is highly suited for staged tree modeling since it includes a limited number of variables, with an explicit causal ordering and an asymmetric sample space that the tree can explicitly and intuitively represent. However, recent advances in staged tree theory have made them a viable and efficient tool to investigate dependence in more complex scenarios, including a more extensive array of risk factors, as we showcase in the following data application. 

We now consider all risk factors included in Table \ref{table:variables}, except for INT. Observations with missing values were dropped, giving 131 patients. Figure \ref{fig:bn2} reports the BN learned using the same procedure as in Section \ref{sec:case1}, where edges from DEATH, ICU, and DT to other variables are forbidden for ease of interpretation. ICU is the only parent of DEATH: thus, all other risk factors are independent of DEATH conditionally on ICU. Similarly, conditional on SYSTEMIC CORTICOIDS, all other risk factors, except ICU, are independent of DEATH. RADIOLOGICAL PATTERN, MALNUTRITION, and DIAGNOSTIC TIME are marginally independent of DEATH. This implies, for instance, that angioinvasive and broncoinvasive patients have the same probability of dying. The BN provides an intuitive representation of the variables' dependence and an efficient platform to answer inferential queries. For instance, we can straightforwardly compute the probability that a patient who enters the ICU has a solid organ transplant (probability equal to 0.35). Similarly, we can compute any other probability of interest from the model.

% Figure environment removed


% Figure environment removed

 Figure \ref{fig:aldag} reports the minimal DAG of the 2-parents staged tree over the AFF-IFI death-related risk learned using the algorithm of \citet{leonelli2023learning}. We chose two parents to find a balance between the goodness of fit and ease of interpretation. This minimal DAG reveals a much more involved dependence pattern. DIAGNOSTIC TIME, assumed to be marginally independent of DEATH by the BN, directly influences it. GROUP is a central variable that directly affects DIAGNOSTIC TIME, SYSTEMIC CORTICOIDS, RADIOLOGICAL PATTERN, IMMUNOTHERAPY, SOLID ORGAN TRANSPLANT, CMV INFECTION, and VIRAL PNEUMONIA. No variables are assumed to be marginally independent of DEATH. 

The 2-parents staged tree better fits the data, having a BIC of 1706.433, against that of the BN equal to 1758.461. Given the small dataset, checking predictive accuracy would be unreliable. However, staged trees have been shown to often outperform BNs in predictive tasks~\citep{carli2020new}.



% Figure environment removed



The minimal DAG of the staged tree provides a compressed, partial vision of the staged tree dependence structure. However, such an asymmetric structure is still learned from data. It can be visualized for each variable using a \textbf{dependence subtree} \citep{varando2021staged}, reporting the conditional independence coloring of a variable given its parents. Figure \ref{fig:depsub} reports the dependence subtree associated with the variable DEATH in the minimal DAG of Figure \ref{fig:aldag}. It shows that DEATH is conditionally independent of DIAGNOSTIC TIME given ICU = yes. Patients with a short diagnostic time who do not access the ICU have the smallest probability of death (11\%).

The group patients belong to, which has already been observed to be associated with the radiological pattern, has a direct influence on the diagnostic time, which in turn affects mortality. The dependence subtree for DIAGNOSTIC TIME in Figure \ref{fig:hola} shows that non-conventional patients, usually not considered by diagnostic criteria, tend to have a longer diagnostic time. For this reason, the use of new diagnostic criteria that consider the broncoinvasive radiological pattern and a broader classification of risk groups would lead to a rapid diagnosis of AFF-IFI patients, possibly entailing a reduction in mortality. In turn, the use of these criteria would lead to a reduction in hospital pressure in ICU (as observed in case study 1) with a consequent reduction of hospitality costs and an increase in survival \citep{menzin2009mortality}.


%Because staged trees model the entire distribution of the risk factors, they can provide various model-based measures of association and information. Table \ref{table:mi} reports the marginal mutual information between DEATH and each risk factor. As expected, ICU and DT are the risk factors with the strongest influence on death. Notice that in the case of the BN in Figure \ref{fig:bn2}, the mutual information between DT and DEATH would have been estimated as zero, since they are marginally independent. Table \ref{table:mi} further reports the mutual information between DEATH and each risk factor conditional on one risk factor being observed. In parenthesis, the variation from the marginal value is reported. For instance, GROUP has a mutual information of 0.045/100 with DEATH, which increases by 19.3\%, knowing whether a patient entered the ICU. Conversely, it decreases by 24.6\% conditional on the outcome of IMMUNOTHERAPY. Although standard for BNs, this mutual information analysis was never carried out for staged trees.


\section{Discussion}

Observations from the results on the first case study (Section~\ref{sec:case1}) reinforce what has been described in the literature, that non-neutropenic patients (conventional and not-conventional) tend to develop respiratory forms more frequently with bronchopulmonary patterns  \citep{liu2020airway,nucci2010probable,nucci2013early,park2010clinical}, although they differ considerably in the type of underlying diseases and degree of immunosuppression. On the other hand, neutropenic patients more frequently present angioinvasive patterns \citep{de2008revised,latge2019aspergillus}. Regarding actionable conclusions, the observations drawn from the staged tree highlight the need to include information about broncoinvasive patterns in the diagnostic criteria for AFF-IFI since the gold standard EORTC criteria \citep{de2008revised,donnelly2020revision} completely overlook them.  We are currently working on proposing extended diagnostic criteria based on the results of this study. However, their discussion is beyond the scope of this paper.


\section{Conclusions}

Recently staged trees have been the focus of research, leading to a better understanding of their underlying dependence structure, more flexible visualization platforms, more efficient data learning algorithms, and open-source implementations. Given all these advances, staged trees can now provide unique insights into data-driven health applications to support practitioners in the real world.

% Figure environment removed

Two case studies in AFF-IFIs demonstrated the flexibility of staged trees in intuitively representing highly asymmetric patterns of dependence, which BNs cannot explicitly visualize. Furthermore, they provide an efficient platform to answer inferential and independence queries and sensitivity analyses. Using staged trees helped clinicians understand the relationship between risk factors in AFF-IFI more intuitively than BNs.

From a clinical perspective, the analysis showed that the non-conventional group, usually not considered by standard diagnostic scales, shares many characteristics and risks with the neutropenic and conventional groups. Therefore this observation highlights the need to construct more widely applicable entry criteria for diagnostic scales in AFF-IFIs for the timely diagnosis of this group of often overlooked patients. Furthermore, the analysis has shown that the broncoinvasive radiological pattern, not considered within the gold standard diagnostic criteria, plays a critical role in AFF-IFI. Its full clinical appraisal would lead to a timely diagnosis and, consequently, a decrease in mortality.

Despite the small sample size and the lack of statistical validation techniques, all the insights given by staged trees match the clinical intuition of the doctors
in our study and information from established literature \citep{liu2020airway,park2010clinical}. However, the staged tree provided a more intuitive platform for their interpretation and discussion among clinicians than numerical tables commonly reported in medical studies.


%% The Appendices part is started with the command \appendix;
%% appendix sections are then done as normal sections
%% \appendix

%% \section{}
%% \label{}

%% If you have bibdatabase file and want bibtex to generate the
%% bibitems, please use
%%
\bibliographystyle{elsarticle-harv} 
\bibliography{biblio}
\end{document}

\endinput
%%
%% End of file `elsarticle-template-harv.tex'.
