\section{$\single$ as an EVP}\label{sec:equilibrium_proof}

In this section, we provide our main result. Namely, that the protocol $\single$ is an EVP according to Definition~\ref{def:EVP}. In our theorem statement, we quantify over a class of adversaries whose strategy does not result in the mining of blocks that are ``almost'' empty (i.e., they contain only the special payment transaction $\tx_T$). As we shortly explain, restricting to this class is meaningful and does not harm the generality of our result. In particular, we define the following type of adversary.

For some round $T$, let $\{\mbf{V}_1,\ldots,\mbf{V}_{K_T}\}$ be the partition of the party set $\{\party{1},\ldots,\party{n}\}$ such that for every $i\in[K_T]$, the parties in $\mbf{V}_i$ form a pool according to Definition~\ref{def:pool} (trivially, if $\mbf{V}_i$ is a singleton, then the single party in $\mbf{V}_i$ acts on its own). We say that an adversary $\mathcal{A}$ that controls a coalition $\corrupt\subset\{\party{1},\ldots,\party{n}\}$ is \emph{$\mc{O}_\msf{tx}$-respecting} if for every round $T$ and every $\mbf{V}_i$, $i\in[K_T]$, there is at least one party in $\mbf{V}_i$ that asks the transaction oracle $\mc{O}_\msf{tx}$ during $T$. 

We stress that if we lift the above restriction and quantify over all adversaries in our theorem statement, then using similar proof techniques, we can show that a variant of $\single$ where the leader never queries $\mc{O}_\msf{tx}$, ignores its input transactions, and sets the record as the singleton that includes only the special payment transaction (cf. Remark~\ref{rem:variant} for the variant description details), is an EVP. This strategy profile is related to the verifier's dilemma introduced in~\cite{LuuTKS15}, according to which miners are motivated to skip verification of transactions when the cost is significant.  Observe that this variant of $\single$ forms again a single pool with all the parties (which means that is again completely centralized), but violates liveness\footnote{A blockchain protocol satisfies liveness, if every transaction that has been issued and diffused by an honest party  will be included eventually in the ledger with $1-\negl(\secpar)$ probability~\cite{backbone}}. In our main theorem, we do not follow this direction, as for this variant to be functional, it is necessary that there is no external observer that can check the validity of the chain and affect the profit of the parties. This is not true in practice, as external users can easily detect that the blocks are empty, harm the reputation of the system, and thus affect the price of the currency the parties of the pool earn.% (cf. Remark~\ref{rem:variant} for details). 

Our main theorem statement relies on three reasonable assumptions: (i) the expected rewards per random oracle query are higher than the cost of the query and the cost needed to form the instance for the query (recall that the rewards and the costs are in the same unit), (ii) $\pb=\Omega(\frac{1}{nq})$, and (iii) $\pf<\tfrac{1}{2}$. Moreover, the multiplicative approximation factor is zero. Besides, the three dominant terms in the additive approximation factor are justified as follows:
\begin{enumerate}
    \item[(a)] The term $O\big(\rounds(n-1)\big)\pf\reward$ (a small fraction of the adversary's expected total rewards) appears because the EVP notion compares the exact profit of the adversary in the two executions with $1-\negl(\secpar)$ probability.
    \item[(b)] The term $O\big(\log\secpar\sqrt{\rounds}\big)\cost_\msf{lc}$ (the difference between $\umax(\exec{})$ and $\umin(\honexec)$ in the cost of asking the longest chain oracle) is due to the same reason as above.
   \item[(c)] The term $O\big( \rounds(n-1)\big)\cost_\msf{ltx}$ (the difference between $\umax(\exec{})$ and $\umin(\honexec)$ in the cost of asking the light transaction oracle) derives from the fact that in $\umax(\exec{})$, the parties check that they have got paid correctly by the pool leader. Typically, the cost for this check is relatively small.
\end{enumerate}

\begin{theorem}
\label{th:equilibrium}
%Assuming that the adversary cannot participate in the mining process without asking the transaction oracle $\mc{O}_\msf{tx}$ %\footnote{We can enforce this assumption by modifying the transaction and the random oracle as follows: The transaction $\mc{O}_\msf{tx}$ retains a flag that is initialized as negative. The flag becomes positive when there is a round when the pool leader does not ask this oracle. If this happens the transaction oracle sends a message to the random oracle  $\mc{O}_\msf{tx}$ that the flag became positive and the random oracle does not allow the pool leader to ask any queries until the end of the execution.}, following 
Let (i) $\pf\reward>\tfrac{\cost_\msf{lc}+\cost_\msf{fs}+\cost_\msf{tx}}{(1-\frac{\log\secpar}{\sqrt[4]{n}}) \sqrt{n}q}+\cost_\msf{ro}$, (ii) $\pb=\Omega(\frac{1}{nq})$, and (iii) $\pf<\tfrac{1}{2}$. Then, for any $\delta\in \big[\tfrac{\log\secpar}{\sqrt[4]{\rounds n}},1\big)$, the $\single$ protocol is an $(n-1,0,\epsilon')$-EVP according to the utility profit, where
\begin{equation*}
\begin{split}
\epsilon'=&\Big(\big(\tfrac{\log\secpar}{\sqrt{\rounds n}}+\delta\big)\rounds+\log^2\secpar\big(1+\tfrac{1}{\pf}\big) -\big(\tfrac{\log^3\secpar}{\sqrt{\rounds n}}+1+\delta\big)\Big)(n-1)q\pf\reward+\\
&+\tfrac{n-1}{n}\Big((2\log\secpar)\sqrt{\rounds}+1-\tfrac{\log\secpar}{\sqrt{\rounds}}\Big)(1-(1-\pb)^{nq})\cost_\msf{lc}+\\
&+\big(1+\tfrac{\log\secpar}{\sqrt{\rounds}}\big)\rounds(1-(1-\pb)^{nq})(n-1)\cost_\msf{ltx}+\\
&+\tfrac{\log^2\secpar}{n}(\cost_\msf{fs}+\cost_\msf{tx}),
\end{split}    
\end{equation*}
 w.r.t. every   $\mc{O}_\msf{tx}$-respecting adversary $\mc{A}$ and every $\rounds$-admissible environment $\mc{Z}$ that activates the pool leader first in each round.
\end{theorem}
%
%
\begin{proof}
We will assume that the adversary has corrupted a set $\corrupt$ with $n-1$ parties and can deviate from the $\single$ protocol arbitrarily. We will prove that for every $\rounds$-admissible environment $\mc{Z}$ that activates the leader first in each round and for every PPT adversary $\mc{A}$ that controls $\corrupt$, it holds that 
\begin{equation*}\label{EVP}
\umax(\exec{}) \leq \umin(\honexec) + \epsilon \cdot \mid \umin(\honexec) \mid +\epsilon'   
\end{equation*}
with overwhelming probability in the security parameter $\secpar$.
%
\par
Note that we do not quantify over adversaries that control a set $\corrupt'$ with $t'$ parties, where $t'< n-1$. The reason is that for every adversary $\mc{A}'$ that corrupts $\corrupt'$, we can consider an adversary $\mc{A}''$ that corrupts a set $\corrupt''\supset\corrupt'$ with exactly $n-1$ parties and instructs the parties in $\corrupt'$ to deviate exactly like $\mc{A}'$ and the other $n-1-t'$ parties in $\corrupt''\setminus\corrupt'$ to follow the $\single$ protocol. 
%
\par
At this point, we will describe all the possible deviations of the corrupted parties in the set $\corrupt$ as instructed by $
\mc{A}$. The set $\corrupt$ can include either (i) the pool leader and $n-2$ other members of the pool, or (ii) $n-1$ members of the pool and not the pool leader.

 A round $T$ will be called \textit{payment round} if (i) the array of all blocks that were diffused during the previous round $T-1$ was not empty, and (ii) the array of all the blocks and the set of all the fruits diffused during the previous round $T-1$  do not contain a  block $\hat{\block}:=\langle\langle \hat{h}_{-1},\hat{h}_f,\hat{\nonce},$ $\hat{\msf{dig}},\hat{\record},\hat{h}\rangle,\hat{\mbf{F}}\rangle$
  or a fruit $\hat{\mbf{f}}:=\langle \hat{h}_{-1},\hat{h}_f,\hat{\nonce},\hat{\msf{dig}},\hat{\record},\hat{h}\rangle$, respectively, such that $(\hat{\previous},\hat{h}_f,\hat{\msf{dig}},\hat{\record})\neq(inst_1,inst_2,inst_3,inst_4)$.
%
%
\iffalse
\noindent\textbf{1. $\corrupt$ includes $n-1$ members of the pool and not the pool leader:}
\fi

The possible deviations that $\mc{A}$ can perform are any combination of the following strategies.
\begin{enumerate}
    \item[(D1)] $\mc{A}$ instructs a subset of the non leader parties in $\corrupt$ to deviate from step (4) of the $\single$ protocol for one or more rounds, by ignoring the instance received from the pool leader and creating a different instance. Note that this includes the case where the adversary instructs some adversarial parties to abandon the pool. The meaningful possible deviations that we should examine  are the following: 
    \begin{enumerate}
    \item[(i)] the adversarial party ignores the record $\record$ received from the pool leader and updates $inst_4$ with a new record including a transaction that makes the adversarial party as the recipient of the rewards. 
    \item[(ii)] the adversarial party updates $inst_1$ with a hash value of a block different from $h_{-1}$ received from the pool leader. This reflects the scenario where the adversarial party creates a fork.
    \item[(iii)] the adversarial party updates $inst_2$ with the hash of a block that is different from the hash value, $h_f$, of the block received from the pool leader.
    \item[(iv)] the adversarial party updates $inst_3$ with a digest of a fruit set that is different from $\digest(\mbf{F}_\msf{rec})$ received from the pool leader.
    \item[(v)] the adversarial party does not update one or more $inst_i$, $i\in[4]$.
    
    \end{enumerate}
    \item[(D2)] $\mc{A}$ instructs a subset of the non leader parties in $\mathbf{C}$ to ask $\mc{O}_\msf{ltx}$ no queries during one or more payment rounds.
    \item[(D3)] $\mc{A}$ instructs a subset of the parties in $\mathbf{C}$ to ask the oracle $\mc{O}_\msf{ro}$ fewer than $q$ queries during one or more rounds.
    \item[(D4)] $\mc{A}$ instructs a subset of the parties in $\mathbf{C}$ not to send the fruits or the blocks it produces to the Diffuse Functionality for one or more rounds (this is related to block withholding attacks, cf. \cite{ Rosenfeld2011AnalysisOB,7163020}).

    
    \item[(D5)] $\mc{A}$ instructs a subset of the parties in $\mathbf{C}$ to delay arbitrarily to send the fruits or the blocks it produces to the Diffuse Functionality for one or more rounds.
    \item[(D6)] $\mc{A}$ instructs a subset of the parties in $\mathbf{C}$ to abandon the pool and create a new pool that follows different instructions from the $\single$ protocol.
    \item[(D7)] $\mc{A}$ instructs a subset of the parties in $\mathbf{C}$ to remain in the pool even if it receives a block $\hat{\block}:=\langle\langle \hat{h}_{-1},\hat{h}_f,\hat{\nonce},$ $\hat{\msf{dig}},\hat{\record},\hat{h}\rangle,\hat{\mbf{F}}\rangle$ or a fruit $\langle \hat{h}_{-1},\hat{h}_f,\hat{\nonce},\hat{\msf{dig}},\hat{\record},\hat{h}\rangle$ such that $(\hat{\previous},\hat{h}_f,\hat{\msf{dig}},\hat{\record})\neq(inst_1,inst_2,inst_3,inst_4)$.
    \item[(D8)] $\mc{A}$ instructs a subset of the parties in $\mathbf{C}$ to abandon the pool and follow the $\protocolevp$ protocol.
    \item[(D9)] If $\mathbf{C}$ includes the pool leader, $\mc{A}$ instructs the pool leader to ask no query to $\mc{O}_\msf{fs}$ for one or more rounds.
    \item[(D10)] If $\mathbf{C}$ includes the pool leader, $\mc{A}$ instructs the pool leader to ask no query to $\mc{O}_\msf{tx}$ for one or more rounds.
    \item[(D11)] If $\mathbf{C}$ includes the pool leader, $\mc{A}$ instructs the pool leader to ask no query to $\mc{O}_\msf{lc}$ for one or more payment rounds.
    \item[(D12)] If $\mathbf{C}$ includes the pool leader, $\mc{A}$ instructs the pool leader for one or more payment rounds to  create a special transaction $\tx_T$ that pays the party that does not belong to $\corrupt$ a smaller amount than what described in 3(c) of $\single$ for the pool leader (cf. Figure~\ref{fig:single_leader}). 
   
\end{enumerate}
%
Note that deviations D1, D2 apply only to the corrupted non leader parties, deviations D3-D8 apply to all parties in $\corrupt$ and deviations D9-D12 apply only to the corrupted pool leader. 

\input{proof_H}
\input{proof_D2_D3_D8}
\input{proof_remaining}

Since $\pf\reward>\tfrac{\cost_\msf{lc}+\cost_\msf{fs}+\cost_\msf{tx}}{(1-\frac{\log\secpar}{\sqrt[4]{n}}) \sqrt{n}q}+\cost_\msf{ro}$, $\pb=\Omega(\frac{1}{nq})$, and $\pf<\tfrac{1}{2}$, for an $\mc{O}_\msf{tx}$-respecting adversary $\mc{A}$, the conditions for all Claims~\ref{claim:H},~\ref{claim:D2_D3_D8}, and~\ref{claim:other_deviations} hold. Therefore, for any  $\mc{O}_\msf{tx}$-respecting adversary $\mc{A}$ and $\delta\in \big[\tfrac{\log\secpar}{\sqrt[4]{\rounds n}},1\big)$, with $1-\negl(\secpar)$ probability, it holds that
%
\begin{equation*}
\begin{split}
&\umax(\exec{})-\umin(\honexec)\leq\\
%\leq&\Big( (1+\delta)(\rounds-1)(n-1)q\pf\reward+\\
%&+\log^2\secpar(n-1)q\reward-\\
%&-\tfrac{n-1}{n}\big(1-\tfrac{\log\secpar}{\sqrt{\rounds}}\big)(\rounds-1)(1-(1-\pb)^{nq})\cost_\msf{lc}-\\
%&-\tfrac{n-1}{n}\rounds(\cost_\msf{fs}+\cost_\msf{tx})-\rounds (n-1)q\cost_\msf{ro}\Big)-
%\end{split}    
%\end{equation*}
%
%\begin{equation*}
%\begin{split}
%-&\Big(\big(1-\tfrac{\log\secpar}{\sqrt{\rounds n}}\big)(\rounds-\log^2\secpar)(n-1)q\pf\reward-\\
%&-\tfrac{n-1}{n}\big(1+\tfrac{\log\secpar}{\sqrt{\rounds}}\big)\rounds(1-(1-\pb)^{nq})(\cost_\msf{lc}+n\cost_\msf{ltx})-\\
%&-\big(\tfrac{n-1}{n}\rounds+\tfrac{\log^2\secpar}{n}\big)(\cost_\msf{fs}+\cost_\msf{tx})-\rounds (n-1)q\cost_\msf{ro}\Big)=\\
%
\leq&\Big(\big(\tfrac{\log\secpar}{\sqrt{\rounds n}}+\delta\big)\rounds+\log^2\secpar\big(1+\tfrac{1}{\pf}\big)-\big(\tfrac{\log^3\secpar}{\sqrt{\rounds n}}+1+\delta\big)\Big)(n-1)q\pf\reward+\\
&+\tfrac{n-1}{n}\Big((2\log\secpar)\sqrt{\rounds}+1-\tfrac{\log\secpar}{\sqrt{\rounds}}\Big)(1-(1-\pb)^{nq})\cost_\msf{lc}+\\
&+\big(1+\tfrac{\log\secpar}{\sqrt{\rounds}}\big)\rounds(1-(1-\pb)^{nq})(n-1)\cost_\msf{ltx}+\tfrac{\log^2\secpar}{n}(\cost_\msf{fs}+\cost_\msf{tx}).
\end{split}    
\end{equation*}

Thus, according to Definition~\ref{def:EVP}, the $\single$ protocol is $(n-1,0,\epsilon')$-EVP, for $\epsilon'$ as in theorem statement.

\end{proof}


\begin{remark}\label{rem:variant}
If we remove the assumption of Theorem \ref{th:equilibrium}, then we can prove that instead of the $\single$ protocol, the following strategy profile, denoted by $\mathcal{S}$, is EVP according to the utility profit: all the parties follow all the instructions of the $\single$ protocol except that:
\begin{enumerate} 
\item  the pool leader ignores step (7),(9) for all the rounds. \item in step (8), if the round is a \textit{payment round}, the pool leader sets $inst_4\leftarrow \tx_T$, where $\tx_T$ is the special transaction with the payments, otherwise it does nothing.
\item the members in step (3) do not add $C_\msf{tx}$ in cost.
\end{enumerate}
\end{remark}
