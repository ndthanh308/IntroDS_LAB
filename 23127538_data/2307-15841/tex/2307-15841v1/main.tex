\documentclass[aps,pra,reprint,superscriptaddress,showpacs]{revtex4-1}
\usepackage[utf8]{inputenc}
\usepackage{color}
\usepackage{graphicx}
\usepackage{amssymb,amsmath,amsthm,amsfonts}
\usepackage{mathtools,physics}
\usepackage{float}
\usepackage{hyperref}
\usepackage{enumitem}

\begin{document}

\title{Pulse optimization for high-precision motional-mode characterization in trapped-ion quantum computers}

\author{Qiyao Liang}
\affiliation{Duke Quantum Center, Duke University, Durham, NC 27701, USA}
\affiliation{Department of Electrical Engineering and Computer Science, Massachusetts Institute of Technology, Cambridge, MA 02139, USA}
\author{Mingyu Kang}
\affiliation{Duke Quantum Center, Duke University, Durham, NC 27701, USA}
\affiliation{Department of Physics, Duke University, Durham, NC 27708, USA}
\author{Ming Li}
\email{Current affiliation: Atom Computing, Inc., USA}
\affiliation{19 Pomona Ave, El Cerrito, CA 94530, USA}
\author{Yunseong Nam}
\affiliation{Department of Physics, University of Maryland, College Park, MD 20742, USA}
\date{\today}

\begin{abstract}
High-fidelity operation of quantum computers requires precise knowledge of the physical system through characterization. For motion-mediated entanglement generation in trapped ions, it is crucial to have precise knowledge of the motional-mode parameters such as the mode frequencies and the Lamb-Dicke parameters. Unfortunately, the state-of-the-art mode-characterization schemes do not easily render the mode parameters in a sufficiently scalable and accurate fashion, due to the unwanted excitation of adjacent modes in the frequency space when targeting a single mode, an effect known as the \textit{cross-mode coupling}. Here, we develop an alternative scheme that leverages the degrees of freedom in pulse design for the characterization experiment such that the effects of the cross-mode coupling is actively silenced. Further, we devise stabilization methods to accurately characterize the Lamb-Dicke parameters even when the mode frequencies are not precisely known due to experimental drifts or characterization inaccuracies. We extensively benchmark our scheme in simulations of a three-ion chain and discuss the parameter regimes in which the shaped pulses significantly outperform the traditional square pulses.
\end{abstract}

\maketitle

\section{Introduction}
\label{sec:intro}
With the advent of promises to deliver a quantum computer of scale beyond the capability of conventional computers, comes the responsibility to indeed manufacture one that can reliably be tuned for its normal operations. 
Without the ability to tune, a quantum computer may produce unpredictable and erroneous results. This necessitates the development of methods that can efficiently and accurately characterize the system parameters, as a prerequisite for its high-fidelity operations.

In this paper, we aim to address this challenge for a trapped-ion quantum computer. In particular, our focus is to enhance the accuracy of motional-mode parameter estimation~\cite{Mingyu2022}, as these parameters are essential for designing and performing high-fidelity two-qubit operations~\cite{PhysRevLett.74.4091, PhysRevLett.82.1835, PhysRevLett.82.1971, Blumel21, blumel2021power, li2022realizing}. An accurate characterization of mode parameters can provide several additional benefits as well. First, the overhead in gate calibrations caused by incorrect parameter estimates~\cite{maksymov2021optimal, Gerster21} can be reduced. Second, gate pulses can be more efficient in terms of control-signal power, gate duration, and robustness than pulses designed with inaccurate motional-mode parameters~\cite{blumel2021power, Blumel21}.

To achieve improvement in the mode-parameter characterization, we leverage the control degrees of freedom that are already readily available for the quantum gate implementation on the hardware level.
Specifically, we use pulse optimization, which is a widely used tool in quantum optimal control~\cite{qoct}. Indeed, many pulse-shaping paradigms have been developed, in particular for the purpose of designing high-fidelity single-qubit and two-qubit gates~\cite{grape, crab, krotov}.
Here, we devise pulse shaping paradigms to eliminate the effect of dominant error sources in the characterization process, which in turn can help improve the performance of multi-qubit gates. We note that a recent work explored pulse shaping for system parameter characterization in a single-qubit setup~\cite{OptimizedBayes}.

The rest of the paper is structured as follows.
In Sec.~\ref{sec:prelim}, we provide necessary preliminary information for concretely defining our mode characterization problem.
We then formalize the problem in
Sec.~\ref{sec:problem}, where we focus on the cross-mode coupling and detuning
errors, to be detailed in the section, as the two dominant 
sources of error in the mode characterization.
In Sec.~\ref{sec:method}, we explore pulse shaping, 
where we exploit the degrees of freedom in modulating 
the beams that illuminate the ions to engineer
the response of the system, such that the previously discussed two errors are minimized. In Sec.~\ref{sec:results} we demonstrate the viability of our proposed pulse shaping schemes via extensive numerical simulations on a three-ion chain.
Finally, we discuss the applications and potential limitations of our proposed scheme
in Sec.~\ref{sec:discussion} and provide outlook in Sec.~\ref{sec:conclusion}.


\section{Preliminaries}
\label{sec:prelim}
In a typical trapped-ion quantum computer, a qubit is encoded in two internal states of an ion. As $N$ ions form a linear Coulomb crystal, the collective motion of the ions can be decomposed into $3N$ normal modes, each of which is described as a quantum harmonic oscillator. A pair of qubits within the ion chain can be entangled via a state-dependent force, frequently using lasers. Such force couples the ions' internal states to the motional modes, typically strongly coupling to a subset of $N'$ modes, where the motional modes serve as a ``bus'' that establishes the communication between the target pair of ions that we want to entangle. 

To produce an ideal entangling gate, two criteria must be satisfied; first, the residual entanglement between the qubits and the motional modes must be removed at the end of the gate; second, the degree of entanglement between the target pair of qubit states must reach a pre-specified amount. 
Indeed, accurate knowledge of the motional-mode parameters, mode frequencies and mode-ion coupling strengths (Lamb-Dicke parameters), is necessary to exactly satisfy the criteria. 
In practice though, the parameters are inevitably known only to finite accuracy, due, e.g., to faulty characterization or experimental drifts. This necessitates gate pulse design methods to construct solutions that are robust to parameter offsets~\cite{Shapira18, Milne20, James, frobust, arobust, blumel2021power, Blumel21, Valahu22}, albeit at the cost of a significantly higher power or longer pulse length. Despite much effort, readily available rough theoretical estimates of the mode parameters, calculated using minimal knowledge of the system configurations such as the voltages applied to the trap~\cite{NIST_Bible}, have been proven to be insufficient for high-fidelity quantum operations, as evidenced in~\cite{Blumel21}. 

It is thus not surprising that spectroscopic methods~\cite{Mavadia14, Goodwin16, Stutter18, Hrmo18, Welzel18, Joshi19, Hrmo19, Jarlaud20, Feng20, chen2020efficient, Sosnova21} have been employed to better estimate the mode parameters. Briefly, in all these methods, one starts by initializing the ionâ€™s internal and motional state to the ground state $|0,0\rangle_{j,p^*}$ following the standard initialization and cooling procedures. Here $|a,b\rangle_{j,p^*}$ denotes the composite state of the computational basis state $|a\rangle_j$ of ion $j$ with $a\in\{0,1\}$ and the motional Fock state $|b\rangle_{p^*}$ of mode $p^*$ with phonon number $b$, and $p^*$ is the index of the mode we aim to characterize. One then turns on the Hamiltonian
\begin{widetext}
\begin{align}
\hat{H}_{I,j}(t) &= \hat{\sigma}^+_j \exp{i\sum_{p=1}^{N'} \eta_{j,p} (\hat{a}_p e^{-i\omega_p t} + \hat{a}_p^\dagger e^{i\omega_p t})} g_j(t) + h.c.,
\label{eq:HI}
\end{align}
\end{widetext}
by illuminating ion $j$ for a duration $\tau$ with the pulse form $g_j(t)$ that in principle can be of any shape, where $\hat{\sigma}^+_j := \left|1\right> \left<0\right|$ acts on the computational basis state of ion $j$, $\hat{a}_p^\dagger$ and $\hat{a}_p$ are the creation and annihilation operators acting on mode $p$, $\omega_p$ is the frequency of mode $p$, and $\eta_{j,p}$ is the Lamb-Dicke parameter that couples ion $j$ and mode $p$, defined according to
$
    \eta_{j,p} := b_{j,p} |\vec{k}_{j,p}|/\sqrt{2m \omega_p},
$
where $b_{j,p}$ is the $j$-th element of the normalized eigenvector of mode $p$, $m$ is the ion mass, and $\vec{k}_{j,p}$ is the wavevector of the electric field that couples ion $j$ to mode $p$, projected along the motional direction of mode $p$. 

Indeed in~\cite{Mavadia14, Goodwin16, Stutter18, Hrmo18, Welzel18, Joshi19, Hrmo19, Jarlaud20, Feng20, chen2020efficient, Sosnova21} $g_j(t)$ was chosen to be near-resonant to one of the blue-sideband (BSB) transition frequencies $\omega_{p^*}$, i.e., $g_j(t)={A}_j\exp\{-i (\mu_j t + \phi_j)\}$ with the detuned drive frequency $\mu_j = \tilde{\omega}_j - \omega_j^{\rm{qbt}}$ $\approx$ $\omega_{p^*}$, where $A_j$ is the Rabi frequency of the resonant qubit-state transition, $\phi_j$ is the laser phase, $\tilde{\omega}_j$ is the frequency of the laser's electric field, and $\omega_j^{\rm{qbt}}$ is the frequency separation between the two internal states of qubit $j$.
The ion-mode system then undergoes the so-called BSB transition, where a Rabi flop between the states $|0,0\rangle_{j,p^*}$ and $|1,1\rangle_{j,p^*}$ occurs. Since the final $|1\rangle_j$-state population of ion $j$ at time $\tau$ has dependence on $\omega_{p^*}$ and $\eta_{j, p^*}$ according to (\ref{eq:HI}), one can then extract the values of the mode parameters by measuring the population through statistics accumulated over multiple shots and comparing the theoretical predictions implied by (\ref{eq:HI}) with the measurements.  

We consider the aforementioned, conventional spectroscopy method using $g_j(t)={A}_j\exp\{-i \mu_j t + i \phi_j\}$ as our baseline, with which we compare our characterization method using pulse shaping, to be developed in later sections. Note the baseline uses a single-tone pulse, where the drive frequency $\mu_j$ is near-resonant with the frequency $\omega_{p^*}$ of the target mode $p^*$. We denote such non-modulated pulses as \textit{square pulses}.


\section{Problem}
\label{sec:problem}
In theory, if one can simulate (\ref{eq:HI}) efficiently and exactly, the mode parameters $\omega_p$ and $\eta_{j,p}$ for all $j$ and $p$ can in principle be estimated to within the model violation. However, such a simulation becomes a computationally prohibitive task as the system size increases. Traditionally, the so-called single-mode BSB model~\cite{NIST_Bible} has thus been employed to enable a scalable simulation, effectively focusing on a single mode and a single ion only, at the cost of introducing further, non-insignificant model-violation errors. 

In practice, additional considerations need to be given. Recall the agreement between the model predictions and the experimental results in the BSB transition population is at the core of the mode-parameter estimation and the population has dependencies on both $\omega_p$ and $\eta_{j,p}$. Inaccurate estimation of $\omega_p$, a known parameter to fluctuate and drift in experiments~\cite{frobust}, would thus result in inherent inaccuracy in estimating $\eta_{j,p}$ and vice versa.

To resolve the theoretical and practical issues then, two complementary approaches may be considered. The first approach involves finding more sophisticated theoretical models that better approximate the system while still remaining computationally feasible and developing tailor-made experimental protocols that better separate the effect of the uncertainties in $\omega_p$ from that of the uncertainties in $\eta_{j,p}$ in the various BSB populations induced empirically. This approach has indeed been studied in detail in Ref.~\cite{Mingyu2022}, however using a square pulse. In a contrasting and complementary approach, which is the one explored and investigated here, active ``noise canceling'' can be considered, via \textit{pulse shaping}: By deliberately constructing a non-square, \textit{shaped pulse} to eliminate significant model-violation terms or desensitize the BSB-transition population with respect to parameter change, significant improvement in the mode-parameter estimation can be achieved. 

In this section, we concretely lay out the necessary technical details for understanding our pulse shaping method and its benefits. By showing the approximations used to arrive at the simple, single-mode BSB model, we can pinpoint the terms responsible for the model-violation errors. Further, we can explicitly express the sensitivity term. Note, in the forthcoming discussion, for simplicity, we consider the case of illuminating one ion at a time for one target mode, thus omitting the reference to ion $j$ wherever contextually clear; Parallelization by simultaneously illuminating multiple ions and targeting multiple modes~\cite{Mingyu2022} may be considered but is beyond the scope of this paper. 

To start, we reiterate that, when the mode characterization is performed for a trapped-ion quantum computer, experimental evolution is compared to that implied by the simulated Hamiltonian. Specifically, a series of experimentally observed BSB-transition population $P$ is compared with that expected from the simulation, denoted ${\mathcal P}$, to reveal the mode parameters of interest. As a result, the discrepancy between $P$ and $\mathcal{P}$ directly leads to errors in characterizing the mode parameters. 

{\it Multi-mode and Single-mode BSB Hamiltonian} -- To obtain $\mathcal{P}$ at scale beyond a handful number of ions, we first apply a series of approximations to the Hamiltonian in (\ref{eq:HI}) to arrive at the single-mode BSB Hamiltonian, better amenable to a scalable simulation. Assuming small $\eta_p ({\leftarrow} \eta_{j,p})$, we linearize the Hamiltonian in (\ref{eq:HI}) by performing a first-order Taylor expansion on the exponential term in (\ref{eq:HI}). Then, a rotating-wave approximation (RWA) is applied to remove the frequency components that are far off-resonant from all mode frequencies. These approximations combine to give the $N'$-mode BSB Hamiltonian
\begin{equation} \label{eq:HNmode}
\hat{H}'_I(t) = i \sum_{p=0}^{N'-1} \eta_{p} e^{i \omega_p t} g(t) \hat{\sigma}^+ \hat{a}^\dagger_p + h.c.
\end{equation}
Next, as only mode $p^*$ is targeted, we may apply a stronger RWA. This results in the single-mode BSB Hamiltonian
\begin{equation} \label{eq:H1mode}
\hat{H}'_{I,p^*}(t) = i \eta_{p^*} e^{i \omega_{p^*} t} g(t) \hat{\sigma}^+ \hat{a}^\dagger_{p^*} + h.c.
\end{equation}
We note that the simpler model in (\ref{eq:H1mode}) demands far less computational cost in its simulation, where the cost for simulating the more complicated model in (\ref{eq:HNmode}) grows exponentially with the number of modes $N'$.

We are now ready to discuss our problem details that base the comparison between $P$ and ${\mathcal P}$, both of which we obtain by simulation in this paper. Starting with $P$, recall the most complete theoretical model considered herein is (\ref{eq:HI}). Comparing (\ref{eq:HI}) and (\ref{eq:HNmode}), one can see that the leading-order difference is $O(\eta^2)$, which is indeed the well-known Debye-Waller (DW) effect~\cite{Wineland79, NIST_Bible}. Briefly, it affects the population $P$ by reducing the effective BSB Rabi frequency -- the spread of the ion's position wavepacket, captured in (\ref{eq:HI}) but not in (\ref{eq:HNmode}), leads to this reduction. Since our goal is to silence the leading-order, significant model-violation terms, which we show to be $O(\eta)$ in the paragraphs to come later, for our purposes, it suffices to consider the evolution implied by (\ref{eq:HNmode}) as our simulated experiment that generates the (simulated) experimental population $P$. 
Further, the DW effect is known to be re-capturable by using a more advanced model that predicts the BSB population without adding significant computational cost~\cite{Mingyu2022}.
As for the model-based, approximate BSB population ${\mathcal P}$, we obtain it from simulating the evolution implied by the Hamiltonian in (\ref{eq:H1mode}) over duration $\tau$.

{\it Elimination targets for pulse shaping} -- The source of discrepancy between $P$ and ${\mathcal P}$
forms the elimination target by our pulse shaping. Such an elimination is in general not achievable via a simple square pulse. By bringing $P$ and ${\mathcal P}$ closer via shaping the pulses, we can enable significantly better mode-parameter estimation. 
To this end, the elimination targets are: 

\textit{(1) Cross Mode Coupling (CMC) error}: Note an important difference between (\ref{eq:HNmode}) and (\ref{eq:H1mode}) is that former captures the coupling of internal ion states to modes $p\neq p^*$, an effect hereafter referred to as the CMC, whereas the latter does not. Specifically, the leading-order CMC error may be quantified as
\begin{equation}
    \theta^{\rm CMC}_{p} = \Theta_{p}^{(1)}
    := \int_0^{\tau} g(t) e^{i\omega_p t} dt \quad\quad (p \neq p^*),
    \label{eq:cmc}
\end{equation}
where $\Theta_{p}^{(1)}$ is the first-order Magnus integral,
since the first-order Magnus-approximated evolution operator $\hat{U}^{(1)}$ for (\ref{eq:HNmode}) is
\begin{equation} \label{eq:uni_approx}
\hat{U}^{(1)} := \exp (\hat{\Omega}_1)=
\exp \left( \sum_{p=0}^{N'-1} \eta_p \Theta_{p}^{(1)} \hat{\sigma}^+ \hat{a}_p^\dagger - h.c. \right)
\end{equation}
and we used $\hat{\Omega}_1$ to denote the first-order Magnus term.
Note this approximation is valid when $|\eta_{p^*} g(t)|$ is small compared to $1/\tau$.
By eliminating all $\theta_p^{\rm CMC}$ defined in (\ref{eq:cmc}) 
using pulse shaping, the first-order CMC effect may be suppressed, leaving the second-order Magnus term
\begin{equation}
    \hat{\Omega}_2 = \sum_{p,p'=0}^{N'-1} \eta_p \eta_{p'} \Theta_{p,p'}^{(2)} 
\left(\hat{\sigma}_z \hat{a}^\dagger_p \hat{a}_{p'} + \hat{\sigma}_- \hat{\sigma}_+ \delta_{p,p'} \right)
- h.c.,
\end{equation}
where
\begin{equation}
    \Theta_{p,p'}^{(2)} = \frac{1}{2} \int_0^\tau dt_1 \int_0^{t_1} dt_2 
    g(t_1) g^*(t_2) \: e^{i\omega_p t_1} \: e^{-i \omega_{p'} t_2}
\label{eq:2ndMag}
\end{equation}
is the second-order Magnus integral, as the post-suppression leading-order CMC error.

\textit{(2) Detuning error}: In our model Hamiltonian, $\omega_p$ are considered static. However, experimental imperfections, either from faulty characterization or drifts during the experiment~\cite{Maksymov2022}, give rise to inexactness or detuning of the mode frequencies $\omega_p$. This manifests in our model as
\begin{align}
    \theta^{\rm{det}}_p (\delta_p) &:= \int_0^{\tau} e^{i(\omega_p + \delta_p)t}g(t)dt - \int_0^{\tau} e^{i\omega_{p}t} g(t)dt \nonumber\\
    &= \sum_{\kappa=1}^\infty \frac{\delta_p^\kappa}{\kappa!} \frac{\partial^\kappa}{\partial \omega_p^\kappa} \Theta_{p}^{(1)},
    \label{eq:det}
\end{align}   
which is the difference incurred in the first-order Magnus integral due to the detuning $\omega_p \rightarrow \omega_p + \delta_p$. 
For the target mode $p^*$, the difference leads to off resonance of the BSB transition, which directly causes error in estimating $\eta_{j,p^*}$. For the non-target modes, the detuning leads to changes in the CMC terms in (\ref{eq:cmc}), hence imperfect removal of the CMC effects via pulse shaping, which ultimately results in the characterization error for $\eta_{j,p^*}$. Since the precise value of $\theta_p^{\rm{det}}$ cannot be learned when $\delta_p$ is not known precisely, we aim to suppress $\theta_p^{\rm{det}}(\delta_p)$ via minimizing the first $K$ leading-order derivatives ($\kappa \leq K$) of $\Theta_p^{(1)}$ within the Taylor expansion terms of (\ref{eq:det}).

To recap, we emphasize that the quantities (\ref{eq:cmc}) and (\ref{eq:det}) are in general nonzero for the non-modulated pulse of the form $g(t) = \bar{A}e^{-i \mu t + i\phi}$. In our work, we deliberately design $g(t)$ to remove (\ref{eq:cmc}) and (\ref{eq:det}), such that the accuracy of mode characterization is significantly improved. Note that the residual errors in the characterization would then be due to the contributions from the second- and higher-order Magnus terms as mentioned earlier, in addition to other high-order Hamiltonian terms unaccounted for in our model. 
Indeed, an example may be the aforementioned DW effect. In the rest of our paper, we therefore neglect the DW effect and focus on the larger, leading-order effects such as the CMC and detuning error that we actively silence using our pulse shaping.


\section{Method}
\label{sec:method}

In this section, we present pulse-shaping techniques for suppressing the CMC and the detuning errors by removing (\ref{eq:cmc}) and (\ref{eq:det}), respectively. To summarize, we aim to obtain the following goals:
\begin{enumerate}[label=Goal \arabic*]
\item Suppress the CMC by imposing $\Theta_{p}^{(1)}=0$ for all $p \neq p^*$; 
\label{goal1}
\item Maximize $|\Theta_{p^*}^{(1)}|$ while keeping the average Rabi frequency of the pulse the same, such that maximal change in the qubit population (observable in our experiment) is reached with a reasonable power requirement;
\label{goal2}
\item Achieve \ref{goal1} and \ref{goal2} and estimate $\eta_{j,p^{*}}$ well even in the presence of uncertainties in $\omega_p$'s by stabilizing the conditions with respect to changes in $\omega_p$'s.
\label{goal3}
\end{enumerate}

Briefly, to eliminate the CMC error, we first assume $\omega_p$'s are fully known, a condition which we relax later when introducing the detuning errors. Our \ref{goal1} is then to obtain $\theta_p^{\rm CMC} = 0$ in (\ref{eq:cmc}) for all $p \neq p^*$. This way, the non-target modes are decoupled from the illuminated ion up to the first order. 

In principle, a pulse that achieves \ref{goal1} can, for example, be far detuned from all of the mode frequencies. This would result in a minimal target-mode signal (qubit population) or, said differently, a pulse solution with a prohibitively large power. To address this, we maximize the target mode's response (\ref{goal2}) by maximizing $|\Theta_{p^*}^{(1)}|$ while keeping the pulse power requirement constant, to be more concretely defined later.

Relaxing now the perfect knowledge assumption for $\omega_p$'s, we notice that the precise integral values $\Theta_{p}^{(1)}$ used to achieve \ref{goal1} and \ref{goal2}, for both $p{=}p^*$ and $p{\neq}p^*$, will change if a detuning error occurs. To prevent a significant change, we can stabilize all $\Theta_{p}^{(1)}$'s with respect to their respective mode frequencies $\omega_p$'s such that $\theta_p^{\rm det}$ in (\ref{eq:det}) is suppressed to (near) zero for a small range of detuning, with a varying degree of stabilization $K$. In other words, for \ref{goal3}, we can minimize the derivatives of $\Theta_{p}^{(1)}$ with respect to $\omega_p$ for all modes $p$. 

In what follows, we focus on achieving all three goals stated above by appropriately shaping $g(t)$.
To start, we expand $g(t)$ using a Fourier basis, i.e.,
\begin{equation}
\label{eq:Fourier}
g(t) = \sum_n A'_n e^{-i \frac{2\pi n}{\tau}t+i\phi_n} = \sum_n A_n e^{-i \frac{2\pi n}{\tau}t},
\end{equation}
where $n$ indexes the Fourier basis and $A_n := A_n'e^{i\phi_n}$ is a complex coefficient of each Fourier component. While a complete Fourier basis comprising an infinite number of basis components may be considered, in practice, a Fourier basis consisting of $N_{\rm{basis}}$ components, concentrated around motional mode frequencies $\omega_p$'s, suffices. 
The average Rabi frequency $\bar{A}$ of pulse $g(t)$ is then defined as $\bar{A} := \sqrt{\sum_n |A_n|^2}$.
Inserting (\ref{eq:Fourier}) into $\Theta_{p}^{(1)}$ defined in (\ref{eq:cmc}), we obtain 
\begin{align}
   \Theta^{(1)}_p = \sum_n A_n\int_0^\tau \exp \left\{ i 
   \left(\omega_p - \frac{2\pi n}{\tau}
   \right)t \right\}dt ,
   \label{eq:TP1}
\end{align}
which we can then summarize into a $N'\times 1$ column vector $\vec{\Theta}^{(1)}$. Extracting the Rabi frequency coefficients $A_n$ from the above expression and summarizing again as a column vector $\vec{A}$, we can succinctly express $\vec{\Theta}^{(1)}$ as
\begin{align}
\vec{\Theta}^{(1)} = \mathbf{M} \vec{A},
\label{eq:firstordermagnus}
\end{align}
where $\mathbf{M}$ is a matrix of dimension $N'\times N_{\rm{basis}}$ with the matrix elements
\begin{align}
M_{p,n} = \int_0^\tau  \exp \left\{ i \left(\omega_p - \frac{2\pi n}{\tau}\right)t  \right\} dt. 
\end{align}
The goal here becomes then to determine the appropriate Fourier expansion coefficients $\vec{A}$ that achieve the three goals listed above. 

\textit{Step 1 (\ref{goal1}):} {\it CMC suppression --} Here, we aim to ensure the inner product between each row of $\mathbf{M}$ and $\vec{A}$ is zero for all $p{\neq}p^*$, such that $\theta_{p}^{\text{CMC}}{=}0, \, \, \forall p{\neq}p^*$.
To achieve this, we remove the $p^*$-th row vector from $\mathbf{M}$, denote this matrix as $\mathbf{M}'$, and find the null space of $\mathbf{M}'$. We characterize this space  $\boldsymbol{\mathcal{S}}^{(1)}$ by a spanning set of vectors $\mathcal{S}^{(1)}$, and denote $\mathbf{N}$ as the matrix whose columns consist of vectors in $\mathcal{S}^{(1)}$. These nullspace vectors then satisfy the CMC nulling conditions of all $p\neq p^*$ and serve as the spanning vectors of the space over which we maximize the signal of the target mode $p=p^*$. The size of the nullspace is the number of basis functions, subtracted the number of nulling conditions applied $N'-1$. The null-space dimension marks the degrees of freedom we have left to work with for the signal maximization, of which there needs to be a sufficient number to warrant convergence in the pulse shape. 

\textit{Step 2 (\ref{goal2}):} {\it Maximizing signal strength --} To maximize the signal strength of the target mode $p^*$, we first minimize the average power of the pulse to achieve $|\Theta_{p^*}^{(1)}|=1$. 
We then scale the obtained, minimal-power pulse solution vector by \textit{Rabi-frequency scaling factor} $\alpha$, such that $|\Theta_{p^*}^{(1)}|$ reaches a desired value, in this case $\alpha$.
More specifically, our starting point is the projection of the $p^*$-th row vector $\vec{v}^\dagger$ of $\mathbf{M}$ onto the nullspace $\mathbf{N}$. We then find the eigenvector $\vec{\xi}$ with the largest eigenvalue $\lambda_{\rm max}>0$ of the positive-definite matrix $\mathbf{N}^\dagger \vec{v} \vec{v}^\dagger \mathbf{N}$. The normalized pulse solution is obtained by projecting $\vec{\xi}$ onto the nullspace $\mathbf{N}$ then normalizing by $\sqrt{\lambda_{\rm max}}$.
After rescaling by a factor of $\alpha$, we obtain the pulse solution $\vec{A}$, given by
\begin{align}\label{eq:normalizepulse}
    \vec{A} = \frac{\alpha}{\sqrt{\lambda_{\rm max}}} \mathbf{N}\vec{\xi}.
\end{align}

\textit{(Optional) Modified Step 1 (\ref{goal3}):} {\it Stabilization against detuning -- } We now admit that we have inaccuracies in $\omega_p$'s such that $\omega_p \rightarrow \omega_p + \delta_p$, $\forall p$. The resulting error contribution $\theta_p^{\rm det}$, given in (\ref{eq:det}), can be suppressed by adding the following constraints to the null-space conditions:
\begin{equation}
\frac{\partial^\kappa}{\partial \omega_p^\kappa}\Theta_{p}^{(1)}= 0
\quad\quad \forall p, \: \kappa \in \{1,..,K\},
\label{eq:stab}
\end{equation}
where $K$ is the \textit{moment of stabilization}, which corresponds to the highest order of derivatives that are nulled.

Specifically, these constraints are appended as additional $KN'$ rows to the matrix $\mathbf{M}'$, where each row contains the nulling condition for each pair of $p$ and $\kappa$. As $\mathbf{M}'$ originally has $N'-1$ rows, the appended matrix entries in the expanded $\mathbf{M}'$ are given by
\begin{align}
    M'_{\kappa N' - 1 + p, n}=\frac{\partial^\kappa}{\partial\omega_p^\kappa}\int_0^\tau  \exp \left\{ i (\omega_p - 2\pi n/\tau) t \right\} dt,
\end{align}
where $p = 1,..,N'$ and $\kappa = 1,..,K$. Then, we find the set of null space vectors $\mathcal{S}^{(1)}$ corresponding to the expanded $\mathbf{M}'$ and proceed to perform the same signal maximization procedure as described in \textit{Step 2}. 

We note in passing that performing stabilization against detuning as described in \textit{Modified Step 1} is optional. Should the rough $\omega_{p}$ values known a priori to the characterization be sufficiently accurate for the purpose of characterization, the need for these constraints are obviated. 

{\it Remarks} -- Due to its role in the rescaling of $|\Theta_{p^*}^{(1)}|$, hereafter, we use $\alpha$ interchangeably as the absolute value of the first-order Magnus integral for mode $p^*$ for both shaped and square pulses. 
The rescaled pulse roughly induces a qubit population inversion $\mathcal{P} \approx \sin^2 (\eta_{p^*} |\Theta_{p^*}^{(1)}|)$ (see Appendix \ref{sec:appendix_population} for details) and, in the perturbative regime where $|\eta_{p^*} \Theta_{p^*}^{(1)}| \ll 1$, $\mathcal{P} \approx  |\eta_{p^*}\Theta_{p^*}^{(1)}|^2 = (\eta_{p^*}\alpha)^2$. 
The pulse, if it happens to be that its Fourier coefficients for a tight band of frequencies near $\omega_{p^*}$ dominate in their modulus, would roughly have an average power of $\bar{A} \approx \alpha/\tau$ [see (\ref{eq:TP1})]. 


\section{Results}
\label{sec:results}

% Figure environment removed

In this section, we demonstrate the viability of our pulse-shaping techniques proposed via numerical simulations of a three-ion chain. To benchmark the performance of our pulse-shaping characterization tools as compared to their traditional square-pulse counterparts, we simulate the bright-state populations $P$ and $\mathcal{P}$ induced by the multi-mode Hamiltonian (\ref{eq:HNmode}) and the single-mode Hamiltonian (\ref{eq:H1mode}), respectively, -- see Appendix A of Ref.~\cite{Mingyu2022} for the simulation implementation detail -- where the initial qubit state is $\ket{0}$ and all motional modes are initially in the ground state. We then use the fractional difference between the induced qubit populations by the two models $\mathcal{E}:=|P-\mathcal{P}|/\mathcal{P}$, hereafter referred frequently as the fractional population error, resulting from the CMC and detuning error, as a proxy for the characterization error. The proxy error $\mathcal{E}$, computed for both shaped and square pulses, can help us reveal in which parameter regime shaped pulses potentially give an advantage over square pulses.

Specifically, to see how the parameter regime may be found, we can consider the leading-order errors that remain after pulse shaping and contribute significantly to ${\mathcal E}$, which can be broken down as follows. First, residual CMC errors of order $O(\eta^2)$ or higher remain due to the second- or higher-order Magnus terms. Second, detuning errors arise from higher-order contributions of the first-order Magnus integral $ \frac{\delta_p^\kappa}{\kappa!} \frac{\partial^\kappa}{\partial \omega_p^\kappa}\Theta_{p}^{(1)}$ ($\kappa > K$), where $K$ is the moment of stabilization. Third, additional detuning errors arise from non-target higher-order Magnus integrals. Thus, the dependence of $\mathcal{E}$ to various parameters such as pulse power, pulse duration, and detuning can be predicted based on the residual error sources listed above. Indeed, we aim to identify parameter choices that result in smaller $\mathcal{E}$ for shaped pulses compared to that for square pulses by carefully examining each dependence.

We note in passing that, for a linear chain of three ions indexed by $j\in\{0,1,2\}$ (labeled from left to right) with three modes indexed by $p\in\{0,1,2\}$ (labeled in the ascending order of mode frequencies), we focus throughout this section on ion $j=2$, probing the largest-frequency mode $p^*=2$, as a concrete example; This choice is arbitrary and other ion-mode pairs can be considered straightforwardly in our procedures. 
Further, we use a realistic set of values of $\omega_p$ and $\eta_{j,p}$, reported in Appendix~\ref{app:mode_params}, for our simulated experiments (three-mode Hamiltonian) throughout this section.

Figure~\ref{fig:pulse_prof} shows an example square pulse and shaped pulses with various moments of stabilization $K$, for the aforementioned example choice of the ion and the mode. The pulse components in the frequency domain are mostly concentrated near the target-mode frequency $\omega_{p^*}{=}\omega_2$. The small wiggles around the non-target mode frequencies $\omega_0$ and $\omega_1$ can be interpreted as signatures of active cancellation of the CMC error. Similar features are observed for other choices of ion-mode pairs (not shown). 

The rest of the section is organized as follows.
We first study the $\mathcal{E}$ scaling of square and shaped pulses without stabilization due to the CMC effect in Sec.~\ref{sec:result_cmc}. We then study the $\mathcal{E}$ scaling of square and shaped pulses with various degrees of stabilization in the presence of both errors, due to CMC and detuning, in Sec.~\ref{sec:result_detuning}. Finally, we compare $\mathcal{E}$ between various shaped and square pulses across all parameter regimes in Sec.~\ref{sec:result_final_comparison}.

\subsection{Fractional population error due to CMC}
\label{sec:result_cmc}

We first analyze how $\mathcal{E}$ due to the CMC depends on the Rabi frequency scaling factor $\alpha$ and the pulse length $\tau$. Here the detuning error and stabilization are not considered. We note that intuitively, the CMC error comes from non-zero spectral decomposition of pulse components at non-target mode frequencies, as shown for a square pulse in Fig.~\ref{fig:pulse_prof}. The magnitude of the CMC error due to non-target mode $p$ is then roughly determined by $\bar{A}/|\omega_{p^*} - \omega_p|$, where $\bar{A}$ is the average Rabi frequency of the pulse as defined in Sec.~\ref{sec:method}.

% Figure environment removed

% Figure environment removed

Figures~\ref{fig:2}(a) and (b) compare the population error $\mathcal{E}$ solely due to the CMC, between square and shaped pulses, as a function of varying $\alpha$ and $\tau$, respectively. 
First, in Fig.~\ref{fig:2}(a), we observe that for the square pulses $g(t) = \bar{A}e^{-i \omega_{p^*} t}$, $\mathcal{E}$ remains constant with increasing $\alpha$ (except for the dip at $\alpha \approx 2.3$ that will be explained later). This is because the major contribution to $\mathcal{P}$ and $|P - \mathcal{P}|$ comes from $|\Theta_{p^*}^{(1)}|^2$ and $|\Theta_{p}^{(1)}|^2$ ($p \neq p^*$), respectively, which are both proportional to $\bar{A}^2 \propto \alpha^2$. Meanwhile, for the shaped pulses, $\mathcal{E}$ is proportional to $\alpha^2$ when $\alpha \lesssim 3$. This is because for shaped pulses, $\Theta_{p}^{(1)} = 0$ for $p \neq p^*$, so the major contribution to \mbox{$|P - \mathcal{P}|$} comes from $|\Theta^{(2)}_{p,p'}|^2$ [$(p,p') \neq (p^*, p^*)$] that is proportional to ${\bar{A}}^4 \propto \alpha^4$; see Appendix~\ref{app:derivations} for details. Due to this difference in the scaling behavior of $\mathcal{E}$ with respect to $\alpha$, shaped pulses are guaranteed to outperform square pulses when $\alpha$ is chosen to be sufficiently small, say, \mbox{$\alpha \lesssim 1$}. 

Figure~\ref{fig:2}(b) shows that when $\alpha{=}1$ is fixed, $\mathcal{E}$ of both square and shaped pulses are roughly proportional to $\tau^{-2}$. This agrees with the observation that (i) \mbox{$\bar{A} \tau \approx \alpha = 1$}, (ii) $|\Theta_{p}^{(1)}|^2$ ($p \neq p^*$) of the square pulse is proportional to $\bar{A}^2 \propto \tau^{-2}$, and (iii) the dominant term of $|\Theta_{p,p'}^{(2)}|^2$ of the shaped pulse (when $\tau \gg |\omega_{p^*} - \omega_{p'}|^{-1}$) is proportional to $(\bar{A}^2 \tau)^2 \propto \tau^{-2}$ (see Appendix~\ref{app:derivations} for details). As $\mathcal{E}$ of the square and shaped pulses have the same scaling behavior with respect to $\tau$, we expect the advantage of shaped pulses when $\alpha$ is small to hold for all pulse lengths. 

We note that, as $\alpha$ and $\tau$ of the square pulses are varied, as evidenced in Fig.~\ref{fig:2}, $\mathcal{E}$ is sharply suppressed at certain ``sweet-spot'' values of $\alpha$ and $\tau$, sometimes by more than an order of magnitude compared to the neighboring values. For Fig.~\ref{fig:2}(a), a likely cause of this dip for the square pulses is the cancellation between the first-order and the higher-order CMC contributions to the qubit population (see Appendix~\ref{sec:appendix_second_order_magnus} for details). For Fig.~\ref{fig:2}(b), the dips occur for the most part when the first-order Magnus integral $\Theta_p^{(1)}$ in \eqref{eq:cmc} evaluates to zero for non-target modes, i.e., $\Theta_p^{(1)}=0$ when $\omega_p-\omega_{p^*}=2\pi l/\tau$ for arbitrary integer $l$. We note that the fact that some of the square pulses have $\mathcal{E}$'s that fall below those of shaped pulses indicates that similar phenomena might be occurring for high-order contributions to CMC error as well. Shaped pulses on the other hand do not have these dips due to the multiple frequency components of the pulse, as the different components are unlikely to be naturally orchestrated to accidentally cancel higher-order Magnus integrals at a given $\tau$.

While it may be desirable to choose $\alpha$ and $\tau$ at these ``sweet spot'' values for our mode characterization, in practice, we cannot perform \textit{a priori} calculations to find the sweet spots, as the mode parameters are yet to be characterized and subject to drifts during the experiment. Thus, actively nulling the first-order contribution of the non-target modes by using a shaped pulse is a more reliable method of suppressing $\mathcal{E}$, and thereby increasing the accuracy of $\eta_p$ estimation.

We further anticipate the shaped pulses to outperform the square pulses in fending off the CMC error for up to about tens of qubits. 
Note, due to the nulling conditions whose number scale linearly in the number of ions, shaped pulses in general demand larger power requirement than square pulses. 
Just as in the gate pulse shaping~\cite{Blumel21}, the extra power demand becomes pronounced when there are insufficient frequency components in the pulse Fourier basis near each mode frequency that needs to be nulled during the CMC suppression.
Since the post-suppression CMC error in the shaped pulse is dominated by the second-order Magnus term that scales quadratically in $\bar{A}$, too large of a power requirement can cause more harm than good.
For $\tau \gtrsim 100\mu$s with mode frequencies within a band of $\sim 0.3$MHz, a typical operating condition of trapped-ion quantum computers today, we can expect a relative abundance of the number of Fourier basis components over the number of mode frequencies within the band for up to tens of ions.
As reported in Appendix~\ref{app:scalability}, we confirm explicitly up to a seven-ion chain that the power requirements remain virtually the same between the square and shaped pulses. 

\subsection{Fractional population errror due to detuning}
\label{sec:result_detuning}

We compare in this section square pulses to shaped pulses with stabilization in the presence of detuning errors. To start, Fig.~\ref{fig:3}(a) shows the average Rabi frequencies $\bar{A}$ required for these pulses to reach $|\Theta_{p^*}^{(1)}|=1$ with various pulse lengths $\tau$. 
We see that for all pulses $\bar{A}$ is inversely proportional to $\tau$. In particular, $\bar{A}$ increases with a larger moment of stabilization. This is because, as seen from the bottom panels of Fig.~\ref{fig:pulse_prof}, pulses with a larger moment of stabilization have larger off-resonant frequency components, which in turn require a larger resonant frequency component to induce the same amount of qubit population inversion, as compared to pulses with smaller off-resonant components. 

We next compare the performance of square and shaped pulses with stabilization as a function of mode-frequency detuning. For simplicity, we consider a uniform detuning $\omega_p \rightarrow \omega_p + \delta$ for all $p$, although the advantage of shaped pulses applies for non-uniform detuning as well. Figure~\ref{fig:3}(b) shows the magnitude of the difference between the first-order Magnus integrals with and without the detuning, $|\Theta_{p^*}^{(1)}(\delta)-\Theta_{p^*}^{(1)}(0)|$, as a function of $\delta$. As expected, shaped pulses with a greater moment of stabilization offers a wider detuning range over which $|\Theta_{p^*}^{(1)}(\delta)-\Theta_{p^*}^{(1)}(0)|$ is kept within a small, pre-determined threshold.


To study the effects of the detuning error in conjunction with the CMC error, we show in Figs.~\ref{fig:3}(c) and (d) a generalized version of the fractional population error $\mathcal{E}(\delta)$, defined according to
\begin{align}
    \mathcal{E}(\delta) &:= |P(\delta)-\mathcal{P}(\delta=0)|/\mathcal{P}(\delta=0), \nonumber
\end{align}
where $P(\delta)$ [$\mathcal{P}(\delta)$] is the bright-state population induced by (\ref{eq:HNmode}) [(\ref{eq:H1mode})] under $\omega_p \rightarrow \omega_p + \delta$. 
Specifically for Fig.~\ref{fig:3}(c), we show $\mathcal{E}(\delta)$ as a function of pulse length $\tau$, while fixing the detuning at $2\pi\times 100$Hz. Figure~\ref{fig:3}(d) shows $\mathcal{E}(\delta)$ as a function of $\delta$, while fixing the pulse length at \mbox{$\tau = 860\mu$s}. 

Recall from Fig.~\ref{fig:2}(b) $\mathcal{E}$, in the absence of any detuning and resulting from the CMC, decreased as $\tau^{-2}$ for both square and shaped pulses. When $\delta$ is no longer absent, an erroneous phase that accumulates over the pulse duration $\tau$ emerges, which contributes to $\mathcal{E}(\delta)$ as an increasing function of $\tau$.
Therefore, there is a tug-of-war between the two competing scaling trends in $\tau$, the CMC-induced vs. the detuning-induced. 
There arises a minimum $\mathcal{E}(\delta)$ for some combinations of of $\tau$ and $\delta$.

Figure~\ref{fig:3}(c) shows $\mathcal{E}(\delta)$ as a function of $\tau$, where the transient $\tau$-scaling behavior due to the tug-of-war is pronounced for moment-2 and 3 shaped pulses. 
Indeed, shaped pulses with higher moments of stabilization has a larger CMC error, owing to their larger power requirement (see Fig.~\ref{fig:3}(a)), hence the stronger CMC signature when $\tau$ is small. While not as pronounced in our specific example cases, the transient $\tau$-scaling does appear in lower-moment shaped pulses and square pulses as well (see Appendix~\ref{app:ultimate_comparison}), especially for small $\delta$ or large $\bar{A}$.

A tug-of-war analogy between different errors is also applicable for the observed scaling behavior of ${\mathcal E}(\delta)$ with respect to detuning, shown in Fig.~\ref{fig:3}(d). When $\delta$ is small and CMC error dominates, moment-0 shaped pulses, and in our particular choice of parameters square pulses as well (recall the $\mathcal{E}$ ``dips" for square pulses in Fig.~\ref{fig:2}(b); different pulse lengths change the performance of square pulses dramatically), outperform the rest. This is so, since higher-moment shaped pulses have larger high-order CMC error, as they demand increased power requirement. As $\delta$ increases and detuning error begins to dominate, higher-moment shaped pulses show superior performance as a result of stabilization, with the exception of moment-1 shaped pulses, which we address next. 

In both Figs.~\ref{fig:3}(c) and (d), moment-1 shaped pulses tend to perform the worst in $\mathcal{E}(\delta)$ scaling with respect to both $\tau$ and $\delta$, despite that the first-order derivative of $\Theta_{p^*}^{(1)}$ is nulled as evidenced in Fig.~\ref{fig:3}(b). The discrepancy between our objective quantity $\theta_{p^*}^{\rm{det}} = \Theta_{p^*}^{(1)}(\delta)-\Theta_{p^*}^{(1)}(0)$ to null and $\mathcal{E}(\delta)$ is indeed elaborated in detail in Appendix~\ref{app:even_odd_stabilization}, which explains the poor performance by moment-1 pulses. To summarize, this discrepancy results in better performance of shaped pulses with even-moment stabilization.
In the case of Figs.~\ref{fig:3}(c) and (d), square pulses and moment-0 shaped pulses thus mostly outperform moment-1 shaped pulses. 


\subsection{Fractional population error comparison between square and shaped pulses}
\label{sec:result_final_comparison}

Recall our goal is to identify the optimal choice of pulse parameters, such as square vs. shaped, moments of stabilization, or duration, such that the mode characterization for a given system, specified by its rough mode spacings and detuning stability, is achieved with the lowest error.
To this end, Fig.~\ref{fig:4} shows which pulses out of square and moments-$K$ shaped pulses, $K\in\{0,1,2,3\}$, perform the best in terms of the fractional population errors $\mathcal{E}(\delta)$, in the presence of both CMC and detuning errors for various values of pulse length $\tau$ and detuning $\delta$. As expected, shaped pulses outperform square pulses in most parameter regimes, where higher-moment shaped pulses tend to perform best for long pulse lengths unless the detuning error is minuscule ($|\delta| \ll \alpha/\tau$) and lower-moment pulses tend to perform best for short pulse lengths over a sizable range of detuning errors. 

We refer the readers to Appendix~\ref{app:ultimate_comparison} for a full comparison of $\mathcal{E}(\delta)$ between all of the pulses considered in Fig.~\ref{fig:4}, beyond just the best performing one, for various values of $\tau$ and $\delta$. In summary, we observe that, for a moderate amount of mode-frequency uncertainty $|\delta| \lesssim 2\pi \times 80$Hz and mode spacings $\omega_2-\omega_1 = 2\pi \times 68.0$kHz and $\omega_1-\omega_0 = 2\pi \times 96.8$kHz, moment-2 pulses of length $\tau \geq 1000\mu$s achieve the smallest population error ($10^{-4} \lesssim \mathcal{E}(\delta) \lesssim 10^{-3}$) among all the pulses considered across all pulse lengths $\tau$, for the case of three ions and three modes.
Our detailed findings reported in Appendix~\ref{app:ultimate_comparison} are in line with the scaling trends summarized in Figs.~\ref{fig:2} and \ref{fig:3}, making an optimal choice of pulse parameters based on the uncertainty in the mode-frequency estimation (which results in unwanted detuning) and the available pulse power/duration possible, at least roughly. We expect similar scaling behaviors to hold for larger numbers of ions, which our pulse shaping tool can be readily applied to (see Appendix~\ref{app:scalability}). 


% Figure environment removed 

\section{Discussion}
\label{sec:discussion}
\subsection{Efficiency of mode characterization}
\label{subsec:efficiency}

As much as accuracy is important in mode characterization, its efficiency also needs to be considered~\cite{Mingyu2022}. In an experimental setup, the parameters to be characterized inevitably drift over time. Therefore, quickly and frequently updating the parameters is necessary for efficient and accurate operation of a quantum computer~\cite{Maksymov2022}. However, in order to estimate $\eta_{j,p}$ with low uncertainty, the BSB transition needs to be performed to a sufficiently large degree (by using longer pulse length $\tau$ or larger average Rabi frequency $\bar{A}$), and this needs to be repeated for sufficiently many shots. In particular, the requirement for large number of shots is a major bottleneck for efficient mode characterization, as for each shot, cooling, state preparation, and measurement need to be performed in addition to the BSB transition~\cite{Mingyu2022}. 

As an example, we consider estimating $\eta_{p^*}$ with uncertainty $\Delta \eta$. Then, the difference in qubit population due to the change in $\eta_{p^*}$ by $\Delta \eta$ should exceed the shot noise; thus, the estimation is successful only if
\begin{equation}
    \frac{d \mathcal{P}}{d \eta_{p^*}} \Delta \eta \geq \sqrt{\frac{\mathcal{P} (1-\mathcal{P})}{S}},
\end{equation}
where $S$ is the number of shots. 
As briefly mentioned in Sec.~\ref{sec:method}, in the limit of small $|\eta_{p^*} \Theta^{(1)}_{p^*}| = |\eta_{p^*}| \alpha$, $\mathcal{P} \approx \left(\eta_{p^*} \alpha \right)^2$, and thus, up to a leading order in $\eta_{p^*} \alpha$, we obtain
\begin{equation}
    S \geq \left(2 \alpha \Delta \eta\right)^{-2}.
\end{equation}
Therefore, in order to achieve uncertainty $\Delta \eta$ with fewer shots, it is desirable to use a pulse of larger $\alpha$, which requires larger pulse power or a longer pulse length. We remind the readers that $\alpha$ is fixed to 1 for the analysis in Figs.~\ref{fig:2}(b) and \ref{fig:3}.

The limitation of the proposed pulse-shaping method is that the shaped pulses are guaranteed to achieve smaller errors than the square pulses only in the regime of $\alpha \lesssim 1$, as shown for the CMC error in Fig.~\ref{fig:2}(a). This is because for larger $\alpha$, the contribution from the second- and higher-order Magnus terms to the qubit population dominates that from the first-order Magnus terms that can be silenced by pulse shaping. Therefore, the applicability of our pulse-shaping method is limited to the case where performing a large number of shots is feasible and the uncertainty in the mode-parameter estimation due to the shot noise is dominated by the inaccuracy due to the CMC and detuning errors. 

A possible solution one can think of is to further silence the effect of the second-order Magnus terms by pulse shaping. A method for nulling second-order Magnus terms is proposed in Appendix~\ref{app:nulling_second_magnus}. However, based on the method, it is not feasible to silence all the second-order Magnus terms due to the positive-definiteness of the nulling condition matrices describing $\Theta_{p,p'}^{(2)}$ for $p=p'$ (details in Appendix~\ref{app:nulling_second_magnus}). 

Furthermore, we leave to future research whether removing the CMC and detuning errors by pulse shaping can be done without the Lamb-Dicke approximation ($|\eta_p| \ll 1$), similar to the works on pulse shaping for ultrafast two-qubit gates~\cite{GarciaRipoll03, Steane14, WongCampos17, Schafer18}. This potentially retains the advantage of pulse shaping for larger $\alpha$ and thus for an efficient mode characterization with fewer shots.

The efficiency of mode characterization can be further improved by employing parallelization; that is, probing $N$ values of $\eta_{j,p}$ simultaneously by driving BSB transition on all $N$ ions, each ion assigned to a different mode~\cite{Mingyu2022}. This can reduce the number of operations required to characterize all $N \times N'$ values of $\eta_{j,p}$ from $O(N^2)$ to $O(N)$. While na\"ively using the shaped pulses proposed in Sec.~\ref{sec:method} in parallel successfully removes the CMC errors up to first order in each $\eta_{j,p}$, various higher-order CMC errors that are different from those analyzed above may arise. This is because the off-resonant contribution of the BSB transition that probes mode $p_1$ to the population of mode $p_2 \neq p_1$ may interfere with the resonant contribution of the BSB transition that probes mode $p_2$ in parallel. The resulting errors in qubit populations, as well as a method of removing such errors by modifying the pulse-shaping scheme, need to be considered when parallelization is employed in future work. 

\subsection{Additional sources of errors}
\label{subsec:additionalerrors}

In this paper, we identify the CMC and the detuning of mode frequencies as sources of errors in the mode characterization and remove their effects by pulse shaping. Yet there are several other sources of errors that need to be addressed for performing accurate mode characterization. 

First, while we assume that the motional mode is initially at the ground state, in practice mode $p$ can initially be in a state of phonon number $n_{p} \geq 1$ with small but nonzero probability due to imperfect cooling. This is important for characterizing $\eta_p$ using BSB transitions, as the sideband Rabi frequency is proportional to $\eta_p \sqrt{n_p + 1}$. If the temperature, or the average phonon number $\bar{n}_p$, of the motional state after cooling is known, the qubit population can be computed by taking a weighted average over the distribution of initial phonon number $n_p$, where the distribution is straightforward to obtain from $\bar{n}_p$ assuming thermal distribution. The uncertainty in $\bar{n}_p$ may limit the accuracy of $\eta_p$ estimation. Nonetheless, using shaped pulses does not pose additional difficulties compared to using square pulses.

Second, the qubit population is also related to $\eta_p$'s by the Debye-Waller effect, as briefly explained in Sec.~\ref{sec:problem}. In the context of trapped ions, this effect refers to reduction in the Rabi frequency due to the nonzero width of the ion's position wavepacket, which spreads more as the ion is more strongly coupled to the motional modes~\cite{Wineland79, NIST_Bible}. While this effect is at most second order in $\eta_{p}$ and therefore ignored in the linearized Hamiltonian in (\ref{eq:HNmode}) and (\ref{eq:H1mode}), it may have a significant impact on the qubit population especially in long ion chains, as all $N'$ modes contribute to this Rabi-frequency reduction. Thus, the qubit population after the BSB transition with respect to mode $p^*$ depends on the values of all $\eta_{p}$'s ($p=1,\ldots, N'$). 

To estimate $\eta_{p^*}$ accurately, the reduction factors from all $N'$ modes need to be included in the model that predicts the qubit population. However, fitting the measured qubit populations to the model's predictions with all $\eta_p$'s as fitting parameters takes a prohibitively long computational time. Therefore, an iterative fitting routine, where the values of $\eta_p$'s obtained from the previous iterations of fitting are used in the current iteration for estimating $\eta_{p^*}$, is necessary. The algorithm for this fitting routine can be found in Appendix B of Ref.~\cite{Mingyu2022}, which is designed for square pulses but can be straightforwardly extended to shaped pulses as well. 

Finally, there are various other experimental imperfections that may cause errors in $\eta_p$ characterization. Examples of such imperfections are miscalibration of the pulse parameters, anharmonicity of the motional modes, optical crosstalk, and fluctuations of the mode parameters over time. The magnitudes of characterization errors as a result of the above-listed experimental imperfections need to be taken into account when determining the target uncertainty $\Delta \eta$ in estimating $\eta_p$. The target uncertainty $\Delta \eta$ may then be used for determining various parameters of the mode-characterization protocol, such as $\alpha$, $\tau$, and $S$, aiming for as efficient mode characterization as possible; see Sec. 6.1 of Ref.~\cite{Mingyu2022} for a detailed discussion that applies to both square and shaped pulses. 


\section{Outlook}
\label{sec:conclusion}

We devised a pulse-shaping scheme for high-accuracy characterization of the motional-mode parameters of trapped-ion quantum computers. We have extensively tested the effectiveness of our scheme in minimizing the CMC and detuning errors via simulations on a three-ion chain. Our results showed an improvement in the accuracy of $\eta_{j,p}$ estimation, even when the mode frequencies were not well known. 

Our pulse-shaping scheme solves one of the many engineering challenges for scaling up trapped-ion quantum computers. As the number of qubits within a trap increases, an accurate and efficient mode characterization in the presence of other motional modes becomes increasingly challenging.
By leveraging the degrees of freedom in pulse design for these experiments, our methodology offers one potential path forward to overcoming this scalability bottleneck, namely, accurately probing mode parameters in the presence of model violations and experimental imperfections. One of the exciting future directions may be to explore parallel pulse shaping, where multiple ions are addressed simultaneously to characterize mode parameters more efficiently.

The accurate and efficient characterization of these mode parameters holds the key to high-fidelity trapped-ion operations, such as parallel entangling gates \cite{Bentley20, Grzesiak20}. Briefly, these gates are implemented by illuminating each ion by custom-designed pulse shapes such that the induced interactions between the internal states of the ion qubits match those intended as quantum gates acting over multiple pairs of qubits simultaneously. Such interactions are, just as in a single two-qubit gate between two ion qubits, mediated by motional modes of the ion chain. As such, the parallel entangling gates intricately depends on the precise knowledge of the mode parameters for their high-fidelity implementation. Provided that these parallel gates have been proven to be versatile in enabling efficient quantum computing over a wide class of quantum programs~\cite{grzesiak2022efficient,bravyi2022constant}, the improvement achieved in characterizing mode parameters enabled by our methodology is expected to play a crucial role in realizing efficient quantum computation.

Our methodology of applying pulse shaping and other optimal control techniques for characterization tasks may readily be adopted to be applicable for different quantum computer architectures as well. Systems that rely on spectroscopic system parameter characterization like trapped ions can likely benefit from pulse shaping in their characterization by effectively eliminating significant model violations. We hope our work, which opens a large trade space of system-level optimization for exploration and exploitation, will help boost the effort of building a large-scale quantum computer. 


\section*{Acknowledgements}
\label{sec:ack}
Q.L. and M.K. thank Kenneth R. Brown for helpful suggestions. M.K. was supported by the Army Research Office, W911NF-21-1-0005.

\bibliography{bib}

\onecolumngrid
\appendix
\label{sec:appendix}
\input{Appendix} 

\end{document}
