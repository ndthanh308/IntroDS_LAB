% qcircuit file
% example of quantum polar code preparation -- N=8, i=3
% full implementation -- expanding ZZ and XX measurement circuits
%
\Qcircuit @C=0.7em @R=.6em {
\lstick{\ket{u_1}} & \targ  & \qw       & \qw        & \qw &&&& \qw[-4] &        
    \qw  \ar@{.}[]+<.25em,1em>;[d]+<.25em,-24em> & \ctrl{1} \ar@{.}[]+<1.45em,1em>;[d]+<1.45em,-24em> & \ustick{\color{red}\hspace*{-.3em}X} \qw                         & \qw   & \qw  \ar@{.}[]+<.35em,1em>;[d]+<.35em,-24em>  & \qw    & \qw &&&& \qw[-4]            &
        \targ      & \ustick{\color{red}\hspace*{-.3em}X} \qw       & \qw       & \qw        && \qw[-2] &\qw                \\
\lstick{\ket{+}}   & \ctrl{-1} & \ctrl{+1} & \meterb{X} & \cw &&&& \lstick{\ket{0}\hspace*{-.3em}}   &
 \qw &   \targ    & \ustick{\color{red}\hspace*{-.3em}Z} \qw & \targ                     & \ustick{\color{red}\hspace*{-.3em}Z} \qw &  \meterb{Z} & \cw &&&& \lstick{\ket{+}\hspace*{-.3em}}   &
        \ctrl{-1}  & \ctrl{7}  & \qw       & \qw     & \qw   & \meterb{X} & \cw            \\
\lstick{\ket{u_2}} & \qw       & \targ     & \qw        & \qw &&&& \qw[-4]            &
    \qw & \ctrl{3} & \qw    & \qw      & \qw                 & \qw        & \qw &&&& \qw[-4]            &
        \targ      & \qw       & \qw       & \qw        && \qw[-2]   & \qw                 \\
%
&                                                                                     \\
%
\lstick{\ket{u_3}} & \targ     & \qw       & \qw        & \qw &&&& \qw[-4]            &
    \qw      & \qw   & \qw & \ctrl{-3} & \ustick{\color{red}\hspace*{-.3em}Z} \qw                  & \qw        & \qw &&&& \qw[-4]            &
        \qw        & \qw       & \qw       & \targ      &\ustick{\color{red}\hspace*{-1em}Z} \qw & \qw                   & \qw \\
\lstick{\ket{+}}   & \ctrl{-1} & \ctrl{+1} & \meterb{X} & \cw &&&& \lstick{\ket{0}\hspace*{-.3em}}   & \qw &
    \targ   & \qw & \targ      & \qw                   & \meterb{Z} & \cw &&&& \lstick{\ket{+}\hspace*{-.3em}}   &
        \qw        & \qw       & \ctrl{7}  & \ctrl{-1}  & \ustick{\color{red}\hspace*{-1em}Z}  \qw & \meterb{X} & \cw            \\
\lstick{\ket{u_4}} & \qw       & \targ     & \qw        & \qw &&&& \qw[-4]            &
    \qw  & \qw    & \qw & \ctrl{-1}     & \qw               & \qw        & \qw &&&& \qw[-4]            &
        \qw        & \qw       & \qw       & \targ      && \qw[-2] &\qw                   \\
%
&                                                                                     \\
%
\lstick{\ket{u_5}} & \targ     & \qw       & \qw        & \qw &&&& \qw[-4]            &        
   \qw & \ctrl{1} & \qw  & \qw         & \qw              & \qw        & \qw &&&& \qw[-4]            &
        \qw        & \targ     & \qw       & \qw        && \qw[-2] & \qw                   \\
\lstick{\ket{+}}   & \ctrl{-1} & \ctrl{+1} & \meterb{X} & \cw &&&& \lstick{\ket{0}\hspace*{-.3em}}   & \qw &
    \targ & \qw   & \targ     & \qw                    & \meterb{Z} & \cw &&&& \lstick{\ket{+}\hspace*{-.3em}}   &
        \ctrl{-7}  & \ctrl{1}  & \qw       & \qw      & \qw  & \meterb{X} & \cw            \\
\lstick{\ket{u_6}} & \qw       & \targ     & \qw        & \qw &&&& \qw[-4]            &
   \qw &  \ctrl{3} & \qw  & \qw     & \qw                    & \qw        & \qw &&&& \qw[-4]            &
        \qw        & \targ     & \qw       & \qw        && \qw[-2] &\qw                    \\
%
&                                                                                     \\
%
\lstick{\ket{u_7}} & \targ     & \qw       & \qw        & \qw &&&& \qw[-4]            &
    \qw    & \qw  &  \qw & \ctrl{-3}                  & \qw    & \qw      & \qw &&&& \qw[-4]            &
        \qw        & \qw       & \targ     & \qw        && \qw[-2]  & \qw                  \\
\lstick{\ket{+}}   & \ctrl{-1} & \ctrl{+1} & \meterb{X} & \cw &&&& \lstick{\ket{0}\hspace*{-.3em}}   & \qw &
    \targ  & \qw  & \targ      & \qw                   & \meterb{Z} & \cw &&&& \lstick{\ket{+}\hspace*{-.3em}}   &
        \qw        & \qw       & \ctrl{1}  & \ctrl{-7} & \qw & \meterb{X} & \cw            \\
\lstick{\ket{u_8}} & \qw       & \targ     & \qw        & \qw &&&& \qw[-4]            &
    \qw    & \qw  &  \qw & \ctrl{-1}       & \qw             & \qw        & \qw &&&& \qw[-4]            &
        \qw        & \qw       & \targ     & \qw        && \qw[-2] & \qw \\ 
%
&                                                                  \\
%                                                                 \\
 &&&&&&& t = 1 & && 2 && 3 && 4 &&&&&&&&&&&                         \\  
}