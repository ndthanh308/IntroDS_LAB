% qcircuit file
% quantum polar transform decomposition Q_{2^n} = (I \otimes Q_{2^(n-k)})*(Q_{2^k} \otimes I)
%
\Qcircuit @C=1em @R=.5em {
\lstick{\ket{0}} & \qw \A{a} & \multigate{3}{Q_{2^k}} & \qww & \multigate{15}{Q_{2^{n-k}}} \A{M1} & \qw & \qw & \qw & \qw & \qw \A{ap} & \qw\\
                 &     & \nghost{Q_{2^k}} &   \\
                 &     & \nghost{Q_{2^k}} &   \\
\lstick{\ket{0}} & \qw \A{b} & \ghost{Q_{2^k}} & \qww \A{l} & \nghost{Q_{2^{n-k}}} & \A{r}  &  \qw & \multigate{15}{Q_{2^{n-k}}} \A{M2} & \qw & \qw \A{bp} & \qw
   \ar@{.}"a"-<0em,.4em>;"b"+<0em,.4em> \ar@{.}"ap"-<0em,.4em>;"bp"+<0em,.4em> 
   \ar@{-}@/^0.1pc/"l";"l"+<.8em,.4em> \ar@{-}@/^0.1pc/"r"+<-.8em,.4em>;"r" 
   \ar@{.}"M1"+<2em,-0.3em>;"M2"+<0em,.6em> \\
   %
   & \\
\lstick{\ket{+}} & \qw \A{a} & \multigate{3}{Q_{2^k}} & \qww & \ghost{Q_{2^{n-k}}} & \qw & \qw \A{lp} & \nghost{Q_{2^{n-k}}} & \A{rp} & \qw \A{ap} & \qw \\
                 &     & \nghost{Q_{2^k}} &   \\
                 &     & \nghost{Q_{2^k}} &   \\
\lstick{\ket{+}} & \qw \A{b} & \ghost{Q_{2^k}}\A{P1} & \qww \A{l} & \nghost{Q_{2^{n-k}}} & \A{r}  & \qw & \ghost{Q_{2^{n-k}}} & \qw & \qw \A{bp} & \qw
   \ar@{.}"a"-<0em,.4em>;"b"+<0em,.4em> \ar@{.}"ap"-<0em,.4em>;"bp"+<0em,.4em>
   \ar@{-}@/^0.1pc/"l";"l"+<.8em,.4em> \ar@{-}@/^0.1pc/"r"+<-.8em,.4em>;"r" 
   \ar@{-}@/^0.1pc/"lp";"lp"+<.8em,.4em> \ar@{-}@/^0.1pc/"rp"+<-.8em,.4em>;"rp" \\
   %
   & \\
   & \\
   & \\
   & \\
   & \\
   & \\
\lstick{\ket{+}} & \qw \A{a} & \multigate{3}{Q_{2^k}}\A{P2} & \qww & \ghost{Q_{2^{n-k}}} \A{M1} & \qw & \qw \A{l} & \nghost{Q_{2^{n-k}}} & \A{r}  & \qw \A{ap} & \qw \\
                 &     & \nghost{Q_{2^k}} &   \\
                 &     & \nghost{Q_{2^k}} &   \\
\lstick{\ket{+}} & \qw \A{b} & \ghost{Q_{2^k}} & \qww & \qw & \qw & \qw & \ghost{Q_{2^{n-k}}} \A{M2} & \qw & \qw \A{bp} & \qw 
   \ar@{.}"a"-<0em,.4em>;"b"+<0em,.4em> \ar@{.}"ap"-<0em,.4em>;"bp"+<0em,.4em>
   \ar@{-}@/^0.1pc/"l";"l"+<.8em,.4em> \ar@{-}@/^0.1pc/"r"+<-.8em,.4em>;"r"
   \ar@{.}"P1"-<0em,.8em>;"P2"+<0em,.8em> 
   \ar@{.}"M1"-<0em,.6em>;"M2"-<2em,-0.3em>
   %
   \inputgrouph{10}{15}{1.1em}{\rotatebox{90}{\small $2^{n-k}$}}{-2.8em}
   \inputgrouph{10}{15}{1.1em}{\rotatebox{90}{\small times}}{-3.8em}
   \inputgrouph{16}{19}{2.1em}{\rotatebox{-35}{\small $2^{k}$ times}}{-12.4em}
   \gategroup{1}{3}{19}{9}{.7em}{--}
   \inputgrouph{19}{19}{1.6em}{Q_{2^n}}{-9em}
}