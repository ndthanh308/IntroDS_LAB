\section{Proposed Inter-CSP deduplication scheme}
In the previous section, we proposed a dedup scheme with a single CSP whereas in this section, we propose a Blockchain-based inter-CSP deduplication scheme, which consists a root level smart contract $\mathcal{B}_{I\text{-}DEDU}$, a smart contract $\mathcal{B}_{DEDU}$ for each CSP, protocols to interact with $\mathcal{B}_{DEDU}$, and a public Blockchain network to deploy the smart contracts.
\subsection{Assumptions}
\begin{enumerate}
	\item We assume all the CSPs charges the same $SF_{u}^{c}(t)$ and $EF_{u}^{c}(t)$ values. 
	\item We assume that no CSP will collect extra fee other than $SF_{u}^{c}(t)$ or $EF_{u}^{c}(t)$ for inter CSP deduplication. Inter-CSP deduplication is same as single CSP deduplication from the cloud users perspective.
	\item A CSP $c_{1}$ pays a fee of $AF^{c}(t)$ to a CSP $c_{2}$ for accessing the data stored at $c_{2}$.
	\end{enumerate}
\subsection{$\mathcal{B}_{I\text{-DEDU}}$}
The inter-CSP deduplication is similar to single CSP deduplication except that now a root-level smart contract has the information about tags of data stored in different CSPs. The clauses in $\mathcal{B}_{I\text{-}DEDU}$ are as follows:
\begin{enumerate}[label={(\arabic*)}]
		\item An organization $\mathcal{O}$ (like a consortium of CSPs) creates a smart contract to facilitate inter CSP deduplication scheme. $\mathcal{O}$ designs and deploys the $\mathcal{B}_{I\text{-}DEDU}$ on a public Blockchain network and shares the smart contract address and ABI with all the registered CSPs\footnote{We assume a registration phase is executed before deploying the smart contract and only registered CSPs can exchange messages with $\mathcal{B}_{I\text{-}DEDU}$}.
		\item Each CSP $c_{i}$ also deploys a smart contract $\mathcal{B}_{DEDU}^{i}$ on a public Blockchain network and announces the smart contract address and smart contract ABI on a public platform (like a website/bulletin board) and also registers $\mathcal{B}_{DEDU}^{i}$ address with $\mathcal{B}_{I\text{-}DEDU}$.
		\item A user $u$ sends request to $\mathcal{B}_{DEDU}^{i}$ similar to clause (3) in Section \ref{contract:1}.
		\item $\mathcal{B}_{DEDU}^{i}$ performs checks similar to clause (4) in Section \ref{contract:1}. If the check is valid, it will compute the fee to be paid by $u$ according to the dedup rate and sends this information to $u$. Otherwise it will send a request containing $tag$ to $\mathcal{B}_{I\text{-}DEDU}$.
		\item $\mathcal{B}_{I\text{-}DEDU}$ checks whether any CSP is holding data with the same $tag$. If check is not valid, then it will return $N/A$ to $\mathcal{B}_{DEDU}^{i}$. Then $\mathcal{B}_{DEDU}$ will compute the fee as $SF_{u}^{c}(t)*|d|+ EF_{u}^{c}(t)$ and send it to $u$. Otherwise $\mathcal{B}_{I\text{-}DEDU}$ will send the information about the smart contract $\mathcal{B}_{DEDU}^{j}$ and CSP $c_{j}$ which is holding the data with $tag$.   
		\item If $\mathcal{B}_{DEDU}^{i}$ receives the info about $c_{j}$, then a request message is sent to $\mathcal{B}_{DEDU}^{j}$ from $\mathcal{B}_{DEDU}^{i}$. Then $\mathcal{B}_{DEDU}^{j}$ computes the fee according to the dedup rate and sends it to $\mathcal{B}_{DEDU}^{i}$, which will be then forward to user $u$ by $\mathcal{B}_{DEDU}^{i}$.
		\\ From here on, we assume that inter CSP deduplication is found and the contract proceeds as follows:
		\item If $\tau > \tau_{p}$ and $u$ has not sent the fee to $\mathcal{B}_{DEDU}^{i}$, then $\mathcal{B}_{DEDU}^{i}$ also won't send fee to $\mathcal{B}_{DEDU}^{j}$. $u$'s deposit is forfeited. This deposit is sent to $c_{j}$ and the request is marked as terminated by both $\mathcal{B}_{DEDU}^{j}$ and $\mathcal{B}_{DEDU}^{i}$.
		\item If $\tau > \tau_{c1}$ and $c_{j}$ has not sent the confirmation message to $\mathcal{B}_{DEDU}^{j}$, then the fee paid by $u$ is refunded and the request is marked as terminated by both $\mathcal{B}_{DEDU}^{j}$ and $\mathcal{B}_{DEDU}^{i}$.
		\item If $\tau > \tau_{c2}$ and $u$ has not sent the confirmation message to $\mathcal{B}_{DEDU}^{i}$, then $\mathcal{B}_{DEDU}^{i}$ won't send confirmation to $\mathcal{B}_{DEDU}^{j}$. The fee paid by $u$ is refunded. Else, a fee $AF^{c}(t)$ is sent to $c_{j}$ from $c_{i}$ and the request is marked as terminated by both $\mathcal{B}_{DEDU}^{j}$ and $\mathcal{B}_{DEDU}^{i}$. 
\end{enumerate}
The analysis of $\mathcal{B}_{I\text{-}DEDU}$ is similar to $\mathcal{B}_{DEDU}$ and all the properties satisfied by $\mathcal{B}_{DEDU}$ are also satisfied by $\mathcal{B}_{I\text{-}DEDU}$. The formal smart contract $contract$-$\mathcal{B}_{I\text{-}DEDU}$ is presented in Figure \ref{fig:contractInter}.
% Figure environment removed

