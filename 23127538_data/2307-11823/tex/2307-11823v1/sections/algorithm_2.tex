% % Figure environment removed


\renewcommand{\lstlistingname}{Code} % Code to Algorithm
\begin{lstlisting}[language=python,caption={PyTorch-style pseudocode for $\mathcal{HA_{S}}$ and $\mathcal{HA^{++}_{S}}$.},captionpos=b,frame=single, label={fig:pseudo_code_2}]
def hybrid_augment_single(x, prob, blur_fnc, sample_augs, is_ha_plus):
    #x: a single training image
    #prob: probability value [0,1]
    #blur_fnc: blurring function
    #sample_augs: randomly sample augmentations
    #is_ha_plus: True for HA++, false for HA
    #fft, ifft: fourier and inverse fourier transform 
    
    p = random.uniform(0,1)
    if p > prob:
        return x

    #First augmented view.
    ops1 = sample_augs()
    x_aug1 = ops1(x)

    #Second augmented view.
    ops2 = sample_augs()
    x_aug2 = ops2(x)

    lfc_f = blur_fnc(x_aug1)
    hfc_f  = x_aug1 - lfc_f

    lfc_s = blur_fnc(x_aug2)
    hfc_s  = x_aug2 - lfc_s

    if is_ha_plus:
        #For lfc_f.
        p = random.uniform(0, 1)
        if p > 0.6:
            lfc_f = lfc_f
        else:
            ops3 = sample_augs()
            lfc_aug = ops3(lfc_f)
            ops4 = sample_augs()
            lfc_aug_2 = ops4(lfc_f)
            
            phase1, amp1 = fft(lfc_aug)
            phase2, amp2 = fft(lfc_aug_2)
            lfc_f = ifft(phase1, amp2)

        #For lfc_s.
        p = random.uniform(0, 1)
        if p > 0.6:
            lfc_s = lfc_s
        else:
            ops5 = sample_augs()
            lfc_aug = ops5(lfc_s)
            ops6 = sample_augs()
            lfc_aug_2 = ops6(lfc_s)
            
            phase1, amp1 = fft(lfc_aug)
            phase2, amp2 = fft(lfc_aug_2)
            lfc_s = ifft(phase1, amp2)
    
    p = random.uniform(0, 1)
    
    if p > self.prob:
        hybrid_im = lfc_f + hfc_s
    else:
        hybrid_im = lfc_s + hfc_f

    return hybrid_im
\end{lstlisting}
\renewcommand{\lstlistingname}{Code} % Code to Algorithm
