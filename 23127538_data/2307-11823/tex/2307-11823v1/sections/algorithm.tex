% % Figure environment removed


\begin{lstlisting}[language=python,caption={PyTorch-style pseudocode for $\mathcal{HA_{P}}$ and $\mathcal{HA^{++}_{P}}$.},captionpos=b, frame=single,label={fig:pseudo_code}]
def hybrid_augment_paired(x_batch, prob, blur_fnc, is_ha_plus):
    #x_batch: batch of training images
    #prob: probability value [0,1]
    #blur_fnc: blurring function
    #is_ha_plus: True for HA++, false for HA
    #fft: fourier transform 
    #ifft: inverse fourier transform 
    
    p = random.uniform(0,1)
    if p > prob:
        return x

    batch_size = x_batch.size()[0]
    index = torch.randperm(batch_size)

    lfc = blur_fnc(x_batch)
    hfc = x - lfc
    hfc_mix = hfc[index]

    if is_ha_plus:
        #Based on the APR method.
        p = random.uniform(0,1)
        if p > 0.6:
            lfc  = lfc
        else:
            index_p = torch.randperm(batch_size)
            phase1, amp1 = fft(lfc)
            lfc_mix = lfc[index_p]
            phase2, amp2 = fft(lfc_mix)
            lfc = ifft(phase1, amp2)
    
    hybrid_ims = lfc + hfc_mix
    return hybrid_ims
\end{lstlisting}
\renewcommand{\lstlistingname}{Code} % Code to Algorithm
