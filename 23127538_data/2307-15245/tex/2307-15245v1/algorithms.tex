\section{Algorithms}


\begin{algorithm}[H]
\caption{Federated Learning}
\label{alg:FedAvg}

% \DontPrintSemicolon
% \SetCommentSty{mycommfont}
% \SetAlgoLined
% \SetKwInOut{Req}{Require}
% \SetKwFunction{FClient}{ClientUpdate}
% \SetKwProg{Fn}{}{:}{}

\begin{algorithmic}[1]
\REQUIRE number of clients ($N$), sampling rate ($C\in(0,1]$), number of communication rounds ($T$), local dataset of client $k$ ($D_k$), number of local epoch ($E$), number of local batch size ($B$), learning rate ($\eta$).
%\SetKwProg{Fn}{Server Executes}{:}{}
\STATE \textbf{Server Executes:}
\STATE Initialize the server model with $\btheta_g^0$ \;
\FOR {each round $t = 0, 1, \ldots, T-1$}
\STATE $m \leftarrow {\rm{max}}(C \cdot N,1)$ \;
\STATE $S_t \leftarrow $(random set of m clients) \; %\tcp*{set of $m$ available clients}
\FOR {each client $k \in S_t$ \rm{\textbf{in parallel}}}
\STATE $\btheta^{t+1}_{k}\leftarrow {\mathtt{ClientUpdate}}(k; \btheta^t_{g} )$ \; 
%$\theta^{t+1}_{g}=\sum_{k \in S_t }{|D_{k}|\theta^{t+1}_{k}}  /\sum_{k \in S_t }{|D_{k}|}$
\ENDFOR
\STATE $\btheta^{t+1}_{g}=\mathtt{ModelFusion}(\{\btheta_k \}_{k \in S_t})$
\ENDFOR
\vspace{1mm}
\FUNCTION {$\mathtt{ClientUpdate}(k, \btheta^t_{g})$}
\STATE $\btheta^{t}_k \leftarrow \btheta^t_{g}$ \;
\STATE $\mathcal{B} \leftarrow$ ({randomly splitting $D_k^{train}$ into batches of Size $B$})\;
\FOR {each local epoch $ \in \{1, \ldots, E\}$}
\FOR {each batch $\mathbf{b} \in \mathcal{B}$}
\STATE $\btheta^{t}_k \leftarrow \btheta^{t}_k - \eta \nabla_{\btheta^{t}_k} \ell(f_k(\bx; \btheta^{t}_k), y)$\;
\ENDFOR
\ENDFOR
\STATE $\btheta^{t+1}_k \leftarrow \btheta^{t}_k$\;
\ENDFUNCTION
% \Fn{\FClient{$k, \btheta^t_{g}$}}{
%     \STATE $\btheta^{t}_k \leftarrow \btheta^t_{g}$ \;
%     \STATE $\mathcal{B} \leftarrow$ ({randomly splitting $D_k$ into batches of Size $B$})\;
%     \For {each local epoch $i = 1, \dots, E$} {
%         \For {each batch $\mathbf{b} \in \mathcal{B}$} {
%             \STATE $\btheta^{t}_k \leftarrow \btheta^{t}_k - \eta \nabla_{\btheta^{t}_k} f_k(\btheta^{t}_k; \mathbf{b})$\;
%         }
%     }
%     \STATE $\btheta^{t+1}_k \leftarrow \btheta^{t}_k$\;
%     \KwRet $\btheta^{t+1}_{k}$\;
% }
\end{algorithmic}
\end{algorithm}


% \begin{algorithm}[H]
% \caption{FedAvg}
% \label{alg:FedAvg}

% % \DontPrintSemicolon
% % \SetCommentSty{mycommfont}
% % \SetAlgoLined
% % \SetKwInOut{Req}{Require}
% % \SetKwFunction{FClient}{ClientUpdate}
% % \SetKwProg{Fn}{}{:}{}

% \begin{algorithmic}[1]
% \STATE \textbf{Require:} number of clients ($N$), sampling rate ($C\in(0,1]$), number of communication rounds ($T$), local dataset of client $k$ ($D_k$), number of local epoch ($E$), number of local batch size ($B$), learning rate ($\eta$).
% %\SetKwProg{Fn}{Server Executes}{:}{}
% \STATE \textbf{Server Executes:}
% \STATE $\quad$ Initialize the server model with $\btheta_g^0$ \;
% \FOR {each round $t = 0, 1, \dots, T-1$}
% \STATE $\quad$ $m \leftarrow {\rm{max}}(C \cdot N,1)$ \;
% \STATE $\quad$ $S_t \leftarrow $(random set of m clients) \; %\tcp*{set of $m$ available clients}
% $\quad$ \FOR {each client $k \in S_t$ \rm{\textbf{in parallel}}}
% \STATE $\quad$ $\btheta^{t+1}_{k}\leftarrow {\mathtt{ClientUpdate}}(k; \btheta^t_{g} )$ \; 
% %$\theta^{t+1}_{g}=\sum_{k \in S_t }{|D_{k}|\theta^{t+1}_{k}}  /\sum_{k \in S_t }{|D_{k}|}$
% \ENDFOR
% \STATE $\quad$ $\btheta^{t+1}_{g}=\mathtt{ModelFusion}(\{\btheta_k \}_{k \in S_t})$
% \ENDFOR
% \vspace{1mm}
% \FUNCTION {$\mathtt{ClientUpdate}(k, \btheta^t_{g})$}
% \STATE H
% \ENDFUNCTION
% % \Fn{\FClient{$k, \btheta^t_{g}$}}{
% %     \STATE $\btheta^{t}_k \leftarrow \btheta^t_{g}$ \;
% %     \STATE $\mathcal{B} \leftarrow$ ({randomly splitting $D_k$ into batches of Size $B$})\;
% %     \For {each local epoch $i = 1, \dots, E$} {
% %         \For {each batch $\mathbf{b} \in \mathcal{B}$} {
% %             \STATE $\btheta^{t}_k \leftarrow \btheta^{t}_k - \eta \nabla_{\btheta^{t}_k} f_k(\btheta^{t}_k; \mathbf{b})$\;
% %         }
% %     }
% %     \STATE $\btheta^{t+1}_k \leftarrow \btheta^{t}_k$\;
% %     \KwRet $\btheta^{t+1}_{k}$\;
% % }
% \end{algorithmic}
% \end{algorithm}

% \begin{algorithm}[H]
% \caption{FedProx}
% \label{alg:FedProx}

% \DontPrintSemicolon
% \SetCommentSty{mycommfont}
% \SetAlgoLined
% \SetKwInOut{Req}{Require}
% \SetKwFunction{FClient}{ClientUpdate}

% \Req{number of clients ($N$), sampling rate ($C\in(0,1]$), number of communication rounds ($T$), 
% local dataset of client $k$ ($D_k$), number of local epoch ($E$), number of local batch size ($B$), learning rate ($\eta$), FedProx parameter ($\mu$)\;}
% \SetKwProg{Fn}{Server Executes}{:}{}
% \Fn{}{
% Initialize the server model with $\theta_g^0$ \;
% \For {each round $t = 0, 1, \dots, T-1$} {
%  $m \leftarrow {\rm{max}}(C \cdot N,1)$\;
%  $S_t \leftarrow $(random set of m clients)\; %\tcp*{set of $m$ available clients}
% \For  {each client $k \in S_t$ \rm{\textbf{in parallel}}}
% { 
% $\theta^{t+1}_{k}\leftarrow {\mathtt{ClientUpdate}}(k; \theta^t_{g} )$ \; 
% }

% $\theta^{t+1}_{g}=\sum_{k \in S_t }{|D_{k}|\theta^{t+1}_{k}}  /\sum_{k \in S_t }{|D_{k}|}$
% }
% }
% %\Indm
% \SetKwProg{Fn}{}{:}{}
% \Fn{\FClient{$k, \theta^t_{g}$}}{
%      $\theta^{t}_k \leftarrow \theta^t_{g}$\;
%      $\mathcal{B} \leftarrow$ ({randomly splitting $D_k$ into batches of Size $B$})\;
%     \For {each local epoch $i = 1, \dots, E$} {
%         \For {each batch $\mathbf{b} \in \mathcal{B}$} 
%         {
%              $\theta^{t+1}_k \leftarrow \argmin_{\theta_k} \mathbb{E} \left[ f(\theta_k; \mathbf{b}) \right] + \frac{\mu}{2} ||\theta_k - \theta^t_k||^2$\;
%         }
%     }
%     $\theta^{t+1}_k \leftarrow \theta^{t}_k$\;
%     \KwRet $\theta^{t+1}_{k}$\;
% }
% \end{algorithm}

