\tikzset{
	entity/.style = {
		draw = kon,
		fill = ao,
		fill opacity = 1
	},
	cred/.style = {
		fill = usumurazaki,
		fill opacity = 1,
		draw = murazaki,
	},
	space/.style = {
		draw = white,
		line width = 0,
		fill = white,
		fill opacity = 1
	},
	phantom/.style = {
		draw = beni,
		fill = momo,
		fill opacity = 0.05,
		line width = 0.6pt,
		rounded corners = 5pt,
	},
	vdr/.style = {
		draw = momo!30!anzu,
		line width = 0.6pt,
		fill = anzu,
		fill opacity = 1,
		rounded corners=5pt
	},
	node/.style = {
		fill = usumurazaki!20,
		fill opacity = 1,
		draw = usumurazaki,
	},
	state/.style = {
		fill = usumurazaki,
		fill opacity = 1,
		draw = murazaki,
	},
	new/.style = {
		draw = murazaki,
		fill = usumurazaki!60,
		fill opacity = 1,
	},
	none/.style = {
		fill = white,
		draw = murazaki,
%		dash pattern = {on 1pt off 1pt},
%		line width = 0.3pt,
	},
	branch/.style = {
		draw = usumurazaki!50,
		rounded corners = 2pt
	},
	frame/.style = {
		draw = black,
		rounded corners = 3pt,
		fill=mizu!60,
		drop shadow={opacity=0.7, shadow xshift=2.5, shadow yshift=-2.8},
	},
	nullifier/.style = {
		fill = beni!50,
		fill opacity = 1,
		draw = beni,
	},
	secret/.style = {
		fill = ao!30,
		draw = kon,
		rounded corners = 2pt,
	},
}

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]

% ==================================================================================================
% Merkle tree in phantom states
% ==================================================================================================

% frame
\draw [phantom] (0,0) rectangle (135, 120);

% Branches
\draw [branch] (67.5,30) -- (67.5,42.5) -- (97.5,42.5) -- (97.5,55); % layer 1 - 2
\draw [branch, draw = murazaki!70!black] (67.5,30) -- (67.5,42.5) -- (37.5,42.5) -- (37.5,55);
\draw [branch] (37.5,55) -- (37.5,67.5) -- (22.5,67.5) -- (22.5,80); % layer 2 - 3
\draw [branch, draw = murazaki!70!black] (37.5,55) -- (37.5,67.5) -- (52.5,67.5) -- (52.5,80);
\draw [branch] (97.5,55) -- (97.5,67.5) -- (82.5,67.5) -- (82.5,80);
\draw [branch] (97.5,55) -- (97.5,67.5) -- (112.5,67.5) -- (112.5,80);
\draw [branch] (22.5,80) -- (22.5,92.5) -- (15,92.5) -- (15,105); % layer 3 - 4
\draw [branch] (22.5,80) -- (22.5,92.5) -- (30,92.5) -- (30,105);
\draw [branch] (52.5,80) -- (52.5,92.5) -- (45,92.5) -- (45,105);
\draw [branch, draw = murazaki!70!black] (52.5,80) -- (52.5,92.5) -- (60,92.5) -- (60,105);
\draw [branch] (82.5,80) -- (82.5,92.5) -- (75,92.5) -- (75,105);
\draw [branch] (82.5,80) -- (82.5,92.5) -- (90,92.5) -- (90,105);
\draw [branch] (112.5,80) -- (112.5,92.5) -- (105,92.5) -- (105,105);
\draw [branch] (112.5,80) -- (112.5,92.5) -- (120,92.5) -- (120,105);

% nodes
\draw [state]	(67.5, 30)	circle (6); % layer 1 (root)
\draw [node]		(37.5, 55)	circle (6); % layer 2
\draw [node]		(97.5, 55)	circle (6);
\draw [node]		(22.5, 80)	circle (6); % layer 3
\draw [node]		(52.5, 80)	circle (6);
\draw [node]		(82.5, 80)	circle (6);
\draw [node]		(112.5,80)	circle (6);
\draw [state]	(15, 105)	circle (6); % layer 4 (leaves)
\draw [state]	(30, 105)	circle (6);
\draw [state]	(45, 105)	circle (6);
\draw [new]		(60, 105)	circle (6);
\draw [none]		(75, 105)	circle (6);
\draw [none]		(90, 105)	circle (6);
\draw [none]		(105, 105)	circle (6);
\draw [none]		(120, 105)	circle (6);


% ==================================================================================================
% Contract States
% ==================================================================================================

% frame
\draw  [vdr] (145,0) rectangle (285,120);

% Unit: Merkle root
\draw [frame] (152, 25) rectangle (212, 55);

% Unit: Merkle proof
\draw [frame] (218, 25) rectangle (278, 55);

% Unit: Merkle leaves
\draw [frame] (152, 70) rectangle (212, 110);
\draw [state] (165, 88) circle (5);
\draw [state] (182, 88) circle (5);
\draw [state] (199, 88) circle (5);
\draw [new]   (165, 101) circle (5);

% Unit: Nullifiers
\draw [frame] (218, 70) rectangle (278, 110);
\draw [nullifier] (231, 89) rectangle (240, 98);
\draw [nullifier] (256, 89) rectangle (265, 98);

% ==================================================================================================
% Holder
% ==================================================================================================

\draw  [entity] (25.09,156.74) .. controls (22.43,147.72) and (26.19,142.41) .. (31.25,141.56) .. controls (32.42,141.43) and (35.53,140.14) .. (39.09,143.31) .. controls (44.61,143.96) and (45.38,154.21) .. (42.86,156.87) .. controls (44.22,158.42) and (43.76,160.82) .. (41.82,162.05) .. controls (41.43,164.65) and (40.46,166.14) .. (39.48,167.56) .. controls (39.16,169.12) and (39.16,170.35) .. (39.48,172.17) .. controls (42.14,176.77) and (54.07,176.12) .. (55.05,185.59) .. controls (16.34,185.59) and (52.78,185.66) .. (13.29,185.53) .. controls (14.2,176.45) and (26.39,176.51) .. (28.59,172.17) .. controls (29.11,170.35) and (28.85,169.64) .. (28.66,167.5) .. controls (27.55,165.62) and (26.45,164.52) .. (25.93,162.12) .. controls (24.96,160.76) and (23.14,158.62) .. (25.09,156.74) -- cycle ;

\draw [draw = kon!90!black, ->] (50,165) -- (74,165);
\draw [rounded corners = 2pt, draw = kon!90!black, ->] (145,165) -- (160,165) -- (160,145) -- (173,145);
\draw [rounded corners = 2pt, draw = kon!90!black, ->] (145,165) -- (160,165) -- (160,185) -- (173,185);
\draw [branch, draw = murazaki!70!black, ->] (180,137.5) -- (180, 101) -- (171, 101);
\draw [branch, draw = murazaki!70!black, ->] (180, 128) -- (60, 128) -- (60, 112.5);
\draw [branch, draw = beni, ->] (187,185) -- (260, 185) -- (260, 100);
\draw [branch, draw = murazaki!70!black, ->] (73.5,30) -- (151, 30);
%\draw [branch, draw = murazaki!70!black, ->] (140,30) -- (140, 65) -- (250, 65) -- (250, 57);

\draw [secret] (75, 156) rectangle (145, 174);
\draw [new, fill = usumurazaki!25]	(180, 145)	circle (6);
\draw [nullifier] (175, 180) rectangle (185, 190);

% ==================================================================================================
% Proof of identity
% ==================================================================================================

%% Paper, shape
%\draw  [cred] (253.15,145.5) -- (253.15,154.8) -- (262.45,154.8) -- (262.45,184.24) -- (231.45,184.24) -- (231.45,145.5) -- cycle ;
%
%% Paper, folding corner
%\draw  [cred] (254.23,153.72) -- (261.73,153.72) -- (254.23,146.12) -- cycle ;
%
%% Merkle tree
%\draw  [space] (245.04,156.33) -- (248.73,156.33) -- (248.73,158.79) -- (245.04,158.79) -- cycle ;
%\draw  [space] (239.51,163.71) -- (243.2,163.71) -- (243.2,166.17) -- (239.51,166.17) -- cycle ;
%\draw  [space] (250.57,163.71) -- (254.26,163.71) -- (254.26,166.17) -- (250.57,166.17) -- cycle ;
%\draw  [space] (237.05,171.08) -- (240.74,171.08) -- (240.74,173.54) -- (237.05,173.54) -- cycle ;
%\draw  [space] (241.97,171.09) -- (245.65,171.09) -- (245.65,173.55) -- (241.97,173.55) -- cycle ;
%\draw  [space] (248.11,171.09) -- (251.8,171.09) -- (251.8,173.55) -- (248.11,173.55) -- cycle ;
%\draw  [space] (253.03,171.08) -- (256.72,171.08) -- (256.72,173.54) -- (253.03,173.54) -- cycle ;
%
%\draw  [draw = white]	(246.88,161.31) -- (246.88,157.56) ;
%\draw  [draw = white]	(241.35,168.68) -- (241.35,164.94) ;
%\draw  [draw = white]	(252.41,168.69) -- (252.41,164.94) ;
%\draw  [draw = white]	(241.35,164.94) -- (241.35,161.25) -- (252.41,161.25) -- (252.41,164.94) ;
%\draw  [draw = white]	(238.89,172.31) -- (238.89,168.58) -- (243.81,168.58) -- (243.81,172.32) ;
%\draw  [draw = white]	(249.96,172.32) -- (249.96,168.59) -- (254.87,168.59) -- (254.87,172.31) ;
%
%% Proof, circle
%\draw  [draw opacity=0, fill=momo, fill opacity=1] (256.79,181.67) .. controls (256.79,178.56) and (259.31,176.04) .. (262.42,176.04) .. controls (265.53,176.04) and (268.05,178.56) .. (268.05,181.67) .. controls (268.05,184.78) and (265.53,187.3) .. (262.42,187.3) .. controls (259.31,187.3) and (256.79,184.78) .. (256.79,181.67) -- cycle ;
%
%% Proof, tick
%\draw [draw = white, line width=1.5]	(259.01,181.85) -- (261.13,184.09) -- (265.6,179.74) ;

% ==================================================================================================
% Labels
% ==================================================================================================

\draw (215,10)		node  [font=\footnotesize] {\textit{VDR Contract State}};
\draw (67.5,10)		node  [font=\footnotesize] {\textit{Merkle Tree}};
\draw (34.5,195)		node  [font=\footnotesize] {\textit{Holder}};
%\draw (247.5,195)	node  [font=\footnotesize] {\textit{Credential}};

\draw (182, 32)	node [font=\footnotesize, scale = 0.8] {\textit{Merkle root}};
\draw (248, 33)	node [font=\footnotesize, scale = 0.8] {\textit{Merkle proof}};
\draw (182, 77)	node [font=\footnotesize, scale = 0.8] {\textit{Leaves}};
\draw (248, 78)	node [font=\footnotesize, scale = 0.8] {\textit{Nullifiers}};

\draw (182, 45.5) node [scale = 0.75] {$r_\mathsf{id} \to r_\mathsf{id}'$};
\draw (248, 45) node [scale = 0.75] {$\rho_\mathsf{id} \to \rho_\mathsf{id}'$};

\draw (110, 165)		node [scale = 0.75] {\textit{Identifier} $\mathsf{id}_\mathcal{H}$};

\draw (220,178)		node  [font=\scriptsize, beni] {\textit{invalidate}};
\draw (195,127)		node  [font=\scriptsize, murazaki] {\textit{submit}};
\draw (113,24)		node  [font=\scriptsize, murazaki] {\textit{update}};

\end{tikzpicture}