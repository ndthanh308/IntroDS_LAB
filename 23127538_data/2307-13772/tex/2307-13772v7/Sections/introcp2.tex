
In addition to aggregating information, asset markets allow agents to exhaust private gains from trade. While there is a well developed literature on the informativeness of prices, less is known about if and when markets effectively exhaust all gains from trade.\footnote{Gains from trade comprise an idiosyncratic private value for the underlying asset, but also idiosyncratic preferences for trade speed or ``liquidity.''Agents' idiosyncratic value for the underlying asset are plausibly determined by their portfolio positions, and therefore independent of the trading place.  By contrast, their idiosyncratic preference for liquidity determines market quality.} In this paper, we exploit the unique design of a decentralized exchange to shed light on the market for liquidity and show, theoretically and empirically, that market fragmentation can improve trading efficiency.  
% Understanding how costs affect the market for liquidity is central to %understanding asset prices and whether asset exchange is efficient.  Indeed, %as \citet{demsetz1968} puts it ``the question that is relevant for efficiency %is whether or not the cost is appropriately economized.''  

Automated market makers such as Uniswap v3 provide a unique environment to investigate the market for liquidity. While there are various new institutional details that animate these exchanges, for our purposes  three are economically important.   First, in automated exchanges, liquidity demand and supply can easily be distinguished:  users either supply or demand liquidity.  Because of this, we can isolate the effect of transactions costs on each side of the market for liquidity.  Second, costs and benefits incurred by liquidity suppliers are easier to observe because prices are not set by market participants, but are automatically calculated as a function of liquidity demand and supply. Thus, liquidity suppliers are not compensated through price impact. Third, market participants are pseudo-anonymous so we can identify and document liquidity suppliers at a high frequency. These unique features allow us to investigate, theoretically and empirically, how transactions costs affect liquidity supply. 
%\mz{Do we want to emphasize heterogeneity in LP from the first paragraph?}
 
 
 
 Beyond investigating the market for liquidity, there are three additional reasons to investigate liquidity provision in AMMs.  First, these markets are large and successful in their own right: After its May 2021 launch, Uniswap v3 features daily trading volume in excess of  US \$1 billion. Second,  for major pairs such as Ether against USD stablecoins, Uniswap boasts twice or three times better liquidity than continuous limit order exchanges such as Binance, which suggests that this design can be economically superior.\footnote{See \href{https://uniswap.org/blog/uniswap-v3-dominance}{The Dominance of Uniswap v3 Liquidity}; May 5, 2022.} Third, as traditional assets become tokenized, and markets become more automated, this new market form could be adopted.\footnote{Swarm --- a BaFin regulated entity --- already offers AMM trading for a variety of tokenized Real World Assets.}   
 
 
Uniswap v3 provides two innovations over the previous v2. First, liquidity suppliers and demanders  select into  trading places (called pools) that differ on transaction fees. Each asset pair to be traded on up to four liquidity pools that only differ in the compensation for liquidity providers: in particular, liquidity fees can be equal to 1, 5, 30, or 100 basis points and the corresponding tick sizes are 1, 10, 60, or 200 basis points.  These proportional fees are paid by liquidity demanders and are the only source of remuneration to liquidity providers.  (These fees, as we discuss below, are similar to the make-take fees that are prevalent in limit order markets.) 
Second, on Uniswap v3, liquidity providers can submit ``concentrated liquidity."  Even though their liquidity is passively supplied, they can choose the price range over which it is supplied. With volatile assets, these concentrated liquidity positions can become stale and require rebalancing. 

Besides differences in fees, the liquidity pools are otherwise identical and, importantly, they share the common infrastructure of the Ethereum blockchain.  Importantly,  all participants pay a transaction cost (called a ``gas fee'') to access the markets. Our theory and empirical work investigates the effect of different proportional fees and fixed fees on liquidity supply. At launch, Uniswap Labs conjectured that trading and liquidity should consolidate in equilibrium on a single ``canonical'' pool for which the liquidity fee is just enough to compensate the marginal market maker for adverse selection and inventory costs. That is, activity in low-volatility pairs such as stablecoin-to-stablecoin trades should naturally gravitate to low fee liquidity pools, whereas speculative trading in more volatile pairs will consolidate on high fee markets.\footnote{See \emph{Flexible fees} paragraph at \url{https://uniswap.org/blog/uniswap-v3}; accessed September 14, 2022.} As we show, this reasoning is flawed. 

We present a simple model with trade between liquidity suppliers and two types of liquidity demand. Consistent with the design of v3, liquidity suppliers  chose a market and then place their liquidity into a band around the current value of the asset. The posted liquidity is subject to a bonding curve and hence generates a price impact cost for the liquidity demanders (we emphasize that this does not remunerate the liquidity suppliers).  Liquidity suppliers have heterogeneous endowments, interpretable as different capital constraints --- low-endowment liquidity providers are akin to retail traders, whereas high-endowments stand in for large institutional investors or quantitative funds. Trade occurs against these positions either because a liquidity demander arrives who has experienced a liquidity shock or because the value of the asset has changed and an arbitrageur adversely selects the passive liquidity supply.  Collectively, the decisions of the liquidity demanders determine the payoff to the liquidity suppliers. After large private or common value trades, liquidity providers rebalance their positions; to do so, liquidity providers incur a fixed cost (i.e., gas price) each time they update their position.

Traders demanding liquidity face two types of costs:  first, the fee associated with their chosen pool (low or high) and second, the price impact costs generated by the pool's bonding curve and supplied liquidity. We find that traders route small orders exclusively to the low-fee pool to obtain the all-in lowest cost. In contrast, large traders split their orders across both low- and high-fee liquidity pools. As a result, low-fee markets are actively traded and require frequent liquidity updates whereas high-fee pools have a longer liquidity update cycle since they absorb fewer trades.
%They route their orders to the  all-in lowest cost trading venue.  We find that for small orders, the low-fee pool minimizes transaction costs. The high-fee pool executes the residual order flow from large traders who exhaust cheap liquidity at the low-fee venue. As a result, low-fee markets are actively traded and require frequent liquidity updates whereas high-fee pools have a longer liquidity update cycle since they absorb fewer trades.

We  establish conditions under which there is fragmentation or consolidation.  Specifically, even in this simple framework, there is a robust parameter range in which liquidity does not naturally concentrate on one of the exchanges. 
Both pools can attract a positive market share if liquidity providers face gas fees and the adverse selection costs are sufficiently low. Liquidity providers trade off a higher revenue per unit of time in the low-fee pool (driven by the larger trading volume) against higher adverse selection as well as the additional gas cost required for active liquidity management. As a result, liquidity provider clienteles emerge in equilibrium. Liquidity providers with large endowments gravitate towards low-fee markets, as they are best positioned to frequently update their position. In contrast, smaller market makers choose to passively provide liquidity on high-fee markets where they only trade against large orders being routed there. They optimally trade off a lower execution probability against higher fees per unit of volume, reduced adverse selection, as well as a lower liquidity management cost per unit of time. 

Not only does liquidity fragment, but it differs in both use and type across the two markets. A small number of highly active large liquidity providers, potentially institutional investors and hedge funds, primarily trade against numerous small incoming trades on pools with low fees. In contrast, high-fee pools involve less frequent trading between a substantial number of capital-constrained passive liquidity providers (e.g., retail market makers) on one side and a few sizeable incoming orders on the other. As the fixed gas fee affects liquidity providers pool choice, 
  changes in the common fixed market access fee differentially affects the liquidity supply on the two pools.  Specifically, it reduces market quality (in the sense of lower posted liquidity) on the low fee pool. 

As we distinguish between liquidity demanders who are trading to exploit gains from trade and liquidity demanders who are arbitraging common value changes, we can decompose returns to liquidity providers, and show that adverse selection is higher on the low fee pool.  Given that the low fee pool is populated with larger liquidity suppliers, this suggests that institutional traders bear price risk. 


Our findings indicate that liquidity fragmentation can enhance market quality, as measured by total gains from trade. In a single fee market, a fee that is too low fails to attract liquidity providers with smaller endowments and thus more sensitive to fixed costs, leading to unrealized gains. Conversely, a very high fee results in prohibitively high trading costs and deters trade. A two-pool market with heterogeneous fees offers two instruments to independently manage costs. The higher fee determines the marginal liquidity provider $\LP$ entering the market, and therefore the realized gains from trade. The lower fee pool, by attracting $\LP$ with larger endowments, can reduce transaction costs. We demonstrate that a two-pool fee structure can always be designed to yield higher gains from trade than any single-pool arrangement.


Using the model for guidance, we analyze  more than 28 million interactions with Uniswap v3 liquidity pools -- that is, all liquidity updates and trades from the inception of v3 in May 2021 until July 2023. 
We first document  liquidity fragmentation in 32 out of 242 asset pairs in our sample, 
%AL why only 242 pairs?
which account for 95\% of liquidity committed to Uniswap v3 smart contracts and 93\% of trading volume. For each of the fragmented pairs, trading consolidates on two pools with adjacent fee levels: either 1 and 5 basis points (e.g., USDC-USDT), 5 and 30 basis points (ETH-USDC), or 30 and 100 basis points (USDC-CRV).

We then document that high-fee pools are on average larger -- with aggregate end-of-day liquidity of \$46.50 million relative to \$33.78 million, the average size of low-fee pools. Nevertheless, three quarters of daily trading volume executes on low-fee pools. In line with the model predictions, low-fee pools are more active as they capture many small trades. There are five times as many trades on low- than on high-fee pools (610 versus 110). However, the average trade on the high fee pool is twice as large: \$14,490 relative to \$6,340. Unsurprisingly, liquidity cycles -- measured as the time between the submission and update of posted liquidity -- are 20\% shorter on the highly active low-fee pool. 

We find robust evidence of liquidity supply clienteles across pools. The average liquidity deposit is 107.5\% larger on the low-fee pool, after controlling for daily volume and return volatility. At the same time, high-fee pools' market share is 21 percentage points higher. The results point to an asymmetric match between liquidity supply and demand: large liquidity providers are matched with small liquidity demanders on low-fee pools, whereas small liquidity providers trade with a few large orders on the high-fee pool. 

We then turn to the common fixed cost of accessing the market, or gas fees.  The market shares of the liquidity pools depend on the magnitude of gas costs on the Ethereum blockchain. In the model, a higher gas price leads to a shift in liquidity supply from the low- to the high-fee pool as active position management becomes relatively more costly for the marginal liquidity provider. We find that a one standard deviation increase in gas prices corresponds to a 4.63 percentage points decrease in the low-fee pool market share, and a 29\% drop in liquidity inflows on days when gas costs are elevated. 
% With fewer liquidity providers on the low-fee pool, the time between position updates becomes 4.19\% shorter since incoming order flow depletes liquidity at a faster pace. The effect reinforces the expected gas cost difference between the two pools, and more liquidity providers switch to the high-fee venue.

Consistent with our model, we find that liquidity providers in low-fee pools earn higher fee yields but face increased adverse selection costs. Specifically, the daily fee yield is 2.03 basis points larger on low-fee pools. On the other hand, the permanent price impact as measured by loss-versus-rebalancing \citep[LVR, as in ][]{zhang2023amm} is 6.39 basis points or 81\% greater in low-fee pools compared to high-fee ones. However, despite this difference, the deviations in prices between high- and low-fee pools and those on centralized exchanges do not differ significantly.

% Consistent with our model, the impact of gas prices on liquidity supply is not driven by variation in price impact, as measured by loss-versus-rebalancing \citep[LVR, as in ][]{zhang2023amm} and impermanent loss \citep{Heimbach2023}. While low-fee pools face a greater permanent price impact, differences between high- and low-fee pool deviations from hourly centralized exchange prices are not significant. 

% As a robustness check to our main analysis, we verify that adverse selection costs are not a major driver of the relationship between gas prices and market fragmentation. 
% %Finally, we examine differences in adverse selection costs across high- and low-fee pools. 
% To do so, we use the loss-versus-rebalancing (LVR) price impact measure in \citet{zhang2023amm}, as well as impermanent loss \citep{Heimbach2023}. Our results reveal that low-fee pools face a greater permanent price impact, aligning with the notion that higher liquidity fees dissuade arbitrageurs. However, consistent with our model, the impact of gas prices on liquidity supply is not driven by variation in price impact. Further, arbitrage activity remains efficient: differences between high- and low-fee pool deviations from hourly centralized exchange prices are not significant. 


Our paper is related to various literatures. 
 \citet{pagano1989trading} shows that if an asset is traded on two identical exchanges with equal transaction costs, in equilibrium market participants gravitate to a single exchange due to network effects. In practice, exchanges are rarely identical: fragmentation can emerge between fast and slow exchanges \citep{pagnotta2018competing, brocim:20} or between lit and dark markets \citep{Zhu2014}. In our model, fragmentation on decentralized exchanges is driven by variation in liquidity fees as well as different economies of scale due to heterogeneity in liquidity provider capital. We find that liquidity fragmentation driven by high gas fees implies larger transaction costs on incoming orders. We note that there is no time priority on decentralized exchanges, which clear in a pro rata fashion. On markets with time priority, \citet{FoucaultMenkveld2008} and \citet{Ohara2011market} find that market segmentation in equity markets improves liquidity (by allowing queue jumping) and price discovery.

Fixed costs for order submission are uncommon in traditional markets. However, in 2012, the Canadian regulator IIROC implemented an ``integrated fee model'' that charged traders for all messages sent to Canadian marketplaces. \citet{KorajczykMurphy2018} document that this measure disproportionately affected high-frequency traders, resulting in wider bid-ask spreads but lower implementation shortfall for large traders, possibly due to a reduction in back-running activity. Our study contributes additional insights by highlighting that the introduction of a fixed cost, even when applied across exchanges, can lead to market fragmentation.

We also relate to a rich literature on market fragmentation and differential fees. Closest to our paper, \citet{Battalio2016} and \citet{Cimon2021} study the trade-off between order execution risk and compensation for liquidity provision in the context of make-take fee exchanges. However, \citet{Battalio2016} specifically addresses the issue of the broker-customer agency problem, whereas our study focuses on liquidity providers who trade on their own behalf. In traditional securities markets, make-take fees are contingent on trade execution and proportional to the size of the order.  On the other hand, gas costs on decentralized exchanges are independent of order execution, highlighting the significance of economies of scale (lower proportional costs for larger liquidity provision orders) and dynamic liquidity cycles (managing the frequency of fixed cost payments). Strategic brokers in \citet{Cimon2021} provide liquidity alongside exogenous market-makers in a static setting. We complement this approach by modelling network externalities inherent in the coordination problem of heterogeneous liquidity providers. In our dynamic setup, this allows us to pin down the equilibrium duration of liquidity cycles and the relative importance of gas fixed costs.


%\mz{Should we have the DeFi literature first?} 
Our paper relates to a nascent and fast-growing literature on the economics of decentralized exchanges. Many studies \citep[e.g.,][]{aoyagi2020,aoyagiito2021,park2022} focus on the economics of constant-function automated market makers, which do not allow liquidity providers to set price limits. In this restrictive environment, \citet{CapponiJia2021} argue that market makers have little incentives to update their position upon the arrival of news to avoid adverse selection, since pro-rata clearing gives an advantage to arbitrageurs. \citet{LeharParlour2021} solve for the equilibrium pool size in a setting where liquidity providers fully internalize information costs without rushing to withdraw positions at risk of being sniped. We argue that on exchanges that allow for limit or range orders, the cost of actively managing positions becomes a first-order concern, as liquidity providers need to re-set the price limits once posted liquidity no longer earns fees. Our empirical result on economies of scale echoes the argument in \citet{BarbonRanaldo2021}, who compare transaction costs on centralized and decentralized exchanges and find that high gas prices imply that the latter only become competitive for transactions over US\$100,000. \citet{HasbrouckRiveraSaleh2022} argue that liquidity providers require remuneration.  We complement the argument by stating that high fees might be \emph{necessary} for some liquidity providers to cover the fixed costs of managing their position. In line with our theoretical predictions, \citet{caparros2023blockchain} find that liquidity providers reposition their quotes more often on Uniswap V3 pools built on Polygon, which features substantially lower gas fees. Finally, \citet{Heimbach2023} document that after accounting for price impact, concentrated liquidity on Uniswap v3 pools results in increased returns for sophisticated participants but losses for retail traders. 


Despite higher gas costs, decentralized exchanges may hold advantages over centralized venues. \citet{han2022trust} demonstrate Uniswap frequently leads price discovery compared to centralized exchanges such as Binance, despite the latter having higher trading volume. \citet{capponi2023price} find that the fee paid by traders to establish execution priority unveils their private information, and therefore contributes to price discovery. \citet{ASPRIS2021101845} argue that decentralized exchanges offer better security than their centralized counterparts since assets are never transferred to the custody of a third party such as an exchange wallet. In turn, \citet{BrolleyZoican2022b} make the point that decentralized exchanges may be able to reduce overall computational costs associated with latency arbitrage races, as they eliminate long-term co-location subscriptions.

Our paper is related to both the finance literature that examines whether make-take fees affect market quality and to the economics literature on two-sided markets and platform competition.  Broadly, our work differs from the finance literature in that we explicitly consider equity markets as markets for liquidity without focusing on the order choice decision, and our work differs from the economics literature in that we explicitly analyze an equity market as a market for liquidity.  The main insight that this brings is that market participants are both large and strategic, compared to  smaller players in consumer-facing markets that are often analyzed in the economics literature. 

