
\subsection{Model primitives}

Consider the following model of trade in a single token, \textbf{T}, over three periods $t\in\left\{0,1,2\right\}$.  The expected value of the token, $v>0$, is common knowledge.  Three risk neutral trader types consummate trade in this market: a continuum of liquidity providers ($\LP$s), a continuum of liquidity takers ($\LT$s), and informed arbitrageurs ($\A$s). Trade occurs either because arbitrageurs profit from fundamental value changes (\emph{news}) or because liquidity providers and takers have heterogeneous private values for the asset. In particular, liquidity providers have no private value for the token, while liquidity takers value the token at $v\left(1+{\cal I}\Delta\right)$.  Here  $\Delta>0$ are the gains from trade and ${\cal I}$ is an indicator that takes on the value of $1$ if the taker buys and $-1$ if the taker sells.

Liquidity providers differ in their endowments of the token. At $t=0$, each provider $i$ can supply at most $q_i$  of the token, where $q_i$ follows a truncated Pareto distribution on $\left[1,Q\right]$.  So, 
\begin{equation}\label{eq:density}
    \varphi\left(q\right)=\Big(\frac{Q}{Q-1}\Big) \frac{1}{q^2} \; \; \text{ for } q\in\left[1,Q\right].
\end{equation}

\noindent The right skew of the Pareto distribution captures the idea that there are many  low-endowment liquidity providers such as retail traders, but few high-capital $\LP$s such as sophisticated quantitative funds.   Heterogeneity in $\LP$ size is captured by $Q$, where a larger $Q$ naturally corresponds to a larger dispersion of endowments. Given the endowment distribution, collectively $\LP$s  supply at most
\begin{equation}
   S  =   \int_1^Q q \varphi\left(q\right) \diff q = \frac{Q}{Q-1} \log Q
\end{equation}
tokens. 

At $t=1$, two types of exogenous events can occur. With probability $\eta<1$, the common value of the token changes to $v+\sigma$ (good news) or to $v-\sigma$ (bad news); good and bad news are equally likely. Conversely, with probability $\left(1-\eta\right)$ a liquidity trader ($\LT$) receives a private value shock and needs to trade $\tilde{\theta}$ units of the token, where $\tilde{\theta}\sim\text{Uniform}\left[0,\Theta\right]$. The liquidity trader is equally likely to buy or sell the token. We assume the $\LT$s private value is large enough to cover transaction costs on either liquidity pool.

Liquidity demanders and suppliers can interact in two liquidity pools in which token trade occurs against a num\'{e}raire asset (cash).   We assume that the terms of trade are fixed, so that all trades occur at the expected value of the token, $v$. We do this by assuming prices in both pools satisfy a linear bonding curve, so there is no price impact of trade.\footnote{In practice, most decentralized exchanges use convex bonding curves, for example constant product pricing.} So, for a pool with $T$ tokens and $N$ of the num\'{e}raire good, 
\begin{equation}\label{eq:bond_curve}
    vT + N = \text{constant}.
\end{equation}

Fees are levied on liquidity takers  as a fraction of the value of the trade and distributed pro rata to liquidity providers.  The pools have different fees.  One pool charges a low fee, and one pool charges a high fee which we denote $\ell$ and $h$ respectively.  Specifically, to purchase $\tau$ units of the token on the low fee pool, the total cost to a taker is $\tau\left(v+\ell\right)$. The $\LP$s  in the pool receive $\tau\ell$ in fees. 
 

In addition, consistent with gas costs on Ethereum,  any interaction with a liquidity pool (for example, trading or managing liquidity)  incurs a fixed execution cost $\Gamma>0$. 
It is important to note that 
gas fees on decentralized exchanges differ from trading fees on traditional exchanges.  First, they are not set by individual exchanges to compete with each other, but are a common transaction cost \emph{across} trading venues. Second, they are levied on a per-order rather than per-share basis: this implies economies of scale for larger orders. Third, there is significant time variation in gas fees which will allow us to identify the impact of transaction costs on liquidity pool market shares.\footnote{Empirical properties of gas fees are exhibited in \citet{LeharParlour2021}, while \citet{CapponiJia2021}, consider traders who affect the gas price.} 

To ensure that both small and large liquidity traders participate in the market, we assume that the gains from trade are larger than the aggregate transaction cost, including the pool fee and the gas price. 
To rule out trivial cases, we further assume that $Q\ell-\Gamma>0$. The condition ensures that there are at least some liquidity providers who can earn positive expected profit on the low fee pool.

% \paragraph{Assets.} Consider a three-period economy, where time is indexed by $t\in\left\{0,1,2\right\}$. There are two assets, a risky token $\T$ and a riskless num\'{e}raire $\C$. At $t=2$, the risky token $\T$ pays a stochastic dividend $\tilde{v}$ (denominated in units of $\C$). At the start of the game, the expected token value is $\mathbb{E}_0 \tilde{v}=v>1$. 

% \cp{Why dividend as opposed to terminal value?  Why is one token riskless?  Why isn't this just a relative price?}

% The asset $\C$ stands in for cryptocurrencies typically used as num\'{e}raire on decentralized exchanges -- for example Ether (the native currency of the Ethereum blockchain) or stablecoins such as Tether or USD~Coin. The num\'{e}raire pays a risk-free rate of return $r$, which we normalize to zero without loss of generality.

% \cp{I think the para above can just be nuked.}

% \paragraph{Trading environment.} The risky token is traded on two liquidity pools: $L$ (a low-fee pool) and $H$ (a high-fee pool). \cp{The type of fee has not been defined, i.e., fixed, proportional.} The asset quantities in each pool $k\in\left\{L,K\right\}$ must satisfy at all times the following linear bonding curve:
% \begin{equation}\label{eq:bond_curve}
%     v \T_k + \C_k = \text{constant}.
% \end{equation}
% The bonding curve \eqref{eq:bond_curve} implies that the token price is constant and equal to $v$ units of the num\'{e}raire, since $-\frac{\diff T}{\diff C}=v$.\footnote{In practice, most decentralized exchanges use convex bonding curve, for example constant product pricing. While the choice of bonding curve is of first order importance for liquidity demanders who need to split trades to optimize price impact, we argue it is less important for liquidity suppliers. For tractability, we assume a linear bonding curve which implies that liquidity traders only care about pool fees -- the focus of our model. In a richer model with convex pricing, we would expect to see relatively more fragmentation since minimzing price impact might require further splitting trades.} To fix intuition behind the mechanics of the market, suppose a trader wishes to buy $t$ units of the token. This reduces the token amount in the pool to $\T_k-t$. In return, the trader needs to add $\Delta$ units of the num\'{e}raire, where $\Delta$ is such that the new asset quantities remain on the bonding curve, that is:
% \begin{equation}
%     v \left(\T_k-t\right) + \left(\C_k+\Delta\right) = v \T_k + \C_k,
% \end{equation}
% which is equivalent to having $\Delta = v t$. The slope of the bonding curve is equal to the expected value of the asset to ensure there are no arbitrage opportunities at the start of the game. 

% The two liquidity pools charge different fees on liquidity-removing trades. Fees are expressed in units of num\'{e}raire and are distributed to all liquidity providers in a given pool, proportional to the amount of liquidity provided.  The low-fee pool $L$ charges a fee of $f~\C$ where $f<1$, and the high-fee pool $H$ charges a fee of $1~\C$ per token traded. That is, to purchase $t$ units of the token on the $L$ pool, the total cost of an investor is $t\left(v+f\right)$.

% \cp{I'm not sure that the notation is fabulous. Maybe $\ell$ and $h$. Everything will be in terms of $h-\ell$.} \mz{Agreed. What's really key here is the relation between the fees and the size of news.}

\paragraph{Events.} At $t=1$, two types of exogenous events can occur. With probability $\eta<1$, the common value of the token changes to $v+1$ (good news) or to $v-1$ (bad news); good and bad news are equally likely. With probability $\left(1-\eta\right)$ -- that is if news does not occur -- a liquidity trader ($\LT$) receives a private value shock and needs to trade $\tilde{\theta}$ units of the token, where $\tilde{\theta}\sim\text{Uniform}\left[0,\log^{-1}\left(2\right)\right]$. The liquidity trader is equally likely to buy or sell the token. We assume the $\LT$s private value is large enough to cover transaction costs on either liquidity pool.

\cp{This upper bound is ugly. How far can one go with a generic upper bound....The uniform is already quite specific. Also, up and down by an amount $\delta$?.  Maybe for each parameterization find the private value assumption needed.} \mz{The upper bound was chosen to match the aggregate liquidity provision (in an earlier version I had both the upper bound \& aggregate liquidity normalized to one). If $\theta$ can be higher than that, it weakens competition between $\LP$s: if everyone's liquidity executed for sure, then $\LP$s prefer the high-fee pool. So I set the upper bound such that there's always someone who does not get executed.}

\paragraph{Liquidity providers and arbitrageurs.} In addition to liquidity traders, the token is traded by two types of agents: risk-neutral liquidity providers ($\LP$) and arbitrageurs ($\A$). There is a continuum of liquidity providers indexed by $i$, endowed with heterogeneous amounts of the token $T$. Liquidity provider $i$ is endowed with $q_i$ units of the token. Following \citet{KhomynPutninsZoican2022}, we assume that $q_i$ is distributed with density
\begin{equation}\label{eq:density}
    \phi\left(q\right)=\log^{-1}\left(2\right)\frac{1}{q},\text{ for }q\in\left[1,2\right].
\end{equation}
The choice of density ensures that the aggregate token endowment of liquidity providers $\T_\text{agg}$ is normalized to a constant, since
\begin{equation}\label{eq:aggliq}
    \T_\text{agg}=\int_1^2 q_i \phi\left(q_i\right)\diff q_i = \log^{-1} \left(2\right).
\end{equation}
Further, the density is chosen to match key features of the empirical distribution of $\LP$s: there are many low-endowment liquidity providers (e.g., retail traders) and a long tail of high-capital investors who provide liquidity to decentralized exchange -- for example, quantitative institutional investors. Figure \ref{fig:distribution} illustrates the theoretical distribution of $\LP$s endowments.


\cp{Does something like a pareto distribution work or have their liquidity supply as 1+ RV drawn from an exponential?}
\mz{I am not sure. The point here was to have market shares that are linear in the marginal trader's $\qmg$ -- otherwise we don't get a closed form when solving for the fulfilled expectation equilibrium. To have linear market shares, I need $q_i\phi(q_i)$ to be a constant, which means $\phi(\cdot)$ needs to be proportional to $\frac{1}{q_i}$. The ugly log constant term just ensures the density integrates out to one.

$\int_1^{\qmg} q_i \phi\left(q_i\right)\diff q_i = a + b \qmg $}

% Figure environment removed

The arbitrageurs $\A$ are risk-neutral speculative traders as in \citet{Budish2015TheResponse} or \citet{Menkveld2017NeedLiquidity}, and have zero private value for the token. Upon observing a common value innovation, arbitrageurs can submit a trade against liquidity providers if (i) liquidity is being offered at a stale price and (ii) it is profitable to take liquidity after taking into account gas costs and pool fees.

\cp{Every arbitrageur since the 1980s has been risk neutral and profit maximizing.  I don't think this warrants citations. }

\paragraph{Gas fee (order execution cost).} Orders submitted at $t=1$ to trade against pool liquidity or to withdraw existing liquidity incur a fixed execution cost $\Gamma>0$. The execution cost can be interpreted as the gas price on the Ethereum blockchain as in \citet{CapponiJia2021}. In contrast to \citet{CapponiJia2021}, we assume traders on the decentralized exchanges are price takers on the gas market and their orders do not impact the gas cost. A natural interpretation is that message volume at any time in a particular asset pair traded on decentralized exchanges is small relative to the aggregate transaction flow on the entire blockchain.

Gas fees on decentralized exchanges differ from trading fees on traditional exchanges in a number of ways. First, they are not set by individual exchanges to compete with each other, but are a common transaction cost \emph{across} exchanges. Second, they are levied on a per-order rather than per-share basis: this implies economies of scale for larger orders. Third, there is significant time variation in gas fees which allows us to better empirically identify the impact of transaction costs on liquidity pool market shares.

\paragraph{Timing.} Figure \ref{fig:timing} summarizes the sequence of events at each time $t$. At $t=0$, liquidity providers arrive at the market and choose to deposit their tokens (and corresponding num\'{e}raire) on either the high- or low-fee liquidity pool. At $t=1$, an exogenous trigger event happens: either news, that is a common value innovation, or a private value shock to liquidity traders. With probability $1-\eta$, a liquidity trader arrives and trades a random quantity $\tilde{\theta}$. Conversely, with probability $\eta$, news arrives which moves the asset value to either $v+1$ or $v-1$. In this case, liquidity providers have a first-mover advantage: they can pay the fixed gas fee $\Gamma$ and withdraw liquidity from the pool to avoid being adversely selected. Following the $\LP$s' choice, arbitrageurs may trade in the direction of the news if profitable to do so. Finally, at $t=2$ all payoffs are realized. 

% Figure environment removed

\cp{Useful to have a variable that captures the extent to which LP can withdraw?  Something like an attention variable. After a news event, they can probabilistically withdraw liquidity if optimal. }

\subsection{Equilibrium \label{sec:eq}}

We solve the game by backward induction. First, we discuss the optimal strategy of arbitrageurs and liquidity traders at $t=1$, taking equilibrium liquidity provision as given. Next, we solve for the optimal liquidity pool choices of $\LP$s at $t=0$. 

\subsubsection{Optimal strategies at \texorpdfstring{$t=1$}{t=1}}

The linear pricing curve ensures that the liquidity trader $\LT$ always trades at the fundamental token value $v$, regardless of the trade size. In contrast to markets with convex bonding curves as described in \citet{LeharParlour2021} or \citet{CapponiJia2021}, there is no price impact on the constant price market. In turn, this implies there is no impermanent loss for liquidity providers following a liquidity trader arrival, and also that no subsequent arbitrage trade is needed to restore prices to the fundamental value. However, even in the absence of price impact, the liquidity trader needs to take into account the liquidity fee difference across the two pools. 

Let $T^\star_L$ and $T^\star_H$ be the equilibrium supply of tokens on liquidity pools $L$ and $H$, respectively. To minimize trading cost, the liquidity trader first submits an order on the low-fee pool. If liquidity on pool $L$ is sufficient to accommodate the demand, that is if $\theta\leq T^\star_L$, then the $\LT$ executes its entire order on $L$. Conversely, if $\theta>T^\star_L$, the liquidity trader exhaust the liquidity supply on $L$ and trades the residual quantity $\theta-T^\star_L$ against liquidity on pool $H$. From equation \eqref{eq:aggliq}, the aggregate liquidity supply is $T^\star_L+T^\star_H=\log^{-1}\left(2\right)$. Since $\theta<\log^{-1}\left(2\right)$, the liquidity trader executes her entire order with probability one and incurs a net cost of $f \times T_L^\star + 1 \times T_H^\star$.
\cp{Where is the gas fee?  How does that work here?} \mz{The implicit assumption is that liquidity traders have a very large private value for $\theta$ units of the asset such that they are willing to pay two gas fees if needed.}

If news occurs and $\LP$s do not withdraw liquidity from the pool, arbitrageurs can trade in the direction on the news to obtain a gross profit of $1~\C$ per token traded (i.e., the size of the news). Concretely, upon good news an arbitrageur deposits $q_{\text{arb},k} v$ units of num\'{e}raire into liquidity pool $k$ and removes $q_{\text{arb},k}$ tokens with a value of $q_{\text{arb},k} \left(v+1\right)$. Further, the arbitrageurs pays the pool fee $f_k$ and the gas fee equal to $\Gamma \diff i$. The net profit from trading $q_{\text{arb},k}$ on liquidity pool $k$ is therefore:
\begin{equation}\label{eq:pi_arb}
    \Pi_\A = q_{\text{arb},k}\left(1-f_k\right)-\Gamma \diff i>0.
\end{equation}
Since the arbitrageur can trade against a mass of liquidity providers and pay an infinitesimal gas price,  $\A$ optimally removes the entire liquidity from pool $L$. However, since the fee on pool $H$ is equal to the size of the news, the arbitrageur never consumes liquidity from pool $H$ for any positive gas fee. The mechanism is similar to the one in \citet{FoucaultMoinasTheissen2007}, where the size of news and the tick size are such that arbitrageurs consume only the liquidity at the best bid or ask. 

\cp{This is worth discussing.  a) Would it make sense to have some sort of inventory costs for arbitrageurs?  This would prevent them from draining one pool completely.  b) Also, why is it important to have no adverse selection on the high fee pool? It would be interesting to have lower, but not no AS.}  \mz{No AS on the high-fee pool is more of a normalization than anything else to simplify the exposition and monitoring choices. Under Christine's notation, it boils down to $\ell<\delta<h$. We can also have $\ell<h<\delta$ (AS on both pools), but I'm not sure if it adds much to consider both cases separately. }

% \begin{ass}\label{ass:gamma}
% \begin{leftbar} \setlength{\parskip}{0ex}
% The gas fee is low enough such that it does not prevent arbitrageurs from trading on any opportunities, that is $\Gamma < 1-f$.
% \end{leftbar}
% \end{ass}

% Assumption \ref{ass:gamma} guarantees that the arbitrageur profit as defined in \eqref{eq:pi_arb} is always positive on liquidity pool $L$, as long as the pool is non-empty. That is, arbitrageurs are willing to trade upon news even if only the lowest-endowment $\LP$ with $\tau_i=\log\left(2\right) \times 1 \diff i$ submits liquidity on pool $L$. Further, since the arbitrageur profit increases in the quantity traded, $\A$ optimally removes the entire liquidity from pool $L$. Finally, since the fee on pool $H$ is equal to the size of the news, the arbitrageur never consumes liquidity from pool $H$ for any positive gas fee. The mechanism is similar to the one in \citet{FoucaultMoinasTheissen2007}, where the size of news and the tick size are such that arbitrageurs consume only the liquidity at the best bid or ask. 

When do liquidity providers withdraw their liquidity? On pool $H$, withdrawing is never optimal since the fee is high enough to deter arbitrageurs which implies adverse selection risk is zero. On pool $L$, liquidity providers with endowment $q_i$ compare the adverse selection cost and the gas fee and withdraw liquidity upon news if and only if
\begin{equation}
    q_i \left(1-f\right)>\Gamma.
\end{equation}
Lemma \ref{lem:t1} summarizes the optimal strategies for all agents at $t=1$.

\begin{lem}\label{lem:t1}
\begin{leftbar} \setlength{\parskip}{0ex}
At $t=1$, the optimal strategies are as follows:
\begin{enumerate}
    \item[(i)] a liquidity trader with a private value shock of size $\theta$ trades $\min\left\{T_L^\star,\theta\right\}$ on pool $L$ and $\max\left\{0,T_L^\star-\theta\right\}$ on pool $H$.
    \item[(ii)] upon news arrival, liquidity providers on pool $L$ pay the gas price and withdraw their liquidity if $\Gamma\leq q_i \left(1-f\right)$. In contrast, liquidity providers on pool $H$ do not attempt to withdraw liquidity upon news.
    \item[(iii)] upon news, arbitrageurs buy (sell) on pool $L$ an amount of tokens equal to the size of the pool. The arbitrageurs does not trade on pool $H$.
\end{enumerate}

\end{leftbar}
\end{lem}

\subsubsection{Liquidity provision at \texorpdfstring{$t=0$}{t=0} \label{sec:liqprov}}

We turn next to the liquidity providers' choice of pool at $t=0$. Let $T_L$ and $T_H$ denote the size of liquidity pools $L$ and $H$, expressed in token units. The expected profit of an $\LP$ with endowment $q_i$ posting liquidity on pool $L$ is
\begin{align}\label{eq:lp_L}
    \pi^\LP_L &= q_i \left(1-\eta\right)\mathbb{E}\left[\min\left\{\frac{\theta}{T_L},1\right\}\right] f  - \eta \min\left\{\Gamma, q_i\left(1-f\right)\right\} \nonumber \\
    &=q_i \left[\left(1-\eta\right)\left(1 - \log 2\frac{T_L}{2}\right) f\right] -\eta \min\left\{\Gamma, q_i\left(1-f\right)\right\},
\end{align}
since
\begin{align}
    \mathbb{E}\left[\min\left\{\frac{\theta}{T_L},1\right\}\right] &= \mathbb{P}\left(\theta\leq T_L\right) \times \mathbb{E}\left[\frac{\theta}{T_L} \mid \theta\leq T_L\right] + \mathbb{P}\left(\theta > T_L\right) \times 1 \nonumber \\
    & = T_L \log 2 \times \frac{1}{2} + \left(1-T_L \log 2\right) = 1 - \log 2\frac{T_L}{2},
\end{align}
where the last equality follows from the fact that $\theta$ is uniformly distributed over $\left[0,\log^{-1} 2\right]$. With probability $1-\eta$, a liquidity trader arrives at $t=1$ and trades $\theta$. If $\theta>T_L$, then the liquidity trader consumes the entire pool and the $\LP$ receives the fee $f$ for each unit of liquidity posted. Conversely, if $\theta\leq T_L$, then the liquidity provider receives a share $\frac{q_i}{T_L}$ of the aggregate fees $\theta f$. With probability $\eta$, news occurs: from Lemma \ref{lem:t1}, the liquidity provider either pays the gas fee $\Gamma$ and withdraws $q_i$ from the pool or does nothing and incurs a loss $q_i\left(1-f\right)$ on the subsequent arbitrage trade.

Alternatively, the $\LP$ can deposit liquidity on pool $H$ and earn expected profit
\begin{align}\label{eq:lp_H}
    \pi^\LP_H &= q_i \left(1-\eta\right) \mathbb{E}\left[\max\left\{0,\frac{\theta-T_L}{T_H}\right\}\right] \nonumber \\
    & = q_i \left(1-\eta\right) \left(1-T_L \log 2\right) \frac{1-T_L \log 2}{2 T_H \log 2},
\end{align}
where the second line follows from explicitly computing the expectation
\begin{align}
    \mathbb{E}\left[\max\left\{0,\frac{\theta-T_L}{T_H}\right\}\right] &= \mathbb{P}\left(\theta\leq T_L\right) \times 0 + \mathbb{P}\left(\theta > T_L\right) \times \frac{\frac{\log^{-1} 2+T_L}{2}-T_L}{T_H} \nonumber \\
    & = \left(1-T_L \log 2\right) \frac{1-T_L \log 2}{2 T_H \log 2}.
\end{align}
If the liquidity trader demand is low enough, that is if $\theta\leq T_L$, then the entire trade is filled on pool $L$ and liquidity providers on $H$ earn nothing. However, if $\theta>T_L$, the residual liquidity demand $\theta-T_L$ is routed to pool $H$ and liquidity providers earn a share proportional to their deposit, i.e., $\frac{q_i}{T_H}$. If news occurs, $\LP$s on $H$ do not incur an adverse selection cost since from Lemma \ref{lem:t1} arbitrageurs do not submit orders to the high-fee pool.


Liquidity providers in the low-fee pool absorb a larger share of the uninformed order flow, since the $\LT$ order is first routed to pool $L$. On the other hand, they face adverse selection costs and may need to pay gas fees $\Gamma$ upon the realization of news to withdraw liquidity. At the same, $\LP$s in the high-fee pool face no adverse selection, receive a larger fee per unit traded, but volume is limited as they only fill the residual demand from uninformed $\LT$s after liquidity on the low-fee pool is exhausted. From equations \eqref{eq:lp_L} and \eqref{eq:lp_H}, liquidity provider $i$ chooses the low-fee pool $L$ if and only if
\begin{equation}\label{eq:cost_comparison}
    \pi^\LP_L>\pi^\LP_H \Longleftrightarrow q_i \frac{\left(1-\eta\right)\left(\left(1-T_L \log 2\right)^2-f T_H \log 2 \left(2-T_L\log 2\right)\right)}{2\log2 T_H} - \eta\min\left\{\Gamma,q_i\left(1-f\right)\right\} > 0.
\end{equation}
A salient implication of equation \eqref{eq:cost_comparison} is that $\LP$s with larger endowments are more likely to choose the low-fee pool, keeping liquidity shares constant. The rationale is that gas fees are a fixed cost, and larger $\LP$s are more likely to achieve economies of scale. The expected fee revenue scales linearly with a liquidity provider's share in the liquidity pool (proportional to $q_i$), better compensating $\LP$s for the gas fee paid upon news arrival at $t=1$. 

We follow \citet{KatzShapiro1985} and conjecture that there exists a marginal liquidity provider $\qmg$ such that all $\LP$s with $q_i>\qmg$ post liquidity on the low-fee pool and all $\LP$s with $q_i\leq \qmg$ choose the high-fee pool.\footnote{We note that there cannot be a ``reversed-sign'' equilibrium, where $\LP$s with $q_i\leq\qmg$ post liquidity on the low-fee pool and all $\LP$s with $q_i>\qmg$ choose the high-fee pool. To understand the rationale, we point out that for an $\LP$ with endowment $\tilde{q}<\qmg$, submitting liquidity to pool $L$ yields a lower expected revenue since
\begin{equation*}
    \pi^\LP_L-\pi^\LP_H=\tilde{q} \frac{\left(1-\eta\right)\left(\left(1-T_L\right)^2-f T_H \left(2-T_L\right)\right)}{2T_H} - \eta\min\left\{\Gamma,q_i\left(1-f\right)\right\} < 0.
\end{equation*}
Therefore, it is optimal for the $\LP$ with endowment $\tilde{q}$ to post liquidity on the high-fee pool, which contradicts the conjectured equilibrium.  Importantly, since each $\LP$ is ``small'' relative to the aggregate mass of liquidity providers, individual deviations do not impact aggregate pool sizes $T_L$ and $T_H$.} The conjectured equilibrium pins down the pool sizes $T_L$ and $T_H$ as a function of the endowment for the marginal $\LP$:
\begin{align}\label{eq:liquidity_levels}
    T_L&=\int_{\qmg}^2 q_i \phi\left(q_i\right) \diff i = \log^{-1}\left(2\right) \left(2 - \qmg\right) \text{ and }\nonumber \\
    T_H&=\int_1^{\qmg}  q_i \phi\left(q_i\right) \diff i = \log^{-1}\left(2\right)\left(\qmg -1\right). 
\end{align}
From equations \eqref{eq:cost_comparison} and \eqref{eq:liquidity_levels} it follows that the expected profit difference between the low- and high-fee pools can be written as a linear decreasing function of the marginal $\LP$'s endowment, that is
\begin{equation}\label{eq:pi_diff}
    \pi^\LP_L-\pi^\LP_H = q_i \left[\frac{1}{2} \left(1-\eta\right) \left(1-\left(1-f\right)\qmg\right)\right] - \eta \min\left\{q_i\left(1-f\right),\Gamma\right\}.
\end{equation}
We search for fulfilled expectation equilibria \citep[following the definition of][]{KatzShapiro1985}, where the beliefs of $\LP$s at $t=0$ about the size of liquidity pools are consistent with the outcome of their choices. We solve \eqref{eq:pi_diff} on the support for $q_i$ -- the interval $\left[1,2\right]$ to obtain the $\LP$ reaction function
\begin{equation}\label{eq:reaction_main}
    \tilde{q}\left(\qmg\right)=\begin{cases}
    1, & \text{ for } \qmg \leq \frac{1-\eta\left(1+2\min\left\{\Gamma,1-f\right\}\right)}{\left(1-f\right)\left(1-\eta\right)}\\
    \frac{2\eta\Gamma}{ \left(1-\eta\right) \left(1-\left(1-f\right)\qmg\right)}, & \text{ for } \qmg \in \left(\frac{1-\eta\left(1+2\min\left\{\Gamma,1-f\right\}\right)}{\left(1-f\right)\left(1-\eta\right)}, \frac{1-\eta\left(1+\Gamma\right)}{\left(1-f\right)\left(1-\eta\right)}\right] \\
    2, & \text{ for } \qmg > \frac{1-\eta\left(1+\Gamma\right)}{\left(1-f\right)\left(1-\eta\right)}.
    \end{cases}
\end{equation}
In any fulfilled expectation equilibrium, the equilibrium endowment of the marginal $\LP$ is a fixed point of equation \eqref{eq:reaction_main}. Figure \ref{fig:reaction} plots the $\LP$ reaction function $\tilde{q}\left(\cdot\right)$ to graphically illustrate equilibrium formation for two parameter choices. Let $q^\star_1$ and $q^\star_2$ be the interior roots of the reaction function \eqref{eq:reaction_main}, that is the solutions of the quadratic form
\begin{equation}
    q-\frac{2\eta\Gamma}{ \left(1-\eta\right) \left(1-\left(1-f\right)q\right)}=0.
\end{equation}
In the top left panel, we illustrate a parameter combination for which are three equilibria, at $\qmg\in\left\{q^\star_1, q^\star_2, 2\right\}$. However, $q^\star_2$ is an unstable equilibrium -- a tipping point \citep[as in][]{Jullien2011} at which small perturbation in beliefs cause the $\LP$s to spiral away from the postulated equilibrium (we refer the reader to the proof of Proposition \ref{prop:equilibria} for a more formal discussion). Consequently, the stable interior equilibrium co-exists with an equilibrium in which all $\LP$s choose pool $H$; this is the case for $f\leq\frac{2}{3}$. The top right panel illustrates a parameter combination for which the stable interior equilibrium coexists with an equilibrium where all $\LP$s provide liquidity on the low-fee pool (for $f>\frac{2\eta}{1+\eta}$).  Finally, the bottom panel illustrates a parameter combination for which there is a unique and stable interior equilibrium at $\qmg=q^\star_1$. 

% Figure environment removed


Proposition \ref{prop:equilibria} establishes conditions under which a fragmented equilibrium exists, wherein both liquidity pools have positive market share. 

\begin{prop}\label{prop:equilibria}
\begin{leftbar} \setlength{\parskip}{0ex}
A stable fragmented equilibrium, in which both liquidity pools have positive market share, exists for $\Gamma\in\left[\underline{\Gamma},\bar{\Gamma}\right)$, where
\begin{align}
    \underline{\Gamma}&=\max\left\{f\frac{1-\eta}{2\eta},\frac{1+\eta(2f-3)}{1-\eta}\right\} \text{ and }     \bar{\Gamma}=\begin{cases} \frac{1-\eta}{8\eta(1-f)} & f \leq 0.75 \\
                           \frac{(2f-1)(1-\eta)}{\eta} & f>0.75 \end{cases}.
\end{align}
The fragmented equilibrium is further unique if $f\in\left[\frac{2}{3},\frac{2\eta}{1+\eta}\right)$ and $\Gamma\in\left[f\frac{1-\eta}{2\eta},\frac{(2f-1)(1-\eta)}{\eta}\right)$. 
In any fragmented equilibrium, the token endowment of the marginal liquidity provider is 
\begin{equation}
    \qmg^\star=\frac{1}{2\left(1-f\right)}-\frac{1}{2\left(1-f\right)}\sqrt{1-\eta\frac{1+8\left(1-f\right)\Gamma}{1-\eta}},
\end{equation}
such that all liquidity providers with $q_i\leq \qmg^\star$ post liquidity on pool $H$, and all liquidity providers with $q_i> \qmg^\star$ post liquidity on pool $L$.
\end{leftbar}    
\end{prop}

Figure \ref{fig:region_gamma} highlights the parameter region where multiple liquidity pools coexist in equilibrium with positive market share.\footnote{We note that the interior equilibrium is not necessarily the unique one. For low fees on pool $L$ ($f\leq\frac{2}{3}$), the interior equilibrium coexists with a corner equilibrium where all traders choose platform $H$. Conversely, for $f>\frac{2\eta}{1+\eta}$, the interior equilibrium coexists with an equilibrium where all traders choose platform $L$.} In particular, an interior equilibrium for which both the $L$ and $H$ pool attract a positive market share emerges for moderate gas fee $\Gamma$ and a small enough difference between liquidity fees on the two pools (i.e., a large $f$). For low values of the gas fee ($\Gamma\leq\underline{\Gamma}$), managing liquidity is cheap: competition effects are strong and all $\LP$s post liquidity on the low-fee pool. For high values of the gas fee ($\Gamma>\bar{\Gamma}$), withdrawing liquidity upon the realization of news is prohibitively expensive and $\LP$s cluster on the high-fee pool where they are protected from adverse selection. For very large gas fees $\Gamma>2\left(1-f\right)$, no $\LP$ optimally reacts upon news -- in this case, multiple single-pool equilibria may emerge where liquidity either clusters on pool $L$ or on pool $H$. 

\begin{cor}\label{cor:monitoring}
\begin{leftbar} \setlength{\parskip}{0ex}
In any interior equilibrium, \emph{all} liquidity providers on $L$ withdraw liquidity upon news.
\end{leftbar}  
\end{cor}

Corollary \ref{cor:monitoring} establishes that there are no $\LP$s in a fragmented equilibrium that do not actively manage liquidity. All low-endowment $\LP$s for whom reacting upon news is not profitable provide liquidity on platform $H$. In contrast, on single-pool equilibria and for $\Gamma>1-f$, only a fraction of liquidity providers withdraw liquidity upon news. Empirically, we would expect a higher share of $\LP$s actively managing liquidity on pool $L$ when multiple pools co-exist in equilibrium than when all trading concentrates on pool $L$.

% Figure environment removed





% \begin{prop}\label{prop:equilibria}
% \begin{leftbar} \setlength{\parskip}{0ex}
% For ease of notation, we define and tabulate below three gas fee thresholds $\bar{\Gamma}_k$, $k\in\left\{1,2,3\right\}$.

% \begin{center}
%     \begin{tabular}{ccc}
%     \toprule
%     $\bar{\Gamma}_1$ & $\bar{\Gamma}_2$ & $\bar{\Gamma}_3$ \\
%     \cmidrule{1-3}
%     $f\frac{1-\eta}{2\eta}$     &  $\frac{\left(2f-1\right)\left(1-\eta\right)}{\eta}$ & $\frac{1-\eta}{8\left(1-f\right)\eta}$\\
%     \bottomrule
%     \end{tabular}
% \end{center}

% It follows there are has either one, two, or three stable fulfilled expectation equilibria at $t=0$, corresponding to the following $\LP$ liquidity pool choices:
% \begin{enumerate}
%     \item[(i)] An interior equilibrium with marginal $\LP$ characterized by endowment $\qmg^\star=q^\star_1$, such that all $\LP$s with endowment $q>q^\star_1$ add liquidity to the low-fee pool and the rest choose the high-fee pool. The equilibrium emerges for $f\in\left[\frac{1}{2},\frac{3}{4}\right)$ and $\Gamma\in\left(\bar{\Gamma}_1, \bar{\Gamma}_3\right]$ and $f>\frac{3}{4}$ and $\Gamma\in\left(\bar{\Gamma}_1, \bar{\Gamma}_2\right]$. Moreover, the interior equilibrium is unique for $f>\frac{2}{3}$ and $\Gamma\in\left(\bar{\Gamma}_1, \bar{\Gamma}_2\right]$.
%     \item[(ii)] A corner equilibrium where $\qmg^\star=1$, such that all $\LP$s post liquidity on the low-fee pool. The equilibrium emerges for $\Gamma\leq\bar{\Gamma}_1$ and is further unique if $f>\frac{1}{2}$ and $\Gamma\leq\min\left\{\bar{\Gamma}_1,\bar{\Gamma}_2\right\}$.
%     \item[(iii)] A corner equilibrium where $\qmg^\star=2$, such that all $\LP$s post liquidity on the high-fee pool. The equilibrium emerges for $\Gamma>\bar{\Gamma}_2$ and is further unique if $f>\frac{3}{4}$ and $\Gamma>\bar{\Gamma}_2$, $f>\frac{1}{2}$ and $\Gamma>\bar{\Gamma}_3$, or $f\leq\frac{1}{2}$ and $\Gamma>\bar{\Gamma}_1$.
% \end{enumerate}

% \end{leftbar}
% \end{prop}

% Proposition \ref{prop:equilibria} establishes existence conditions for each possible equilibrium. In particular, an interior equilibrium for which both the $L$ and $H$ pool attract a positive market share emerges for moderate gas fee $\Gamma$ and a small enough difference between liquidity fees on the two pools (i.e., a large $f$). The interior equilibrium is unique if the liquidity fees are close enough across the two pools. Figure \ref{fig:regions} highlights the parameter region where multiple liquidity pools coexist with positive market share. 

% The remaining results in Proposition \ref{prop:equilibria} are intuitive: a small gas fee $\Gamma$ reduces the $\LP$s' costs to manage stale liquidity upon news and stimulates competition on the low-fee pool. In other words, the cost of updating liquidity is lower than the opportunity cost of not capturing uninformed trades. In contrast, a large enough $\Gamma$ incentivizes liquidity providers to deposit tokens on the high-fee pool, since managing liquidity on pool $L$ is too costly. 

% % Figure environment removed

\subsection{Implications and empirical predictions}

In this section, we zoom in on the properties of the interior equilibrium, that is, the most interesting case featuring segmented liquidity across multiple pools. From Proposition \ref{prop:equilibria}, the only possible interior equilibrium in the liquidity provision game is for a marginal $\LP$ with endowment $\qmg=q_1^\star$.

\begin{pred}\label{pred:clienteles}
\emph{If an interior equilibrium exists where liquidity is segmented across multiple pools, the average liquidity deposit in the low-fee pool is larger than for the high-fee pool.}
\end{pred}

Prediction \ref{pred:clienteles} follows from the discussion in Section \ref{sec:liqprov}. Liquidity providers with large token endowments ($q_i>\qmg$) deposit them in the low-fee pool since they have stronger incentives to pay the gas fee and actively manage the liquidity. Conversely, $\LP$s with lower endowments ($q_i\leq\qmg$) gravitate towards the high-fee pool, accepting a lower trade probability in exchange for reducing adverse selection costs without active liquidity management and paying gas fees.

\begin{pred}\label{pred:updates}
\emph{Liquidity providers on the low-fee pool are more likely to actively manage liquidity.}
\end{pred}
\begin{pred}\label{pred:monitoring_shares}
\emph{Liquidity providers on the low-fee pool are more likely to actively manage liquidity in a fragmented market than in a consolidated market.}
\end{pred}

The two predictions follow from Corollary \ref{cor:monitoring}. In equilibrium, the $\LP$s on the low-fee pool update their liquidity upon news arrival to avoid adverse selection, unlike their counterparts on the high-fee pool. 


\begin{pred}\label{pred:comp_stat_Gamma}
\emph{The liquidity share of the low-fee pool $L$ decreases in the gas fee $\Gamma$.}
\end{pred}
\begin{pred}\label{pred:comp_stat_eta}
\emph{The liquidity share of the low-fee pool $L$ decreases in the probability of informed trading $\eta$.}
\end{pred}

Predictions \ref{pred:comp_stat_Gamma} and \ref{pred:comp_stat_eta} state that the low-fee pool becomes less attractive for liquidity providers if the gas fee increases (higher $\Gamma$) -- making active liquidity management less profitable -- or if the probability of informed trading is higher ($\eta$ increases) which leads to \emph{more frequent} liquidity management. Formally, we can show that $q_1^\star$ increases in both $\Gamma$ and $\eta$ -- leading to a lower value of $T_L^\star$:
\begin{align}
    \frac{\partial q_1^\star}{\partial \Gamma}&=\frac{2 \eta }{\sqrt{(1-\eta ) (\eta  (8 \Gamma  (f-1)-1)+1)}}>0 \text{ and } \nonumber \\
    \frac{\partial q_1^\star}{\partial \eta}&=\frac{2 \Gamma }{(1-\eta) \sqrt{(1-\eta ) (\eta  (8 \Gamma  (f-1)-1)+1)}}.
\end{align}

\begin{pred}\label{pred:trade_volume}
\emph{If an interior equilibrium exists, the trading volume share of the low-fee pool is higher than its liquidity share.}
\end{pred}
The intuition is that $\LP$s on the low-fee pool deposit large token quantities and they absorb a disproportionate amount of incoming trades -- it is possible that $\LP$s on the high-fee pool do not trade at all against incoming orders, despite providing positive liquidity in equilibrium. To formally see the result, we first note that there is no informed trade in equilibrium on either pool. The average $\LT$ trade size on the low-fee pool is
\begin{align}
    \mathbb{E}\left[\min\left\{\theta,T_L^\star\right\}\right]&=\mathbb{P}\left(\theta\leq T_L\right) \mathbb{E}\left[\theta\mid \theta<T_L^\star\right] + \left(1-\mathbb{P}\left(\theta\leq T_L\right)\right) T_L^\star \nonumber \\
    &= T_L^\star\log 2\frac{T_L^\star}{2} + \left(1-T_L^\star\log 2\right) T_L^\star= T_L^\star-\frac{\left(T_L^\star\right)^2}{2}\log 2.
\end{align}
The average $\LT$ trade size on the high-fee pool is
\begin{align}
    \mathbb{E}\left[\max\left\{0,\theta-T_L^\star\right\}\right]& = \left(1-\mathbb{P}\left(\theta\leq T_L\right)\right) \left(\mathbb{E}\left[\theta\mid \theta>T_L^\star\right]-T_L^\star\right)\nonumber \\
    &= \left(1-T_L^\star\log 2\right) \frac{\left(\log^{-1} 2-T_L^\star\right)}{2}=\frac{\log^{-1} 2}{2}-T_L^\star+\frac{\left(T_L^\star\right)^2}{2}\log 2.
\end{align}
We note that the trade share of pool $L$ is equal to $2T_L^\star\log 2-\left(T_L^\star\log 2\right)^2$ which is larger than its liquidity share $T_L^\star\log 2$ since $T_L^\star\log 2<1$. Figure \ref{fig:liqshares} illustrates this result.




% Figure environment removed


\begin{pred}\label{pred:liq_shares}
\emph{The low-fee pool is larger than the high-fee pool (in terms of aggregate deposits) only if the gas fee is low enough, that is if}
\begin{equation}
    \Gamma < \Gamma^\star \equiv \frac{3 (3 f-1) (1-\eta)}{8 \eta }
\end{equation}
\end{pred}

From equation \eqref{eq:liquidity_levels}, if the marginal $\LP$ has endowment $q_1^\star$, then the equilibrium sizes of the two liquidity pools are, respectively,
\begin{align}
    T_L^\star&=\log^{-1}\left(2\right)\left[2- \frac{1}{2\left(1-f\right)} \left(1- \sqrt{1-\eta\frac{1+8\left(1-f\right)\Gamma}{1-\eta}}\right)\right] \text{ and } \nonumber \\
    T_H^\star&=\log^{-1}\left(2\right)\left[\frac{1}{2\left(1-f\right)} \left(1- \sqrt{1-\eta\frac{1+8\left(1-f\right)\Gamma}{1-\eta}}\right)-1\right].
\end{align}


Prediction \ref{pred:liq_shares} translates to stating that $T_L^\star>T_H^\star$, or equivalently to $q_1^\star\leq \frac{3}{2}$, where the latter inequality is true for any $\Gamma\leq\Gamma^\star$. Therefore, even though the low-fee pool attracts the $\LP$s with large token endowments, it is not necessarily the largest pool if the gas fee exceeds a certain threshold. 


