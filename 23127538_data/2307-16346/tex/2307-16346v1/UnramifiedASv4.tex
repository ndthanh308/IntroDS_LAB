\documentclass[12pt,reqno]{amsart}
\usepackage{amssymb,amscd,amsmath}
\usepackage[alphabetic]{amsrefs}
\usepackage[all]{xy}
\usepackage[headings]{fullpage}
\usepackage[T1]{fontenc}
\usepackage{libertine}
\usepackage{stackengine}
\usepackage{mathtools}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{colortbl}
\usepackage{pdfsync}
\usepackage{tikz}


\include{formatting}
\include{macros}
\numberwithin{equation}{section}


\newcommand{\D}{\mathbb{D}}
\newcommand{\Dk}{\mathbb{D}_k}
\newcommand{\et}{{\acute et}}
%\newcommand{\Zps}{\underline{\smash{\Z/p\Z}}}
\newcommand{\Zps}{\Z/p\Z}
\renewcommand{\and}{\quad\text{and}\quad}
\newcommand{\Hy}{\mathbb{H}}
\renewcommand{\t}{{}^t}


\DeclareMathOperator{\Sup}{Supp}
\DeclareMathOperator{\Gal}{Gal}


\begin{document}
\title{$\MakeLowercase{p}$-torsion for unramified
  %$\Z/p\Z$
  Artin--Schreier covers of curves}

\author{Bryden Cais}
\address{Department of Mathematics \\ University of Arizona
 \\ Tucson, AZ~~85721 USA}
\email{cais@math.arizona.edu}

\author{Douglas Ulmer}
\address{Department of Mathematics \\ University of Arizona
 \\ Tucson, AZ~~85721 USA}
\email{ulmer@math.arizona.edu}

%\date{\today}

% this is really the 2020 classification, but \subjclass is broken and
% lists 1991 when given option 2020 or no option
\subjclass[2010]{Primary 11G20, 14F40, 14H40;
Secondary 11G10, 14G17, 14K15}

% descriptions:
% 11G20 (1980-now) Curves over finite and local fields
% 14F40 (1980-now) de Rham cohomology and algebraic geometry
% 14H40 (1973-now) Jacobians, Prym varieties

% 11G10 (1980-now) Abelian varieties of dimension >1
% 14G17 (2010-now) Positive characteristic ground fields in algebraic geometry
% 14H30 (1973-now) Coverings of curves, fundamental group


\keywords{Curve, finite field, unramified cover, Jacobian,
  $p$-torsion, group scheme, de Rham cohomology, Dieudonn\'e module,
  Frobenius, Verschiebung, Ekedahl--Oort type}

\begin{abstract}
  Let $Y\to X$ be an unramified Galois cover of curves over a perfect
  field $k$ of characteristic $p>0$ with $\Gal(Y/X)\cong\Z/p\Z$, and
  let $J_X$ and $J_Y$ be the Jacobians of $X$ and $Y$ respectively.
  We consider the $p$-torsion subgroup schemes $J_X[p]$ and
  $J_Y[p]$.  The three main themes are: the Galois-module structure
  of $J_Y[p]$; restrictions this structure imposes on $J_Y[p]$ (for
  example, as manifested in its Ekedahl--Oort type) taking $J_X[p]$
  as given; and methods for explicitly computing the group schemes
  $J_X[p]$ and $J_Y[p]$.
\end{abstract}


\maketitle

\section{Introduction}
Let $k$ be a perfect field of characteristic $p>0$ with algebraic
closure $\kbar$, and let $X$ be a smooth, proper, geometrically
irreducible curve of genus $g_X$ over $k$.  Let $\pi:Y\to X$ be an
unramified Galois covering with $G:=\gal(Y/X)\cong\Z/p\Z$ and with
% $H^0(Y,\OO_Y)=k$.
$Y$ geometrically irreducible.  Writing $g_Y$ for the genus of $Y$,
the Riemann-Hurwitz formula for $\pi$ says $2g_Y-2=p(2g_X-2)$.

Let $J_X$ and $J_Y$ be the Jacobians of $X$ and $Y$, and let $J_X[p]$
and $J_Y[p]$ be their $p$-torsion subgroup schemes.  These are
self-dual $BT_1$ group schemes of orders $p^{2g_X}$ and $p^{2g_Y}$
respectively.  (See Section~\ref{s:Dieu} for the definitions of
``self-dual'' and ``$BT_1$''.)  Our goal is to
describe relations between $J_Y[p]$ and $J_X[p]$.  The three main
themes are (i) the $G$-module structure of $J_Y[p]$; (ii) restrictions
this structure imposes on $J_Y[p]$ (for example, as manifested in its
Ekedahl--Oort type) taking $J_X[p]$ as given; and (iii) methods for
explicitly computing the group schemes $J_X[p]$ and $J_Y[p]$.

Recall that a $p$-torsion group scheme $G$ over $k$ has a canonical
decomposition
\[\GG\cong \GG_{\et}\oplus \GG_{m}\oplus \GG_{ll}\]
into \'etale, multiplicative, and local-local parts.  (See
Section~\ref{s:Dieu} below.)  Let $f_X$ and $f_Y$ be the $p$-ranks of
$X$ and $Y$ respectively (i.e., the dimensions over $\Fp$ of
$J_X[p]_{\et}(\kbar)$ and $J_Y[p]_{\et}(\kbar)$).  The
Deuring--Shafarevich formula in this context says that
$f_Y-1=p(f_X-1)$.  There is a well-known refinement of this taking
into account the $G$ action.  Indeed, let $\Fp[G]$ be the group ring
of $G$ over $\Fp$.  If $k$ is algebraically closed, then we have
isomorphisms of group schemes with $G$ action:
  \begin{align}
  J_Y[p]_{\et}&\cong \Z/p\Z\oplus
                \left((\Z/p\Z)^{f_X-1}\tensor_{\Fp}\Fp[G]\right)\label{eq:DSet}\\
                  \noalign{and}
  J_Y[p]_{m}&\cong\mu_p\oplus
                 \left((\mu_p)^{f_X-1}\tensor_{\Fp}\Fp[G]\right)\label{eq:DSm}
  \end{align}                  
  where $G$ acts trivially on the factors $\Z/p\Z$ and $\mu_p$.  (This
  follows from \cite[Theorem~2]{Nakajima85} or
  \cite[Theorem~1.5]{Crew84} and Cartier duality.  It may also be
  obtained from the Hochschild-Serre spectral sequences for $\pi$ with
  coefficients in $\Z/p\Z$ and $\mu_p$.)

\subsection*{Filtrations from the $G$ action and their associated
  gradeds}
Our first aim in this paper is to study all of $J_Y[p]$ (i.e., the
local-local part as well as the \'etale and multiplicative parts) and
to allow $k$ to be a general perfect field of characteristic $p$
(giving ``structural'' results analogous to \eqref{eq:DSet} and
\eqref{eq:DSm} for general $k$).  To state the result, we first define
a certain subquotient $\GG_X$ of $J_X[p]$.


  \begin{def-prop}\label{def:GG_X}
    The covering $\pi:Y\to X$ and the isomorphism
    $\gal(Y/X)\cong\Z/p\Z$ give rise to canonical homomorphisms of
    groups schemes $J_X[p]\onto\Z/p\Z$ and $\mu_P\into J_X[p]$.
    Define a \textup{(}self dual $BT_1$\textup{)} group scheme $\GG_X$
    by the exact sequences
  \begin{equation}\label{eq:GG_X,et}
0\to\GG_{X,\et}\to J_X[p]_{\et}\to\Z/p\Z\to0,    
  \end{equation}
  \begin{equation}\label{eq:GG_X,m} 
0\to\mu_p \to J_X[p]_m\to \GG_{X,m}\to0,    
  \end{equation}
and the isomorphism
\[\GG_{X,ll}\cong J_X[p]_{ll}.\]
  \end{def-prop}

  \begin{rems}\mbox{}
    \begin{enumerate}
    \item The proof of the existence of the asserted homomorphisms
      will be given in Section~\ref{s:H1dR}.
    \item The definition amounts to a 3-step filtration on $J_X[p]$
      with subquotients $\Z/p\Z$, $\GG_X$, and $\mu_p$.  See
      Remark~\ref{rem:dualities} for details.
    \end{enumerate}
    \end{rems}

  Let $\gamma\in G=\gal(Y/X)$ be the element corresponding to
  $1\in\Z/p\Z$ under the fixed isomorphism $G\cong\Z/p\Z$ and let
  $\delta$ be the element $1-\gamma$ in the group ring $k[G]$.  Then
  $k[G]\cong k[\delta]/(\delta^p)$.  Thus $\delta$ induces a nilpotent
  endomorphism of $J_Y[p]$, and the kernels and images of powers of
  $\delta$ on $J_Y[p]$ give two (generally distinct) $p$-step
  filtrations by self-dual $BT_1$ group schemes.
  %(The definitions of ``self-dual'' and ``$BT_1$'' group schemes will be given in
  % Section~\ref{s:Dieu}.)
  The following result describes the %minimal subquotients
  associated graded objects of these two filtrations.  (We use the standard
  notations $\GG[\delta]$ and $\GG/\delta$ to denote kernels and
  cokernels respectively.)


\begin{thm}\label{thm:G-str-genl-k}\mbox{}
 % Write $\GG_{Y}$ for $J_Y[p]$.
  \begin{enumerate}
  \item   There are canonical isomorphisms
    \[ \frac{\delta^{i}J_Y[p]_{\et}}{\delta^{i+1}J_Y[p]_{\et}}\cong
      \frac{J_Y[p]_{\et}[\delta^{p+1-i}]}{J_Y[p]_{\et}[\delta^{p-i}]}
      \cong \GG_{X,\et}
      \quad\text{for $i=1,\dots,p-1$},\]
 as well as exact sequences
    \begin{equation}\label{eq:GG_Y,et,ker} 
    0\to\GG_{X,\et}\to J_Y[p]_{\et}[\delta]\to\Z/p\Z\to0
  \end{equation}
  and
      \begin{equation}\label{eq:GG_Y,et,coker}
    0\to\Z/p\Z\to J_Y[p]_{\et}/\delta\to\GG_{X,\et}\to0.
  \end{equation}
Pull back by $\pi$ induces  a canonical isomorphism
$J_X[p]_\et\cong J_Y[p]_{\et}[\delta]$ which identifies the exact
sequences \eqref{eq:GG_Y,et,ker} and \eqref{eq:GG_X,et}. 
  \item   There are canonical isomorphisms
    \[  \frac{\delta^{i}J_Y[p]_{m}}{\delta^{i+1}J_Y[p]_{m}}\cong
      \frac{J_Y[p]_{m}[\delta^{p+1-i}]}{J_Y[p]_{m}[\delta^{p-i}]}
       \cong \GG_{X,m}
      \quad\text{for $i=1,\dots,p-1$},\]
     as well as exact sequences
    \begin{equation}\label{eq:GG_Y,m,coker}
    0\to\mu_p\to J_Y[p]_{m}/\delta\to\GG_{X,m}\to0
  \end{equation}
  and
      \begin{equation}\label{eq:GG_Y,m,ker}
    0\to\GG_{X,m}\to J_Y[p]_{m}[\delta]\to\mu_p\to0.
  \end{equation}
  Push forward by $\pi$ induces a canonical isomorphism
  $J_Y[p]_{m}/\delta\cong J_X[p]_m$ which identifies the exact
  sequences \eqref{eq:GG_Y,m,coker} and \eqref{eq:GG_X,m}. 
\item We have equalities
  \[\delta^{i}J_Y[p]_{ll}=J_Y[p]_{ll}[\delta^{p-i}]\]
  for $i=0,\dots,p$, as well as canonical isomorphisms
  \[\frac{\delta^{i}J_Y[p]_{ll}}{\delta^{i+1}J_Y[p]_{ll}}\cong
    \frac{J_Y[p]_{ll}[\delta^{p-i}]}{J_Y[p]_{ll}[\delta^{p-i-1}]}
\cong    J_X[p]_{ll}
        \quad\text{for $i=0,\dots,p-1$.}\]
\end{enumerate}
\end{thm}

As we will see in Section~\ref{s:H1dR}, the asymmetry between the
kernels and cokernels of $\delta$ (i.e., \eqref{eq:GG_Y,et,ker} vs
\eqref{eq:GG_Y,et,coker} and \eqref{eq:GG_Y,m,coker} vs
\eqref{eq:GG_Y,m,ker}) is significant.  Indeed, although
$J_Y[p]_{\et}[\delta]$ and $J_Y[p]_{\et}/\delta$ have the same order
and are closely related, they are not in general isomorphic.
Similarly for $J_Y[p]_{m}[\delta]$ and $J_Y[p]_{m}/\delta$.
Readers are referred to Figures~\ref{fig:1} and \ref{fig:2} in
Section~\ref{s:H1dR} for pictorial versions of
Theorems~\ref{thm:G-str-genl-k} and \ref{thm:k-point} in terms of
Dieudonn\'e modules.  Among other things, the figures show how the two
filtrations (by images and kernels of $\delta$) interact.

%See \ref{???}  for more details and
%commentary.

When $k=\kbar$, we may recover the isomorphisms~\eqref{eq:DSet} and
\eqref{eq:DSm} from parts (1) and (2) of the theorem using the fact
that the category of $p$-torsion \'etale (resp. multiplicative) group
schemes over $k$ is semi-simple with unique simple object $\Z/p\Z$
(resp.~$\mu_p$). The situation for the local-local part is much more
complicated even when $k$ is algebraically closed and will be discussed
in more detail below.

We now consider a certain freeness property of $p$-torsion group
schemes with $G$ action.

  \begin{def-lemma}\label{def:free}
    Let $\GG$ be a finite commutative group scheme over $k$ killed by
    $p$ and equipped with an action of $G=\Z/p\Z$, i.e., a group
    scheme equipped with the structure of a module over $\Fp[G]$.  We
    say $\GG$ is \emph{$G$-free} if the following equivalent
    conditions are satisfied:
    \begin{enumerate}
    \item the Dieudonn\'e module $M(\GG)$ is free over the group ring
      $k[G]$
    \item $\GG[\delta]/\delta^{p-1}\GG=0$
    \item $\GG[\delta^{p-1}]/\delta\GG=0$
    \item $\delta^{p-1}$ induces an isomorphism $\GG/\delta\isoto\GG[\delta]$
    \end{enumerate}
  \end{def-lemma}

See Lemma~\ref{lemma:G-free} for the equivalence of the various
conditions in this definition.

\begin{cor}\label{cor:ll-free}
  $J_Y[p]_{ll}$ is $G$-free.
\end{cor}

\begin{proof}
  Conditions (2), (3), and (4) in Definition~\ref{def:free} follow
  immediately from part (3) of Theorem~\ref{thm:G-str-genl-k}.  The
  corollary also follows from Theorem~\ref{thm:k-point} just below.
\end{proof}


There is an elegant, uniform variant of Theorem~\ref{thm:G-str-genl-k}
provided that $X$ has a $k$-rational point.

\begin{thm}\label{thm:k-point}
  Suppose that $X$ has a $k$-rational point $S$, and let
  $T=\pi^{-1}(S)$ viewed as a closed subscheme of $Y$.  Then there is
  a self-dual $BT_1$ group scheme $\HH$ equipped with the structure of
  a module over $\Fp[G]$ with the following properties:
  \begin{enumerate}
  \item $\HH$ is $G$-free in the sense of
    Definition-Lemma~\ref{def:free}.
\item There are equalities $\delta^{i}\HH=\HH[\delta^{p-i}]$ for
  $i=1,\dots,p$, as well as canonical isomorphisms
  \[      \frac{\delta^{i}\HH}{\delta^{i+1}\HH}\cong
    \frac{\HH[\delta^{p-i}]}{\HH[\delta^{p-i-1}]}\cong
    J_X[p]
        \quad\text{for $i=0,\dots,p-1$.}\]
    \item There are canonical exact sequences
      \[0\to J_Y[p]_{\et}\to\HH_{\et}\to \res_{T/S}\Z/p\Z\to\Z/p\Z\to0,\]
      and
      \[0\to \mu_p\to\res_{T/S}\mu_p\to\HH_m\to J_Y[p]_m\to0,\]
        and a canonical isomorphism
        \[\HH_{ll}\cong J_Y[p]_{ll}.\]
    \end{enumerate}
\end{thm}

\begin{rems}\mbox{}\begin{enumerate}
  \item The restriction of scalars $\res_{T/S}$ and the adjunction
    morphisms to and from it will be defined in
    Section~\ref{s:groups}.
  \item The theorem says that a certain extension $\HH$ of $J_Y[p]$ is
    $G$-free with minimal subquotients isomorphic to $J_X[p]$, and we
    recover again that $J_Y[p]_{ll}$ is $G$-free.
  \item The group scheme $\HH$ depends on the choice of $S$ in an
    interesting way, see Section~\ref{ss:S-dependence}.
\item See Remark~\ref{rem:NN} for another version where $S$ is allowed to be any
  effective divisor.
\item See Remark~\ref{rem:more-on-pairings2} for an interpretation of
  the exact sequences in part (3) as a 3-step filtration on $\HH$
  which for $i=1,\dots,p-2$ induces (via the isomorphisms in part (2)) the 3-step
  filtration on $J_X[p]$ implicit in Definition~\ref{def:GG_X}.
\end{enumerate}
\end{rems}

Theorems~\ref{thm:G-str-genl-k} and \ref{thm:k-point} identify the
minimal subquotients of $J_Y[p]$ and $\HH$ as $\Fp[G]$-modules, and
one might hope to ``reassemble'' the group schemes from this
information.  However, the category of $BT_1$ group schemes is not
well behaved with respect to extensions (even when $k$ is
algebraically closed), so even taking $J_X[p]$ as known, the structure
of the repeated extensions $J_Y[p]$ and $\HH$ can be quite intricate.
See Section~\ref{s:comments} for more details.


\smallskip
\subsection*{Analysis of the \'etale part of $J_Y[p]$}
We now consider freeness and related splitting questions for the
\'etale part of $J_Y[p]$.  Similar results hold for the multiplicative
part by Cartier duality, and we leave it to the reader to make them
explicit.

Note that equation~\eqref{eq:DSet} implies that when $k$ is
algebraically closed, $J_Y[p]_\et$ is the direct sum of $\Z/p\Z$ and a
$G$-free group scheme.  The following result gives criteria for
the same structural result to hold over a general $k$.
  
\begin{prop}\label{prop:splitting}\mbox{}
  \begin{enumerate}
    \item The exact sequence \eqref{eq:GG_Y,et,ker} splits if and only
      if there is an exact sequence of $k$-group schemes
      \[0\to\Z/p\Z\to J_Y[p]_\et\to\QQ\to 0\]
      where $\QQ$ is $G$-free.
    \item The exact sequence \eqref{eq:GG_Y,et,coker} splits if and only
      if there is an exact sequence of $k$-group schemes
      \[0\to\KK\to J_Y[p]_\et\to\Z/p\Z\to 0\]
      where $\KK$ is $G$-free.      
    \item The exact sequences \eqref{eq:GG_Y,et,ker} and
       \eqref{eq:GG_Y,et,coker} both split if and only if $J_Y[p]_\et$
       is the direct sum of $\Z/p\Z$ and a $G$-free group scheme.
   \end{enumerate}
\end{prop}

The proof will be given in Section~\ref{s:first-proofs}.  We will see
in Example~\ref{ex:splitting} that \eqref{eq:GG_Y,et,ker} and
\eqref{eq:GG_Y,et,coker} may or may not split, and splitting of one
does not in general imply splitting of the other; similarly for
\eqref{eq:GG_Y,m,coker} and \eqref{eq:GG_Y,m,ker}.

For a commutative $p$-torsion group scheme $\GG$ over $k$, define the
\emph{arithmetic $p$-rank of $\GG$}, denoted $\nu(G)$, by
\[p^{\nu(\GG)}=|\GG(k)|=|\GG_\et(k)|.\] Let $\nu_X=\nu(J_X[p])$ and
$\nu_Y=\nu(J_Y[p])$.

We say that $J_X[p]_\et$ (resp. $J_Y[p]_\et$) is \emph{completely
  split} over $k$ if $\nu_X=f_X$ (resp. $\nu_Y=f_Y$), or equivalently,
if $J_X[p]_\et\cong\left(\Z/p\Z\right)^{f_X}$ (resp. if
$J_Y[p]_\et\cong\left(\Z/p\Z\right)^{f_Y}$ as group schemes ignoring
the $G$ action).  It follows from Theorem~\ref{thm:G-str-genl-k} that
$J_Y[p]_\et$ is completely split over $k$ if and only if we have an
isomorphism of group schemes with $G$ action as in
equation~\eqref{eq:DSet}.

We have the following general results on the
arithmetic $p$-ranks of $X$ and $Y$.

\begin{thm}\label{thm:et-inequalities}
  \mbox{}
  \begin{enumerate}
  \item   We have $\nu_X\le \nu_Y\le p\nu_X$.\label{thm:et-inequalities:part1}
  \item If the exact sequence \eqref{eq:GG_X,et} $($equivalently
    \eqref{eq:GG_Y,et,ker}$)$ splits, then we have the stronger upper
    bound $\nu_Y-1\le p(\nu_X-1)$.\label{thm:et-inequalities:part2}
 \item If $k$ is finite or algebraically closed, then
   $\nu_X\ge1$.\label{thm:et-inequalities:part3} 
% this seems to work better as a separate item due to the k finite
% hypothesis:
  \item If $k$ is finite, \eqref{eq:GG_Y,et,ker} is split, and
    \eqref{eq:GG_Y,et,coker} is non-split, then
    $\nu_X\ge 2$.\label{thm:et-inequalities:part4}
  \end{enumerate}
  \end{thm}

See Example~\ref{ex:nu_X=0} for a discussion of the surprising possibility
that $\nu_X$ might be 0 if $k$ is infinite.

We also have bounds on the degrees of extensions of $k$ over which
certain splitting behaviors occur:

\begin{thm}\label{thm:et-extensions}
  \mbox{}
  \begin{enumerate}
  \item There is a finite Galois extension $k'$ of $k$ of exponent
    dividing $p$ such that the sequences \eqref{eq:GG_X,et} and
    \eqref{eq:GG_Y,et,ker} split over $k'$.  Thus \textup{(}by
    Proposition~\ref{prop:splitting}\,\textup{)}, over $k'$, $J_Y[p]_\et$ is an
    extension of $G$-free group scheme by $\Z/p\Z$.
  \item If $J_X[p]_\et$ is completely split then there is a finite
    Galois extension $k'$ over $k$ with exponent dividing $p$ such
    that $J_Y[p]_\et$ is completely split over $k'$.  
  \end{enumerate}
  \end{thm}

  In particular, if $k$ is finite, the splitting behavior in the Theorem
  happens over extensions $k'/k$ of degree dividing $p$.

  A splitting not discussed in the theorem (going from sequences
  \eqref{eq:GG_X,et} and \eqref{eq:GG_Y,et,ker} being split to
  $J_X[p]_\et$ being completely split) is controlled by
  $\GL_{f_X-1}(\Fp)$, and unfortunately, the exponent of this group
  grows rapidly with $f_X$.  %See \ref{???} for more details.
  
We can give a very complete description of the group scheme
$J_Y[p]_\et$ when $k$ is finite and $f_X\le2$.

\begin{thm}\label{thm:f_X=2}
  \mbox{}
  \begin{enumerate}
    \item[(A)] If $f_X=1$, then $J_Y[p]_\et\cong J_X[p]_\et\cong\Z/p\Z$.
\item[(B)]  Suppose that $k$ is finite and that $f_X=2$.  If $p>2$, then exactly
  one of the following holds:
\begin{enumerate}
\item[(1a)] $\nu_X=\nu_Y=1$.  In this case, there is an isomorphism
  \begin{equation}\label{eq:alpha<>1}
  J_Y[p]_\et\cong \Z/p\Z  \oplus \GG   
  \end{equation}
  where $\GG$ is $G$-free of rank 1 and $\nu(\GG)=0$. There is a
  nontrivial extension $k'$ of $k$ of degree dividing $p-1$ such that
  $|\GG(k')|=p^\mu$ where $1\le \mu\le p$, and there is an extension
  $k''$ of $k$ of degree dividing $p$ such that $\GG\cong(\GG')^p$
  over $k''$ where $\GG'$ has rank 1 and $\nu(\GG')=0$.  Over $k'k''$,
  $J_Y[p]_\et$ is completely split.
\item[(1b)] $\nu_X=1$ and $\nu_Y>1$.  In this case, $\nu_Y<p+1$
  \textup{(}so $J_Y[p]_\et$ is not completely split over
  $k$\textup{)}, and $J_Y[p]_\et$ is completely split over the
  extension of $k$ of degree $p$.
\item[(2)] $\nu_X=2$.  In this case, $2\le\nu_Y\le p+1$ and
  $J_Y[p]_\et$ is completely split over an extension of degree
  dividing $p$.
\end{enumerate}
If $p=2$, then exactly one of the following holds:
\begin{enumerate}
\item[(1)] $\nu_X=1$.  In this case, $1\le\nu_Y<3$ \textup{(}so
  $J_Y[p]_\et$ is not completely split over $k$\textup{)}, and
  $J_Y[p]_\et$ splits completely over an extension of $k$ of degree
  dividing 4.
\item[(2)] $\nu_X=2$.  In this case, $2\le\nu_Y\le3$, there is an exact
  sequence
  \[0\to\Z/p\Z\to J_Y[p]_\et\to\QQ\to0\]
  where $\nu(\QQ)\ge1$, and $J_Y[p]_\et$
  splits completely over an extension of $k$ of degree dividing $p$.
\end{enumerate}

  \end{enumerate}
\end{thm}

See the proof in Section~\ref{s:apps-etale} for  additional information on the
structure of $J_Y[p]_\et$ in each case.

\subsection*{Analysis of the local-local part of $J_Y[p]$}
For the local-local part, it seems hopeless to give a full analysis,
even when $k$ is algebraically closed.  (See Section~\ref{s:comments}
for comments on some of the difficulties.)  Nevertheless, certain
cases can be described rather explicitly.  Recall that the $a$-number
of a finite group scheme $\JJ$ over $k$ is the largest integer $a$
such that there is an injection $\alpha_p^a\into\JJ$.  (When $\JJ$ is
local-local, the $a$-number also has an interpretation as the number
of generators and relations of the Dieudonn\'e module of $\JJ$.)
Write $a_X$ and $a_Y$ for the $a$-numbers of $J_X[p]$ and $J_Y[p]$
respectively.  Booher and Cais \cite[\S6E]{BooherCais20} have observed
that in our context, $a_X\le a_Y\le pa_X$.  We can improve and refine
this in some cases.

\begin{thm}\label{thm:h=1-app}
  Suppose that $p>2$, $k$ is algebraically closed, and $f_X=g_X-1$.
  \textup{(}This implies that $a_X=1$.\textup{)}
 Then $a_Y\in\{2,4,\dots,p-1,p\}$.  Moreover the
local-local part $\LL$ of $J_Y[p]$ has an explicit description in
terms of generators and relations depending only on $a_Y$.
\end{thm}

The precise description in terms of generators and relations is given
using Dieudonn\'e modules in Theorem~\ref{thm:h=1}.  Machine
computation suggests that when $p=2$, we should have $a_Y=2$, but we
are currently not able to prove this.

In certain cases, we can use restrictions on $J_X[p]_{ll}$ to place strong
restrictions on $J_Y[p]_{ll}$.  This is most easily stated in terms of
Ekedahl--Oort structures.  (See \cite{Oort01} or \cite{PriesUlmer21}
for background.)

\begin{thm}\label{thm:J_X-superspecial}
  Suppose that $J_X[p]_{ll}$ is superspecial, i.e.,
  $J_X[p]_{ll}\cong E_{ss}[p]^{h}$ where $h=g_X-f_X$ and $E_{ss}$ is a
  supersingular elliptic curve over $k$.  Then the
  Ekedahl--Oort structure of $J_Y[p]_{ll}$ starts with $h$ zeroes,
  i.e., it has the form $[0,0,\dots,0,\psi_{h+1},\dots,\psi_{ph}]$.
  The Ekedahl--Oort structure of $J_Y[p]$ has the form
  \[
    [[1,2,\dots,f_Y,f_Y,\dots,f_Y,
    f_Y+\psi_{h+1},\dots,f_Y+\psi_{ph}].\]
  \textup{(}In the notation of \cite[7.2]{PriesUlmer21}, this is
  $[\nearrow^{f_Y},\to^{h}\dots]$.\textup{)}
\end{thm}

The theorem reduces the number of possibilities for $J_X[p]_{ll}$ from
$2^{ph}$ to $2^{(p-1)h}$. 

\subsection*{Tools for computing $H^1_{dR}(Y)$ as a Dieudonn\'e
  module} 
Another theme in the paper is to develop tools for explicit
computation of $J_Y[p]$ which are suitable for machine implementation.
It turns out (see Section~\ref{s:geometry}) that the cover
$\pi:Y\to X$ is determined by a class in $H^1(X,\OO_X)$ plus a small
amount of additional data, and this presentation can be used (see
Section~\ref{s:calcs}) to give efficient algorithms for computing
$H^1_{dR}(Y)$ as a $\D[G]$-module.  The new observation is that we may
compute $H^1_{dR}(Y)$ (with its $\D_k[G]$-module structure) purely in
terms of Riemann-Roch spaces (of bounded dimension) \emph{on the base
  curve $X$}.  See Proposition~\ref{prop:HWT} for a precise
statement.  %In Section~\ref{s:examples},
Throughout the paper, we report on numerous examples and counterexamples
computed in {\sc Magma}, using code built upon \cite{Weir}.
%In the rest of the paper, we report on many examples and
%counterexamples obtained using these methods.


% \bigskip
\subsection*{Outline of the paper}
We now describe the main outlines of the paper.  By a theorem of Oda,
the Dieudonn\'e module of $J_Y[p]$ is isomorphic to the de Rham
cohomology $H^1_{dR}(Y)$, so we are lead to study the action of $G$ on
this and related cohomology groups.  After discussing preliminaries on
Dieudonn\'e modules and $k[G]$-modules in Sections~\ref{s:Dieu} and
\ref{s:G-mods}, we will prove crucial results of Chevalley-Weil type
on the $G$-module structure of various flat and coherent cohomology
groups in Section~\ref{s:H1dR} and deduce the Dieudonn\'e module
version of Theorems~\ref{thm:G-str-genl-k} and \ref{thm:k-point}.  In
particular, we show that $H^1_{dR}(Y)$ is close to being a free module
over the group ring $k[G]$, and we control the Dieudonn\'e structure
of the ``errors''.  See Propositions~\ref{prop:H^1(Y)} and
\ref{prop:H^1(Y,T)} for the precise statements.  The translation from
modules to groups is given in Section~\ref{s:groups}.

In Section~\ref{s:comments}, we review some of the difficulties in
recovering $J_Y[p]$ from its associated graded as given in
Theorem~\ref{thm:G-str-genl-k}.

Our results on the \'etale part of $J_Y[p]$
(Proposition~\ref{prop:splitting} and
Theorems~\ref{thm:et-inequalities}, \ref{thm:et-extensions}, and
\ref{thm:f_X=2}) are proven in Section~\ref{s:apps-etale}.  Our
results on the local-local part of $J_Y[p]$
(Theorems~\ref{thm:h=1-app}, and \ref{thm:J_X-superspecial}) are
proven in Section~\ref{s:apps-ll}.  All these results come from a
careful study of the restrictions that $k[G]$-freeness places on a
Dieudonn\'e module.

In Sections~\ref{s:geometry} and \ref{s:calcs}, we analyze the
geometry of unramified Artin-Schreier covers and develop a method for
explicitly calculating $H^1_{dR}(Y)$ as a Dieudonn\'e module.  There
is an intentional (small) overlap in the expositions of
Sections~\ref{s:H1dR} and \ref{s:geometry} whose purpose is to make it
possible to read Sections~\ref{s:geometry} and \ref{s:calcs}
independently of Sections~\ref{s:H1dR} through \ref{s:apps-ll}.

%In Section~\ref{s:examples} we give several examples and further
%comments.

\bigskip

\subsection*{Standing notation} We fix the following notation and
hypotheses for the rest of the paper: $k$ is a perfect field of
characteristic $p>0$ with algebraic closure $\kbar$; $X$ is a smooth,
proper, geometrically irreducible curve of genus $g_X$ over $k$;
$\pi:Y\to X$ is an unramified Galois covering with group $\Z/p\Z$ such
that $Y$ has genus $g_Y$ and $H^0(Y,\OO_Y)=k$; and we fix an
isomorphism $G:=\gal(Y/X)\cong\Z/p\Z$.


\section{Dieudonn\'e theory}\label{s:Dieu}
We will use Dieudonn\'e theory to study $J_X[p]$ and
$J_Y[p]$.  We refer to \cite{Fontaine77} for the basic facts recalled below.

Let $\Dk$ be the associative $k$-algebra generated by symbols $F$ and
$V$ with relations
\[FV=VF=0,\qquad F\alpha=\alpha^pF,\and \alpha V=V\alpha^p\]
for all $\alpha\in k$.

A \emph{$p$-group scheme over $k$} is by definition a finite
commutative group scheme over $k$ which is annihilated by $p$.

Recall that Dieudonn\'e theory gives a contravariant equivalence
between the category of $p$-group schemes over $k$ and the category of
left $\Dk$-modules of finite length.  If $G$ is a $p$-group scheme
over $k$, we write $M(G)$ for the corresponding $\Dk$-module.

By definition, a $\Dk$-module $M$ is \emph{self-dual} if it admits a
non-degenerate pairing of $\Dk$-modules, i.e., a non-degenerate
$k$-bilinear pairing $\<\cdot,\cdot\>$ with the properties that
\begin{equation}\label{eq:D-module-pairing}
\<Fx,y\>=\<x,Vy\>^p\and\<Vx,y\>=\<x,Fy\>^{1/p}  
\end{equation}
for all $x,y\in M$.  By definition, a $\Dk$-module $M$ is a
\emph{$BT_1$ module} if $\Ker(F)=\im(V)$ (or equivalently, if
$\im(F)=\Ker(V)$).
% needed?
%A theorem of Oort says that if $M$ is a self-dual
%$BT_1$-module, then $M$ admits a non-degenerate $\Dk$-module pairing
%which is also alternating, i.e., $\<x,x\>=0$ for all $x\in M$. 

By definition, a $p$-group scheme $G$ over $k$ is \emph{self-dual}
(resp.~a \emph{$BT_1$ group scheme}) if $M(G)$ is self-dual (resp.~a
$BT_1$ module).

Any finite-dimensional $\D_k$-module $N$ decomposes as
\begin{equation}\label{eq:et-m-ll}
N\cong N_{\et}\oplus N_m\oplus N_{ll}  
\end{equation}
where $N_{\et}$ is \'etale ($F$ is bijective and $V=0$), $N_m$ is
multiplicative ($F=0$ and $V$ is bijective), and $N_{ll}$ is
``local-local'' ($F$ and $V$ are nilpotent).  (Choose a sufficiently
large integer $a$ and set $N_{\et}=\im F^a$, $N_m=\im V^a$, and
$N_{ll}=\Ker F^a\cap \Ker V^a$.)  Clearly this decomposition is
compatible with change of base field: if $k'/k$ is an extension of
perfect fields,
\[\left(N\tensor_kk'\right)_{\et}=N_{\et}\tensor_kk',\quad
  \left(N\tensor_kk'\right)_{m}=N_{m}\tensor_kk',\and
  \left(N\tensor_kk'\right)_{ll}=N_{ll}\tensor_kk'.\]

The assignments $N\rightsquigarrow N_{\et}, N_m, N_{ll}$ are exact
functors on the category of $\D_k$-modules.  We denote the
corresponding functors on $p$-torsion group schemes by
$\GG\rightsquigarrow\GG_{\et},\GG_m$ and $\GG_{ll}$.


If $N$ is a $\D_k[G]$-module, the decomposition is also respected by
the $G$ action since $G$ commutes with $F$ and $V$.  Also, $N$ is
self-dual if and only if $N_{\et}$ is dual to $N_m$ and $N_{ll}$ is
self-dual; and $N$ is a $BT_1$ module if and only if $N_{ll}$ is a
$BT_1$ module.

A theorem of Oda \cite[Cor.~5.11]{Oda69} says that for a smooth,
proper, irreducible curve $Z$ over $k$ with Jacobian $J_Z$, the
$p$-torsion subgroup $J_Z[p]$ is a self-dual $BT_1$ group scheme, and
$M(J_Z[p])\cong H^1_{dR}(Z)$ where $H^1_{dR}(Z)$ is equipped with a
natural $\Dk$-module structure.\footnote{Oda's result requires that
  $Z$ have a $k$-rational point.  This is of course no restriction
  when $k$ is algebraically closed.  When $k$ is only assumed to be
  perfect, \cite[Prop.~5.4]{Cais10} shows that Oda's result continues
  to hold even without a rational point.}  We will use this result to
prove the Theorems~\ref{thm:G-str-genl-k} and \ref{thm:k-point} as
statements about $H^1_{dR}(X)$ and $H^1_{dR}(Y)$ and related
Dieudonn\'e modules.

A recent preprint of Moonen \cite{Moonenpp20} gives an alternative
approach to self-dual $BT_1$ modules which is convenient for
calculations and which we will use to compute examples; see
Section~\ref{s:calcs}. 

% We end this section with an easy lemma on $\Dk$-modules. 
% \note{This is probably not needed anymore.}

% \begin{lemma}\label{lemma:complement}
%   Let $M$ be a self-dual $\Dk$-module with pairing $\<\cdot,\cdot\>$, and
%   suppose that $N\subset M$ is a submodule such that $\<\cdot,\cdot\>$ restricts
%   to a non-degenerate pairing on $N$.  Let $N^\perp$ be the orthogonal
%   complement of $N$ with respect to $\<\cdot,\cdot\>$:
%   \[N^\perp:=\{y\in M\mid \<x,y\>=0\text{ for all }x\in N\}.\]
%   Then $N$ and $N^\perp$ are self-dual $\Dk$-modules and
%   $M\cong N\oplus N^\perp$.  If in addition $M$ is a $BT_1$ module,
%   then so are $N$ and $N^\perp$.
% \end{lemma}

% \begin{proof}
%   It is obvious that the restriction of $\<\cdot,\cdot\>$ gives $N$ the
%   structure of a self-dual $\Dk$ module.  If $x\in N$ and
%   $y\in N^\perp$, then $Fx$ and $Vx\in N$, so
%   \[0=\<Fx,y\>=\<x,Vy\>^p\and 0=\<Vx,y\>=\<x,Fy\>^{1/p}.\] It follows
%   that $F$ and $V$ preserve the subspace $N^\perp\subset M$, so
%   $N^\perp$ is also a $\Dk$-module.  Since the restriction of
%   $\<\cdot,\cdot\>$ to $N^\perp$ is also non-degenerate, $N^\perp$ is
%   self-dual.  Clearly $M=N\oplus N^\perp$.

%   Now assume that $M$ is also a $BT_1$ module.  If
%   \[n\in\Ker(F:N\to N)\subset\Ker(F:M\to M),\]
%   then there is an $x\in M$ such that $Vx=n$.  Write $x=y+z$ where
%   $y\in N$ and $z\in N^\perp$.  Then $Vz\in N\cap N^\perp$, so $Vz=0$
%   and $Vy=n$.  This proves that $N$ is a $BT_1$ module.  The proof
%   that $N^\perp$ is a $BT_1$ is similar and will be left to the reader.
% \end{proof}


\section{$G$-modules}\label{s:G-mods}
Consider the group rings $k[G]$ or $\Fp[G]$ where as before
$G=\gal(Y/X)$ and we have fixed an isomorphism $G\cong\Z/p\Z$.
Let $\gamma\in G$ be the element corresponding to $1\in\Z/p\Z$.  Then
\[k[G]\cong k[\gamma]/(\gamma^p-1)\cong k[\delta]/(\delta^p)\]
where $\delta:=\gamma-1$.  Note that
\[\delta^{p-1}=\gamma^{p-1}+\cdots+1\]
is the trace element of $k[G]$.

% If $M$ is a $k[G]$-module and $\alpha\in k[G]$, write
% $M[\alpha]$ for the kernel of $\alpha$ acting on $M$.  We have
% \[H^0(G,M)=M[\delta],\quad
%   H^{2j-1}(G,M)=\frac{M[\delta^{p-1}]}{\delta(M)},
%   \and
%   H^{2j}(G,M)=\frac{M[\delta]}{\delta^{p-1}(M)}\]
% for $j\ge1$.
% (See, e.g., \cite[Ch.~VIII, \S4]{SerreLF}.)

It is easily checked that up to isomorphism the indecomposable
$k[G]$-modules are
\[V_i:=k[\delta]/(\delta^i)\quad\text{for $i=1,\dots,p$.}\] (See,
e.g., \cite[Lemma~64.2]{CurtisReinerRTFGAA}).  By the Krull--Schmidt
theorem, every finitely generated $k[G]$-module is (non-canonically)
isomorphic to a direct sum of indecomposable modules.

\begin{lemma}\label{lemma:G-free}
Let $M$ be a finitely generated  $k[G]$-module.  Then the following
conditions are equivalent:
\begin{enumerate}
\item $M$ is free over $k[G]$,
\item $M[\delta]=\delta^{p-1}M$,
\item $M[\delta^{p-1}]=\delta M$,
\item $\delta^{p-1}$ induces an isomorphism $M/\delta M\cong M[\delta]$.
\end{enumerate}
\end{lemma}

\begin{proof}
  This follows immediately from the classification of indecomposable
  $k[G]$-modules and a straightforward calculation.
\end{proof}

Equivalence of the conditions in Definition-Lemma~\ref{def:free}
follows from Lemma~\ref{lemma:G-free} by applying the Dieudonn\'e
functor.

% If $M$ is a $k[G]$-module of finite dimension over $k$, we have an
% isomorphism of $k[G]$-modules
% \begin{equation}\label{eq:decomp}
% M\cong\bigoplus_{i=1}^{p}V_i^{m_i}  
% \end{equation}
% for uniquely determined integers $m_i$.  Observe that
% \begin{align}
% %  \sum_{i=1}^p im_i&=\dim_k M\label{eq:mult-dim}\\
%   \sum_{i=1}^p m_i&=\dim_k H^0(G,M)\label{eq:mult-H0}\\%\notag
%   \noalign{and}
%   \sum_{i=1}^{p-1} m_i&=\dim _k H^1(G,M)=\dim_k H^2(G,M).
% \label{eq:mult-Hi}%\notag
% \end{align}

Define the dual of $V_i$ as $V_i^*=\Hom_k(V_i,k)$ with
action $(\gamma\phi)(v)=\phi(\gamma^{-1}v)$ for $\phi\in V_i^*$ and $v\in V_i$.
Then $V_i^*\cong V_i$ (non-canonically) as $k[G]$-modules.
% Note that
% \begin{equation}\label{eq:dual-filtration}
%   0\neq v\in \delta^{i-1}(V_i)\text{ and }
%   \phi\in V_i^*\text{ with } \phi(v)\neq0
%   \quad\Rightarrow\quad
%   V_i^*= k[G]\cdot\phi.
% \end{equation}

A non-degenerate, bilinear form $\<\cdot,\cdot\>$ on $M$ such that
$\<\gamma m,\gamma n\>=\<m,n\>$ for all $m,n\in M$ induces an
isomorphism $M\cong M^*$ of $k[G]$-modules.

Defining $\tilde\delta:=\gamma^{-1}-1=-\gamma^{-1}\delta$,  we have
\begin{equation*}%\label{eq:G-compatibility}
  \<m,\delta n\>=\<m,\gamma n\>-\<m,n\>
  =\<\gamma^{-1}m,n\>-\<m,n\>=\<\tilde\delta m,n\>.  
\end{equation*}
for all $m,n\in M$.  Note as well that $\delta$ and $\tilde\delta$
have the same image and kernel on any $k[G]$-module.

% If $M$ is a $k[G]$ module, define a filtration
% \[0=M_0\subset M_1\subset\cdots\subset M_p=M\]
% where $M_j:=M[\delta^j]:=\Ker\left(\delta^j:M\to M\right)$.

Parallel definitions and results hold for $\Fp[G]$-modules.  We write
$W_j$ for the module $\Fp[\delta]/(\delta^j)$ over
$\Fp[G]\cong\Fp[\delta]/(\delta^p)$.



\section{de Rham cohomology as a $\Dk[G]$-module}\label{s:H1dR}
Readers are assumed to be familiar with the flat, coherent, and de
Rham cohomology of curves over perfect fields, and in particular with
the semi-linear endomorphisms $F$ and $V$ of the de Rham cohomology of
a curve.  We recommend \cite{MilneEC}, \cite{MumfordOdaAG2}, and
\cite{Oda69} as basic references.

Suppose that $Z$ is a smooth, proper, irreducible curve over $k$.
Then we have coherent cohomology groups $H^s(Z,\OO_Z)$ and
$H^s(Z,\Omega^1_Z)$, as well as de Rham cohomology groups
$H^s_{dR}(Z)$.  These are finite-dimensional $k$ vector spaces,
and there is an exact sequence
\begin{equation}\label{eq:dR-seq}
0\to H^0(Z,\Omega^1_Z)\to H^1_{dR}(Z)\to H^1(Z,\OO_Z)\to0.  
\end{equation}

There is a cup product on $H^1_{dR}(Z)$ which induces a perfect
alternating pairing
\[H^1_{dR}(Z)\times H^1_{dR}(Z)\to H^2_{dR}(Z)=k\]
denoted $\<\cdot,\cdot\>_Z$. The subspace
$H^0(Z,\Omega^1_Z)$ is isotropic, and the pairing restricts to the
(perfect) Serre duality pairing
\[H^0(Z,\Omega^1_Z)\times H^1(Z,\OO_Z)\to k.\]

There are also semi-linear operators $F$ and $V$ on $H^s_{dR}(Z)$ making
it into a $\Dk$-module.  Explicitly,
\[H^0_{dR}(Z)\cong k,\text{ with }F\alpha=\alpha^p\text{ and
  }V\alpha=0,\]
\[H^2_{dR}(Z)\cong k,\text{ with }F\alpha=0\text{ and
  }V\alpha=\alpha^{1/p},\]
in other words
\[H^0_{dR}(Z)\cong M(\Z/p\Z)\and H^2_{dR}(Z)\cong M(\mu_p).\] 
If $(\omega_i,f_{ij})$ is a hypercocycle for
an affine open cover $\{U_i\}$ of $Z$ representing a class
$c\in H^1_{dR}(Z)$, then $Fc$ and $Vc$ are represented by
\begin{equation}\label{eq:D-deR}
(0,f_{ij}^p)\and (\CC\omega_i,0)  
\end{equation}
respectively, where $\CC$ is the Cartier operator.  See \cite{Oda69}
for more details.

We have
\[\im\left(V:H^1_{dR}(Z)\to H^1_{dR}(Z)\right)
  =\Ker\left(F:H^1_{dR}(Z)\to H^1_{dR}(Z)\right)=H^0(Z,\Omega^1),\]
so $H^1_{dR}(Z)$ is a $BT_1$ module.  The pairing is compatible with
the $\Dk$-module structure in the sense of
equation~\eqref{eq:D-module-pairing}, so $H^1_{dR}(Z)$ is a self-dual
$BT_1$ module.

If $\pi$ is a finite surjective map of smooth, projective curves, we
have maps $\pi^*$ and $\pi_*$ on de Rham cohomology which are
compatible with the $\Dk$-module structures.  Also, if $\pi$ is a
Galois cover, $\pi^*\pi_*$ is the trace map.  Applied to $\pi:Y\to X$,
this means
\begin{equation}\label{eq:trace}
  \pi^*\pi_*=1+\gamma+\cdots+\gamma^{p-1}=\delta^{p-1}
\end{equation}
as endomorphisms of de Rham cohomology. 

With data $\pi:Y\to X$, $G=\gal(Y/X)\cong\Z/p\Z$ as usual, we will
prove two results on the cohomology of $X$ and $Y$
(Propositions~\ref{prop:H^1(Y)} and \ref{prop:H^1(Y,T)}) which will
yield Theorems~\ref{thm:G-str-genl-k} and \ref{thm:k-point}.

Recall that the $p$-rank of a curve $Z$ is by definition the integer $f_Z$
such that $J_Z[p](\kbar)\cong(\Z/p\Z)^{f_Z}$.  It is also equal to the
dimension over $k$ of $H^1_{dR}(Z)_\et$.

\begin{prop}\label{prop:H^1(Y)}\mbox{}
\begin{enumerate}
\item There are canonical homomorphisms of $\Dk$-modules
  \[M(\Z/p\Z)\into H^1_{dR}(X)_{\et}\into H^1_{dR}(X)\and
    H^1_{dR}(X)\onto H^1_{dR}(X)_m\onto M(\mu_p)\]
  which are exchanged by Cartier duality.  The Dieudonn\'e module of
  the group $\GG_X$ in Definition~\ref{def:GG_X} is
  \[\MM_X:=\frac{\Ker\left(H^1_{dR}(X)\onto M(\mu_p)\right)}
    {\im\left(M(\Z/p\Z)\into H^1_{dR}(X)\right)}.\]
\item There are \textup{(}non-canonical\textup{)} isomorphisms of
  $k[G]$-modules
  \begin{align*}
    H^1_{dR}(Y)_\et&\cong V_1\oplus V_p^{f_X-1},\\
    H^1_{dR}(Y)_m&\cong V_1\oplus V_p^{f_X-1},\\
    H^1_{dR}(Y)_{ll}&\cong V_p^{2h_X},\\
        \noalign{and}
    H^1_{dR}(Y)&\cong V_1^2\oplus V_p^{2g_X-2},
  \end{align*}
  where $h_X=g_X-f_X$.
\item $\pi^*$ induces isomorphisms of $\Dk$-modules
\[H^1_{dR}(X)_m\labeledto{\pi^*} H^1_{dR}(Y)_m[\delta]\and
  H^1_{dR}(X)_{ll}\labeledto{\pi^*} H^1_{dR}(Y)_{ll}[\delta],\]
and an exact sequence
\[0\to M(\Z/p\Z)\to H^1_{dR}(X)_\et\labeledto{\pi^*}
  H^1_{dR}(Y)_\et[\delta]\to M(\Z/p\Z)\to 0.\]
The image $\pi^*\left(H^1_{dR}(X)_\et\right)$ is equal to
  $\delta^{p-1}H^1_{dR}(Y)_\et$. 
% \item $\pi_*$ induces isomorphisms of $\Dk$-modules
% \[H^1_{dR}(Y)_\et/\delta H^1_{dR}(Y)_\et\cong H^1_{dR}(X)_\et\and
%   H^1_{dR}(Y)_{ll}/\delta H^1_{dR}(Y)_{ll}\cong H^1_{dR}(X)_{ll},\]
% and an exact sequence
% \[0\to M(\mu_p)\to H^1_{dR}(Y)_m/\delta H^1_{dR}(Y)_m
%   \labeledto{\pi_*} H^1_{dR}(X)_m\to M(\mu_p)\to 0.\]
% \item We have \note{Rewrite for easier identification of $\MM_X$ as a
%     subquotient of $H^1_{dR}(Y)_\et$.}
%   \[\pi^*\left(\Ker\left(H^1_{dR}(X)_m\to M(\mu_p)\right)\right)=
%     \delta^{p-1}\left(H^1_{dR}(Y)_m\right)\]
%   and
% \[  \pi_*\left(\frac{H^1_{dR}(Y)_\et[\delta]}{\delta
%       H^1_{dR}(Y)_\et}\right)=
%   \im\left(M(\Z/p\Z)\to H^1_{dR}(X)_\et\right)\]
\item $\pi_*$ induces an isomorphism
  \[H^1_{dR}(Y)_\et/\delta
    H^1_{dR}(Y)_\et\labeledto{\pi_*}H^1_{dR}(X)_\et\]
  which identifies the line
  \begin{multline*}
    \im\left(H^1_{dR}(Y)_\et[\delta]\to
      H^1_{dR}(Y)_\et/\delta H^1_{dR}(Y)_\et\right)\\
    =\Ker\left(H^1_{dR}(Y)_\et/\delta H^1_{dR}(Y)_\et
      \labeledlongto{\delta^{p-1}} H^1_{dR}(Y)_\et[\delta]\right)
  \end{multline*}
  with the line
  \[\im\left(M(\Z/pZ)\into H^1_{dR}(X)_\et\right)\]
  defined in part \textup{(1)}.
\end{enumerate}
\end{prop}

\begin{rems}\label{rem:dualities}\mbox{}
  \begin{enumerate}
  \item It is straightforward to check that the cup product on de Rham
cohomology induces a duality between $H^1_{dR}(Y)_\et$ and
$H^1_{dR}(Y)_m$ and its restriction to $H^1_{dR}(Y)_{ll}$ is perfect
and gives the latter the structure of a self-dual module.  It is also
easy to see that $H^1_{dR}(Y)_{ll}$ is a $BT_1$.  Since the pairing
satisfies the compatibility $\<\delta m,n\>_Y=\<m,\tilde\delta  n\>_Y$
(see Section~\ref{s:G-mods}), we find that the orthogonal complement
of $\delta^iH^1_{dR}(Y)_{ll}$ is $\delta^{p-i}H^1_{dR}(Y)_{ll}$.  This
implies that
\[\frac{H^1_{dR}(Y)_{ll}}{\delta^iH^1_{dR}(Y)_{ll}}
  \quad\text{is dual to}\quad
  H^1_{dR}(Y)_{ll}[\delta^i].\]
On the other hand, $\delta^{p-i}$ induces an isomorphism
\[\frac{H^1_{dR}(Y)_{ll}}{\delta^iH^1_{dR}(Y)_{ll}}\to
  H^1_{dR}(Y)_{ll}[\delta^i].\] Therefore, each of the submodules
$H^1_{dR}(Y)_{ll}[\delta^i]$ is self-dual, and they are easily seen to
be $BT_1$ modules as well.  (One slight subtlety: These pairings are
not compatible with restriction.  Indeed, the restriction to
$H^1_{dR}(Y)_{ll}[\delta^{i-1}]$ of the pairing just constructed on
$H^1_{dR}(Y)_{ll}[\delta^i]$ is degenerate for $i>1$.)
\item The maps in part (1) may also be interpreted as a 3-step
  filtration on $H^1_{dR}(X)$ with
  \begin{align*}
    H^1_{dR}(X)^3&=H^1_{dR}(X),\\
    H^1_{dR}(X)^2&=\Ker\left(H^1_{dR}(X)\to M(\mu_p)\right),\\
    H^1_{dR}(X)^1&=\im\left(M(\Z/p\Z)\to H^1_{dR}(X)\right),\\
    \noalign{\qquad\quad and}
    H^1_{dR}(X)^0&=0.
  \end{align*}
  The subquotients are $M(\mu_p)$, $\MM_X$,
  and $M(\Z/p\Z)$.
  \item The filtration above is self-dual in the sense that
    $H^1_{dR}(X)^2$ and $H^1_{dR}(X)^1$ are orthogonal complements
    of one another.
  \end{enumerate}
\end{rems}

Figure~\ref{fig:1} may help to digest the statement of the
Proposition.  It illustrates the case $p=5$, $g_X=5$, and $f_X=4$.
Each box represents a one-dimensional subspace of $H^1_{dR}(Y)$ (the
upper group) or $H^1_{dR}(X)$ (the lower group).  On $H^1_{dR}(Y)$,
the action of $\delta$ shifts a given one-dimensional subspace to the
one represented by the box below (if there is one, otherwise to zero).
The groups on the left represent the multiplicative parts, those on
the right represent the \'etale parts, and those in the middle
represent the local-local parts.  The (canonical) class
$\eta_X\in H^1_{dR}(X)_\et$ is constructed in the proof and spans the
image of the injection in part (1) (i.e., the subspace
$H^1_{dR}(X)^1$.) .  The (non-canonical) class
$\omega_X\in H^1_{dR}(X)_m$ maps onto a class spanning the image of
the projection in part (1) (i.e., the subquotient
$H^1_{dR}(X)/H^1_{dR}(X)^2$).  We may choose $\omega_X$ so that
$\<\omega_X,\eta_X\>=1$.  The (non-canonical) classes $\omega_Y$ and
$\eta_Y$ can be chosen to satisfy $\pi^*\omega_X=\omega_Y$,
$\pi_*\eta_Y=\eta_X$, and $\<\omega_Y,\eta_Y\>=1$.  Caution: In
general, the lines spanned by $\omega_X$, $\omega_Y$, and $\eta_Y$ are
not invariant under $\Dk$.  This is closely related to the possible
non-splitting of the exact sequences \eqref{eq:GG_Y,et,ker} and
\eqref{eq:GG_Y,et,coker}.


\begin{proof}[Proof of Proposition~\ref{prop:H^1(Y)}]
  (1) Since $\pi:Y\to X$ is unramified, the choice of a fixed isomorphism
$\gal(Y/X)\cong\Z/p\Z$ makes $Y$ into a $\Z/p\Z$-torsor over $X$.  The
group that classifies such torsors is $H^1_\et(X,\Zps)$ (see, for example,
\cite[III.4]{MilneEC} or \cite[6.5.5]{PoonenRPV}). Therefore, there is a class in
$H^1_\et(X,\Zps)$ defined by the cover $\pi:Y\to X$ and the fixed
isomorphism $G\cong\Z/p\Z$, which will be denoted by $\eta_{X,\et}$.

Consider the exact sequence
\[0\to\Z/p\Z\to\OO_X\labeledto{\wp}\OO_X\to0\]
of sheaves for the \'etale topology on $X$ where $\wp(x)=x^p-x$.
Taking cohomology yields a homomorphism
\[H^1_{\et}(X,\Z/p\Z)\to H^1_\et(X,\OO_X)[\wp],\]
where $[\wp]$ indicates the kernel of $\wp$.  Since $H^0(Y,\OO_Y)=k$,
the image of $\eta_{X,\et}$ in $H^1_\et(X,\OO_X)[\wp]$ is non-zero,
and since $H^1_\et(X,\OO_X)[\wp]$ is the subset of the usual
(coherent) $H^1(X,\OO_X)$ fixed by Frobenius, we have a class
$\eta_{X,coh}\in H^1(X,\OO_X)$ fixed by Frobenius.  It has a canonical
lift to $H^1_{dR}(X)$ (take any lift and apply $F$), and we denote
this lift by $\eta_X$.  Since $F\eta_X=\eta_X$, we see that
$\eta_X\in H^1_{dR}(X)_\et$, and the injection in (1) is
$\alpha\mapsto \alpha\eta_X$.

The surjection in (1) is obtained from the injection by Cartier
duality, and is given more explicitly by $c\mapsto\<c,\eta_X\>_X$.

Decomposing the module $\MM_X$ into its \'etale, multiplicative, and
local-local parts shows that
\[\MM_{X,\et}=\coker\left(M(\Z/p\Z)\to H^1_{dR}(X)_\et\right),\]
\[\MM_{X,m}=\Ker\left(H^1_{dR}(X)_m\to M(\mu_p)\right),\]
and
\[\MM_{X,ll}=H^1_{dR}(X)_{ll}.\]
Thus $\MM_X$ is the Dieudonn\'e module of $\GG_X$.  This establishes
part (1) of the Proposition.

% Figure environment removed
\bigskip




(2) Taking the multiplicative and \'etale parts of the de Rham
sequence~\eqref{eq:dR-seq} with $Z=Y$ yields isomorphisms
\[H^1_{dR}(Y)_m\cong H^0(Y,\Omega^1_Y)_m\and
  H^1_{dR}(Y)_\et\cong H^1(Y,\OO_Y)_\et.\]

Tamagawa \cite{Tamagawa51} proves that there is an isomorphism of
$k[G]$-modules 
\begin{equation}\label{eq:Tamagawa}
H^0(Y,\Omega^1_Y)\cong V_1\oplus V_p^{g_X-1},  
\end{equation}
and Serre duality yields
\[H^1(Y,\OO_Y)\cong V_1\oplus V_p^{g_X-1}.\]
Nakajima \cite{Nakajima85} proves that there is an isomorphism of
$k[G]$-modules 
\begin{equation}\label{eq:Nakajima}
H^1_{dR}(Y)_m\cong H^0(Y,\Omega^1_Y)_m\cong V_1\oplus V_p^{f_X-1},  
\end{equation}
and Cartier duality yields
\[H^1_{dR}(Y)_\et\cong H^1(Y,\Omega^1_Y)_\et\cong V_1\oplus V_p^{f_X-1}.\]
This establishes the first two claims in part (2).

For the third claim in part (2), let $h_X=g_X-f_X$, and note that the
last four displayed equations and \eqref{eq:dR-seq} show that
$H^1_{dR}(Y)_{ll}$ is an extension of $V_p^{h_X}$ by $V_p^{h_X}$.
Since $V_p$ is free, the extension splits and there is an isomorphism
of $k[G]$-modules
\[H^1_{dR}(Y)_{ll}\cong V_p^{2h_X}.\]

The fourth claim in part (2) is simply the direct sum of the three
preceding claims.  This completes the proof of part (2) of the
Proposition.


% %\note{Part (2) could be taken off the shelf from Tamagawa and Nakajima.}
% The low degree terms of the Hochschild-Serre spectral sequence for
% $\pi$ with coefficients in $\Omega^1$ yield an isomorphism
% \begin{equation}\label{eq:E00}
% H^0(X,\Omega^1_X)\labeledto{\pi^*}
%   H^0(G,H^0(Y,\Omega^1_Y))=H^0(Y,\Omega^1_Y)[\delta]  
% \end{equation}
% and an injection
% \begin{equation}\label{eq:E10}
% H^1(G,H^0(Y,\Omega^1_Y))\into H^1(X,\Omega^1_X)\cong M(\mu_p).  
% \end{equation}
% Considering a decomposition of $H^0(Y,\Omega^1_Y)$ into indecomposable
% $k[G]$-modules as in equation~\eqref{eq:decomp}, and using
% equations~\eqref{eq:mult-H0} and \eqref{eq:mult-Hi}, we see that
% $H^0(Y,\Omega^1_Y)$ has $g_X$ direct factors, at most one of which is
% not free.  The only possibility compatible with the Riemann--Hurwitz
% formula is one non-free factor $V_1$ and $g_X-1$ free factors, i.e., we have
% an isomorphism of $k[G]$-modules

% Taking the multiplicative parts of \eqref{eq:E00} and \eqref{eq:E10}
% shows that the $k[G]$-module $H^0(Y,\Omega^1_Y)$ has $f_X$ direct
% factors, exactly one of which is non-free.  The only possibility
% compatible with the Deuring--Shafarevich formula is one non-free
% factor $V_1$ and $f_X-1$ free factors, i.e., we have an isomorphism of
% $k[G]$-modules
% \[H^1_{dR}(Y)_m\cong H^0(Y,\Omega^1_Y)_m\cong V_1\oplus V_p^{f_X-1}.\]
% (This was first proven in \cite{Nakajima85}.)

% Cartier duality yields
% \[H^1_{dR}(Y)_\et\cong H^1(Y,\Omega^1_Y)_\et\cong V_1\oplus V_p^{f_X-1}.\]
% (Once may also prove this using the Hochschild--Serre spectral
% sequence for $\pi$ with coefficients in $\OO$.)


(3) Consider the Hochschild--Serre spectral sequence for $\pi$
in de Rham cohomology.  The sequence of low degree terms is
\begin{equation*}
0\to H^1(G,H^0_{dR}(Y))\to
  H^1_{dR}(X)\labeledto{\pi^*}H^1_{dR}(Y)[\delta]\to
  H^2(G,H^0_{dR}(Y)).  
\end{equation*}
We have
\[H^1(G,H^0_{dR}(Y))\cong H^2(G,H^0_{dR}(Y))\cong M(\Z/p\Z),\]
and these modules are \'etale, so taking multiplicative
and local-local parts of the sequence yields isomorphisms
\[H^1_{dR}(X)_m\labeledto{\pi^*}H^1_{dR}(Y)_m[\delta]\and
  H^1_{dR}(X)_{ll}\labeledto{\pi^*}H^1_{dR}(Y)_{ll}[\delta].\]
Taking the \'etale part yields an exact sequence
\begin{equation}\label{eq:HS-dR}
  0\to M(\Z/p\Z)\to H^1_{dR}(X)_\et\labeledto{\pi^*}
  H^1_{dR}(Y)_\et[\delta]\to M(\Z/p\Z)\to 0,
\end{equation}
where surjectivity on the right follows from a dimension count using
part (2).  Thus $\eta_X$ spans the kernel of $\pi^*$ in
\eqref{eq:HS-dR}.  We will prove the last claim in (3) after establishing (4).

(4) The Cartier dual of the isomorphism
\[H^1_{dR}(X)_m\labeledto{\pi^*}H^1_{dR}(Y)_m[\delta]\]
is the isomorphism
\[H^1_{dR}(Y)_m/\delta H^1_{dR}(Y)_m\labeledto{\pi_*}H^1_{dR}(X)_m.\]
It follows from part (2) that the image of the natural map
\[H^1_{dR}(Y)_\et[\delta]\to H^1_{dR}(Y)_\et/\delta
    H^1_{dR}(Y)_\et\]
is a line, and that it is equal to
\[\Ker\left(H^1_{dR}(Y)_\et/\delta H^1_{dR}(Y)_\et
  \labeledto{\delta^{p-1}}
  H^1_{dR}(Y)_\et[\delta] \right),\]
and therefore equal to 
\[\Ker\left(H^1_{dR}(Y)_\et/\delta H^1_{dR}(Y)_\et
  \labeledto{\pi^*\pi_*}
  H^1_{dR}(Y)_\et[\delta]\right). \]
This shows that $\pi_*$ identifies this line with
\[\Ker \left(H^1_{dR}(X)_\et\labeledto{\pi^*} H^1_{dR}(Y)_\et[\delta]\right),\]
and we observed above that this is the line spanned by $\eta_X$, i.e.,
the line defined in part (1).  This completes the proof of part (4).
We also deduce that
\[\pi^*\left(H^1_{dR}(X)_\et\right)=\pi^*\pi_*
  \left(H^1_{dR}(Y)_\et\right)
  =\delta^{p-1}\left(H^1_{dR}(Y)_\et\right),\]
and this establishes the last claim in part (3).
\end{proof}



We now turn to an elegant result that holds under the assumption that
$X$ has a $k$-rational point.

\begin{prop}\label{prop:H^1(Y,T)}
Assume that $X$ has a $k$-rational point $S$ and let
$T=\pi^{-1}(S)$. Let $\NN_Y$ be the hypercohomology group
\[\NN_Y:=\Hy^1\left(Y,\OO_Y(-T)\labeledto{d}\Omega^1_Y(T)\right).\]
Then
\begin{enumerate}
\item $\NN_Y\cong V_p^{2g_X}$ as $k[G]$-modules.
\item For $i=1,\dots,p$, there are isomorphisms
  \[\frac{\NN_Y[\delta^i]}{\NN_Y[\delta^{i-1}]}
    =\frac{\delta^{p-i}\NN_Y}{\delta^{p-i+1}\NN_Y}
    \cong H^1_{dR}(X)\]
  of $\Dk$-modules.
\item There are exact sequences of $\D_k[G]$-modules
  \[0\to H^0(Y,\OO_Y)\to H^0(Y,\OO_T) \to \NN_{Y,\et}\to
    H^1_{dR}(Y)_\et\to0,\]
  and
  \[0\to H^1_{dR}(Y)_m\to\NN_{Y,m}\to
H^0(Y,\Omega^1_Y(T)/\Omega^1_Y)
\to H^1(Y,\Omega^1_Y)\to0,\]
as well as an isomorphism
\[\NN_{Y,ll}\cong H^1_{dR}(Y)_{ll}.\]
\end{enumerate}
\end{prop}

The $\Dk[G]$-module structures and homomorphisms in part (3) will be
made explicit in the proof.

\begin{rems}\label{rem:more-on-pairings2}\mbox{}
  \begin{enumerate}
\item In parallel with Remark~\ref{rem:dualities},  each of the subquotients
    $\NN_Y[\delta^i]/\NN_Y[\delta^j]$ for $0\le i<j\le p$, is
    self-dual, but not in a way compatible with restrictions of pairings.
\item The exact sequences appearing in part (3) may also be
  interpreted as a 3-step filtration on $\NN_Y$ with
  \begin{align*}
    \NN_Y^3&=\NN_Y,\\
    \NN_Y^2&=\ker\left(\NN_Y\to  H^0(Y,\Omega^1_Y(T)/\Omega^1_Y)\right),\\
    \NN_Y^1&=\im\left(H^0(Y,\OO_T)\to \NN_Y\right),\\
    \noalign{\qquad\quad and}
    \NN_Y^0&=0.
  \end{align*}
  The subquotients are
\begin{multline*}
  \qquad\qquad \Ker\left( H^0(Y,\Omega^1_Y(T)/\Omega^1_Y)
    \to H^1(Y,\Omega^1_Y)\right),\quad
H^1_{dR}(Y),\quad\text{and}\quad\\
\coker\left(H^0(Y,\OO_Y)\to H^0(Y,\OO_T)\right).\qquad\qquad
\end{multline*}
  \item The filtration $\NN_Y^i$ is self-dual in the sense that
    $\NN_Y^2$ and $\NN_Y^1$ are orthogonal complements to one another.
  \item The filtration on $\NN_Y$ induces a filtration on each of the
  subquotients $\NN_Y[\delta^i]/\NN_Y[\delta^{i+1}]$, and the induced
  filtration is the one on $H^1_{dR}(X)$ in Remark~\ref{rem:dualities}.
  \end{enumerate}    
\end{rems}


Figure~\ref{fig:2} illustrates the case $g_X=5$, $f_X=4$, and $p=5$,
with the same conventions as in the previous figure.  In this case,
$\pi_*:\NN_Y/\delta\NN_Y\to H^1_{dR}(X)$ is an isomorphism, as is
$\pi^*:H^1_{dR}(X)\to\NN_Y[\delta]$.  The gray zone on the right
represents the submodule $\NN^1_Y$ and the gray zone on the left
represents the quotient module $\NN^3_Y/\NN_Y^2$.  Note that the
classes $\omega_X$, $\eta_Y$, and $\omega_Y$ are not canonically
defined.
  


\begin{proof}[Proof of Proposition~\ref{prop:H^1(Y,T)}]
(1) By \cite[Thm.~1]{Nakajima85}, $H^0(Y,\Omega^1_Y(T))$ is free over
$k[G]$ of rank $g_X$.  The same is true of $H^1(Y,\OO_Y(-T))$ by Serre
duality.  The modified de Rham exact sequence
\[0\to H^0(Y,\Omega^1_Y(T))\to
  \Hy^1\left(Y,\OO_Y(-T)\labeledto{d}\Omega^1_Y(T)\right) \to
  H^1(Y,\OO_Y(-T))\to 0\]
shows that
$\NN_Y=\Hy^1\left(Y,\OO_Y(-T)\labeledto{d}\Omega^1_Y(T)\right)$ is
$k[G]$-free of rank $2g_X$.


(2) The quotients appearing in the statement are all isomorphic (via a
suitable power of $\delta$) to $\NN_Y[\delta]$, so it will suffice to
prove that $\NN_Y[\delta]\cong H^1_{dR}(X)$ as $\Dk$-modules.

Note that $\pi^*\OO_X(-S)=\OO_Y(-T)$ and
$\pi^*\Omega^1_X(S)=\Omega^1_Y(T)$.
The exact sequence of low degree terms of the Hochschild-Serre
spectral sequence for $Y\to X$ and $\OO_X(-S)$ yields an isomorphism
\[\pi^*:H^1(X,\OO_X(-S))\isoto H^1(Y,\OO_Y(-T))[\delta],\]
and since $Y\to X$ is unramified, it is clear that we have an
isomorphism
\[\pi^*:H^0(X,\Omega^1_X(S))\isoto H^0(Y,\Omega^1_Y(T))[\delta].\]
Using the modified de Rham sequences of $\OO_X(-S)\labeledto{d}\Omega^1_X(S)$
and $\OO_Y(-T)\labeledto{d}\Omega^1_Y(T)$ shows that $\pi^*$ induces an
isomorphism
\[\pi^*:\Hy^1\left(X,\OO_X(-S)\labeledto{d}\Omega^1_X(S)\right)
  \isoto\Hy^1\left(Y,\OO_Y(-T)\labeledto{d}\Omega^1_Y(T)\right)[\delta].\]
Since $\deg S=1$, we also have $H^1(X,\OO_X(-S))\cong H^1(X,\OO_X)$,
and $H^0(X,\Omega^1_X(S))\cong H^0(X,\Omega^1_X)$, so
\[H^1_{dR}(X)=\Hy^1\left(\OO_X\labeledto{d}\Omega^1_X\right)
  \cong \Hy^1\left(X,\OO_X(-S)\labeledto{d}\Omega^1_X(S)\right).\]
This completes the proof of part (2).

% This figure needs to be moved around in the tex file to get
% good placement in the pdf:
% % Figure environment removed


% Figure environment removed


(3) Note that there are exact sequences of complexes of coherent sheaves on $Y$:
\[0\to\left(\OO_Y(-T)\labeledto{d}\Omega^1_Y\right)\to
  \left(\OO_Y(-T)\labeledto{d}\Omega^1_Y(T)\right)
  \to\left(\Omega^1_Y(T)/\Omega^1_Y\right)[-1]\to0,\]
  and
  \[0\to \left(\OO_Y(-T)\labeledto{d}\Omega^1_Y\right)\to
    \left(\OO_Y\labeledto{d}\Omega^1_Y\right)\to
    \OO_T\to 0.\]
  Let $\NN_Y^2:=\Hy^1\left(Y,\OO_Y(-T)\labeledto{d}\Omega^1_Y\right)$ and
  $\NN_Y^1:= \coker\left(H^0(Y,\OO_Y)\to H^0(T,\OO_T)\right)$.

Taking cohomology of the first exact sequence above, we have
\begin{equation}\label{eq:NN-dev1}
0\to\NN^2_Y\to\NN_Y\to H^0(Y,\Omega^1_Y(T)/\Omega^1_Y)
     \to H^1(Y,\Omega^1_Y)\to0,  
\end{equation}
where the surjection on the right is the sum of residues map.  Note
that $H^0(Y,\Omega^1_Y(T)/\Omega^1_Y)$ is $k[G]$-free of rank 1, and
$H^1(Y,\Omega^1_Y)$ is $k$ with the trivial $k[G]$ action.  The action
of $F$ on both of these spaces is zero, and the $V$ action is
induced by the Cartier operator on differentials.
% more details?

Taking cohomology of the second exact sequence above, we have
\begin{equation}\label{eq:NN-dev2}  
0\to H^0(Y,\OO_Y)\to H^0(Y,\OO_T)\to
     \NN_Y^2\to H^1_{dR}(Y)\to0.
\end{equation}
  Note that $H^0(Y,\OO_T)$ is $k[G]$-free of rank 1, and
   $H^0(Y,\OO_Y)$ is $k$ with the trivial $k[G]$ action.  The action
   of $F$ on both of these spaces is the usual action of Frobenius,
   and the $V$ action is trivial.

The last two displayed exact sequences give the asserted filtration on
$\NN_Y$, and this completes the proof of part (3) of the proposition.
\end{proof}


\begin{rems}\label{rem:NN}\mbox{}
  \begin{enumerate}
  \item   The hypercohomology group $\NN_Y$ is closely related to the de
  Rham cohomology of the singular curve associated to $Y$ and $T$
  where $T$ is viewed as a "modulus", as in \cite[Ch.~4]{SerreAGCF}.
%  \note{Bryden, do you want to add something about a 1-motive in the
%    background?} 
\item   Suppose that $g_X>1$ and choose a $k$-rational, effective, reduced
  divisor $S$ on $X$.  A canonical divisor of $X$ is
  $k$-rational and effective, and since $k$ is perfect, the underlying
  reduced divisor of a $k$-rational divisor is again $k$-rational, so
  there always exists a divisor $S$ as above with degree $\le
  2g_X-2$.  Let $T=\pi^{-1}(S)$.  Then the proof of
  Proposition~\ref{prop:H^1(Y,T)} applies essentially verbatim and
  shows that $\NN_Y$ is free over $k[G]$ and that
  \[ \NN_Y[\delta]\cong \NN_X:=
    \Hy^1\left(X,\OO_X(-S)\labeledto{d}\Omega^1_X(S)\right).\]
Thus, at the expense of enlarging $H^1_{dR}(X)$ and $H^1_{dR}(Y)$ by
certain simple \'etale and multiplicative $\D_k$-modules, we can
always arrange that the cohomology associated to $Y$ is $k[G]$-free
with subquotients isomorphic to the cohomology associated to $X$.
\item We may also choose two reduced, strictly effective divisors
  $S_1$ and $S_2$ on $X$, set $T_i=\pi^*(S_i)$ and take
  hypercohomology of the complexes
  \[\OO_X(-S_1)\to\Omega^1_X(S_2)\and
    \OO_Y(-T_1)\to\Omega^1_Y(T_2).\]
  Then the latter is a free $k[G]$-module with subquotients isomorphic
  to the former.
  \end{enumerate}
\end{rems}




\section{Proofs of Proposition~\ref{def:GG_X} and
  Theorems~\ref{thm:G-str-genl-k} and
  \ref{thm:k-point}\label{s:groups}}\label{s:first-proofs}

\begin{proof}[Proof of Propostion~\ref{def:GG_X}]
  The group scheme homomorphisms in the first sentence of
  Definition-Proposition~\ref{def:GG_X} are obtained by applying the
  Dieudonn\'e functor to the $\D_k$-module homomorphisms in part (1)
  of Proposition~\ref{prop:H^1(Y)}.  This establishes the claims in
  Proposition-Definition~\ref{def:GG_X}, and it identifies $\MM_X$ as the
  Dieudonn\'e module of $\GG_X$.
\end{proof}


\begin{proof}[Proof of Theorem~\ref{thm:G-str-genl-k}]
  (1)  Splitting the 4-term exact sequence in part (3) of
  Proposition~\ref{prop:H^1(Y)} into two parts and using the
  identification of the image of $\pi_*$ there, we obtain
\[0\to M(\Z/p\Z)\to H^1_{dR}(X)_\et\to\delta^{p-1}H^1_{dR}(Y)_\et\to 0,\]
and
\[0\to \delta^{p-1}H^1_{dR}(Y)_\et\to H^1_{dR}(Y)_\et[\delta]\to
  M(\Z/p\Z)\to 0.\]
The first of these yields an isomorphism
$\MM_{X,\et}\cong\delta^{p-1}H^1_{dR}(Y)_\et$. Using part (4) of
Proposition~\ref{prop:H^1(Y)}, we obtain the diagram
\[\xymatrix{
    0\ar[r]&M(\Z/p\Z)\ar[r]\ar@{=}[d]&
    H^1_{dR}(X)_\et\ar[r]^{\pi^*}
    &\delta^{p-1}H^1_{dR}(Y)_\et\ar[r]\ar@{=}[d]& 0\\
    0\ar[r]&M(\Z/p\Z)\ar[r]&
    H^1_{dR}(Y)_\et/\delta\ar[u]_{\pi_*}\ar[r]^{\delta^{p-1}}&
    \delta^{p-1}H^1_{dR}(Y)_\et\ar[r]\ar@{=}[u]& 0. 
}  \]
Using the isomorphism $\MM_{X,\et}\cong\delta^{p-1}H^1_{dR}(Y)_\et$
and applying the Diedonn\'e functor yields the exact
sequence~\eqref{eq:GG_Y,et,ker} of Proposition~\ref{thm:G-str-genl-k}
and an identification of it with the exact sequence \eqref{eq:GG_X,et}.  Similarly,
the second exact sequence above yields \eqref{eq:GG_Y,et,coker}.

Part~(2) of Proposition~\ref{prop:H^1(Y)} shows that the subquotients
\[\frac{\delta^iH^1_{dR}(Y)_\et}{\delta^{i+1}H^1_{dR}(Y)_\et}\quad
        \text{for $i=1\dots,p-1$}
        \and
   \frac{H^1_{dR}(Y)_\et[\delta^i]}{H^1_{dR}(Y)_\et[\delta^{i-1}]}\quad
         \text{for $i=2\dots,p$}
       \]
are all isomorphic to one another via a suitable power of $\delta$.
Since $\delta^{p-1}H^1_{dR}(Y)_\et\cong\MM_{X,\et}$, applying the
Dieudonn\'e functor yields the isomorphisms in the first sentence of
part (1) of Theorem~\ref{thm:G-str-genl-k}, and this completes the
proof of this part.

Part~(2) is equivalent to part~(1) by Cartier duality.

For part~(3), note that part~(2) of Proposition~\ref{prop:H^1(Y)}
shows that the subquotients 
\[\frac{\delta^iH^1_{dR}(Y)_{ll}}{\delta^{i+1}H^1_{dR}(Y)_{ll}}\quad
        \text{for $i=1\dots,p$}
        \and
   \frac{H^1_{dR}(Y)_{ll}[\delta^i]}{H^1_{dR}(Y)_{ll}[\delta^{i-1}]}\quad
         \text{for $i=1\dots,p$}
       \]
are all isomorphic to one another via a suitable power of $\delta$.
Moreover, parts~(1) and (3) of Proposition~\ref{prop:H^1(Y)} show that
\[\MM_{X,ll}\cong H^1_{dR}(X)_{ll}\cong H^1_{dR}(Y)_{ll}[\delta],\]
so all of the subquotients above are isomorphic to $\MM_{X,ll}$. Applying
the Dieudonn\'e functor yields part~(3) of
Theorem~\ref{thm:G-str-genl-k}.  This completes the proof of that
theorem. 
\end{proof}

\begin{proof}[Proof of Theorem~\ref{thm:k-point}]
  Let $\HH$ be the $k$ group scheme with Dieudonn\'e module $\NN_Y$ as
  defined in Proposition~\ref{prop:H^1(Y,T)}.  By part (1) of that
  proposition, $\HH$ is $G$-free, and we have equalities
  $\delta^{i}\HH=\HH[\delta^{p-i}]$ for $i=1,\dots,p$.  By part (2),
  there are canonical isomorphisms
  \[      \frac{\delta^{i}\HH}{\delta^{i+1}\HH}\cong
    \frac{\HH[\delta^{p-i}]}{\HH[\delta^{p-i-1}]}\cong
    J_X[p]
        \quad\text{for $i=0,\dots,p-1$.}\]
  Note that
\[M\left(\res_{T/S}\Z/p\Z\right)\cong H^0(Y,\OO_T)\]
where the right hand side is a $k$ vector space on which $F$
acts by the $p$-power Frobenius and $V=0$, and that
\[M\left(\res_{T/S}\mu_p\right)\cong
  H^0\left(Y,\Omega^1_Y(T)/\Omega^1_Y\right)\]
where the right hand side is a $k$ vector space on which $F=0$ and $V$
acts by the Cartier operator (which is essentially the inverse
Frobenius on residues).  Then applying the Dieudonn\'e functor to
part (3) of Proposition~\ref{prop:H^1(Y,T)} yields the exact sequences
asserted in part (3) of Theorem~\ref{thm:k-point}.  This completes the
proof of the theorem.
\end{proof}


\section{Comments on $\D_k[G]$-modules and
  examples}\label{s:comments}

\subsection{Motivation}\label{ss:motivation}
Suppose that $N$ is a finite-dimensional $k$-vector space equipped
with an action of $\D_k$ and/or $G=\Z/p\Z$.  Then $N$ is both Artinian
and Noetherian, so the Krull-Schmidt theorem holds: $N$ is the direct
sum of indecomposable submodules, and the number and isomorphism types
of the summands are uniquely determined. (See, for example,
\cite[\S3.4]{JacobsonBasicAlgebraII}.)

In the case where $N=H^1_{dR}(Y)$ or $\NN_Y$, we have complete
information on $N$ as a $k[G]$-module from part (2) of
Proposition~\ref{prop:H^1(Y)} or part (1) of
Proposition~\ref{prop:H^1(Y,T)} respectively.  If we take
$H^1_{dR}(X)$ as given, then we know the associated graded of $N$ with
respect to the two filtrations attached to the $G$-action by the
proofs of Theorems~\ref{thm:G-str-genl-k} and \ref{thm:k-point} in
Section~\ref{s:first-proofs}.

The basic question that motivates Sections~\ref{s:apps-etale} and
\ref{s:apps-ll} is this: what restrictions on $N$ as a $\D_k$-module
are imposed by the information in the preceding paragraph?  As we will
see below, this question appears to be quite difficult, and we are only
able to give satisfactory answers in the simplest cases.  In the rest of
this section, we explain some of the difficulties and give examples
illustrating them.

\subsection{Extensions of $BT_1$ modules}\label{ss:extensions}
Propositions~\ref{prop:H^1(Y)} and \ref{prop:H^1(Y,T)} tell us that
the self-dual $BT_1$ module $H^1_{dR}(Y)_{ll}$ is a repeated extension
of the self-dual $BT_1$ module $H^1_{dR}(X)_{ll}$.  In this section,
we make some comments (surely well-known to experts) about how
ill-behaved such extensions may be, even when $k$ is algebraically
closed

More precisely, consider the full subcategory of the category of
$\Dk$-modules whose objects are $BT_1$ modules.  We use freely the
Kraft classification of $BT_1$ modules in terms of cyclic words on the
two letter alphabet $\{f,v\}$.  (See \cite{PriesUlmer21} for an overview.)

It is a simple exercise to check that this category is closed under
extension and quotient in the sense that if
\[0\to M_1\to M\to M_2\to0\]
is an exact sequence of $\Dk$-modules, and if two of $M,M_1,M_2$ are
$BT_1$ modules, then so is the third.
% Use the short exact sequence of complexes with middle term
% \[M\labeledto{V}M\labeledto{F}M.\]
% The middle homology is the obstruction to being a $BT_1$.
% The long exact sequence of homology gives the assertion immediately when
% $M_1$ and $M_2$ are $BT_1$'s.  For the other cases, use
% $\ker V_M=\im F_M$, $\coker F_M=\coim V$, etc., to see that the maps
% before or after the obstructions are onto/into. 

However, this category has the unfortunate property that the image and
kernel of a morphism between $BT_1$ modules need not be $BT_1$
modules.  For example, if $M_{1,1}$ is the module associated to the word
$fv$ (so one generator $e$ and one relation $Fe=Ve$), then the maps of
modules $M\to M$ determined by sending $e$ to $Fe$ has kernel and
image isomorphic to the module $\Dk/(F,V)$, and this is not a $BT_1$.

In \cite{Oort05}, there is a determination of the simple $BT_1$
modules, i.e., those that have no non-trivial $BT_1$ submodule.  It
follows by standard arguments that every $BT_1$ module is an iterated
extension of simple $BT_1$ modules.

Unfortunately, there is no Jordan-Holder theorem here: The list of
simple $BT_1$ modules appearing in a presentation of a given $M$ as an
extension of simple $BT_1$ modules is not in general uniquely determined.
%(Presumably the standard proof breaks down because of the problem
%above with images and kernels, although I have not checked this.)

Here is an example: Let $M$ be the module associated to $f^3v^3$ (one
generator $e$ with relation $F^3e=V^3e$).  Then is is not hard to
check that $M$ is a three-fold extension of $M_{1,1}$.
% (Send $e$ to the standard generator of $M_{1,1}$.  The kernel is
% spanned by $e':=(F-V)e$, $F^2e=Fe'$, $F^3e=F^2e'$, $V^2e=Ve'$, and as
% a $\Dk$ module, is cyclic, generated by $e'$ with relation
% $F^2e'=V^2e'$.  Do this twice more to see that $M$ has simple factors
% $M_{1,1}$ three times.
On the other hand, $M$ also admit a surjection onto the module
$M_{2,1}$ corresponding to $ffv$ (one generator $a$ with relation
$F^2a=Va$) with kernel isomorphic to $M_{1,2}$, the module
corresponding to the word $fvv$ (one generator $b$ with relation
$Fb=V^2b$).  Oort's results imply that $N_{2,1}$ and $N_{1,2}$ are
simple, so we have no uniqueness of ``Jordan-Holder'' factors.

\begin{s-example}\label{ex:differenteta}
We show by example that
$H^1_{dR}(Y)$ is not determined by $H^1_{dR}(X)$, even when $k$ is algebraically closed; that is, 
$H^1_{dR}(Y)$ is not determined as a $\D_k[G]$-module by its associated graded
$\D_k$-module.

Assume that $k$ is algebraically closed.  Then, as explained in the
proof of part (1) of Proposition~\ref{prop:H^1(Y)}, the data of the
cover $\pi:Y\to X$ and the isomorphism $\gal(Y/X)\cong\Z/p\Z$
determines and is determined by an element in the finite-dimensional
$\Fp$-vector spaces
\[H^1_{et}(X,\Z/p\Z)\cong H^1_{dR}(X)^{F=1}\cong H^1(X,\OO_X)^{F=1}.\]
Multiplying the element by a scalar in $\alpha\in\Fp^\times$
represents the same cover $\pi:Y\to X$ with the isomorphism
$\gal(Y/X)\cong\Z/p\Z$ multiplied by $\alpha$.  The set of unramified
covers $\pi:Y\to X$ (without the isomorphism $\gal(Y/X)\cong\Z/p\Z$)
is thus in bijection with the projective space
$\P\left(H^1(X,\OO_X)^{F=1}\right)$.  For general $k$, elements of
$\P\left(H^1(X,\OO_X)^{F=1}\right)$ correspond to $\kbar$-isomorphism
classes of covers which can be defined over $k$.  (In general, they
are represented by several distinct $k$-isomorphism classes of covers.
See Remark~\ref{rems:torsors} (1) below.))

Take $p=3$ and let $X$ be the degree 9 hyperelliptic curve over $k:=\F_3$ given by
\[X:\qquad y^2 = x^9 + x^4 +x^2 + 1.\]
Then $X$ has genus $g_X = 4$ and $f_X = \nu_X = 2$, and
$H^1(X,\O_X)^{F=1}$ is 2-dimensional over $\F_p$.  The 4 unramified
covers of $X$ over $\kbar$ thus all arise from covers defined over
$k$.  For each, we choose a cover representing it given by
$Y_i:\ z^p - z = f_i$, with $f_i$ in the table below, and for each
cover $Y_i$ we record the EO-type of $\D(J_{Y_i}[p]_{ll})$ (which
determines the isomorphism class of $J_{Y_i}[p]_{ll}$ over $\kbar$,
but not in general over $k$).  For $a\in \F_3$, we also consider the
twisted curve $Y_i(a): z^p-z = f_i + a$ and record the invariant factors 
of $F$ acting on $\D(J_{Y_i}(a)[p]_{et})$, which determine its isomorphism type as a $k[F]$-module.  We emphasize that 
$Y_i(a)\simeq Y_i$ over $\kbar$ for each $a$.  This list of invariant factors will be of the form $(F-1)^{e_1}, (F-1)^{e_2},\ldots$,
with $e_1\le e_2\le\ldots$, and for ease of notation we record it simply as $e_1,e_2,\ldots$. 
Perhaps surprisingly, the isomorphism type varies among the three possible twists over $k$.
%(which determines the isomorphism class of $J_{Y_i}[p]_{et}$ over $k$).
\begin{center}
\begin{tabular}{c|c|c|c|c}
%dlu:  Since J_Y[p]_{ll} is self-dual, it is determined by the first
%half of the sequence of dimensions deduced from canonical
%filtration.  By definition, this first half is the EO-type.
	 $Y_i:\ z^p - z = $ & EO-type of $\D(J_{Y_i}[p]_{ll})$ & \multicolumn{3}{c}{Inv. factors of $F$ on $\D(J_{Y_i(a)}[p]_{\et})$} \\
	\hline 
	                                           &                               &          $ a=0$ & $a=1$ & $a=-1$ \\
	                                           \cline{3-5}
	 $-(x^6 + x^3 + x -1)y $ & $[ 0, 0, 0, 1, 2, 3]$ & $1,1,2$  &  $1,3$  & $1,3$\\
	  $ (x^6 + x + 1)y $ & $[ 0, 0, 1, 1, 2, 3]$ & $1,1,2$  &  $1,3$  & $1,3$\\
	 $(x^3 + 1)y +1$ & $[ 0, 1, 1, 2, 3, 4]$ & $1,3$  &  $1,3$  & $1,1,2$\\
	$(x^6 - x^3 + x)y$ & $[ 0, 1, 1, 2, 3, 4]$ & $1,1,2$  &  $1,3$  & $1,3$\\
	%  $Y_i:\ z^p - z = $ & EO-type of $\D(J_{Y_i}[p]_{ll})$ & $k[F]$-isomorphism class of $\D(J_{Y_i}[p]_{\et})$ \\
	% \hline 
	%  $-(x^6 + x^3 + x -1)y - 1$ & $[ 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 5, 6 ]$ & $\frac{k[F]}{F-1} \oplus \frac{k[F]}{(F-1)^3}$  \\
	%   $ (x^6 + x + 1)y + 1$ & $[ 0, 0, 1, 1, 2, 3, 3, 3, 4, 4, 5, 6 ]$ & $\frac{k[F]}{F-1} \oplus \frac{k[F]}{(F-1)^3}$ \\
	%  $(x^3 + 1)y + 1$ & $[ 0, 1, 1, 2, 3, 4, 4, 4, 4, 5, 5, 6 ]$ & $\frac{k[F]}{F-1} \oplus \frac{k[F]}{(F-1)^3}$ \\
	% $(x^6 - x^3 + x)y$ & $[ 0, 1, 1, 2, 3, 4, 4, 4, 4, 5, 5, 6 ]$ & $\frac{k[F]}{F-1} \oplus \frac{k[F]}{F-1}\oplus  \frac{k[F]}{(F-1)^2}$ \\
%	 [
%            <Algebraic function field defined over F by
%            $.1^3 + 2*$.1 + (X^6 + X^3 + X + 2)*y + 2
%        ],
%        [
%            <Algebraic function field defined over F by
%            $.1^3 + 2*$.1 + (2*X^6 + 2*X + 2)*y + 2
%        ],
%        [
%            <Algebraic function field defined over F by
%            $.1^3 + 2*$.1 + (2*X^3 + 2)*y + 2
%        ],
%        [
%            <Algebraic function field defined over F by
%            $.1^3 + 2*$.1 + (2*X^6 + X^3 + 2*X)*y
%        ]
\end{tabular}
\end{center}
% This does not follow from what is computed above:
% In fact, we compute that $J_{Y_3}[p]_{ll} \simeq J_{Y_4}[p]_{ll}$
% already over $k$.

Note that the three group schemes $J_{Y_i}[p]_{ll}$ for $1\le i\le 3$
are pairwise non-isomorphic over $\kbar$, and that the four $k$-group
schemes $J_{Y_i}[p]$ for $1\le i\le 4$ are pairwise non-isomorphic
over $k$.  However, $J_{Y_3}[p]$ and $J_{Y_4}[p]$ become isomorphic
over $\kbar$.  Note as well that the EO-types of $J_{Y_3}[p]$ and
$J_{Y_4}[p]$ show that the conclusion of Theorem~\ref{thm:h=1-app}
need not hold when $g_X-f_X>1$.
\end{s-example}


  
\section {Applications to the \'etale part of $J_Y[p]$}\label{s:apps-etale}
We turn to a consideration of the \'etale part of $J_Y[p]$.  When $k$
is algebraically closed, $J_Y[p]_\et$ is completely determined by the
isomorphism \eqref{eq:DSet}.  As we will see below, the situation is
more interesting when $k$ is only assumed to be perfect.


\begin{proof}[Proof of Proposition~\ref{prop:splitting}]
Applying the Dieudonn\'e functor to parts (3) and (4) of
Proposition~\ref{prop:H^1(Y)} yields an exact sequence
\[0\to\Z/p\Z\to J_Y[p]_\et/\delta
  \overset{\delta^{p-1}}{\xrightarrow{\hspace*{1cm}}}
    J_Y[p]_\et[\delta]\to\Z/p\Z\to 0,\]
and an identification of $\im\delta^{p-1}$ with $\GG_X$ via the
isomorphism $\pi^*:J_X[p]_\et\to J_Y[p]_\et[\delta]$.  Splitting this
exact sequence into two short exact sequences yields sequences
\eqref{eq:GG_Y,et,ker} and \eqref{eq:GG_Y,et,coker}.  

For part (1), assume that the sequence \eqref{eq:GG_Y,et,ker} splits.
Then we have an inclusion
\[\Z/p\Z\into J_Y[p]_\et[\delta]\into J_Y[p]_\et\]
whose image does not lie in $\im\delta^{p-1}$.  By part (2) of
Theorem~\ref{prop:H^1(Y)}, the image therefore does not lie in the
image of $\delta$.  This shows that the quotient $\QQ$ defined by the
exactness of
\begin{equation}\label{eq:1.5-splits}
0\to\Z/p\Z\to J_Y[p]_\et\to\QQ\to 0  
\end{equation}
is $G$-free.

Conversely, if we have the exact sequence \eqref{eq:1.5-splits} with
$\QQ$ assumed to be $G$-free, then the image of $\Z/p\Z\to J_Y[p]$ is
killed by $\delta$ and not in the image of $\delta$, so it splits
\eqref{eq:GG_Y,et,ker}.  This completes the proof of part (1) of the
proposition.

For part (2), assume that the sequence \eqref{eq:GG_Y,et,coker} splits.
Then we have a surjection
\[J_Y[p]_\et\onto J_Y[p]_\et/\delta\onto\Z/p\Z\]
whose kernel maps surjectively to $\GG_X$ via $\delta^{p-1}$.  This
shows that the subgroup $\KK$ defined by the 
exactness of
\begin{equation}\label{eq:1.6-splits}
0\to\KK\to J_Y[p]_\et\to\Z/p\Z\to 0  
\end{equation}
is $G$-free.

Conversely, if we have the exact sequence \eqref{eq:1.6-splits} with
$\KK$ assumed to be $G$-free, then the surjection
$J_Y[p]_\et\to\Z/p\Z$ factors through $J_Y[p]_\et/\delta$, so it
splits \eqref{eq:GG_Y,et,coker}.  This completes the proof of part (2)
of the proposition.

For part (3), if the exact sequences \eqref{eq:GG_Y,et,ker} and
\eqref{eq:GG_Y,et,coker} both split, then we have the sequences
\eqref{eq:1.5-splits} and \eqref{eq:1.6-splits}.  It then follows
easily from part (2) of Theorem~\ref{prop:H^1(Y)} that the composed
maps
\[\Z/p\Z\to J_Y[p]_\et\to\Z/p\Z\]
and
\[\KK\to J_Y[p]_\et\to\QQ\]
are isomorphisms, so $J_Y[p]_\et$ is isomorphic to the direct sum of
$\Z/p\Z$ and a $G$-free group.  (Moreover, sequences
\eqref{eq:1.5-splits} and \eqref{eq:1.6-splits} both split.)  The
converse is straightforward.

This completes the proof of Proposition~\ref{prop:splitting}
\end{proof}

\begin{s-example}\label{ex:splitting}
  In general, the splitting of exact sequences \eqref{eq:GG_Y,et,ker}
  and \eqref{eq:GG_Y,et,coker} appear to be independent conditions:
  Table \ref{UnrTable} provides several examples of \'etale
  $\Z/3\Z$-covers of genus 3 hyperelliptic curves over $\F_3$ with
  $f_X=2$ exhibiting that all 4 splitting possibilities indeed occur.
  (The additional notations $d_1$, $d_2$, and $\mu$ are explained in
  Example~\ref{ex:extension-bounds} below.)  Note, however, that in
  certain special situations, there are implications: for example when
  $k$ is finite and $\nu_X=1$, the splitting of \eqref{eq:GG_Y,et,ker}
  implies that of \eqref{eq:GG_Y,et,coker} by Theorem
  \ref{thm:et-inequalities} \eqref{thm:et-inequalities:part4}.

\end{s-example}



%Let $k=\F_3$.  In the table below, we record data about several \'etale $\Z/3\Z$-covers
%$Y\rightarrow X$ over $k$, where $X$ is hyperelliptic of genus 3 with $f_X=2$.

\begin{center}
\begin{table}
\begin{tabular}{c|c|c|c|c|c|c|c|c}
	$X: y^2 = $ &  $\nu_X$ & $Y: z^3-z = $ & $\nu_Y$ & $\eqref{eq:GG_Y,et,ker}$ split? &  $\eqref{eq:GG_Y,et,coker}$ split? & $d_1$ & $d_2$  & $\mu$  \\
	\hline 
	$x^7 + x^5 + x$ &1 & $(x^4 + x^2 + x)y$ & 1 & yes & yes & 2 & 1 & 3 \\
	$-x^7 - x^3 + x $ & 1 & $xy$ & 1 & yes & yes & 2 & 3 & 2 \\ 	
	$-x^7 - x^3 - 1 $ & 1 & $xy-1$ & 1 & yes & yes & 2 & 3 & 1 \\ 	
	$x^7 + x^6 + x^4 + x$ & 1 &  $(x + 1)y$ & 2 & no & no  & 3 & 1&  \\
	$x^7 + x^6 + x^4 + 1$ & 1 & $(x + 1)y + 1$ & 2 & no & yes & 3 & 1&  \\
	$-x^7 + x^6 + x^4 + x$ & 1 &  $(-x + 1)y$ & 3 & no & yes & 3 & 1 & \\
	$x^8 -x^6 + x^4 - x^2 + 1$ & 2 & $ (x^2 - 1)y - x^6 + x^2 - 1 $ & 2 & yes & yes & 1 & 3 &  \\
	$ -x^7 + x^6 + x^2 + x$ & 2 & $(-x + 1)y$ & 3 & yes & no & 1 & 3 & \\
	$-x^7 + x^6 + x^2 + x$ & 2 & $(-x^4 + x^3 + x - 1)y$ & 3 & yes & yes & 1 & 3 & \\
	$ -x^7 + x^6 + x^2 + x$ & 2 & $(-x^4 + x^3)y$ & 4 & yes & yes & 1 & 1& 
\end{tabular}
	\caption{$p=3$, $f_X=2$}
	\label{UnrTable}
	\end{table}
\end{center}


In some of the proofs below, it will be convenient to use the language
of Galois representations.  Recall (e.g., using
\cite[\S5.8]{PoonenRPV}) that there is an equivalence of categories
between \'etale $p$-group schemes over $k$ and representations of
$\gal(\kbar/k)$ on finite-dimensional $\Fp$-vector spaces.  The
representation associated to a group $\GG$ is the $\Fp$-vector space
$\VV:=\GG(\kbar)$ equipped with the natural action of $\gal(\kbar/k)$.
In particular, when $k$ is finite, $\gal(\kbar/k)$ is pro-cyclic, and
$\GG$ is determined by a single endomorphism of $\VV$, namely
Frobenius.



\begin{proof}[Proof of Theorem~\ref{thm:et-inequalities}]
  First note that if
\[0\to\GG_1\to\GG_2\to\GG_3\to0\]
  is an exact sequence of $p$-torsion group schemes over $k$, then
  \[ \nu(\GG_1)\le\nu(\GG_2)\le\nu(\GG_1)+\nu(\GG_3).\]
  If the sequence splits, then $\nu(G_2)=\nu(\GG_1)+\nu(\GG_3)$.
  
  By part (1) of Theorem~\ref{thm:G-str-genl-k},
  \[J_X[p]_\et\cong J_Y[p]_\et[\delta]\subset J_Y[p]_\et,\]
  so we have $\nu_X\le\nu_Y$.

  Again by part (1) of Theorem~\ref{thm:G-str-genl-k}, we have exact
  sequences
  \[0\to J_Y[p]_\et[\delta^{i-1}]\to
    J_Y[p]_\et[\delta^{i}]\to\GG_X\to0\]
  for $i=2,\dots,p$.

  Applying the observation in the first paragraph of the proof and
  induction on $i$, we find that $\nu_Y\le\nu_X+(p-1)\nu(\GG_X)$.
  Since $\GG_X$ is a subgroup scheme of $J_X[p]$, $\nu(\GG_X)\le\nu_X$
  and we have $\nu_Y\le p\nu_X$.  This establishes part (1).

  If \eqref{eq:GG_X,et} splits, then
  $\nu(\GG_X)=\nu_X-1$ and we find that $\nu_Y\le p(\nu_X-1)+1$.  This
  yields part (2).

  For part (3), if $k$ is algebraically closed, then $\nu_X=f_X$ and
  $f_X\ge 1$ since we have assumed $X$ has an \'etale $\Z/p\Z$ cover.
  Now assume that $k$ is finite.  Note that by
  Definition-Proposition~\ref{def:GG_X}, the representation associated
  to $J_X[p]_\et$ has the trivial representation as a quotient.  This
  is equivalent to saying that the action of Frobenius on
  $\VV=J_X[p](\kbar)$ has 1
  %as a generalized eigenvalue.  Since $k$ is
  %finite, $\Gamma$ is procyclic, and therefore Frobenius has 1
  as an eigenvalue.  It follows that $J_X[p](k)$ is non-trivial, i.e.,
  $\nu_X\ge1$.

  If $k$ is finite, \eqref{eq:GG_Y,et,ker} is split, and
  \eqref{eq:GG_Y,et,coker} is non-split, then we claim that $\Fr_k-1$
  can not act bijectively on $\GG_{X,\et}(\kbar)$, where $\Fr_k$
  generates $\Gal(\kbar/k)$.  Indeed, assuming to the contrary that
  $\Fr_k-1$ is bijective on $\GG_{X,\et}(\kbar)$, one sees via the
  snake lemma that in the exact sequence of $\kbar$-points associated
  to \eqref{eq:GG_Y,et,coker}, the image of $\Fr_k-1$ on
  $(J_Y[p]_{\et}/\delta)(\kbar)$ projects isomorphically onto the
  quotient $\GG_{X,\et}(\kbar)$; the inverse of this isomorphism
  splits \eqref{eq:GG_Y,et,coker}, contradicting our hypothesis.  We
  conclude that $\Fr_k$ must have a nontrivial fixed vector on
  $\GG_{X,\et}(\kbar)$.  Since \eqref{eq:GG_X,et} (equivalently
  \eqref{eq:GG_Y,et,ker}) splits by hypothesis, we deduce that the
  space of $\Fr_k$-fixed vectors in $J_X[p]_{\et}(\kbar)$ is at least
  $2$-dimensional, {\em i.e.}~$\nu_X\ge 2$.  This completes the proof
  of part (4) of the theorem.
\end{proof}

\begin{s-example}\label{nubound:sharp} 
  Table \ref{UnrTable} shows that the bounds on $\nu_Y$ in Theorem
  \ref{thm:et-inequalities}
  \eqref{thm:et-inequalities:part1}--\eqref{thm:et-inequalities:part2}
  are sharp: if \eqref{eq:GG_Y,et,ker} is non-split, we must have
  $\nu_X=1$ since $f_X=2$ throughout the table (indeed, the
  alternative is $\nu_X=2=f_X$, in which case $J_X[p]_{\et}$ would be
  completely split, implying the splitting of \eqref{eq:GG_Y,et,ker})
  This forces $\nu_Y > 1$ by Theorem \ref{thm:f_X=2} (B) and
  Proposition \ref{prop:splitting} (3), which gives the bounds
  $1=\nu_X < \nu_Y \le 3$ in this situation. Lines 4--6 of the table
  show that both possibilities $\nu_Y=2,3$ indeed occur.
 
  When
  $\eqref{eq:GG_Y,et,ker}$ is split, we have
  $\nu_X \le \nu_Y \le 3\nu_X-2$; lines 1--3 show that the unique possibility $\nu_Y=1$
  indeed occurs when $\nu_X=1$, while
  lines 7--10 show that all three
  possibilities $\nu_Y = 2,3,4$ occur when $\nu_X=2$.  
\end{s-example}

\begin{s-example}\label{ex:nu_X=0}
  In part (3), if we do not assume that $k$ is finite, $\gal(\kbar/k)$
  may no longer be procyclic, and it may have $\Fp$-representations
  with trivial quotients, but no trivial subrepresentations.  Here is
  an example of such a representation.

  Take $p=3$, let $F=\Fp(t)$, let $F'=\Fp(v)$, and embed $F\into F'$
  by $t\mapsto (v^3-v)^2$.  Then one checks that $F'/F$ is Galois with
  group $S_3$.  Let $k$ and $k'$ be the perfections of $F$ and $F'$
  respectively.  Then we have
  \[\gal(\kbar/k)\onto\gal(k'/k)\cong S_3.\]

  Let $\gamma_1$ and $\gamma_2$ be two involutions generating $S_3$,
  and let $S_3$ act on $\VV:=\F_3^2$ by the matrices
  \[\gamma_1\mapsto\psmat{-1&1\\0&1}\and
    \gamma_2\mapsto\psmat{-1&0\\0&1}.\]

  Then one sees easily that the resulting representation of
  $\gal(\kbar/k)$ has the trivial representation as a quotient, but it
  does not have the trivial representation as a sub.  Thus the
  corresponding group scheme $\GG$ admits a surjection to $\Z/p\Z$,
  but has $\nu(\GG)=0$.
\end{s-example}


To prove Theorems~\ref{thm:et-extensions} and \ref{thm:f_X=2}, we will
use an approach via coordinates, so we begin with some preliminaries
on $\Fp[G]$-modules.

Let $S=\Fp[G]\cong\Fp[\delta]/(\delta^p)$, and for $i=1,\dots,p$, let
$W_i=S/(\delta^i)$ be the $i$-dimensional indecomposable module over
$S$.  Write $a\mapsto\overline a$ for the natural reduction
homomorphism $S\to k$ (the quotient modulo $\delta$).  We have natural
identifications
$\Hom_S(W_p,W_p)\cong S$,
$\Hom_S(W_p,W_1)\cong \Fp$,
$\Hom_S(W_1,W_p)\cong \Fp$,
$\Hom_S(W_1,W_1)\cong \Fp$.
Under these identifications, the maps
\[\Hom_S(W_p,W_p)\to\Hom_S(W_p[\delta],W_p[\delta])=\Hom_S(W_1,W_1)\]
and
\[\Hom_S(W_p,W_p)\to\Hom_S(W_p/\delta,W_p/\delta)=\Hom_S(W_1,W_1)\]
are both the reduction map $S\to k$.  The restriction map
\[\Hom_S(W_p,W_1)\to \Hom_S(W_p[\delta],W_1)=\Hom_S(W_1,W_1)\]
is zero, as is the reduction map
\[\Hom_S(W_1,W_p)\to \Hom_S(W_1,W_p/\delta)=\Hom_S(W_1,W_1).\]
% Finally, the composition map
% \[\Hom_S(W_p,W_1)\times \Hom_S(W_1,W_p)\to \Hom_S(W_1,W_1)\qquad
%   (\alpha,\beta)\mapsto \alpha\circ\beta\]
% is zero, whereas the composition map
% \[\Hom_S(W_1,W_p)\times \Hom_S(W_p,W_1)\to \Hom_S(W_p,W_p)\qquad
%   (\beta,\alpha)\mapsto \beta\circ\alpha\]
% is the usual multiplication in $\Fp$ composed with the map $\Fp\to S$
% which sends 1 to $\delta^{p-1}$.  (There are other composition maps to
% identify, but they are straightforward and left to the reader.)

Now let $\VV_X$ and $\VV_Y$ be the representations of
$\gal(\kbar/k)$ associated to $J_X[p]_\et$ and
$J_Y[p]_\et$:
\[\VV_X=J_X[p]_\et(\kbar)\and \VV_Y=J_Y[p]_\et(\kbar).\]
By part (2) of Proposition~\ref{prop:H^1(Y)}, we have a
(non-canonical) isomorphism of $S$-modules
\[\VV_Y\cong W_1\oplus W_p^{f_X-1}.\]
Choosing such an isomorphism, we may represent the action of
$\phi\in\gal(\kbar/k)$ by a matrix of the form
\begin{equation}\label{eq:phi-matrix}
\left(
    \begin{array}{c|c}
      a_0&\alpha_1\,\cdots\,\alpha_r\\
      \hline
      \beta_1&\\
      \vdots&A=(a_{ij})\\
      \beta_r&
    \end{array}
  \right),  
\end{equation}
where $r=f_X-1$, $a_0\in\Hom_S(W_1,W_1)$,
$\alpha_j\in\Hom_S(W_p,W_1)$, $\beta_i\in\Hom_S(W_1,W_p)$,
$a_{ij}\in \Hom_S(W_p,W_p)$, and $i$ and $j$ run from 1 to $r$.

Using the observations above on $S$-homomorphisms, we find that the
induced action of $\phi$ on $\VV_Y[\delta]\cong \VV_X$ is given by the
matrix
\begin{equation}\label{eq:phi-on-ker}
 \left(
    \begin{array}{c|c}
      a_0&0\,\cdots\,0\\
      \hline
      \beta_1&\\
      \vdots&\overline A=(\overline a_{ij})\\
      \beta_r&
    \end{array}
  \right),
\end{equation}
and the induced action of $\phi$ on $\VV_Y/\delta$ is given by the matrix
\[\left(
    \begin{array}{c|c}
      a_0&\alpha_1\,\cdots\,\alpha_r\\
      \hline
      0&\\
      \vdots&\overline A=(\overline a_{ij})\\
      0&
    \end{array}
  \right).\]
The block triangular structure of the last two displayed matrices
reflects the exact sequences \eqref{eq:GG_Y,et,ker} and
\eqref{eq:GG_Y,et,coker} (i.e., the fact that $\Z/p\Z$ is a quotient
of $\VV_Y[\delta]$ and a sub of $\VV_Y/\delta$), and we find that $a_0=1$.
Moreover, \eqref{eq:GG_Y,et,ker} splits if and only if we may choose
the isomorphism $\VV_Y\cong W_1\oplus W_p^r$ such that the $\beta_i$ all
vanish, and \eqref{eq:GG_Y,et,coker} splits if and only if we may choose
the isomorphism such that the $\alpha_j$ all
vanish.  (This gives an alternate proof of
Proposition~\ref{prop:splitting}.)

\begin{lemma}\label{lemma:1-units}
  Define $U$, the 1-units of $\GL_r(S)$, by the exactness of
  \[0\to U\to \GL_r(S)\to\GL_r(\Fp)\to 0,\]
  where the surjection is $(a_{ij})\mapsto (\overline a_{ij})$.  Then
  the group $U$ has exponent $p$.
\end{lemma}

\begin{proof}
  Write an element of $U$ in the form $I+\Delta M$ where $\Delta$ is
  the diagonal matrix with all diagonal entries equal to $\delta$ and where
  $M\in M_r(S)$.  Since $I$ and $\Delta$ are in the center of the
  characteristic $p$ ring $M_r(S)$, we have
  \[\left(I+\Delta M\right)^p=I+\Delta^pM^p=I.\]
\end{proof}

With these preliminaries, we are ready to prove the two remaining
theorems about $J_Y[p]_\et$.

\begin{proof}[Proof of Theorem~\ref{thm:et-extensions}]
  For part (1), note that if $\phi$ has matrix of the shape
  \eqref{eq:phi-on-ker} with $a_0=1$, then by an inductive argument,
  $\phi^n$ has matrix 
\[\left(
    \begin{array}{c|c}
      1&0\,\cdots\,0\\
      \hline
      n\beta_1&\\
      \vdots&\overline A^n\\
      n\beta_r&
    \end{array}
  \right).
\]
Thus there is a finite Galois extension $k'$ of $k$ with $\gal(k'/k)$
of exponent $p$ such that the representation of $\gal(\kbar/k')$ on
$\VV_X=\VV_Y[\delta]$ has the trivial representation as a direct factor,
i.e., such that the sequences \eqref{eq:GG_X,et} and
\eqref{eq:GG_Y,et,ker} split over $k'$.

For part (2), to say that $J_X[p]_\et$ is completely split is to say
that for every $\phi\in\gal(\kbar/k)$, the matrix of $\phi$ is of
the form \eqref{eq:phi-matrix} with $a_0=1$, $\beta_i=0$ for all $i$,
and $\overline A=I$, i.e., with $A\in U$.  Lemma~\ref{lemma:1-units}
then shows that $\phi^p$ acts trivially on $\VV_Y$.  This shows
that there is a  a finite Galois extension $k'$ of $k$ with $\gal(k'/k)$
of exponent $p$ such that $J_Y[p]_\et$ is completely split over $k'$.

This completes the proof of the theorem.
\end{proof}


\begin{s-example}\label{ex:extension-bounds}
	Table \ref{UnrTable} (in which each base curve $X$ has $f_X=2$) illustrates that
	the degree bounds of Theorems \ref{thm:et-extensions} and \ref{thm:f_X=2} are sharp:
	in the antepenultimate column we have listed the degree $d_1$ of the unique 
	minimal extension $k_1/k$ with the property that $J_X[p]_{\et}$ is completely split
	over $k_1$.  The penultimate column lists the degree $d_2$ of the minimal 
	extension $k_2 / k_1$ over which $J_Y[p]_{\et}$ is completely split.
	When $\nu_X=\nu_Y=1$, the final column gives the positive integer $\mu$
	specified in (1a) of Theorem \ref{thm:f_X=2}; note that all possibilities indeed occur.
	The first three lines of the table provides examples in which the extension $k'$
	guaranteed by (1a) of Theorem  \ref{thm:f_X=2} is as large as possible; in the first line $k''=k$, while
	in the second and third lines $k''$ is the unique degree $p=3$ extension of $k$. 
\end{s-example}

\begin{proof}[Proof of Theorem~\ref{thm:f_X=2}]
  For part (A), if $f_X=1$, then in equation~\eqref{eq:GG_X,et},
  $\GG_X=0$ and $J_X[p]_\et\cong\Z/p\Z$.  It then follows from part
  (1) of Theorem~\ref{thm:G-str-genl-k} that $J_Y[p]_\et\cong\Z/p\Z$.

  Now consider part (B).  The alternatives are mutually exclusive, and
  they exhaust the possibilities, so it will suffice to verify the
  additional claims in each case.  Note that the subgroup
  $\GG_{X,\et}$ defined by exact sequence \eqref{eq:GG_X,et}
  corresponds to a line in $\VV_X$ which is invariant under
  $\gal(\kbar/k)$.  Let $\phi\in\gal(\kbar/k)$ be Frobenius, and let
  $\rho\in\Fp^\times$ be the eigenvalue of $\phi$ on this line.

  (Case (1a)) If $\rho\neq1$, then $p>2$ since $\F_2^\times=\{1\}$.
  Moreover, both \eqref{eq:GG_Y,et,ker} and \eqref{eq:GG_Y,et,coker}
  are split (by taking the kernel or image of a high power of
  $\phi-\rho$).  Thus, we may choose the isomorphism
  $\VV_Y\cong W_1\oplus W_p$ so that $\phi$ has the shape
  \[\left(
    \begin{array}{c|c}
      1&0\\
      \hline
      0&a
    \end{array}
  \right),\]
where $a\in S$ has $\overline a=\rho$.  It is then clear that
$\nu_X=\nu_Y=1$ and we are in case (1a).  The group scheme $\QQ$ in
the statement is the one corresponding to the representation of
$\gal(\kbar/k)$ on $W_p$ with Frobenius acting by $a$.  Since
$\overline a^{p-1}=\rho^{p-1}=1$, over an extension $k'$ of $k$ of
degree dividing $p-1$, $\phi$ acts on $W_p$ via a 1-unit, so has a
non-trivial space of invariants.  This shows that $|\QQ(k')|=p^\mu$
with $1\le \mu\le p$.  Since $a$ is $\rho$ times a 1-unit,
Lemma~\ref{lemma:1-units} shows that
$a^{p}=\rho^p=\rho\in k\subset S$, so that over the extension $k''$ of
degree $p$, $\rho$ acts on $W_p$ by $\rho$, and $\GG\cong(\GG')^p$ for
a rank 1, non-split group scheme $\GG'$.  Finally, $\phi^{p(p-1)}$
acts trivially on $\VV_Y$, so $J_Y[p]_\et$ is completely split over an
extension of degree dividing $p(p-1)$.

(Case (1b), $p>2$, and Case (1), $p=2$)
Next, suppose that $\rho=1$ and \eqref{eq:GG_X,et} is not split.
Then $\GG_X\cong\Z/p\Z$ and $\nu_X=1$.  If $p=2$, this is enough to
conclude that we are in case (1).  
Since $J_X[p]_\et$ is not completely split, $J_Y[p]_\et$ is also not
completely split and $\nu_Y<p+1$. 
The action of $\phi$ is given
by a matrix of the form
  \[\left(
    \begin{array}{c|c}
      1&\alpha\\
      \hline
      \beta&a
    \end{array}
  \right),\]  
where $\beta\neq0$.   If $p>2$, we
consider the matrix of $\phi$ with respect to a suitable $k$-basis
of $W_1\oplus W_p$, namely 1 for $W_1$ and
$\delta^{p-1},\delta^{p-2},\dots,1$ for $W_p$.  Then $\phi$ takes the
form
  \[\left(
    \begin{array}{c|cccc}
      1&0&\dots&0&\alpha\\
      \hline
      \beta&1&*&*&*\\
      0&0&1&*&*\cr
       \vdots&\vdots&\ddots&1&*\cr
       0&0&\dots&0&1                       
    \end{array}
  \right).\]  
It is then visible that $\phi-1$ has rank $<p$, so $\nu_Y>1$.  Thus
we are in case (1b).  For any $p$, an inductive argument shows that
$\phi^n$ has 
matrix
  \[\left(
    \begin{array}{c|c}
      1&n\alpha\\
      \hline
      n\beta&(1+2+\cdots+(n-1))\beta\alpha +a^n
    \end{array}
  \right).\]
Applying Lemma~\ref{lemma:1-units} shows that if $p>2$,
then $J_Y[p]_\et$ is completely split over the extension of $k$ degree
$p$, and if $p=2$, then $J_Y[p]_\et$ is completely split over the
extension of $k$ degree dividing $4$.

(Case (2)) Finally, if $\rho=1$ and \eqref{eq:GG_X,et} splits, then
$\nu_X=2$, $J_X[p]_\et$ splits completely, and we are in case (2) (for
any $p$).  The conclusions there follow from
Theorem~\ref{thm:et-inequalities} and part (2) of
Theorem~\ref{thm:et-extensions}.  We can say a bit more about the
structure of $J_Y[p]_\et$ in this case: By part (1) of
Proposition~\ref{prop:splitting}, there is an exact sequence
\[0\to\Z/p\Z\to J_Y[p]_\et\to\QQ\to0,\]
where $\QQ$ is $G$-free of rank 1.  We have $\nu(\QQ)\ge1$, and both
the extension above and the group scheme $\QQ$ split completely over
an extension of degree dividing $p$.

This completes the proof of Theorem~\ref{thm:f_X=2}.
\end{proof}


\begin{s-example}\label{Example:fXeq2}
Taking into account Theorem \ref{thm:et-inequalities} \eqref{thm:et-inequalities:part2},
which implies that when $k$ is finite and $\nu_X=1$, the splitting of 
\eqref{eq:GG_Y,et,ker} implies that of \eqref{eq:GG_Y,et,coker}, 
we see that Table \ref{UnrTable} exhibits that all possibilities 
specified by Theorem \ref{thm:f_X=2} indeed occur when $p=3$ and $k=\F_3$.


%  > typeloop(3,7,1,2,false,false,2);
%genus is 3

%<Algebraic function field defined over Univariate rational function field over 
%GF(3) by
%Y^2 + 2*X^7 + 2*X^6 + 2*X^4 + 2*X, 1>

%<Algebraic function field defined over Algebraic function field defined over 
%Univariate rational function field over GF(3) by
%Y^2 + 2*X^7 + 2*X^6 + 2*X^4 + 2*X by
%$.1^3 + 2*$.1 + (2*X + 2)*y, 2>


%> typeloop(3,7,1,2,false,true,2); 
%genus is 3

%<Algebraic function field defined over Univariate rational function field over 
%GF(3) by
%Y^2 + 2*X^7 + 2*X^6 + 2*X^4 + 2, 1>

%<Algebraic function field defined over Algebraic function field defined over 
%Univariate rational function field over GF(3) by
%Y^2 + 2*X^7 + 2*X^6 + 2*X^4 + 2 by
%$.1^3 + 2*$.1 + (2*X + 2)*y + 2, 2>


%> typeloop(3,7,1,2,false,true,3);
%genus is 3

%<Algebraic function field defined over Univariate rational function field over 
%GF(3) by
%Y^2 + X^7 + 2*X^6 + 2*X^4 + 2*X, 1>

%<Algebraic function field defined over Algebraic function field defined over 
%Univariate rational function field over GF(3) by
%Y^2 + X^7 + 2*X^6 + 2*X^4 + 2*X by
%$.1^3 + 2*$.1 + (X + 2)*y, 3>


%> typeloop(3,7,1,2,true,false,3);
%genus is 3

%<Algebraic function field defined over Univariate rational function field over 
%GF(3) by
%Y^2 + X^7 + 2*X^6 + 2*X^2 + 2*X, 2>

%<Algebraic function field defined over Algebraic function field defined over 
%Univariate rational function field over GF(3) by
%Y^2 + X^7 + 2*X^6 + 2*X^2 + 2*X by
%$.1^3 + 2*$.1 + (X + 2)*y, 3>


%> typeloop(3,7,1,2,true,true,1); 
%genus is 3

%<Algebraic function field defined over Univariate rational function field over 
%GF(3) by
%Y^2 + 2*X^7 + 2*X^5 + 2*X, 1>

%<Algebraic function field defined over Algebraic function field defined over 
%Univariate rational function field over GF(3) by
%Y^2 + 2*X^7 + 2*X^5 + 2*X by
%$.1^3 + 2*$.1 + (2*X^4 + 2*X^2 + 2*X)*y, 1>


%> typeloop(3,8,1,2,true,true,2);
%genus is 3

%<Algebraic function field defined over Univariate rational function field over 
%GF(3) by
%Y^2 + 2*X^8 + X^6 + 2*X^4 + X^2 + 2, 2>
%<Algebraic function field defined over F by
%$.1^3 + 2*$.1 + (2*X^2 + 1)*y + X^6 + 2*X^2 + 1, 2>


%> typeloop(3,7,1,2,true,true,3);
%genus is 3

%<Algebraic function field defined over Univariate rational function field over 
%GF(3) by
%Y^2 + X^7 + 2*X^6 + 2*X^2 + 2*X, 2>

%<Algebraic function field defined over Algebraic function field defined over 
%Univariate rational function field over GF(3) by
%Y^2 + X^7 + 2*X^6 + 2*X^2 + 2*X by
%$.1^3 + 2*$.1 + (X^4 + 2*X^3 + 2*X + 1)*y, 3>


%> typeloop(3,7,1,2,true,true,4);
%genus is 3

%<Algebraic function field defined over Univariate rational function field over 
%GF(3) by
%Y^2 + X^7 + 2*X^6 + 2*X^2 + 2*X, 2>

%<Algebraic function field defined over Algebraic function field defined over 
%Univariate rational function field over GF(3) by
%Y^2 + X^7 + 2*X^6 + 2*X^2 + 2*X by
%$.1^3 + 2*$.1 + (X^4 + 2*X^3)*y, 4>
\end{s-example}


\subsection{Dependence of $\HH$ and $\NN_Y$ on
  $S$}\label{ss:S-dependence}
The group scheme $\HH$ in Theorem~\ref{thm:k-point} and its
Dieudonn\'e module $\NN_Y$ (analyzed in
Proposition~\ref{prop:H^1(Y,T)}) apparently depend on the choice of a
rational point $S$.  Indeed, the subquotients
$\Ker\left(\res_{T/S}\Z/p\Z\to\Z/p\Z\right)$ and
$\coker\left(\mu_p\to\res_{T/S}\mu_p\right)$ of $\HH$ and their
Dieudonn\'e modules
\[\coker\left(k=H^0(Y,\OO_Y)\to H^0(Y,\OO_T)\right)\and
  \Ker\left(H^0(Y,\Omega^1_Y(T)/\Omega^1_Y) \to
    H^1(Y,\Omega^1_Y)=k\right)\]
visibly depend on whether $S$ splits in $Y$ (and more precisely on the
class of $T=\pi^{-1}(S)$ in $H^1(S,\Z/p\Z)$).

\begin{prop}
  If $k$ is algebraically closed, then the isomorphism class of
  $\NN_Y$ as a $\D_k[G]$-module is independent of the
  choice of the rational point $S$.
\end{prop}

\begin{proof}
  The exact sequences \eqref{eq:NN-dev1} and \eqref{eq:NN-dev2} show
  that the local-local part of $\NN_Y$ is independent of $S$ (without
  any hypothesis on $k$).  If $k$ is algebraically closed, the \'etale
  part of $\NN_Y$ is completely split as a $\D_k$-module (isomorphic to
  $M(\Z/p\Z)^{pf_X}$) and by Proposition~\ref{prop:H^1(Y,T)}, it is
  $G$-free of rank $f_X$, so it is isomorphic to
  \[M(\Z/p\Z)^{f_X}\tensor\Fp[G],\]
  and is thus independent of $S$.  The same follows for the
  multiplicative part by Cartier duality.  Since $\NN_Y$ is the direct
  sum of its \'etale, multiplicative, and local-local parts, this
  establishes the proposition.
\end{proof}


\begin{s-example}\label{NY:Dependence}
  Surprisingly, when $k$ is finite, $\NN_Y$ depends on $S$, even
  when $S$ splits in $Y$.  
%the Dieudonn\'e module $\NN_Y$ of Proposition \ref{prop:H^1(Y,T)}
%appears to depend on the $k$-point $S$ in a rather subtle way. 
To emphasize the subtlety of this dependence on $S$ and its fiber $T:=\pi^{-1}(S)$ in $Y$,
let us write $\NN_Y(T)$ in place of $\NN_Y$. 
Consider the smooth projective genus 5 hyperelliptic curve over $k=\F_3$ given by the affine equation
$$
X:\quad	y^2 + x^{12} + x^{10} -x^9 + x^6 + x^4 -x^2 + x -1 = 0.
$$
This curve has $a$-number 1 and arithmetic $p$-rank $\nu_X=2$,
so in particular has two independent unramified $\Z/3\Z$-covers.
One such cover $Y$ is given by the Artin--Schreier equation $z^3-z=f$
where $f$ is the rational function
\begin{multline*}
f= \frac{x^9 - x^7 - x^6 + x^5 + x^4 + x^3 + x^2 - x + 1}{x^{15}}y  \\
    - \frac{x^{15} + x^{14} - x^{13} + x^{12} + x^{11} - x^{10} + x^9 + x^6 - x^3 +1}{x^{15}}. 
\end{multline*}
The projective curve $X$ has exactly six $k$-rational points $(x,y)$:
$$
	S_1:= (0, -1), S_2:=(0, 1), S_3:=(-1, -1), S_4:=(-1, 1), S_5:=(1, -1), S_6:=(1, 1);
$$
note that the point at infinity on $X$ is of degree 2.
Let $\pi:Y\rightarrow X$ be the covering map and $T_i:=\pi^{-1}S_i$ be the fiber in $Y$ over $S_i$.
Each $T_i$ is gives a $\Z/3\Z$-torsor (for the \'etale topology) over $k$, so gives a class in $H^1_{\et}(\Spec(k),\Z/p\Z)$.
Via the canonical identifications of abelian groups
$$
	H^1_{\et}(\Spec(k),\Z/p\Z) \simeq H^1(\Gal(\overline{k}/k),\Z/p\Z) \simeq k/\wp k =\Z/3\Z
$$
each torsor $T_i$ gives a class $[T_i]\in \Z/3\Z$.  For example, 
$[T_1]=0=[T_3]$ as each of $T_1$ and $T_3$ consist of 3 distinct 
$k$-rational points of $Y$, whereas $[T_i]=\pm 1$ for $i=2,4,5,6$
since for these values of $i$, the fiber $T_i$ is a single degree 3 point on $Y$.

Using {\sc Magma}, we compute the matrix of $V$ acting on the spaces 
%$H^0(\Omega^1_Y)$ and on 
$H^0(\Omega^1_Y(T_i))$ for $i=1,\ldots ,6$.  We also compute the action of the Artin--Schreier automorphism of $Y\rightarrow X$
on the residue field of $T_i$, which determines $[T_i]$, and obtain the following  table:
%We find that the kernel of $V-1$ on $H^0(\Omega^1_Y)$ has dimension 3, and obtain the following table:

\begin{center}
%\begin{table}
\begin{tabular}{r||rrrrrr}
	$i$ & 1 & 2 & 3 & 4 & 5 & 6\\
	\hline
	$[T_i]$ & 0 & 1 & 0 & 1 & -1 & -1 \\
	$\dim \ker (V-1)$ & 4& 3& 4& 3 & 3 & 3\\
		$\dim \ker (V-1)^3$  & 9 & 9 & 8 & 8 & 8 & 8  \\
\end{tabular}
%	\caption{}
%	\label{Table2}
%\end{table}
\end{center}
It follows from this that the four $k[V]$-modules
$H^0(\Omega^1_Y(T_i))=\NN_Y(T_i)[F]$ 
for $1\le i\le 4$ are pairwise non-isomorphic.  For $i=1,3$ we have short
exact sequences of $k[V]$-modules
\begin{equation*}
	\xymatrix{
		0 \ar[r] & {H^0(Y,\Omega^1_Y)} \ar[r] & {H^0(Y,\Omega^1_Y(T_i))} \ar[r] & \left(\displaystyle\frac{k[V]}{(V-1)}\right)^2 \ar[r] & 0
	}
\end{equation*}
while for $i=2,4$ we have short exact sequences
\begin{equation*}
	\xymatrix{
		0 \ar[r] & {H^0(Y,\Omega^1_Y)} \ar[r] & {H^0(Y,\Omega^1_Y(T_i))} \ar[r] & \displaystyle\frac{k[V]}{(V-1)^2} \ar[r] & 0
	}
\end{equation*}
Noting that the kernel of $V-1$ on $H^0(\Omega^1_Y)$ has dimension 3,
our computations show that the above exact sequences are not only {\em non}-split for $1\le i\le 4$, 
but that the two {\em extension} classes of $k[V]$-modules provided by $H^0(\Omega^1_Y(T_i))$
for $i=1,3$ (respectively $i=2,4$) are non-isomorphic!  This is rather surprising, as all four $k[V]$-modules
$H^0(\Omega^1_Y(T_i))$ for $1\le i\le 4$ become isomorphic after a finite extension of the ground field.
We conclude that the $\D_k$ modules $\NN_Y(T_i)$ are non-isomorphic for $1\le i\le 4$.
On the other hand, further computation shows that $\NN_Y(T_4)\simeq \NN_Y(T_5)\simeq \NN_Y(T_6)$
as $\D_k$-modules, which is again somewhat surprising as the torsors $T_4$ and $T_5$
are non-isomorphic, while the torsors $T_1, T_3$ {\em are} isomorphic, as are $T_2,T_4$.
Again, all six Dieudonn\'e modules $\NN_Y(T_i)$ become isomorphic after 
a suitable finite extension on $k$.

%\begin{rem}
%	Computations show that one has isomorphisms of $k[V]$-modules
%	\begin{equation*}
%		H^0(X,\Omega^1_X) \simeq \displaystyle\frac{k[V]}{(V-1)}\oplus \displaystyle\frac{k[V]}{V(V-1)^3}\quad \text{and}\quad 
%		H^0(Y,\Omega^1_Y) \simeq \displaystyle\frac{k[V]}{(V-1)}\oplus \displaystyle\frac{k[V]}{V(V-1)^3} \oplus \displaystyle\frac{k[V]}{V^2(V-1)^6}
%	\end{equation*}
%	In particular, while $X$ has $p$-rank 2 over $k$, it has geometric $p$-rank 4.
%	Similarly, $Y$ has $p$-rank $3$ over $k$ and geometric $p$-rank $10$ (as it must, by the Deuring--Shafarevich formula).
%	\bry{Is it useful to see the invariant factors for $H^0(\Omega^1_Y(T_i))$ as well?}
%	
%	Note that the hyperelliptic involution on $X$ swaps the points $S_1$ and $S_2$, as it does $S_3$ and $S_4$.
%	\bry{
%		According to Magma, an independent $\Z/3\Z$-cover is $z^3-z=f'$ where
%		$$
%		f'=  \frac{x^9 + x^8 - x^7 - x^4 + x^2 - x + 1}{x^{15}}y - \frac{x^{15} - x^{14} -x^{13} -x^{11} -x^{10} + x^9 + x^6 + x^3 + 1}{x^{15}}
%		$$
%		This cover is not a twist of the first one.  In this cover, the splitting behavior of the points 
%		$S_i$ is the mirror image: $T_i$ splits for $i=2,4$ and is inert for $i=1,3$.  Is there anything
%		about this other cover that might be interesting to include in this example? 
%	}
%	
%\end{rem}

\end{s-example}


% Other thoughts: Thinking of $S$ as a parameter, can we globalize and
% get a group scheme over $X$ whose fiber over $S\in X$ is the $\HH$
% associated to $S$?  (Globalize Prop 7.7(3) to get some vector bundle
% (possibly with connection, i.e., a local system) on $X$ and then apply
% some global Dieudonn\'e functor ... which maybe exists in a mild,
% \'etale setting like this?)  Supposing we can do this, we'd have an
% extension of group schemes over $X$:
% \begin{multline*}
% 0\to J_Y[p]_\et\times_k X \to \text{global version of $\HH_\et$} \to\\
%   \text{global version of the group with module }H^0(\OO_T)/k\to 0  
% \end{multline*}
% The left side is constant and the right side should only depend on the
% class of $T$, so perhaps the
% extension is a further invariant.




\section {Applications to $J_Y[p]$: The local-local
  part}\label{s:apps-ll}
In this section, we consider $J_Y[p]_{ll}$ and its Dieudonn\'e module
$H^1_{dR}(Y)_{ll}$  Throughout, we assume $k=\kbar$.
We view the local-local part of $H^1_{dR}(X)$ as
given, and we exploit the $G$-module structure on $H^1_{dR}(Y)_{ll}$ to
find restrictions on its structure as a $\D_k$-module.  We begin by
recording the basic properties of $H^1_{dR}(Y)_{ll}$.

\begin{prop}\label{prop:M-props}
  Write $M$ for $H^1_{dR}(Y)_{ll}$ and let $h=g_X-f_X$.  We have
  \[M[\delta]\cong M/\delta\cong H^1_{dR}(X)_{ll}.\]
  Moreover, $M$ has the following properties:
\begin{enumerate} 
\item $M$ is a free $k[G]$-module of rank $2h$.
\item $M$ is a self-dual, local-local $BT_1$ module, i.e.,
  $\im F=\Ker V$, $\im V=\Ker F$, $F$ and $V$ act nilpotently on $M$,
  and $M$ admits a perfect $k$-bilinear pairing $\<\cdot,\cdot\>$
  which is alternating \textup{(}$\< m,m\>=0$ for all
  $m\in M$\textup{)} and which satisfies $\< Fm,n\>=\< m,Vn\>^p$ for
  all $m,n\in M$.
\item The pairing is compatible with the $G$ action in that
  $\< gm,gn\>=\< m,n\>$ for all $m,n\in M$.
\item $\im F=\Ker V$ and $\im V=\Ker F$ are free submodules of $M$ of rank $h$.
\end{enumerate}
\end{prop}

\begin{proof}
  Proposition~\ref{prop:H^1(Y)} shows that $M[\delta]\cong
  M/\delta\cong  H^1_{dR}(X)_{ll}$.
  Part~(1) was proven in Proposition~\ref{prop:H^1(Y)} part (2).  For
  part~(2), as we reviewed at the beginning of Section~\ref{s:H1dR},
  $H^1_{dR}(Y)$ is a self-dual $BT_1$ module where the duality is
  induced by the de Rham pairing, and it is easy to see that the
  restriction of this pairing makes $M$ into a self-dual $BT_1$
  module.  It is local-local by definition.  Part~(3) holds because
  $g$ is an automorphism of $Y$, so has degree 1.  For part~(4), note
  that $VM=H^0(Y,\Omega^1_Y)_{ll}$, and comparing the result of Tamagawa
  (equation~\eqref{eq:Tamagawa}) to that of Nakajima
  (equation~\eqref{eq:Nakajima}) shows that $VM$ is free over $k[G]$ of
  rank $h$.  The same then follows for
  $\im F=\Ker V$ since $VM\cong M/(\Ker V)$.
\end{proof}


\begin{rem}
  For a module $M$ with properties (1--3), the spaces $\im F=\Ker V$
  and $\im V=\Ker F$ are all free over $k[G]$ of rank $h$ as soon as
  one of them is.  Furthermore, in this situation the calculations
  \[\< Fm,Fn\>=\< m,VFn\>^p=0
    \and  \< Vm,Vn\>=\< m,FVn\>^{1/p}=0\]
 show that $\im F$ and $\im V$ are isotropic, and they are maximal
 isotropic since they have dimension $ph=\frac12\dim M$.
\end{rem}


\subsection{Coordinates}
We will introduce special coordinates on any $\D_k[G]$-module $M$ with
properties (1--4) as in Proposition~\ref{prop:M-props}.  This allows
for numerical experimentation and will lead to a full analysis in a
significant case.

Write $R$ for the group ring $k[G]$ and introduce a $k$-linear
involution $a\mapsto \tilde a$ by requiring that $\tilde g= g^{-1}$
for all $g\in G$.
This involution is trivial if $p=2$ and is non-trivial with invariant
subspace of dimension $(p+1)/2$ if $p>2$.  We extend it to vectors and
matrices with entries in $R$ by acting componentwise.

Recall that $\gamma\in G$ is the element corresponding to 1 under
$G\cong\Z/p\Z$. 
For $a=a_0+a_1\gamma+\cdots+a_{p-1}\gamma^{p-1}\in R$, define
\[(a)_0 := a_0.\]
Next, note that the function $R\times R\to k$ given by
\[ (a,b):=(a\tilde b)_0\] is $k$-bilinear and satisfies
$(\gamma a,\gamma b)=(a,b)$.  Let $J$ be the $2h$-by-$2h$ matrix
\[J=\begin{pmatrix}0_h&I_h\\-I_h&0_h\end{pmatrix},\]
  where $0_h$ and $I_h$ are the $h\times h$ zero and identity matrices
  respectively.    Regarding $R^{2h}$  as a space of column vectors,
  we have a perfect, alternating, $k$-bilinear pairing on $R^{2h}$ given by
  \[ \< m,n\> = \left(\t m J\tilde n\right)_0.\]
  Here, $\t m$ stands for the transpose of $m$ and $\tilde n$ is
  computed by applying the involution $a\mapsto\tilde a$ to each entry
  of $n$.  If $G$ acts coordinatewise on elements of $R^{2h}$, then
  $\< \gamma m,\gamma n\>=\< m,n\>$.

  If $M$ is a $\D_k[G]$-module which is free over $R$ of rank $2h$,
  and if $m_1,\dots,m_{2h}$ is an ordered basis of $M$, we write $[m]$
  for the coordinate vector of $m$:
  \[[m]=\begin{pmatrix}r_1\\\vdots\\r_{2h}\end{pmatrix}
    \quad\text{if}\quad m=r_1m_1+\cdots+r_{2h}m_{2h}.\]
  Since $F$ acts $R$-semilinearly (i.e., $F(am)=a^{(p)}Fm$ for
  $a\in R$ and $m\in M$), we may represent $F$ by a $2h$-by-$2h$
  matrix $\FF$ with entries in $R$, namely, the matrix such that
\[\left[Fm\right]=\FF[m]^{(p)}\]
where the right hand side is the matrix product of $\FF$ and
$[m]^{(p)}$.

We say that a $\D_k$-module $N$ of dimension $2h$ over $k$ is
\emph{superspecial} if it is isomorphic to $E[p]^h$ where $E$ is a
supersingular elliptic curve.  Three equivalent characterizations are:
(i) $F^2=V^2=0$ on $N$; (ii) in the Kraft--Oort classification, $N$
corresponds to the word $fv$ repeated $h$ times; and (iii) In the
Ekedahl--Oort classification, $N$ corresponds to the elementary
sequence $[0,0,\dots,0]$.
  
\begin{prop}\label{prop:coords}
  Suppose that $M$ is a $\D_k[G]$-module with properties
  \textup{(}1--4\textup{)} as in Proposition~\ref{prop:M-props}.
  \begin{enumerate}
  \item There exists an ordered basis $m_1,\dots,m_{2h}$ of $M$ such
    that the pairing $\<\cdot,\cdot\>$ is given by
\[\< m,n\>=\left(\t[m]J\widetilde{[n]}\right)_0,\]
and such that the matrix of $F$ has the form
\[\FF=\begin{pmatrix}0&B\\0&D\end{pmatrix}\]
where $B$ and $D$ are $h$-by-$h$ matrices with coordinates in $R$
satisfying $\t\tilde DB=\t\tilde BD$ and the columns of $\FF$ generate
a free $R$-module of rank $h$.
\item Conversely, any choice of $B$ and $D$ satisfying
  $\t\tilde DB=\t\tilde BD$ and such that the columns of
  $\FF=\begin{pmatrix}0&B\\0&D\end{pmatrix}$ generate a free
  $R$-module of rank $h$ and $\FF$ is $p$-nilpotent\footnote{We say
    $\FF$ is ``$p$-nilpotent'' if $\FF\FF^{(p)}\cdots\FF^{(p^a)}=0$
    for some $a>0$.} defines the structure of $\D_k[G]$-module on
  $R^{2h}$ which satisfies properties \textup{(}1--4\textup{)} of
  Proposition~\ref{prop:M-props}.
\item If $M/\delta M$ is superspecial, then we may choose the basis so
  that the matrix of $F$ has the form
\[\FF=\begin{pmatrix}0&I\\0&D\end{pmatrix}\]
where $\delta$ divides $D$ \textup{(}i.e., $\delta$ divides every
entry of $D$\textup{) }and $\t\tilde D=D$.
\item Conversely, any choice of $D$ which is divisible by $\delta$ and
  which satisfies $\t\tilde D=D$ defines the structure of
  $\D_k[G]$-module on $R^{2h}$ which satisfies properties
  \textup{(}1--4\textup{)} of Proposition~\ref{prop:M-props} and which
  is superspecial modulo $\delta$.
  \end{enumerate}
\end{prop}

\begin{rems}\mbox{}
  \begin{enumerate}
  \item In parts (1) and (3), we do not claim that $B$ and $D$ are
    uniquely determined by $M$. 
    \item In parts (2) and (4), the action of $V$ is determined by that
      of $F$ and the pairing by the requirement that $\<Fm,n\>=\< m,Vn\>^p$.
  \end{enumerate}
\end{rems}

\begin{proof}
  By hypothesis, $\Ker F$ is free of rank $h$ over $R$ and isotropic
  for the pairing.  Choose an $R$-basis $m_1,\dots,m_h$ for $\Ker F$.
  Since the pairing is non-degenerate, we may choose elements
  $n_1,\dots,n_h$ of $M$ such that for $0\le i<p$ and $1\le j,\ell\le
  h$ we have
  \[\<\gamma^im_j,n_\ell\>=\begin{cases}1&\text{if $i=0$ and $j=\ell$,}\\
      0&\text{otherwise.}
    \end{cases}\]
  Since
  $\<\gamma^im_j,\gamma^{i'}n_\ell\>=\<\gamma^{i-i'}m_j,n_\ell\>$, we
  find that $n_1,\dots,n_h$ generate a free $R$-module of rank $h$
  which is complementary to $\Ker F$ and in $k$-duality with $\Ker F$
  via the pairing.  We then inductively modify the $n_j$ by elements
  of $\Ker F$ to make their $R$-span isotropic.  More precisely, set
  $m_{h+1}=n_1$, choose $m_{12}\in \Ker F$ such that
  $\<m_{h+1},m_{12}\>=\<m_{h+1},m_{12}\>$ and set
  $m_{h+2}=n_2-m_{12}$, etc.  Then for $1\le i,j\le h$ we have
\[\<m_i,m_j\>=\<m_{h+i},m_{h+j}\>=0\and
  \<m_i,m_{h+j}\>=\begin{cases}1&\text{if $i=j$,}\\
    0&\text{otherwise},
  \end{cases}\]
The pairing $\<\cdot,\cdot\>$ then has the desired form with respect
to the basis $m_1,\dots,m_{2h}$.

Since the first $h$ basis elements span the kernel of $F$, the matrix
of $F$ has the form 
\[\FF=\begin{pmatrix}0&B\\0&D\end{pmatrix}\]
where $B$ and $D$ are $h$-by-$h$ matrices with coordinates in $R${}.
Since $\im F$ is $R$-free of rank $h$, the columns of $\FF$ generate a
free $R$-module of rank $h$.  Let $\VV$ be the matrix of $V$ with
respect to the chosen basis.  The compatibility $\<Fm,n\>=\<m,Vn\>^p$
implies that $\t\FF J=J\tilde\VV^{(p)}$, so
\[\VV=\begin{pmatrix}\t\tilde D^{(1/p)}&-\t\tilde B^{(1/p)}\\
    0&0\end{pmatrix},\]
and $VF=0$ implies $\VV\FF^{(1/p)}=0$ which in turn implies $\t\tilde
DB=\t\tilde BD$.  This completes the proof of part~(1).

For part~(2), given $B$ and $D$ satisfying the conditions, define a
$p$-linear operator $F$ and a $p^{-1}$-linear operator $\VV$ on
$R^{2h}$ by setting 
\[Fm=\FF m^{(p)}\and Vm=\VV m^{(1/p)}\]
where
\[\FF=\begin{pmatrix}0&B\\0&D\end{pmatrix}\and
  \VV=\begin{pmatrix}\t\tilde D^{(1/p)}&-\t\tilde B^{(1/p)}\\
    0&0\end{pmatrix}.\]
Then $\im F=\Ker V$ and $\im V=\Ker F$, so we obtain a $BT_1$-module
with a perfect alternating pairing, and it is straightforward to check
that it has the properties (1--4) enumerated in
Proposition~\ref{prop:M-props}.  This completes the proof of part~(2)

For part~(3), first choose a basis as in part~(1).  Since $M/\delta M$
is superspecial, the matrix $D$ is divisible by $\delta$, and the
condition that the columns of $\FF$ span a free $R$-module of rank $h$
implies that $B$ is invertible.

Now consider changes of coordinates that preserve the matrix of
the pairing.  These are precisely the matrices $S\in GL_{2h}(R)$
satisfying $\t SJ\tilde S=J$.  In particular, we may take $S$ of the
form 
\[S=\begin{pmatrix}T&0\\0&U\end{pmatrix}\]
where $T,U\in\GL_h(R)$ and $\t T\tilde U=I$.  
in terms of the new basis, the matrix of $F$ is
\[S^{-1}\FF S^{(p)}=\begin{pmatrix}0&T^{-1}BU^{(p)}\\
    0&U^{-1}DU^{(p)}\end{pmatrix}
=\begin{pmatrix}0&\t\tilde U BU^{(p)}\\
    0&U^{-1}DU^{(p)}\end{pmatrix}.\]
By the Lang--Steinberg theorem \cite[Thm.~10.1]{SteinbergELAG} (applied
to the endomorphism $U\mapsto
\left(\t\tilde U^{-1}\right)^{(p)}$ of $\GL_h(R)$), we may choose
$U$ so that $\t\tilde U BU^{(p)}=I$.  In these new
coordinates, $\FF$ has the desired form, and this proves part~(3).

Part~(4) follows from the same argument as in part~(2) and the observation
that $\FF$ is $p$-nilpotent as soon as $\delta$ divides $D$.
\end{proof}

The coordinates of Proposition~\ref{prop:coords} can be used to
analyze the  special case where $h=1$. Recall that the
$a$-number of a $\D_k$-module is $a=\dim_k\left(\Ker F\cap\Ker
  V\right)$. 

\begin{thm}\label{thm:h=1}
  Assume $p>2$ and let $M$ be a $\D_k[G]$-module satisfying the
  properties \textup{(1--4)} of Proposition~\ref{prop:M-props} with
  $h=1$.
 %If  $p=2$, then the $a$-number of $M$ is either 1 or 2.  If $p>2$, then
  The $a$-number of $M$ is in $\{2,4,\dots,p-1,p\}$.  Define integers
  $\ell$ and $b$ by $0\le b<a$ and $p=\ell a+b$.  Then $M$ can be presented
  as the $\D_k$-module with generators $e_1,\dots,e_a$ and relations
  \[F^{\ell+1}e_i=V^{\ell+1}e_i\quad\text{for $1\le i\le b$}\and
  F^{\ell}e_i=V^{\ell}e_i\quad\text{for $b< i\le a$}.\]
\end{thm}

We give other descriptions of $M$ in the proof below.

\begin{proof}
  Since $M/\delta M$ is 2-dimensional over $k$ and local-local, it is
  superspecial.  We apply part~(3) of Proposition~\ref{prop:coords} to
  identify $M$ with $R^2$ where $F$ acts via a matrix of the form
  $\begin{pmatrix}0&1\\0&D\end{pmatrix}$ with $D\in R$ satisfying
  $\tilde D=D$, and $V$ acts via
  $\begin{pmatrix}D^{(1/p)}&-1\\0&0\end{pmatrix}$.

   We will use the Kraft--Oort and Ekedahl--Oort classifications of
  $\D_k$-modules to analyze $M$.  (See \cite{Oort01} for the original
  analysis and \cite{PriesUlmer21} for a more leisurely and detailed
  exposition.)  First, we construct the canonical filtration on $R^2$,
  and then we check that under the Ekedahl--Oort classification, $M$
  has elementary sequence $[0,\dots,0,1,2,\dots,p-a]$ (of length $p$
  with $a$ zeroes), or equivalently under the Kraft--Oort
  classification, it corresponds to the words $f^{\ell+1}v^{\ell+1}$ with
  multiplicity $b$ and $f^\ell V^\ell$ with multiplicity $a-b$.
  
  We first treat the edge case $D=0$. If $D=0$,
  then one easily checks that the canonical filtration on $M$ has the
  form
  \[0=M_0\subset M_1=R\begin{pmatrix}1\\0\end{pmatrix}\subset M_2=M,\]
  with $FM=M_1$ and $FM_1=0$.  Thus $M$ has elementary sequence
  $[0,\dots,0]$, and $a$ number $p$.  In the Kraft--Oort
  classification, this corresponds to the word $fv$ with multiplicity
  $p$.

% If $p=2$ and $D\neq0$, then $D$ is a unit of $R$ times $\delta$.  One
% checks that the canonical filtration on $M$ has the form
% \[0=M_0\subset M_1=R\begin{pmatrix}\delta\\0\end{pmatrix}\subset
%   M_2=R\begin{pmatrix}1\\D\end{pmatrix}\subset M_3=
%   R\begin{pmatrix}1\\D\end{pmatrix}+R\begin{pmatrix}0\\ \delta\end{pmatrix}
%   \subset M_4=M.\]
% We have $FM_1=0$, $FM_2=FM_3=M_1$, and $FM=M_2$.  The corresponding
% elementary sequence is $[0,1]$ and $M$ has $a$-number $1$.  In the
% Kraft--Oort classification, this corresponds to the word $f^2v^2$ with
% multiplicity $1$.

Now assume that $D\neq 0$.  Then $D$ has the form 
$\delta^au$ where $0<a<p$ and $u\in R^\times$.  Moreover, 
$a$ must be even since $\tilde\delta=-\delta/(1+\delta)$.  (Here we
use $p>2$.)  Writing
$p=\ell a+b$ with $b<a$, we have that $b\neq0$.
Define submodules $M_j\subset M=R^2$ for $0\le j\le 4\ell+2$ by
  \begin{align*}
    M_{2i}&=R\delta^{b+a(\ell-i)}\begin{pmatrix}1\\D\end{pmatrix}
         &\text{for $0\le i\le \ell$}\\
    M_{1+2i}&=R\delta^{a(\ell-i)}\begin{pmatrix}1\\D\end{pmatrix}
         &\text{for $0\le i\le \ell$}\\
    M_{2\ell+1+2i}&=R\begin{pmatrix}1\\D\end{pmatrix}
                               +R\delta^{(p-ia)}\begin{pmatrix}0\\1\end{pmatrix}
         &\text{for $0\le i\le \ell$}\\
    M_{2\ell+2+2i}&=R\begin{pmatrix}1\\D\end{pmatrix}
                               +R\delta^{(p-b-ia)}\begin{pmatrix}0\\1\end{pmatrix}
         &\text{for $0\le i\le \ell$}\\
  \end{align*}
  Then we have
  \[0=M_0\subset M_1\subset\cdots\subset M_{2\ell+1}=FM\subset
    M_{2\ell+2}\subset\cdots\subset M_{4\ell+2}=M.\]

  Next, one checks that
  \[FM_j=\begin{cases}
      M_0&\text{if $0\le j\le 2$,}\\
      M_{j-2}&\text{if $2\le j\le 2\ell+1$,}\\
      M_{2\ell-1}&\text{if $2\ell+1\le j\le 4\ell$,}\\
      M_{2\ell}&\text{if $j=4\ell+1$,}\\
      M_{2\ell+1}&\text{if $j=4\ell+2$,}
    \end{cases}\]
  and
  \[V^{-1}M_j=\begin{cases}
      M_{2\ell+1}&\text{if $j=0$,}\\
      M_{2\ell+2}&\text{if $j=1$,}\\
      M_{2\ell+3}&\text{if $2\le j\le 2\ell+1$,}\\
      M_{j+2}&\text{if $2k+1\le j\le 4\ell$,}\\
      M_{4\ell+2}&\text{if $4k\le j\le 4\ell+2$.}
    \end{cases}\]
  This shows that the $M_j$ give the canonical filtration of $M$, and
  that the corresponding elementary sequence is
  $[0,\dots,0,1,\dots,p-a]$.  Thus the $a$-number of $M$ is $a$.  For
  the classification by words, we note that the cycles corresponding
  to the filtration are
  \[0\labeledlongto{V^{-1}}2\ell+1\labeledlongto{V^{-1}}2\ell+3
    \labeledlongto{V^{-1}}\cdots 
    \labeledlongto{V^{-1}}4\ell+1\labeledlongto{F}2\ell\labeledlongto{F}2\ell-2
    \labeledlongto{F}\cdots
   \labeledlongto{F}2\labeledlongto{F}0\]
 (yielding the word $f^{\ell+1}v^{\ell+1}$) with multiplicity $b=\dim_k(M_1/M_0)$ and
 \[1\labeledlongto{V^{-1}}2\ell+2\labeledlongto{V^{-1}}2\ell+4
   \labeledlongto{V^{-1}}\cdots
   \labeledlongto{V^{-1}}4\ell\labeledlongto{F}2\ell-1
   \labeledlongto{F}2\ell-3\labeledlongto{F}\cdots
   \labeledlongto{F}3\labeledlongto{F}1\]
 (yielding the word $f^{\ell}v^{\ell}$)  with multiplicity $a-b=\dim_k(M_2/M_1)$.

 The presentation by generators and relations then follows from
 \cite[Lemma~3.1]{PriesUlmer21}.  This completes the proof of the
 theorem.
  \end{proof}

We can now give a significant application to Artin--Schreier covers:

\begin{cor}\label{cor:h=1}
  Suppose that $p>2$, $\pi:Y\to X$ and $G=\gal(Y/X)\cong\Z/p\Z$ are as usual
  and that $f_X=g_X-1$.
%  If $p=2$, then the $a$-number of $J_Y[p]$ is
%  either 1 or 2, and if $p>2$,
  Then the $a$-number of $J_Y$ is in
  $\{2,4,\dots,p-1,p\}$.  Moreover, the Dieudonn\'e module of $J_Y[p]$
  has the form
  \[  L\oplus (L\tensor k[G])^{f_X-1}\oplus M_a\]
  where $L=M(\Z/p\Z\oplus\mu_p)$ and $M_a$ is the module described in
  Theorem~\ref{thm:h=1}.
\end{cor}

\begin{proof}
  Since $k$ is algebraically closed, $H^1_{dR}(Y)_\et$ is completely
  split, and part~(2) of Proposition~\ref{prop:H^1(Y)} gives its
  $G$-module structure.  In all we have an isomorphism of
  $\D_k[G]$-modules 
  \[H^1_{dR}(Y)_\et\cong M(\Z/p\Z)\oplus\left(M(\Z/p\Z)\tensor_k
      k[G]\right)^{f_X-1}.\]
  Similarly,
  \[H^1_{dR}(Y)_m\cong M(\mu_p)\oplus\left(M(\mu_p)\tensor_k
      k[G]\right)^{f_X-1}.\]
  Since $H^1_{dR}(Y)_{ll}=M$ has the properties enumerated in
  Proposition~\ref{prop:M-props}, it is isomorphic to the
  $\D_k[G]$-module $M_a$ described in Theorem~\ref{thm:h=1}.  This
  completes the proof of the Corollary.
\end{proof}

\begin{s-example}
Let $p=5$ and $k=\F_p$.  The table below illustrates that all
possibilities listed in Corollary \ref{cor:h=1} 
occur, with $X$ hyperelliptic of degree $7$ and genus $g_X=3$.
Each base curve $X$ has $f_X=2=g_X-1$, and $\nu_X=1$ so the specified
cover $Y\rightarrow X$ 
is the unique unramified $\Z/p\Z$-cover defined over $k$.
\begin{center}
\begin{tabular}{c|c|c|}
	$X: y^2 =  $ &  $Y: z^3-z = $ & $a_Y$ \\
	\hline 
	$x^7 - x^5 - 2x^3 - 2x^2 + x - 1$  & $(-2x^4 - x^2 + 1)y + 2$ & 2 \\
	$-x^7 - x^6 - x^5 + x^4 + x^2 - 2x$  &  $(-x^4 - 2x^3 + 2x^2 + 1)y$ & 4 \\
	$2x^7 - 2x^5 + 2x^4 - x$  & $(-x^9 + 2x^7 - 2x^6 - x^5 + 2x^4 - x + 1)y$ & 5 \\
\end{tabular}
\end{center}

% \bry{Table added above.  For $p=2$, I only see $a_Y=2$
% in examples with plane curves (there can't be examples with hyperelliptic base in char $p=2$ by DS).
% Can we explain this?}

  
%p=5,g=3:
%  <Algebraic function field defined over Algebraic function field defined over
%    Univariate rational function field over GF(5) by
%    Y^2 + 4*X^7 + X^5 + 2*X^3 + 2*X^2 + 4*X + 1 by
%    $.1^5 + 4*$.1 + (2*X^4 + X^2 + 4)*y + 3, 2>,
    
%    <Algebraic function field defined over Algebraic function field defined over
%    Univariate rational function field over GF(5) by
%    Y^2 + X^7 + X^6 + X^5 + 4*X^4 + 4*X^2 + 2*X by
%    $.1^5 + 4*$.1 + (X^4 + 2*X^3 + 3*X^2 + 4)*y, 4>,
    
%      <Algebraic function field defined over Algebraic function field defined over
%    Univariate rational function field over GF(5) by
%    Y^2 + 3*X^7 + 2*X^5 + 3*X^4 + X by
%    $.1^5 + 4*$.1 + (X^9 + 3*X^7 + 2*X^6 + X^5 + 3*X^4 + X + 4)*y, 5>
    
   %%%%%%%%%%%
    
  
\end{s-example}

We now consider more general $\D_k[G]$-modules $M$ with $M/\delta M$
superspecial.

\begin{lemma}
  Let $M$ be a $\D_k[G]$-module with the properties \textup{(1--4)} of
  Proposition~\ref{prop:M-props} and such that $M/\delta M$ is
  superspecial.  Then the Ekedahl--Oort structure \textup{(}elementary
  sequence\textup{)} of $M$ starts with at least $h$ zeroes, i.e., it
  has the form $[0,\dots,0,\psi_{h+1},\dots,\psi_{ph}]$.
\end{lemma}

\begin{proof}
  Let $M[\delta]$ be the kernel of $\delta$ on $M$.  Multiplication by
  $\delta^{p-1}$ induces an isomorphism $M/\delta M\cong M[\delta]$ of
  $\D_k$-modules, so $M[\delta]$ is also superspecial.

  Now consider the canonical filtration of $M$.  Its elements are
  obtained by applying arbitrary words $w$ in $F$ and $V^{-1}$ to $M$.
  For any such word $w$, we have
  \[ w\left(M[\delta]\right)\subset w(M)\cap M[\delta].\]
  (On the left, we are applying $F$ and $V^{-1}$ using the
  $\D_k$-module structure of $M[\delta]$.)  Since $M[\delta]$ is
  superspecial, there are only three possibilities for the left hand
  side in the display, namely $0$, $FM[\delta]$ and $M[\delta]$.

  If $N\subset M$ is any $R$-submodule, $N\cap M[\delta]=0$  implies
  that $N=0$.  Indeed, if $0\neq m\in N$, let $i$ be the smallest
  power of $\delta$ that kills $m$.  Then $0\neq \delta^{i-1}m\in
  M[\delta]$.

  Applied to the submodules $w(M)$, this shows that every non-zero
  element of the canonical filtration of $M$ contains $FM[\delta]$.
  Since $F$ annihilates $FM[\delta]$, which has dimension $h$, we
  conclude that the E--O structure of $M$ starts with at least $h$
  zeroes.
\end{proof}

Note that the lemma reduces the number of possibilities for an E--O
structure on an $M$ of dimension $2ph$ over $k$ from $2^{ph}$ to
$2^{(p-1)h}$, in other words, the $R$-module structure and
superspecial hypothesis impose non-trivial restrictions on $M$.  
It turns out that for $p=2$, the lemma gives the only restrictions.

\begin{thm}\label{thm:p=2+superspecial}
Suppose $p=2$ and let $\Psi=[0,\dots,0,\psi_{h+1},\dots,\psi_{2h}]$ be
an elementary sequence starting with at least $h$ zeroes.  Then there is a
$\D_k[G]$-module $M$ with properties
\textup{(1--4)} of Proposition~\ref{prop:M-props} and with $M/\delta M$
superspecial such that the elementary sequence of $M$ is $\Psi$.
\end{thm}

\begin{proof}
  We will consider the $\D_k$-module $M$ with E--O structure $\Psi$ as
  constructed by Oort in \cite[\S9]{Oort01} and show that $M$ admits a
  $k[G]$-module structure such that it has the properties (1--4) of
  Proposition~\ref{prop:M-props} and $M/\delta M$ is superspecial.

  Extend $\Psi$ to a ``final sequence'' $[\psi_1,\dots,\psi_{4h}]$ by
  setting $\psi_{4h}=2h$ and $\psi_{4h-i}=\psi_i+2h-i$ for $1\le i\le
  2h$.  Let $1\le m_1<m_2<\cdots<m_{2h}\le 4h$ be the indices $i$ such
  that $\psi_{i-1}<\psi_i$ and let $1\le n_{2h}<n_{2h-1}<\cdots
  n_1\le 4h$ be the indices $i$ such that $\psi_{i-1}=\psi_i$.  Our
  hypothesis on $\Psi$ implies that $m_{h+i}=3h+i$ for $1\le i\le h$
  and $n_{2h+1-i}=i$ for $1\le i\le h$.  Moreover, $m_i+n_i=4h+1$ for
  $1\le i\le 2h$.

  Now let $M$ be the $k$-vector space with basis $Z_1,\dots,Z_{4h}$
  and for $1\le i\le 2h$ define $X_i=Z_{m_i}$ and $Y_i=Z_{n_i}$.
  Define a $\D_k$ module structure on $M$ by setting
  \[ F(X_i)=Z_i,\quad F(Y_i)=0,\quad V(Z_i)=0,\and V(Z_{4h+1-i})=Y_i
      \quad\text{for $1\le i\le 2h$}.\]
  Introduce a bilinear pairing $\<\cdot,\cdot\>$ on $M$ by setting
  \[\<X_i,X_j\>=0,\quad\<Y_i,Y_j\>=0,\and\<X_i,Y_j\>=\delta_{ij}
    \quad\text{for $1\le i,j\le 2h$}.\]
  It is then straightforward to check that $M$ is a self-dual, local-local
  $BT_1$ module whose elementary sequence is the given $\Psi$.

  Let $N$ be the subspace of $M$ spanned by $X_i+Y_i$ and $Y_{h+i}$
  for $1\le i\le h$.  Then $N$ is a $\D_k$-submodule and we have
  \[F(N)=V(N)=\text{Span of $Y_{h+i}$ for $1\le i\le h$.}\]
  It follows that $N$ is superspecial.

  The quotient $M/N$ is spanned by the classes of $X_j$ for $1\le j\le
  2h$, and we have
  \[F(M/N)=V(M/N)=\text{Span of the classes of $X_i$ for $1\le i\le
      h$.}\]
  It follows that $M/N$ is also superspecial, so there is an
  isomorphism of $\D_k$-modules $M/N\cong N$.  This isomorphism
  carries $F(M/N)$ isomorphically onto $F(N)$.

  Define $\delta:M\to M$ as the composition
  \[ M\onto M/N\cong N\into M.\] Since each of the constituent maps is
  a $\D_k$-module homomorphism, so is $\delta$, and clearly we have
  $\delta^2=0$, so we have given $M$ the structure of a $k[G]$-module.
  Note that $N$ is isotropic for the pairing, and the induced pairing
  on $M/N$ is also zero.  Therefore, the pairing induces a duality
  between $M/N$ and $N$.  If we choose an isomorphism
  $M/N\cong N$ which is self-adjoint (as we may, since $N$ and
  $M/N$ are self-dual $\D_k$-modules), then $\delta$ will satisfy
  $\<\delta m_1,m_2\>=\<m_1,\delta m_2\>$ which (because $p=2$) in
  turn implies that $\<gm_1,gm_2\>=\<m_1,m_2\>$.

  We have thus established that $M$ enjoys properties (2) and (3) of
  Proposition~\ref{prop:M-props}.   The remaining properties are
  easily checked:  $M$ is free over $k[G]$ with basis
  $\{X_1,\dots,X_{2h}\}$, $\im F$ is free with basis
  \[\left\{Z_{h+i}|1\le i\le h\right\}
    =\left\{X_i\mid h<m_i\le 2h\right\}\cup\left\{Y_i\mid h<n_i\le
      2h\right\},\]
  (each $i\in\{1,\dots,h\}$ appears exactly once on the right hand
  side), and $\im V$ is free with basis $\{Y_1,\dots,Y_h\}$.

 This completes the proof of the Theorem.
\end{proof}

\begin{rems}\mbox{}
  \begin{enumerate}
  \item It does not seem likely that there is a simple formula
    for an endomorphism $\delta$ as in the theorem.
  \item The words corresponding to the E--O structures appearing in
    the theorem can be rather elaborate.  For example, the four
    possibilities when $h=2$ are
    \[\left(f^2v^2\right)^2,\quad \left(f^2v^2\right)\left(fv\right),\quad
      \left(fv\right)^4,\and
      \left(f^2vfv^2fv\right).\]
    The last word is associated to the elementary sequence $[0,0,1,1]$,
    and in the coordinates of Proposition~\ref{prop:coords}, it
    corresponds to the case where $D$ has rank 1 and its column span
    is not rational over $\F_{p^2}$.
%    \note{I tried to find invariants of $D$ to show there are $2^h$
 %     cases, but failed.  There should be $\binom hr$ possibilities
  %    for $D$ of rank $r$.}
  \item Numerical experiments suggest that the naive generalization
    of the theorem to $p>2$ does not hold.  There seem to be far fewer
    cases when $h$ is small with respect to $p$.
%   \item \note{Do numerical experiments suggest that all possibilities
%       occur for curves, i.e., for $H^1_{dR}(Y)_{ll}$ when $p=2$?}
%     \item \note{What's the Weyl group version of the theorem?}
  \end{enumerate}
\end{rems}



\section{Explicit geometry of unramified $\Z/p\Z$
  covers}\label{s:geometry}
In this section, $k$ will be an arbitrary field of characteristic
$p>0$, and $\pi:Y\to X$ will be a Galois cover of geometrically connected,
smooth, proper curves over $k$ with a fixed isomorphism
$\gal(Y/X)\cong\Z/p\Z$.  We consider a presentation of $Y$
as a cover of $X$ which will be useful for explicit calculations in
the next section.

We write $\wp$ for the function $\wp(a)=a^p-a$ and $\wp(k)$ for the
set $\{\wp(a)|a\in k\}$.

\begin{prop}\label{prop:geometry}
  With notation as above, we have:
  \begin{enumerate}
  \item The sheaf $\FF:=\pi_*\OO_Y$ is a locally free sheaf of
    $\OO_X$-algebras of rank $p$ with an action of $\Z/p\Z$.  We may
    recover $Y$ from $\FF$ and $X$ as the global spectrum:
    $Y\cong\underline\Spec_{\OO_X}\FF$.
  \item $\FF$ admits a filtration by $\OO_X$-submodules
    $\fil^i\FF\subset\FF$ with $\fil^i\FF$ of rank $i$ and with graded
    pieces
      \[\fil^i\FF/\fil^{i-1}\FF\cong\OO_X.\]
    \item The $\OO_X$-submodule $\EE:=\fil^2\FF$ of rank 2 determines
      $\FF$ as a locally free $\OO_X$-module:
    \[\FF\cong\sym^{p-1}\EE.\]
    \item The class of $\EE$ in
      \[\ext^1_{\OO_X}(\OO_X,\OO_X)\cong H^1(X,\OO_X)\]
      is fixed by Frobenius.
    \item Conversely, any class in $H^1(X,\OO_X)$ fixed by Frobenius
      arises from a $\Z/p\Z$-cover $Y$ of $X$, and the set of covers
      yielding a given class is a principal homogeneous space for
      $k/\wp(k)$.  In particular, if $k$ is algebraically closed, $Y$
      is determined by the corresponding class in $H^1(X,\OO_X)$.
  \end{enumerate}
\end{prop}

We will prove the proposition in the rest of this section.  Part~(1)
is of course well known since $Y\to X$ is finite and Galois, but we
will give an explicit presentation of $\FF$.

\begin{rems}\label{rems:torsors}\mbox{}
  \begin{enumerate}
  \item   The exact sequence
  \[0\to\Z/p\Z\to\OO_X\labeledto{\wp}\OO_X\to 0\]
  of \'etale sheaves on $X$ yields an exact sequence
  \[0\to k/\wp(k)\to H^1_{\acute et}(X,\Z/pZ)\to H^1(X,\OO_X)[\wp]\to 0.\]
  The data $\pi:Y\to X$ and $\gal(Y/X)\cong \Z/p\Z$ determine a class
  $\eta_X$ in $H^1_{\acute et}(X,\Z/p\Z)$.  The class of $\EE$ in part~(4)
  is the image of $\eta_X$ in $H^1(X,\OO_X)$, and part~(5) is a
  restatement of the exactness of the last displayed sequence.
\item The last displayed exact sequence can also be written
  \[0\to H^1(\spec k,\Z/p\Z)\to H^1_{\acute et}(X,\Z/pZ) \to
    H^1(X,\OO_X)[\wp]\to 0.\] If $X$ has a rational point
  $\spec k\into X$, then this sequence splits by pulling back a cover
  of $X$ to a cover of $\spec k$.  The splitting
  $H^1(X,\OO_X)[\wp]\to H^1_{\et}(X,\Z/p\Z)$ sends a class to the
  unique cover with that class in which the given rational point
  splits completely.  
\item Applying the Dieudonn\'e functor to the inclusion
  $k\eta_X\into H^1_{dR}(X)$ yields a surjection of group schemes
  $J_X[p]\onto\Z/p\Z$.  Suppose that $k$ is finite and that
  $P\in X(k)$ is a rational point over which $\pi:Y\to X$ splits
  completely.  Then by geometric class field theory (see
  \cite[Chap.~VI]{SerreAGCF}), giving a $\Z/p\Z$-cover in which the
  rational point $P$ splits is the same as giving a surjective group
  homomorphism $J_X(k)\onto\Z/p\Z$.  We may construct this
  homomorphism from the surjection $J_X[p]\onto\Z/p\Z$ as follows:
  Form the push-out diagram of group schemes over $k$
  \[\xymatrix{0\ar[r]&J_X[p]\ar[r]\ar[d]&J_X\ar[r]^p\ar[d]&J_X\ar[r]\ar@{=}[d]&0\\
      0\ar[r]&\Z/p\Z\ar[r]&J'\ar[r]&J_X\ar[r]&0.\\
    }\]
  Taking cohomology of the bottom row and using Lang's theorem
  ($H^1(k,J')=0$) yields a surjection
  \[J_X(k)\to H^1(k,\Z/p\Z).\]
  Composing this with the isomorphisms
  \[H^1(k,\Z/p\Z)\cong k/\wp(k)\labeledlongto{\tr}\Z/p\Z\]
  yields the desired surjection $J_X(k)\to\Z/p\Z$.
\end{enumerate}
\end{rems}


\subsection{Artin-Schreier theory}
The field extension $k(Y)/k(X)$ is Galois with group $\Z/p\Z$, so by
Artin-Schreier theory, there are elements $y\in k(Y)$ and $f\in k(X)$
such that $k(Y)=k(X)[y]$, $\wp(y)=f$, and the element $1\in\Z/p\Z$
acts on $y$ by $y\mapsto y+1$.

If $z=y-h$ with $h\in k(X)$, then $\wp(z)=g:=f-\wp(h)$ and the
element $1\in\Z/p\Z$ of the Galois group again acts by $z\mapsto z+1$.

Because $\pi$ is unramified, for any generator $y$ as above and
$f=\wp(y)$, we have that for every place $x$ of $X$,
\[f\in \wp(h) + \OO_{X,x}\]
for some element $h\in k(X)$.  In other words, the principal part of
$f$ at every place of $X$ is of the form $\wp(h)$ for a suitable $h$.

\subsection{Trivializing $\FF$}
The Riemann-Roch theorem (in the form of its corollary ``strong
approximation''), implies that given a non-empty affine open subset
$U\subset X$, we may choose a generator $y$ so that $f=\wp(y)$ is
regular on $U$.  Moreover, if $D$ is a non-special divisor (i.e.,
$H^1(X,\OO_X(D))=0$) supported on $X\setminus U$, we may choose $f$
so that its principal part at any closed point $x$ in the support of $D$
is in $\wp(h)+\OO_{X,x}$ where $h$ has poles no worse than $D$ at $x$.

Let $\{U,V\}$ be a cover of $X$ by affine open subsets, and choose
elements $y$ and $z$ such that $\wp(y)=f$ is regular on $U$ and
$\wp(z)=g$ is regular on $V$.  Let $h=y-z$ and note that $h$ is fixed
by $\Z/p\Z$, so lies in $k(X)$.  We have
\[\FF(U)=\OO_Y(\pi^{-1}(U))\cong \frac{\OO_X(U)[y]}{(\wp(y)-f)}\]
and
\[\FF(V)=\OO_Y(\pi^{-1}(V))\cong \frac{\OO_X(V)[z]}{(\wp(z)-g)}.\]
These presentations show that over $U$, $\FF$ is a free $\OO_X$ module
with basis $\left(1,y,y^2,\dots,y^{p-1}\right)$, and over $V$ it is
free with basis $\left(1,z,z^2,\dots,z^{p-1}\right)$.  Thus $\pi_*\FF$
has the properties asserted in part~(1).

\subsection{Additional structures on $\FF$}
Noting that on $U\cap V$,
$y^i=(z+h)^i=\sum_{j=0}^i\binom ijh^{i-j}z^j$, we see that
%
% not clear whether we're talking about coordiantes or basis elements
% here, so best to omit:
%
% the transition matrix from the $U$ basis to the $V$ basis is lower
% triangular with diagonal entries equal to 1.  This shows that
%
there is a subsheaf of $\FF$ of rank $i$ generated by
$(1,y,\dots,y^i)$ over $U$ and by $(1,z,\dots,z^i)$ over $V$.  This is
the $\fil^i\FF$ in part~(2), and it is clear that the graded pieces
are all trivial $\OO_X$-modules.  We may also recover $\fil^i\FF$ more
invariantly as
\[\fil^i\FF=\ker\left(\delta^i:\FF\to\FF\right)\]
where $\delta=\gamma-1$.  This proves
part~(2). 

It is also clear that $\EE:=\fil^2\FF$ satisfies
$\FF\cong \sym^{p-1}\EE$ as $\OO_X$-modules, i.e., we have part~(3).

The class of $\EE$ (as an extension of $\OO_X$ by $\OO_X$) in
$H^1(X,\OO_X)$ is represented by the alternating Cech cocycle for the
cover $\{U,V\}$ given by $h\in\OO_X(U\cap V)$.  This class is fixed
by Frobenius because $\wp(h)=f-g$ is the difference of a regular
function on $U$ and a regular function on $V$.  This establishes
part~(4).

\subsection{Constructing $Y$ from $\EE$}\label{ss:algebra}
Finally, suppose we have a class in $H^1(X,\OO_X)$ fixed by Frobenius,
and choose a representing cocycle.  This amounts to giving a section
$h\in\OO_X(U\cap V)$ such that there exist regular functions $f$ on
$U$ and $g$ on $V$ with $\wp(h)=f-g$.  \emph{Choose} such functions.
Then using $h$ we construct the locally free $\OO_X$-module $\EE$ of
rank 2 with the given class by gluing the rank 2 trivial modules over
$U$ and $V$ by the transition matrix $\psmat{1&0\\h&1}$ over
$U\cap V$.  Let $\FF=\sym^{p-1}\EE$, so that $\FF$ is a locally free
$\OO_X$-module of rank $p$.  It remains to give $\FF$ the structure of
an $\OO_X$-algebra.  We do this by requiring that
\[y^iy^j=\begin{cases}
    y^{i+j}&\text{if $i+j<p$,}\\
    (y+f)y^{i+j-p}&\text{if $i+j\ge p$}
  \end{cases}\]
over $U$ and
\[z^iz^j=\begin{cases}
    z^{i+j}&\text{if $i+j<p$,}\\
    (z+g)y^{i+j-p}&\text{if $i+j\ge p$}
  \end{cases}\]
over $V$.  These requirements are easily seen to be compatible and give
the desired algebra structure.  Finally, we obtain a cover
$\pi:Y\to X$ by setting $Y=\underline\spec_{\OO_X}\FF$ and letting
$\Z/p\Z$ act via its action on $y$ and $z$.

Note that we chose $f$ and $g$ above to trivialize the class
represented by $\wp(h)$, and the ambiguity in that choice is exactly
an element of $H^0(X,\OO_X)=k$.  Moreover, if we change $f$ to $f+a$
and $g$ to $g+a$ with $a\in k$, the isomorphism class $k(Y)$ (and thus
of $Y$) depends (and depends only) on the class of $a$ in
$k/\wp(k)$.  This completes the proof of part~(5) of the proposition.



\section{Computing the Hasse-Witt triple of $Y$.}\label{s:calcs}
In this section, we explain a method to compute explicitly the de Rham
cohomology of an unramified Artin-Schreier cover over a perfect field
together with its Frobenius and Verschiebung endomorphisms.  We do
this in the form of the ``Hasse-Witt triple'' as in \cite{Moonenpp20}.

\subsection{Hasse-Witt triples}
As defined in \cite{Moonenpp20}, a Hasse-Witt triple consists of a
$g$-dimensional vector space $Q$ over $k$, a $p$-linear endomorphism
$\Phi:Q\to Q$, and a $p$-linear injection $\Psi:\Ker(\Phi)\to Q^\vee$
whose image is the orthogonal complement of $\im(\Phi)$.

Given a self-dual $BT_1$ module $M$ of dimension $2g$ over $k$ with
pairing $\<\cdot,\cdot\>$, we obtain a Hasse-Witt triple by setting
$Q=M/\Ker F$, letting $\Phi$ be the endomorphism of $Q$ induced by $F$
on $M$, and defining $\Psi$ by $\Psi(\tau)=\<\cdot,F\tilde\tau\>$
where $\tilde\tau$ is a lift of $\tau\in Q$ to $M$.  In
\cite[2.5]{Moonenpp20}, Moonen explains how to recover the self-dual
$BT_1$ module $(M,F,V,\<\cdot,\cdot\>)$ from the Hasse-Witt triple
$(Q,\Phi,\Psi)$.

In the case at hand, where $M=H^1_{dR}(Y)$, we see that
$Q=H^1(Y,\OO_Y)$, $Q^\vee=H^0(Y,\Omega^1_Y)$, $\Phi$ is the usual
Frobenius endomorphism of $H^1(Y,\OO_Y)$, and $\Psi$ is obtained as
follows: %\footnote{In fact it will convenient to use a slightly
% different approach in terms of repartitions.}
Suppose $\eta\in H^1(Y,\OO_Y)$ is killed by Frobenius and is
represented by a Cech cocycle $g_{ij}$ for an open cover $\{U_i\}$;
since $F\eta=0$, $g_{ij}^p$ is a coboundary: $g_{ij}^p=f_i-f_j$ with
$f_i\in\OO_Y(U_i)$; then the differentials $df_i$ patch together to
give a global, regular,
% \bry{locally exact?}  I guess this is a matter of definitions.  To
% me, exact means "d of a function" whereas I guess you mean "d of a
% regular function"?  Anyway, no harm in going with the more
% restrictive version here ... the point is that \omega is killed by V.
locally exact one-form $\omega$.  We define
$\Psi(\eta)=\omega$.  Note that $\Psi$ is injective, and its image is
precisely the space of differentials killed by $V$, which is the orthogonal
complement in $H^0(Y,\Omega^1_Y)$ of $FH^1(Y,\OO_Y)$.

\subsection{Computing Frobenius on $H^1(X,\OO_X)$
  (review)}\label{ss:O_X}
Fix an effective, non-special divisor $D$ on $X$.  (The most
``efficient'' choice is to take $D$ of degree $g_X$, but this may not
be possible over a small ground field.)
Thus we have $H^1(X,\OO_X(D))=0$, and the
exact sequence
\[0\to\OO_X\to\OO_X(D)\to\OO_X(D)/\OO_X\to0\]
is an acyclic resolution of $\OO_X$.  Taking cohomology yields an
isomorphism
\[\frac{H^0(X,\OO_X(D)/\OO_X)}{H^0(X,\OO_X(D))}\cong H^1(X,\OO_X).\]

The divisor $pD$ is also non-special, and we find an isomorphism
\[\frac{H^0(X,\OO_X(pD)/\OO_X)}{H^0(X,\OO_X(pD))}\cong
H^1(X,\OO_X).\]
The composed isomorphism
\[\frac{H^0(X,\OO_X(pD)/\OO_X)}{H^0(X,\OO_X(pD))}\cong
\frac{H^0(X,\OO_X(D)/\OO_X)}{H^0(X,\OO_X(D))}\]
can be computed explicitly by taking a meromorphic function $t$ on a
neighborhood of $D$ representing an
element of $H^0(X,\OO_X(pD)/\OO_X)$ and ``correcting'' it by the
principal part of an element of $H^0(X,\OO_X(pD))$ so that it has
poles no worse than $D$, and therefore defines an element of $
H^0(X,\OO_X(D)/\OO_X)$.  The result is well-defined up to an element
of $H^0(X,\OO_X(D))$.

The Frobenius endomorphism
\[F:H^1(X,\OO_X)\to H^1(X,\OO_X)\]
can then be computed as the composition
\begin{multline*}
  \label{eq:1}
H^1(X,\OO_X)\cong \frac{H^0(X,\OO_X(D)/\OO_X)}{H^0(X,\OO_X(D))}\to
\frac{H^0(X,\OO_X(pD)/\OO_X)}{H^0(X,\OO_X(pD))}\\
\cong
  H^0(X,\OO_X(D)/\OO_X)\cong H^1(X,\OO_X)
\end{multline*}
where the second homomorphism is induced by $t\mapsto t^p$.

Summarizing, to compute $F$ on $H^1(X,\OO_X)$, it suffices to know the
principal parts of elements of $H^0(X,\OO_X(pD))$.  It will
transpire later in this section that to compute Frobenius on
$H^1(Y,\OO_Y)$, it will suffice to know the principal parts of elements of
$H^0(X,\OO_X((2p-1)D))$ plus some simple linear algebra.


\subsection{Making $\pi_*\OO_Y$ explicit}\label{ss:FF-explicit}
We make the description of $\FF=\pi_*\OO_Y$ given in the previous
section more explicit.

Let $D$ be an effective, non-special divisor on
$X$.  Let $U=X\setminus D$ and choose an affine open neighborhood $V$ of
$D$.  Then $\{U,V\}$ is a cover of $X$ by affine opens.  Choose
elements $f,g\in k(X)$ with $f$ regular on $U$, $g$ regular on $V$,
such that
\[k(Y)\cong\frac{k(X)[y]}{(\wp(y)-f)}\cong\frac{k(X)[z]}{(\wp(z)-g)}\]
and such that $f-g=\wp(h)$ where at each closed point of $D$, $h$ has
poles no worse than $D$.  

Over $U$, the sections $1,y,\dots,y^{p-1}$ are a basis of $\FF$ as
$\OO_X$-module.  Similarly, over $V$, the sections $1,z,\dots,z^{p-1}$
are a basis.  Over $U\cap V$, we compute a transition matrix $H$ as
follows:
\[\left(\alpha_0,\dots,\alpha_{p-1}\right)\begin{pmatrix}
    1\\y\\\vdots\\y^{p-1}
  \end{pmatrix}
  =\left(\alpha_0,\dots,\alpha_{p-1}\right)\begin{pmatrix}
    1\\z+h\\\vdots\\(z+h)^{p-1}
  \end{pmatrix}
  =\left(\alpha_0,\dots,\alpha_{p-1}\right)H\begin{pmatrix}
    1\\z\\\vdots\\z^{p-1}
  \end{pmatrix}
\]
where
\begin{equation}\label{eq:H}
H=\begin{pmatrix}1&0&0&\dots&0\\
    h&1&0&\dots&0\\
    h^2&2h&1&\dots&0\\
    \vdots&\vdots&\vdots&\ddots&0\\
    h^{p-1}&(p-1)h^{p-2}&\binom{p-1}{2}h^{p-3}&\dots&1
  \end{pmatrix}.  
\end{equation}
Numbering the rows and columns of $H$ from $0$ to $p-1$, the $(i,j)$
entry of $H$ is $\binom ij h^{i-j}$.

Thus, if $W\subset X$ is an open subset, a section of $\FF$ over $W$ is
determined by a tuple of functions
$\left(\alpha_0,\dots,\alpha_{p-1}\right)$ such that each $\alpha_i$
is regular on $U\cap W$ and the tuple
\[\left(\beta_0,\dots,\beta_{p-1}\right):=
  \left(\alpha_0,\dots,\alpha_{p-1}\right)H\]
has each $\beta_i$ regular on $V\cap W$.

The $\OO_X$-module $\FF$ is self-dual.  Indeed, letting $A$ be the $p\times
p$ anti-diagonal matrix with non-zero entries equal to $\pm1$:
\[A=\begin{pmatrix}0&0&\dots&0&1\\
    0&0&\dots&-1&0\\
    \vdots&\vdots&\reflectbox{$\ddots$}&\vdots&\vdots\\
   0&-1&\dots&0&0\\
    1&0&\dots&0&0
  \end{pmatrix},
\]
one computes that ${}^tH^{-1}=AHA^{-1}=AHA$.  The induced pairing
\[\FF\tensor_{\OO_X}\FF\cong\FF\tensor_{\OO_X}\FF^\vee\to\OO_X\]
is determined by 
\[  \<y^i,y^j\>=(-1)^i\delta_{p-1,i+j}\]
and satisfies $\<z^i,z^j\>=(-1)^i\delta_{p-1,i+j}$ as well.

The $\OO_X$-module $\FF$ also carries an action of $\gal(Y/X)$.
Let
\[\gamma=\begin{pmatrix}1&0&0&\dots&0\\
    1&1&0&\dots&0\\
    1&2&1&\dots&0\\
    \vdots&\vdots&\vdots&\ddots&0\\
    1&(p-1)&\binom{p-1}{2}1&\dots&1
  \end{pmatrix}
\]
be the matrix whose $(i,j)$ entry is $\binom ij$ (numbering the rows
and columns from 0 to $p-1$).  Then the element of $\gal(Y/X)$
corresponding to $1\in\Z/p\Z$ acts as
\[\left(\alpha_0,\dots,\alpha_{p-1}\right)\mapsto
  \left(\alpha_0,\dots,\alpha_{p-1}\right)\gamma
  \and
  \left(\beta_0,\dots,\beta_{p-1}\right)\mapsto
  \left(\beta_0,\dots,\beta_{p-1}\right)\gamma.\]
(Note that $g$ and $H$ commute.)





\subsection{Computing $H^1(Y,\OO_Y)$}\label{ss:computing-H1}
We keep the notation of the preceding subsections.  Since $\pi$ is
finite, we have
\[H^1(Y,\OO_Y)\cong H^1(X,\pi_*\OO_Y)=H^1(X,\FF).\]
We compute the latter using an acyclic resolution.

Since the $\OO_X$-module $\FF$ is a repeated extension of copies of
$\OO_X$, an easy inductive argument shows that $H^1(X,\FF(D))=0$ and
$h^0(X,\FF(D))=ph^0(X,\OO_X(D))$.  Thus, the exact sequence
\[0\to\FF\to\FF(D)\to\FF(D)/\FF\to 0\]
is an acyclic resolution of $\FF$, and we have an isomorphism
\[\frac{H^0(X,\FF(D)/\FF)}{H^0(X,\FF(D))}\cong H^1(X,\FF).\]

We make the left hand side more explicit.  The
description of $\FF$ over the neighborhood $V$ of $D$ in the last
section yields an identification
\[H^0(X,\FF(D)/\FF)\cong H^0(X,\OO_X(D)/\OO_X)^p\]
which sends the class of $\left(\beta_0,\dots,\beta_{p-1}\right)$ on the
right to the section
\[\left(\beta_0,\dots,\beta_{p-1}\right)\begin{pmatrix}1\\z\\\vdots\\z^{p-1}
  \end{pmatrix}\]
of $\FF(D)/\FF$.
To obtain $H^1(X,\FF)$, we need to take the quotient by
$H^0(X,\FF(D))$.  The section $s_0:=1\in H^0(X,\FF(D))$ maps to zero in $
H^0(X,\OO_X(D)/\OO_X)^p$, and the section $s_1:=y$ maps to
\[\left(\beta_0,\dots,\beta_{p-1}\right)=
  (h,1,0,\dots,0)=(h,0,\dots,0).\]
Other sections of $H^0(X,\FF(D))$ are somewhat less explicit, but can
be constructed as follows.  For $\ell=2,\dots, p-1$, consider a
section $s_\ell$ of $\FF(D)$ corresponding to  tuple
$\left(\alpha_0,\dots,\alpha_{p-1}\right)$ with
$\alpha_j=0$ for $j>\ell$, $\alpha_\ell=1$, $\alpha_{\ell-1}=0$,
and $\alpha_j$ with $j\le\ell-2$ to be chosen.  In
order to obtain a section of $\FF(D)$ the tuple
\[\left(\beta_0,\dots,\beta_{p-1}\right)
  =\left(\alpha_0,\dots,\alpha_{p-1}\right)H\]
should have entries with poles no worse than $D$ on $V$.  This is
automatic for $\beta_j$ with $j>\ell$ (since $\beta_j=0$) as well as
for $j=\ell$ (since $\beta_\ell=1$) and $j=\ell-1$ (since
$\beta_{\ell-1}=\ell h$).  There is a function $\alpha_{\ell-2}\in
H^0(X,\OO_X(2D))$ (unique up to addition of a scalar) such that 
\[\beta_{\ell-2}=\alpha_{\ell-2}+\binom\ell2 h^2\alpha_{\ell}\]
has poles no worse that $D$ on $V$.  We continue to choose
$\alpha_j\in H^0(X,\OO_X((\ell-j)D))$ with $j<\ell-2$ in descending
order to satisfy the condition that $\beta_j$ have poles no worse than
$D$ on $V$, thus obtaining a section $s_\ell$ in $H^0(X,\FF(D))$.

It remains to consider the images of the $s_j$ in $H^0(X,\FF(D)/\FF)$.
% For $\ell=1,\dots,p-1$, let $h_\ell$ be the unique section of
% $H^0(X,\OO_X(D)/\OO_X)$ such that there exists a global function on
% $X$ regular away from $D$ and with principal part at $D$ equal to
% $h^\ell-h_\ell$.  [One could also define $h_\ell$ by taking it to be
% the representative of the class in $H^1(X,\OO_X)$ given by $h^\ell$ as
% a transition function on $U\cap V$.] 
Inspection of the process for choosing the $\alpha_j$ in the last
paragraph then shows that 
\begin{align*}
 s_0&\mapsto\left(1,0,\dots,0\right)=\left(0,0,\dots,0\right)\\
s_1&\mapsto\left(h,1,0,\dots,0\right)=\left(h,0,\dots,0\right)\\
  s_2&\mapsto\left(*,2h,1,0\dots,0\right)=\left(*,2h,0,\dots,0\right)\\
  \vdots\\
s_\ell&\mapsto\left(*,\dots,*,\ell h,0,\dots,0\right)
\end{align*}
where the last non-zero entry in the image of $s_\ell$ occurs in
column $\ell-1$ (numbering from 0).\footnote{We know nothing about the
  entries $*$ other than that they have poles no worse than $D$ on
  $V$.  They can of course be computed for a given $Y$, but it is not clear
  how to say anything explicit about them in general, except for
  $s_2$.}



\subsection{Computing Frobenius on $H^1(Y,\OO_Y)$}
\label{ss:computing-Frob}
With notation as before, we have isomorphisms
\[H^1(Y,\OO_Y)\cong H^1(X,\FF)\cong
  \frac{H^0(X,\FF(D)/\FF)}{H^0(X,\FF(D))},\]
and the Frobenius endomorphism of $H^1(Y,\OO_Y)$ transported to the
right hand group above is given by
\[\frac{H^0(X,\FF(D)/\FF)}{H^0(X,\FF(D))}\to
  \frac{H^0(X,\FF(pD)/\FF)}{H^0(X,\FF(pD))}
  \cong \frac{H^0(X,\FF(D)/\FF)}{H^0(X,\FF(D))}\]
where the first arrow is $s\mapsto s^p$ and the second is the
isomorphism obtained by noting that
\[0\to\FF\to\FF(pD)\to\FF(pD)/\FF\to0\]
is another acyclic resolution of $\FF$.  Note that making this
explicit requires understanding the principal parts along $D$ of
sections of $\FF(pD)$. 

We want to further transport Frobenius via the isomorphism
\[H^0(X,\FF(D)/\FF)\cong H^0(X,\OO_X(D)/\OO_X)^p\]
as in the previous section.  Note that if $s=\sum\beta_iz^i$, then
\[s^p=\sum\beta_i^pz^{pi}
  =\sum\beta_i^p(z+g)^i
  =\left(\beta_0^p,\dots,\beta_{p-1}^p\right)
G  \begin{pmatrix}
    1\\z\\z^2\\\vdots\\z^{p-1}
  \end{pmatrix}
\]
where
\[G=\begin{pmatrix}1&0&0&\dots&0\\
    g&1&0&\dots&0\\
    g^2&2g&1&\dots&0\\
    \vdots&\vdots&\vdots&\ddots&0\\
    g^{p-1}&(p-1)g^{p-2}&\binom{p-1}{2}g^{p-3}&\dots&1
  \end{pmatrix}\]
(Numbering the rows and columns of $G$ from $0$ to $p-1$, the $(i,j)$
entry of $G$ is $\binom ij g^{i-j}$.)

Thus to compute the image of the class of
$\left(\beta_0,\dots,\beta_{p-1}\right)$, we should form
\[\left(\beta_0^p,\dots,\beta_{p-1}^p\right)G
  \in H^0(V,\OO_X(pD))^p\]
and then use sections of $H^0(X,\FF(pD))$ to ``reduce'' this quantity
so that it lies in  $H^0(V,\OO_X(D))$.

We end by examining what needs to be known to write down global
sections of $\FF(pD)$:  They are given by tuples
\[\left(\alpha_0,\dots,\alpha_{p-1}\right)\in \OO_X(U)^p\]
such  that
\[\left(\beta_0,\dots,\beta_{p-1}\right)
  =\left(\alpha_0,\dots,\alpha_{p-1}\right)H\]
has components lying in $\OO_X(pD)(V)$.  To find them, choose
$\alpha_{p-1}\in H^0(X,\OO_X(pD))$ arbitrarily.  Then choose
$\alpha_{p-2}\in H^0(X,\OO_X((p+1)D)$ such that
$\alpha_{p-2}+(p-1)h\alpha_{p-1}$ has poles no worse than $pD$ in
$V$.  (The set of such choices is a homogeneous space for
$H^0(X,\OO_X(pD))$.)  Iterating, one sees that $\alpha_i$ lies in
$H^0(X,\OO_X((2p-1-i)D)$ and is uniquely determined up to addition of
an element of $H^0(X,\OO_X(pD))$.  Thus, if we have good control on the
principal parts of elements of $H^0(X,\OO_X((2p-1)D))$, we can compute
Frobenius on $H^1(Y,\OO_Y)$.


\subsection{Completing the Hasse-Witt triple of $Y$}
Since $\pi$ is finite and \'etale, we have
$\pi^*\Omega^1_X\cong\Omega^1_Y$ and
\[\pi_*\Omega^1_Y\cong\Omega^1_X\tensor_{\OO_X}\pi_*\OO_X
  =\Omega^1_X\tensor_{\OO_X}\FF.\]
We write $\FF^1$ for $\Omega^1_X\tensor_{\OO_X}\FF$.  The auto-duality of
$\FF$ induces a bilinear map of $\OO_X$-modules
\[\FF\tensor_{\OO_X}\FF^1\to\Omega^1_X.\]

Let $Q=H^1(Y,\OO_Y)\cong H^1(X,\FF)$ and let $\Phi$ be the Frobenius
endomorphism as computed in the preceding section.  Then Serre duality
says that $Q^\vee\cong H^0(Y,\Omega^1_Y)$ and since $\pi$ is finite, 
$H^0(Y,\Omega^1_Y)\cong H^0(X,\FF^1)$.

Recall that we have fixed an effective, non-special divisor $D$.  We
have 
\[H^0(X,\Omega^1_X(-D))\cong H^1(X,\OO_X(D))^\vee=0,\]
and an easy argument
by induction shows that $H^0(X,\FF^1(-D))=0$ as well.  We find an
injection\footnote{Note that the right hand side here is an explicit
  $pg$-dimensional vector space, and we can compute in it, rather than
  worrying about writing down an explicit basis of $H^0(X,\FF^1)$}
\[H^0(\FF^1)\to H^0(X,\FF^1/\FF^1(-D)).\]
Its image is easily seen to be orthogonal to
\[\im\left(H^0(X,\FF(D))\to H^0(X,\FF(D)/\FF)\right)
  =\Ker\left(H^0(X,\FF(D)/\FF)\onto H^1(X,\FF)\right)\]
under the pairing
\[H^0(X,\FF(D)/\FF)\times H^0(X,\FF^1/\FF^1(-D))\to
H^0(X,\Omega^1_X(D)/\Omega^1_X)\labeledlongto{\res}k\]
where the  first arrow is induced by the bilinear map mentioned
above, and the second arrow is the sum of residues along $D$.

Now suppose $s\in H^0(X,\FF(D)/\FF)$ maps to an element in
$H^1(X,\FF)$ which is killed by Frobenius.  This means that there is a
global section $t\in H^0(X,\FF(pD))\cong H^0(Y,\OO_Y(\pi^*D))$ whose
principal parts along $\pi^*D$ are given by $s^p$.  It is then immediate
that $\omega=dt$ is a \emph{regular} 1-form on $Y$, i.e., an element
of $H^0(Y,\Omega^1_Y)\cong H^0(X,\FF^1)$.  The map $\Psi$ is then
given by

\begin{equation}\label{eq:Psi}
\Psi:\Ker(\Phi)\to Q^\vee\qquad [s]\mapsto \omega.  
\end{equation}
Since $\omega$ is exact, it is orthogonal to $\im(\Phi)$, so our
$\Psi$ has the required properties.

Summing up, we have proven:

\begin{prop}\label{prop:HWT}
  The Hasse-Witt triple associated to $H^1_{dR}(Y)$ is $(Q,\Phi,\Psi)$
  with $Q=H^1(X,\FF)$ computed explicitly in
  Section~\ref{ss:computing-H1}, with Frobenius $\Phi$ defined in
  Section~\ref{ss:computing-Frob}, and with $\Psi$ defined in the
  paragraph before equation~\eqref{eq:Psi}.
\end{prop}




% \section{Examples and comments}\label{s:examples}

% \bry{Most of this section has been incorporated in to earlier sections; I'd vote to 
% incorporate any remaining examples earlier, and just comment out this section altogether.
% }

% %\subsection{Varying the cover}
% %Examples showing that for a fixed $X$, different choices of $\eta_X$
% %can give non-isomorphic $J_Y[p]$s.\bry{This is done in Example \ref{ex:differenteta}}

% \subsection{Independence of splitting conditions}
% \note{Examples where one or the other or both of \eqref{eq:GG_Y,et,ker}  and
%   \eqref{eq:GG_Y,et,coker}  do not split.} 
%   \bry{Example \ref{ex:splitting} does this for $p\neq 2$; can we therein incorporate the $p=2$ example below?}

% \note{For both:}
%   Let $k=\F_2$, and let $X$ be the curve of genus 2 over $k$ defined by
%   \[v^2+(u^2+u+1)v + u^5+1=0.\]
% Magma code written by the first-named author computes
%   that $H^1_{dR}(X)$ has a basis $e_1,\dots,e_4$ with the following
%   $\D_k$-module structure:
% \begin{center}
% \begin{tabular}{| c | c | c | c | c | }
% \hline
% $e$ & $e_1$ & $e_2$ & $e_3$ & $e_4$ \\ 
% \hline
% $F(e)$ & $e_1$ &$e_1+e_2$ & $0$ & 0 \\
% \hline
% $V(e)$ & 0 & 0 & $e_3$ & $e_3+e_4$ \\
% \hline 
% \end{tabular}
% \end{center}
% and cup-product pairing given by $\<e_2,e_3\>_X=\<e_1,e_4\>_X=1$,
% and $\<e_i,e_j\>_X=0$ if $i+j\neq5$.

% Thus $X$ has (up to $\kbar$ isomorphism) a unique unramified cover
% $\pi:Y\to X$ with $\gal(Y/X)\cong\Z/2\Z$ and $Y$ of genus 3. (Its
% class is $\eta_X=e_1$, and it is given by $w^2+w=u+1$.)
  
% The same code computes that $H^1_{dR}(Y)$ has a basis $f_1,\dots,f_6$
% with the following $\D_k[G]$-module structure:
% \begin{center}
% \begin{tabular}{| c | c | c | c | c | c | c | }
% \hline
% $f$ & $f_1$ & $f_2$ & $f_3$ & $f_4$ & $f_5$ & $f_6$\\ 
% \hline
% $F(f)$ & $f_1$ &$f_1+f_2$ &$ f_2+f_3$ & $0$ & $0$ & 0 \\
% \hline
% $V(f)$ & 0 & 0 & 0 & $f_4$ & $f_4+f_5$ & $f_5+f_6$\\
% \hline 
% $\delta(f)$ & 0 & 0 & $f_1$ & 0 & $0$ & $f_4$\\
% \hline 
% \end{tabular}
% \end{center}
% Moreover, we have
% \[\pi^*: e_1\mapsto0,\quad e_2\mapsto f_1,\quad
%   e_3\mapsto f_4,\quad e_4\mapsto f_5,\]
% as well as 
% \[\pi_*: f_1\mapsto0,\quad f_2\mapsto e_1,\quad
%   f_3\mapsto e_2,\quad f_4\mapsto 0,\quad
%   f_5\mapsto 0,\quad f_6\mapsto e_3.\]

% This shows that all of the possible failures mentioned \note{...above...}
% (no $\omega_X$, no $\eta_Y$, and
% failure of Deuring--Shafarevich) actually do occur.  It also shows
% that $H^1_{dR}(Y)$ has no $\Dk[G]$ factor which is a free
% $k[G]$-module, so there is no $\GG_Y$ as in the main theorem.

%\subsection{Examples of sharpness of
%  Theorem~\ref{thm:et-inequalities}}\label{nubound:sharp} 
%Consider the three degree 6 hyperelliptic curves over $k:=\F_3$:
%
%$$X_1 :      y^2 =x^6 + x^5 + x^3 + x$$
%%        [0 1]
%%        [1 0],
%%
%%        1,
%%
%%        0
%$$X_2: y^2 =-x^6 + x^4 + x^3 + x^2 + x + 1$$
%%        [1 1]
%%        [0 1],
%%
%%        1,
%%
%%        0
%%    >,
%$$X_3:  y^2 = x^6 + x^4 + x^3 + x^2 +x$$
%%        [1 1]
%%        [0 1],
%%
%%        1,
%%
%%        0

%Each has genus 2 with $f_{X_i} =2$ and $\nu_{X_i}=1$ for $i=1,2,3$, so has a unique 
%unramified $\Z/3\Z$-cover $Y_i$ over $k$ given explicitly by:


%$$Y_1: z^3 -z = (-x^3 -x^2 + 1)y + x^6 - x^2$$
%%, 4, 1>
%$$Y_2: z^3 -z = \frac{x^3 + x^2 + x + 1}{x^6}y + \frac{x^6 - x^5 + x^4 + x^3 -1}{x^6}$$
%%, 4, 2>
%$$Y_3: z^3 -z = y - x^3 +x$$
%% 4, 3>
% Then $Y_i$ has (geometric) $p$-rank $f_{Y_i}=4$ by the Deuring--Shafarevich formula.
% We note that the exact sequence \eqref{eq:GG_X,et}
% is split when $i=1$ and otherwise non-split; in particular Theorem \eqref{thm:et-inequalities}
% forces $\nu_{Y_1}=1$, and gives the bounds $1\le \nu_{Y_i} \le p$ when $i=2,3$.
%In fact, we compute that $\nu_{Y_i}=i$ for $i=1,2,3$.
% 
% Let $k_i'=\begin{cases} \F_{3^2} & i=1 \\ \F_{3^3} & i=2,3\end{cases}$
%and write $X_i'$ and $Y_i'$ for the base change of $X_i$ to and $Y_i'$ to $k_i'$, respectively.
%Then $\nu_{X_i'}=2=f_{X_i'}$ and $\nu_{Y_i'}=4=f_{Y_i'}$ for all $i$.
%Now the torsion subgroup $T_i$ of the $k_i'$-class group of $X_i'$ is isomorphic to
%$$
%	\begin{cases}
%		\frac{\Z}{3\Z} \oplus \frac{\Z}{3^3\Z} & i=1 \\
%%		Z/3 + Z/27 + Z & i=1
%		\frac{\Z}{3\Z} \oplus \frac{\Z}{3^2\Z} \oplus \frac{\Z}{5\Z}\oplus\frac{\Z}{7\Z}  & i=2\\
%	%	 Z/3 + Z/315 + Z & i=2
%		\left(\frac{\Z}{2\Z}\right)^3 \oplus \frac{\Z}{3\Z} \oplus \frac{\Z}{3^3\Z} & i=3
%	%	  Z/2 + Z/6 + Z/54 + Z & i=3
%	\end{cases}
%$$
%As (geometric) unramified $\Z/3\Z$ extensions of $X_i'$ over $k_i'$ correspond to subgroups $U_i$ of $T_i$
%with $T_i/U_i \simeq \Z/3\Z$, for each $i$ there are $4$ distinct such covers, one of which is
%$Y_i'$.  It turns out that, for each $i$,  if $Z_i'$ is {\em any} one of the other three covers, 
%then $\nu_{Z_i'}=3$ while (by the Deuring--Shaferivich formula) $f_{Z_i'}=4$.
%Furthermore, the minimal field extension of $k_i'$ over which each $Z_i'$
%acquires arithmetic $p$-rank 4 is the unique degree 3 extension of $k_i'$: $\F_{3^6}$ when $i=1$
%and $\F_{3^9}$ when $i=2,3$.


 
%Writing $X_1'$ (respectively $X_2'$ and $X_3'$) for the base change of $X_1$ to $\F_9$ 
%(respectively $X_2$ and $X_3$ to $\F_{27}$)
%we have $\nu_{X_i'}=2$ for all $i$.  The base change $Y_1'$ (respectively $Y_2'$, $Y_3'$)
%of $Y_1$ to $\F_9$ (respectively of $Y_2$ and $Y_3$ to $\F_{27}$) has $\nu_{Y_i'}=4$
%for all $i$.  In addition to $Y_i'$, each $X_i'$ has  an independent unramified $\Z/3\Z$-cover, given explicitly by:
%$$
%	Z_1 : z^3 -z =   \zeta_4\left((x^3 + x^2)y - x^6 - x^3 - x^2 - x\right) 
%$$
%%Algebraic function field defined over F by
%%$.1^3 + 2*$.1 + (k2.1^6*X^3 + k2.1^6*X^2)*y + k2.1^2*X^6 + k2.1^2*X^3 + k2.1^2*X^2 + k2.1^2*X
%$$
%	Z_2:  z^3 - z =  \zeta_{26}^3\left(\frac{\zeta_{26}^{-2}x^3 + x^2 +x + 1}{x^6}y - \frac{x^5 - \zeta_{26}^{-2}x^4 - \zeta_{26}^6x^3 + 1}{x^6}\right)
%$$
%%Algebraic function field defined over F2 by
%%$.1^3 + 2*$.1 + (k3.1^14*X^3 + k3.1^16*X^2 + k3.1^16*X + k3.1^16)/X^6*y3 + (k3.1^3*X^5 + k3.1^14*X^4 + k3.1^22*X^3 + k3.1^3)/X^6
%$$
%	Z_3: z^3 - z =(x^3 + x + \zeta_{26}^9)y - x^6 - \zeta_{26}x^3 + x^2 + \zeta_{26}^9x 
%$$
%%Algebraic function field defined over F3 by
%%$.1^3 + 2*$.1 + (2*X^3 + 2*X + k3.1^22)*y2 + X^6 + k3.1*X^3 + 2*X^2 + k3.1^22*X
%where $\zeta_m$ is a primitive $m$-th root of unity.  We have $\nu_{Z_i}=3$ for all $i$.








%\subsection{Examples for $h=1$}
%Examples indicating that all the possibilities allowed in
%Theorem~\ref{thm:h=1} actually occur for curves.

%\bry{I tried finding examples in genus $2$ with hyperelliptic curves over $\F_q$
%of degrees 5 and 6 where $q=5,25,125$.  Hundreds of examples were computed, 
%but the $a$-number of the cover was always $2$.
%Note that the strata in $\mathcal{A}_g$
%consisting of abelian varieties with $a$-number $r$ and $p$-corank $s=g-f$
%is a locally closed subvariety of codimension ${{r+1}\choose{2}}+r-s$.
%In the case that $h=1$ on $X$, the Deuring--Shafarevich formula gives
%$h=p$ on $Y$.  If we assume that the moduli space of genus $g$
%curves meets $\mathcal{A}_g$ in a ``uniform" way via the Jacobian embedding,
%then we'd be led to guess that the strata of $a$-number $r$ and $p$-corank $p$
%curves has codimension ${{r+1}\choose{2}}+r-p$ in this $3(g-1)=3p(g_X-1)$
%dimensional space.  When $r=p$, this codimension is $\frac{p+1}{2}p$,
%and the resulting inequality 
%\[
%\frac{p+1}{2}p \le 3p(g_X-1)
%\]
%is equivalent to $g_X - 1 \ge \frac{p+1}{6}$.  When $p=5$
%and $g_X=2$, this is sharp, meaning that the stratum of interest is zero-dimensional.
%It isn't surprising that we can't find any points (maybe the stratum is empty!).
%When $p=7$, we expect the stratum to be empty, as the computations below 
%hint.
%}


%For $p=5$ we computed a list of  random hyperelliptic curves $X$ over $\F_5$
%of degree $7$ and genus 3 with $h:=g_X-f_X=1$ having an unramified $\Z/5\Z$-cover $Y$ defined over $\F_5$. 
%Of our random sample, 162 of these covers had $a$-number $2$, 37 had $a$-number 4, and $10$ had $a$-number 5.

%If $X$ is the curve given by
%\[
%X: \quad  y^2 =2x^7 + 2x^6 + 2x^4 -x^3 + 2X -2
%\]
%then $a_X = f_X=1$, and 
%\[
%Y:\quad z^5 - z = (-2x^9 + x^8 -2x^7 + x^6 -2x^5 + 2x^4 -x^3 + 2x^2 + x + 1)y
%\]
%is an unramified $\Z/5\Z$-cover of $X$.  The $a$-number of $Y$ is $5$, and {\sc Magma} confirms that the $\D_k$-module structure of 
%$H^1_{dR}(Y)$ is \bry{This is over an algebraic closure I believe, but
%  probably it descends?}
%\note{Here and in other places below, the filtration you compute exists over
%  the ground field, but the presentation by generators and relations
%  given by the words does not necessarily hold over the  ground field.}
%\[     [ F ]^6,
%    [ V ]^6,
%    [ F V ]^5
%\]

%If $X$ is the curve given by
%\[
%X: \quad  y^2 =-x^7 + x^4 + 2x^3 + 2,
%\]
%then $a_X = f_X=1$, and 
%\[
%Y:\quad z^5 - z =(x^4 -2x + 1)y -2
%\]
%is an unramified $\Z/5\Z$-cover of $X$.  The $a$-number of $Y$ is $4$, and {\sc Magma} confirms that the $\D_k$-module structure of 
%$H^1_{dR}(Y)$ is \bry{This is over an algebraic closure I believe, but probably it descends?}
%\[        [ F ]^6,
%    [ V ]^6,
%    [ F  V ]^3,
%    [ F^2  V^2 ]
%\]

%If $X$ is the curve given by
%\[
%X: \quad  y^2 = -(2x^7 + 2x^6 + 2x^5 + x^4 + x^3 + x^2 + x + 1)
%\]
%then $a_X = f_X=1$, and 
%\[
%Y:\quad z^5 - z =(x^9 + 2x^8 -2x^7 -2x^6 -2x^5 + x^4 -2x^3 -2x + 1)y + 2
%\]
%is an unramified $\Z/5\Z$-cover of $X$.  The $a$-number of $Y$ is $2$, and {\sc Magma} confirms that the $\D_k$-module structure of 
%$H^1_{dR}(Y)$ is \bry{This is over an algebraic closure I believe, but probably it descends?}
%\[      [ F ]^6,
%    [ V ]^6,
%    [ F^2  V^2 ],
%    [ F^3  V^3 ]
%\]



%For $p=7$ we computed a list of 155 random hyperelliptic curves $X$ over $\F_7$
%of degree $6$ and genus 2 with $h:=g_X-f_X=1$ having an unramified $\Z/7\Z$-cover $Y$ defined over $\F_7$. 
%Of our random sample, 131 of these covers had $a$-number $2$, 14 had $a$-number 4, and $10$ had $a$-number 6.
%None had $a$-number 7.


%If $X$ is the curve given by
%\[
%X: \quad  y^2 = 3x^6 + x^5 + 2x^3 + 2x^2 - 3x 
%\]
%then $a_X = f_X=1$, and 
%\[
%Y:\quad z^7 - z = \frac{2x^8 - x^7 + 2x^6 - x^5 + x^4 - x^3 - 3x^2 - 2x + 
%    1}{x^{11}}y
%\]
%is an unramified $\Z/7\Z$-cover of $X$.  The $a$-number of $Y$ is $6$, and {\sc Magma} confirms that the $\D_k$-module structure of 
%$H^1_{dR}(Y)$ is \bry{This is over an algebraic closure I believe, but probably it descends?}
%\[    [ F ],
%    [ V ],
%    [ F  V ]^5,
%    [ F^2  V^2 ]
%\]


%If $X$ is the curve given by
%\[
%X: \quad  y^2 = -3x^6 + 2x^5 - 3x^4 - x^3 -x + 1
%\]
%then $a_X = f_X=1$, and 
%\[
%Y:\quad z^7 - z = (2x^{11} + 3x^{10} - 3x^9 + 3x^8 -x^7 -x^6 -x^4 + 3x^3 + 2x^2 -3x +
%    1)y + 3x^{14} -x^7 -3x^2 + x + 1
%\]
%is an unramified $\Z/7\Z$-cover of $X$.  The $a$-number of $Y$ is $4$, and {\sc Magma} confirms that the $\D_k$-module structure of 
%$H^1_{dR}(Y)$ is \bry{This is over an algebraic closure I believe, but probably it descends?}
%\[      [ F ],
%    [ V ],
%    [ F  V ],
%    [ F^2  V^2 ]^3
%   \]


%If $X$ is the curve given by
%\[
%X: \quad  y^2 =3x^6 + x^4 -x^3 + 2
%\]
%then $a_X = f_X=1$, and 
%\[
%Y:\quad z^7 - z = \frac{-2x^{11} + 3x^{10} - 2x^9 -x^8 - 2x^7 -2x^4 + 2x^3 + 1}{x^{14}}y + \frac{-3x^{14} +
%    2x^{13} + 3x^{12} - 2x^7 -3}{x^{14}}
%\]
%is an unramified $\Z/7\Z$-cover of $X$.  The $a$-number of $Y$ is $2$, and {\sc Magma} confirms that the $\D_k$-module structure of 
%$H^1_{dR}(Y)$ is \bry{This is over an algebraic closure I believe, but probably it descends?}
%\[      [ F ],
%    [ V ],
%    [ F^3 V^3 ],
%    [ F^4 V^4 ]
%   \]



% \note{Do we want to offer your code to readers?}
% \bry{It'd take a lot of work to make it fit for public consumption; we should say that
% the Dieudonne module and EO type computations are based off of the publicly available code of Colin Weir: \url{https://github.com/cjweir/EOType}
% that was expanded to suit our needs (e.g. computing $\delta$-action)}

%\begin{rem}\label{???}
%  dummy for cross references
%\end{rem}

\bibliography{database}


\end{document}


%%%%%%%%%%% independence garbage %%%%%%%%%%%%%%
In the process, we find an
interesting ``independence of twisting'' result:

\begin{thm}\label{thm:indep}
  If $Y\to X$ and $Y'\to X$ are unramified Galois covers with group
  $\Z/p\Z$, and if there is an isomorphism $Y\times\kbar\cong
  Y'\times\kbar$ respecting the Galois action, then $J_Y[p]\cong
  J_{Y'}[p]$ as group schemes with $\Z/p\Z$-action.
\end{thm}


We can use our explicit description of $\FF$ to prove invariance of
$J_Y[p]$ under twists.

\begin{proof}[Proof of Theorem~\ref{thm:indep}]
  \note{I'm no longer convinced this claim is true.}
Let $\eta_X$ and $\eta_{X'}$ be the classes of $Y$ and $Y'$ in
$H^1(X,\Z/p\Z)$.  Proposition~\ref{prop:geometry}(5) tells us that
$\eta_X$ and $\eta_{X'}$ have the same image in $H^1(X,\OO_X)$, and we
denote this image by $\eta_{X,dR}$.

Let $\FF=\pi_*\OO_Y$,
$\FF^1=\pi_*\Omega^1_Y\cong\Omega^1_X\tensor_{\OO_X}\FF$, and let
$\nabla:\FF\to\FF^1$ be the connection induced by the de Rham
differential on $Y$.  Then we may calculate the de Rham cohomology of
$Y$ as the hypercohomology of the complex
$\FF\labeledto{\nabla}\FF^1$:
\begin{equation}\label{eq:Hy-dR}
H^1_{dR}(Y)=\Hy^1\left(X,\FF\labeledto{\nabla}\FF^1\right).  
\end{equation}
Write $\FF'$, etc., for the analogous objects defined using $Y'$.

Proposition~\ref{prop:geometry} tells us that $\FF$ and $\FF'$ are
isomorphic as $\OO_X$-modules with $G$ action.  (They are both
$\sym^{p-1}\EE$ where $\EE$ is constructed from the class
$\eta_{X,dR}$.)  They are in general not isomorphic as
$\OO_X$-\emph{algebras}, because $Y$ and $Y'$ are generally not
isomorphic curves.  So it is not clear \emph{a priori} that Frobenius
induces the same endomorphisms of their cohomology.

\note{Bogged down here ...}  Choose an iso $\phi:\FF\to\FF'$ (there is
a canonical one).  What we need to show is that $F\phi-\phi F$ kills
$\Hy^1\left(X,\FF\labeledto{\nabla}\FF^1\right)$.  Explicitly, if $f$
is in $\FF(U\cap V)$, then $\phi(f)^p-\phi(f^p)$ should be the
difference of $p$-th powers, one in $\FF'(U)$ and the other in
$\FF'(V)$.  (This shows some hypercocycle is a coboundary.)  I can show it
is a $p$-th power, but I don't know how to separate it into two parts
with the require regularity.  One might need to use that $df$ is the
difference of regular differentials (hypercocycle condition).  Maybe
there is some inspired chain homotopy.  \note{See
  after end for more explicitations.}
\end{proof}

\note{Is there some simpler reason (e.g., directly on $J_Y[p]$) why
  this should be true?}


% more verbiage for independence of twist proof

We now make $\FF$ and $\FF'$ more explicit as in
Section~\ref{s:geometry}.  Choose an affine open cover $\{U,V\}$ of
$X$, and let $f\in\OO_X(U)$ and $g\in\OO_X(V)$ be such that $Y$
is $\spec k[U][y]/(\wp(y)-f)$ over $U$ and $\spec k[V][z]/(\wp(z)-g)$
over $V$.  Define $f',g',y',z'$ similarly using $Y'$.  Since $Y$ and
$Y'$ become isomorphic covers of $X$ over $\kbar$, there is a scalar
$a\in k$ such that $f'=f+a$ and $g'=g+a$.

As in Section~\ref{ss:FF-explicit}, a section of $\FF$ over an open
$W\subset X$ is determined by a tuple of functions
$\left(\alpha_0,\dots,\alpha_{p-1}\right)$ regular on $W\cap U$.  (The
tuple must also satisfy the requirement that the tuple
$\left(\alpha_0,\dots,\alpha_{p-1}\right)H$, with $H$ as in
\eqref{eq:H}, is is regular on $W\cap V$, but this will not be
relevant for us.)  A similar description holds for sections of $\FF'$.
We define an isomorphism $\FF\to\FF'$ by sending
\[\left(\alpha_0,\dots,\alpha_{p-1}\right)\mapsto
  \left(\alpha_0,\dots,\alpha_{p-1}\right),\]
in other words, the section
\[s=\sum_{i=0}^{p-1}\alpha_iy^i\in\FF(W\cap U)
  =\OO_Y(\pi^{-1}(W\cap U))\]
is mapped to the section
\[s'=\sum_{i=0}^{p-1}\alpha_iy^{\prime i}\in\FF'(W\cap U)
  =\OO_{Y'}(\pi^{\prime-1}(W\cap U))\]
and similarly over $V$.

Now consider the Frobenius induced by the algebra structures on $\FF$
and $\FF'$, as defined in Section~\ref{ss:algebra}.
The section
\[s^p=\sum_{i=0}^{p-1}\alpha_i^py^{pi}
  =\sum_{i=0}^{p-1}\alpha_i^p(y+f)^i\]
corresponds to the tuple
\[\left(\alpha_0,\dots,\alpha_{p-1}\right)\begin{pmatrix}1&0&0&\dots&0\\
    f&1&0&\dots&0\\
    f^2&2f&1&\dots&0\\
    \vdots&\vdots&\vdots&\ddots&0\\
    f^{p-1}&(p-1)f^{p-2}&\binom{p-1}{2}f^{p-3}&\dots&1
  \end{pmatrix}.\]
On the other, the section
\[s^{\prime p}=\sum_{i=0}^{p-1}\alpha_i^py^{\prime pi}
  =\sum_{i=0}^{p-1}\alpha_i^p(y'+f')^i
  =\sum_{i=0}^{p-1}\alpha_i^p(y'+f+a)^i\]
corresponds to the tuple
\[\left(\alpha_0,\dots,\alpha_{p-1}\right)\begin{pmatrix}1&0&0&\dots&0\\
    f&1&0&\dots&0\\
    f^2&2f&1&\dots&0\\
    \vdots&\vdots&\vdots&\ddots&0\\
    f^{p-1}&(p-1)f^{p-2}&\binom{p-1}{2}f^{p-3}&\dots&1
  \end{pmatrix}.\]


=====

\bry{Somehow I find this statement harder to parse than I think it should be.  
Maybe it's having these two filtrations? Here is an alternative phrasing, 
which I think gives a little more information:
There is a self-dual $BT_1$ group scheme $\HH$ equipped a filtration
  \[0=\HH_0\subset \HH_1\subset\cdots\subset \HH_p=\HH\] 
  with successive quotients
  \[\HH_i/\HH_{i-1}\cong J_X[p]\quad\text{for}\ i=1,\dots,p\]
  such that $J_Y[p]$ is both a sub of a quotient of $\HH$ and a quotient of a sub of $\HH$.
  More precisely, there are canonical commutative diagrams of group schemes
    \begin{equation*}
        \xymatrix@C=15pt{
                %& 0\ar[d] & & & & \\
                 \mu_p\ar@{^{(}->}[d] & & &  \\
                  \res_{T/S} \mu_p \ar[d]& & &  \\
          {\GG}\ar@{->>}[d] \ar@{^{(}->}[r] & {\HH} \ar[r] & \res_{T/S}\Z/p\Z\ar@{->>}[r] & \Z/p\Z \\
         J_Y[p] & & &  
        }\quad
        \xymatrix@C=15pt{
                %& 0\ar[d] & & & & \\
                 \Z/p\Z  & & & & \\
                  \res_{T/S} \Z/p\Z\ar@{->>}[u] & & &  \\
         {\GG^{\vee}} \ar[u]   & {\HH} \ar@{->>}[l] & \res_{T/S}\mu_p \ar[l] & \mu_p\ar@{_{(}->}[l]  \\
         J_Y[p]\ar@{_{(}->}[u] & & &  
        }
    \end{equation*}
    that are swapped by Cartier duality.
}    
