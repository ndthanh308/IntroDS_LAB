% !TEX root = main.tex
%\section{Additional material for \cref{sec:fica}}
%\subsection{Operational semantics of $\fica$}
We assume that variables are initialised to $0$
and semaphores are initially released.

In reduction rules, it will be convenient to use
the syntax
$\newvar{x\aasg i}{M}$ and $\newsem{x\aasg i}{M}$,
which allows us to specify initial values more flexibly,
i.e. $\newvar{x}{M}$ and $\newsem{x}{M}$ should be viewed as
$\newvar{x\aasg 0}{M}$ and $\newsem{x\aasg 0}{M}$ respectively.


{
The operational semantics is defined using a (small-step) transition
relation $\step{s}{M}{s'}{M'}$, where $\mem$ is a set of variable names
denoting active \emph{memory cells} and \emph{semaphore locks}.
$s,s'$ are states, i.e.\ functions $s,s':\mem\rightarrow\makeset{0,\cdots,\imax}$, and $M,M'$ are
terms.  We write $s\otimes (v\mapsto i)$ for the state obtained by augmenting $s$ with $(v\mapsto i)$, assuming $v\not\in \dom{s}$.
The basic reduction rules are given in Figure~\ref{fig:os},
where $c$ stands for any language constant ($i$ or $\skipcom$)
and $\widehat{\mathbf{op}}:\{0,\cdots,\imax\}\rarr\{0,\cdots,\imax\}$
is the function corresponding to $\mathbf{op}$.
In-context reduction is given by the schemata:

\begin{center}
\AxiomC{$\mem,v\vdash  M[v/x],s\otimes(v\mapsto i)\longrightarrow M',s'\otimes(v\mapsto i') $ \quad $M\neq c$}
\UnaryInfC{$\mem\vdash\newin{x\aasg i}{M},s\longrightarrow \newin{x\aasg i'}{M'[x/v]}, s' $}
\DisplayProof\\[2ex]
\AxiomC{$\mem,v\vdash  M[v/x],s\otimes(v\mapsto i)\longrightarrow M',s'\otimes(v\mapsto i') $\quad $M\neq c$}
\UnaryInfC{$\mem\vdash\newsem{x\aasg i}{M},s\longrightarrow \newsem{x\aasg i'}{M'[x/v]}, s' $}
\DisplayProof\\[2ex]
  \AxiomC{$\step{s}{M}{s'}{M'}$}
  \UnaryInfC{$\step{s}{\mathcal E[M]}{s'}{\mathcal E[M']}$}
  \DisplayProof
\end{center}
where reduction contexts $\mathcal E[-]$ are produced by the
grammar:
\[\begin{array}{rcl}
  \mathcal E[-] &::=& [-] \mid \mathcal E;N
  \mid (\mathcal E\,\parc\, N)
  \mid (M\,\parc\, \mathcal E)
  \mid {\mathcal E} N 
  \mid \arop{\mathcal E} 
  \mid \cond{\mathcal E}{N_1}{N_2}\\
  &&\mid {!}\mathcal E
  \mid \mathcal E\aasg m
  \mid M\aasg\mathcal E
  \mid \grb{\mathcal E}
  \mid \rls{\mathcal E}.
\end{array}\]
% Figure environment removed
We say that a term $\seq{}{M:\comt}$ \emph{may terminate},  written $M\Downarrow$, if 
$\emptyset \vdash \emptyset,\,M\longrightarrow^\ast \emptyset,\skipcom$.

\cutout{
Idealized Concurrent Algol~\cite{GM08} also features variable and semaphore constructors, 
called $\textbf{mkvar}$ and $\textbf{mksem}$ respectively,
which play a technical role in the full abstraction argument, similarly to~\cite{AM97a}.
We omit them in the main body of the paper, because
they do not present technical challenges, but they are covered here for the sake of completeness.


\paragraph*{Typing rules}
\[
\AxiomC{$\Gamma\vdash M:\expt\rarr\comt$}
  \AxiomC{$\Gamma\vdash N:\expt$}
  \BinaryInfC{$\Gamma\vdash \mkvar{M}{N}:\vart$}
  \DisplayProof
\quad
 \AxiomC{$\Gamma\vdash M:\comt$}
  \AxiomC{$\Gamma\vdash N:\comt$}
  \BinaryInfC{$\Gamma\vdash  \mksem{M}{N}:\semt$}
  \DisplayProof
\]


\paragraph*{Reduction rules}

\begin{align*}
  \step {s&}{(\mkvar{M}{N})\aasg M'}{s}{M M'}\\
  \step {s&}{{!}(\mkvar{M}{N}}{s}{N}\\
  \step {s&}{\grb {\mathbf{mksem}\,M N}}{s}{M}\\
  \step {s&}{\rls {\mathbf{mksem}\,M N}}{s}{N}
\end{align*}

\paragraph*{$\eta$ rules for $\vart,\semt$}
\[\begin{array}{rcl}
M &\longrightarrow & \mkvar{(\lambda x^\expt. M\aasg x)}{!M}\\
M &\longrightarrow & \mksem{\grb{M}}{\rls{M}}
\end{array}\]
\cutout{
Using $\mathbf{mkvar}$ and $\mathbf{mksem}$,
one can define $\divcom_\theta$ as syntactic sugar using $\divcom=\divcom_\comt$ only.
\[
\divcom_\theta=\left\{
\begin{array}{lcl}
\divcom && \theta=\comt\\
\divcom;0 && \theta=\expt\\
\mkvar{\lambda x^\expt.\divcom}{\divcom_\expt} && \theta=\vart\\
\mksem{\divcom}{\divcom} & &\theta=\semt\\
\lambda x^{\theta_1}.\divcom_{\theta_2} & & \theta=\theta_1\rarr\theta_2\\
\end{array}\right.
\]}
}