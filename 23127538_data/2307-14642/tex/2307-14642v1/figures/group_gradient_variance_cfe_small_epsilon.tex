
% Tikz examples & demos
% https://holatex.app/examples.html?package=tikz

  \nextgroupplot[
      %
      legend style={
        legend image post style = {scale=0.8},
        legend columns          = 2,
        column sep              = 1em,
        %at                     ={(0.5,1.5)},
        anchor                  = north,
        legend cell align       = left,
        line width              = 1pt,
        draw                    = none,
        legend to name          = grouplegend
      },
      %
      %
      tuftelike, 
      axis line style = thick,
      every tick/.style={black,thick},
      %axis lines = left,
      %grids=both,
      ymode  = log,
      xmin   = 1,
      xmax   = 6000,
      xtick  = {1, 3000, 6000},
      ytick  = {1e+13, 1e+11, 1e+9, 1e+7},
      %
      ymin   = 1e+7,
      ymax   = 1e+13,
      %
      xlabel = {Iteration},
      %ylabel = {\(\mathbb{E}\norm{\rvvg}^2_2\)},
      height = 4.5cm,
      width  = 5cm,
      axis on top,
    ]

    %\addplot[mark=none, thick] 
    %  table [x index = {0}, y index = {1}] {data/gradient_variance_cfe_large_epsilon.csv};
    %\addlegendentry{}

    \addplot[mark=none, black, very thick] 
      table [x=tgradvar, y=ygradvar] {data/gradient_variance_cfe_small_epsilon.csv};
    \addlegendentry{\footnotesize\(\mathbb{E}\norm{\rvvg_{\mathrm{CFE}}}_2^2\)}

    \addplot[mark=none, color1, very thick] 
      table [x=tadaptive, y=yadaptive] {data/gradient_variance_cfe_small_epsilon.csv};
    \addlegendentry{\footnotesize{}\cref{thm:cfe_upperbound} with \(\epsilon\)-adaptive \(\delta\)}

    \addplot[mark=none, color2, very thick] 
      table [x=tdeltaone, y=ydeltaone] {data/gradient_variance_cfe_small_epsilon.csv};
    \addlegendentry{\footnotesize{}\cref{thm:cfe_upperbound} with \(\delta = 1\)}

    \addplot[mark=none, color3, very thick] 
      table [x=tdomke, y=ydomke] {data/gradient_variance_cfe_small_epsilon.csv};
    \addlegendentry{\footnotesize{Thm Domke et al. 2023}}

    %\addplot[mark=none, color3, very thick] 
    %  table [x=tgradvar, y=ygradvar] {data/gradient_variance_stl_small_epsilon.csv};

    %% \addplot[mark=none, black, very thick] 
    %%   table [x=tgradvar, y=ygradvar] {data/gradient_variance_stl_small_epsilon.csv};
    %% \addlegendentry{\footnotesize\(\mathbb{E}\norm{\rvvg_{\mathrm{STL}}}_2^2\)}

    %% \addplot[mark=none, color4, very thick] {x};
    %% \addlegendentry{\footnotesize{Thm} }

    \node[anchor=north east] at (axis cs:6000,2e+13) {\(\epsilon = 10^{-4}\)};

