
\begin{theoremEnd}[category=cfeupperbound]{theorem}\label{thm:cfe_upperbound}
  Assume \cref{assumption:variation_family} and that \(\pi\) is \(L\)-log-smooth.
  For the full-rank parameterization, the expected-squared norm of the CFE estimator is bounded as
  \begin{align*}
    \mathbb{E} \norm{ \rvvg_{\mathrm{CFE}}\left(\vlambda\right) }_2^2
    &\leq
    \left( L^2 \left( d + k_{\varphi} \right) \left(1 + \delta\right) + {\left(L + C \right)}^{2} \right) {\lVert \vlambda - \vlambda^* \rVert}_2^2 
    \\
    &\quad+
    L^2 \left( d + k_{\varphi} \right) \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2
  \end{align*}
  for any \(\vlambda \in \Lambda_S\) and \(\delta \geq 0\), where \(\bar{\vlambda} = \left(\bar{\vz}, \mathbf{0}\right)\) and \(\bar{\vz}\) is any stationary point of \(f\).
\end{theoremEnd}
\begin{proofEnd}
  Following the notation of \citet{domke_provable_2023}, we denote \( \nabla \log \pi = f \).
  Then, starting from the definition of the variance,
  \begin{align}
    \mathbb{E} \norm{ \rvvg_{\mathrm{CFE}}\left(\vlambda\right) }_2^2
    &=
    \mathrm{tr}\mathbb{V}\rvvg\left(\vlambda\right)
    +
    \norm{ \mathbb{E} \rvvg_{\mathrm{CFE}}\left(\vlambda\right) }_2^2,
    \nonumber
\shortintertext{and by the unbiasedness of \(\rvvg_{\mathrm{CFE}}\),}
    &=
    \mathrm{tr}\mathbb{V}\rvvg\left(\vlambda\right)
    +
    \norm{ \nabla F\left(\vlambda\right) }_2^2,
    \nonumber
\shortintertext{by the definition of \(\rvvg_{\mathrm{CFE}}\) (\cref{def:cfe}),}
    &=
    \mathrm{tr}\mathbb{V}_{\rvvz \sim q_{\vlambda}} \left( \nabla_{\vlambda} f\left( \rvvz \right) + \nabla \mathbb{H}\left(q_{\vlambda}\right) \right)
    +
    \norm{ \nabla F\left(\vlambda\right) }_2^2.
    \nonumber
\shortintertext{We now apply the property of the variance: the deterministic components are neglected as}
    &=
    \mathrm{tr}\mathbb{V}_{\rvvz \sim q_{\vlambda}} \nabla_{\vlambda} f\left( \rvvz \right) 
    +
    \norm{ \nabla F\left(\vlambda\right) }_2^2
    \nonumber
    \\
    &\leq
    \mathbb{E}_{\rvvz \sim q_{\vlambda}} \norm{ \nabla_{\vlambda} f\left( \rvvz \right) }_2^2
    +
    \norm{ \nabla F\left(\vlambda\right) }_2^2.
    \label{eq:thm_cfe}
  \end{align}

  For \(L\)-log-smooth posteriors (\(L\)-smooth \(f\)), \citet[Theorem 3]{domke_provable_2019} show that
  \begin{align*}
    \mathbb{E}_{\rvvz \sim q_{\vlambda}} \norm{ \nabla_{\vlambda} f\left( \rvvz \right) }_2^2
    &\leq
    L^2  \left( 
    \left( d + k_{\varphi} \right) \norm{ \vm - \bar{\vz} }_2^2
    +
    \left( d + 1 \right) \norm{ \mC }_{\mathrm{F}}^2
    \right),
\shortintertext{and since \(k_{\varphi} \geq 1\),}
    &\leq
    L^2  \left( 
    \left( d + k_{\varphi} \right) \norm{ \vm - \bar{\vz} }_2^2
    +
    \left( d + k_{\varphi} \right) \norm{ \mC }_{\mathrm{F}}^2
    \right)
    \\
    &=
    L^2 \left( d + k_{\varphi} \right) {\lVert \vlambda - \bar{\vlambda} \rVert}_2^2,
  \end{align*}
  which is tight.

  Applying \cref{eq:peterpaul}, we have
  \begin{align}
    \mathbb{E}_{\rvvz \sim q_{\vlambda}} {\lVert \nabla_{\vlambda} f\left( \rvvz \right) \rVert}_2^2
    &\leq
    L^2 \left( d + k_{\varphi} \right) {\lVert \vlambda - \bar{\vlambda} \rVert}_2^2
    \nonumber
    \\
    &=
    L^2 \left( d + k_{\varphi} \right) {\lVert \vlambda - \vlambda^* + \vlambda^* - \bar{\vlambda} \rVert}_2^2
    \nonumber
    \\
    &\leq
    L^2 \left( d + k_{\varphi} \right) \left( \left(1 + \delta \right) {\lVert \vlambda - \vlambda^* \rVert}_2^2 + \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2 \right).
    \label{eq:thm_cfe_energy}
  \end{align}
  
  Now, for \(\vlambda \in \Lambda_S\),~\citet[Theorem 1 \& Lemma 12]{domke_provable_2020} show that the negative ELBO \(F\) is (\(L + S\))-smooth as
  \begin{align}
    \norm{ \nabla F\left(\vlambda\right) }_2^2
    =
    \norm{ \nabla F\left(\vlambda\right) - \nabla F\left(\vlambda^*\right) }_2^2
    \leq 
    {\left(L + S \right)}^{2} \norm{ \vlambda - \vlambda^* }_2^2.
    \label{eq:thm_cfe_entropy}
  \end{align}

  Now back to \cref{eq:thm_cfe},
  \begin{align*}
    \mathbb{E} \norm{ \rvvg_{\mathrm{CFE}}\left(\vlambda\right) }_2^2
    &\leq
    \mathbb{E}_{\rvvz \sim q_{\vlambda}} \norm{ \nabla_{\vlambda} f\left( \rvvz \right) }_2^2
    +
    \norm{ \nabla F\left(\vlambda\right) }_2^2
\shortintertext{applying \cref{eq:thm_cfe_energy},}
    &\leq
    L^2 \left( d + k_{\varphi} \right) \left( \left(1 + \delta \right) {\lVert \vlambda - \vlambda^* \rVert}_2^2 + \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2 \right)
    +
    \norm{ \nabla F\left(\vlambda\right) }_2^2
\shortintertext{and \cref{eq:thm_cfe_entropy},}
    &\leq
    L^2 \left( d + k_{\varphi} \right) \left( \left(1 + \delta \right) {\lVert \vlambda - \vlambda^* \rVert}_2^2 + \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2 \right)
    +
    {\left(L + C \right)}^{2} \norm{ \vlambda - \vlambda^* }_2^2
    \\
    &=
    \left( L^2 \left( d + k_{\varphi} \right) \left(1 + \delta\right) + {\left(L + C \right)}^{2} \right) {\lVert \vlambda - \vlambda^* \rVert}_2^2 
    +
    L^2 \left( d + k_{\varphi} \right) \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2.
  \end{align*}
\end{proofEnd}


\begin{theoremEnd}[all end, category=cfeupperboundmf]{theorem}\label{thm:cfe_upperbound_mf}
  Assume \cref{assumption:variation_family} and that \(\pi\) is \(L\)-log-smooth.
  For the mean-field parameterization, the expected-squared norm of the CFE estimator is bounded as
  \begin{align*}
    \mathbb{E} \norm{ \rvvg_{\mathrm{CFE}}\left(\vlambda\right) }_2^2
    &\leq
    \big(
    \left(2 k_{\varphi} \sqrt{d} + 1 \right) 
    \left(1 + \delta \right)
    +
    {\left(L + S \right)}^{2}
    \big)
    {\lVert \vlambda - \vlambda^* \rVert}_2^2
    \\
    &\quad+
    \left(2 k_{\varphi} \sqrt{d} + 1 \right) \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2.
  \end{align*}
  for any \(\vlambda \in \Lambda_S\) and \(\delta \geq 0\), where \(\bar{\vlambda} = \left(\bar{\vz}, \mathbf{0}\right)\) and \(\bar{\vz}\) is any stationary point of \(f\).
\end{theoremEnd}
\begin{proofEnd}
  For the mean-field case, the only difference with \cref{thm:cfe_upperbound} is the upper bound on the energy term.
  The key step is the mean-field part of \cref{thm:normdist_1pnormu}, first proven by \citet{kim_practical_2023}.
  The remaining steps are similar to Theorem 1 of \citet{kim_practical_2023}.
  That is,
  \begin{align*}
    \mathbb{E}_{\rvvz \sim q_{\vlambda}} \norm{ \nabla_{\vlambda} f\left( \rvvz \right) }_2^2
    &=
    \mathbb{E} \norm{ \nabla_{\vlambda} f\left( \mathcal{T}_{\vlambda}\left(\rvvu\right) \right) }_2^2,
\shortintertext{applying \cref{thm:jacobian_reparam_inner},}
    &=
    \mathbb{E} J_{\mathcal{T}}\left(\rvvu\right) \norm{ \nabla f\left( \mathcal{T}_{\vlambda}\left(\rvvu\right) \right) }_2^2
    =
    \mathbb{E} J_{\mathcal{T}}\left(\rvvu\right) \norm{ \nabla f\left( \mathcal{T}_{\vlambda}\left(\rvvu\right) \right) - \nabla f\left(\bar{\vz}\right) }_2^2,
\shortintertext{from \(L\)-smoothness of \(f = \log \pi\),}
    &\leq
    L^2 \, J_{\mathcal{T}}\left(\rvvu\right) \mathbb{E} \norm{ \mathcal{T}_{\vlambda}\left(\rvvu\right) - \bar{\vz} }_2^2,
\shortintertext{applying \cref{thm:normdist_1pnormu},}
    &\leq
    L^2 \left(\sqrt{dk_{\varphi}} + k_{\varphi} \sqrt{d} + 1 \right) \norm{ \vm - \bar{\vz} }_2^2 + L^2 \left(2 k_{\varphi} \sqrt{d} + 1\right) \norm{\mC}_{\mathrm{F}}^2.
\shortintertext{and since \(k_{\varphi} \geq 1\), we have \(k_{\varphi} > \sqrt{k_{\varphi}}\), and thus}
    &\leq
    L^2 \left(2 k_{\varphi} \sqrt{d} + 1 \right) \left( \norm{ \vm - \bar{\vz} }_2^2 +  \norm{\mC}_{\mathrm{F}}^2 \right)
    \\
    &=
    L^2 \left(2 k_{\varphi} \sqrt{d} + 1 \right) {\lVert \vlambda - \bar{\vlambda} \rVert}_2^2.
\shortintertext{We finally apply \cref{eq:peterpaul} as}
    &\leq
    L^2 \left(2 k_{\varphi} \sqrt{d} + 1 \right)
    \left(
      \left(1 + \delta \right) {\lVert \vlambda - \vlambda^* \rVert}_2^2
      + \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2
    \right).
  \end{align*}

  Combining this with \cref{eq:thm_cfe,eq:thm_cfe_entropy}, we have
  \begin{align*}
    \mathbb{E} \norm{ \rvvg_{\mathrm{CFE}}\left(\vlambda\right) }_2^2
    &=
    \mathbb{E}_{\rvvz \sim q_{\vlambda}} \norm{ \nabla_{\vlambda} f\left( \rvvz \right) }_2^2
    +
    \norm{ \nabla F\left(\vlambda\right) }_2^2
\shortintertext{and applying \cref{eq:thm_cfe_energy},}
    &\leq
    \mathbb{E}_{\rvvz \sim q_{\vlambda}} \norm{ \nabla_{\vlambda} f\left( \rvvz \right) }_2^2
    +
    {\left(L + S \right)}^{2} \norm{ \vlambda - \vlambda^* }_2^2
    \\
    &\leq
    \left(2 k_{\varphi} \sqrt{d} + 1 \right)
    \left(
      L^2 \left(1 + \delta \right) {\lVert \vlambda - \vlambda^* \rVert}_2^2
      + L^2 \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2
    \right)
    \\
    &\qquad+
    {\left(L + S \right)}^{2} \norm{ \vlambda - \vlambda^* }_2^2
    \\
    &=
    \left(
    \left(2 k_{\varphi} \sqrt{d} + 1 \right) 
    L^2 \left(1 + \delta \right)
    +
    {\left(L + S \right)}^{2}
    \right)
    {\lVert \vlambda - \vlambda^* \rVert}_2^2
    \\
    &\qquad+
    L^2 \left(2 k_{\varphi} \sqrt{d} + 1 \right) \left(1 + \delta^{-1} \right) {\lVert \vlambda^* - \bar{\vlambda} \rVert}_2^2.
  \end{align*}

\end{proofEnd}
