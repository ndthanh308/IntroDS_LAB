
\begin{theoremEnd}[category=gradvarlemmas,all end]{lemma}\label{thm:peterpaul}
  For any \(a, b, c, \in \mathbb{R}\), 
  \[ {(a+b+c)}^2 \leq (2 + \delta ) a^2 + (2 + \delta ) b^2 + (1 + 2 \delta^{-1})  c^2, \]
  for any \(\delta > 0\).
\end{theoremEnd}
\begin{proofEnd}
The Peter-Paul generalization of Young's inequality states that, for \(d, e \geq 0\), we have
\[
   d e \leq \frac{\delta }{2} d^2 + \frac{\delta^{-1}}{2} e^2.
\]
Applying this,
\begin{align*}
  {(a+b+c)}^2
  &\;=
  a^2 + b^2 + c^2 + 2 a b + 2 a c + 2 b c
  \\
  &\;\leq
    a^2 + b^2 + c^2 + 2 \abs{a} \abs{b} + 2 \abs{a} \abs{c} + 2 \abs{b} \abs{c}
  \\
  &\;\leq
  a^2 + b^2 + c^2 
  + 2 \left( \frac{1}{2} a^2 + \frac{1}{2} b^2 \right)
  + 2 \left( \frac{\delta}{2} a^2 + \frac{\delta^{-1}}{2} c^2 \right)
  + 2 \left( \frac{\delta}{2} b^2 + \frac{\delta^{-1}}{2} c^2 \right) 
  \\
  &\;=
  a^2 + b^2 + c^2 + \left( a^2 +  b^2 \right)
  + \left( \delta a^2 + \delta^{-1} c^2 \right)
  + \left( \delta b^2 + \delta^{-1} c^2 \right) 
  \\
  &\;=
  \left(2 + \delta\right) a^2 + \left(2 + \delta\right) b^2 + \left(1 + 2 \delta^{-1}\right) c^2.
\end{align*}
\end{proofEnd}


\begin{theoremEnd}[category=stlupperboundlemma]{lemma}\label{thm:stl_decomposition}
{\setlength{\belowdisplayskip}{1.5ex} \setlength{\belowdisplayshortskip}{1.5ex}
\setlength{\abovedisplayskip}{1.ex} \setlength{\abovedisplayshortskip}{1.ex}
%
  Assume \cref{assumption:variation_family}.
  The expected-squared norm of STL is bounded as
  {\small
  \begin{align*}
    \mathbb{E} \norm{\rvvg_{\mathrm{STL}}\left(\vlambda\right)}_2^2
    \leq
    \left( 2 + \delta \right) V_{1}
    +
    \left( 2 + \delta \right) V_{2}
    +
    \left( 1 + 2 \delta^{-1} \right) V_{3},
  \end{align*}
  }%%
  where the terms are
  {\small
  \begin{align*}
    V_{1}
    &=
    \mathbb{E} \,
    J_{\mathcal{T}}\left(\rvvu\right) 
    \lVert
    \nabla \log \ell \left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right) 
    -
    \nabla \log \ell \left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right) 
    {\rVert}_2^2
    \\
    V_{2}
    &=
    \mathbb{E} \,
    J_{\mathcal{T}}\left(\rvvu\right)
    \lVert
    \nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    - 
    \nabla \log q_{\vlambda}\left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right)
    {\rVert}_2^2
    \\
    V_{3}
    &=
    \mathbb{E} \,
    J_{\mathcal{T}}\left(\rvvu\right)
    \lVert
    \nabla \log \ell\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    - 
    \nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    {\rVert}_2^2,
  \end{align*}
  }%%
  for any \(\delta > 0\) and \(\vlambda \in \mathbb{R}^p\).
  \(J_{\mathcal{T}} : \mathbb{R}^d \to \mathbb{R}\) is a function depending on the variational family as
  \begin{alignat*}{2}
    J_{\mathcal{T}}\left(\rvvu\right) &= 1 + {\textstyle\sum^{d}_{i=1} \rvu_i^2} \quad                        &&\quad \text{for full-rank and} \\
    J_{\mathcal{T}}\left(\rvvu\right) &= 1 + {\textstyle\sqrt{\sum^{d}_{i=1} \rvu_i^4}} &&\quad \text{for mean-field.}
  \end{alignat*}
 }%
\end{theoremEnd}
\begin{proofEnd}
From the definition of the STL estimator~\cref{def:stl},
\begin{align*}
    \mathbb{E} \norm{\rvvg_{\mathrm{STL}}\left(\vlambda\right)}_2^2
    &=
    \mathbb{E} \norm{
    \nabla_{\vlambda} \log \ell \left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right) - \nabla_{\vlambda} \log q_{\vnu}\left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right)
    }_2^2
    \;\Big\lvert_{\vnu = \vlambda},
\shortintertext{by \cref{thm:jacobian_reparam_inner},}
    &=
    \mathbb{E}
    J_{\mathcal{T}}\left(\rvvu\right)
    \norm{
    \nabla \log \ell \left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right) 
    - \nabla \log q_{\vnu}\left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right)
    }_2^2
    \;\Big\lvert_{\vnu = \vlambda}
\shortintertext{adding the terms \(\nabla \log \ell \left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)\) and \(\nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)\) that cancel,}
    &=
    \mathbb{E}
    J_{\mathcal{T}}\left(\rvvu\right)
    \lVert
    \nabla \log \ell \left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right) 
    -
    \nabla \log \ell \left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right) 
    \\
    &\quad\qquad\qquad+
    \nabla \log \ell\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    - 
    \nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    \\
    &\quad\qquad\qquad+
    \nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    - 
    \nabla \log q_{\vlambda}\left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right)
    {\rVert}_2^2,
\shortintertext{applying \cref{thm:peterpaul},}
    &\leq
    \mathbb{E}
    J_{\mathcal{T}}\left(\rvvu\right)
    \Big(
    \left( 2 + \delta \right)
    \lVert
    \nabla \log \ell \left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right) 
    -
    \nabla \log \ell \left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right) 
    {\rVert}_2^2
    \\
    &\quad\qquad\qquad+
    \left( 2 + \delta \right)
    \lVert
    \nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    - 
    \nabla \log q_{\vlambda}\left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right)
    {\rVert}_2^2
    \\
    &\quad\qquad\qquad+
    \left(1 + 2 \delta^{-1}\right)
    \lVert
    \nabla \log \ell\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    - 
    \nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    {\rVert}_2^2
    \Big),
\shortintertext{and distributing \(J_{\mathcal{T}}\) and the expectation,}
    &=
    \left( 2 + \delta \right)
    \underbrace{
    \mathbb{E}
    J_{\mathcal{T}}\left(\rvvu\right)
    \lVert
    \nabla \log \ell \left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right) 
    -
    \nabla \log \ell \left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right) 
    {\rVert}_2^2
    }_{V_{1}}
    \\
    &\quad+
    \left( 2 + \delta \right)  
     \underbrace{
    J_{\mathcal{T}}\left(\rvvu\right)
    \mathbb{E}
    \lVert
    \nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    - 
    \nabla \log q_{\vlambda}\left(\mathcal{T}_{\vlambda}\left(\rvvu\right)\right)
    {\rVert}_2^2
    }_{V_{2}}
    \\
    &\quad+
    \left(1 + 2 \delta^{-1}\right)  
    \underbrace{
    \mathbb{E}
    J_{\mathcal{T}}\left(\rvvu\right)
    \lVert
    \nabla \log \ell\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    - 
    \nabla \log q_{\vlambda^*}\left(\mathcal{T}_{\vlambda^*}\left(\rvvu\right)\right)
    {\rVert}_2^2
    }_{V_{3}}.
\end{align*}
\end{proofEnd}