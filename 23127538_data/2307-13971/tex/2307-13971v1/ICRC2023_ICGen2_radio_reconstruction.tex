% Please make sure you insert your data according to the instructions in PoSauthmanual.pdf
\documentclass[a4paper,11pt]{article}

\usepackage{amsmath}
\usepackage{pos}

%Code to make the reference spacing smaller
\newlength{\bibitemsep}\setlength{\bibitemsep}{.2\baselineskip plus .05\baselineskip minus .05\baselineskip}
\newlength{\bibparskip}\setlength{\bibparskip}{-4pt}
\let\oldthebibliography\thebibliography
\renewcommand\thebibliography[1]{%
	\oldthebibliography{#1}%
	\setlength{\parskip}{\bibitemsep}%
	\setlength{\itemsep}{\bibparskip}%
}


%TODO
% - Add references for TDR,
% - Acknowledge Christian's work on the simulations
% - Shorten algorithm improvements section?
% - rename alternative detector layouts? (e.g. alt1, alt2 -> A1, A2, alt3 -> B1, ...)
%TODO to be decided
% - Discuss analysis / quality cuts? (e.g. figures/cdfs_all_4.pdf / figures/2d_cdf_AC_vE_2_v2.pdf)
% - Quote numerical results?

\title{Direction reconstruction for the in-ice radio array of IceCube-Gen2}

\ShortTitle{Direction reconstruction for the in-ice radio array of IceCube-Gen2}

% Don't change:
\author{The IceCube-Gen2 Collaboration \\{\normalsize \normalfont(a complete list of authors can be found at the end of the proceedings)}\\}

% Your emails:
\emailAdd{sjoerd.bouma@fau.de}
\emailAdd{anna.nelles@desy.de}


\abstract{

% start of abstract
% The IceCube-Gen2 facility will extend the energy range of IceCube to ultra-high energies. The key component to detect neutrinos with energies above 10 PeV is a large array of in-ice radio detectors. In previous work, a direction reconstruction algorithm for this type of detector has been developed for the Radio Neutrino Observatory in Greenland (RNO-G), using the forward-folding technique. A similar algorithm has also been successfully used to reconstruct cosmic rays with ARIANNA.
%%% is this better? 
The IceCube-Gen2 facility will extend the energy range of IceCube to ultra-high energies. The key component to detect neutrinos with energies above 10 PeV is a large array of in-ice radio detectors. In previous work, direction reconstruction algorithms using the forward-folding technique have been developed for both shallow ($\lesssim 20$ m) and deep in-ice detectors, and have also been successfully used to reconstruct cosmic rays with ARIANNA. Here, we focus on the reconstruction algorithm for the deep in-ice detector, which was recently introduced in the context of the Radio Neutrino Observatory in Greenland (RNO-G).

We discuss the performance-critical aspects of the algorithm, as well as recent and future improvements, and apply it to study the performance of a station of the IceCube-Gen2 in-ice radio array. We obtain the angular resolution, which turns out to be strongly asymmetric, and use this to optimize the configuration of a single station.
% end of abstract

\vspace{4mm}
{\bfseries Corresponding authors:}
Sjoerd Bouma$^{1}$, Anna Nelles$^{1,2*}$\\
{$^{1}$ \itshape Erlangen Centre for Astroparticle Physics, Friedrich-Alexander-Universit{\"a}t Erlangen-N{\"u}rnberg, D-91058 Erlangen, Germany}\\
{$^{2}$ \itshape Deutsches Elektronen-Synchrotron DESY, Platanenallee 6, 15738 Zeuthen, Germany}\\[4mm]
$^*$ Presenter

\ConferenceLogo{PoS_ICRC2023_logo.pdf}

\FullConference{The 38th International Cosmic Ray Conference (ICRC2023)\\ 26 July -- 3 August, 2023\\ Nagoya, Japan}
}

\begin{document}

\maketitle

\section{Introduction}\label{sec:introduction}
The in-ice radio array of IceCube-Gen2 will extend the energy range of the facility to ultra-high energies (UHE) above 10 PeV by exploiting the radio emission of in-ice particle showers due to the Askaryan effect. The in-ice radio array is planned to consist of both hybrid detector stations, with both shallow and deep ($\sim150$ m) antennas, as well as shallow-only stations \cite{TDR}. At completion, the array will cover about 500 km$^2$ and improve on current detectors by an order of magnitude in sensitivity, providing the best chance yet of measuring the flux at this previously inaccessible energy range, as well as establishing a direct connection between the highest-energy cosmic rays and neutrinos.
To improve the likelihood of their cosmic origin, and enable neutrino astronomy at these energies, the ability to reconstruct the direction of triggering neutrino events is crucial. 
% A reconstruction algorithm for shallow-only stations was introduced in \cite{Barwick:2021wU}.  %We first provide a brief explanation of the reconstruction algorithm in Sec.~\ref{sec:algorithm}, in which we also outline improvements made with respect to the original paper. The performance of the baseline Gen2 deep in-ice station is evaluated for different neutrino energies in Sec.~\ref{sec:performance}. Finally, we repeat this study for different detector layouts and comment on possible improvements in Sec.~\ref{sec:comparison}.


\section{The reconstruction algorithm}\label{sec:algorithm}
The reconstruction algorithm used in these proceedings is the forward-folding algorithm \cite{Glaser:2019rxw,Barwick:2021wU,Arianna:2021lnr,Plaisier:2023cxz}. The forward-folding technique has been successfully used to reconstruct cosmic rays with the shallow upward-facing antennas  \cite{Arianna:2021lnr} and has been applied to the shallow detector component of IceCube-Gen2 finding an average resolution of the neutrino direction of $\sigma_{68\%}= 3^\circ$ \cite{Barwick:2021wU}. As most events that are detected by the deep component are not expected to be visible in the shallow antennas, an improved algorithm for these events has been developed in \cite{Plaisier:2023cxz} and applied to an RNO-G like detector in Greenland. Here, we apply this algorithm to study the expected performance of the deep component of a single station of IceCube-Gen2. The algorithm is available as part of the open-source NuRadioMC framework \cite{Glaser:2019cws}. In this section, we only provide a brief summary of this algorithm; for more details, we refer to \cite{Plaisier:2023cxz}.

The reconstruction relies on two features of the Askaryan effect that causes the radio emission which is detected. Firstly, the shape of the frequency spectrum depends on the \textbf{viewing angle} under which the signal is observed at the detector. The closer this is to the Cherenkov angle ($\approx 56^\circ$ in deep polar ice), the larger the contribution of higher frequency components. Secondly, the polarization vector points towards the shower axis. Thus, the combined determination of the \textbf{signal emission direction}, \textbf{viewing angle} and \textbf{polarization} is sufficient to uniquely determine the direction of the original neutrino. This is illustrated in Fig.~\ref{fig:onsky_didactic}.

% Figure environment removed

These requirements inform the design of a deep in-ice detector. As most events are expected to be detected only in a single detector station, each of these consists of three vertical 'strings' in a triangular configuration, to enable the determination of the emission vertex. These strings are populated with omnidirectional antennas that are sensitive either to vertically polarized ('Vpol') or horizontally polarized ('Hpol') signals at various depths, which provide sensitivity to the signal polarization. A sketch of the reference design for the deep component for IceCube-Gen2 is shown in Fig.~\ref{fig:detector_layouts}.%\ref{sec:comparison}

In order to limit the computation time required to reconstruct a single event, the current approach is to split the reconstruction into two steps. The first step is to reconstruct the position of the shower maximum, which is treated as the origin of the radio signal using a ray-tracing approximation. The algorithm used for this step is heavily based on the one outlined in \cite{Aguilar:2021uzt}, referred to therein as vertex reconstruction. Note that, however, the position of the shower maximum is not the same as the neutrino interaction vertex; the difference is of the order of 10 m for hadronic showers, and up to an order of magnitude larger for high-energy electromagnetic showers subject to the LPM effect.
An additional complication arises due to the fact that the index of refraction in polar ice is not constant. This results in multiple curved and possibly reflected ray trajectories, referred to as 'ray types'. The obtained signal direction therefore depends also on the ice model and the 'ray type'. For the former, we use the simple exponential SPICE 2015 model described in \cite{Barwick_2018} both in simulation and reconstruction; the impact of systematic uncertainties and features such as layers or birefringence is beyond the scope of this work. The dominant ray type is subsequently identified by template correlation.

The second part of the reconstruction is the determination of the viewing angle and polarization. This is done using a 'forward-folding' approach: the modelled Askaryan signal is propagated through the ice and convolved with the detector response, after which the $\chi^2$ statistic is computed and minimized between the measured and modelled voltage traces. For in-ice radio detectors, this approach was shown to offer superior performance in the reconstruction of cosmic rays, particularly at low signal-to-noise ratios (SNR), compared to traditional 'unfolding' methods \cite{Glaser:2019rxw}.

With respect to the algorithm described in \cite{Plaisier:2023cxz}, a small number of changes and improvements has been made:
\begin{enumerate}
%	\item Previously, in order to avoid getting stuck in a local minimum, the fit used a brute-force approach, scanning over all viewing angles, polarizations and shower energies. For this work, a traditional minimizer was implemented in addition, which after an initial run is started also at the most common (approximately) degenerate solutions, i.e.\ with the opposite-signed polarization and in/outside the Cherenkov cone. In $\sim 90 \%$ of cases, the same (global) minimum is found as in the brute-force approach, but the computation time is reduced by more than an order of magnitude, enabling (relatively) cheap studies to e.g.\ compare the performance of different detector layouts, as done here.
	\item A minimizer, which is initialized at the most common degenerate solutions, has been implemented in addition to the existing brute-force optimization. In $\sim 90 \%$ of cases, the same (global) minimum is found as previously, but the computation time is reduced by more than an order of magnitude, enabling (relatively) efficient studies to e.g.\ compare the performance of different detector layouts, as done here.
	\item Due to imperfect vertex reconstruction and, in more realistic scenarios, slight mismodelling of the detector geometry or the ice, the exact pulse arrival time at each antenna has to be determined by an additional correlation step. For very low SNR pulses, this will select and fit a random noise fluctuation, resulting in an overestimation of the actual signal contribution in this antenna. This is prevented in two ways; antennas below a certain SNR threshold are excluded from the fit, and for Hpol antennas (which generally have much less signal than the Vpol antennas), the timing is determined from an adjacent Vpol antenna that does pass the threshold. This latter strategy was previously used only for the Hpol antennas on the central string, but has now also been implemented for the secondary strings.
	\item Finally, the algorithm in \cite{Plaisier:2023cxz} was designed to reconstruct hadronic showers only. As in reality a mix of hadronic and electromagnetic showers is expected, a fit for electromagnetic showers has been implemented, and the event is tagged based on which hypothesis results in the overall minimum $\chi^2$. For low to medium quality events, this tagging is fairly inaccurate, but does not noticeably deteriorate performance, whereas the resolution for high-quality electromagnetic-dominated events is improved.
\end{enumerate}


\section{Performance}\label{sec:performance}
The performance of the algorithm is evaluated by simulating neutrinos at half-decade intervals ranging from $E_\nu=10^{16.5}-10^{19.0}$ eV using NuRadioMC \cite{Glaser:2019cws}. We include both hadronic and electromagnetic (due to $\nu_e$ charged-current interactions) events, assuming a 1:1:1 flavour ratio at the detector. The semi-analytical model described in \cite{Alvarez-Muniz:2011wcg}, which includes different stochastic realizations of the shower profile, is used for the simulation. The reconstruction is performed using a fully analytic model \cite{Alvarez-Muniz:2010hbb}. The detector layout used is the 'reference' design \cite{TDR} for an IceCube-Gen2 hybrid detector, with a 4-channel phased-array at 150 m depth used for triggering at a target trigger rate of 100 Hz.

The results of the reconstruction are %defined as the angle between the true and reconstructed quantity, is 
shown separately for each aspect of the reconstruction in Fig.~\ref{fig:1d_cdfs_vE}. We distinguish different simulated neutrino energies, and additionally show results both for hadronic events only ('Had') and those for the overall mix of hadronic and hadronic+electromagnetic events ('All').


% Figure environment removed

Particularly at low energies, the overall reconstruction is limited by the performance of the shower maximum reconstruction, which determines the signal direction. These relatively low-energy events are generally lower in SNR, and originate from closer to the detector and nearer to the ice surface. They are more challenging to reconstruct in general, but especially for the shower maximum reconstruction, which requires a signal in all three strings and at least two different depths to be unambiguous. If either the position of the shower maximum or the appropriate ray type is not determined successfully, this may additionally impact the subsequent aspects of the reconstruction by assuming the wrong pulse position within the voltage traces.

If the shower maximum reconstruction is successful, the overall error is instead dominated by the error on the polarization angle. This is due both to the much larger phase space for this quantity compared to the viewing angle, which is constrained to lie within a couple of degrees of the Cherenkov angle, and the fact that the Hpol antennas are less sensitive and generally record a much smaller contribution than the Vpol antennas.

In general, the reconstruction performs best for the 'middle' energies. At the lowest energies, the lower SNR and more challenging shower maximum reconstruction strongly limit the fraction of triggered events that can be reconstructed well. At the highest energies, as the shower shapes become more irregular, performance once again starts to decrease. Finally, the performance for electromagnetic events at low energies is slightly better than that for purely hadronic events. This can be partially explained by considering that for electromagnetic events, the entire neutrino energy is deposited in the particle showers, leading to a larger signal amplitude at the detector.


%comment on the overall fraction of well-reconstructed events; trend with energy; plot with quality cuts?;
%The overall resolution obtained here is similar to that obtained in \cite{Plaisier:2023cxz} for an RNO-G-like detector in Greenland. However

%% Figure environment removed

% Figure environment removed

Because the overall error is dominated by the polarization, we do not quote the space angle difference. Instead, we proceed as follows: we project the reconstructed neutrino direction onto a frame where the polarization direction lies along the x-axis, and the viewing angle direction along the y-axis. This is shown in Fig.~\ref{fig:2d_cdfs_vE}, left. We then quote the fraction of reconstructed events contained within the area of an elongated ellipse centred on the true neutrino direction. This gives a more accurate impression of the actual 2d spread of the reconstruction algorithm; however, it should be stressed that the area within which a single event reconstructs does \textbf{not} allow to make inferences on the true single-event uncertainty, which may be smaller or larger. A procedure to determine single-event uncertainty contours using resimulation has been described in \cite{Plaisier:2023cxz}; as this process takes of the order of several hours per event, we do not use this here. 

Instead, we show how the resolution can be improved by applying an analysis cut, which is here defined by requiring a minimum SNR of 2.5 in two antennas on the central string, of which at least one should be at a different depth than the phased array, as well as an SNR $>2$ on at least one antenna in both of the secondary strings. The fraction of events retained at each energy after this cut is shown on the right of Fig.~\ref{fig:2d_cdfs_vE}. Note that this cut has been defined based on the true (simulated) signal SNR in the [96, 500] MHz band; it is expected that a similar cut can be defined based on data with a moderate loss of either efficiency or resolution.

\section{Comparison of different layouts}\label{sec:comparison}
In addition to evaluating the performance of the 'reference' design of the IceCube-Gen2 hybrid radio station, we have also performed the reconstruction for several alternative detector layouts. 
In order to be able to compare the performance of different layouts consistently, the simulation was only performed once, using an 'overinstrumented' detector containing all antennas one wants to consider. As the trigger remains the same for all layouts considered here, the same events can be used for the comparison by simply changing the antennas used in the reconstruction.

% Figure environment removed

A sketch of all layouts used in this study is shown in Fig.~\ref{fig:detector_layouts}. 
All designs include 16 deep in-ice antennas, leaving 8 of the total 24 DAQ channels for the shallow component.
%All designs were subject to the constraint that the total number of deep in-ice antennas was limited to 16 
In addition to the reference design, we further consider:
\begin{itemize}
	\item The \textbf{alt1} and \textbf{alt2} designs increase the horizontal baseline of the three strings. A larger baseline helps to more accurately constrain the position of the shower maximum, and may also help to constrain the polarization by mapping out the Cherenkov cone, at the cost of the loss of SNR as one goes away further from the triggering antenna.
	\item The \textbf{alt3} layout moves all four Hpol antennas to the central string. In general, the highest SNR is expected close to the triggering antennas; having all four Hpol antennas directly above the phased array may therefore help to increase the signal contribution in these antennas.
	\item Finally, the \textbf{alt4} and \textbf{alt5} designs move the two shallower Vpol antennas deeper. A signal in one of the upper Vpol antennas can provide a strong additional constraint in the reconstruction, particularly for the position of the shower maximum. However, due to their relatively large separation from the triggering channels, as well as the 'shadow-zone' \cite{Barwick_2018} due to the downward-bending of in-ice radio signals, detectable signals in these antennas are rare, motivating these designs with smaller vertical baselines, which are expected to contribute for a larger fraction of triggered events.
\end{itemize}




The results for each configuration are shown in Fig.~\ref{fig:comparison}. They show the improvement in performance as the additional fraction of events that reconstructed within a certain resolution, i.e.\ the difference between the respective CDFs. We compare the performance across all energies by reweighting with the expected flux at the detector, assuming a single power-law spectrum \cite{IceCube_flux} plus a GZK component from cosmogenic neutrinos \cite{GZK}. Only hadronic events were included for the comparison, although as only the performance relative to the reference is shown here, the impact of excluding electromagnetic events here can be assumed to be small.

% Figure environment removed

We make the following observations: Increasing the horizontal baseline (configurations alt1, alt2) mainly improves the precision of the signal direction determination, but only for the $\sim30\%$ best events. The error for these events, however, is dominated by the uncertainties on viewing angle and polarization, where no clear improvement is observed. For lower quality events, on the other hand, the lower signal contribution in the now further-away secondary strings hinders the reconstruction of the shower maximum, especially for the largest baseline (alt2).

Moving all four Hpol antennas to the central string (alt3) does not affect the signal direction reconstruction, which relies only on the Vpol antennas. No clear improvement is shown for the viewing angle or polarization reconstruction, either, however. (Note that, before improvement 2 in Sec.~\ref{sec:algorithm} had been implemented, this configuration did show a $\sim5\%$ improvement in the number of events reconstructed with a polarization error of $\le 10^\circ$).

Finally, replacing the two uppermost Vpol antennas with deeper antennas (alt4, alt5) significantly increases the fraction of events with a signal direction reconstructed within O(1) deg, without negatively impacting the resolution obtained by the other parts of the algorithm. Most of the improvement, however, seems to apply to low or medium quality events, such that the increase in the fraction of events reconstructing within a certain area is relatively modest.
%\begin{itemize}
%	\item Increasing the horizontal baseline (configurations alt1, alt2) mainly improves the precision of the signal direction determination, but only for the $\sim30\%$ best events. The error for these events, however, is dominated by the uncertainties on viewing angle and polarization, where no clear improvement is observed. For lower quality events, on the other hand, the lower signal contribution in the now further-away secondary strings hinders the reconstruction of the shower maximum, especially for the largest baseline (alt2).% starts to struggle to correctly reconstruct the position of the shower maximum as the signal in the now further-away secondary strings. 
	% \item Moving all four Hpol antennas to the central string does not affect the signal direction reconstruction, which relies only on the Vpol antennas. No clear improvement is shown for the viewing angle or polarization reconstruction, either, however. (Note that, before improvement 2 in Sec.~\ref{sec:algorithm} had been implemented, this configuration did show a $\sim5\%$ improvement in the number of events reconstructed with a polarization error of $\le 10^\circ$).
% 	\item Replacing the two uppermost Vpol antennas with deeper antennas (alt4, alt5) significantly increases the fraction of events with a signal direction reconstructed within O(1) deg, without negatively impacting the resolution obtained by the other parts of the algorithm. Most of the improvement, however, seems to apply to low or medium quality events, such that the increase in the fraction of events reconstructing within a certain area is relatively modest.
% \end{itemize}

In general, the impact of changing the detector configuration is not dramatic, and larger improvements are expected by further refinements of the reconstruction algorithm, or the use of machine-learning based approaches such as \cite{Glaser:2022lky, Heyer:2023}.

\section{Conclusion}\label{sec:conclusion}
We have applied the forward-folding reconstruction algorithm outlined in \cite{Plaisier:2023cxz} to the reference design for the deep component of the in-ice radio detector of IceCube-Gen2. Although the detector, ice and exact trigger configuration are different, the overall resolution obtained is similar to that for the RNO-G-like station in \cite{Plaisier:2023cxz} for purely hadronic events, and slightly improved for events with electromagnetic showers, thanks to the addition of a new step in the fitting algorithm. As in that work, the resolution obtained is much larger in one direction than in the other, necessitating a full 2D treatment in order to accurately capture the actual uncertainty.
In the second part, we have compared the performance of different layouts of the deep component. We conclude that, in particular for the viewing angle and the polarization, the exact positioning of the additional Vpol antennas only has a minor impact on the reconstruction. Conversely, the reconstruction of the signal direction is shown to improve for designs which move some of the shallower Vpol antennas closer to the bottom of the station, which on average increases the number of channels with a detectable signal contribution. %We suggest that these designs warrant further study.


%\begin{acknowledgements}
%We thank C.\ Glaser for setting up and providing the initial simulations, on which the simulations used in this work were based.
%\end{acknowledgements}
% Bibtex references:
\bibliographystyle{ICRC}
\bibliography{references}

% Alternatively, you can include references by hand:
%\begin{thebibliography}{99}
%\bibitem{...}
%
%\end{thebibliography}

\clearpage

%The following list of authors, affiliations and funding agencies will be updated at the day of submission. The following template is a placeholder generated via https://authorlist.icecube.wisc.edu/icecube on March 25, 2023 and will be updated.
\input{authorlist_IC_Gen2.tex}

\end{document}
