\section{Construction of the Catalog}
\label{catalog_main}

Most of the steps were identical to DR3.
We use the same Test Statistic TS = 2 $\log (\mathcal{L} / \mathcal{L}_0)$ to quantify how significantly a source emerges from the background, comparing the maximum value of the likelihood function $\mathcal{L}$ including the source in the model with $\mathcal{L}_0$, the value without the source.

\subsection{Extended sources}

\input{DR4_extended.tex}

We updated the extended sources (Table~\ref{tbl:extended}). Multiwavelength templates were adopted for the Cygnus Loop and Puppis A, reducing the residuals considerably with respect to the previous geometric models while eliminating the two point sources inside the Cygnus Loop, which were only excess emission on top of the previous ring template. For the Cygnus Loop, we used only the single UV template rather than the more complex two-component representation advocated by \citet{CygnusLoop_Tutone21}. For Puppis A, we chose the eROSITA image above 1 keV \citep{PuppisA_Mayer22} because above that energy the bias on the X-ray intensity due to interstellar absorption is minimal.

In conjunction with the preparation of the Third \Fermi-LAT Pulsar Catalog \citep[3PC,][]{LAT23_3PC}, we added three extended sources around known pulsars, when their spectral analysis indicated a high-energy excess. 3C 58 is certainly a pulsar wind nebula (PWN) but the $\gamma$-ray emission in CTB 80 and G292.2$-$0.5 could also come partly from a surrounding supernova remnant (SNR). The broadest one, CTB 80, was represented by the disk fit to the LAT data by \citet{CTB80_Araya21}, eliminating 4FGL J1955.1+3321. The two smallest were represented by Gaussian shapes. For G292.2$-$0.5 we took the TeV size from the H.E.S.S. Galactic Plane Survey. For 3C 58 we used the radio size \citep{3C58_radio06}. For simplicity we ignored the elongation (the source is smaller than the PSF, so it is not critical). This one is so small (Gaussian $\sigma = 0.03\degr$) that the pulsar and the PWN cannot be separated  when building the spectral energy distribution (SED), leading to large fluctuations in the individual spectra.

Finally, we added the SNR G51.3+0.1 as detected by \citet{G51.3_Araya21}, deleting the three point sources that filled this area in DR3.

\subsection{Transient sources}
\label{catalog_transients}

Since many $\gamma$-ray sources are variable, a number of transients, detectable on short time scales, are diluted over many years and do not appear in the general source catalogs. GRBs are so short that they can be excised by simple time selection, but the other transients remain in the data. If they do not appear significant over the full time range, they do not contaminate very much neighboring sources on average, but they can possibly contaminate the light curves (i.e., they can be significant over one particular year).

\input{DR4_transients.tex}

In order to mitigate this effect we introduced in the DR4 catalog the brightest transients, which get close to or above the TS $>$ 25 significance level over one year. We took them from three lists of transients:
\begin{itemize}
\item Novae are detected over weekly time scales and have a single flare, so they are strongly diluted over one year. Four (V1369 Cen 2013, V5668 Sgr 2015, V906 Car 2018 and RS Oph 2021) were bright enough to be in DR4 or a previous data release already. V1369 Cen (4FGL J1353.3$-$5910) and V5668 Sgr (4FGL J1837.6$-$2904) are possibly contaminated by another source, because their light curves show a faint but non-zero signal besides the peak at the time of the nova. Among the other LAT-detected novae, we found that only those detected at TS $>$ 200 remain significant over one year, leaving only four of them.
\item \citet{2021_1FLT} looked systematically for transients outside the Galactic plane and not already in 4FGL DR2 on a monthly timescale. The resulting 1FLT catalog contains 142 such transients, mostly associated with AGNs. This was later updated to 12 years (1FLTi) and DR3. A number of them have entered DR3 or DR4 naturally (because they became brighter in recent years). Among those that did not, we found that those that are significant over one year are detected at least twice, and at a maximum TS of at least 60. This criterion resulted in seven entries.
\item Because the 1FLT catalog was not yet updated to 14 years, we used another  method based on the assessment of monthly variability (ASV for All-Sky Variability) for the last two years. The principle of this method is to first measure the monthly light curves of the 4FGL-DR3 variable sources and then to compare, for each monthly time bin, the observation to the prediction of a sky model containing only 4FGL-DR3 sources. The comparison is done by computing TS maps, which allow detecting flares of $\gamma$-ray sources not reported in 4FGL DR3. Although the ASV and 1FLT approaches differ, we have checked that the two methods detect the same flares above our threshold at TS = 60. We applied the same criterion, leading to three additional entries.
\end{itemize}

The results of that selection are given in Table~\ref{tbl:transients}. We entered those transients like the DR3 sources, so that they are preserved even at TS $<$ 25. Because they are very faint when averaged over 14 years, following the general rule and leaving their power-law indices to vary would have led to ill-defined values that would have then been propagated to all years, including that of the flare. Instead we fit them in the year during which they were strongest and fixed those indices in the fit over 14 years (and the other years) so that only the normalizations were allowed to vary. Therefore all the transients have no error on \texttt{PL\_Index}. The parameters of the curved spectral shapes were filled when the fits (over 14 years) converged.

We fixed the novae at their precise optical positions, so they do not have error ellipses. The error ellipses of the 1FLT and ASV transients, on the other hand, are the $\gamma$-ray localization during the brightest flare.

Three transients were not found formally variable by the variability index. Nova YZ Ret 2020 is very close ($< 0.3\degr$) to another source (4FGL J0358.5$-$5432) so it has large errors. The other two (4FGL J1513.6$-$2830 from 1FLT and J2240.9$-$1825 from ASV) have only moderately close neighbors but the contrast between the brightest year and the average is only a factor of 6, less than the other transients.

\subsection{Detection and Localization}
\label{catalog_detection}

The source detection followed the same approach as in 4FGL-DR3.
It used $pointlike$ and a specific diffuse model in which the non-template features are estimated differently from the 4FGL diffuse model.
It started from the 4FGL-DR3 sources, relocalized them over 14 years of data, looked for peaks in the residual TS maps generated for several spectral shapes, introduced those in the model, refit and iterated over the full procedure.
The result, called uw1410, contained more than 11,700 seed sources at TS $>$ 10.

We associated those seeds with the DR3 sources, keeping the DR3 original positions (consistent with their names). We eliminated seeds too close to a bright source and inside extended sources.
4FGL J2107.7+3529 (with a large error ellipse) was split into two uw1410 sources.
Seven faint DR3 sources were replaced by new nearby uw1410 sources that gathered most of the flux (leaving the original DR3 source with TS $<$ 9) when fit together.

Seven sources (6 AGNs and Cyg X-3) were much better localized in uw1410 than in DR3, because they became much more active after July 2020. We adopted the new error ellipses and set their DataRelease to 4.
During the investigation of the transients (\S~\ref{catalog_transients}) we noted that three flares close to existing sources were more compatible with the uw1410 than the DR3 positions, so we moved the sources to the uw1410 positions. One of them (4FGL J0427.3+0504, which becomes 4FGL J0426.5+0517) was relatively bright (TS $\sim$ 300) and gained an association at its new position (to PKS 0423+051).

The all-sky verification \citep[\S~3.6 of][]{LAT22_4FGLDR3} showed that two positive residuals had become very large \citep[PS $>$ 10, where the $p$-value statistic PS is defined in][]{PSmap} after following strictly the policy of deleting seeds inside extended sources. One in Carina corresponded to a uw1410 seed so we added it to the catalog as 4FGL J1038.8$-$5848, even though its spectrum (very similar to that of the underlying extended emission) and the morphology of the $\gamma$-ray emission indicate that it is probably not a point source. The second large residual, in Cygnus, did not correspond directly to a particular uw1410 seed, so we added a source as 4FGL J2033.0+3900 at the peak of the residual, without an error ellipse. We added another uw1410 seed inside FHES J2304.0+5406 corresponding to a PS = 8.7 residual. That one has the same hard spectrum as the extended source, but is very peaked and point-like. 

Seventeen pulsars known from timing analysis but too faint to be detected in uw1410 were entered at fixed positions. Two (PSR J1731$-$4744 and J1909$-$3744) survived the TS $>$ 25 cut and are included in DR4 at their timing positions with no error ellipse.
In the end 4846 new seeds were entered to the $gtlike$ source characterization in addition to 6569 DR3 point sources and the 82 extended sources.

We reassessed the systematics on localization, and increased them a little. The absolute 95\% systematic error was set to $28.5\arcsec$ (instead of $25\arcsec$ and $27\arcsec$ at high and low latitudes, respectively, in DR3), while the systematic factor was set to 1.075 (instead of 1.06) at high latitude and 1.48 (instead of 1.37) close to the Galactic plane ($|b| < 5\degr$).
In the incremental approach those new numbers were applied only to the new sources (and those listed above for which we adopted the uw1410 localization).

\subsection{Spectral Shapes}
\label{catalog_spectra}

% Figure environment removed

Since we introduced curved spectra in the 2FGL catalog \citep{LAT12_2FGL}, we noticed that faint sources too often end up at $\beta$ = 1, the maximum allowed in the fit (Fig.~\ref{fig:TS_beta}, left). This never happens for bright sources (large TS). Bright AGNs (modeled as LP) have $\beta \sim 0.1$, and even pulsars (modeled in the Fermitools as PLSuperExpCutoff4 or PLEC4) never reach $\beta$ = 1 when they are bright. The conclusion was that those strongly curved spectra were not physical, but the result of the low-energy confusion due to the broad PSF. Many faint sources are modeled as power laws for lack of evidence that their spectra are curved, even though most likely they are, just like the bright sources. Those power laws tend to overestimate the real spectrum at low energy, so that the curved neighbors will compensate by appearing more curved than they really are.

In order to avoid this behavior, we introduced Gaussian priors on the curvature parameters in the DR4 catalog. We based the mean of those priors on the average for bright sources, and chose the width narrow enough to avoid the very large curvatures, but broader than the natural scatter observed on bright sources. For the $\beta$ parameter in LP, we set the mean to 0.1 and the width to 0.3. For the ExpfactorS parameter in PLEC4, we set the mean to 0.6 and the width to 0.6 (the same width as on $\beta$ but a larger mean, accounting for the fact that ExpfactorS corresponds to 2 $\beta$). We tested this on the DR3 data set (Fig.~\ref{fig:TS_beta}, right) and it worked fine, eliminating all strongly curved spectra while leaving bright sources (TS $>$ 1000) essentially unaltered.

We observed two minor side effects of that change:
\begin{itemize}
\item The number of curved spectra decreased by about 2\%, because the priors require a little more statistical evidence to reach the TS$_{\rm curv} > 4$ threshold. An even smaller ($<$ 1\%) fraction of sources (which were originally strongly curved) did not reach the TS $>$ 25 limit with the priors and disappeared entirely.
\item The energy fluxes of the faint sources that became power laws, or in which $\beta$ decreased a lot, increased accordingly (because the energy flux is dominated either by low or high energies, depending on the spectral index, at which a strongly curved spectrum is lower). This effect reached as much as 20\% in individual sources. Collectively, however, the total energy flux in all sources increased by less than 1\%.
\end{itemize}

There are 277 pulsars in DR4, up from 255 in DR3. Most are modeled as PLEC4. Eight are not significantly curved and modeled as power laws.
The same 34 bright sources (28 pulsars and 6 blazars) as in DR3 were modeled as PLEC4 with free superexponential index $b$.

Because the priors make it a little more difficult to reach the TS$_{\rm curv} > 4$ threshold, the number of LP spectral shapes decreased from 3131 in DR3 to 3076 in DR4 (among which 152 are new sources). The number of PLEC4 spectra increased from 258 to 276 (two are new sources), thanks to the identification of new pulsars. Overall, the fraction of sources with a curved spectral model decreased from 51\% in DR3 to 47\% in DR4.

\subsection{Thresholding, Spectral Energy Distributions and Light Curves}
\label{catalog_significance}

We used the Fermitools package v2.2.0.
The likelihood weights were recomputed over 14 years of data, resulting in slightly smaller weights throughout.
We reoptimized all RoIs, resulting in 1991 RoIs containing up to 10 sources in their core.
As explained in \S~\ref{DiffuseModel}, the isotropic level was fixed to 1 in each RoI in the main fit, and only the interstellar emission level and its spectral bias were left free.

All DR3 sources were entered in the analysis with their DR3 spectral model, except the newly identified pulsars.
As in the previous incremental catalogs, they were not deleted from the model even if they had TS $<$ 25 at the end of the iteration process.
The resulting catalog contains 7195 entries, among which 546 are new, and 320 are DR3 sources or transients at TS $<$ 25.

The SEDs were obtained in the same way as in DR3 and over the same 8 bands, except the isotropic level was fixed to 1 as in the main fit.

The variability analysis proceeded in the same way as in DR3, now applied to 14 years (so the variability index threshold at 99\% confidence is 27.69).
For this analysis we left the isotropic free, because the weights for each year (the same as in DR3) are much larger than over 14 years so low energies are more important than in the main fit, and it is better to leave a little more freedom.
Indeed we noticed that the average values (over the entire sky) of the isotropic and interstellar emission levels were both slightly above 1 (around 1.03 for the isotropic and 1.003 for the interstellar). This implies that the Galactic curvature (optimized over the full interval) underestimates slightly the diffuse emission at a few hundred MeV. We also noticed a modulation over time of the average isotropic level (at the level of $\pm$ 2\%), which appears to follow the solar cycle. We interpret this as a variation of the residual charged-particle background in the $\gamma$-ray data set (minimum around solar maximum when the flux of cosmic rays at Earth is minimum).

The number of significantly variable sources increased from 1695 to 1825 (among which 47 are new sources). The fraction of variable sources remained constant at 25\%. Besides the known variable pulsars, three young pulsars are considered formally variable, with variability index between 35 and 50. They are PSR J1732$-$5049, J2043+2740 and J2208+4056. Two others are just above threshold, as expected by chance for a collection of nearly 300 pulsars.

The all-sky verification showed that positive residuals inside extended sources and negative residuals were at the same level as in DR3 (after adding the three seeds mentioned in \S~\ref{catalog_detection}).


\subsection{Analysis Flags}
\label{catalog_analysis_flags}

\input{DR4_flags_description.tex}

The flags are recalled in Table~\ref{tab:flags} (see the DR3 paper for the detailed definitions), together with the numbers of sources flagged for each reason and their evolution since DR3.
The effect of the underlying interstellar emission model (IEM) was estimated by launching the procedure described in \S~\ref{catalog_significance} a second time using the same seeds but the previous IEM (gll\_iem\_v06).

We passed all new DR4 sources through the visual screening for diffuse features (Flag 6). That procedure flagged 38 sources. Flag 6 was not changed for DR3 sources.

The number of sources flagged with Flag 2 (inconsistent localization between the old DR4 position and uw1410) increased greatly, as well as the number of sources at low TS (Flag 13). This indicates that the current localizations (uw1410) have moved somewhat from the historical ones (DR1 to DR3). This implies that the concept of an incremental source catalog reaches its limit after six years, {\bf thus} the next catalog will probably be an entirely new one.
The fraction of bad localizations among DR3 sources at high latitude is 8\%, rising to 12\% close to the Galactic plane. This exceeds the 5\% expected from the 95\% confidence errors. The reason is probably confusion (a fraction of sources tend to split into several), which is much greater in the Galactic plane.

Overall the fraction of sources with any flag set increased from 23\% in DR1 to 26\% in DR2, 32\% in DR3 and 35\% in DR4. Among the new DR4 sources, 70\% are flagged in the Galactic plane ($|b| < 10\arcdeg$), but only 26\% above the Galactic plane.
