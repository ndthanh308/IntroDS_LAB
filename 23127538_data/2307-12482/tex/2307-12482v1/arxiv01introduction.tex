\section{Introduction}

%\hadi{1. make WLOG and wlog consistent throughout. \\
%2. In some places (e.g. Section 5) we use cuts on valuation intervals. But I can't see it explicitly defined. It'd be nice to include it in preliminaries. \\
%3. we use `good', `houses', and `items' even in the intro. I suggest using \textit{items} and \textit{houses} only throughout.}

In the EconCS community, the \emph{House Allocation Problem} has been a topic of significant interest for some time \citep{shapley1974cores, svensson1999strategy, beynier2018localenvy, gsvfairhouse, kmsfairhouse}. In its canonical form, the problem involves a set of $n$ agents, a set of $n$ items (or ``houses''), and possibly different valuation functions from the agents to the items. In general, given this framework, the problem asks for an ``optimally fair'' allocation of the houses to the agents. For instance, we might wish to minimize the total envy, or maximize the number of envy-free pairs of agents. In this context, as it is common in the literature of fairness, an agent $i$ envies an agent $j$ in a particular allocation if according to agent $i$'s valuation function, the item received by agent $j$ is worth more than the item received by agent $i$; the amount of envy is the difference in these two values. The canonical problem has been studied in a variety of contexts, and is well-known as an algorithmically difficult problem to solve, for most reasonable fairness objectives.

\cite{canon} introduced a variant of the house allocation problem called {\GHA}. In this setting, there are $n$ agents, but now they are placed on the vertices of an undirected $n$-vertex graph $G = (V, E)$. There are still $n$ items with arbitrary values, but the agents are \emph{identical} in how they value these $n$ items (i.e., they all agree on the value of each house). {\GHA} now asks: how do we allocate each house to an agent so as to minimize the total envy along the edges of $G$?

We remark here that the setting where the agents are on the vertices of a graph and only the envy along the graph edges is considered was studied before as well by \cite{beynier2018localenvy}, who considered ordinal preferences in such a setting, and were interested in maximizing the number of envy-free edges in the underlying graph. Note that {\GHA} is the variant where we have a utilitarian objective, of minimizing the total envy.

Observe that {\GHA} can be thought of as a purely combinatorial problem: we are given an $n$-vertex graph $G = (V, E)$ and a multiset $H = \{h_1, \ldots, h_n\} \subseteq \R_{\geq 0}$. We wish to find the bijective function $\pi : V \to H$ that minimizes
$\sum_{(x, y) \in E}|\pi(x) - \pi(y)|$.

If the set of values were $H = \{1, \ldots, n\}$, then {\GHA} would be identical to the well-known {\MLA} problem. This was observed by \cite{canon}, who went on to show some remarkable differences between the two problems. For instance, while all hardness results carry over from {\MLA} to {\GHA}, the latter is actually a significantly harder problem even on very simple graphs. In particular, in {\MLA}, we can assume without loss of generality that the underlying graph is connected; this is because an optimal solution is given by taking each connected component separately, and optimally assigning a contiguous subset of values to it. We lose this guarantee in {\GHA}, even for  small disconnected graphs with just two connected components. As a typical example of the differences between the two problems, observe that if the underlying graph is a disjoint union of paths, then solving {\MLA} optimally takes linear time, but even on these simple instances, {\GHA} is NP-complete \citep{canon}.

We do note, however, that all the hardness constructions by \cite{canon} used the disconnectedness of the underlying graphs crucially, in finding reductions from bin packing instances. Their results also show that for very simple classes of disconnected graphs, {\GHA} is inapproximable to any finite factor. However, these proof techniques do not carry over to \emph{connected} graphs, and so it was not known whether any of these reductions would go through for connected graphs. For instance, a well known result by \cite{mlatrees} states that {\MLA} is solvable in polynomial time on trees, but the complexity of this problem for {\GHA} was open.

%Note that it is relatively straightforward to show that an $\alpha$ approximation algorithm for the \MLA~problem yields an $\alpha \cdot \phi$ approximation for the $\GHA$ problem where $\phi=\max_{1\leq i\leq n-1} (h_{i+1}-h_i)/\min_{1\leq i\leq n-1} (h_{i+1}-h_i)$.


%\andrew{Do we also want to mention that min-bisection is a special case of graphical house allocation but that general graphical house allocation is strictly harder, e.g., min bisection is poly-time on trees but we show graphical house allocatiton is NP hard on trees.}

\subsection{Our Contributions}

We present a nearly complete characterization of the approximability of {\GHA} on various large and natural classes of connected graphs, summarized in Table \ref{table:summary1}. In particular, for any {\GHA} instance on the following graph classes, we first show a polynomial-time algorithm on an $n$-vertex graph $G$ (with maximum degree $\Delta$) in that class for obtaining the stated multiplicative approximation to the optimal envy, and then go on to demonstrate a matching lower bound that shows that any polynomial improvement on the approximation ratio is impossible on that graph class unless P = NP (In what follows, $\tilde{O}$ hides $\polylog(n)$ factors):
%Specifically, we show the following results for the multiplicative approximation to the optimal envy for an instance of {\GHA} defined on a graph $G$ with $n$ nodes and maximum degree $\Delta$:
\begin{itemize}
    \item If $G$ is any connected graph, we have a trivial upper bound of $O(n^2)$, attained by \emph{any} allocation whatsoever (Proposition \ref{prop:trivialgeneral}). In Theorem \ref{thm:general-approx-lower-bound}, we show that we cannot have an $O(n^{2 - \epsilon})$-approximation for any $\epsilon > 0$. Using known approximations to the treewidth of $G$, in Corollary \ref{cor:cutwidth-upperbounds} we show a polynomial-time algorithm that achieves an $\tilde{O}(\tw(G)\cdot\Delta)$-approximation. %Note that assuming connectivity is essential for this upper bound since, as noted above, previous work establishes that even determining whether the optimum envy is non-zero is NP hard on graphs node-disjoint paths.
    
    \item If $G$ is a tree, Proposition \ref{prop:trivialgeneral} again gives us a trivial upper bound of $O(n)$, attained by \emph{any} allocation. In Theorem \ref{thm:trees-approx-lower-bound}, we show that we cannot have an $O(n^{1 - \epsilon})$-approximation for any $\epsilon > 0$. This is in stark contrast to {\MLA}, where there are sub-quadratic algorithms for \emph{exact} solutions on trees \citep{mlatrees}. Again, Corollary \ref{cor:cutwidth-upperbounds} gives us a polynomial-time algorithm that achieves an $O(\Delta
    \log n)$-approximation. We explicitly show a simple divide-and-conquer procedure (Algorithm \ref{alg:treelogn}) that gives the same $O(\Delta\log n)$-approximation in $O(n\log n)$ time.

    \item If $G$ is a planar graph, Corollary \ref{cor:cutwidth-upperbounds} gives us a polynomial-time algorithm to achieve an $\tilde{O}(\sqrt{n\Delta})$-approximation to the optimal envy. In the worst case, $\Delta = \Theta(n)$, so this is a worst-case approximation of $\tilde{O}(n)$. Once again, Theorem \ref{thm:trees-approx-lower-bound} shows that we cannot have an $O(n^{1 - \epsilon})$-approximation for any $\epsilon > 0$.

    \item If $G$ is a bounded-degree graph, Corollary \ref{cor:cutwidth-upperbounds} gives us a polynomial-time algorithm to achieve an $\tilde{O}(\tw(G))$-approximation to the optimal envy. Again, this is a worst-case approximation of $\tilde{O}(n)$. Using Theorem \ref{thm:bounded-degree-approx-lower-bound}, we show that we cannot have an $O(n^{1 - \epsilon})$-approximation for any $\epsilon > 0$. While all our lower bounds rely on 3-partition constructions, this is our %hardest
    most involved technical result, and it uses expansion properties of Ramanujan graphs to construct our gadgets.

    \item If $G$ is a bounded-degree planar graph, Corollary \ref{cor:cutwidth-upperbounds} gives us a polynomial-time algorithm to achieve an $\tilde{O}(\sqrt{n})$-approximation to the optimal envy. We match this upper bound using Theorem \ref{thm:bounded-degree-planar-approx-lower-bound}, which shows that we cannot have an $O(n^{0.5 - \epsilon})$-approximation for any $\epsilon > 0$.
\end{itemize}

\begin{table}
    \centering
    \def\arraystretch{1.3}
    \begin{tabular}{ |l|l|l|  }
 \hline
 \multicolumn{3}{|c|}{Approximations for {\GHA}} \\
 \hline
 \bf Graph Class & \bf Upper Bound & \bf Lower Bound \\
 \hline
\multirow{2}{15em}{Connected graphs}  & $O(n^2)$ (Prop.~\ref{prop:trivialgeneral}) & \multirow{2}{10em}{\centering $\omega(n^{2 - \varepsilon})$ (Thm.~\ref{thm:general-approx-lower-bound})} \\
& $O(\tw(G)\cdot\Delta\log^{2.5} n)$ (Cor.~\ref{cor:cutwidth-upperbounds}(\ref{cor:cwgeneral})) & \\
\hline 
\multirow{2}{15em}{Trees}  & $O(n)$ (Prop.~\ref{prop:trivialgeneral}) & \multirow{2}{10em}{\centering $\omega(n^{1 - \varepsilon})$ (Thm.~\ref{thm:trees-approx-lower-bound})} \\
& $O(\Delta\log n)$ (Alg.~\ref{alg:treelogn}, Cor.~\ref{cor:cutwidth-upperbounds}(\ref{cor:cwtrees})) & \\
\hline
Planar graphs  & $O(\sqrt{n\Delta}\log^{1.5}n)$ (Cor.~\ref{cor:cutwidth-upperbounds}(\ref{cor:cwplanar})) & $\omega(n^{1 - \varepsilon})$ (Thm.~\ref{thm:trees-approx-lower-bound}) \\
\hline
Bounded-degree graphs  & $O(\tw(G)\cdot\log^{2.5}n)$ (Cor.~\ref{cor:cutwidth-upperbounds}(\ref{cor:cwgeneral})) & $\omega(n^{1 - \varepsilon})$ (Thm.~\ref{thm:bounded-degree-approx-lower-bound}) \\
\hline
Bounded-degree planar graphs &  $O(\sqrt{n}\log^{1.5}n)$ (Cor.~\ref{cor:cutwidth-upperbounds}(\ref{cor:cwplanar})) & $\omega(n^{0.5 - \varepsilon})$ (Thm.~\ref{thm:bounded-degree-planar-approx-lower-bound}) \\
\hline
Bounded-degree trees & $O(\log n)$ (Thm.~\ref{thm:treelogn}, Cor.~\ref{cor:cutwidth-upperbounds}(\ref{cor:cwtrees})) & \textcolor{red}{open} \\
 \hline
\end{tabular}
\caption{Summary of our results. Here, $\Delta$ is the maximum degree of the graph in question, and the lower bounds assume P $\neq$ NP. Note that in all cases, the lower bound corresponds to the worst-case upper bound up to polylogarithmic factors, showing that nontrivial improvements to these upper bounds are impossible unless P = NP. All our upper bound algorithms run in polynomial time.%\rohit{Is it possible to add the results of \cite{canon} in this table (for ease of comparison and quick reference)?}
}
\label{table:summary1}
\end{table}

Note that assuming connectivity in the results above is necessary. As mentioned earlier, \cite{canon} showed that disconnected graphs cannot have the optimal envy approximated to any finite factor. To the best of our knowledge, we give the first known results for connected graphs.


The only remaining large class of graphs in Table \ref{table:summary1} are bounded-degree trees, exemplified by binary trees. We investigate these trees in some detail. Of course, Corollary \ref{cor:cutwidth-upperbounds} and Algorithm \ref{alg:treelogn} give us an $O(\log n)$-approximation to the optimal envy on bounded-degree trees, but we do not know whether we can get rid of the logarithmic factor at all. In fact, we show that the special class of binary trees trees is not ``well-behaved'', by refuting a conjecture by \cite{canon} about the structural properties of exact optimal allocations on binary trees by means of a counterexample (Section \ref{sec:boundeddegreetrees}) on a depth-$3$ complete binary tree. The hardness results in Theorems \ref{thm:trees-approx-lower-bound}, \ref{thm:bounded-degree-approx-lower-bound}, and \ref{thm:bounded-degree-planar-approx-lower-bound} might have suggested that even complete binary trees cannot have $o(\log n)$-approximations in general. We refute this, however, by showing that just the in-order traversal on a complete binary tree achieves a 3-approximation to the optimal envy (Theorem \ref{thm:inorder}). We further show that a natural class of algorithms (``value-agnostic'' procedures) cannot attain an approximation ratio better than 1.67 on complete binary trees. However, we do not resolve the question of whether attaining an exact solution on complete binary trees is NP-hard or not, and leave this for future research.

We also consider a generalized version of our problem on trees wherein the tree is \emph{edge-weighted} (and the envy along each edge has to be multiplied by the weight of that edge). For these graphs, we can adapt Algorithm \ref{alg:treelogn} easily, giving us an $O(\Delta\log n)$-approximation to the optimal envy on such trees in nearly linear time. Here $\Delta$ is the maximum \emph{weighted} degree, the sum of weights of all the edges incident on a vertex.

These results on special cases are summarized in Table \ref{table:summary2}.

Our paper is organized as follows. In Section \ref{sec:prelims}, we set up preliminaries and notation. In Sections \ref{sec:upper} and \ref{sec:lower}, we present our upper and lower bounds respectively from Table \ref{table:summary1}. In Section \ref{sec:completebintrees}, we discuss binary trees. We finish with concluding remarks and open directions in Section \ref{sec:conclusions}.

%\hadi{this paragraph can be removed to save space since most of it already exists under contributions.} Our paper is organized as follows. In Section \ref{sec:prelims}, we set up the preliminaries and notation for {\GHA}, including defining the classes of algorithms we will be studying. In Section \ref{sec:upper}, we start with a divide-and-conquer algorithm for trees, and later go on to use the parameter cutwidth to generalize this result for other classes of graphs, giving us all our upper bounds from Table \ref{table:summary1}. In Section \ref{sec:lower}, we give our lower bounds, showing reductions from bin-packing for several classes of graphs to give us all our lower bounds from Table \ref{table:summary1}. In Section \ref{sec:completebintrees}, we delve into complete binary trees in some detail, refuting the conjecture by \cite{canon} and then going on to show a constant approximation on complete binary trees. We finish with some concluding remarks and open directions in Section \ref{sec:conclusions}.



\begin{table}
    \centering
    \def\arraystretch{1.3}
    \begin{tabular}{ |l||l|l|l|  }
 \hline
  \multicolumn{4}{|c|}{Approximations for Some Special Classes} \\
 \hline
\bf  Graph Class & \bf Upper Bound & \bf Lower Bound & \bf 
Runtime \\
 \hline
Edge-weighted trees & $O(\Delta_w\log n)$  (Cor.~\ref{cor:weightedtrees}) & $\omega(n^{1 - \varepsilon})$ (Thm.~\ref{thm:trees-approx-lower-bound})
& $O(n\log n)$ \\
\hline
Complete binary trees & $3$ (Thm.~\ref{thm:inorder}) & $\geq 1$ (exact solution \textcolor{red}{open}) & $O(n)$ \\
\hline
\end{tabular}
\caption{Summary of our results for two specific graph classes. Here, $\Delta_w$ is the \emph{weighted} maximum degree, defined in Section \ref{sec:boundeddegreetrees}. Moreover, the upper and lower bounds match in the worst case. Note that we know the lower bound for complete binary trees has to be at least $1.67$ for value-agnostic algorithms.}
\label{table:summary2}
\end{table}



\subsection{Other Related Work} 
Our work is very close to the large body of results on the computability of {\MLA}. While finding optimal linear arrangements is intractable in general \citep{mlabinaryhard}, there have been several papers presenting approximation algorithms for the problem \citep{richarao2005mla,feige2007mla, even200mla}, with the best known approximation ratio being $O(\sqrt{\log n}\log{\log n})$ \citep{feige2007mla}. Note that it is relatively straightforward to show that an $\alpha$-approximation algorithm for the \MLA~problem yields an $\alpha\phi$ approximation for the $\GHA$ problem where $\phi=\max_{1\leq i\leq n-1} (h_{i+1}-h_i)/\min_{1\leq i\leq n-1} (h_{i+1}-h_i)$.

Our problem also generalizes the classical problem of \textsc{Minimum Bisection}, which asks how to partition a graph $G$ into two almost equally-sized components with the smallest number of edges going across the cut. This problem is NP-complete \citep{mlahard} and it is also known to be inapproximable by an additive factor of $n^{2-\epsilon}$ \citep{bj92}. These lower bounds carry over to the \GHA{} problem as well, although the latter is strictly harder. For instance, \textsc{Minimum Bisection} is known to be solvable exactly in polynomial time for forests, but {\GHA} is NP-hard on forests~\citep{canon}.

The canonical house allocation problem has also been well-studied in the literature. Recall that, in the canonical house allocation problem, agents are allowed to disagree on the values of the houses. In this setting, the existence and computational complexity of envy-free allocations on graphs have been reasonably well-studied \citep{beynier2018localenvy,eiben2020parameterized,bredereck2022envy}, with the problem, unsurprisingly, being computationally intractable in most settings. %Indeed, this is unsurprising given that the canonical house allocation problem is a generalization of the \GHA{} problem.
There have also been a few papers studying the complexity of minimizing various notions of envy when the underlying graph is {\em complete} \citep{gsvfairhouse, kamiyama2021envy, aigner2022envy,MMS23complexity}. 



