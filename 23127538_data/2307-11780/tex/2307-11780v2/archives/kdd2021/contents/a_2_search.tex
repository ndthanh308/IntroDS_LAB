\section{Search a pattern in a sequence}

\label{app:search}

Shown as Algorithm \ref{alg:search} and Algorithm \ref{alg:check}, we use a simple DFS to search all the occurrences of pattern $p$ in sequence $s$.

\begin{algorithm}[!htb]
    \caption{Searching Algorithm}
    \label{alg:search}
    \KwIn{A sequence $s$, a pattern $p$}
    \KwOut{All occurrences $occurs$}
    \tcc{the explanation can be found in Appendix \ref{app:search}}
    $occurs \leftarrow \emptyset$\;
    $max\_gaps \leftarrow |p| - 1$, $max\_misses \leftarrow (||p|| + 5) / 10$\;
    \For{$i \leftarrow$ 1 to $|s|$} {
        $found$, $marks$, $misses$ = dfs($s$, $p$, $i$, 1, $max\_gaps$, $max\_misses$)\;
        \If{$found$} {
            $occurs \leftarrow occurs + (marks, misses)$\;
        }
    }
    \Return{$occurs$}
\end{algorithm}

\begin{algorithm}[!htb]
    \caption{DFS Algorithm}
    \label{alg:check}
    \KwIn{A sequence $s$, a pattern $p$, the start index in sequence $si$, the start index in pattern $pi$, max number of gap events $max\_gaps$, max number of missing values $max\_misses$}
    \KwOut{Whether the patter occurs $found$, all positions $marks$, and positions of missing values $misses$}
    \tcc{the explanation can be found in Appendix \ref{app:search}}
    \If{$|s| - si < |p| - pi$} {
        \Return{{\bf false}}\;
    }

    $es \leftarrow$ the $si$-th event of $s$\;
    $ep \leftarrow$ the $pi$-th event of $p$\;
    $marks \leftarrow \emptyset$\;
    $num\_misses \leftarrow 0$, $misses \leftarrow \emptyset$\;
    \For{$k \leftarrow$ 1 to $|A|$} {
        \If{$ep[k]$ is not empty} {
            \eIf{$ep[k] != es[k]$} {
                $num\_misses += 1$\;
                $misses \leftarrow misses + (si, k)$
            } {
                $marks \leftarrow marks + (si, k)$
            }
        }
    }
    \If{$num_misses > max_misses$} {
        \Return{{\bf false}}\;
    }

    \For{$i \leftarrow 0$ to $max\_gaps$} {
        $found$, $marks^*$, $misses^*$ = dfs($s$, $p$, $si+1+i$, $pi+1$, $max\_gaps-i$, $max\_misses-num\_misses$)\;
        \If{$found$} {
            $marks \leftarrow marks \cup marks^*$\;
            $misses \leftarrow misses \cup misses^*$\;
            \Return{{\bf true}, marks, misses}\;
        }
    }
    \Return{{\bf false}}\;
\end{algorithm}