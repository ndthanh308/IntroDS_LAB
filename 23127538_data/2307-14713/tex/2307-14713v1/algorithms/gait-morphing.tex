\begin{algorithm}
    \caption{Finding the optimal transport maps between walking variations. } 
    \label{alg:gait-morphing}
    \begin{algorithmic}
     \scriptsize
        \Require \\
        $E$ - Trained MS-G3D gait encoder \\
        $\mathcal{B} \in \mathbb{R}^{B^{(b)} \times T \times J \times 2}$ - baseline variation walks \\
        $\mathcal{T} \in \mathbb{R}^{B^{(t)} \times T \times J \times 2}$ - target walks \\
        $\mathcal{Z}$ - learned codebook vectors \\
        $s$ - token sequence length\\
        
        \State $k^{(b)} \gets \arg (\textbf{q}(E(\mathcal{B})))$ \Comment{\textit{Baseline token indices.}}
        % \in \{1 \dots |\mathcal{Z}|\}$ 
        \State $k^{(t)} \gets \arg (\textbf{q}(E(\mathcal{T})))$ \Comment{\textit{Target token indices.}}
        % \in \{1 \dots |\mathcal{Z}|\}$ 

        \State $\Gamma \gets \emptyset$
        \For{$j \gets 1 \dots s$} 
            \LeftComment \textit{Count occurrences of each baseline and target tokens.}

            \State $c^{(b)} \gets \{\sum_l^{B^{(b)}} \mathbb{1}[k^{(b)}_{l, j} = r] | r \in 1 \dots |\mathcal{Z}|\}$
            \State $c^{(t)} \gets \{\sum_l^{B^{(t)}} \mathbb{1}[k^{(t)}_{l, j} = r] | r \in 1 \dots |\mathcal{Z}|\}$

            \LeftComment \textit{Increase codebook embedding magnitude.}
            \State $C^{(b)} \gets \mathcal{Z} \odot c^{(b)}$
            \State $C^{(t)} \gets \mathcal{Z} \odot c^{(t)}$

            \LeftComment \textit{Compute cost matrix as pairwise distances between scaled token embeddings.}
            \State $C \gets C^{(b)} \cdot (C^{(t)})^\top$
            
            \LeftComment \textit{Find optimal transport map for position \textit{j}}
            \State $\gamma^{\textbf{*}}$ $\gets$ $\argmin_{\gamma} \sum \gamma C$ \Comment{Eq. \ref{eq:ot}}
            \State $\Gamma_j \gets \gamma^{\textbf{*}}$ 
        \EndFor
        
        \State \textbf{return} $\Gamma$
    \end{algorithmic}
\end{algorithm}
