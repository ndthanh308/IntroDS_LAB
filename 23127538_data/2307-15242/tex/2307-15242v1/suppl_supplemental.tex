\documentclass{article}
\usepackage[top=1in, bottom=1in, left=1in, right=1in]{geometry}
\usepackage{amssymb, amsmath}
\usepackage{graphicx}
\usepackage[colorlinks=true, allcolors=black]{hyperref}
\usepackage{palatino} % font 
\usepackage[numbers,sort&compress]{natbib}
\usepackage{bm}
\usepackage{float}
\usepackage{xspace}
\usepackage{xcolor}
\usepackage{caption}
\usepackage[acronym]{glossaries}
\usepackage[bottom]{footmisc} % force footnote to the bottom
\usepackage{colortbl}


\renewcommand{\floatpagefraction}{.8}

\setlength{\parskip}{\baselineskip}

\setlength{\parindent}{0pt}

\graphicspath{{./}{./figures}{./figures_si}}

\newcommand*{\mw}[1]{{\color{magenta} (Mingjian: #1)}}

\newcommand*{\fref}[1]{Fig.~S\ref{#1}}
\newcommand*{\tref}[1]{Table~S\ref{#1}}
\newcommand*{\eref}[1]{Eq.~S\eqref{#1}}
\newcommand*{\sref}[1]{Section~S\ref{#1}}
\newcommand*{\aref}[1]{Appendix~S\ref{#1}}
\newcommand*{\onlinecite}[1]{Ref.~\citenum{#1}}

\newcommand*{\net}{MatTen\xspace}


\DeclareCaptionLabelFormat{addS}{#1 S#2}
\captionsetup[table]{labelformat=addS}
\captionsetup[figure]{labelformat=addS}





\title{Supplementary Information: \\ 
A Universal Equivariant Graph Neural Network for the Elasticity Tensors of Any Crystal System}
    
\author{
\normalsize{Mingjian Wen$^1$\footnote{Email: mjwen@uh.edu}, 
Matthew K.\ Horton$^{2,3}$,
Jason M.\ Munro$^2$,
Patrick Huck$^4$,
Kristin A.\ Persson$^{5,6}$
}\\
\footnotesize{$^1$ Chemical and Biomolecular Engineering, University of Houston, Houston, 77204, TX, USA} \\ 
\footnotesize{$^2$ Materials Sciences Division, Lawrence Berkeley National Laboratory, Berkeley, 94720, CA, USA} \\ 
\footnotesize{$^3$ Microsoft Research, Redmond, 98052, WA, USA} \\ 
\footnotesize{$^4$  Energy Technologies Area, Lawrence Berkeley National Laboratory, Berkeley, 94720, CA, USA } \\
\footnotesize{$^5$  Molecular Foundry, Lawrence Berkeley National Laboratory, Berkeley, 94720, CA, USA} \\ 
\footnotesize{$^6$ Department of Materials Science and Engineering, University of California, Berkeley, Berkeley, 94720, CA, USA} 
\vspace{-8mm}
}


\date{}

\begin{document}
\maketitle




\section*{The ten symmetry classes of elasticity tensors}

% Figure environment removed

Early approaches take inspiration from crystallography. 
Out of the 32 distinct crystallographic point groups, only 11 are centrosymmetric (meaning the point group contains an inversion center as one of its symmetry elements), each forming a unique diffraction pattern. 
The diffraction patterns of other noncentrosymmetric crystals each is the same as one of the 11 centrosymmetric crystals. 
Based on the diffraction patterns, the 32 distinct point groups can be categorized into 11 classes, called the Laue groups \cite{tadmor2012continuum}.
According to the Laue groups, Wallace \cite{wallace1972thermodynamics} classifies the elastic tensors into 12 classes (the additional 1 being the isotropic class that does not apply for single crystals), and they reduce to 10 classes considering the number of independent components (\fref{fig:10:class}). 
The results are widely cited, including the classical book on the subject by Nye \cite{nye1985physical} and many recent papers \cite{singh2021mechelastic,li2022elast,ran2023velas}.
This crystallographic approach seems reasonable; however, the conclusions are incorrect.
The tetragonal and trigonal systems are each divided into two symmetry classes, 
but the distinctions can be eliminated by a different choice of the coordinate system \cite{fedorov1968theory,sutcliffe1992spectral}. 
Then each of the tetragonal and trigonal systems will have 6 independent components.



\section*{Harmonic decomposition of the elasticity tensor}

In the harmonic decomposition, the elasticity tensor can be written as 
\begin{equation}
    \bm C = h_1 (\lambda)  + h_2(\eta) + h_3 (\bm A) + h_4 (\bm B) +  h_5(\bm H).  
\end{equation}

The appropriate values for each of the term is as follows:
\begin{equation*}
    \lambda  =  [2C_{ppmm} - C_{pmpm}] / 15,
\end{equation*}
\begin{equation*}
    \eta =  [-3C_{ppmm} - C_{pmpm} ] /90,
\end{equation*}
\begin{equation*}
   A_{ij}  = [ 15C_{ijmm} - 12C_{imjm} -5\delta_{ij}C_{ppmm}      +4\delta_{ij}C_{pmpm} ]/ 21 ,
\end{equation*}
\begin{equation*}
   B_{ij}  = [-6C_{ijmm} + 9C_{imjm} +2\delta_{ij}C_{ppmm}      -3\delta_{ij}C_{pmpm} ] / 21 ,
\end{equation*}
\begin{equation*}
\begin{aligned}
H_{ijkl} 
=& (C_{ijkl} +  C_{iklj} + C_{iljk})/3 \\
 &- [(C_{ijmm} +  2C_{imjm} )\delta_{kl}
 + (C_{klmm} +  2C_{kmlm} )\delta_{ij} \\
 &+ (C_{ikmm} +  2C_{imkm} )\delta_{jl}
 + (C_{jlmm} +  2C_{jmlm} )\delta_{ik}  \\
 &+ (C_{ilmm} +  2C_{imlm} )\delta_{jk} 
 + (C_{jkmm} +  2C_{jmkm} )\delta_{il} ] / 21 \\
 &+ (C_{ppmm} +  2C_{pmpm} ) 
 (\delta_{ij}\delta_{kl} 
 +\delta_{ik}\delta_{jl}
 +\delta_{il}\delta_{jk}
 ) /105 ,
\end{aligned}
\end{equation*}
and 
\begin{equation*}
h_1 (\lambda) = \delta_{ij}\delta_{kl}\lambda,
\end{equation*}
\begin{equation*}
h_2 (\eta) = (\delta_{ik}\delta_{jl} + \delta_{il}\delta_{jk} )\eta ,
\end{equation*}
\begin{equation*}
h_3 (\bm A) = \delta_{ij}A_{kl} + \delta_{kl}A_{ij} , 
\end{equation*}
\begin{equation*}
h_4 (\bm B) 
= \delta_{ik}B_{jl} + \delta_{jl}B_{ik} 
+ \delta_{il}B_{jk} + \delta_{jk}B_{il} ,
\end{equation*}
\begin{equation*}
h_5 (\bm H)  = H_{ijkl},
\end{equation*}
where $\delta_{ij}$ is the Kronecker delta.

This decomposition follows \onlinecite{forte1996symmetry}, and as mentioned there that ``... other forms of harmonic decomposition are possible: It suffices to use invertible linear combinations of $\bm A$ and $\bm B$ and, analogously, invertible linear combinations of $\lambda$ and $\eta$.''
See \onlinecite{backus1970geometrical,itin2020irreducible} for such examples.
Nevertheless, harmonic decomposition is unique to linear combinations. 


\section*{Proof of \net satisfying material symmetry}

The \net model $\bm C = f(x)$ is equivariant to $SO(3)$ transformations, satisfying 
\begin{equation} \label{eq:equi}
   D_y(g) f(x) = f( D_x(g) x) .
\end{equation}
This comes from the fact that each layer of \net is equivariant, and the composition of such layers is also equivariant. 
We refer to \onlinecite{thomas2018tensor} for proof of the equivariance of the layers.
The representation $D_x(g)$ in the space of crystal structures can be written as  $D_x(g) = R_{ip}$, and the representation $D_y(g)$ in the space of stiffness tensors can be written as  $D_g(g) = R_{ip}R_{jq}R_{kr}R_{ls}$, where $R \in SO(3)$ is a rotation matrix.

Let $Q \in P$, where $P$ denotes the set of rotations in the point group of a crystal, we will have $P \subset SO(3)$.
Therefore, for $R = Q$, \eref{eq:equi} is satisfied, i.e.,
\begin{equation}
   Q_{ip}Q_{jq}Q_{kr}Q_{ls} C_{prqs} = f(Qx)
\end{equation}
Owning to material symmetry, we have $Qx = x$, that is, the crystal structure $x$ is indistinguishable before and after the transformation.  
Thus, $f(Qx) = f(x)$. 
Plugging it into \eref{eq:equi}, we have 
\begin{equation}
   Q_{ip}Q_{jq}Q_{kr}Q_{ls} C_{prqs} = f(x) = C_{ijkl},
\end{equation}
which is Eq.(1) in the main text.
Once this is satisfied, the material symmetry will be reflected in the stiffness tensor as discussed in the main text and proved in \onlinecite{forte1996symmetry}.



\section*{Dataset statistics}

% Figure environment removed


% Figure environment removed


% Figure environment removed

% Figure environment removed

% Figure environment removed



\section*{Additional results on isotropic properties}


% Figure environment removed


% Figure environment removed


\begin{table}[H]
\small
\caption{Prediction of the bulk modulus $K$, shear modulus $G$, and Young's modulus $E$ in logarithmic space.
$K$, $G$, and $E$ are in the units of GPa.
The results for \net are calculated from a single model, while a separate AutoMatminer model is trained for each property.
The value in a pair of parentheses is the standard deviation from an ensemble of five models trained with different initialization.
MAE: mean absolute error; MAD: mean absolute deviation.}
\label{tab:k:g:log}
\centering
\begin{tabular}{@{\extracolsep{5pt}}ccccccc}
\hline
  &\multicolumn{2}{c}{$\log_{10}(K)$}  
  &\multicolumn{2}{c}{$\log_{10}(G)$}  
  &\multicolumn{2}{c}{$\log_{10}(E)$}   \\
  \cline{2-3} \cline{4-5} \cline{6-7}
  & MAE  & MAE/MAD & MAE  & MAE/MAD  & MAE & MAE/MAD \\
  
\hline
MatTen        & 0.046 (0.002)  &0.166 (0.006)   & 0.094 (0.002) & 0.331 (0.010)  & 0.087 (0.002) & 0.309 (0.018) \\
AutoMatminer  & 0.050 (0.002)  & 0.187 (0.009)  & 0.090 (0.002) & 0.307 (0.006)  & 0.086 (0.002)  &0.301 (0.009)\\
 \hline
\end{tabular}
\end{table}



\section*{Directional Young's modulus}

Here we prove that, for cubic crystals,
\begin{equation}\label{eq:max:E:dir:less}
\text{if}\, S_{1111} - S_{1122} - 2S_{2323} < 0, 
E_\text{d}^\text{max}\, \text{is along}\, \langle100\rangle\, \text{and}\,
E_\text{d}^\text{max}\, \text{is along}\, \langle111\rangle,
\end{equation}
otherwise,
\begin{equation}\label{eq:max:E:dir:greater}
\text{if}\, S_{1111} - S_{1122} - 2S_{2323} > 0, 
E_\text{d}^\text{max}\, \text{is along}\, \langle111\rangle\, \text{and}\,
E_\text{d}^\text{max}\, \text{is along}\, \langle100\rangle.
\end{equation}
and 
\begin{equation}\label{eq:max:E:dir:equal}
\text{if}\, S_{1111} - S_{1122} - 2S_{2323} = 0, \,
\text{the materials is isotropic regarding Young's modulus}.
\end{equation}

The inverse of the directional Young's modulus is 
\begin{equation} \label{eq:E:d:si}
       E_\text{d} ({\bm n})^{-1}  =n_i n_j n_k n_l S_{ijlk},
\end{equation}
where $S_{ijkl}$ is the compliance tensor and $\bm n$ is an unit direction vector.
For a cubic crystal, the 21 non-zero components can be classified into three groups \cite{nye1985physical}: 
\begin{itemize}
    \item $S_{1111} = S_{2222} = S_{3333}$ 
    \item $S_{1122} = S_{2211} = S_{2233} = S_{3322} = S_{3311} = S_{1133}$ 
    \item $  S_{2323} = S_{2332} = S_{3223} = S_{3232} 
           = S_{1212} = S_{1221} = S_{2112} = S_{2121} 
           = S_{1313} = S_{1331} = S_{3113} = S_{3131} $. 
\end{itemize}
Substituting these into \eref{eq:E:d:si}, we have, 
\begin{equation} \label{eq:E:d:cubic}
\begin{aligned}
 E_\text{d} ({\bm n}) ^{-1}
 &= S_{1111}(n_1^4 + n_2^4 + n_3^4) 
 + 2S_{1122}(n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2) 
 + 4S_{2323}(n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2)   \\
 &=  S_{1111} [1 - 2 (n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2)]
 + 2S_{1122}(n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2) 
 + 4S_{2323}(n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2)  \\
 & = S_{1111} - 2(S_{1111} - S_{1122} - 2S_{2323})  (n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2)  \\
 & = S_{1111} - 2(S_{1111} - S_{1122} - 2S_{2323})  f. 
\end{aligned}
\end{equation}
In the second equality, we have used 
$n_1^4 + n_2^4 + n_3^4
= (n_1^2 + n_2^2 + n_3^2)^2 - 2 (n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2)
= 1 - 2 (n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2)
$, in which $(n_1^2 + n_2^2 + n_3^2)^2 = 1$, because $\bm n$ is a unit vector.
In the last equality, we have defined  $f := n_1^2n_2^2 + n_2^2n_3^2 + n_3^2n_1^2$. 

From \eref{eq:E:d:cubic}, it seen that \eref{eq:max:E:dir:equal} is valid.


In fact, $f$ has its maximum value of $1/3$ along the $\langle 111 \rangle$ directions, and the minimum of $f$ is 0 along the $\langle 100 \rangle$ directions (derived below).
As a result, \eref{eq:max:E:dir:less} and \eref{eq:max:E:dir:greater} are valid.
(Note that \eref{eq:E:d:cubic} gives the inverse of the directional Young's modulus.)

Below, we show that the maximum of $f$ is $1/3$ along the $\langle 111 \rangle$ directions, and the minimum of $f$ is 0 along the $\langle 100 \rangle$ directions.

Let $n_1^2 = a, n_2^2 = b $ and $n_3^2 = c$, we have $a + b + c = 1$ because $\bm n$ is a unit vector.
Thus, 
\begin{equation} \label{eq:f}
f   
= ab + bc + ca  
= ab + c(b + a)  
= ab + (1-a - b)(b + a)  
= a + b - ab - a^2 - b^2  .
\end{equation}
Let 
\begin{equation}
\begin{aligned}
\frac{\partial f}{\partial a} & = 1 - b - 2a = 0 \\
\frac{\partial f}{\partial b} & = 1 - a - 2b = 0 , 
\end{aligned}
\end{equation}
and solve the equations, we have $a = b = c = 1/3$, i.e.\  $n_1^2 = n_2^2 = n_3^3 = 1/3$, 
At these values, $f=1/3$ and we can verify that it is a maximum.
This also suggests $\bm n$ is along the $\langle 111 \rangle$ family of directions. 

The other extreme values of $f$ are located at the boundaries of $a$ (or $b$ or $c$). Since $n_1$ is a component of the unit vector, then $n_1 \in [-1, 1]$, i.e.\  $a \in [0, 1]$. So, the extreme value is obtained when
\begin{itemize}
    \item  $n_1 = 0$, $n_2 = \pm 1$, $n_3 = 0$
    \item  $n_1 = 0$, $n_2 = 0$, $n_3 = \pm 1$
    \item  $n_1 = \pm 1$, $n_2 = 0$, $n_3 = 0$.
\end{itemize} 
These are the $\langle 100 \rangle$ directions, at which the minimum is $f=0$.


% Figure environment removed


% Figure environment removed


% Figure environment removed


% Figure environment removed

\fref{fig:max:E:parity} shows the $E_\text{d}^\text{max}$ for the 100 new crystals. 
The MAE between predicted $E_\text{d}^\text{max}$ with initial structure and predicted $E_\text{d}^\text{max}$ with further relaxed structure is 6.55~GPa. 
It is much smaller than the MAE (22.36~GPa) between \net prediction and DFT reference for the test set. 
This demonstrates the robustness of \net with respect to the structure of the input crystal as discussed in the main text.
As shown in \fref{fig:max:E:parity}~b, if we consider the 100 new crystals instead of the test set, the MAE between \net prediction and DFT is much higher, with a value of 48.69~GPa. 
This is expected, since, for the 100 new crystals, we are probing extreme values at the edge of the training data distribution, while the test set follows the same distribution of the training data.
This signifies the importance of further confirmation with more accurate computation (DFT in this case) and even experiments once the search space has been narrowed down via the screening using the model.


\begin{table}[H]
\small
\caption{Polymorphs of elemental cubic metal with $E_\text{d}^\text{max}$ along $\langle 100 \rangle$ directions and $E_\text{d}^\text{min}$ along $\langle 111 \rangle$ directions. 
$\Delta S = S_{1111} - S_{1122} - 2S_{2323}$.
Among the crystal structures with the same composition, the one having the lowest energy is called the ground-state polymorph and is stable with respect to phase transition into other structures \cite{bartel2022review}.
The crystal structures and the elasticity tensors of these metals are provided as well. See Data Availability in the main text.
}
\centering
\begin{tabular}{@{\extracolsep{5pt}}cccccc}
\hline
Materials Project ID   & Formula   & $\Delta S_\text{DFT}$  & $\Delta S_\text{MatTen}$   & Experimentally observed  & Ground-state polymorph\\
\hline
mp-129    & Mo    & -0.00150   & -0.00191    & Yes   & Yes  \\
mp-146    & V    & -0.00994   & -0.01006    & Yes  & Yes \\
mp-17    & Cr    & -0.00267   & -0.00253    & Yes  & No \\
mp-90    & Cr    & -0.00369   & 0.00055    & Yes   & Yes\\
mp-91    & W    & -0.00056   & -0.00042  & Yes  & Yes \\
mp-11334    & W    & -0.00285   & -0.00331    & No   & No \\
mp-35    & Mn    & -0.00222   & -0.00277    & Yes  & Yes \\
mp-1186040    & Na    & -0.15435   & -0.32852    & No  & No \\
mp-1184808    & K    & -0.34397   & -0.12334    & No  & No \\
mp-949029    & Cs    & -0.53668   & -4.79427    & No  & No \\
mp-1239193    & Rh    & -0.03371   & -0.06590    & No  & No \\
mp-1187790    & Tl    & -0.09708   & -0.05340    & No  & No \\

\hline
\end{tabular}
\end{table}


\section*{Model hyperparameters}
\begin{table}[H]
\renewcommand{\arraystretch}{1.2} % Increase row height by a factor of 1.5
\small
\caption{Hyperparameter values obtained by grid search.
}
\centering
\begin{tabular}{p{5cm}p{9cm}}
\hline
Value   & Hyperamater   \\
\hline
 5\AA  &  cutoff radius to construct crystal graph, $r_\text{cut}$\\
\arrayrulecolor{gray} % set color
\hline
  16   & size of one-hot embedding vector for atomic species, $c$ \\
\hline
  8    & number of radial basis functions, $n$ \\
\hline
  3    & number of interaction blocks  \\
\hline
     32x0o+32x0e+16x1o+16x1e +4x2o+4x2e+2x3o+2x3e+2x4e   & irreducible representation of atom features in interaction blocks \\
\hline

     0e+1o+2e+3o+4e   & irreducible representation of unit bond vector \\
\hline
     2   & number of MLP layers for embedding bond length as in $R_c$ \\
\hline
     32  & number of nodes in the MLP for embedding bond length as in $R_c$ \\
\hline
\arrayrulecolor{black} % change back
\hline
\end{tabular}
\end{table}







\newpage
\bibliographystyle{unsrtnat}
%\bibliography{supplemental.bib}
\input{suppl_supplemental.bbl}

\end{document}