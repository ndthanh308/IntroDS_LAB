\ifallproofs
\section{Proofs for \cref{cha:semantics}: \nameref{cha:semantics}}%
\label{proofs:sem}
\fi

\ifallproofs
\propsubalgebra*
\begin{proof}[Proof of \cref{prop:osf_subalgebra}]%
  \hypertarget{proof:subalgebra}{\mbox{}}%
  $\F^*(D)$ contains $D$ and is closed under feature application by
  construction.
  Clearly $\F^*(D)$ must be a subset of the domain of any subalgebra of
  $\ii$ containing $D$.

  Now we show that $\ii[D]$ satisfies all the conditions of
  \cref{def:osf_algebra}. Let
  $\si[0], \si[1]\in\S$ be arbitrary:
  \begin{itemize}
    \item Suppose that $\fisop(\si[0],\si[1]) = \beta$. Since $\ii$ is a
      fuzzy \osf interpretation it holds that, for any
      $d\in\dom[{\ii[D]}]\subseteq\dom$:
      $\sii[0](d)\land\beta\leq\sii[1](d)$.
      Thus
      $\sic[0](d)\land\beta = \sii[0](d)\land\cfun[\fcl](d) \land\beta \leq
      \sii[1](d)\land\cfun[\fcl](d) = \sic[1](d)$.
    \item Let $d\in \dom[{\ii[D]}] = \fcl$. %
      Then:
      \[
        \begin{array}[b]{lll}
          (\sic[0]\fcap \sic[1])(d) >0 & \To & \sic[0](d) > 0~\text{and}~\sic[1](d) >0 \\
                                       & \To & \sii[0](d) > 0~\text{and}~\sii[1](d)>0~\text{and}~\cfun[\fcl](d)>0\\
                                       & \To & (\sii[0]\fcap \sii[1])(d)>0~\text{and}~\cfun[\fcl](d)>0\\
                                       & \To & (\si[0]\fmeet\si[1])^\ii(d)> 0~\text{and}~\cfun[\fcl](d)>0\\
                                       & \To & (\si[0]\fmeet\si[1])^\ii(d)\land\cfun[\fcl](d)>0\\
                                       & \To & (\si[0]\fmeet \si[1])^{\ii[D]}(d) >0
        \end{array}\qedhere
      \]
  \end{itemize}
\end{proof}
\fi

\ifallproofs
\propsubalgebrasem*
\begin{proof}[Proof of \cref{prop:subalgebrasem}]%
  \hypertarget{proof:subalgebra_sem}{\mbox{}}%
    The first part is proved by induction on the structure of $t$.
    \begin{itemize}
      \item Let $t = \X:\s$ and let $d\in\dom$ be arbitrary. Then
        \[
          \begin{array}{llll}
            \denota[t](d) & = & \cfun[\{ \alpha(\X) \}](d) \land \s^\ii(d) &  \\
                          & = & \cfun[\{ \alpha(\X) \}](d) \land \s^\jj(d) & \text{(By \cref{def:fuzzy_osf_subalgebra})} \\
                          & = & \denoti[t][\jj](d)
          \end{array}
        \]
      \item Now let $t = \osfterm$ and let $d\in\dom$ be arbitrary.
        Then
        \[
          \begin{array}{llll}
            \denota[t](d) & = & \cfun[\{ \alpha(\X) \}](d) \land \s^\ii(d) \land\bigwedge\limits_{1\leq i\leq n} \denota[t_i](\fji[i](d)) & \\
                          & = & \cfun[\{ \alpha(\X) \}](d) \land \s^\jj(d) \land\bigwedge\limits_{1\leq i\leq n} \denoti[t_i][\jj](\fjj[i](d)) & \text{(By IH and \cref{def:fuzzy_osf_subalgebra})} \\
                          & = & \denoti[t][\jj]
          \end{array}
        \]
    \end{itemize}
    For the second part, note that $\alpha(\X)\in\dom[\ii]$ for all
    $\X\in\tags(\phi)$, and, for all $d\in\dom[\ii]$ and $\f\in\F$:
    $\f^\ii(d)\in\dom$. Then:
    \begin{itemize}
      \item $\ii,\alpha\models_\beta \X:\s
        \Iff
        \s^\ii(\alpha(\X))\geq\beta
        \Iff
        \s^\jj(\alpha(\X))\geq\beta
        \Iff
        \jj,\alpha\models_\beta \X:\s$.
      \item $\ii,\alpha\models_\beta \X.\f\doteq\Y
        \Iff
        \cf[\{\f^\ii(\alpha(\X))\}](\alpha(\Y)) \geq\beta
        \Iff
        \cf[\{\f^\jj(\alpha(\X))\}](\alpha(\Y)) \geq\beta
        \Iff
        \jj,\alpha\models_\beta \X.\f\doteq\Y$.
      \item $\ii,\alpha\models_\beta \X\doteq\Y
        \Iff
        \cf[\{\alpha(\X)\}](\alpha(\Y)) \geq\beta
        \Iff
        \jj,\alpha\models_\beta \X\doteq\Y$.\qedhere
    \end{itemize}
\end{proof}
\fi

\ifallproofs
\propequivalencetermsconstraints*
\begin{proof}[Proof of \cref{prop:equivalence_terms_constraints}]%
  \hypertarget{proof:equivalence_constraints}{\mbox{}}%
  \ifallproofs
  By induction on $t$. Let $t = \X:\s$ and thus $\phi(t) = \X:\s$. Then:
  \[
    \begin{array}{lllll}
     \denota[\X:\s](\alpha(\X))\geq\beta & \Iff & \s^\ii(\alpha(\X))\geq\beta
                                         & \Iff & \iimodb \X:\s.
    \end{array}
  \]
  Now let $t = \osfterm$, with $\Xj[i] = \rtag(t_i)$ for each $1\leq i\leq
  n$,
  so that $\phi(t) =
  \X:\s \osfwith
  \bigosfwith\limits_{1\leq i\leq n}
  (\phi(t_i) \osfwith \X.\fj[i] \doteq \Xj[i])$.
  Suppose that, for each $1\leq i\leq n$:
  \[
    \denota[t_i](\alpha(\Xj[i])) \geq \beta \;\Iff\; \iimodb \phi(t_i)~%
    (\text{induction hypothesis}).
  \]
  Hence
  \[
    \begin{array}{lll}
     \denota(\alpha(\X))\geq \beta & \Iff &
     \s^\ii(\alpha(\X))\geq\beta
     \text{ and }\\
                                   & & \forall 1\leq i \leq n:
     \cf[{\{\fji[i](\alpha(\X))\}}](\alpha(\Xj[i]))\geq\beta
     \text{ and }\denota[t_i](\alpha(\Xj[i]))\geq\beta\\
                                   & \Iff & \iimodb \X:\s \text{ and }
                                   \forall 1\leq i\leq n: \iimodb \X.\fj[i]
                                   \doteq \Xj[i] \osfwith \phi(t_i)\\
                                   & \Iff & \iimodb \phi(t).
    \end{array}
  \]
  \else
  The fact that $\denota(\alpha(\X))\geq \beta \Iff \iimodb \phi(t)$ holds
  can be proved by induction on $t$.
  \fi
  For the next part, note that
  \[\arraycolsep=3pt
    \begin{array}{lllll}
      \denota(\alpha(\X)) & = & \sup(\{\beta\in[0,1] \mid \denota(\alpha(\X)) \geq \beta\})
                          & = & \sup(\{\beta\in[0,1]\mid \ii,\alpha\models_{\beta} \phi(t) \}).
    \end{array}
  \]
  Finally, note that $\denot(d)$ can be rewritten as follows:
  \[
    \begin{array}[b]{lll}
      \denot(d) & = & \fbigcup\limits_{\alpha:\V\to\dom}\denota(d)\\
                & = & \sup(\{\beta\mid\alpha\in\val(\ii)~\text{and}~\denota(d) = \beta \})\\
                & = & \sup(\{\beta\mid\alpha\in\val(\ii)~\text{and}~\alpha(\X)=d~\text{and}~\denota(d) = \beta \})\\
                & = & \sup(\{\beta\mid\alpha\in\val(\ii)~\text{and}~\alpha(\X)=d~\text{and}~\denota(d) \geq \beta \})\\
                & = & \sup(\{\beta\mid\alpha\in\val(\ii)~\text{and}~\alpha(\X)=d~\text{and}~\ii, \alpha\models_{\beta} \phi(t) \}).
    \end{array}\qedhere
  \]
\end{proof}
\fi

\ifallproofs
\propsolutionpreservation*
\begin{proof}[Proof of \cref{prop:osf_clause_normalization_semantics}]%
  \hypertarget{proof:preservation}{\mbox{}}%
  The only rule worth considering is \osfref{osf:si}.
  Suppose that
  $\iimodb \X:\si[0]\osfwith \X:\si[1]$
  for some $\beta>0$.
  It follows that
  $\sii[0](\alpha(\X)) > 0$
  and
  $\sii[1](\alpha(\X))> 0$
  so that
  $(\sii[0]\fcap\sii[1])(\alpha(\X))>0$.
  By
  \cref{def:osf_algebra}
  then
  $(\si[0]\fmeet\si[1])^\ii(\alpha(\X))>0$,
  so that
  $\iimod_{\beta'} \X:\si[0]\fmeet\si[1]$ for some $\beta'>0$.

  With respect to the other direction,
  let $\s = \si[0]\fmeet\si[1]$ for convenience and
  suppose that
  $\iimod_{\beta} \X:\s$
  for some $\beta>0$, so that
  $\s^\ii(\alpha(\X)) > 0$.
  Let $\beta_0 = \fisop(\s, \si[0])>0$
  and $\beta_1 = \fisop(\s, \si[1])>0$. By
  \cref{def:osf_algebra} then
  $\s^\ii(\alpha(\X))\land\beta_0 \leq \sii[0](\alpha(\X))$ and
  $\s^\ii(\alpha(\X))\land\beta_1 \leq \sii[1](\alpha(\X))$, so that
  $\s^\ii(\alpha(\X))\land\beta_0\land\beta_1 \leq
  \sii[0](\alpha(\X)) \land \sii[1](\alpha(\X))$. Thus $\sii[0](\alpha(\X))
  \land \sii[1](\alpha(\X))>0$, so that $\iimod_{\beta'}
  \X:\si[0]\osfwith\X:\si[1]$ for some $\beta'>0$.
\end{proof}
\fi

\ifallproofs
\propgraphalgebra*
\begin{proof}[Proof of \cref{prop:graphalgebra}]%
  \hypertarget{proof:fuzzy_osf_graph_algebra}{\mbox{}}%
  We focus on conditions 3 and 4 of \cref{def:osf_algebra}.

  Let $\si[0],\si[1]\in \S$ and let $g=\ograph$ be an \osf graph.
  Then $\sgg[0](g)\land \fisop(\si[0], \si[1]) = \fisop(\lambda_N(\X),
  \si[0]) \land \fisop(\si[0], \si[1]) \leq \fisop(\lambda_N(\X), \si[1]) =
  \sgg[1](g)$ by transitivity of $\fisop$.

  Now suppose $(\sgg[0]\fcap \sgg[1])(g) >0$, so that
  $\sgg[i](g) = \fisop(\lambda_N(\X), \si[i]) > 0$ for $i\in\{ 0,1 \}$.
  Because $\ftax$ is a fuzzy lattice then %
  $\fisop(\lambda_N(\X), \si[0]\fmeet\si[1])>0$, so that
  $(\si[0]\fmeet\si[1])^\gg(g)> 0$.
\end{proof}
\fi

\ifallproofs
\thmsatisfiability*
\begin{proof}[Proof of \cref{thm:satisfiability}]%
  \hypertarget{proof:satisfiability}{\mbox{}}%
  If $\phi$ contains a constraint of the form $\Y:\s$, then
  $\canon,\alpha\models_1\Y:\s\Iff\s^{\canon}(\alpha(\Y)) = 1$, which holds
  because $\alpha(\Y) = G(\phi(\Y))$ is an \osf graph with root labeled by
  $\s$ by construction, so $\s^{\canon}(\alpha(\Y)) = \fisop(\s, \s) = 1$.

  If $\phi$ contains a constraint of the form $\Y.\f \doteq \Z$, then
  $\canon,\alpha\models_1\Y.\f\doteq\Z
  \Iff
  \f^{\canon}(\alpha(\Y)) = \alpha(\Z)
  \Iff
  \f^{\canon}(G(\phi(\Y))) = G(\phi(\Z))$, which is true by construction of
  $G(\phi(\Y))$
  and
  $G(\phi(\Z))$.
\end{proof}
\fi
