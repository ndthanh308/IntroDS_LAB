\section{Fuzzy \osf interpretations}%
\label{cha:semantics}

In this section we start our development of a fuzzy semantics of \osf logic
based on the minimum t-norm and the maximum t-conorm.
We begin by defining \textit{fuzzy \osf interpretations}, the structures
used to interpret the syntax of \osf logic.
These provide the meaning of a fuzzy sort subsumption relation and
determine the denotations of sort symbols as fuzzy subsets and of feature
symbols as functions.

In \cref{cha:syntax} we have presented \osf terms and \osf
  clauses as two alternative (and syntactically equivalent) data structures
for representing knowledge with \osf logic.
We thus define
the \textit{denotation} of an \osf term as a fuzzy subset of the domain
and
the \textit{graded satisfaction} of an \osf clause,
and show that these two notions are semantically equivalent too.

There is, in fact, a third syntactic representation level, namely that of
\textit{\osf graphs}. These are rooted directed graphs whose nodes are
labeled by sorts and whose edges are labeled by features, and that are
also syntactically equivalent to $\psi$-terms and rooted solved \osf
clauses. \osf graphs play an essential role in the semantics of fuzzy \osf
logic, as they are the elements of the domain of
the \textit{fuzzy \osf graph algebra},
a fuzzy interpretation in which every solved \osf clause is
satisfiable.%


\subsection{Fuzzy \osf interpretations}%
\label{sec:osf_algebra}

Let us fix a fuzzy signature $\fss$ for the rest of the section.

\begin{definition}[Fuzzy \osf interpretation]
\label{def:osf_algebra}
A \textit{(fuzzy) \osf interpretation} (or \textit{algebra}) for $\fss$ is
a pair $\ii = \osfa$ such that\footnotemark
\begin{enumerate}
  \item $\dom$ is a set called the \textit{domain} or \textit{universe} of
    the interpretation;
  \item for each $\s\in \S$, $\s^\ii:\dom\to[0,1]$ is a fuzzy subset of
    $\dom$ (where in particular $\tops^\ii = \cf[{\dom[\ii]}]$ and
    $\bots^\ii = \cf[\emptyset]$);
  \item for each $\si[0],\si[1]\in \S$,
    $\forall d\in\dom: \sii[0](d)\land\fisop(\si[0], \si[1])\leq\sii[1](d)$;
  \item for each $\si[0],\si[1]\in \S,\forall d\in\dom$: if
    $(\sii[0]\fcap \sii[1])(d) >0$,
    then $(\si[0]\fmeet\si[1])^\ii(d)> 0$; and
  \item for each $\f\in \F$: $\f^\ii$ is a function $\f^\ii:\dom\to\dom$.
\end{enumerate}
\end{definition}
In the following we write $d\in\ii$ and $d\in\dom$ interchangeably.

\footnotetext{%
    The symbol $\cf[D]$ denotes the characteristic function $\cf[D]:
    \dom\to\{ 0,1 \}$ of the set
    $D\subseteq\dom$, which is defined by letting, for all $d\in \dom$,
    $\cf[D](d) \defeq 1$
    if $d\in D$, and
    $\cf[D](d) \defeq 0$
    otherwise. The symbol $\fcap$ denotes the intersection of
    fuzzy subsets (\cref{def:intersection_of_fuzzy_subsets}).}

The motivation behind condition (3) has been discussed in the
\nameref{cha:introduction}.
In order to motivate condition (4), let us momentarily switch to a crisp
setting, where $\s^\ii$ denotes a (crisp) subset of the domain
$\dom[\ii]$, $\isop\subseteq \S^2$ is a binary (subsumption) relation and
$\meet$ is the GLB operation on $(\S, \isa)$. The definition of an \osf
algebra \cite{AitKaci1993b} requires that
$\sii[0]\cap\sii[1] \subseteq (\si[0]\meet\si[1])^\ii$ holds for every
$\si[0], \si[1]\in\S$, i.e., whenever an element belongs to the
intersection of the denotations of two sorts, then it must also belong to
the denotation of their GLB.
Our fuzzy generalization of this requirement is very flexible
as it does not impose restrictive constraints on the membership degree of
$d$ to
$(\si[0]\fmeet\si[1])^\ii$, but it simply requires that whenever an object is
an instance of two sorts $\si[0]$ and $\si[1]$ with a degree greater than
$0$, then it must also be an instance of their GLB with a degree greater
than $0$.

\input{fuzzy/algebra_example}

We now define subalgebras of fuzzy \osf algebras.
\begin{definition}[$\F$-closure]
  \label{def:fclosure}
  Let $\ii$ be an \osf interpretation.
  For each feature composition $w = \fj[1]\ldots\fj[n]\in\F^*$ let $w^\ii =
  \fji[n]\circ \ldots\circ\fji[1]$ be the corresponding function composition
  on $\dom$. For any non-empty subset $D$ of $\dom$ the
  \textit{$\F$-closure} of $D$ is the set
  \[
    \F^*(D) \defeq \bigcup\limits_{w\in \F^*}w^\ii(D) =
    \bigcup\limits_{w\in \F^*}\{ w^\ii(d)\mid d\in D \}.
  \]
  In other words $\F^*(D)$ is the smallest set containing $D$ and closed
  under feature application.
\end{definition}

\begin{definition}[Fuzzy \osf subalgebra]
  \label{def:fuzzy_osf_subalgebra}
  Let $\ii$ and $\jj$ be fuzzy \osf interpretations.
  Then $\ii$ is a subalgebra of $\jj$ if
  $\dom[\ii]\subseteq\dom[\jj]$ and for all
  $d\in\dom[\ii]$, all $\s\in\S$ and all $\f\in\F$:
  $\s^\ii(d) = \s^\jj(d)$ and
  $\f^\ii(d) = \f^\jj(d)$.
\end{definition}

\begin{definition}[$\osf$ subalgebra generated by a set]
  \label{def:osf_subalgebra}
  Let $\ii = \osfa$ be a fuzzy \osf interpretation and $D\subseteq\dom$ be
  nonempty. Then the fuzzy $\osf$ subalgebra generated by $D$ is the structure
  $\ii[D] = (\F^*(D), \cdot^{\ii[D]})$ such that, for each $\s\in\S$,
  $\s^{\ii[D]} = \s^\ii\fcap\cf[\F^*(D)]$, and for each $\f\in\F$, $\f^{\ii[D]}$
  is the restriction of $\f^\ii$ to $\F^*(D)$.
\end{definition}
When $D=\{ d \}$ is a singleton we write $\ii[d]$ instead of $\ii[\{ d
\}]$.

\myrestatable%
  {Least $\osf$ subalgebra generated by a set} %
  {prop} %
  {prop:osf_subalgebra} %
  {proof:subalgebra} %
  {propsubalgebra} %
  {%
  Let $\ii = \osfa$ be an \osf interpretation. For any
  non-empty subset $D\subseteq\dom$ the structure $\ii[D]$ is the least
  fuzzy subalgebra of $\ii$ \mbox{containing $D$.}%
  }

\subsection{Denotation of an \osf term}%
\label{sec:denotation_of_an_osf_term_in_an_osf_algebra}

We now define the meaning of an \osf term in a fuzzy \osf interpretation. Let
$\val(\ii)$ be the set of all variable assignments $\osfval$.

\begin{definition}[Denotation of an \osf term]
\label{def:osf_term_denotation}
  Let $t = \osfterm$ be an \osf term, let $\ii = \osfa$ be a fuzzy \osf
  interpretation, and
  let $\alpha: \V\to\dom$ be a variable assignment. The denotation of
  $t$ in the interpretation $\ii$ under the assignment $\alpha$ is the fuzzy
  subset of $\dom$ defined by letting, for all $d\in\dom$:
  \[
    \denota[t](d) \defeq
    \cfun[\{ \alpha(\X) \}](d) \land
    \s^\ii(d)
    \land\bigwedge\limits_{1\leq i\leq n} \denota[t_i](\fji[i](d)).
  \]
  The denotation of $t$ in the interpretation $\ii$ is defined
  as\footnote{%
    The symbol $\fcup$ denotes the union of fuzzy subsets
  (\cref{def:intersection_of_fuzzy_subsets}).}
  \[
    \denot = \fbigcup\limits_{\alpha:\V\to\dom}\denota.
  \]
\end{definition}
\cref{def:osf_term_denotation} is a direct generalization of the crisp
denotation of an \osf term in an \osf interpretation under an assignment
$\alpha$
\cite{AitKaci1993b}. Note that the crisp denotation of a term is always a
singleton or the empty set, while $\denota[t]$ has a value grater than 0
for at most one element $d\in\dom$.

\begin{example}[Denotation of an \osf term]
\label{ex:osf_term_denotaion}
  Continuing from \cref{ex:fuzzy_osf_interpretation}, let $t$ be the term
  $\X:\thriller \left( \dirby \to \Y:\director \right)$
  and $\alpha$ be an assignment such that $\alpha(\X) = \halloween$ and
  $\alpha(\Y) = \carpenter$. Then (with $h \defeq \halloween$ and $c \defeq
  \carpenter$):
  \[%
    \begin{array}[b]{lllllllll}
      \denota[t](h) & = & \cfun[\{ \alpha(\X) \}](h) & \land & \thriller^\ii(h) & \land & \multicolumn{3}{l}{\denota[\Y:\director](\dirby^\ii(h))} \\
                    & = & 1                          & \land & 0.5              & \land & \multicolumn{3}{l}{\denota[\Y:\director](c)}             \\
                    & = & 1                          & \land & 0.5              & \land & \cfun[\{ \alpha(\Y) \}](c) & \land & \director^\ii(c) \\
                    & = & 1                          & \land & 0.5              & \land & 1                          & \land & 1 = 0.5.
    \end{array}
  \]
  Now consider the term $t'=
  \X:\movie \left( \dirby \to \Y:\director, \dirby\to \Y:\strng \right)$
  and note that $\director\fmeet\strng = \bots$. It follows that the
  denotation of $t'$ in any fuzzy \osf interpretation $\ii$ is always equal
  to $0$, i.e., the term $t'$ is contradictory.
  Indeed, suppose towards a contradiction that
  $\denota[t'](d)> 0$ for some \osf interpretation $\ii=\osfa$, $d\in\dom$
  and valuation $\alpha$. Then it must be the case that
  $\director^\ii(d') \land \strng^\ii(d') > 0$ or, equivalently,
  $(\director^\ii\fcap\strng^\ii)(d') > 0$,
  where $d' = \alpha(\Y)$.
  From \cref{def:osf_algebra} it follows that
  $(\director\fmeet\strng)^\ii(d') = \bots^\ii(d') > 0$,
  which is impossible since $\bots^\ii = \cf[\emptyset]$.%
\end{example}

\begin{remark}[Denotation of an \osf term]
  \label{rem:osf_term_denotation}
  Let $t=\osfterm$ be an \osf term and $\Xj[i] = \rtag(t_i)$ for each $i$.
  Let $\ii$ be an \osf interpretation and $d\in\dom$. It is easy to
  see that, if $\alpha_0$ and $\alpha_1$ are assignments such that
  \[
    \begin{array}{lll}
      \denota[t][\alpha_0](d) = \beta_0 >0 &
      \text{and} &
      \denota[t][\alpha_1](d) = \beta_1 >0,
    \end{array}
  \]
  then it must be the case that $\alpha_0(\Y) = \alpha_1(\Y)$ for all
  $\Y\in\tags(t)$, and thus $\beta_0 = \beta_1$.
  Indeed, it must be the case that $\alpha_0(\X) = \alpha_1(\X) = d$, and
  so for each $\fj[i]$ is must hold that $\alpha_0(\Xj[i]) = \fji[i](d) =
  \alpha_1(\Xj[i])$, and so on for all subterms.
  Hence the set $\{ \beta \mid \denota(d) = \beta > 0 \text{ for some }
  \alpha:\V\to\dom\}$ is a singleton and if $\denot(d) = \beta>0$, then there exists
  some $\alpha$ such that $\denota(d) = \beta$.
\end{remark}

\subsection{Satisfaction of \osf clauses in an \osf algebra}
\label{sec:constraint_semantics}

We now define the graded satisfaction of an \osf clause in a fuzzy \osf
interpretation, generalizing the crisp definition from \cite{AitKaci1993b}.
\begin{definition}[Satisfaction of an \osf clause in an \osf algebra]
\label{def:osf_clause_satisfaction}
  If $\ii = (\dom, \cdot^\ii)$ is a fuzzy \osf interpretation and $\osfval$
  is an assignment, then the satisfaction of an \osf clause $\phi$ to a degree
  $\beta\in[0,1]$ in the
  interpretation $\ii$ under the assignment $\alpha$ (notation:
  $\ii,\alpha\models_\beta\phi$) is defined recursively as follows:
  \[
    \begin{array}{lll}
      \ii,\alpha\models_\beta \xs & \Leftrightarrow &
      \s^\ii(\alpha(\X))\geq\beta,\\
      \addlinespace[1mm]
      \ii,\alpha\models_\beta \X\doteq\Y & \Leftrightarrow &
      \cf[\{\alpha(\X)\}](\alpha(\Y))\geq\beta,\\
      \addlinespace[1mm]
      \ii,\alpha\models_\beta \X.\f\doteq\Y & \Leftrightarrow &
      \cf[\{\f^\ii(\alpha(\X))\}](\alpha(\Y))\geq\beta,\\
      \addlinespace[1mm]
      \ii,\alpha\models_\beta \phi\osfwith\phi'& \Leftrightarrow &
      \ii,\alpha\models_\beta\phi \text{ and }
      \ii,\alpha\models_\beta\phi'.
    \end{array}
  \]
  If $\iimodb\phi$, then $\alpha$ is called a \textit{solution}
  in $\ii$
  for the clause $\phi$ with degree $\beta$, and $\phi$ is said to be
  \textit{satisfiable} in $\ii$ with degree $\beta$. The clause $\phi$ is
  said to be satisfiable in $\ii$ if there is some $\alpha:\V\to\dom$ and
  $\beta>0$ such that $\iimodb\phi$, and $\phi$ is said to be satisfiable
  if there is some $\ii$ such that $\phi$ is satisfiable in $\ii$.
\end{definition}
Note that $\ii,\alpha\models_0\phi$ always holds for any fuzzy \osf
interpretation $\ii$, assignment $\alpha$ and \osf clause $\phi$ (the
satisfaction degree of a clause for a given assignment and interpretation
is always greater than or equal to $0$). Moreover,
for any
$\beta\in(0,1]$,
\[
  \begin{array}{lllllll}
    \iimodb\X\doteq\Y    & \Iff & \cf[\{\alpha(\X)\}](\alpha(\Y))\geq\beta         & \Iff & \alpha(\X) = \alpha(\Y)         & \Iff & \iimod_1\X\doteq\Y,\\
    \iimodb\X.\f\doteq\Y & \Iff & \cf[\{\f^\ii(\alpha(\X))\}](\alpha(\Y))\geq\beta & \Iff & \f^\ii(\alpha(\X)) = \alpha(\Y) & \Iff & \iimod_1\X.\f\doteq\Y,
  \end{array}
\]
and
\[
  \begin{array}{lllll}
    \alpha(\X)\neq\alpha(\Y) & \To & \cf[\{\alpha(\X)\}](\alpha(\Y)) = 0 & \To & \ii,\alpha\models_0 \X\doteq\Y,\\
    \f^\ii(\alpha(\X))\neq\alpha(\Y) & \To & \cf[\{\f^\ii(\alpha(\X))\}](\alpha(\Y)) = 0 & \To & \ii,\alpha\models_0 \X.\f\doteq\Y.
  \end{array}
\]

\myrestatable%
  {Denotation and satisfaction in subalgebras}
  {prop}
  {prop:subalgebrasem}
  {proof:subalgebra_sem}
  {propsubalgebrasem}
  {%
    Let $\ii$ be a subalgebra of $\jj$. Then, for every \osf term $t$,
    every \osf clause $\phi$, every assignment $\alpha:\V\to\dom[\ii]$ and
    every $\beta\in[0,1]$:
    (i) $\denota[t](d) = \denoti[t][\jj](d)$ for all $d\in\dom$, and (ii)
    $\ii, \alpha\models_\beta
    \phi$ if and only if $\jj, \alpha\models_\beta \phi$.%
  }

We now provide the connection between the denotation of an \osf term $t$ in a
fuzzy interpretation and the degree of satisfaction of the corresponding \osf
clause $\phi(t)$.
\myrestatable%
  {Equivalence of terms denotation and constraints satisfaction} %
  {prop} %
  {prop:equivalence_terms_constraints} %
  {proof:equivalence_constraints} %
  {propequivalencetermsconstraints} %
  {%
  For every \osf term $t$ (with root variable $\X$),
  every interpretation $\ii$,
  every assignment $\alpha$,
  and every $\beta\in[0,1]$:
    $\denota[t](\alpha(\X)) \geq \beta \;\Iff\; \iimodb \phi(t)$.
  Therefore
    $\denota[t](\alpha(\X)) = \sup(\{\beta\mid \ii,\alpha\models_{\beta} \phi(t)\})$
  and thus, for all $d\in\dom$:
    $\denot(d) =
    \sup(\{\beta\mid\alpha\in\val(\ii)~\text{and}~\alpha(\X)=d~\text{and}~\ii,
    \alpha\models_{\beta} \phi(t) \})$.%
  }
The constraint normalization rules of \cref{fig:osf_normalization} preserve the
satisfiability of an \osf clause.
\myrestatable%
  {Solution-preservation of {\osf} clause normalization} %
  {prop} %
  {prop:osf_clause_normalization_semantics} %
  {proof:preservation} %
  {propsolutionpreservation} %
  {%
  For any rule of \cref{fig:osf_normalization} with premise
  $\phi$ and conclusion $\phi'$,
  for every fuzzy \osf algebra $\ii$ and assignment $\alpha$:
  $\ii,\alpha\models_\beta \phi$ for some $\beta>0$ if and only if $\ii,
  \alpha\models_{\beta'}\phi'$ for some $\beta'>0$.%
}
Note that the degrees $\beta$ and $\beta'$ in the last proposition may be
not be the same, so that the degree of satisfaction of an \osf
constraint in an algebra $\ii$ according to some assignment $\alpha$ may be
different from the degree of satisfaction of its solved form in the same
algebra and according to the same assignment. Together with
\cref{prop:equivalence_terms_constraints}, this implies
that the denotation of an \osf term $t$ in a fuzzy \osf interpretation may
not coincide
with the denotation of its normal form $\psi$ obtained by
applying the constraint normalization procedure to $\phi(t)$. This
constitutes a significant departure from crisp \osf logic, where in any
\osf algebra
every \osf clause is equivalent to its solved form,
and
every \osf term has the same denotation as its normal form.

\subsection{\osf graphs and fuzzy \osf graph algebra}

\input{common/graph}

\osf graphs play a fundamental role in the semantics  of crisp \osf logic
\cite{AitKaci1993b} and,
as we will see, in that of our fuzzy generalization of this language. In
particular, they are the elements of the domain of the fuzzy \osf graph
algebra, a fuzzy \osf interpretation which will be essential for proving many
results about fuzzy \osf logic. This fuzzy interpretation is defined next.

\begin{definition}[Fuzzy \osf graph algebra]
\label{def:osf_graph_algebra}
  The \textit{fuzzy \osf graph algebra} is the pair $\gg = \osfg$ defined
  as follows.
  \begin{enumerate}
    \item The domain $\dom[\gg]$ is the set of all \osf graphs.
    \item For each $\s\in\S$ and for each graph $g = \ograph\in\dom[\gg]$:
      $\s^\gg(g) \defeq \fisop(\lambda_N(\X), \s)$.
    \item For each $\f\in\F$, the function $\f^\gg:\dom[\gg]\to\dom[\gg]$
      is defined by letting, for any $g = \ograph$:%
      \[
        \f^\gg(g) \defeq
        \begin{cases}
          \restr{g}{\Y} & \text{if}~\exists \Y\in N%
                          ~\text{such that}~\lambda_E(\X, \Y) = \f,\\
          \tgraph & \text{otherwise,}
        \end{cases}
      \]
      where
      \begin{itemize}
        \item $\restr{g}{\Y}$ is the maximally connected subgraph of $g$
          rooted at $\Y$; and
        \item $\tgraph$ denotes the trivial \osf graph
          $(\{ \tvar \}, \emptyset, \{ (\tvar, \tops) \}, \emptyset, \tvar)$
          whose only node is the new variable $\tvar\in\V\setminus N$ --
          labeled $\tops$ -- which is uniquely determined by the feature
          $\f$ and the graph $g$, i.e., if $\f\neq\f[f']$ or $g\neq g'$,
          then $\tvar\neq \tvar[f'][g']$.
      \end{itemize}
  \end{enumerate}
\end{definition}
This definition generalizes the \osf graph algebra of \cite{AitKaci1993b}: the
interpretation of feature symbols is the same, but the denotation of a sort
symbol $\s$ is now a fuzzy set whose value for a graph $g$ with root $\X$ is
the subsumption degree of the root sort $\lambda_N(\X)$ with respect to $\s$.

\begin{example}[\osf graph algebra]
  Consider the fuzzy subsumption relation corresponding to the graph of
  \cref{fig:fuzzy_sub_small}.
  Then, for example, $\thriller^\gg$ is the function such that:
  \begin{itemize}
    \item $\thriller^\gg(g) = 1$ for any \osf graph $g$ whose root is labeled
      by $\thriller$ or by $\bots$;%
    \item $\thriller^\gg(g) = \appdegree$ for any \osf graph $g$ whose root is
      labeled by $\slasher$; and
    \item $\thriller^\gg(g) = 0$ for any other \osf graph $g$.
  \end{itemize}

  \cref{fig:osf_graph_algebra} shows how features are interpreted in the
  fuzzy \osf graph algebra. \osf graphs are represented inside boxes.
  For a feature $\f$, the application of $\f^\gg$ to a graph $g$ is represented
  as an arrow originating from the box containing $g$
  and pointing at the box containing $\f^\gg(g)$.
  The figure shows the iterative application of a few
  features to the graph
  $g$ corresponding to the term
  \[
    \s[s_0]
    \left(
      \begin{array}{lll}
        \f[f_{2}] & \to & \s[s_1],\\
        \f[f_{0}] & \to & \X[X]:\s[s_2]
        \left(
          \begin{array}{lll}
            \f[f_{4}] & \to & \X[Y],\\
            \f[f_{3}] & \to & \s[s_1]
          \end{array}
        \right),\\
        \f[f_{1}] & \to & \X[Y]:\s[s_3]
        \left(
          \begin{array}{lll}
            \f[f_{4}] & \to & \X[X]
          \end{array}
        \right)
      \end{array}
    \right).
  \]
  Note that the result of applying the function $\f^\gg$ to a graph that
  does not contain this feature results in a trivial graph (e.g., the
  application of $\fjg[3]$ to $g$ or to $\fjg[1](g)$).
\end{example}
\input{figures/graph_algebra}

\myrestatable%
  {Fuzzy \osf graph algebra} %
  {prop} %
  {prop:graphalgebra} %
  {proof:fuzzy_osf_graph_algebra} %
  {propgraphalgebra} %
  {%
    The fuzzy \osf graph algebra of \cref{def:osf_graph_algebra} is a fuzzy
    \osf interpretation in the sense of \cref{def:osf_algebra}.%
  }

Every solved \osf clause $\phi$ is satisfiable in
a subalgebra of the fuzzy \osf graph algebra, namely the subalgebra %
generated by the graphs corresponding to the maximal rooted subclauses of
$\phi$.
\begin{definition}[Canonical graph algebra]
\label{def:canonical_graph_algebra}
  Let $\phi$ be a solved \osf clause. The subalgebra $\gg[\dom[\gg,\phi]]$ of
  the \osf algebra $\gg$ generated by
  $\dom[\gg,\phi] \defeq \{ G(\phi(\X)) \mid \X\in\osftags(\phi) \}$
  is called the \textit{canonical graph algebra} induced by $\phi$.
\end{definition}
\myrestatable%
  {Satisfiability} %
  {prop} %
  {thm:satisfiability} %
  {proof:satisfiability} %
  {thmsatisfiability} %
  {%
  Any solved clause $\phi\in\Phi$ is satisfiable in $\canon$
  with degree $1$ under any assignment $\alpha:\V\to\dom[\canon]$ such that
  $\alpha(\Y) = G(\phi(\Y))$ for all $\Y\in\tags(\phi)$.%
}

The following is a corollary of
\cref{thm:satisfiability,prop:subalgebrasem}.
\begin{corollary}[Canonical solution]
  \label{coro:canonical}
  Any solved \osf clause $\phi$ is satisfiable in the \osf graph
  algebra $\gg$ with degree $1$ under any assignment
  $\alpha:\V\to\dom[\gg]$ such that, for each
  $\Y\in\osftags(\phi(\X))$, $\alpha(\Y) = G(\phi(\Y))$.%
\end{corollary}
