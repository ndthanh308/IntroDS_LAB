\section{Fuzzy \osf orderings and subsumption}%
\label{sec:subsumption}

In this section we define a fuzzy approximation ordering between \osf
graphs, a fuzzy subsumption ordering between \osf terms and a graded
implication ordering between \osf clauses. We show that these fuzzy
relations are equivalent and that they constitute fuzzy partial
orders%
\footnote{To be more precise, these fuzzy orders are antisymmetric on
  \textit{equivalence classes} of \osf graphs, normal \osf terms and rooted
  solved \osf clauses, as detailed later.}
on, respectively, \osf graphs, normal \osf terms and rooted solved \osf
clauses.
We give both a \textit{semantic} and \textit{syntactic} definition of fuzzy
subsumption of \osf terms, and prove that they are equivalent. We also
provide a link between the crisp definition of subsumption of \osf terms
\cite{AitKaci1993b} and our fuzzy generalization.

We begin by defining a fuzzy preorder on the elements
of any fuzzy \osf interpretation.

\input{figures/approx}

\begin{definition}[Endomorphic approximation]
\label{def:endomorphic_approximation}
On each fuzzy \osf interpretation $\ii$ a fuzzy binary relation
$\fapproximates[\ii]:\dom\times\dom\to[0,1]$ is defined by letting, for all
$d, d'\in\dom$:
\[
  \fapproximates[\ii](d, d') =
  \sup(\{ \beta \mid
  \gamma(d) = d'~\text{for some $\beta$-homomorphism}~\gamma:\ii[d]\to\ii[d']
\}).
\]
If $\fapproximates[\ii](d, d') = \beta$ (abbreviated as
$d\fapprel d'$) we say that
$d$ \textit{approximates} $d'$ with degree $\beta$.
\end{definition}

\begin{example}[Endomorphic approximation]
\label{ex:endomorphic_approximation}
Let
\begin{align*}
  g_0 &= G(\Xj[0]:\thriller \left( \dirby \to \Yj[0]:\director \right))~\text{and}\\
  g_1 &= G(\Xj[1]:\slasher \left(\dirby \to \Yj[1]:\director, \ttle\to\Zj[1]:\s[string] \right)).
\end{align*}
Define $\gamma:\dom[{\gg[g_0]}]\to\dom[{\gg[g_1]}]$ by letting, for each $g
= w^\gg(g_0)$ in $\dom[{\gg[g_0]}]$ (with $w\in\F^*$): $\gamma(g) =
w^\gg(g_1)$. This is depicted in \cref{fig:approx} (where not all
trivial graphs are shown, and some names are shortened).
In particular $\gamma(g_0) = g_1$. The function
$\gamma$ is a $\appdegree$-morphism witnessing
$\fapproximates(g_0, g_1) = 0.5$.
\end{example}

\begin{remark}
  Let $\ii$ be a fuzzy \osf algebra and $d,d'\in\dom[\ii]$. Suppose that
  $\fapproximates[\ii](d, d') = \beta' > 0$. Then \cref{prop:homsel}
  guarantees that there exists a $\beta'$-morphism
  $\gamma':\ii[d]\to\ii[d']$ such that $\gamma'(d) = d'$, i.e., that
  $\beta'=\sup(\{ \beta \mid \gamma(d) = d'~\text{for some
    $\beta$-morphism}~\gamma:\ii[d]\to\ii[d']\})$ is a maximum.
\end{remark}

\begin{restatable}%
  [{\protect\hyperlink{proof:proppreorder}{Endomorphic approximation fuzzy preorder}}]%
  {prop}{proppreorder}
  \label{prop:preorder}
  For all fuzzy $\osf$ interpretations $\ii$, the fuzzy binary relation
  $\fapproximates[\ii]$ is a fuzzy preorder.
\end{restatable}

Like the subsumption lattice of first-order terms
\cite{Reynolds1970,Plotkin1969},
which is antisymmetric modulo variable renaming, our fuzzy partial orders
on \osf graphs, \osf terms and \osf clauses will only satisfy antisymmetry
between equivalence classes of these objects.
Our situation is slightly complicated by the fact that features are
interpreted as total functions, and thus, for instance, there exist \osf
terms that are semantically equivalent (i.e., they have the same denotation
in every fuzzy \osf interpretation)
without being variable renamings of each other.
An example is given by the terms
$\psi_0 = \Xj[0]:\s(\f\to\Yj[0]:\su)$
and
$\psi_1 = \Xj[1]:\s(\f\to\Yj[1]:\su, \f[f']\to\Zj[1]:\tops)$.
We now define an equivalence relation on \osf graphs that takes
care of this issue.

\begin{definition}[\osf graph equivalence]
\label{def:osf_graph_equivalence}
  Two \osf graphs $g_0$ and $g_1$ are \textit{equivalent} (notation: $g_0
  \gequiv g_1$) if there are
  1-morphisms
  $\gamma_0: \gg[g_0]\to\gg[g_1]$ and
  $\gamma_1: \gg[g_1]\to\gg[g_0]$ such that
  $\gamma_0(g_0) = g_1$
  and
  $\gamma_1(g_1) = g_0$.
\end{definition}
Informally, two graphs $g_0$ and $g_1$ are equivalent if they are
essentially the same graph \textit{modulo trivial subgraphs}, i.e., $g_0$
may contain subgraphs consisting of a single node labeled $\tops$ that are
not in $g_1$, and vice versa.

\begin{example}[\osf graph equivalence]
  \label{ex:graph_equivalence}
  Consider the $\osf$ terms
  \begin{align*}
    \psi_0 = \Xj[0]:\s(\f\to\Yj[0]:\su)~\text{and}~
    \psi_1 = \Xj[1]:\s(\f\to\Yj[1]:\su, \f[f']\to\Zj[1]:\tops)
  \end{align*}
  and let
  $g_0 = G(\psi_0)$ and
  $g_1 = G(\psi_1)$.
  Let $\gamma_0: \gg[g_0]\to\gg[g_1]$ be defined by letting, for all
  $g\in\gg[g_0] = w^\gg(g_0)$ for some $w\in\F^*$, $\gamma_0(g) =
  w^\gg(g_1)$. Similarly,
  let $\gamma_1: \gg[g_1]\to\gg[g_0]$ be defined by letting, for all
  $g\in\gg[g_1] = w^\gg(g_1)$ for some $w\in\F^*$, $\gamma_1(g) =
  w^\gg(g_0)$. In particular $\gamma_0(g_0) = g_1$ and $\gamma_1(g_1) =
  g_0$. These are easily verified to be $1$-morphisms, and thus $g_0\gequiv
  g_1$. This is depicted in \cref{fig:graph_equivalence}.
\end{example}

\input{figures/one_morph}

We can thus prove that
$\fapproximates$
is a fuzzy partial ordering on \osf graphs modulo \osf graph equivalence.
\begin{restatable}%
  [{\protect\hyperlink{proof:proppartial}{Endomorphic graph approximation fuzzy partial order}}]%
  {theorem}{proppartial}
  \label{prop:partial}
  The fuzzy binary relation
  $\fapproximates[\gg]$ is a fuzzy partial order on (equivalence classes
  of) \osf graphs, i.e., if
  $\fapproximates[\gg](g_0 , g_1) >0$ and
  $\fapproximates[\gg](g_1 , g_0)>0$, then $g_0\gequiv g_1$.
\end{restatable}

The equivalence relation on \osf graphs induces analogous
equivalence relations on normal \osf terms and rooted solved \osf
constraints by letting
$\psi_0\gequiv\psi_1 \Iff G(\psi_0)\gequiv G(\psi_1)$, and
$\phi_0\gequiv\phi_1 \Iff G(\phi_0)\gequiv G(\phi_1)$.
As expected, in every fuzzy \osf interpretation
equivalent normal \osf terms have the same denotation, and
  equivalent rooted solved \osf clauses are satisfied with the same
degree.
\myrestatable%
  {Denotation of equivalent \osf terms} %
  {prop} %
  {prop:equivalence} %
  {proof:equivalence} %
  {propequivalence} %
  {%
  If the normal \osf terms $\psi_0$ and $\psi_1$ are
  equivalent,
  then
  $\denot[\psi_0] = \denot[\psi_1]$
  for every fuzzy interpretation $\ii$.%
  }

\myrestatable%
  {Satisfaction of equivalent \osf clauses} %
  {prop} %
  {prop:equivalence_clause} %
  {proof:equivalence_clause} %
  {propequivalenceclause} %
  {%
  If the rooted solved \osf clauses $\phi_0$ and $\phi_1$ are
  equivalent,
  then
  for every fuzzy interpretation $\ii$
  and every $\beta\in[0,1]$:
  $\ii,\alpha_0\models_\beta\phi_0$ for some assignment $\alpha_0$ if and only if
  $\ii,\alpha_1\models_\beta\phi_1$ for some assignment $\alpha_1$.%
  }

We now give a semantic definition of fuzzy \osf term subsumption.
Recall that the fuzzy sort subsumption
$\fisop(\slasher, \thriller) = \beta$ means that, on any interpretation
$\ii$,
every object that is an instance of $\slasher^\ii$ with degree $\beta'$
must also be an instance of $\thriller^\ii$ with degree greater than or
equal to $\beta\land\beta'$.
Along these lines, we may say that an \osf term $t_1$ is subsumed by a term
$t_2$ with degree $\beta$ if, on any interpretation $\ii$, every object in
the denotation of $t_1$ with degree $\beta'$ also belongs to the
denotation of $t_2$ with degree
greater than or equal to
$\beta'\land\beta$. We thus define
fuzzy $\osf$ term subsumption as the fuzzy relation that assigns to each
pair of $\osf$ terms the supremum of all degrees $\beta\in[0,1]$ that
satisfy this property.

\begin{definition}[Semantic \osf term subsumption]
\label{def:sem_osf_term_subsumption}
  The sort subsumption relation $\fisop:\S^2\to[0,1]$ is extended to a
  fuzzy binary relation on \osf terms by letting,
  for all \osf terms $t_1$ and $t_2$:
    $\fisop(t_1, t_2) = \sup(\{ \beta \mid \forall \ii, \forall
    d\in\dom[\ii]: \denot[t_1](d)\land\beta\leq\denot[t_2](d) \})$.
  We abbreviate $\fisop(\psi_1, \psi_2) = \beta$ by writing
  $\psi_1\fisa_\beta\psi_2$.
\end{definition}
We provide an analogous definition for the graded implication of $\osf$
clauses, which generalizes the crisp one from \cite{AitKaci1993b}.
\begin{definition}[\osf clause implication]
\label{def:osf_clause_implication}
  The \textit{\osf clause $\phi_1$ implies the \osf clause $\phi_2$ at
  degree $\beta$} if,
  for all fuzzy \osf interpretations $\ii$ and assignments $\alpha$ such that
  $\ii,\alpha\models_{\beta_\ii} \phi$, there exists an assignment
  $\alpha'$ such that:
  (i) $\forall \X\in\tags(\phi_1)\cap\tags(\phi_2)$: $\alpha'(\X) =
      \alpha(\X)$, and
  (ii) $\ii, \alpha'\models_{\beta_\ii\land\beta} \phi_2$.
  The fuzzy binary relation $\models$ on \osf clauses is defined by letting
    $\mathop{\models}(\phi_1, \phi_2) = \sup(\{\beta \mid
    \phi_1~\text{implies}~\phi_2~\text{at degree}~\beta\})$.
  We abbreviate $\mathop{\models}(\phi_1, \phi_2) = \beta$ by writing
  $\phi_1\models_\beta\phi_2$.
\end{definition}

\begin{definition}[Rooted \osf clause implication]
\label{def:rooted_osf_clause_implication}
  Let $\phi_{\X}$ and $\phi'_{\Y}$ be two rooted \osf clauses with no common
  variables. Then:
  $\phi_{\X}\models_\beta \phi'_{\Y}$ if and only if
  $\phi\models_\beta \phi'[{\X}/{\Y}]$.
\end{definition}

We now prove that the fuzzy relations $\fapproximates$ on \osf graphs,
$\fisop$ on normal \osf term and $\models$ on rooted solved \osf
constraints are equivalent.
\begin{restatable}%
  [{\protect\hyperlink{proof:transparencybis}
  {Equivalence of fuzzy \osf orderings}}]%
  {theorem}{thmtransparencybis}
\label{thm:transparencybis}
  If
  the normal \osf terms $\psi$ and $\psi'$
  (with roots $\Y$ and $\X$, respectively, and no common variables),
  the \osf graphs $g$ and $g'$, and
  the rooted solved \osf clauses $\phi_{\Y}$ and $\phi'_{\X}$
  respectively correspond to one another though the syntactic mappings,
  then the following are equivalent:
  (1) $g \fapprel g'$,
  (2) $\psi'\fisa_\beta \psi$, and
  (3) $\phi'_{\X}\models_\beta \phi_{\Y}$.
\end{restatable}

The fact that $\fisop$ and $\models$ are fuzzy partial orders on normal
\osf terms and rooted solved \osf clauses (modulo \osf term and \osf clause
equivalence), respectively, is obtained as a corollary of
\cref{prop:partial,thm:transparencybis}.
\begin{corollary}
  The fuzzy relation $\fisa$ is a fuzzy partial order on normal \osf terms
  modulo \osf term equivalence. The fuzzy relation $\models$ is a fuzzy
  partial order on rooted solved \osf clauses modulo \osf clause
  equivalence.
\end{corollary}

Next, we provide a \textit{syntactic} definition of \osf term subsumption
and prove that it is equivalent to the semantic one of
\cref{def:sem_osf_term_subsumption}.
The syntactic definition
-- which was originally presented in \cite{Milanese2022} --
will be useful in \cref{sec:unification} for
  the computation of the subsumption degree between two \osf terms.

\begin{definition}[Syntactic \osf term subsumption]
\label{def:syn_osf_term_subsumption}
  \textit{The normal \osf term $\psi_0$ is (syntactically) subsumed by
    the normal \osf term $\psi_1$ with degree $\beta$} (denoted
    $\psi_0\fsynisa_\beta \psi_1$) if
    there is a mapping
    $h: \tags(\psi_1) \to \tags(\psi_0)$
    such that
  \begin{enumerate}
    \item $h(\rtag(\psi_1)) = \rtag(\psi_0)$\label{osfsubitm:1};
    \item if $\X\fto_{\psi_1}\Y$, then
      $h(\X)\fto_{\psi_0}h(\Y)$\label{osfsubitm:3}; and
    \item  $\beta = \min\{ \fisop(\sort_{\psi_0}(h(\X)),
      \sort_{\psi_1}(\X)) \mid \X\in\tags(\psi_1)\}$\label{osfsubitm:2}.
  \end{enumerate}
  We write $\fsynisop(\psi_0, \psi_1)\geq\beta$
  to express that
  $\psi_0\fsynisa_{\beta'} \psi_1$ and $\beta'\geq\beta$.
\end{definition}

\begin{remark}
  Syntactic \osf term subsumption is well-defined. Indeed, if
  $h: \tags(\psi_1) \to \tags(\psi_0)$ and
  $h': \tags(\psi_1) \to \tags(\psi_0)$
  are two mappings that satisfy
  \begin{enumerate}
    \item $h(\rtag(\psi_1)) = \rtag(\psi_0) = h'(\rtag(\psi_1))$, and
    \item if $\X\fto_{\psi_1}\Y$, then $h(\X)\fto_{\psi_0}h(\Y)$ and
      $h'(\X)\fto_{\psi_0}h'(\Y)$,
  \end{enumerate}
  then necessarily $h = h'$, which means that the value $\beta$ in
  \cref{def:syn_osf_term_subsumption} is unique.
\end{remark}

\begin{restatable}%
  [{\protect\hyperlink{proof:synsem}{Semantic and syntactic subsumption}}]%
  {theorem}{propsynsem}
  \label{prop:synsem}
  Let $\psi_0$ and $\psi_1$ be two
  normal $\osf$ terms. Then, for all $\beta\in(0,1]$:
  $\psi_0\fisa_\beta\psi_1$ if and only if there are two (normal) \osf terms
  $\psi_0'$ and $\psi_1'$ such that
    $\psi_0 \gequiv \psi_0'$,
    $\psi_1 \gequiv \psi_1'$, and
    $\psi_0'\fsynisa_\beta \psi_1'$.
\end{restatable}

Let $\isop \defeq \supp[\fisop]$ and recall that $\isa$ is a (crisp)
subsumption relation on $\S$ such that GLBs in $(\S, \isa)$ correspond to
GLBs in $(\S, \fisa)$ (see \cref{prop:glbs}).
The next theorem provides the connection between the crisp subsumption
$\isa$ and the fuzzy subsumption $\fisa$ on \osf terms.
\begin{restatable}%
  [{\protect\hyperlink{proof:crispfuzzy}{Crisp and fuzzy subsumption}}]%
  {theorem}{thmcrispfuzzy}
\label{thm:crispfuzzy}
For all normal \osf terms $\psi_1$ and $\psi_2$:
$\psi_1\isa\psi_2$ if and only if $\fisop(\psi_1, \psi_2)>0$.
\end{restatable}

The next corollary follows from \cref{thm:crispfuzzy} and the
analogous result for crisp \osf logic.
\begin{corollary}[Fuzzy \osf term lattice]
  The fuzzy binary relation $\fisop$ is a fuzzy lattice on (equivalence
  classes) of normal \osf terms.
\end{corollary}
