% \documentclass[]{article}
\documentclass[secnumarabic,amssymb, nobibnotes, aps, prd]{revtex4-2}

\RequirePackage[english]{babel}
\RequirePackage[utf8]{inputenc}
\RequirePackage{hyperref}
\hypersetup{colorlinks=true, citecolor=blue, urlcolor=blue, linkcolor=blue}

\RequirePackage[]{amsmath,amssymb}
\RequirePackage{bbm}
\RequirePackage[]{bm}
\RequirePackage{listings}

\RequirePackage[]{graphicx}

\RequirePackage{physics}
\RequirePackage{siunitx}
\sisetup{%
	exponent-product = \times,
	output-decimal-marker = {.},
	range-units = single,
	list-units = single,
	group-minimum-digits = 4,
	group-digits = integer,
	group-separator = {\,},
	per-mode = symbol,
	separate-uncertainty = true,
	detect-all = true}
% \DeclareSIUnit\Erec{\ensuremath{\textit{E}_\text{rec}}}

\RequirePackage{cleveref}

\usepackage[dvipsnames]{xcolor}
\newcommand{\red}[1]{\textcolor{red}{\textbf{#1}}}
\newcommand{\green}[1]{\textcolor{ForestGreen}{\textbf{#1}}}
\renewcommand{\thefigure}{S\arabic{figure}}

\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    basicstyle=\ttfamily\footnotesize,
}
\lstset{style=mystyle}
\usepackage{newverbs}
\newverbcommand{\cverb}
	{\begin{lrbox}{\verbbox}\color{magenta}}
	{\end{lrbox}\colorbox{backcolour}{\box\verbbox}}

\begin{document}

\title{Supplemental material for \\ \textit{Sub-shot-noise interferometry with two mode quantum states}}
%\date{\today}

\author{Quentin Marolleau}
% \email[contact: ]{\texttt{name}.\texttt{surname}@institutoptique.fr}
\author{Charlie Leprince}
\author{Victor Gondret}%
\author{Denis Boiron}%
\author{Christoph I. Westbrook}
\affiliation{Université Paris-Saclay, Institut d’Optique Graduate School, CNRS, Laboratoire Charles Fabry, 91127, Palaiseau, France}
\date{\today}%

\maketitle

\tableofcontents
\pagebreak

\section*{Foreword on the Python package: \texttt{qsipy}}

We provide a Python package that implements all the formulae that we present in the main article and this
supplemental material. The source code is distributed under the \href{https://opensource.org/license/mit/}{MIT licence}
and can be accessed on \href{https://github.com/quentinmarolleau/qsipy}{GitHub}: \url{https://github.com/quentinmarolleau/qsipy}.

The package itself is also built and published in the official Python Package Index (PyPI), under the name
\href{https://pypi.org/project/qsipy/}{\texttt{qsipy}}. The interested reader may install it on its own Python environment
by simply using the \texttt{pip} package manager:
\begin{lstlisting}[language=bash]
	pip install qsipy
\end{lstlisting}
Figures of the article are generated using the version \cverb|v1.0.0| of \texttt{qsipy}, the source code generating those
is also \href{https://github.com/quentinmarolleau/qsipy/tree/main/images}{available online}.

\section{Parametrization of the problem}

\subsection{Operator definitions}

% Figure environment removed

Following the notation of \cref{fig:schematic_MZI}, we denote $N$ the average value of the total number of atoms in the
interferometer:
\begin{equation}
	N \triangleq \ev{\hat{N}_{a_1} + \hat{N}_{a_2}} = \ev{\hat{N}_{b_1} + \hat{N}_{b_2}}
\end{equation}

We have
\begin{equation}
	\hat{S} = \frac{1}{\sqrt{2}} \begin{pmatrix}
		1  & 1 \\
		-1 & 1
	\end{pmatrix}
\end{equation}
corresponding to the special case of the beam splitter that does not apply any phase shift. Without loss of generality
we chose the beam splitters to be real matrix because the observable that we consider are only sensitive to the actual
phase difference between the two arms of the interferometer.
\begin{equation}
	\hat{\Phi} = \begin{pmatrix}
		e^{i \phi} & 0 \\
		0          & 1
	\end{pmatrix}
\end{equation}
\begin{equation}
	\hat{U} = \hat{S} \hat{\Phi} \hat{S} = e^{i \frac{\phi}{2}} \begin{pmatrix}
		i \sin(\frac{\phi}{2}) & \cos(\frac{\phi}{2})    \\
		-\cos(\frac{\phi}{2})  & -i \sin(\frac{\phi}{2})
	\end{pmatrix}
\end{equation}

\begin{equation}
	\binom{\hat{b}_1}{\hat{b}_2} = \hat{U} \binom{\hat{a}_1}{\hat{a}_2}
\end{equation}

We also have the beam splitters modelling the losses:
\begin{equation}
	\hat{S}_\eta =
	\begin{pmatrix}
		\sqrt{\eta}     & \sqrt{1-\eta} \\
		- \sqrt{1-\eta} & \sqrt{\eta}
	\end{pmatrix}
\end{equation}
such that
\begin{equation}
	\hat{c}_i = \sqrt{\eta} \, \hat{b}_i + \sqrt{1-\eta} \, \hat{v}_i \quad / \quad i \in \{ 1,2 \}
\end{equation}

We finally introduce notations for the number operators:
\begin{equation}
	\hat{N}_{\alpha_i} = \hat{\alpha}^\dagger_i \hat{\alpha}_i \quad / \quad  \alpha \in \{a,b,c \} \ , \ i \in\{ 1,2 \}
\end{equation}
input spin operators:
\begin{equation}
	\begin{cases}
		\hat{J}_x =\frac 12 \left( \hat{a}^\dagger_1 \hat{a}_2  + \hat{a}_2^\dagger \hat{a}_1\right)    \\
		\hat{J}_y =\frac 1{2i} \left( \hat{a}^\dagger_1 \hat{a}_2  - \hat{a}_2^\dagger \hat{a}_1\right) \\
		\hat{J}_z =\frac 12 \left( \hat{N}_{a_1} - \hat{N}_{a_2} \right)
	\end{cases}
\end{equation}
and the observables of interest:
\begin{equation}
	\left\{
	\begin{aligned}
		\hat{D}_\eta & = \frac{1}{2} \left( \hat{N}_{c_2} - \hat{N}_{c_1} \right)                      \\
		\hat{D}      & = \frac{1}{2} \left( \hat{N}_{b_2} - \hat{N}_{b_1} \right) = \hat{D}_{\eta = 1}
	\end{aligned}
	\right.
\end{equation}

\subsection{Two-mode squeezed vacuum state and preliminary results}

We remind the definition of a two-mode squeezed vacuum (TMS) state, with average total population $N$:
\begin{equation}
	\ket{\textrm{TMS}} \triangleq \sqrt{ \frac{2}{2+N}} \sum\limits_{n=0}^{\infty} \left( \frac{N}{2+N} \right)^{\frac n2} \ket{n,n}
\end{equation}
in order to keep compact notations during the calculations, we will often use the \emph{thermal weight}:
\begin{equation}
	P_{th}(n) = \frac{2}{2+N}\left( \frac{N}{2+N} \right)^n
\end{equation}
corresponding to the probability to measure $n$ particles in a given mode of the TMS state.

\paragraph*{} We also highlight the fact that
\begin{equation}
	\hat{J}_z \ket{n,n} = \hat{J}_z \ket{\mathrm{TMS}} = 0
	\label{eq:jz_gives_zero}
\end{equation}

and finally:
\begin{equation}
	\ev{\hat{J}_x} = \ev{\hat{J}_y} = 0
	\label{eq:ev_jx_jy_is_zero}
\end{equation}
for both twin Fock and two-mode squeezed vacuum states.

\section{Expansion of $\hat{D}$, $\hat{D}^2$, $\hat{D}_\eta$ and $\hat{D}^2_\eta$}

\begin{equation}
	\hat{D} = \cos (\phi) \hat{J}_z - \sin (\phi) \hat{J}_y
\end{equation}

\begin{equation}
	\hat{D}^2 = \cos^2 (\phi) \hat{J}_z^2 + \sin^2 (\phi) \hat{J}_y^2 - 2 \sin (\phi) \cos (\phi) \hat{J}_y \hat{J}_z
	+ i \sin (\phi) \cos (\phi) \hat{J}_x
	\label{eq:expansion_of_D2}
\end{equation}

Since there is no particle in the vacuum channels for the input state, we always have $\hat{v}_i \ket{\psi}_{\textrm{input}} = 0$.
For a sake of simplicity, we reduce the writing of $\hat{D}_\eta$ and $\hat{D}^2_\eta$ to the terms giving  a non zero
contribution. This means that (for either $\hat{D}_\eta$ and $\hat{D}_\eta^2$) we drop all the terms containing $\hat{v}_{i \in \{ 1,2 \}}$ annihilation operators on their
rightmost side:
\begin{equation}
	\hat{D}_\eta = \eta \hat{D} + \frac 12 \sqrt{\eta (1-\eta)} \left( \hat{v}^\dagger_2 \, \hat{b}_2 - \hat{v}^\dagger_1 \, \hat{b}_1 \right)
\end{equation}

\begin{equation}
	\begin{split}
		\hat{D}_\eta^2 = \eta^2 \hat{D}^2 + \frac {\eta(1-\eta)}{4} \left[ (\hat{v}^\dagger_1)^2 \, \hat{b}_1^2
			+ (\hat{v}^\dagger_2)^2 \, \hat{b}_2^2 + \hat{N}_{b_1}+\hat{N}_{b_2} - 2 \, \hat{b}_1 \hat{b}_2 \, \hat{v}^\dagger_1 \hat{v}^\dagger_2 \right] \\
		+ \frac{\eta \sqrt{\eta (1-\eta)}}{2} \left[ 2 \hat{D} \, \hat{b}_2 \hat{v}_2^\dagger + \frac 12 \hat{b}_2 \hat{v}_2^\dagger
			- 2 \hat{D} \, \hat{b}_1 \hat{v}_1^\dagger + \frac 12 \hat{b}_1 \hat{v}_1^\dagger \right] \\
		+ \frac{(1-\eta) \sqrt{\eta (1-\eta)}}{4} \left[ \left( 2 \hat{N}_{v_2} - \mathbbm{1} \right) \hat{b}_2 \hat{v}^\dagger_2
			+ \left( 2 \hat{N}_{v_1} - \mathbbm{1} \right) \hat{b}_1 \hat{v}^\dagger_1 \right]
	\end{split}
	\label{eq:D_eta_2}
\end{equation}

\section{Expectation values of $\hat{D}^2$ and $\hat{D}^2_\eta$}

\subsection{Lossless case}

\subsubsection*{With twin Fock states}

\begin{equation}
	\hat{J}_y^2 = \frac 14 \left[ \hat{N}_{a_1} \left( \mathbbm{1} + \hat{N}_{a_2} \right)
		+ \hat{N}_{a_2} \left( \mathbbm{1} + \hat{N}_{a_1} \right) - ( \hat{a}^\dagger_1 )^2 \, \hat{a}_2^2
		- ( \hat{a}^\dagger_2 )^2 \, \hat{a}_1^2 \right]
\end{equation}
thus with \eqref{eq:jz_gives_zero} \eqref{eq:ev_jx_jy_is_zero} and \eqref{eq:expansion_of_D2},
\begin{equation}
	\ev{\hat{D}^2}_{\mathrm{tf}} = \ev{\hat{J}_y^2}_{\mathrm{tf}} \sin^2 (\phi) = \frac{N}{4} \left( 1 + \frac{N}{2} \right) \sin^2 (\phi)
	\label{eq:d2_perfect_tf}
\end{equation}

\subsubsection*{With two-mode squeezed vacuum states}

We can check that
\begin{equation}
	m \neq n \Rightarrow \mel**{n,n}{\hat{D}^2}{m,m} = 0
\end{equation}
therefore assuring the simple relation:
\begin{equation}
	\ev{\hat{D}^2}_{\mathrm{tms}} = \sum\limits_{n=0}^\infty P_{th}(n) \ev{\hat{D}^2}_{\mathrm{tf}}
\end{equation}
leading to
\begin{equation}
	\ev{\hat{D}^2}_{\mathrm{tms}} = \frac N2 \left( 1 + \frac N2 \right) \sin^2 (\phi) = 2 \ev{\hat{D}^2}_{\mathrm{tf}}
	\label{eq:d2_perfect_tms}
\end{equation}

\subsection{Lossy case (i.e. eq. (8) in the main paper)}

\subsubsection*{With twin Fock states}

\vspace*{1ex}
Using \cref{eq:D_eta_2}, and writing the non-vanishing terms only, we have:
\begin{equation}
	\ev{\hat{D}_\eta^2}_{\mathrm{tf}} = \eta^2 \ev{\hat{D}^2}_{\mathrm{tf}} + \frac{\eta (1- \eta)}{4} N
	\label{eq:d2_eta_tf}
\end{equation}
therefore
\begin{equation}
	\ev{\hat{D}_\eta^2}_{\mathrm{tf}} = \eta^2 \frac N4 \left( 1 + \frac N2 \right) \sin^2 (\phi) + \frac{\eta (1- \eta)}{4} N
\end{equation}

\subsubsection*{With two-mode squeezed vacuum states}

Again we can check on \cref{eq:D_eta_2} that
\begin{equation}
	m \neq n \Rightarrow \mel**{n,n}{\hat{D}_\eta^2}{m,m} = 0
\end{equation}
thus we still have
\begin{equation}
	\ev{\hat{D}_\eta^2}_{\mathrm{tms}} = \sum\limits_{n=0}^\infty P_{th}(n) \ev{\hat{D}_\eta^2}_{\mathrm{tf}}
\end{equation}
and finally:
\begin{equation}
	\ev{\hat{D}_\eta^2}_{\mathrm{tms}} = \eta^2 \frac N2 \left( 1 + \frac N2 \right) \sin^2 (\phi) + \frac{\eta (1- \eta)}{4} N
	\label{eq:d2_eta_tms}
\end{equation}

\section{Expectation values of $\hat{D}^4$ and $\hat{D}^4_\eta$}

\subsection{Lossless case}

\subsubsection*{With twin Fock states}

We compute  $\ev{\hat{D}^4}_{\mathrm{tf}} = \norm{\hat{D}^2 \ket{\frac N2, \frac N2}}^2$. The only
non-vanishing term of $\hat{D}^2 \ket{n,n}$ are:
\begin{equation}
	\begin{cases}
		\displaystyle \hat{J}_y^2 \ket{n,n} & \displaystyle = \frac 14 \left( 2n \left( 1 + n\right) \ket{n,n}
		- \sqrt{\left( n - 1 \right) n \left( n + 1 \right) \left( n + 2 \right)} \big[ \ket{n+2,n-2} + \ket{n-2,n+2} \big]\right) \\
		\\
		\displaystyle \hat{J}_x \ket{n,n}   & = \displaystyle \frac 12 \sqrt{n(n+1)} \big( \ket{n+1,n-1} + \ket{n-1,n+1} \big)
	\end{cases}
	\label{eq:Jy2_Jx_system}
\end{equation}
all these vectors are mutually orthogonal, then:
\begin{equation}
	\norm{\hat{D}^2 \ket{\frac N2, \frac N2}}^2 = \frac{N}{4} \left( 1 + \frac N2 \right) \sin^2 (\phi) \left[ 1+ \frac{3}{2}
		\left( -1 + \frac N4 + \frac{N^2}{8} \right) \sin^2 (\phi) \right]
	\label{eq:d4_perfect_tf}
\end{equation}

\subsubsection*{With two-mode squeezed vacuum states}

Looking at \cref{eq:Jy2_Jx_system}, we can convince ourselves that the decomposition in the two-mode Fock basis of
$\hat{J}_y^2 \ket{n,n}$ and $\hat{J}_x \ket{n,n}$ with $n \in \mathbb{N}$ generate vectors that are all mutually orthogonal.

Therefore
\begin{equation}
	\norm{\hat{D}^2 \ket{\mathrm{TMS}}}^2 = \sum\limits_{n=0}^\infty P_{th}(n) \norm{\hat{D}^2 \ket{n, n}}^2
\end{equation}
and thus,
\begin{equation}
	\norm{\hat{D}^2 \ket{\mathrm{TMS}}}^2 = \frac{N}{2} \left( 1 + \frac N2 \right) \sin^2 (\phi) \left[ 1+ \frac{9N}{2}
		\left( 1 + \frac N2 \right) \sin^2 (\phi) \right]
	\label{eq:d4_perfect_tms}
\end{equation}

\subsection{Lossy case}

We follow the same procedure as before, but here the number of non-vanishing terms is much larger. We will only write
the final results.

\subsubsection*{With twin Fock states}

With
\begin{equation}
	\begin{cases}
		P^{\mathrm{tf}}_0(N,\eta) & = 64 - 320 \, \eta + 256 \, \eta N + 384 \, \eta^2 - 384 \, \eta^2 N + 96 \, \eta^2 N^2 - 144 \, \eta^3 + 156 \, \eta^3 N - 60 \, \eta^3 N^2 + 9 \, \eta^3 N^3 \\
		P^{\mathrm{tf}}_1(N,\eta) & = - 4 \, (N+2) \, \eta \left( 16 + 24 \, (N-2) \, \eta + 3 \left( 8 - 6N + N^2 \right) \eta^2 \right)                                                          \\
		P^{\mathrm{tf}}_2(N,\eta) & = 3 \left( -16 - 4N + 4N^2 + N^3 \right) \eta^3
	\end{cases}
\end{equation}
we have:
\begin{equation}
	\norm{\hat{D}_\eta^2 \ket{\frac N2, \frac N2}}^2 = \frac{\eta N}{1024}
	\Big[ P^{\mathrm{tf}}_0(N,\eta) + P^{\mathrm{tf}}_1(N,\eta) \cos (2\phi) + P^{\mathrm{tf}}_2(N,\eta) \cos(4\phi) \Big]
	\label{eq:d4_eta_tf}
\end{equation}

\subsubsection*{With two-mode squeezed vacuum states}

With
\begin{equation}
	\begin{cases}
		P^{\mathrm{tms}}_0(N,\eta) & = 8 + 24 \, \eta + 64 \, \eta N + 48 \, \eta^2 N + 72 \, \eta^2 N^2 + 12 \, \eta^3 N + 36 \, \eta^3 N^2 + 27 \, \eta^3 N^3 \\
		P^{\mathrm{tms}}_1(N,\eta) & = - 4 \, (N+2) \, \eta \left( 4 + 18 \, \eta N + 9 \, \eta^2 N^2 \right)                                                   \\
		P^{\mathrm{tms}}_2(N,\eta) & = 9N \left( N+2 \right)^2 \eta^3
	\end{cases}
\end{equation}
we have:
\begin{equation}
	\norm{\hat{D}_\eta^2 \ket{\mathrm{TMS}}^2} = \frac{\eta N}{128}
	\Big[ P^{\mathrm{tms}}_0(N,\eta) + P^{\mathrm{tms}}_1(N,\eta) \cos (2\phi) + P^{\mathrm{tms}}_2(N,\eta) \cos(4\phi) \Big]
	\label{eq:d4_eta_tms}
\end{equation}

\section{Phase uncertainty $\Delta \phi$}

Phase uncertainties are computing using
\begin{equation}
	\Delta \phi =\frac{\sqrt{\mathrm{Var}\left[\hat{D}_\eta^2\right]}}{\left|\dfrac{\partial}{\partial \phi}\left[ \ev{\hat{D}_\eta^2} \right] \right|}.
	\label{eq:def_delta_phi}
\end{equation}

\subsection{Lossless case (i.e. eq. (10) in the main paper)}

\subsubsection*{With twin Fock states}

Injecting \eqref{eq:d2_perfect_tf} and \eqref{eq:d4_perfect_tf} into \cref{eq:def_delta_phi}, we get:
\begin{equation}
	\Delta \phi_{\mathrm{tf}} = \dfrac{1}{\cos (\phi ) \sqrt{N (N+2)}} \sqrt{2 + \left(-3 + \frac N4 + \frac{N^2}{8}\right) \sin ^2(\phi )}
\end{equation}

\subsubsection*{With two-mode squeezed vacuum states}

Injecting \eqref{eq:d2_perfect_tms} and \eqref{eq:d4_perfect_tms} into \cref{eq:def_delta_phi}, we get:
\begin{equation}
	\Delta \phi_{\mathrm{tms}} = \dfrac{1}{\cos (\phi ) \sqrt{N (N+2)}} \sqrt{1 + 2 N (N+2) \sin ^2(\phi )}
\end{equation}

\subsection{Lossy case}

\subsubsection*{With twin Fock states}

% \begin{equation}
% 	\begin{array}{l}
% 		\theta = \scriptsize \arcsec \left[ \sqrt{\frac{\sqrt{(\eta -1) (2 (\eta -1) \eta  (n-3)-1) \left(\eta  \left(\frac{\eta ^2 n}{8} \left(n^2-12 n+12\right)+2 \eta  (n-3) n+4 n-3\right)+1\right)}+\eta  \left(-6 (\eta -2) \eta +2n (\eta -1)^2 -7\right)+1}{(\eta -1) (2 (\eta -1) \eta  (n-3)-1)}} \right]
% 	\end{array}
% \end{equation}

% \begin{equation}
% 	\begin{split}
% 		\Delta \phi =& \frac{\csc (2 \theta)}{\sqrt{2} \eta ^2 n (n+2)}                                                                                                                                               \\
% 		&\Bigg[\eta \, n \bigg(\frac{\eta}{2}  (n+2) \textcolor{blue}{\bigg(}\frac{\eta ^2}{4} \left(n^2+2 n-24\right) \cos (4 \theta)+4 \textcolor{red}{\Big(} 6 (\eta -2) \eta +\frac{\eta \, n}{4} (\eta  (n-14)+16)+4 \textcolor{red}{\Big)} \cos (2 \theta) \textcolor{blue}{\bigg)} \\
% 			&+\frac{\eta ^3}{8} \left(3 n^3-52 n^2+132 n-144\right)+8 \eta ^2 (n-3) (n-2)+8 \eta \, (3 n-5)+8\bigg) \Bigg]^{1/2}
% 	\end{split}
% \end{equation}
Injecting \eqref{eq:d2_eta_tf} and \eqref{eq:d4_eta_tf} into \cref{eq:def_delta_phi}, we get:

\begin{equation}
	\begin{cases}
		Q^{\mathrm{tf}}_0(N,\eta) & = -144 \eta ^3+384 \eta ^2-320 \eta +3 \eta ^3 N^3-52 \eta ^3 N^2+64 \eta ^2 N^2+132 \eta ^3 N-320 \eta ^2 N+192 \eta  N+64 \\
		Q^{\mathrm{tf}}_1(N,\eta) & = -4 \eta \, (N+2) \left(\eta ^2 \left(N^2-14 N+24\right)+16 \eta \, (N-3)+16\right)                                        \\
		Q^{\mathrm{tf}}_2(N,\eta) & = \eta ^3 \left(N^3+4 N^2-20 N-48\right)
	\end{cases}
\end{equation}
\begin{equation}
	\Delta \phi_{\mathrm{tf}} = \frac{1}{4N(N+2) \, \eta^2 \, \left|\sin(2 \phi)\right|} \sqrt{\eta \, N \left[Q^{\mathrm{tf}}_0(N,\eta) + Q^{\mathrm{tf}}_1(N,\eta) \cos(2\phi) + Q^{\mathrm{tf}}_2(N,\eta) \cos(4\phi)\right]}
	\label{eq:delta_phi_tf}
\end{equation}

\subsubsection*{With two-mode squeezed vacuum states}

Injecting \eqref{eq:d2_eta_tms} and \eqref{eq:d4_eta_tms} into \cref{eq:def_delta_phi}, we get:
\begin{equation}
	\begin{cases}
		Q^{\mathrm{tms}}_0(N,\eta) & = 3 \eta +3 \eta ^3 N^3+4 \eta ^3 N^2+8 \eta ^2 N^2+\eta ^3 N+6 \eta ^2 N+7 \eta  N+1 \\
		Q^{\mathrm{tms}}_1(N,\eta) & = -2 \eta \, (N+2) \left(2 \eta ^2 N^2+4 \eta  N+1\right)                             \\
		Q^{\mathrm{tms}}_2(N,\eta) & = \eta ^3 N (N+2)^2
	\end{cases}
\end{equation}
\begin{equation}
	\Delta \phi_{\mathrm{tms}} = \frac{1}{N(N+2) \, \eta^2 \, \left|\sin(2 \phi)\right|} \sqrt{\eta \, N \left[Q^{\mathrm{tms}}_0(N,\eta) + Q^{\mathrm{tms}}_1(N,\eta) \cos(2\phi) + Q^{\mathrm{tms}}_2(N,\eta) \cos(4\phi)\right]}
	\label{eq:delta_phi_tms}
\end{equation}

\section{Optimal phase $\phi_0$}

When considering non-unit quantum efficiency, the phase uncertainty exhibits a minimum in $\phi_0 > 0$. In that case,
the study of the derivative of $\Delta \phi$ as a function of $\phi$ gives the analytic expression of $\phi_0$.

\subsubsection*{With twin Fock states}

with $n = \frac N2$:
\begin{equation*}
	\begin{split}
		A = (1-\eta) \Big(4 \eta ^2 \left(10 n^2-19 n+6\right)-2 \eta ^5 n \left(2 n^3-15 n^2+24 n-9\right)-2 \eta ^4 n \left(-2 n^3+31 n^2-72 n+45\right) \\
		-\eta ^3 \left(-33 n^3+134 n^2-135 n+18\right)-\eta  (9-12 n)+1\Big)
	\end{split}
\end{equation*}
we have
\begin{equation}
	\phi_0 = \arccsc \left(\sqrt{\frac{\sqrt{A}+\eta ^3 (4 n-6)+\eta ^2 (12-8 n)+\eta  (4 n-7)+1}{(1-\eta) \left(1+\eta(4n-6)(1-\eta)\right)}}\right)
	\label{eq:phi0_tf}
\end{equation}

\subsubsection*{With two-mode squeezed vacuum states}

with $\nu = \frac N2$:
\begin{equation*}
	\begin{split}
		B = (1-\eta) \Big(-20 \eta ^5 \nu ^2 \left(32 \nu ^2+32 \nu +5\right)-\eta ^4 \left(340 \nu ^2-640 \nu ^4\right)+4 \eta ^3 \nu  \left(176 \nu ^2+81 \nu -15\right)\\
		+4 \eta ^2 \nu  (61 \nu +26)+7 \eta  (4 \nu +1)+1\Big)
	\end{split}
\end{equation*}
we have
\begin{equation}
	\phi_0 = \arccsc \left(\sqrt{\frac{\sqrt{B}+10 \eta ^3 \nu -20 \eta ^2 \nu +\eta  (10 \nu -1)+1}{(1-\eta) \left(-10 \eta ^2 \nu +10 \eta  \nu +1\right)}}\right)
	\label{eq:phi0_tms}
\end{equation}

\subsubsection*{Brief comment about the phase uncertainty $\Delta \phi_0$}

\paragraph*{}
By definition of $\phi_0$, the minimal phase uncertainty $\Delta \phi_0$ is given by $\Delta \phi \Big|_{\phi = \phi_0}$.
We will not give its full expression here, because it is rather long. It is simply obtained by injecting \eqref{eq:phi0_tf}
and \eqref{eq:phi0_tms} into \cref{eq:delta_phi_tf} and \cref{eq:delta_phi_tms} respectively. However we have implemented
it in our Python package \texttt{qsipy}.

\vspace*{1ex}
\paragraph*{}
In order to find the asymptotic limit of $\Delta \phi_0$ (i.e. eq. (11) and (13) of the main article), one must study
the asymptotic expansion of the different terms of $\Delta \phi_0$. In particular, one finds that the expression of $\Delta \phi_0$
involves $\cos[2 \arcsec(\bullet)]$ and $\cos[4 \arcsec(\bullet)]$ terms, that must be expanded up to the second order
to find the asymptotic limit.

\end{document}
% {\eta  (N+2) \left(\eta ^2 \left(N^2-14 N+24\right)+16 \eta  (N-3)+16\right)}
%{(\eta -1) \left(\eta ^2 (4 n-6)+\eta  (6-4 n)-1\right)}

% \csc ^{-1}\left(\sqrt{\frac{\sqrt{(\eta -1) \left(-4 \eta ^2 \left(10 n^2-19 n+6\right)+2 \eta ^5 n \left(2 n^3-15 n^2+24 n-9\right)+2 \eta ^4 n \left(-2 n^3+31 n^2-72 n+45\right)+\eta ^3 \left(-33 n^3+134 n^2-135 n+18\right)+\eta  (9-12 n)-1\right)}+\eta ^3 (4 n-6)+\eta ^2 (12-8 n)+\eta  (4 n-7)+1}{(\eta -1) \left(\eta ^2 (4 n-6)+\eta  (6-4 n)-1\right)}}\right)