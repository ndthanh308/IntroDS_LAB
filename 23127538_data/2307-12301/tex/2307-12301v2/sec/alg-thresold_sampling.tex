\label{algorithm-threshold_sampling}

% \SetKwComment{Comment}{/* }{ */}
\SetKwProg{Init}{init}{}{}
\SetKwFor{RepTimes}{repeat}{times}{end}
\SetKwInOut{Input}{Input}\SetKwInOut{Output}{Output}
% \RestyleAlgo{ruled}

\begin{algorithm}[t]

\caption{Threshold Sampling (TS)}
\label{alg:threshold_sampling}


\Input{Embeddings $F = \{f_i\}_{i=1}^n, \Hquad f_i \in \mathbb{R}^d$\\
Inlier scores $\boldsymbol{\eta} = \{ \eta_i \}_{i=1}^n, \Hquad \eta_i \in [0, 1]$ \\
Threshold iterations $t$\\
Sample size $m$\\
}
\Output{Outlier scores $\boldsymbol{\sigma} = \{\sigma_i\}_{i=1}^n, \Hquad \sigma_i \in [0, 1]$}

\Init{}{
    $\boldsymbol{\sigma} = \{ \sigma_i \}_{i=1}^n$ where $\sigma_i = 0$ \\
}

\For{$k \gets 1$ to $t$}{
    $\tau \gets (k-1)/t$ \\
    $\Omega \gets \{ f_j \mid \eta_j > \tau, f_j \in F \} \quad$ \\
    \eIf{$ | \Omega | > 0 $}{
        $\Tilde{I} \gets$ take $\min{(| \Omega |, m)}$ samples from $\Omega$ \\
        \For{$i \gets 1$ to $n$}{
            $\alpha_i \gets \max{(  \{  \cos{(f_i , \Tilde{f} )} \mid \Tilde{f} \in \Tilde{I}\}  )}$ \\
            $\sigma_i \gets (\mathbbm{1}{ [ \alpha_i < \tau ] } + (k-1) \cdot \sigma_i)/k$ \\
        }
    }{
        \textbf{break}
    }
}

\Return{$\boldsymbol{\eta}$}
\end{algorithm}