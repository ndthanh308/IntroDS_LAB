\subsection{Surrogate Trading System}\label{sec: proxy}

% Motivation: why do we need a proxy trading system
Since the meta-market is a data-driven system, 
we need objective functions to supervise the model estimating behavior vectors with high fidelity according to the real order streams.
However, it is impossible to know the ground truth optimal behavior $b^*$ of each time unit.
Existing works regard a similar reproduction as high fidelity --
for the $t^{th}$ time unit, 
if the estimated behavior vector $\hat{b_t}$ is close to $b_t^*$ by a gap $\epsilon$, i.e.,
\begin{equation}
\left\lVert \hat{b_t}-b_t^*\right\rVert_n < \epsilon,
\label{eq: s_obj1}
\end{equation}
the generated order stream should be close to the ground truth order stream $s_t$
\begin{equation}
\left\lVert M_h\left (\hat{b_t} \right)-s_t \right\rVert_n < k\epsilon,
\label{eq: s_obj2}
\end{equation}
where $M_h$ denotes the multi-agent system and $k>0$.
Therefore, the current calibration approaches find the behavior parameter $\hat{b_t}$ by heuristic searching.

% What is so challenging about the model building
The search process is tedious, painful, and ineffective, 
leaving order stream information not fully utilized. 
Thus, we propose an end-to-end meta-market system to directly analyze order stream data and estimate behavior parameters,
in a search-free manner.
However, the multi-agent system is complex, dynamic, and thus, not differentiable.
This poses a big challenge to optimizing the meta-market by the reproduction objective in Equation~\ref{eq: s_obj2}. 


% How do we build the proxy model
We tackle this through the observation that behavior parameters of multi-agent systems usually contribute to some statistical features in the generated order stream.
For example, more chartists in the market often lead to a short-tailed return distribution over mid-price. 
This enables us to re-parameterize the multi-agent system by a surrogate trading system, so that
\begin{equation}
\min_{\gamma \in Y}\ \left\lVert sur_{\gamma}(b)-Q\left(M_h(b)\right)\right\rVert_n,
\label{eq: proxy_obj}
\end{equation}
where the $sur$ denotes the surrogate model, parameterized by $\gamma$, and the $Q$ function calculates those features that the simulation users consider to be important.
% Through such a reparameterization,
In this way,
we re-parameterize the non-differentiable multi-agent system by the surrogate trading system
and use it to optimize the meta-market $K$  
via a reproduction loss
\begin{equation}
L_{repr} = \left\lVert sur_{\gamma}\left(\hat{b_t}\right)-Q\left(s_t\right)\right\rVert_n,
\label{eq: loss_reproduce}
\end{equation}
where $\hat{b_t}=K(u_t, x_t)$.