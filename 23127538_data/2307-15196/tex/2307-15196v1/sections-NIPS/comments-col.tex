
\iffalse
\begin{proof}
	We directly Taylor expand the left hand side of the weak approximation definition for a fixed value of $k$. Start by looking at the first term.
	\begin{align*}
		\sum_i \partial_i h(\vy) (x_{k,i}-y_{k,i}) \leq K_0(\vy) \E[x_{k,i}-y_{k,i}]
	\end{align*}
	where $\partial_i$ denotes the $i$th coordinate of the gradient. 
	If $\beta=1-\lambda\eta^\alpha$, then
	$$ \E[x_{k,i}-y_{k,i}] = (\lambda^{-1}\eta^{1-\alpha} - \eta) \E[m_{k,i}] $$
	Now we can unroll the momentum to write
	\begin{align}
		\vm_k &= \beta^k\vm_0 + \sum_{s=0}^{k-1} \beta^{k-s-1}(1-\beta)\vg_s \label{eq:unrolled_momentum} \\
		\E\vm_k &= \beta^k\E\vm_0 + \sum_{s=0}^{k-1} \beta^{k-s-1}(1-\beta)\nabla_s \label{eq:unrolled_momentum2}
	\end{align}
	In order to bound this expectation, we have to consider the gradient. 
	Using the fact that the gradient is Lipschitz, we can write
	\begin{align*}
		\|\nabla_s - \nabla_k\| &\leq L\|x_s-x_k\| 
		\leq L \sum_{\tau=s}^{k-1} \eta\|\vm_\tau\| 
		\leq L\eta(k-s) \sup_{\tau=s,...,k-1} \|\vm_\tau\|
	\end{align*}
	If we substitute this into \Cref{eq:unrolled_momentum2}, then we can write
	$$ \E\vm_k = \beta^k\E\vm_0 + \sum_{s=0}^{k-1} \beta^{k-s-1}(1-\beta)L\eta(k-s)\sup_{\tau=s,...,k-1} \|\vm_\tau\| $$
	We first bound the coefficients in the last term to be $\mathcal O(\eta^{1-\alpha})$.
	$$ \sum_{s=0}^{k-1} \beta^{k-s-1} (1-\beta)\eta(k-s) \leq \frac{\eta}{1-\beta} = \mathcal{O}(\eta^{1-\alpha}) $$
	Then, we bound $\E \|\vm_k\|^2$:
	\begin{align}
            \E\norm{\vm_k}^2&= \norm{\E\vm_k}^2+ \E\norm{\vm_k-\E\vm_k}^2\\
            & = \norm{\E\vm_k}^2+\beta^{2k}\E\norm{\vm_0-\E\vm_0}^2 + \sum_{s=0}^{k-1} \beta^{2(k-s-1)}(1-\beta)^2\E\norm{\vsigma_s}^2\\
            & \leq \norm{\E\vm_k}^2 + \E\norm{\vm_0}^2 + \frac{1}{\eta}\frac{1-\beta}{1+\beta}\sum_{s=0}^{k=1}\tr(\mSigma_s\mSigma_s^\top) \label{eq:exp_mnorm_sq}
	\end{align}
	Since $\tr(\mSigma_s\mSigma_s^\top)$ is bounded for all time steps $s$, we drop the summation and just write $\tr(\mSigma\mSigma^\top)$. To handle the first term:
	\begin{align}
	\norm{\E\vm_k} &\leq \|\E\vm_0\| + \sum_{s=0}^{k-1} \beta^{k-s-1}(1-\beta)\norm{\E\nabla_k}+ \sum_{s=0}^{k-1} \beta^{k-s-1} (1-\beta) L \eta (k-s) \sup_{\tau=s,...,k-1} \E\|\vm_\tau\|	\\
	& \leq \|\E\vm_0\| + \norm{\E\nabla_k} + \frac{L\eta}{1-\beta}\sup_{\tau=0,...,k-1} \E\|\vm_\tau\|
	\end{align}
	We use this with \Cref{eq:exp_mnorm_sq} to bound $\E\norm{\vm_k}$.
	\begin{align}
		\E\norm{\vm_k} &\leq \sqrt{\E\norm{\vm_k}^2}\\
 		& \leq \sqrt{\norm{\E\vm_k}^2 + \E\norm{\vm_0}^2 + \frac{1}{\eta}\frac{1-\beta}{1+\beta}\tr(\mSigma\mSigma^\top)}\\
 		& \leq \norm{\E\vm_k} + \sqrt{\E\norm{\vm_0}^2} +\sqrt{\frac{1}{\eta}\frac{1-\beta}{1+\beta}\tr(\mSigma\mSigma^\top)}\\
 		& \leq \norm{\E\nabla_k} + 2\sqrt{\E\norm{\vm_0}^2} +\sqrt{\frac{1}{\eta}\frac{1-\beta}{1+\beta}\tr(\mSigma\mSigma^\top)}+\frac{L\eta}{1-\beta}\sup_{\tau=0,...,k-1} \E\|\vm_\tau\|
	\end{align}
    We choose $\eta$ small enough so that $\eta<(\frac{}{2L})$ 
	From this, we can conclude that $\sup_{\tau=0,...,k-1} \E\|\vm_\tau\| = \norm{\E\nabla_k} + \mathcal O(\eta^{(\alpha-1)/2})$, which also implies that $\norm{\E\vm_k}\leq 2\norm{\E\nabla_k} + \mathcal O(1)$. 
\fi
\iffalse
	-----------------
     And
        \begin{align}
            \vm_k-\E\vm_k &= \beta^k(\vm_0-\E\vm_0) + \sum_{s=0}^{k-1} \beta^{k-s-1}(1-\beta)\vsigma_s 
	\end{align}
     Therefore
         \begin{align}
            \E\norm{\vm_k}^2&= \norm{\E\vm_k}^2+ \E\norm{\vm_k-\E\vm_k}^2\\
            & = \norm{\E\vm_k}^2+\beta^{2k}\E\norm{\vm_0-\E\vm_0}^2 + \sum_{s=0}^{k-1} \beta^{2(k-s-1)}(1-\beta)^2\E\norm{\vsigma_s}^2\\
            & \leq \norm{\E\vm_k}^2 + \E\norm{\vm_0}^2 + \frac{1}{\eta}\frac{1-\beta}{1+\beta}\tr(\mSigma\mSigma^\top)
	\end{align}
	Using the fact that the gradient is Lipschitz, we can write
	\begin{align*}
		\|\nabla_s - \nabla_k\| &\leq L\|x_s-x_k\| \\
		&\leq L \sum_{\tau=s}^{k-1} \eta\|\vm_\tau\| \\
		&\leq L\eta(k-s) \sup_{\tau=s,...,k-1} \|\vm_\tau\|
	\end{align*}
	Plugging in this bound to \Cref{eq:unrolled_momentum2} gives us 
 (We start by bounding the coefficients in the last term. We relax $s$ to be from $-\infty$ to $k-1$ without loss of generality. )
	Then,
	$$ \sum_{s=0}^{k-1} \beta^{k-s-1} (1-\beta)\eta(k-s) \leq \frac{\eta}{1-\beta} = \mathcal{O}(\eta^{1-\alpha}) $$
    \begin{align}
	\norm{\E\vm_k} &\leq \|\E\vm_0\| + \sum_{s=0}^{k-1} \beta^{k-s-1}(1-\beta)\norm{\E\nabla_k}+ \sum_{s=0}^{k-1} \beta^{k-s-1} (1-\beta) L \eta (k-s) \sup_{\tau=s,...,k-1} \E\|\vm_\tau\|\\
        & \leq \|\E\vm_0\| + \norm{\E\nabla_k} + \frac{L\eta}{1-\beta}\sup_{\tau=0,...,k-1} \E\|\vm_\tau\|\\
	\E\norm{\vm_k} &\leq \sqrt{\E\norm{\vm_k}^2}\\
 & \leq \sqrt{\norm{\E\vm_k}^2 + \E\norm{\vm_0}^2 + \frac{1}{\eta}\frac{1-\beta}{1+\beta}\tr(\mSigma\mSigma^\top)}\\
 & \leq \norm{\E\vm_k} + \sqrt{\E\norm{\vm_0}^2} +\sqrt{\frac{1}{\eta}\frac{1-\beta}{1+\beta}\tr(\mSigma\mSigma^\top)}\\
 & \leq \norm{\E\nabla_k} + 2\sqrt{\E\norm{\vm_0}^2} +\sqrt{\frac{1}{\eta}\frac{1-\beta}{1+\beta}\tr(\mSigma\mSigma^\top)}+\frac{L\eta}{1-\beta}\sup_{\tau=0,...,k-1} \E\|\vm_\tau\|
    \end{align}

    note: we get 
	$\sup_{\tau=s,...,k-1} \E\|\vm_\tau\| =  \norm{\E\nabla_k} + O(\eta^{(\alpha-1)/2})$ and $\norm{\E\vm_k} \leq 2 \norm{\E\nabla_k} + O(1)$

 --------------------------------------------
 \fi
 
%	Now we can bound $\sup_{\tau=1,...,k} \E[\|\vm_\tau\|]$.
%	\begin{align*}
%		\sup_{\tau=1,...,k} \E[\|\vm_\tau\|] &\leq \|\vm_0\|	+ \sup_{\tau=1,...,k-1} \E[\|\vg_k\|] + \mathcal O(\eta^{1-\alpha})\sup_{\tau=1,...,k} \E[\|\vm_\tau\|] \\
%		(1-\mathcal{O}(\eta^{1-\alpha}))\sup_{\tau=1,...,k} \E[\|\vm_\tau\|] &\leq \|\vm_0\| + \sup_{\tau=1,...,k-1} \E[\|\vg_k\|] \tag{*}
%	\end{align*}
%	We have to bound $\|\nabla_k\|$. Let $d_k = \|\nabla_k-\nabla_0\|$, so $\|\nabla_k\| \leq \|\nabla_0\| + d_k$
%	\begin{align*}
%		|d_k-d_{k-1}| &\leq \|\nabla_k - \nabla_{k-1}\| \leq L\|\vx_k - \vx_{k-1}\| = L\eta\|\vm_k\|
%	\end{align*}
%	Plugging this into (*) gives us 
%	$$ \sup_{\tau=1,..,k} \E[\|\vm_\tau\|] \leq \|\vm_0\| + \|\nabla_0\| + \sup_{\tau=1,...,k-1} \E[d_\tau] $$
%	Let $s_k = \sup_{\tau=1,...,k} \E[d_\tau]$. We know $$ d_k \leq d_{k-1} + L\eta\|\vm_k\| \leq d_{k-1} + L\eta(\|\vm_0\| + \|\vg_0\| + s_{k-1}) $$
%	This implies 
%	\begin{align*}
%		s_k &\leq s_{k-1} + L\eta(\|\vm_0\| + \|\vg_0\| + s_{k-1}) \\
%		&\leq (1+L\eta) s_{k-1} + L\eta(\|\vm_0\| + \|\vg_0\|)	\\
%		&\leq (1+L\eta)^{k+1} (\|\vm_0\| + \|\vg_0\|) \\
%		&\leq \mathcal{O} (\exp(\L\eta k))
%	\end{align*}
%Noting that $k\sim 1/\eta$ completes the proof. 
\iffalse
We can bound $\E\|\nabla_k\|$. Let $d_k = \E\|\vy_k-\vy_0\|^2$, so 
\begin{align}
d_{k+1} &= d_{k} +\E\|\vy_{k+1}-\vy_k\|^2 + 2\E(\vy_{k+1}-\vy_k)^\top(\vy_k-\vy_0)\\
&\leq d_k + \eta^2 \E\norm{\nabla_k}^2 + \eta \tr(\mSigma\mSigma^\top) + 2 \eta\sqrt{d_k}\E\norm{\nabla_k}
\end{align}
\begin{align}
\|\nabla_k\| & \leq \|\nabla_0\| + L\norm{\vx_{k}-\vx_0}\\
& \leq \|\nabla_0\| + L\norm{\vy_{k}-\vy_0} + L\norm{\vx_{0}-\vy_0} + L\norm{\vx_{k}-\vy_k}
\end{align}
So
\begin{align}
\E\|\nabla_k\| & \leq \E\|\nabla_0\| + L\sqrt{d_k} +\frac{\eta\beta}{1-\beta}(\E\|\vm_0\|+\E\|\vm_k\|)\\
& \leq O(1) + L\sqrt{d_k} + O(\eta^{1-\alpha})\E\|\nabla_k\|
\end{align}
\begin{align}
\E\|\nabla_k\|^2 & \leq (O(1) + L\sqrt{d_k})^2
\end{align}
plugin

\begin{align}
d_{k+1} &\leq d_k + \eta^2 \E\norm{\nabla_k}^2 + \eta \tr(\mSigma\mSigma^\top) + 2 \eta\sqrt{d_k}\E\norm{\nabla_k}\\
&\leq (1+\eta^2L^2+2\eta L)d_k + O(\eta)
\end{align}
 Then by Gronwall's inequality, $d_k$ is bounded by $O(1)$ and so is $\E\|\nabla_k\|$ for $k=O(1/\eta)$. The proof is completed by noting $\|\E\nabla_k\| \leq \E\|\nabla_k\|$.
\end{proof}
\fi
