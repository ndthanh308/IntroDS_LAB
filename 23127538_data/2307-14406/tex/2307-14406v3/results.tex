\section{Results}
\label{sec:results}
In this section, we present the final results of the seven RQs formulated in Section \ref{subsec:research_questions}. 

\subsection{RQ1: The Extent Code Snippets Used in Code Reviews}
\label{subsec:results_of_RQ1}

\subsubsection{Results of RQ1}
To answer RQ1, we investigated (1) the proportion of review comments that contain code snippets, (2) the proportions of code snippets provided in review comments by reviewers and developers respectively, and (3) the proportion of developers and reviewers who had provided code snippets in review comments.
% Table \ref{Counts and Percentages of Review Comments that Contain Code Snippets per Community} and Table  \ref{Counts and Percentages of Review Comments that Contain Code Snippets Provided by Reviewers and Developers} below present the results of RQ1, showing the overview of the review comments and code snippets in code reviews in OpenStack and Qt.

\vspace{10pt}

\noindent\textbf{The proportion of review comments that contain code snippets}

Table \ref{Counts and Percentages of Review Comments that Contain Code Snippets per Community} presents the counts and percentages of review comments that contain code snippets per community. In total, we collected 69,604 review comments from OpenStack and Qt, 3,213 of which contain code snippets. Overall, the percentage of code snippet comments is 4.6\% only, which means that code snippets are not prevalently used in review comments by during code review. Moreover, the percentages of code snippet comments are similar in OpenStack and Qt, thus indicating a consistency of the results.
% More specifically, in the OpenStack community, \textcolor{blue}{4.3\%} of the review comments contain code snippets, while in the Qt community, the proportion of review comments that contain code snippets is slightly higher, at 4.8\%. We can find that the percentages of review comments that contain code snippets are similar in OpenStack and Qt, thus indicating a consistency of the results.}

\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts and percentages of review comments that contain code snippets}
\label{Counts and Percentages of Review Comments that Contain Code Snippets per Community}
\begin{tabular}{lm{1.2cm}<{\centering}m{6cm}<{\centering}}
\hline
\textbf{Community} & \textbf{\#RCs} & \textbf{\#RCs with Code Snippets (CSs) (\%)} \\ \hline
OpenStack          & 22,631                   & 967 (4.3\%)                                     \\ 
Qt                 & 46,973                   & 2,246 (4.8\%)                                    \\ \hline       
\textbf{Total}     & 69,604                   & 3,213 (4.6\%)                                    \\ \hline
\end{tabular}
\end{table}

\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts and percentages of review comments that contain code snippets provided by reviewers and developers}
\label{Counts and Percentages of Review Comments that Contain Code Snippets Provided by Reviewers and Developers}
\begin{tabular}{lm{2.8cm}<{\centering}m{2.8cm}<{\centering}}
\hline
\textbf{Community} & \textbf{\#RCs with CSs by Reviewers (\%)}   & \textbf{\#RCs with CSs by Developers (\%)} \\ \hline
OpenStack          & 863 (89.2\%)                                & 104 (10.8\%)                       \\
Qt                 & 1,905 (84.8\%)                              & 341 (15.2\%)                       \\ \hline
\textbf{Total}     & 2,768 (86.2\%)                              & 445 (13.8\%)                       \\ \hline
\end{tabular}
% \footnotesize{CS is used to indicate code snippet.}
\end{table}

\vspace{10pt}

\noindent\textbf{The proportion of code snippets provided in review comments by reviewers and developers respectively}

Table \ref{Counts and Percentages of Review Comments that Contain Code Snippets Provided by Reviewers and Developers} shows the counts and percentages of code snippet comments provided by reviewers and developers respectively. In code reviews, most review comments that contain code snippets are provided by reviewers, whose proportions in OpenStack and Qt are 89.2\% and 84.4\% respectively. In general, more than 85\% (2,768 out of 3,213, 86.2\%) review comments with code snippets are provided by reviewers. It is not surprising that reviewers are the primary source that provides code snippet comments because reviewers play a major role in code reviews. 
% For example, when conducting code review, reviewers often give suggestions for optimizing an existing piece of code, at which point they may provide optimized and modified code snippets in review comments for developers' reference as shown below: 

% \begin{qoutebox}{white}{}
%     \textbf{Link:} \url{http://alturl.com/uonk3} \\
%     \textbf{Reviewer:} ``Hello, what you think in create a Class to deal with the complexity of calculating the VMs uptime? If you agree, I have a suggestion bellow, something like this: [code snippets].''
% \end{qoutebox}

% Sometimes, reviewers also need to cite related code to make their explanations or illustrations more complete so that their review comments can be better understood by developers or other reviewers, similar to the example shown below:
% \begin{qoutebox}{white}{}
%     \textbf{Link:} \url{http://alturl.com/yz9ya} \\
%     \textbf{Reviewer:} ``I tend to agree with Sylvain here. One catch though is that \_set\_passwd() formal arguments would be asymmetrical: [code snippets]. So please properly document what type these function takes and returns.''
% \end{qoutebox}

% \begin{table}[htbp]
% \centering
% \caption{Counts and Percentages of Review Comments (RC) that Contain Code Snippets(CS) Provided by Reviewers and Developers}
% \label{Counts and Percentages of Review Comments that Contain Code Snippets Provided by Reviewers and Developers}
% \begin{tabular}{lll}
% \hline
% \textbf{Community} & \textbf{RC with CS by Reviewers (\%)} & \textbf{RC wich CS by Developers (\%)} \\ \hline
% OpenStack          & 849 (89.1\%)                                & 104 (12.2\%)                       \\
% Qt                 & 1906 (84.9\%)                               & 338 (17.7\%)                       \\ \hline
% Total              & 2755 (86.2\%)                               & 442 (13.8\%)                       \\ \hline
% \end{tabular}
% \end{table}

\vspace{10pt}

\noindent\textbf{The proportion of developers and reviewers who had provided code snippets in review comments}

Table \ref{Counts and Percentages of developers and reviewers who had provided code snippets in code reviews per community} presents the proportion of developers and reviewers who had provided code snippets in review comments according to the dataset we collected from OpenStack and Qt. From the results, we can find that 25.4\% developers and reviewers in OpenStack had provided code snippets, while 34.4\% in Qt. Overall, the proportion of developers and reviewers who had provided code snippets in review comments is 30.2\%. However, given the reason that in a project a contributor can play both roles, i.e., developer and reviewer, we could not tell the proportion of developers or reviewers providing code snippets in review comments.

\begin{table}[htbp]
\centering
\renewcommand\arraystretch{1.5}
\caption{Counts and Percentages of developers and reviewers who had provided code snippets in code reviews}
\label{Counts and Percentages of developers and reviewers who had provided code snippets in code reviews per community}
\begin{tabular}{lm{3cm}<{\centering}m{4.5cm}<{\centering}c}
\hline
\textbf{Community} & \textbf{\#Developers and Reviewers} & \textbf{\#Developers and Reviewers who had Provided CSs} & \% \\ \hline
OpenStack          & 338                                 & 86                                                       & 25.4\%         \\
Qt                 & 375                                 & 129                                                      & 34.4\%        \\ \hline
\textbf{Total}     & 713                                 & 215                                                      & 30.2\%       \\ \hline
\end{tabular}
\end{table}



\subsubsection{Feedback on the Findings of RQ1}
Fig.~\ref{fig: Feedback_on_Findings_of_RQ1} shows the distribution of how often industrial developers provide code snippets in review comments when conducting code reviews. We can find that most participants said that they provided code snippets in code reviews sometimes or very few, accounting for 76.2\% in total. More specifically, 50.8\% participants chose that they sometimes used code snippet in code reviews and 25.4\% chose that they used code snippets very few. 17.5\% participants said that they often used code snippets in code reviews. Only 4 participants expressed that they never used code snippets when conducting code reviews, accounting for 6.3\%. According to the feedback, most developers tend to use code snippets in code review process, but how often they use code snippets mainly depends on the necessity of the context (reviewed code and review discussions) rather than the perceived value of using code snippets in review comments.

% Figure environment removed

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ1 Summary:} According to our results, only a small proportion of review comments contain code snippets (less than 5\%), and most code snippet comments are provided by reviewers rather than developers (more than 85\%).}}
		\end{tcolorbox}
\end{center}


\subsection{RQ2: The Reviewers' Purposes of Providing Code Snippets in Code Reviews}
\label{subsec:results_of_RQ2}

\subsubsection{Results of RQ2}
\label{subsubsec: results_of_RQ2}
\label{sub_results_of_rq2}

\noindent\textbf{The purposes of reviewers providing code snippets in code reviews}

To answer RQ2, we used Open Coding and Constant Comparison methods to identify the purposes of reviewers providing code snippets in code reviews, and two high-level categories are formulated (i.e., \textit{Suggestion} and \textit{Citation}). We further identified four detailed purposes of providing code snippets in code reviews under the \textit{Suggestion} category and two detailed purposes under the \textit{Citation} category. Moreover, to make the detailed purpose \textit{Improving Code Implementation} clearer, six specific purposes are categorized under it (see Fig.~\ref{fig: Category of purposes of code snippets provided by reviewers in code reviews}). The identified purposes are presented below, and we provide a review comment example for each detailed purpose.

% Figure environment removed

\textbf{(1) Suggestion} refers to the situation in which reviewers provide code snippets in review comments to recommend developers what they can do or what they should do to make the quality of code better. The provided code snippets are what reviewers want developers to change the current code to. \textit{Suggestion} contains four detailed purposes:

\textbf{Improving Code Implementation:} The reviewed code is correct and complete but needs improvements. The code snippets provided by reviewers in code reviews are used to remind developers what they can do to improve specific quality attributes of current code:
    % The code snippets provided by reviewers in code reviews are used to point out alternative solutions or advice to improve the current code in the patchsets (e.g., design or detailed implementation).
\begin{itemize}
    \item \textbf{Improving Maintainability of Code:} The provided code snippets are what reviewers want developers to change the current code to, which can make code simpler, more readable, more efficient, and thus easier to maintain.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/am3q9} \\
    \textbf{Reviewer:} ``Sure, I'm just saying we're supposing that check\_traits will always return this way. I'm just saying (for code maintenance) that having some explicit attributes would help (and would raise some error in case the returned object changes). eg. [code snippet]''
    \end{qoutebox}
    % \item \textbf{Following Code Style:} The provided code snippets are reviewers want developers to change the current code to, which can make the style of code consistent with the best code conventions.
    % \begin{qoutebox}{white}{}
    % \textcolor{blue}{
    % \textbf{Link:} \url{http://alturl.com/jis7g} \\
    % \textbf{Reviewer:} ``I think this is not an acceptable coding style for Qt in this case. Would go with something like: [code snippet]...''}
    % \end{qoutebox}
    \item \textbf{Improving Performance of Code:} The provided code snippets are what reviewers want developers to change the current code to, which can make code execute faster and be more efficient.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/4gcs7} \\
    \textbf{Reviewer:} ``I'll let Nate comment on this too, but the problem now is there will always be two lookups for the SG now, which could affect performance. One way to lessen this would be a slight change here, something like: [code snippet]...''
    \end{qoutebox}
    \item \textbf{Improving Robustness of Code:} The provided code snippets are what reviewers want developers to change the current code to, which can make code have stronger ability to withstand or overcome adverse conditions.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/uwr3h} \\
    \textbf{Reviewer:} ``This should not be computed by len / oldLength, which may overflow for small oldLength and large len. We know oldLength is of comparable order to dx() and dy(), so [code snippet] is more numerically robust.''
    \end{qoutebox}
    \item \textbf{Improving Testability of Code:} The provided code snippets are what reviewers want developers to change the current code to, which can make code support testing to a greater degree in a given test environment.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/rfz6y} \\
    \textbf{Reviewer:} ``... i guess this is why you said almost all places in the commit message.maybe you should still use the fixture here too for consitency so add a setup thatdoes [code snippet]. this works but it might be nice have this bevhior in all tests by defualt.''
    \end{qoutebox}
    \item \textbf{Improving Compatibility of Code:} The provided code snippets are what reviewers want developers to change the current code to, which can make code enhance the ability to work with data or configurations created by older versions. 
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/oq69p} \\
    \textbf{Reviewer:} ``Why even bother with the \_WITH\_ARGS() version? We have macro varargs now. At the very least, make life easy for clients: [code snippet]. We could, of course, do similar for Q\_GLOBAL\_STATIC(), although we'd have to keep the \_WITH\_ARGS() version for backwards compatibility.''
    \end{qoutebox}
    \item \textbf{Improving Portability of Code:} The provided code snippets are what reviewers want developers to change the current code to, which can make code run on a wider variety of platforms.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/urdmh} \\
    \textbf{Reviewer:} ``Would [code snippet] work, too? If so I'd prefer that as this doesn't depend directly on the host os and potentially works remotely.''
    \end{qoutebox}
\end{itemize}


\textbf{Following Code Style:} The reviewed code is correct and complete but has code style issues. The code snippets provided by reviewers in code reviews are used to remind developers the code style issues of current code, and developers should change the current code style to the style of provided code snippets, to be consistent with the best code conventions.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/jis7g} \\
    \textbf{Reviewer:} ``I think this is not an acceptable coding style for Qt in this case. Would go with something like: [code snippet]...''
    \end{qoutebox}
    
\textbf{Correcting Code:} The reviewed code is incorrect (e.g., has logic errors). The code snippets provided by reviewers in code reviews are used to remind developers the incorrectness of current code, and developers should correct the error code with the provided code snippets.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/4c63s} \\
    \textbf{Reviewer:} ``Hi, This is a BUG. Should modify it like this: [code snippet]...''\\
    \textbf{Developer:} ``Thanks much for pointing it out! I will investigate the issue.''
    \end{qoutebox}

\textbf{Complementing Code Implementation:} The reviewed code is incomplete. The code snippets provided by reviewers in code reviews are used to remind developers the incompleteness of current code, and developers should complement the code with the provided code snippets. 
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/qt62k} \\
    \textbf{Reviewer:} ``The case of empty headers (or CRLF-only headers) would have size() == 0 but succeed. It’s probably worth adding. Suggestion: [code snippet].''\\
    \textbf{Developer:} ``Done.''
    \end{qoutebox}

\vspace{10pt}

\textbf{(2) Citation} refers to the situation in which reviewers provide code snippets cited from internal (e.g., the code in the current files of the patchsets) or external (e.g., the code in other files of the project) sources in code reviews to offer developers necessary review-related information rather than offer suggestions. \textit{Citation} contains two detailed purposes:

\textbf{Elaborating:} The code snippets cited by reviewers in code reviews are used to help reviewers supplement their explanations or illustrations.
\begin{qoutebox}{white}{}
\textbf{Link:} \url{http://alturl.com/3h8iq} \\
\textbf{Reviewer:} ``I think you’re just getting confused because we’re building the regex in two steps. metakey\_pattern\_base isn’t being sent to the regex engine - we’re using it to compose the regex that is. Maybe this helps: [code snippet].''
\end{qoutebox}
When reviewers provide code snippets in code reviews for the purpose of \textit{Elaborating}, they usually have offered suggestions in the previous comments and they cite code snippets in a following new comment to explain why they make the previous suggestions.

\textbf{Providing Context:} The code snippets cited by reviewers in code reviews are used to provide contextual information related to what reviewers had mentioned in the review comments. 
\begin{qoutebox}{white}{}
\textbf{Link:} \url{http://alturl.com/8rzjs} \\
\textbf{Reviewer:} ``In `Ml2Plugin.\_create\_port\_db' the variable passed is the dictionary: [code snippet]''
\end{qoutebox}
When reviewers provide code snippets in code reviews for the purpose of \textit{Providing Context}, they usually cite code snippets from other files of the same project to make developers get the contextual information. Reviewers may also provide links related to the provided code snippets at the same time. 

\vspace{10pt}

\noindent\textbf{The proportion of code snippets provided in review comments for different purposes by reviewers}

We further investigated the distribution of the purposes of code snippets provided by reviewers in code reviews. Table \ref{The distribution of high-level purposes of using code snippets in the OpenStack and Qt communities} presents the distribution of the two high-level purposes of providing code snippets in the OpenStack and Qt communities. In general, among the 2,768 review comments with code snippets provided by reviewers, 2,322 (83.9\%) are provided for the purpose of \textit{Suggestion}, while 446 (16.1\%) for the purpose of \textit{Citation}. In both OpenStack and Qt communities, the main purpose of reviewers using code snippets in code reviews is \textit{Suggestion}, and the proportion of review comments for \textit{Suggestion} purpose is significantly higher than the proportion of \textit{Citation}. This result shows that code snippets are usually provided by reviewers in review comments to make suggestions for developers.

Moreover, Table \ref{The distribution of each detailed purpose of using code snippets in code reviews} presents the distribution of the detailed purposes under the two high-level purposes of using code snippets in code reviews. \textit{Improving Code Implementation} is the main purpose of reviewers providing code snippets in code reviews, which is more than 50\% in both OpenStack and Qt, and higher than other purposes by a large margin, indicating that reviewers often provide code snippets to offer developers suggestions which can improve quality attributes of current code. Among all the quality attributes, reviewers want to improve the maintainability of reviewed code most. Besides, the proportions of \textit{Correcting Code}, \textit{Complementing Code Implementation}, \textit{Elaborating}, and \textit{Providing Context} are very close in both communities. However, the proportion of \textit{Following Code Style} varies considerably between the two communities. In OpenStack, \textit{Following Code Style} accounts for 16.6\%, making it the second most frequent purpose of providing code snippets by reviewers in code reviews. However in Qt, \textit{Following Code Style} accounts for only 4.8\%.

\begin{table}[htbp]
\centering
\renewcommand\arraystretch{1.5}
\caption{Counts and percentages of review comments for high-level purposes of using code snippets in the OpenStack and Qt communities}
\label{The distribution of high-level purposes of using code snippets in the OpenStack and Qt communities}
\begin{tabular}{lm{2.8cm}<{\centering}m{3cm}<{\centering}m{3cm}<{\centering}}
\hline
\textbf{Community} & \textbf{\#RCs with CSs by Reviewers}  & \textbf{\#RCs with Suggestion Purpose}  & \textbf{\#RCs with Citation Purpose}\\ \hline
OpenStack          & 863                                                   & 747 (86.6\%)                                               & 116 (13.4\%)                              \\
Qt                 & 1,905                                                 & 1,575 (82.7\%)                                             & 330 (17.3\%)                              \\ \hline
\textbf{Total}     & 2,768                                                 & 2,322 (83.9\%)                                             & 446 (16.1\%)                              \\ \hline
\end{tabular}
\end{table}

\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\caption{Counts and percentages of review comments for each detailed purpose of using code snippets in code reviews}
\label{The distribution of each detailed purpose of using code snippets in code reviews}
\begin{tabular}{llcc}\hline
\multicolumn{2}{l}{\textbf{Detailed Purpose}}           & \textbf{\begin{tabular}[c]{@{}c@{}}\#RCs in\\OpenStack (\%)\end{tabular}} & \textbf{\begin{tabular}[c]{@{}c@{}}\#RCs in\\Qt (\%)\end{tabular}} \\ \hline
\multicolumn{1}{l}{\multirow{7}{*}{\begin{tabular}[c]{@{}l@{}}Improving Code \\ Implementation\end{tabular}}}                                          
& Improving Maintainability of Code                     & 416 (48.2\%)                                                              & 1,052 (55.2\%) \\
\multicolumn{1}{l}{} & Improving Performance of Code    & 11 (1.3\%)                                                                & 33 (1.7\%) \\
\multicolumn{1}{l}{} & Improving Robustness of Code     & 4 (0.5\%)                                                                 & 20 (1.0\%) \\
\multicolumn{1}{l}{} & Improving Testability of Code    & 1 (0.1\%)                                                                 & 6 (0.3\%) \\
\multicolumn{1}{l}{} & Improving Compatibility of Code  & 0 (0.0\%)                                                                 & 2 (0.1\%) \\
\multicolumn{1}{l}{} & Improving Portability of Code    & 0 (0.0\%)                                                                 & 1 (0.1\%) \\
\multicolumn{2}{l}{Following Code Style}                & 143 (16.6\%)                                                              & 91 (4.8\%) \\
\multicolumn{2}{l}{Correcting Code}                     & 90 (10.4\%)                                                               & 195 (10.2\%) \\
\multicolumn{2}{l}{Complementing Code Implementation}   & 82 (9.5\%)                                                                & 175 (9.2\%) \\ \hline
\multicolumn{2}{l}{Elaborating}                         & 72 (8.3\%)                                                                & 217 (11.4\%) \\
\multicolumn{2}{l}{Providing Context}                   & 44 (5.1\%)                                                                & 113 (5.9\%) \\ \hline
\multicolumn{2}{l}{\textbf{Total}}                      & 863                                                                       & 1,905 \\ \hline
\end{tabular}
\end{table}

\vspace{10pt}

\noindent\textbf{The proportion of reviewers who had provided code snippet comments with different purposes}

In total, there are 86 reviewers who had provided code snippets in OpenStack, and 101 in Qt. We then counted the reviewers who provided code snippet comments for different purposes, as shown in Table \ref{Counts and percentages of reviewers who had provided code snippets in code reviews with different purposes}. For reviewers who provided code snippets in code reviews, most of them (i.e., 75.0\% in OpenStack and 83.2\% in Qt) provided snippets to \textit{Improve Code Implementation}, which is also the most common purpose regarding the number of code snippet comments. In OpenStack, the percentages of reviewers providing code snippet suggestions for the other three purposes (i.e., \textit{Following Code Style}, \textit{Correcting Code}, and \textit{Complementing Code Implementation}) are very close, and reviewers who provided code snippet comments for the purpose of \textit{Providing Context} account the least (22.4\%). In Qt, the proportion of reviewers who provided code snippet comments aiming at \textit{Following Code Style} account the least (25.7\%), while the percentages of reviewers who provided code snippet comments for the remaining four purposes (i.e., \textit{Correcting Code}, \textit{Complementing Code Implementation}, \textit{Elaborating}, and \textit{Providing Context}) are comparable.

\begin{table}[htbp]
\centering
\renewcommand\arraystretch{1.5}
\caption{Counts and percentages of reviewers who had provided code snippets in code reviews for different purposes}
\label{Counts and percentages of reviewers who had provided code snippets in code reviews with different purposes}
\begin{tabular}{lm{2.5cm}<{\centering}m{2.5cm}<{\centering}}
\hline
\textbf{Detailed Purpose}          & \textbf{\#Reviewers in OpenStack (\%)}  & \textbf{\#Reviewers in Qt (\%)} \\ \hline
Improving Code Implementation      & 57 (75.0\%)                            & 84 (83.2\%) \\
Following Code Style               & 24 (31.6\%)                            & 26 (25.7\%) \\
Correcting Code                    & 26 (34.2\%)                            & 43 (42.6\%) \\
Complementing Code Implementation  & 25 (32.9\%)                            & 39 (38.6\%) \\ \hline
Elaborating                        & 21 (27.6\%)                            & 47 (46.5\%) \\
Providing Context                  & 17 (22.4\%)                            & 45 (44.6\%) \\ \hline
\end{tabular}
\end{table}


\subsubsection{Feedback on the Findings of RQ2}
According to the results of how often developers provide code snippets in code reviews of the survey study, 4 participants (6.3\%) answered that they never provided code snippets in review comments. So we analyzed the responses of the remaining 59 participants to investigate the purposes of industrial developers providing code snippets. The survey question (SQ3) in the questionnaire provides the six detailed purposes of code snippets obtained from the repository mining study (see Section~\ref{subsubsec: results_of_RQ2}) as candidate options for participants to choose. Note that the participants can select multiple purposes when answering this survey question, and they can also fill in the ``Other'' field to express other purposes of providing code snippets that are not covered by the candidate options. In the 59 responses, 3 participants completed the ``Other'' field. However, we decided to exclude their answers to the ``Other'' field as these 3 participants did not explain their other purposes clearly. In the ``Other'' field, they just expressed their opinions about using code snippets in code reviews and did not highlight the point, as one of them stated ``\textit{nearly only if writing code is more readable and more explanatory than normal text}'', which is about the characteristics of code snippets instead of a clear purpose of providing them.

% According to the results of the survey study for validating RQ2, only 4 participants (6.3\%) answered that they never provided code snippets in code reviews, and we then analyzed the responses of the remaining 59 participants to investigate the purposes of industrial developers using code snippets in code reviews. The survey question SQ3 in the questionnaire provides the six detailed purposes of code snippets obtained from the repository mining study (see Section~\ref{subsubsec: results_of_RQ2}) as candidate options for participants to choose. Note that the participants can select multiple purposes when answering this survey question, and they can also fill in the ``Other'' field to express their ideas about other purposes of code snippets that are not covered by the candidate options. In the 59 responses, 3 participants completed the ``Other'' field besides selecting the candidate options. However, we decided to exclude their answers to the ``Other'' field as these 3 participants did not explain the other purposes clearly, and they just expressed their opinions about using code snippets in code reviews in the ``Other'' field, as one of them stated ``\textit{nearly only if writing code is more readable and more explanatory than normal text}'', which is about the characteristics of code snippets instead of a clear purpose.

Fig.~\ref{fig: Feedback_on_Findings_of_RQ2} presents the feedback on our findings of RQ2. It shows that the most common purpose of participants providing code snippets in code reviews is \textit{Suggestion}. In total, 45 participants said that they would provide code snippets for \textit{Improving Code Implementation}, accounting for 76.2\%, making \textit{Improving Code Implementation} the most common detailed purpose for industrial developers to provide code snippets in code reviews. This result conforms to the repository mining study results (i.e., the proportion of reviewers who had provided code snippets for different purposes). The counts and percentages of \textit{Correcting Code}, \textit{Following Code Style}, and \textit{Elaborating} are very close, accounting for 66.1\% (39), 61.0\% (36), and 57.6\% (34) respectively. Moreover, 25 participants selected \textit{Providing Context} as their purpose of using code snippets in code reviews, accounting for 42.4\%. Only 16 participants said that they would provide code snippets with the purpose of \textit{Complementing Code Implementation} when conducting code reviews as reviewers, accounting for 27.1\% merely.

% Figure environment removed

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ2 Summary:} We identified the purposes of reviewers providing code snippets in code reviews and categorized them into two high-level categories: \textit{Suggestion} and \textit{Citation}. We further identified six types of detailed purposes under the two high-level categories, including \textit{Improving Code Implementation}, \textit{Following Code Sytle}, \textit{Correcting Code}, \textit{Complementing Code Implementation}, \textit{Elaborating}, and \textit{Providing Context}. Furthermore, we refined the \textit{Improving Code Implementation} purpose by categorizing six specific purposes under this category.} The results show that the main purpose of using code snippets by reviewers in code reviews is \textit{Suggestion}, which accounts for 83.9\% in total. Besides, most code snippets are provided for the purpose of \textit{Improving Code Implementation} to enhance code maintainability.}
		\end{tcolorbox}
\end{center}

\subsection{RQ3: The Developers’ Acceptance of Code Snippet Suggestions}
\label{subsec:results_of_RQ3}

To answer RQ3, we explored how developers treat code review comments containing code snippets for the purpose of \textit{Suggestion}, and we found that developers either accept, ignore, or do not accept code snippet suggestions. Then we investigated (1) the distribution of developers accepting, ignoring, or not accepting code snippet suggestions and (2) the acceptance rate of code snippet suggestions for the four detailed purposes of \textit{Suggestion} presented in the results of RQ2 (see Section~\ref{subsec:results_of_RQ2}).

\vspace{10pt}

\noindent\textbf{The distribution of developers accepting, ignoring, or not accepting code snippet suggestions}

The distribution of how developers treat code snippet suggestions in code reviews is shown in Fig. \ref{fig: Distribution of How Developers Treat Code Snippet Suggestions in Code Reviews}. In OpenStack and Qt, we got 2,322 code snippet suggestions, 1,442 of which were accepted by developers, accounting for 62.1\%. However, 12.9\% of the code snippet suggestions were just ignored by developers, who neither responded to these review comments nor made corresponding code changes. 581 code snippet suggestions were not accepted by developers, accounting for 25.0\%. In the OpenStack and Qt communities, the acceptance of code snippet suggestions is 70.5\% and 58.1\%, respectively. As a whole, most code snippet suggestions (more than 60\%) were accepted by developers, and about 40\% of code snippet suggestions were just ignored or not accepted. This finding suggests that code snippets can serve as an effective way when reviewers provide suggestions for developers in code reviews.

% Figure environment removed

% Figure environment removed

\vspace{10pt}

\noindent\textbf{The acceptance rate of code snippet suggestions for four detailed purposes of \textit{Suggestion}}

We further investigated the acceptance rate of four detailed \textit{Suggestion} purposes as presented in Fig. \ref{fig: Acceptance rate of code snippets in code reviews for four detailed purposes of Suggestion}. Overall, the result shows that the acceptance rate of \textit{Following Code Style} (73.9\%) is the highest, while the acceptance rate of \textit{Improving Code Implementation} (57.7\%) is the lowest. Besides, the acceptance rates of \textit{Correcting Code} and \textit{Complementing Code Implementation} are very close, with a minor difference 0.1\% between them. 
% The acceptance rates in total of \textit{Following Code Style}, \textit{Correcting Code}, and \textit{Complementing Code Implementation} are similar to our previous work \citep{fu2022understanding}, which highly verify the effectiveness of our results. The acceptance rate in total of \textit{Improving Code Implementation} is lower than the rate of our previous work \citep{fu2022understanding}. One of the reasons may be that we included two projects from Qt community, while our previous work only included projects from the OpenStack community. The review comment data come from different source may cause the different acceptance rate of \textbf{Improving Code Implementation}.

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ3 Summary:} 
            In general, most code snippet suggestions (62.1\%) were accepted by developers}. Among the four detailed \textit{Suggestion} purposes, the acceptance rate of \textit{Following Code Style} is the highest, while the acceptance rate of \textit{Improving Code Implementation} is the lowest.}
		\end{tcolorbox}
\end{center}


\subsection{RQ4: The Reasons that Developers do not Accept Code Snippet Suggestions}
\label{subsec:results_of_RQ4}
According to the results of RQ3, 581 code snippet suggestions made by reviewers were not accepted by developers. To answer RQ4, we further analyzed these not accepted code snippet suggestions through the discussions between developers and reviewers. Based on the contextual information around the review comments, we identified the reasons why developers do not accept code snippet suggestions as listed in Table \ref{The reasons that developers do not accept code snippet suggestions in code reviews}.
\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts and percentages of the reasons that developers do not accept code snippet suggestions in code reviews}
\label{The reasons that developers do not accept code snippet suggestions in code reviews}
\begin{tabular}{lcc}
\hline
\textbf{Reason}                                               & \textbf{\#}       & \textbf{\%}  \\ \hline
Difference in the opinions between developers and reviewers   & 136               & 31.1\%       \\ 
Reviewer's suggestion is flawed                               & 105               & 24.0\%       \\ 
Adopt other proposed suggestion                               & 70                & 16.0\%       \\
Consider as an optional suggestion                            & 41                & 9.4\%        \\ 
Consider as a future plan                                     & 35                & 8.0\%        \\ 
Need to be discussed                                          & 15                & 3.4\%        \\ 
Avoid extra code complexity                                   & 10                & 2.3\%        \\ 
Improve code readability                                      & 9                 & 2.1\%        \\ 
Developer removed the relevant code                           & 9                 & 2.1\%        \\ 
Keep code consistency                                         & 5                 & 1.1\%        \\ 
Conflict with other patch                                     & 2                 & 0.5\%         \\ \hline       
\end{tabular} 
\end{table}

Many developers did not clarify the reasons behind their non-acceptance of code snippet suggestions. Out of the 581 unaccepted code snippet suggestions, 144 were not accepted due to unknown reasons. Of the remaining 437 unaccepted code snippet suggestions, \textit{difference in the opinions between developers and reviewers} (31.1\%) and \textit{reviewer's suggestion is flawed} (24.0\%) are the two main causes for the non-acceptance of code snippet suggestions. Since the differences in coding preferences, coding ability, software development experience, and understanding of current code changes, developers may hold different opinions against reviewers' code snippet suggestions. For example, in the following review comment, the developer thought that changing the code according to the reviewer's suggestion was unworthy, and he decided to keep the current code and rejected the reviewer's suggestion.

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/hb2m6} \\
    \textbf{Reviewer:} ``Suggestion: add a method to remove the version to the Import (moti- vation: shorter, this fix might be needed elsewhere). So then this would be shortened to: [code snippet]''\\
    \textbf{Developer:} ``Import currently has no non-const methods so let’s keep it that way... Could use reference here, too, but the minimal perf gain from that in literally meaningless here, so not worth changing.''
\end{qoutebox}

Another main reason for developers not accepting reviewers' code snippet suggestions is \textit{reviewer's suggestion is flawed}. Sometimes, reviewers miss the context and provide unsuitable solutions to current code change (see the example below). Sometimes, reviewers proposed code snippets that have syntax or logical errors. Therefore, developers pointed out the mistakes in the code snippet suggestions, and rejected the suggestions.

% reviewers should carefully evaluate the code quality before they make code snippet suggestions.

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/6kb4v} \\
    \textbf{Reviewer:} ``Could we use this on L401? [code snippet]''\\
    \textbf{Developer:} ``Why? image\_chunks is intentionally initialized here so it does not get filled in L381-392 (via the glance API call)''\\
    \textbf{Reviewer:} ``Yeah apologies I somehow missed that.''
\end{qoutebox}

Some code snippet suggestions were rejected because developers \textit{adopted other proposed solutions}. The adopted solutions may come from other reviewers, or from the developers themselves. Some code snippet suggestions were \textit{considered as an optional suggestion} which are not necessary to follow or \textit{considered as a future plan} which were not accepted now but might be accepted in the follow-up patchsets. Another reason why developers do not accept code snippet suggestions is because they thought that whether to modify the current code based on the code snippets provided by reviewers \textit{needs to be discussed}. For the reasons to \textit{avoid extra code complexity} and \textit{improve code readability}, developers do not accept reviewers' code snippet suggestions to make code simpler and more readable (see the two examples below):

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/qnnou} \\
    \textbf{Reviewer:} ``type hints? Note that you can avoid circular imports with something like e.g. 'nova.network.neutron.API' by doing the following: [code snippet]''\\
    \textbf{Developer:} ``Note that I don’t want to be reluctant to adding type hints here, but I think we are adding extra code complexity for an unnecessary need...''
\end{qoutebox}

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/cbrvr} \\
    \textbf{Reviewer:} ``NIT (just a possibly stupid suggestion): [code snippet]''\\
    \textbf{Developer:} ``I will keep as-is now for readability. These methods have a long name so doing 1 liners with them makes the indentation fun.''
\end{qoutebox}

In some review comments, \textit{developers removed the relevant code} so they did not accept reviewers' code snippet suggestions:

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/gu5cn} \\
    \textbf{Reviewer:} ``by the way whil i like the operator module if this is all you are using it for i would just do [code snippet]''\\
    \textbf{Developer:} ``Again, just code motion, this is actually dropped in the follow up series by [URL].''
\end{qoutebox}

\textit{Keeping code consistency} and \textit{conflicting with other patch} are the least mentioned reasons by developers, accounting for 1.1\% and 0.5\% respectively.

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ4 Summary:} We identified 11 categories of reasons why developers do not accept reviewers' code snippet suggestions, among which \textit{difference in the opinions between developers and reviewers} is the major reason.}} %Sometimes, developers \textbf{adopt other proposed suggestions} so they do not accept reviewers' code snippet suggestions.}}
		\end{tcolorbox}
\end{center}


\subsection{RQ5: The Scenarios in which Reviewers Provide Code Snippets}
\label{subsec:results_of_RQ5}
A total of 36 participants (57.1\%) answered the open-ended question (SQ4) to provide the scenarios of using code snippets in code reviews. Table \ref{Feedback on scenarios in which reviewers often provided code snippets in code reviews} presents the 11 scenarios in which reviewers provide code snippets when conducting code review collected from the feedback of industrial developers.
\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts of the scenarios in which reviewers provide code snippets in code reviews}
\label{Feedback on scenarios in which reviewers often provided code snippets in code reviews}
\begin{tabular}{lc}
\hline
\textbf{Scenario}                                     & \textbf{\#} \\ \hline
When code is more illustrative than words             & 27         \\ 
Current code is suboptimal                            & 9          \\ 
Advise developers not to deviate from code style      & 5          \\ 
Provide standard code snippet examples                & 5          \\
Show algorithms, standard libraries, or tools         & 3          \\ 
Guide new contributors                                & 2          \\
Avoid potential communication issues                  & 2          \\ 
Help developers know the target code elements         & 2          \\ 
Elaborate the impact of code changes on user behavior & 1          \\ 
Ask about the relationship between code snippets      & 1          \\ 
Refer to another code example                         & 1          \\ \hline       
\end{tabular}
\end{table}

Most participants expressed that they would like to provide code snippets in review comments \textit{when code is more illustrative than words} (27/36, 75.0\%). For example, when a large block of code has logical errors, it is easier to describe the errors by using code snippets rather than words. As one participant stated ``\textit{I think code snippets can be clearer than describing the fix/improvement suggestion in some situations}''. 
% Many participants thought that using code snippets is a quicker, easier, and unambiguous way to express their opinions or suggestions, as one participant mentioned that ``\textit{Many times, presenting a piece of code works better than explaining it for hours, and the programmer quickly understands what to do}''. Some other participants believed that using code snippets could help developers evaluate the suggestions made by reviewers, as one response wrote that ``\textit{It also makes it very easy to evaluate the suggestion by the developer}''. According to the responses we got from industrial practitioners, we found that providing code snippets in review comments is an effective way for reviewers to make suggestions or explain their opinions.

Nine of the participants mentioned that when \textit{current code is suboptimal} (e.g., when current code ``\textit{is unnecessarily complex or hard to follow}''), they would provide code snippets to help developers improve code quality. Five participants said that they would using code snippets to \textit{advise developers not to deviate from code style}. 
% For example, one participant wrote that ``\textit{It is very important that all team members use the same style code. I usually advise everyone not to deviate from this style code}''. 
Besides, five other participants mentioned that they would \textit{provide standard code snippet examples} to ``\textit{help developers better understand the suggestions in code review comments}''.

Three participants said that they would use code snippets to \textit{show algorithms, standard libraries, or tools} for developers. One of the three participants described the process in detail, ``\textit{I wonder if the programmer has implemented the function himself instead of using the standard library. In these cases, only writing is not enough, and for better understanding, a sample code should also be written in the review. With an example, it can be said that the standard library can be used in this way and the programmer’s time can be saved in this way}''. Moreover, two participants indicated that ``\textit{when a difficult issue arises}'' and the new contributors ``\textit{are not entirely able to identify why the tests are not passing}'', they would provide code snippets in review comments to \textit{guide new contributors}. Two other participants said that they would consider using code snippets in code reviews to \textit{avoid potential communication issues}, which can accelerate the process of problem solving.

Some participants indicated that they would provide code snippets in code reviews when there is a need to \textit{help developers know the target code elements}, \textit{elaborate the impact of code changes on user behavior}, \textit{ask about the relationship between code snippets}, and \textit{refer to another code example}. These scenarios are similar to the cases of providing code snippets with the purpose of \textit{Elaborating} or \textit{Providing Context} in the results of RQ2 (see Section~\ref{subsubsec: results_of_RQ2}).

%In general, the knowledge and practices of the scenarios in which reviewers provide code snippets shown in Table \ref{Feedback on scenarios in which reviewers often provided code snippets in code reviews} can help reviewers (especially inexperienced reviewers) to understand the usage of code snippets in code reviews, and consequently provide code snippets in similar scenarios to facilitate the code review process.

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ5 Summary:} Among the 63 responses from industrial practitioners, 36 participants gave the scenarios in which reviewers provide code snippets in code reviews. Based on the responses, we identified 11 categories of scenarios, among which over 80\% participants mentioned that they would use code snippets in review comments \textit{when code is more illustrate than words}.
            % In this context, providing code snippets is an effective way to communicate. Besides, some participants would use code snippets in code reviews when \textbf{current code is suboptimal}.
            }}
		\end{tcolorbox}
\end{center}

\subsection{RQ6: The Developers' Attitudes towards Code Snippets}
\label{subsec:results_of_RQ6}
The attitudes of industrial practitioners towards provided code snippets in code reviews is shown in Fig.~\ref{fig: Industrial developers' attitudes towards provided code snippets in code reviews}. Out of the 63 responses, 46 participants (73.0\%) expressed positive attitudes, thinking that code snippet comments are a good thing. 
% This result to some extent confirms the intuition that code snippets are more intuitive and persuasive for the communication between developers and reviewers. 
Besides, 13 participants held a neutral attitude towards provided code snippets, and they did not care whether review comments contain code snippets. 

Only one participant mentioned that using code snippets ``\textit{is not beneficial for someone else to solve an individual’s problems for him or her}'', and is negative about provided code snippets in code reviews.

% Figure environment removed

Three participants filled in the ``Other'' field to answer the survey question. One of them commented, ``\textit{It depends, if it makes the review process faster, good. If it’s somebody telling you ‘you should be doing something else’ then bad}''. Another participant stated that, ``\textit{Generally positive, as long as it facilitates communication}''. The attitudes of these two participants towards provided code snippets in review comments depend on whether the code snippets are good for code review process. If providing code snippets can facilitate code review, they would hold a positive attitude. Otherwise, they would be negative. One other participant mentioned that ``\textit{I’d normally consider it to be a problem if there were things in the review that could be solved by code snippets}''. At the same time, this participant wrote that the members of their development team were experienced, and they had worked in software industry for 6$\sim$40 years, so there were few needs for code snippets in code reviews.

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ6 Summary:} For provided code snippets by reviewers in code reviews, most developers (73.0\%) hold a positive attitude. Besides, some developers' attitudes towards provided code snippets in review comments depend on whether these code snippets are beneficial to the review process. If the code snippets are conducive, the developers will be positive about them.}}
		\end{tcolorbox}
\end{center}

\subsection{RQ7: The Characteristics of Code Snippets Developers Expect Reviewers to Provide}
\label{subsec:results_of_RQ7}
Out of the 63 participants, 38 participants (60.3\%) provided valid answers to the open-ended question (SQ6). Table \ref{Feedback on characteristics of code snippets that developers expect reviewers to provide in code review} shows the 4 categories of characteristics of code snippets that developers expect reviewers to provide in review comments.

\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts of the characteristics of code snippets that developers expect reviewers to provide in code reviews}
\label{Feedback on characteristics of code snippets that developers expect reviewers to provide in code review}
\begin{tabular}{m{3.5cm}m{6.8cm}c}
\hline
\textbf{Characteristic}          & \textbf{Example}                                                                        & \textbf{\#} \\ \hline
Understandable                   & \textit{Pseudocode to help others understand my idea}                                   & 39          \\ 
Fitting into existing code       & \textit{Generally simple examples which can be fit into the existing code with ease}    & 28          \\ 
Providing a better solution      & \textit{Sample code that can provide a better solution}                                 & 3          \\ 
Scenario-specific                & \textit{Scenario-specific code snippets}                                                & 1          \\ \hline       
\end{tabular} 
\end{table}

From Table \ref{Feedback on characteristics of code snippets that developers expect reviewers to provide in code review}, we can find that \textit{undetstandable} and \textit{fitting into existing code} are the major characteristics developers want most in provided code snippets. More specifically, most developers expect \textit{understandable} code snippets, and they hope that the code snippets should be simple, easy to read, provide detaied context, and highlight the point. As one participant stated, ``\textit{In my opinion, the desired code should be as simple as possible. In this way, the programmer can quickly understand what to do, away from the sidelines}''. 28 participants indicated that provided code snippets should be \textit{fitting into existing code}. They hope reviewers to provide functional code snippets which can execute easilty. As one participant mentioned, ``\textit{Preferably be possible to copy \& paste directly as a replacement to the commented code''.}
% Twelve participants indicated that provided code snippets should be \textit{Correct} (e.g., having correct syntax, compilable, and reliable). Another eleven participants wrote that they wanted the code snippets to be \textit{Executable}, and one potential reason is that \textit{Executable} code snippets could save the time and effort of developers, as one participant mentioned ``\textit{Preferably be possible to copy \& paste directly as a replacement to the commented code}''.

Few participants also stated other characteristics (i.e., \textit{providing a better solution} and \textit{scenario-specific}) that they expected reviewers to provide with code snippets. We also found that some participants did not care about the characteristics of code snippets in code reviews. They just wanted reviewers to provide code snippets that could promote the code review process, as one participant wrote ``\textit{I have no preferences for this: I trust reviewers to use code snippets where this is the most effective way to communicate their review comment}''.

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ7 Summary:} We identified 4 types of characteristics of code snippets that developers expect reviewers to provide in code reviews, and we found that most developers expect provided code snippets in code reviews to be \textit{understandable} and \textit{fitting into existing code}}.}
		\end{tcolorbox}
\end{center}
