\section{Discussion}
\label{sec:discussion}
In this section, we present a broader discussion of our empirical observations based on the results of both the exploratory and survey study.

% \textbf{The purposes of providing code snippets in code reviews:} 
%As the first work that combines both an exploratory study and an industrial survey to explore the extent of using code snippets, the purposes of providing code snippets, and how developers treat code snippets suggestions in code reviews, we obtain knowledge related to code snippets in code reviews, and such knowledge can give novel insights to researchers. 
% There are a number of works that specifically focus on the information needs in the code review process. \cite{wang2021understanding} explored the purposes of shared links in code reviews, and they identified 7 common purposes, i.e., Providing Context, Elaborating, Clarifying, Explaining Necessity, Proposing Improvement, Suggesting Experts, and Informing Splitted Patches. 
% To answer RQ2, we proposed a category of reviewers' purposes of providing code snippets in code reviews. The identified purposes indicate that code snippets can be used by reviewers to convey necessary information in the code review process, and providing code snippets can be an important and intuitive way to meet the information needs in code review in addition to automatic change summarization \citep{pascarella2018information} and shared links \citep{wang2021understanding}. 
% Due to the different nature of code snippets and shared links, the purposes of providing them in code reviews have some differences. According to the study results, we find that code snippets and shared links both can be provided by reviewers in code reviews with the aim of \textit{Improving Code Implementation}, \textit{Providing Context}, and \textit{Elaborating}. 
% However, different to automatic change summarization and shared links, code snippets can be used by reviewers to advise developers on other aspects of the code that are more relevant to the code submissions. 
% However, different from automatic change summarization and shared links, code snippets can be provided by reviewers to offer guidance to developers specifically concerning the code itself, rather than the contextual information of the code. For example, reviewers may point out issues related to code style or logic errors in current code, and they will provide code snippets in review comments to offer developers solutions to these issues, thereby enhancing code quality (e.g., code readability and maintainability). The main purpose of reviewers providing code snippets in code reviews is \textit{Improving Code Implementation} (54.4\%). However, according to the results of RQ3, developers' acceptance rate of code snippet suggestions with the aim of \textit{Improving Code Implementation} is the lowest among the four detailed purposes of \textit{Suggestion}, which may be caused by developers and reviewers holding different opinions about code optimization, thus making \textit{difference in the opinions between developers and reviewers} the most common reason why developers do not accept code snippet suggestions in code reviews. Sometimes, reviewers' code snippet suggestions of \textit{Improving Code Implementation} may \textit{bring extra code complexity}, \textit{reduce code readability}, or \textit{decrease code consistency}, which become the reasons that developers do not accept code snippet suggestions in code reviews. Besides, the acceptance rate of other three detailed \textit{Suggestion} purposes, i.e., \textit{Following Code Style}, \textit{Correcting Code}, and \textit{Complementing Code Implementation} are almost the same, all around 70\%. This finding indicates that developers and reviewers are inclined to reach an agreement on code style, code correctness, and code integrity. 
% When reviewers have suggestions on these issues, they can provide code snippets in review comments to give developers their opinions on the current code as there is a high probability of having the same ideas between reviewers and developers.
% \cite{wang2021understanding} found that \textit{Providing Context} and \textit{Elaborating} are the most common purposes of sharing links in code reviews, while our study results show that these two purposes belong to \textit{Citation} category are the least common ones of providing code snippets in code reviews, which indicates that code snippets are not often provided by reviewers to give developers indirect information by citing related code. On the contrary, \textit{Suggestion} is the main purpose of reviewers providing code snippets in code reviews, showing that developers tend to use strongly correlated code snippets in code reviews to give developers suggestions on modifying the current code. The distinct focus of purposes reveals that code snippets and shared links place varying emphasis on the information they convey during code review, making them complementary ways to meet the information needs of both reviewers and developers in the code review process.

\textbf{Developers should follow the best code conventions when programming and reviewers should pay more attention to code style issues during code review:} According to the results of RQ2, \textit{Following Code Style} is one of the main purposes that reviewers provide code snippets in review comments. This finding indicates that developers may be unfamiliar with the code style used in the projects and thus may lead into code style issues. \cite{miltiadis2014learning} found that one third of change reviews include feedback regarding code conventions, and developers are often unaware of the conventions. We suggest developers to write code in adherence to best code conventions to standardize the code formatting and reduce code style issues, which can improve consistency of code and collaboration within development teams. According to the results of RQ3, the acceptance rate of \textit{Following Code Style} is the highest among the four detailed \textit{Suggestion} purposes, which implies that developers and reviewers can easily reach a consensus towards suggestions related to code style. However, according to the proportions of reviewers who had provided code snippet comments for different purposes (Table~\ref{Counts and percentages of reviewers who had provided code snippets in code reviews with different purposes} in Section \ref{sub_results_of_rq2}), the ratio of reviewers providing suggestions aiming at \textit{Following Code Style} ranks the least, which indicates that only a small part of reviewers notice the inconsistency between the style of reviewed code and the best code conventions. We suggest reviewers to pay more attention to code style issues during code review, and this will improve the quality of code, just as one participant mentioned, ``\textit{It is very important that all team members use the same style code. I usually advise everyone not to deviate from this style code}''. Besides, automation tools that examine whether the source code follows the project's code conventions can also be highly beneficial for software development. These measures can significantly reduce reviewers' workload on commenting code style issues and accelerate code review process.
% Development team leaders should actively guide developers, particularly those contributing to open-source projects, to adapt to the coding style of the projects, as one developer wrote in the questionnaire, ``\textit{It is very important that all team members use the same style code}''. 
% For example, one participant wrote that ``\textit{It is very important that all team members use the same style code. I usually advise everyone not to deviate from this style code}''. 

\textbf{OSS development teams can use code snippets in review comments to guide new contributors:} Popular open source projects receive review contributions from a diverse group of developers, including many who have limited or no previous engagement with the project \citep{vincent2015will}. \cite{jennifer2013impression} found that OSS developers rely on information about detailed traces of an individualâ€™s project-related activities to inform their decisions on how to interact with new, unknown contributors to their projects. Code snippets can also be used to convey necessary information to novel contributors during code review process. According to the results of RQ5, two participants expressed their willingness to provide code snippets in review comments in order to \textit{guide new contributors}. One of them said, ``\textit{Most often, I provide snippets to provide context to newer contributors on items such as code style checks which are resulting in their tests failing, or when a difficult issue arises and they are not entirely able to identify why the tests are not passing. Sometimes this is to more elaborate or make the code more defensive, but generally more experienced developers tend to do this inherently so the need is less}''. The use of code snippets is a valuable tool to guide and inform new contributors during code review. Experienced developers require fewer code snippet comments in code reviews compared to new contributors as experienced developers tend to write high-quality code naturally. Nevertheless, we recommend that knowledgeable developers within OSS development teams can utilize code snippets in code reviews to facilitate the onboarding and contribution process for new team members, fostering collaboration and growth of these projects.

\textbf{Reviewers can more frequently provide code snippet suggestions in code reviews to encourage developers' acceptance:} Overall, 62.1\% developers accepted reviewers' code snippet suggestions according to the results of RQ3, revealing that most developers changed existing code to code snippets provided by reviewers in the following patches. Such a high level of acceptance rate of reviewers' code snippet suggestions demonstrates that code snippets can greatly assist developers in understanding reviewers' suggested code changes as code snippets show concrete and actionable solutions. Therefore, developers can make necessary adjustments to current code accordingly. These code snippet suggestions are valuable for enhancing code quality attributes, promoting consistency in code style, ensuring code correctness, and preserving code integrity (see the purposes of providing code snippet suggestions in Section \ref{sub_results_of_rq2}). By more frequently providing code snippet suggestions during code review process, reviewers not only enhance the efficiency of communications, but also deepen developers' understanding of how to make code changes, ultimately resulting in developers' higher acceptance rate of reviewers' code snippet suggestions.
% Incorporating code snippet suggestions into code reviews can be a powerful strategy for encouraging developers to accept and implement proposed changes. These suggestions, often accompanied by practical examples, provide developers with a clear and actionable path toward making necessary adjustments. By offering concrete solutions to identified issues, reviewers not only enhance the efficiency of the review process but also assist developers in understanding the rationale behind the suggested modifications. This collaborative approach fosters a sense of teamwork and continuous improvement within the development team, as it helps unify code style, ensure code correctness, and uphold overall code integrity. Reviewers who consistently provide code snippet suggestions contribute to a culture of learning and growth, ultimately resulting in higher-quality code and more effective development processes.

\textbf{Code snippets can serve as an effective way for communication during code review:} \cite{gonalves2023competencies} have focused on the competencies developers need to execute code review, and their study results call for more research on how to support and develop reviewers' potential to communicate effectively during code review. Our study results show that code snippets can be used to improve the effectiveness of communication between reviewers and developers. According to the responses from our survey study, most participants thought that in some scenarios code snippets provide a quicker, easier, and unambiguous way to express their opinions and suggestions. As one participant mentioned that, ``\textit{Many times, presenting a piece of code works better than explaining it for hours, and the programmer quickly understands what to do}''. Some other participants believed that using code snippets in code reviews could help developers evaluate the suggestions made by reviewers, as one response wrote that ``\textit{It also makes it very easy to evaluate the suggestion by the developer}''. According to the results of RQ6, some participants even mentioned that they would provide code snippets in code reviews to \textit{avoid potential communication issues}, indicating that they thought that providing code snippets in review comments could help them convey needed information for code review more accurately.
% Many participants thought that using code snippets is a quicker, easier, and unambiguous way to express their opinions or suggestions, as one participant mentioned that ``\textit{Many times, presenting a piece of code works better than explaining it for hours, and the programmer quickly understands what to do}''. Some other participants believed that using code snippets could help developers evaluate the suggestions made by reviewers, as one response wrote that ``\textit{It also makes it very easy to evaluate the suggestion by the developer}''. According to the responses we got from industrial practitioners, we found that providing code snippets in review comments is an effective way for reviewers to make suggestions or explain their opinions.
% Besides, our study results and findings can serve as practical guidelines for reviewers to use code snippets appropriately and provide better code snippets in code review comments, which can consequently facilitate the code review process from a communication perspective. 


% \subsubsection{Future Directions for Researchers}

% Our study highlights promising research directions in code review. The results of RQ2 provide six detailed purposes of reviewers providing code snippets in code reviews. However, we did not explore the purposes of developers providing code snippets in code reviews, which could be different from the purposes of reviewers and can be studied and compared in the future. In the code review process, developers also need to provide information to meet reviewers' needs. If this information is readily available, reviewers can focus on verifying and improving the code they are reviewing, rather than spending time and effort on collecting missing information \citep{pascarella2018information}.
% % Such knowledge can serve as a valuable complement to our study results, and can help reviewers focus on verifying and improving the reviewed code rather than collecting necessary information but missing. 
% The results of RQ3 present the acceptance rate of code snippet suggestions. Our study results show that most suggestions are accepted by developers (61.9\%), which provide an empirical basis for future studies to explore whether and how the inclusion of code snippets in reviewers' code review suggestions has an impact on developers' acceptance of the reviewers' suggestions.


% \subsection{Implications for Practitioners}
% \label{subsec: Implications for practitioners}

% \subsubsection{Suggestions for Software Development Teams}
% According to the results of RQ2, \textit{Following Code Style} is one of the main purposes that reviewers provide code snippets in review comments. This finding indicates that developers may be unfamiliar with the coding style or code conventions used in the projects. According to the results of RQ3, the acceptance rate of \textit{Following Code Style} is the highest among the four detailed \textit{Suggestion} purposes, which implies that suggestions with the aim of \textit{Following Code Style} are the suggestions on which developers and reviewers can easily reach a consensus. Development team leaders should actively guide developers, particularly those contributing to open-source projects, to adapt to the coding style of the projects, as one developer wrote in the questionnaire, ``\textit{It is very important that all team members use the same style code}''. Besides, automation tools that examine whether the source code follows the project's code conventions can also be highly beneficial for software development. These measures can significantly reduce reviewers' workload on commenting code style issues and accelerate the code review process to some extent. Moreover, according to the results of RQ4 we found that reviewers' suggestions \textit{considered as a future plan} is one of the reasons for developers' non-acceptance of code snippet suggestions. Therefore, it is meaningful for development teams to record these suggestions (e.g., in a to-do list) for easy tracking and inspection of these suggestions in the future. According to the results of RQ6, most developers show positive attitudes towards provided code snippets in review comments. We suggest that development teams should encourage reviewers to provide code snippets in code reviews for developers \textit{when code is more illustrative than words} according to the results of RQ5. 

% \subsubsection{Suggestions for Code Reviewers}
% In the code review process, when reviewers want to advise developers to make code changes or cite related code to supplement necessary information, they can use code snippets in review comments to achieve their goals. According to the results of RQ5, reviewers provide code snippets especially on scenarios in which they want to make suggestions related to code quality improvement (e.g., when \textit{current code is suboptimal}). Sometimes developers reject reviewers' code snippet suggestions since provided code snippets will increase code complexity or have syntax or logic errors. We then suggest that reviewers should consider the correctness of code snippets to be provided in the context in order to better assist developers in solving their issues and avoiding creating new issues. Moreover, the results of RQ5 (the scenarios in which reviewers provide code snippets) and RQ7 (the characteristics of code snippets developers expect) can guide reviewers to provide code snippets in code reviews appropriately. When reviewers encounter similar scenarios as we identified in RQ5, they can provide code snippets to complete the code reviews. The majority of developers want the provided code snippets are \textit{Concise}, \textit{Correct}, and \textit{Executable}, which are the key characteristics that reviewers should pay attention when providing code snippets in code reviews. Besides, code snippets provided by reviewers should \textit{highlight the point}, which can help developers to understand reviewers' opinions and thus accelerate the communication between them during code review.

\textbf{Purposeful code snippets in code reviews should be understandable and easy to fit into existing code:} \cite{bacchelli2013expectations} explored code review comments in practice, and they found that the key of any review is code and change understanding. Our study results corroborate this to some extent, as the results of RQ7 highlight the importance of the understandability of provided code snippets in review comments. Code snippets should be written by reviewers in a way that makes them easy for developers to understand. They should be clear and concise, without unnecessary complexity or ambiguity, making it easy for developers to grasp its significance within the context of the code review. Otherwise, provided code snippets that are not relevant may unnecessarily divert developers' attention and add extra workload. As one participants said, ``\textit{Code snippets should be short and to the point; not containing boilerplate which would be needed to run the code in isolation; as that distracts from the main point raised in the review}''. Meanwhile, provided code snippets should be easy to \textit{fit into existing code}. In other words, the code snippets should be ``\textit{syntactically correct and executable}'', compatible with the code style and functionality of the codebase, ensuring that incorporating the code snippets into the existing code will not introduce errors or inconsistencies. RQ4 investigates the reasons why developers do not accept code snippet suggestions, and \textit{reviewers' suggestion is flawed} accounts for nearly 25\%, ranking it second, which indirectly confirms that provided code snippets should be correct.

% \textcolor{blue}{\textbf{Code snippet should be used in appropriate scenarios during code review:}}

\textbf{Developers' purposes of providing code snippets in code reviews need further investigation:} According to the results of RQ1, in addition to reviewers, developers provide code snippets in review comments as well. The results of RQ2 provide reviewers' purposes of providing code snippets in code reviews. However, we did not explore the purposes of developers providing code snippets in code reviews, which could be different from the purposes of reviewers and can be further investigated and compared in the future. In code review process, developers also need to provide information to meet reviewers' needs. If this information is readily available, reviewers can focus on verifying and improving the code they are reviewing, rather than spending time and effort on inquiring and collecting missing information \citep{pascarella2018information}. Besides, the results of RQ3 present the acceptance rate of code snippet suggestions, showing that most suggestions were accepted by developers (61.9\%). This finding provides an empirical basis for researchers to further explore how the inclusion of code snippets in reviewers' \textit{suggestion} comments has an impact on developers' reactions.

% \textcolor{blue}{\textbf{Toward efficient code review:}}