\section{Results}
\label{sec:results}
In this section, we present the final results of the seven RQs formulated in Section \ref{subsec:research_questions}. 

\subsection{RQ1: The Extent Code Snippets Used in Code Reviews}
\label{subsec:results_of_RQ1}
\subsubsection{Results of RQ1}
To answer RQ1, we investigated (1) the proportion of review comments that contain code snippets and (2) the proportions of code snippets provided in review comments by reviewers and developers respectively. Table \ref{Counts and Percentages of Review Comments that Contain Code Snippets per Community} and Table  \ref{Counts and Percentages of Review Comments that Contain Code Snippets Provided by Reviewers and Developers} below present the results of RQ1, showing the overview of the review comments and code snippets in code reviews in OpenStack and Qt.

\vspace{10pt}

\noindent\textbf{The proportion of review comments that contain code snippets}

Table \ref{Counts and Percentages of Review Comments that Contain Code Snippets per Community} presents the counts and percentages of review comments that contain code snippets per community. In total, we collected 69,604 review comments from OpenStack and Qt, 3,197 of which contain code snippets. Overall, the percentage of review comments containing code snippets is 4.6\% only, which means that code snippets are not prevalently used in review comments by developers and reviewers during code review. More specifically, in the OpenStack community, 4.2\% of the review comments contain code snippets, while in the Qt community, the proportion of review comments that contain code snippets is slightly higher, at 4.8\%. We can find that the percentages of review comments that contain code snippets are similar in OpenStack and Qt, thus indicating a consistency of the results.

\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts and percentages of review comments that contain code snippets per community}
\label{Counts and Percentages of Review Comments that Contain Code Snippets per Community}
\begin{tabular}{lll}
\hline
\textbf{Community} & \textbf{Review Comment} & \textbf{Review Comment with Code Snippets (\%)} \\ \hline
OpenStack          & 22631                   & 953 (4.2\%)                                     \\ 
Qt                 & 46973                   & 2244 (4.8\%)                                    \\ \hline       
\textbf{Total}     & 69604                   & 3197 (4.6\%)                                    \\ \hline
\end{tabular}
\end{table}

\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts and percentages of review comments (RC) that contain code snippets(CS) provided by reviewers and developers}
\label{Counts and Percentages of Review Comments that Contain Code Snippets Provided by Reviewers and Developers}
\begin{tabular}{lll}
\hline
\textbf{Community} & \textbf{RC with CS by Reviewers (\%)} & \textbf{RC with CS by Developers (\%)} \\ \hline
OpenStack          & 849 (89.1\%)                                & 104 (10.9\%)                       \\
Qt                 & 1906 (84.9\%)                               & 338 (15.1\%)                       \\ \hline
\textbf{Total}     & 2755 (86.2\%)                               & 442 (13.8\%)                       \\ \hline
\end{tabular}
\end{table}

\vspace{10pt}

\noindent\textbf{The proportion of code snippets provided in review comments by reviewers and developers respectively}

Table \ref{Counts and Percentages of Review Comments that Contain Code Snippets Provided by Reviewers and Developers} shows the counts and percentages of review comments that contain code snippets provided by reviewers and developers respectively. In code reviews, most review comments that contain code snippets are provided by reviewers, as review comments with code snippets provided by reviewers accounts for 89.1\% in OpenStack and review comments with code snippets provided by reviewers accounts for 84.9\% in Qt. In general, more than 85\% (2,755 out of 3,197, 86.2\%) of review comments with code snippets are provided by reviewers. It is not surprising that reviewers are the primary source that provides review comments containing code snippets because reviewers play a major role in code reviews. For example, when conducting code review, reviewers often give suggestions for optimizing an existing piece of code, at which point they may provide optimized and modified code snippets in review comments for developers' reference as shown below: 

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/uonk3} \\
    \textbf{Reviewer:} ``Hello, what you think in create a Class to deal with the complexity of calculating the VMs uptime? If you agree, I have a suggestion bellow, something like this: [code snippets].''
\end{qoutebox}

Sometimes, reviewers also need to cite related code to make their explanations or illustrations more complete so that their review comments can be better understood by developers or other reviewers, similar to the example shown below:
\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/yz9ya} \\
    \textbf{Reviewer:} ``I tend to agree with Sylvain here. One catch though is that \_set\_passwd() formal arguments would be asymmetrical: [code snippets]. So please properly document what type these function takes and returns.''
\end{qoutebox}

% \begin{table}[htbp]
% \centering
% \caption{Counts and Percentages of Review Comments (RC) that Contain Code Snippets(CS) Provided by Reviewers and Developers}
% \label{Counts and Percentages of Review Comments that Contain Code Snippets Provided by Reviewers and Developers}
% \begin{tabular}{lll}
% \hline
% \textbf{Community} & \textbf{RC with CS by Reviewers (\%)} & \textbf{RC wich CS by Developers (\%)} \\ \hline
% OpenStack          & 849 (89.1\%)                                & 104 (12.2\%)                       \\
% Qt                 & 1906 (84.9\%)                               & 338 (17.7\%)                       \\ \hline
% Total              & 2755 (86.2\%)                               & 442 (13.8\%)                       \\ \hline
% \end{tabular}
% \end{table}

\subsubsection{Feedback on the Findings of RQ1}
Fig.~\ref{fig: Feedback_on_Findings_of_RQ1} shows the distribution of how often industrial developers provide code snippets in review comments when conducting code reviews. We can find that most participants said that they provided code snippets in code reviews sometimes or very few, accounting for 76.2\% in total. More specifically, 50.8\% participants chose that they sometimes used code snippet in code reviews and 25.4\% chose that they used code snippets very few. This finding is in line with our exploratory study results, i.e., code snippets are not prevalently used in review comments by reviewers and developers in code reviews. Besides, 17.5\% participants said that they often used code snippets in code reviews. Only 4 participants expressed that they never used code snippets when conducting code reviews, accounting for 6.3\%.
% Figure environment removed


\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ1 Summary:} According to the results of the distribution of code snippet comments (less than 5\% of all the code review comments) and the distribution of code snippet comments provided by reviewers (more than 85\% of all the comments containing code snippets) and developers (less than 15\%) respectively, only a small proportion of review comments contain code snippets, and most code snippet comments are provided by reviewers rather than developers.}}
		\end{tcolorbox}
\end{center}


\subsection{RQ2: The Reviewers' Purposes of Providing Code Snippets in Code Reviews}
\label{subsec:results_of_RQ2}

\subsubsection{Results of RQ2}
\label{subsubsec: results_of_RQ2}
To answer RQ2, we used Open Coding and Constant Comparison methods to identify the purposes of reviewers providing code snippets in code reviews, and two high-level categories are formulated (i.e., \textit{Suggestion} and \textit{Citation}). Moreover, we further identified four detailed purposes of code snippets provided by reviewers in code reviews under the \textit{Suggestion} category and two detailed purposes under the \textit{Citation} category (see Fig.~\ref{fig: Category of purposes of code snippets provided by reviewers in code reviews}). The identified purposes are presented below, and we provide a review comment example for each detailed purpose.
% Figure environment removed

\textbf{(1) Suggestion} refers to the situation in which reviewers provide code snippets in review comments to recommend developers what they can do or what they should do to improve the quality of code. \textit{Suggestion} contains four detailed purposes:
\begin{itemize}
    \item \textbf{Improving Code Implementation:} The code snippets provided by reviewers in code reviews are used to point out alternative solutions or advice to improve the current code in the patchsets (e.g., design or detailed implementation).
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/58nr4} \\
    \textbf{Reviewer:} ``I think we can make this a lot simpler by just inspecting the returned SchemaHelper object... [code snippet]''\\
    \textbf{Developer:} ``Oh that makes a lot of sense! Thanks, will do!''
    \end{qoutebox}
    When conducting code review, reviewers will evaluate the submitted code from various aspects (e.g., readability and complexity) and provide code snippets to make the submitted code better. For example, reviewers often provide code snippets in review comments to simplify the current code (see the above example). During code review, reviewers also care about the quality attributes of the reviewed code (e.g., performance and maintainability). For example, one reviewer commented that ``\textit{You could beat that one performance degradation: [code snippet]}''. Code readability is another issue that reviewers often pay attention to. As Martin Fowler wrote in his book \citep{martin1999refactoring} ``\textit{Any fool can write code that a computer can understand. Good programmers write code that humans can understand}''. Software systems become larger and more complex with the evolution, and one popular open-source project can be developed and maintained by a large number of developers who may come from different regions with diverse cultural backgrounds and time zones. By reading code snippets in review comments, they can communicate with each other more effectively and efficiently, and consequently making the code snippets readable is very important.
    % In the above example, the reviewer provided the code snippet to simplify the readability of the existing code in the patchset, which could improve the quality of the code.
    \item \textbf{Following Code Style:} The code snippets provided by reviewers in code reviews are used to make the style of the current code consistent with the code conventions. Reviewers who provide code snippets with this purpose focus on addressing issues related to the format of the code, such as indention, spacing, line breaking, bracing. Adopting code conventions has been widely practiced in software development, and following code conventions can improve both code readability \citep{taek2013study} and maintainability \citep{han2020does}.
    
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/jis7g} \\
    \textbf{Reviewer:} ``I think this is not an acceptable coding style for Qt in this case. Would go with something like: [code snippet]...''
    \end{qoutebox}
    % In this example, the reviewer pointed out that the style of the current code is not inconsistent with the project code conventions.
    \item \textbf{Correcting Code:} The code snippets provided by reviewers in code reviews are used to show what kind of mistakes developers have made in the current code and to correct the error code. In code review, reviewers with more programming experience or better understanding of the project can evaluate the current code, and identify the mistakes such as logic errors in the reviewed code.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/4c63s} \\
    \textbf{Reviewer:} ``Hi, This is a BUG. Should modify it like this: [code snippet]...''\\
    \textbf{Developer:} ``Thanks much for pointing it out! I will investigate the issue.''
    \end{qoutebox}
    \item \textbf{Complementing Code Implementation:} The code snippets provided by reviewers in code reviews are used to remind developers that the current code is incomplete and developers should complement the code with the provided code snippets. When reviewers find that the functions in the reviewed code are lack of necessary logic or the reviewed code is lack of necessary features, they will use code snippets provided in review comments to help developers complete the code implementation. Besides, reviewers may also tell developers that the current code lacks test functions by using code snippets which provide corresponding tests in order to avoid technical debt \citep{fu2022potential}. 
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/qt62k} \\
    \textbf{Reviewer:} ``The case of empty headers (or CRLF-only headers) would have size() == 0 but succeed. It’s probably worth adding. Suggestion: [code snippet].''\\
    \textbf{Developer:} ``Done.''
    \end{qoutebox}
\end{itemize}

\vspace{10pt}

\textbf{(2) Citation} refers to the situation in which reviewers provide code snippets cited from internal (e.g., the code in the current files of the patchsets) or external (e.g., the code in other files of the project) sources in code reviews to offer developers necessary review-related information. \textit{Citation} contains two detailed purposes:
\begin{itemize}
    \item \textbf{Elaborating:} The code snippets cited by reviewers in code reviews are used to help reviewers supplement their explanations or illustrations.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/3h8iq} \\
    \textbf{Reviewer:} ``I think you’re just getting confused because we’re building the regex in two steps. metakey\_pattern\_base isn’t being sent to the regex engine - we’re using it to compose the regex that is. Maybe this helps: [code snippet].''
    \end{qoutebox}
    \item \textbf{Providing Context:} The code snippets cited by reviewers in code reviews are used to provide contextual information related to what reviewers had mentioned in the review comments. When reviewers provide code snippets in code reviews with the purpose of \textit{Providing Context}, they usually cite code snippets from other files of the same project to make developers get the contextual information. Reviewers may also provide links related to the provided code snippets at the same time.
    \begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/8rzjs} \\
    \textbf{Reviewer:} ``In `Ml2Plugin.\_create\_port\_db' the variable passed is the dictionary: [code snippet]''
    \end{qoutebox}
\end{itemize}

We further investigated the distribution of the purposes of code snippets provided by reviewers in code reviews. Table \ref{The distribution of high-level purposes of using code snippets in the OpenStack and Qt communities} presents the distribution of the two high-level purposes of providing code snippets in the OpenStack and Qt communities. In general, for the 2,753 review comments with code snippets provided by reviewers, 2,319 (84.2\%) review comments have code snippets provided by reviewers for the purpose of \textit{Suggestion} and 434 (15.8\%) for the purpose of \textit{Citation}. Besides, in both OpenStack and Qt communities, the main purpose of reviewers for using code snippets in code reviews is \textit{Suggestion}, and the proportion of the \textit{Suggestion} purpose is significantly higher than the proportion of the \textit{Citation} purpose. This result shows that code snippets are usually provided by reviewers to make suggestions for developers in code reviews.

Moreover, Table \ref{The distribution of each detailed purpose of using code snippets in code reviews} presents the distribution of the six detailed purposes under the two high-level purposes of using code snippets in code reviews. \textit{Improving Code Implementation} is the main purpose of reviewers providing code snippets in code reviews, which is more than 50\% in both OpenStack and Qt and higher than other purposes by a large margin, which indicates that the main purpose of providing code snippets by reviewers is to suggest developers with alternative solutions to improve the code quality. The proportions of the purposes \textit{Correcting Code}, \textit{Complementing Code Implementation}, \textit{Elaborating}, and \textit{Providing Context} are very close in both OpenStack and Qt communities, while the purpose \textit{Following Code Style} has a large difference in the percentage between the two communities. In OpenStack, \textit{Following Code Style} accounts for 15.8\%, making it the second most frequent purpose of providing code snippets by reviewers in code reviews. However in Qt, \textit{Following Code Style} accounts for only 3.6\%, which is the least common purpose of reviewers providing code snippets in the Qt community.

\begin{table}[htbp]
\centering
\renewcommand\arraystretch{1.5}
\caption{Distribution of high-level purposes of using code snippets in the OpenStack and Qt communities}
\label{The distribution of high-level purposes of using code snippets in the OpenStack and Qt communities}
\begin{tabular}{lm{3cm}<{\centering}m{3cm}<{\centering}m{2.8cm}<{\centering}}
\hline
\textbf{Community} & \textbf{Count of Code Snippet Comments by Reviewers} & \textbf{Count of Review Comments with Suggestion Purpose} & \textbf{Count of Review Comments with Citation Purpose}\\ \hline
OpenStack          & 849                                                  & 738 (86.9\%)                                      & 111 (13.1\%)                              \\
Qt                 & 1904                                                 & 1581 (83.0\%)                                     & 323 (17.0\%)                              \\ \hline
\textbf{Total}     & 2753                                                 & 2319 (84.2\%)                                     & 434 (15.8\%)                              \\ \hline
\end{tabular}
\end{table}



% \begin{table}[htbp]
% \caption{The distribution of each detailed purpose of using code snippets in code reviews}
% \label{The distribution of each detailed purpose of using code snippets in code reviews}
% \resizebox{\textwidth}{!}{
% \begin{tabular}{llcccccc}
% \hline
% \textbf{Purpose}            & \textbf{Detailed Purpose}         & \textbf{OpenStack} & \textbf{Percentage} & \textbf{Qt} & \textbf{Percentage} & \textbf{Total} & \textbf{Percentage} \\ \hline
% \multirow{4}{*}{Suggestion} & Improving Code Implementation     & 464                & 54.7\%              & 1190        & 62.4\%              & 1654           & 60.0\%              \\
%                             & Following Code Style              & 134                & 15.8\%              & 69          & 3.6\%               & 203            & 7.4\%               \\
%                             & Correcting Code                   & 74                 & 8.7\%               & 171         & 9.0\%               & 245            & 8.9\%               \\
%                             & Complementing Code Implementation & 68                 & 8.0\%               & 157         & 8.2\%               & 225            & 8.2\%               \\ \hline
% \multirow{2}{*}{Citation}   & Elaborating                       & 67                 & 7.9\%               & 209         & 11.0\%              & 276            & 10.0\%              \\
%                             & Providing Conte                   & 42                 & 4.9\%               & 110         & 5.8\%               & 152            & 5.5\%               \\ \hline
%                             & \textbf{Total}                    & 849                &                     & 1906        &                     & 2755           &                     \\ \hline
% \end{tabular}
% }
% \end{table}
\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\caption{Distribution of detailed purposes of using code snippets in code reviews}
\label{The distribution of each detailed purpose of using code snippets in code reviews}
\resizebox{\textwidth}{!}{
\begin{tabular}{llm{3cm}<{\centering}m{3cm}<{\centering}}
\hline
\textbf{Purpose}            & \textbf{Detailed Purpose}         & \textbf{Count of Review Comments in OpenStack (\%)} & \textbf{Count of Review Comments in Qt (\%)} \\ \hline
\multirow{4}{*}{Suggestion} & Improving Code Implementation     & 462 (54.4\%)                                        & 1185 (62.2\%)            \\
                            & Following Code Style              & 134 (15.8\%)                                        & 69 (3.6\%)               \\
                            & Correcting Code                   & 74 (8.7\%)                                          & 171 (9.0\%)               \\
                            & Complementing Code Implementation & 68 (8.0\%)                                          & 156 (8.2\%)               \\ \hline
\multirow{2}{*}{Citation}   & Elaborating                       & 69 (8.1\%)                                          & 213 (11.2\%)              \\
                            & Providing Context                 & 42 (4.9\%)                                          & 110 (5.8\%)               \\ \hline
                            & \textbf{Total}                    & 849                                                 & 1904                     \\ \hline
\end{tabular}
}
\end{table}


\subsubsection{Feedback on the Findings of RQ2}
According to the results of the survey study for validating RQ2, only 4 participants (6.3\%) answered that they never provided code snippets in code reviews, and we then analyzed the responses of the remaining 59 participants to investigate the purposes of industrial developers using code snippets in code reviews. The survey question SQ3 in the questionnaire provides the six detailed purposes of code snippets obtained from the repository mining study (see Section~\ref{subsubsec: results_of_RQ2}) as candidate options for participants to choose. Note that the participants can select multiple purposes when answering this survey question, and they can also fill in the ``Other'' field to express their ideas about other purposes of code snippets that are not covered by the candidate options. In the 59 responses, 3 participants completed the ``Other'' field besides selecting the candidate options. However, we decided to exclude their answers to the ``Other'' field as these 3 participants did not explain the other purposes clearly, and they just expressed their opinions about using code snippets in code reviews in the ``Other'' field, as one of them stated ``\textit{nearly only if writing code is more readable and more explanatory than normal text}'', which is about the characteristics of code snippets instead of a clear purpose.

Fig.~\ref{fig: Feedback_on_Findings_of_RQ2} presents the feedback on our findings of RQ2. It shows that the most common purpose of participants providing code snippets in code reviews is \textit{Suggestion}, which is consistent with the results of RQ2. In total, 45 participants said that they would provide code snippets for \textit{Improving Code Implementation}, accounting for 76.2\%, making \textit{Improving Code Implementation} the most common detailed purpose. This result conforms to the respository mining study results of RQ2 (see Section~\ref{subsubsec: results_of_RQ2}), indicating that \textit{Improving Code Implementation} is the main purpose of reviewers providing code snippets in code reviews. The counts of \textit{Correcting Code}, \textit{Following Code Style}, and \textit{Elaborating} are very close, accounting for 66.1\% (39), 61.0\% (36), and 57.6\% (34) respectively. According to the repository mining study results of RQ2, these three purposes are common ones as well: In the OpenStack community, \textit{Following Code Style} is the most frequently used purpose of reviewers providing code snippets in code reviews besides \textit{Improving Code Implementation}; In the Qt community, \textit{Elaborating} and \textit{Correcting Code} are the most common purposes besides \textit{Improving Code Implementation}. Moreover, 25 participants selected \textit{Providing Context} as their purpose of using code snippets in code reviews, accounting for 42.4\%. Only 16 participants said that they would provide code snippets with the purpose of \textit{Complementing Code Implementation} when conducting code reviews as reviewers, accounting for 27.1\% merely.

% Figure environment removed


\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ2 Summary:} We identified the purposes of reviewers providing code snippets in code reviews and categorized them into two high-level categories: \textit{Suggestion} and \textit{Citation}. We further identified six types of detailed purposes under the two high-level categories, including \textit{Improving Code Implementation}, \textit{Following Code Sytle}, \textit{Correcting Code}, \textit{Complementing Code Implementation}, \textit{Elaborating}, and \textit{Providing Context}. The results show that the main purpose of using code snippets by reviewers in code reviews is \textit{Suggestion}, which accounts for 84.5\% in total. Besides, most code snippets are provided by reviewer for the purpose of \textit{Improving Code Implementation} through code review to enhance the code quality.}}
		\end{tcolorbox}
\end{center}


\subsection{RQ3: The Developers’ Acceptance of Code Snippet Suggestions}
\label{subsec:results_of_RQ3}
% % Figure environment removed

To answer RQ3, we explored how developers treat code review comments containing code snippets for the purpose of \textit{Suggestion}, and we found that developers either accept, ignore, or do not accept code snippet suggestions. Then we investigated (1) the distribution of developers accepting, ignoring, or not accepting code snippet suggestions and (2) the acceptance rate of code snippet suggestions for the four detailed purposes of \textit{Suggestion} presented in the results of RQ2 (see Section~\ref{subsec:results_of_RQ2}).

\vspace{10pt}

\noindent\textbf{The distribution of developers accepting, ignoring, or not accepting code snippet suggestions}

The distribution of how developers treat code snippet suggestions in code reviews is shown in Fig. \ref{fig: Distribution of How Developers Treat Code Snippet Suggestions in Code Reviews}. In the OpenStack and Qt communities, we got 2,319 review comments that contain code snippets in total with the aim of \textit{Suggestion}, 1,435 of which were accepted by developers, accounting for 61.9\%. However, 13.0\% of the code snippet suggestions were just ignored by developers, who neither responded to these review comments nor made corresponding code changes. 582 code snippet suggestions were not accepted by developers, accounting for 25.1\%. In the OpenStack and Qt communities, the acceptance of code snippet comments with the aim of \textit{Suggestion} is 70.5\% and 57.9\%, respectively, with a difference of nearly 13\%. As a whole, most review comments containing code snippets for the \textit{Suggestion} purposes (more than 60\%) were accepted by developers, and about 40\% of code snippet suggestions were ignored or not accepted. This finding suggests that code snippets can serve as an effective way when reviewers provide suggestions for developers in code reviews.

% Figure environment removed

% Figure environment removed

\vspace{10pt}

\noindent\textbf{The acceptance rate of code snippet suggestions for four detailed purposes of \textit{Suggestion}}

We further investigated the acceptance rate of four detailed \textit{Suggestion} purposes as presented in Fig. \ref{fig: Acceptance rate of code snippets in code reviews for four detailed purposes of Suggestion}. Overall, the result shows that the acceptance rate of \textit{Following Code Style} 75.4\% is the highest, while the acceptance rate of \textit{Improving Code Implementation} 57.9\% is the lowest. Besides, the acceptance rates of \textit{Correcting Code} and \textit{Complementing Code Implementation} are very close, with a minor difference 0.7\% between them. 
% The acceptance rates in total of \textit{Following Code Style}, \textit{Correcting Code}, and \textit{Complementing Code Implementation} are similar to our previous work \citep{fu2022understanding}, which highly verify the effectiveness of our results. The acceptance rate in total of \textit{Improving Code Implementation} is lower than the rate of our previous work \citep{fu2022understanding}. One of the reasons may be that we included two projects from Qt community, while our previous work only included projects from the OpenStack community. The review comment data come from different source may cause the different acceptance rate of \textbf{Improving Code Implementation}.


\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ3 Summary:} 
            In general, most review comments that contain code snippets with the aim of \textit{Suggestion} are accepted by developers (61.9\%). Among the four detailed \textit{Suggestion} purposes, the acceptance rate of \textit{Following Code Style} is the highest, while the acceptance rate of \textit{Improving Code Implementation} is the lowest.}}
		\end{tcolorbox}
\end{center}


\subsection{RQ4: The Reasons that Developers do not Accept Code Snippet Suggestions}
\label{subsec:results_of_RQ4}
According to the results of RQ3, there are 582 code snippet suggestions made by reviewers were not accepted by developers. To answer RQ4, we further analyzed these not accepted code snippet suggestions through the discussions between developers and reviewers. Based on the contextual information around the review comments, we identified the reasons why developers do not accept the code snippet suggestions as listed in Table \ref{The reasons that developers do not accept code snippet suggestions in code reviews}.
\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts and percentages of the reasons that developers do not accept code snippet suggestions in code reviews}
\label{The reasons that developers do not accept code snippet suggestions in code reviews}
\begin{tabular}{lm{1.5cm}<{\centering}m{1.5cm}<{\centering}}
\hline
\textbf{Reason}                                               & \textbf{Count}    & \textbf{Percentage}\\ \hline
Difference in the opinions between developers and reviewers   & 135               & 31.0\%       \\ 
Reviewer's suggestion is flawed                               & 106               & 24.3\%       \\ 
Adopt other proposed suggestion                               & 69                & 15.8\%       \\
Consider as an optional suggestion                            & 41                & 9.4\%        \\ 
Consider as a future plan                                     & 35                & 8.0\%        \\ 
Need to be discussed                                          & 15                & 3.4\%        \\ 
Avoid extra code complexity                                   & 10                & 2.3\%        \\ 
Improve code readability                                      & 9                 & 2.1\%        \\ 
Developer removed the relevant code                           & 9                 & 2.1\%        \\ 
Keep code consistency                                         & 5                 & 1.1\%        \\ 
Conflict with other patch                                     & 2                 & 0.5\%         \\ \hline       
\end{tabular} 
\end{table}

Many developers did not clarify the reasons behind their non-acceptance of code snippet suggestions. Out of the 582 unaccepted code snippet suggestions, 146 were not accepted due to unknown reasons. Of the remaining 436 unaccepted code snippet suggestions, \textit{difference in the opinions between developers and reviewers} (31.0\%) and \textit{reviewer's suggestion is flawed} (24.3\%) are the two main causes for the non-acceptance of the code snippet suggestions. Since the differences in coding preferences, coding ability, software development experience, and understanding of current code changes, developers may hold different opinions against reviewers' code snippet suggestions. For example, in the following review comment developers thought that changing the code according to the reviewer's suggestion was unworthy, and he decided to keep the current code and rejected the reviewers' suggestion.

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/hb2m6} \\
    \textbf{Reviewer:} ``Suggestion: add a method to remove the version to the Import (moti- vation: shorter, this fix might be needed elsewhere). So then this would be shortened to: [code snippet]''\\
    \textbf{Developer:} ``Import currently has no non-const methods so let’s keep it that way... Could use reference here, too, but the minimal perf gain from that in literally meaningless here, so not worth changing.''
\end{qoutebox}

Another main reason for developers not accepting reviewers' code snippet suggestions is \textit{reviewer's suggestion is flawed}. Sometimes, reviewers miss the context and provide unsuitable solutions to current code change (see the example below), or reviewers proposed code snippets that have syntax or logical errors. Therefore, developers pointed out the mistakes in the code snippet suggestions, and rejected the suggestions.

% reviewers should carefully evaluate the code quality before they make code snippet suggestions.

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/6kb4v} \\
    \textbf{Reviewer:} ``Could we use this on L401? [code snippet]''\\
    \textbf{Developer:} ``Why? image\_chunks is intentionally initialized here so it does not get filled in L381-392 (via the glance API call)''\\
    \textbf{Reviewer:} ``Yeah apologies I somehow missed that.''
\end{qoutebox}

Some code snippet suggestions were rejected by developers because developers \textit{adopted other proposed solutions}. The adopted solutions may come from other reviewers, or from the developers themselves. Some other code snippet suggestions were \textit{considered as an optional suggestion} which are not necessary to follow or \textit{considered as a future plan} which were not accepted now but might be accepted in the follow-up patchsets. One other reason for developers' non-acceptance of code snippet suggestions is that developers thought that the suggestions \textit{need to be discussed}, and they believed that it is still open for discussion whether modifying the current code according to reviewers' code snippet suggestions. For the reasons to \textit{avoid extra code complexity} and \textit{improve code readability}, developers do not accept reviewers' code snippet suggestions as shown in the following examples.

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/qnnou} \\
    \textbf{Reviewer:} ``type hints? Note that you can avoid circular imports with something like e.g. 'nova.network.neutron.API' by doing the following: [code snippet]''\\
    \textbf{Developer:} ``Note that I don’t want to be reluctant to adding type hints here, but I think we are adding extra code complexity for an unnecessary need...''
\end{qoutebox}

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/cbrvr} \\
    \textbf{Reviewer:} ``NIT (just a possibly stupid suggestion): [code snippet]''\\
    \textbf{Developer:} ``I will keep as-is now for readability. These methods have a long name so doing 1 liners with them makes the indentation fun.''
\end{qoutebox}

In some review comments, \textit{developers removed the relevant code} so they did not accept reviewers' code snippet suggestions:

\begin{qoutebox}{white}{}
    \textbf{Link:} \url{http://alturl.com/gu5cn} \\
    \textbf{Reviewer:} ``by the way whil i like the operator module if this is all you are using it for i would just do [code snippet]''\\
    \textbf{Developer:} ``Again, just code motion, this is actually dropped in the follow up series by [URL].''
\end{qoutebox}

To \textit{keep code consistency} and following reviewers' suggestions will \textit{conflict with other patch} are the least mentioned reasons by developers, accounting for 1.1\% and 0.5\% respectively.

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ4 Summary:} We identified 11 categories of reasons why developers do not accept reviewers' code snippet suggestions, among which \textit{difference in the opinions between developers and reviewers} and \textit{reviewer's suggestion is flawed} are the two main reasons.}} %Sometimes, developers \textbf{adopt other proposed suggestions} so they do not accept reviewers' code snippet suggestions.}}
		\end{tcolorbox}
\end{center}


\subsection{RQ5: The Scenarios in which Reviewers Provide Code Snippets}
\label{subsec:results_of_RQ5}
A total of 36 participants (61.0\%) answered the open-ended question (SQ4) to provide the scenarios of using code snippets in code reviews. Table \ref{Feedback on scenarios in which reviewers often provided code snippets in code reviews} presents the 11 scenarios in which reviewers provide code snippets when conducting code review collected from the feedback of industrial developers.
\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts of the scenarios in which reviewers provide code snippets in code reviews}
\label{Feedback on scenarios in which reviewers often provided code snippets in code reviews}
\begin{tabular}{lm{1.5cm}<{\centering}}
\hline
\textbf{Scenario}                                     & \textbf{Count} \\ \hline
When code is more illustrative than words             & 27         \\ 
Current code is suboptimal                            & 9          \\ 
Advise developers not to deviate from code style      & 5          \\ 
Provide standard code snippet examples                & 5          \\
Show algorithms, standard libraries, or tools         & 3          \\ 
Guide new contributors                                & 2          \\
Avoid potential communication issues                  & 2          \\ 
Help developers know the target code elements         & 2          \\ 
Elaborate the impact of code changes on user behavior & 1          \\ 
Ask about the relationship between code snippets      & 1          \\ 
Refer to another code example                         & 1          \\ \hline       
\end{tabular}
\end{table}

Most participants expressed that they would like to provide code snippets in review comments \textit{when code is more illustrative than words} (27/36, 75.0\%). For example, when a large block of code has logical errors, it is easier to describe the errors by using code snippets rather than words. As one participant stated ``\textit{I think code snippets can be clearer than describing the fix/improvement suggestion in some situations}''. Many participants thought that using code snippets is a quicker, easier, and unambiguous way to express their opinions or suggestions, for example, one participant mentioned that ``\textit{Many times, presenting a piece of code works better than explaining it for hours, and the programmer quickly understands what to do}''. Some other participants believed that using code snippets could help developers evaluate the suggestions made by reviewers, as one response wrote that ``\textit{It also makes it very easy to evaluate the suggestion by the developer}''. According to the responses we got from industrial practitioners, we found that providing code snippets in review comments is an effective way for reviewers to make suggestions or explain their opinions.

Nine of the participants mentioned that when \textit{current code is suboptimal} (e.g., when current code ``\textit{is unnecessarily complex or hard to follow}''), they would provide code snippets to help developers improve code quality. Five participants said that they would using code snippets to \textit{advise developers not to deviate from code style}. For example, one participant wrote that ``\textit{It is very important that all team members use the same style code. I usually advise everyone not to deviate from this style code}''. Besides, five other participants mentioned that they would \textit{provide standard code snippet examples} to ``\textit{help developers better understand the suggestions in code review comments}''.

Three participants said that they would use code snippets to \textit{show algorithms, standard libraries, or tools} for developers. One of the three participants described the process in detail, ``\textit{I wonder if the programmer has implemented the function himself instead of using the standard library. In these cases, only writing is not enough, and for better understanding, a sample code should also be written in the review. With an example, it can be said that the standard library can be used in this way and the programmer’s time can be saved in this way}''. Moreover, two participants indicated that ``\textit{when a difficult issue arises}'' and the new contributors ``\textit{are not entirely able to identify why the tests are not passing}'', they would provide code snippets in review comments to \textit{guide new contributors}. Two other participants said that they would consider using code snippets in code reviews to \textit{avoid potential communication issues}, which can accelerate the process of problem solving.

Some participants indicated that they would provide code snippets in code reviews when there is a need to \textit{help developers know the target code elements}, \textit{elaborate the impact of code changes on user behavior}, \textit{ask about the relationship between code snippets}, and \textit{refer to another code example}. These scenarios are similar to the cases of providing code snippets with the purpose of \textit{Elaborating} or \textit{Providing Context} in the results of RQ2 (see Section~\ref{subsubsec: results_of_RQ2}).

%In general, the knowledge and practices of the scenarios in which reviewers provide code snippets shown in Table \ref{Feedback on scenarios in which reviewers often provided code snippets in code reviews} can help reviewers (especially inexperienced reviewers) to understand the usage of code snippets in code reviews, and consequently provide code snippets in similar scenarios to facilitate the code review process.

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ5 Summary:} Among the 63 responses from industrial practitioners, 34 participants gave the scenarios in which reviewers provide code snippets in code reviews. Based on the responses, we identified 11 categories of scenarios, among which over 80\% participants mentioned that they would use code snippets in review comments \textit{when code is more illustrate than words}.
            % In this context, providing code snippets is an effective way to communicate. Besides, some participants would use code snippets in code reviews when \textbf{current code is suboptimal}.
            }}
		\end{tcolorbox}
\end{center}

\subsection{RQ6: The Developers' Attitudes towards Code Snippets}
\label{subsec:results_of_RQ6}
The attitudes of the industrial practitioners towards provided code snippets in code reviews is shown in Fig.~\ref{fig: Industrial developers' attitudes towards provided code snippets in code reviews}. Out of the 63 responses, 46 participants (73.0\%) expressed positive attitudes, thinking that review comments containing code snippets are a good thing. This result to some extent confirms the intuition that code snippets are more intuitive and persuasive for the communication between developers and reviewers. Besides, 13 participants held a neutral attitude towards provided code snippets, and they did not care whether review comments contain code snippets. 
% Out of the 63 responses, a total of 59 (46 + 13 = 59) are positive or neutral about review comments' code snippets, which indicates that code snippets provided in code reviews are not ostracized by developers. 
Only one participant mentioned that using code snippets ``\textit{is not beneficial for someone else to solve an individual’s problems for him or her}'', and is negative about provided code snippets in code reviews.

% Figure environment removed

Three participants filled in the ``Other'' field to answer the survey question. One of them commented, ``\textit{It depends, if it makes the review process faster, good. If it’s somebody telling you ‘you should be doing something else’ then bad}'', while another participant stated that ``\textit{Generally positive, as long as it facilitates communication}''. The attitudes of these two participants towards provided code snippets in review comments depend on whether the code snippets are good for the code review process. If providing code snippets can facilitate code review, they would hold a positive attitude. Otherwise, they would be negative. One other participant mentioned that ``\textit{I’d normally consider it to be a problem if there were things in the review that could be solved by code snippets}''. At the same time, this participant wrote that the members of their development team were experienced, and they had work in software industry for 6$\sim$40 years, so they had few needs for code snippets in code reviews.

\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ6 Summary:} For provided code snippets by reviewers in code reviews, most developers (73.0\%) hold a positive attitude. Besides, some developers' attitudes towards provided code snippets in review comments depend on whether these code snippets are beneficial to the review process. If the code snippets are conducive, the developers will be positive about them.}}
		\end{tcolorbox}
\end{center}

\subsection{RQ7: The Characteristics of Code Snippets Developers Expect Reviewers to Provide}
\label{subsec:results_of_RQ7}
Out of the 63 participants, 38 participants (60.3\%) provided valid answers to the open-ended question (SQ6). Table \ref{Feedback on characteristics of code snippets that developers expect reviewers to provide in code review} shows the 11 categories of characteristics of code snippets that developers expect reviewers to provide in review comments.

\begin{table}[htbp]
\renewcommand\arraystretch{1.5}
\centering
\caption{Counts of the characteristics of code snippets that developers expect reviewers to provide in code reviews}
\label{Feedback on characteristics of code snippets that developers expect reviewers to provide in code review}
\begin{tabular}{m{3.3cm}m{6.8cm}m{0.8cm}<{\centering}}
\hline
\textbf{Characteristic}         & \textbf{Example}                                                                          & \textbf{Count} \\ \hline
Concise                          & \textit{What I'm looking for is really a code snippet that details an issue or suggestion as concisely as possible}                                                                                                                                              & 20         \\ 
Correct                          & \textit{The provided code snippet has correct syntax}                                   & 12         \\ 
Executable                       & \textit{It should preferably be complete (enable copy\&paste)}                          & 11         \\
Highlighting the point           & \textit{Simple and straight to the point}                                               & 8          \\ 
Easy to understand               & \textit{Pseudocode to help others understand my idea}                                   & 6          \\ 
Readable                         & \textit{Easy to read and properly interpreted}                                          & 4          \\ 
Fitting into the existing code   & \textit{Generally simple examples which can be fit into the existing code with ease}    & 4          \\ 
Providing a better solution      & \textit{Sample code that can provide a better solution}                                 & 3          \\ 
With detailed context            & \textit{Provided code needs to be contextualized or commented in detail}                & 1          \\ 
Scenario-specific                & \textit{Scenario-specific code snippets}                                                & 1          \\ 
Functional                       & \textit{The code snippets should be fully functional}                                   & 1          \\ \hline       
\end{tabular} 
\end{table}

From Table \ref{Feedback on characteristics of code snippets that developers expect reviewers to provide in code review}, we can find that \textit{Concise}, \textit{Correct}, and \textit{Executable} are the major characteristics developers want most in provided code snippets. In particular, most developers expect to read \textit{Concise} code snippets, and they hope that the code snippets should not be too complex. As one participant stated, ``\textit{In my opinion, the desired code should be as simple as possible. In this way, the programmer can quickly understand what to do, away from the sidelines}''. Twelve participants indicated that provided code snippets should be \textit{Correct} (e.g., having correct syntax, compilable, and reliable). Another eleven participants wrote that they wanted the code snippets to be \textit{Executable}, and one potential reason is that \textit{Executable} code snippets could save the time and effort of developers, as one participant mentioned ``\textit{Preferably be possible to copy \& paste directly as a replacement to the commented code}''.

Eight participants stated that provided code snippets should \textit{Highlight the point}. For example, one participant responded that ``\textit{The code snippets should demonstrate the point. I am not looking for someone else to write the code for me, but rather highlight a correction or an alternative}''. One other participant also mentioned that he would accept pseudocode as long as it could show the flow (``\textit{Having pseudocode showing the flow they would like is fine}''). Six participants expected that code snippets in review comments are \textit{Easy to understand} and the code snippets ``\textit{should not create more confusion}''. 

In addition to the above characteristics, developers also mentioned other characteristics they expect reviewers to provide, including \textit{Readable}, \textit{Fitting into the existing code}, \textit{Providing a better solution}, \textit{With detailed context}, \textit{Scenario-specific}, and \textit{Functional}. We also found that few participants did not care about the characteristics of code snippets in code reviews, and they just wanted reviewers to provide code snippets that could promote the code review process, as one participant wrote ``\textit{I have no preferences for this: I trust reviewers to use code snippets where this is the most effective way to communicate their review comment}''.


\noindent\begin{center}
		\begin{tcolorbox}[colback=black!5, colframe=black!20, width=1.0\linewidth, arc=1mm, auto outer arc, boxrule=1.5pt]                       
            {{\textbf{RQ7 Summary:} We identified 11 types of characteristics of code snippets that developers expect reviewers to provide in code reviews, and we found that most developers expect provided code snippets in code reviews to be \textit{Concise}, \textit{Correct}, and \textit{Executable}.}}
		\end{tcolorbox}
\end{center}
