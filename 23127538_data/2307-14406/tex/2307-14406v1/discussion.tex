\section{Discussion}
\label{sec:discussion}
In this work, we studied the practices of providing code snippets in code reviews by mining and analyzing the code review data from four open-source projects of the OpenStack and Qt communities. We then conducted an industrial survey to collect feedback from practitioners, which helped us to understand the usage of code snippets in code reviews from a practitioners' perspective. In this section, we discuss the implications of our study results for both researchers and practitioners.

\subsection{Implications for Researchers}
\label{subsec: Implications for researchers}
\subsubsection{Novel Insights for Researchers}
% \textbf{Provide researchers with novel insights into how code snippets meet information needs and facilitate effective communication in code reviews:}

\textbf{The purposes of providing code snippets in code reviews:} 
%As the first work that combines both an exploratory study and an industrial survey to explore the extent of using code snippets, the purposes of providing code snippets, and how developers treat code snippets suggestions in code reviews, we obtain knowledge related to code snippets in code reviews, and such knowledge can give novel insights to researchers. 
% There are a number of works that specifically focus on the information needs in the code review process. \cite{wang2021understanding} explored the purposes of shared links in code reviews, and they identified 7 common purposes, i.e., Providing Context, Elaborating, Clarifying, Explaining Necessity, Proposing Improvement, Suggesting Experts, and Informing Splitted Patches. 
To answer RQ2, we proposed a category of reviewers' purposes of providing code snippets in code reviews. The identified purposes indicate that code snippets can be used by reviewers to convey necessary information in the code review process, and providing code snippets can be an important and intuitive way to meet the information needs in code review in addition to automatic change summarization \citep{pascarella2018information} and shared links \citep{wang2021understanding}. 
% Due to the different nature of code snippets and shared links, the purposes of providing them in code reviews have some differences. According to the study results, we find that code snippets and shared links both can be provided by reviewers in code reviews with the aim of \textit{Improving Code Implementation}, \textit{Providing Context}, and \textit{Elaborating}. 
% However, different to automatic change summarization and shared links, code snippets can be used by reviewers to advise developers on other aspects of the code that are more relevant to the code submissions. 
However, different from automatic change summarization and shared links, code snippets can be provided by reviewers to offer guidance to developers specifically concerning the code itself, rather than the contextual information of the code. For example, reviewers may point out issues related to code style or logic errors in current code, and they will provide code snippets in review comments to offer developers solutions to these issues, thereby enhancing code quality (e.g., code readability and maintainability). The main purpose of reviewers providing code snippets in code reviews is \textit{Improving Code Implementation} (54.4\%). However, according to the results of RQ3, developers' acceptance rate of code snippet suggestions with the aim of \textit{Improving Code Implementation} is the lowest among the four detailed purposes of \textit{Suggestion}, which may be caused by developers and reviewers holding different opinions about code optimization, thus making \textit{difference in the opinions between developers and reviewers} the most common reason why developers do not accept code snippet suggestions in code reviews. Sometimes, reviewers' code snippet suggestions of \textit{Improving Code Implementation} may \textit{bring extra code complexity}, \textit{reduce code readability}, or \textit{decrease code consistency}, which become the reasons that developers do not accept code snippet suggestions in code reviews. Besides, the acceptance rate of other three detailed \textit{Suggestion} purposes, i.e., \textit{Following Code Style}, \textit{Correcting Code}, and \textit{Complementing Code Implementation} are almost the same, all around 70\%. This finding indicates that developers and reviewers are inclined to reach an agreement on code style, code correctness, and code integrity. 
% When reviewers have suggestions on these issues, they can provide code snippets in review comments to give developers their opinions on the current code as there is a high probability of having the same ideas between reviewers and developers.
% \cite{wang2021understanding} found that \textit{Providing Context} and \textit{Elaborating} are the most common purposes of sharing links in code reviews, while our study results show that these two purposes belong to \textit{Citation} category are the least common ones of providing code snippets in code reviews, which indicates that code snippets are not often provided by reviewers to give developers indirect information by citing related code. On the contrary, \textit{Suggestion} is the main purpose of reviewers providing code snippets in code reviews, showing that developers tend to use strongly correlated code snippets in code reviews to give developers suggestions on modifying the current code. The distinct focus of purposes reveals that code snippets and shared links place varying emphasis on the information they convey during code review, making them complementary ways to meet the information needs of both reviewers and developers in the code review process.

\textbf{Code snippets can serve as an effective way for communication during code review:} \cite{gonalves2023competencies} have focused on the competencies developers need to execute code review, and their study results call for more research on how to support and develop reviewers' potential to communicate effectively during code review. Our study results show that code snippets can be used to improve the effectiveness of communication between reviewers and developers. For example, most survey participants thought that in some scenarios code snippets provide a more illustrative, concise, and easily understandable way to point out issues and convey needed information. Besides, some survey participants indicated that if the provided code snippets could facilitate the communication during code review, they would hold positive attitudes towards the provided code snippets. These findings show that code snippets are an effective way to support the communication in code review. Besides, our study results and findings can serve as practical guidelines for reviewers to use code snippets appropriately and provide better code snippets in code review comments, which can consequently facilitate the code review process from a communication perspective. 


\subsubsection{Future Directions for Researchers}

Our study highlights promising research directions in code review. The results of RQ2 provide six detailed purposes of reviewers providing code snippets in code reviews. However, we did not explore the purposes of developers providing code snippets in code reviews, which could be different from the purposes of reviewers and can be studied and compared in the future. In the code review process, developers also need to provide information to meet reviewers' needs. If this information is readily available, reviewers can focus on verifying and improving the code they are reviewing, rather than spending time and effort on collecting missing information \citep{pascarella2018information}.
% Such knowledge can serve as a valuable complement to our study results, and can help reviewers focus on verifying and improving the reviewed code rather than collecting necessary information but missing. 
The results of RQ3 present the acceptance rate of code snippet suggestions. Our study results show that most suggestions are accepted by developers (61.9\%), which provide an empirical basis for future studies to explore whether and how the inclusion of code snippets in reviewers' code review suggestions has an impact on developers' acceptance of the reviewers' suggestions.


\subsection{Implications for Practitioners}
\label{subsec: Implications for practitioners}

\subsubsection{Suggestions for Software Development Teams}
According to the results of RQ2, \textit{Following Code Style} is one of the main purposes that reviewers provide code snippets in review comments. This finding indicates that developers may be unfamiliar with the coding style or code conventions used in the projects. According to the results of RQ3, the acceptance rate of \textit{Following Code Style} is the highest among the four detailed \textit{Suggestion} purposes, which implies that suggestions with the aim of \textit{Following Code Style} are the suggestions on which developers and reviewers can easily reach a consensus. Development team leaders should actively guide developers, particularly those contributing to open-source projects, to adapt to the coding style of the projects, as one developer wrote in the questionnaire, ``\textit{It is very important that all team members use the same style code}''. Besides, automation tools that examine whether the source code follows the project's code conventions can also be highly beneficial for software development. These measures can significantly reduce reviewers' workload on commenting code style issues and accelerate the code review process to some extent. Moreover, according to the results of RQ4 we found that reviewers' suggestions \textit{considered as a future plan} is one of the reasons for developers' non-acceptance of code snippet suggestions. Therefore, it is meaningful for development teams to record these suggestions (e.g., in a to-do list) for easy tracking and inspection of these suggestions in the future. According to the results of RQ6, most developers show positive attitudes towards provided code snippets in review comments. We suggest that development teams should encourage reviewers to provide code snippets in code reviews for developers \textit{when code is more illustrative than words} according to the results of RQ5. 

\subsubsection{Suggestions for Code Reviewers}
In the code review process, when reviewers want to advise developers to make code changes or cite related code to supplement necessary information, they can use code snippets in review comments to achieve their goals. According to the results of RQ5, reviewers provide code snippets especially on scenarios in which they want to make suggestions related to code quality improvement (e.g., when \textit{current code is suboptimal}). Sometimes developers reject reviewers' code snippet suggestions since provided code snippets will increase code complexity or have syntax or logic errors. We then suggest that reviewers should consider the correctness of code snippets to be provided in the context in order to better assist developers in solving their issues and avoiding creating new issues. Moreover, the results of RQ5 (the scenarios in which reviewers provide code snippets) and RQ7 (the characteristics of code snippets developers expect) can guide reviewers to provide code snippets in code reviews appropriately. When reviewers encounter similar scenarios as we identified in RQ5, they can provide code snippets to complete the code reviews. The majority of developers want the provided code snippets are \textit{Concise}, \textit{Correct}, and \textit{Executable}, which are the key characteristics that reviewers should pay attention when providing code snippets in code reviews. Besides, code snippets provided by reviewers should \textit{highlight the point}, which can help developers to understand reviewers' opinions and thus accelerate the communication between them during code review.
