%%%%%
%%%%% File name  : packagesandcommands.tex
%%%%% Author     : Mario Chan
%%%%% Date       : 13th December, 2021 (original: 04th November, 2020)
%%%%% Description: This file collects the packages used and commands
%%%%%              defined in the project "Injectivity-Fujino".
%%%%%
%%
%%%

\usepackage[french,ngerman,english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% \usepackage{CJKutf8} %%%%% for the use of Chinese, use the
                       %%%%% environment
                       %%%%% \begin{CJK}{UTF8}{bkai} % or {bsmi}
                       %%%%% \end{CJK}

\usepackage[all]{xy}
\renewcommand{\objectstyle}{\displaystyle}

\usepackage{enumitem}
\usepackage{mathtools}  
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{calc} %% for doing length computations

\babeltags{de = ngerman}
\babeltags{fr = french}

\usepackage{upref}  %% for uprighting texts generated by \ref
\usepackage{embrac} %% for uprighting parentheses in \emph and
                    %% providing \embparen for the same effect in
                    %% theorem environments (which use {\itshape ...}
                    %% or {\em ...})

\usepackage[
% show-mario,  %% show editing notes or comments on margin when
             %% uncommented
% no-commands %% avoid loading commands in mariostdcommands.tex when uncommented
]{marionotations}
% \input{mariostdcommands} %% load mariostdcommands.tex separately
                           %% when uncommented (must put "no-commands"
                           %% in the package option of marionotations
                           %% in that case);

\usepackage[normalem]{ulem} %% used only in review report

\usepackage{bbm}     %% to use \mathbbm (like \mathbb but works also
                     %%                  for natural numbers)

\usepackage[Smaller]{cancel} %%%%% for crossing out argument in math mode via
                             %%%%% the  use of \cancelto 
\renewcommand{\CancelColor}{\color{Gray}}

\usepackage{breakurl}  %% used so that line breaks for contents in
                       %% \url{...} are possible when processed by
                       %% LaTeX instead of pdfLaTeX (e.g. arXiv.org) 

\usepackage{subfiles}

%%%%% Commands for this document %%%%%
\newcommand{\defaultDimension}{n}
\newcommand{\setDefaultDimension}[1]{\renewcommand{\defaultDimension}{#1}}

\newcommand{\defaultAmbientSpace}{X}
\newcommand{\setDefaultAmbientSpace}[1]{\renewcommand{\defaultAmbientSpace}{#1}}

\newcommand{\defaultlcIndex}{\sigma}
\newcommand{\setDefaultlcIndex}[1]{\renewcommand{\defaultlcIndex}{#1}}

\newcommand{\defaultcohDegree}{q}
\newcommand{\setDefaultcohDegree}[1]{\renewcommand{\defaultcohDegree}{#1}}

\newcommand{\defaultlclocus}{D}
\newcommand{\setDefaultlclocus}[1]{\renewcommand{\defaultlclocus}{#1}}

\newcommand{\defaultvphi}{\vphi_F}
\newcommand{\setDefaultvphi}[1]{\renewcommand{\defaultvphi}{#1}}

\newcommand{\defaultpsi}{\psi_D}
\newcommand{\setDefaultpsi}[1]{\renewcommand{\defaultpsi}{#1}}

\newcommand{\defaultMetric}{\omega}
\newcommand{\setDefaultMetric}[1]{\renewcommand{\defaultMetric}{#1}}


% The delimiters for the arguments are carefully chosen so that they
% are consistent among most of the commands (in particular for the
% commands for generating the symbols for the ideal sheaves and
% residue sheaves), namely,
%     <X>        for base space,
%     (S)        for lc locus,
%     |\sigma|   for lc index,
%     {\vphi}    for potential,
%     [\psi]     for $\psi$ function,
%     .{m_k}     for jumping number,
%     +{1}       for increment of lc index (by $1$),
%     -{1}       for decrement of lc index (by $1$).
%     /q/        for anti-holomorphic degree (or hol. and anti-hol. degrees)

\newcommand{\alert}[2][RoyalBlue]{{\color{#1}#2}}

\NewDocumentCommand{\logKX}{
  t{M} %% #1 include M in the tensor product if present
  o    %% #2 replace F \otimes M by the argument when provided
}{K_X \otimes D \otimes \IfNoValueTF{#2}{F \IfBooleanT{#1}{\otimes M}}{#2}}

% \NewDocumentCommand{\vphilist}{
%   D||{\vphi}           %% #1 potentials
%   t{F}                 %% #2 turn potential to "\vphi_F" if present
%   t{M}                 %% #3 add "+\vphi_M" if present
%   d()                  %% #4 extra metric for the (1,0)-forms
%   D<>{\defaultMetric}  %% #5 metric on the ambient space
% }{\IfBooleanTF{#2}{\vphi_F}{#1} \IfBooleanT{#3}{+\vphi_M}, \IfNoValueF{#4}{(#4),} #5}

\NewDocumentCommand{\Ltwo}{ %% the space of L2 sections 
  D//{\bullet,\bullet}      %% #1 the order of forms
  D<>{\defaultAmbientSpace} %% #2 base space
  s                         %% #3 base space is hidden if * is present
  m                         %% #4 coefficient
}{L^{#1}_{(2)}\paren{\IfBooleanF{#3}{#2;} #4}}

% \NewDocumentCommand{\Ltwosp}{
%   t{'}                    %% #1 no preassigned holomorphic degree if present
%   D//{\defaultcohDegree}  %% #2 anti-holomorphic degree
%   t{M}                    %% #3 include M in the coefficient if present
%   o                       %% #4 replace F \otimes M by the argument if provided
%   G{\defaultvphi}         %% #5 potential on line bundle
%   e{_}                    %% #6 metric on the base space or other subscripts
% }{\Ltwo/\IfBooleanF{#1}{\defaultDimension,}#2/*{D \otimes \IfNoValueTF{#4}{F \IfBooleanT{#3}{\otimes M}}{#4}}_{#5 \IfNoValueF{#6}{,#6}}}


%\def\mH{\mathcal{H}}
% \NewDocumentCommand{\Harm}{ %% the space of harmonic forms
%   O{q}
% }{\mathcal{H}^{n,#1}}
\NewDocumentCommand{\Harm}{ %% the space of harmonic forms
  t{'}                      %% #1 no preassigned hol degree if present
  D//{\defaultcohDegree}    %% #2 anti-holomorphic degree
  D<>{\defaultAmbientSpace} %% #3 the base space
  g                         %% #4 the coefficient; will be hidden
                            %%    together with the base space if not provided
  t{,}                      %% #5 separator
  G{\defaultvphi}           %% #6 potential on line bundle
  e{_}                      %% #7 metric on the base space or other subscripts
}{\mathcal{H}^{\IfBooleanF{#1}{\defaultDimension,}#2}\IfNoValueF{#4}{\paren{#3;#4}}_{#6 \IfNoValueF{#7}{,#7}}}


\NewDocumentCommand{\lcIndex}{ %% for displaying the lc index,
                               %% intended to be used internally
  m  %% #1 the basic lc index (\sigma)
  m  %% #2 amount added to the index
  m  %% #3 amount substracted from the index
}{#1\IfNoValueF{#2}{+#2}\IfNoValueF{#3}{-#3}}

\NewDocumentCommand{\lcData}{ %% for displaying lc data in the format
                              %% like "(\vphi_L ; m_k . \psi)"
  G{\defaultvphi}  %% #1 potential or q-psh function
  O{\defaultpsi}   %% #2 lc locus psi function
  e{.}             %% #3 jumping number
}{\paren{#1; \IfNoValueF{#3}{#3 \cdot} #2}}

\NewDocumentCommand{\lcdata}{ %% for displaying lc data in the
                              %% format like "(X,\vphi_L,\psi,m_k)"
  s                %% #1 no parentheses if starred 
  d<>              %% #2 base space
  G{\defaultvphi}  %% #3 potential or q-psh function
  O{\defaultpsi}   %% #4 lc locus psi function
  e{.,}            %% #5 jumping number
                   %% #6 extra components
}{\newcommand{\datalist}{\IfNoValueF{#2}{#2,}#3,#4\IfNoValueF{#5}{,#5}\IfNoValueF{#6}{,#6}}
\IfBooleanTF{#1}{\datalist}{\paren{\datalist}}}



\newcommand{\spHbase}{\mathbb{H}}
\NewDocumentCommand{\spH}{ %% cohomology group with coefficients 
                           %% K_X +F +D \otimes the given sheaf
  D//{\defaultcohDegree}  %% #1 degree of anti-hol form
  t{M}                    %% #2 with 'M' to display M in the %% coefficient
  m                       %% #3 
}{\spHbase^{#1}\paren{\IfBooleanT{#2}{M\otimes}#3}}
% \NewDocumentCommand{\spH}{ %% cohomology group with coefficients 
%                            %% vanishing on \lcc[\sigma]
%   D//{\defaultcohDegree}  %% #1 degree of anti-hol form
%   t{M}                    %% #2 with 'M' to display M in the coefficient
%   s                       %% #3 star for turning to the mlc adjoint ideal sheaf
%   D||{\defaultlcIndex}    %% #4 codim of the lcc defined by the upper ideal
%   t{.}                    %% #5 with '.' to display a quotient ideal
%   D||{#4 -1}              %% #6 codim of the lcc defined by the lower ideal
%   d()                     %% #7 the sheaf replacing the ideal sheaf if non-empty
% }{\spHbase^{#1}\IfNoValueTF{#7}{
%     \begingroup%
%     \newcommand{\upidl}{\IfBooleanTF{#3}{
%         \mtidlof{\vphi_{F \IfBooleanT{#2}{\otimes M}}}
%       }{\aidlof|#4|{\vphi_{F \IfBooleanT{#2}{\otimes M}}}}
%     }% 
%     \paren{\IfBooleanT{#2}{M\otimes}
%       \IfBooleanTF{#5}{
%         \frac{\upidl}{\aidlof|#6|{\vphi_{F \IfBooleanT{#2}{\otimes M}}}}
%       }{\upidl}}
%     \endgroup%
%   }{\paren{\IfBooleanT{#2}{M\otimes}#7}}}


\DeclareMathOperator{\lc}{lc} %% lc centre
\NewDocumentCommand{\lcc}{ %% union of lc centres
                           %% of codimension \sigma
                           %% of (X,D) %%
  D||{\defaultlcIndex}       %% #1 lc index \sigma
  e{+-}                      %% #2,#3
  D<>{\defaultAmbientSpace}  %% #4 base space
  t{'}                       %% #5 '-ed to show lc locus instead of
                             %%    lc data pair
  D(){\defaultlclocus}       %% #6 lc locus 
}{\lc_{#4}^{\lcIndex{#1}{#2}{#3}}\IfBooleanTF{#5}{\paren{#6}}{\lcData}}

\NewDocumentCommand{\lcS}{  %% a local lc centre
  s                       %% #1 symbol with \rs when starred
  D(){\defaultlclocus}    %% #2 symbol for the subvariety
  D||{\defaultlcIndex}    %% #3 codimension
  e{+-}                   %% #4,#5
  d<>                     %% #6 open set where the lc centre lives
  O{p}                    %% #7 index among the \sigma-lc centres
}{\mathtt{\IfBooleanT{#1}{\rs} #2}^{\lcIndex{#3}{#4}{#5}}_{\IfNoValueF{#6}{#6,}#7}}

\NewDocumentCommand{\PRes}{ %% Poincare Residue map
  O{}      %% subvariety
  d()      %% forms from the domain
}{\mathcal R_{#1}\IfNoValueF{#2}{\paren{#2}}}

\NewDocumentCommand{\HRes}{ %% Harmonic residue
  d()   %% #1 harmonic form
}{\mathfrak{R}\IfNoValueF{#1}{\paren{#1}}}

\newcommand{\defidlof}[1]{\mathcal{I}_{#1}}  %% defining ideal of (a set)
\NewDocumentCommand{\mtidlof}{   %% multiplier ideal of (a potential)
  O{}      %% #1 base space (for compatibility)
  D<>{#1}  %% #2 base space
  m        %% #3 potential / psh function
}{\multidl_{#2}\paren{#3}} 

% \NewDocumentCommand{\presidlof}{  %% multiplier ideal sheaf on the sum of
%                                   %% \sigma-lc centres
%   D||{\sigma}   %% codim of lc centres or supporting lc locus
%   m             %% potential or q-psh function
% }{\rs{\sheaf R}_{#1}\paren{#2}}

\NewDocumentCommand{\residlof}{  %% multiplier ideal sheaf on the
                                 %% union of \sigma-lc centres
  D||{\defaultlcIndex}   %% #1 codim of lc centres or supporting lc
                         %%    locus
  e{+-}                  %% #2,#3
  d<>                    %% #4 base space
  s                      %% #5 display the symbol without arguments when starred
  %%% input to \lcData
  % G{\defaultvphi}      %% #6 potential or q-psh function
  % O{\defaultpsi}       %% #7 lc locus psi function
  % e{.}                 %% #8 jumping number  
}{\sheaf R_{\IfNoValueTF{#4}{}{#4,} \lcIndex{#1}{#2}{#3}}\IfBooleanF{#5}{\lcData}}


\NewDocumentCommand{\Adjidlof}{
  D||{\defaultlcIndex}       %% #1 codim of lc centres under concern
  D<>{\defaultAmbientSpace}  %% #2 base space
  D(){\defaultlclocus}       %% #3 lc locus
  m                          %% #4 potential or ideal
}{\operatorname{\mathit{Adj}}^{#1}_{\paren{#2,#3}}\paren{#4}}


\NewDocumentCommand{\aidlof}{
  D||{\defaultlcIndex}   %% #1 codim of lc centres under concern
  e{+-}                  %% #2,#3
  d<>                    %% #4 base space
  s                      %% #5 display the symbol without arguments when starred
  %%% input to \lcData
  % G{\defaultvphi}        %% #6 potential or ideal
  % O{\defaultpsi}         %% #7 defining function of the lc locus
  % e{.}                   %% #8 jumping number
}{\sheaf{J}_{\!\IfNoValueTF{#4}{}{#4,} \lcIndex{#1}{#2}{#3}}\IfBooleanF{#5}{\lcData}}

\NewDocumentCommand{\faidlof}{
  D||{\defaultlcIndex}   %% #1 codim of lc centres in numerator
  e{+-}                  %% #2,#3
  t{/}                   %% #4 a separator for arguments
  D||{\defaultlcIndex}   %% #5 codim of lc centres in denominator
  e{+-}                  %% #6,#7
  % d<>                    %% #8 base space
  % s                      %% #9 display the symbol without arguments when starred
  %%% input to \lcData
  % G{\defaultvphi}        %% #10 potential or ideal
  % O{\defaultpsi}         %% #11 defining function of the lc locus
  % e{.}                   %% #12 jumping number
}{\fracAidlof{\lcIndex{#1}{#2}{#3}}{\lcIndex{#5}{#6}{#7}}}

\NewDocumentCommand{\fracAidlof}{
  m                  %% #1 lcIndex in numerator
  m                  %% #2 lcIndex in denominator
  d<>                %% #3 base space
  s                  %% #4 display the symbol without arguments when starred
  G{\defaultvphi}    %% #5 potential or ideal
  O{\defaultpsi}     %% #6 defining function of the lc locus
  e{.}               %% #7 jumping number
}{\frac{
    \aidlof|#1|<#3>*\IfBooleanF{#4}{\lcData{#5}[#6].{#7}}
  }{
    \aidlof|#2|<#3>*\IfBooleanF{#4}{\lcData{#5}[#6].{#7}}
  }}


\NewDocumentCommand{\lcV}{ %% measure on lc centres
  D||{\defaultlcIndex}    %% #1 codim of supporting lc centres
  D//{\defaultvphi}       %% #2 potential for bundle valued section
  d()                     %% #3 metric on the ambient space
  e{^}                    %% #4 jumping number
  O{\defaultpsi}          %% #5 defining function (potential) of subvariety 
}{\:d\operatorname{lcv}^{#1\IfNoValueF{#4}{,\paren{#4}}}_{\IfNoValueF{#3}{#3,}#2}\left[#5\right]}

\NewDocumentCommand{\Ohvol}{ %% Ohsawa measure %%
  D//{\defaultvphi} %% #1 potential for bundle valued section
  d()               %% #2 metric on the ambient space
  O{\defaultpsi}    %% #3 defining function of subvariety
}{\dvol_{\IfNoValueF{#2}{#2,}#1}\left[#3\right]} 


\newcommand{\dvol}{\:d\vol}


\NewDocumentCommand{\lcDataNormSubscript}{
  %% for displaying lc data in the format
  %% like "X, \vphi_L , m_k.\psi, \sigma", which is mainly used for
  %% subscript in a norm
  d<>                   %% #1 base space
  s                     %% #2 no potential and psi function when starred
  G{\defaultvphi}       %% #3 potential or q-psh function
  O{\defaultpsi}        %% #4 lc locus psi function
  e{.}                  %% #5 jumping number
  D||{\defaultlcIndex}  %% #6 lc Index
  e{+-}                 %% #7,#8
}{\IfNoValueF{#1}{#1,}
  \IfBooleanF{#2}{#3, \IfNoValueF{#5}{#5 \cdot} #4,}
  \lcIndex{#6}{#7}{#8}}


\newcommand{\RTFsym}{\mathfrak{F}} 
\NewDocumentCommand{\RTF}{ %% residue transform function
  s          %% #1 adding \smash[t] when starred
  G{\RTFsym} %% #2 symbol body
  o          %% #3 general superscript
  >{\SplitArgument{1}{,}} d<> %% #4 superscript in inner product
  d||        %% #5 superscript in \abs{}^2
  D(){\eps}  %% #6 for adding variable (\eps)
  t{,}       %% #7 separator
}{%
  \begingroup%
    \newif\ifsmasht%
    \IfBooleanTF{#1}{\smashttrue}{\smashtfalse}%
    \newif\ifboolup%
    \booluptrue%
    \IfNoValueT{#3}{\IfNoValueT{#4}{\IfNoValueT{#5}{\boolupfalse}}}%
    \newcommand{\supsrptstr}{\IfNoValueF{#3}{#3}\IfNoValueF{#4}{\inner#4}\IfNoValueF{#5}{\abs{#5}^2}}
    \newcommand{\RTFvar}{#6}
    #2\RTFprocess
}

\NewDocumentCommand{\RTFprocess}{
  o                     %% #1 overwrite subscript if given
  d<>                   %% #2 base space
  t{,}                  %% #3 with potential and psi function when ,-ed
  G{\defaultvphi}       %% #4 potential or q-psh function
  O{\defaultpsi}        %% #5 lc locus psi function
  e{.}                  %% #6 jumping number
  D||{\defaultlcIndex}  %% #7 lc Index
  e{+-}                 %% #8,#9
}{\newcommand{\subsrptstr}{%
    \IfNoValueTF{#1}{
    \IfNoValueF{#2}{#2,}
    \IfBooleanT{#3}{#4,#5,\IfNoValueF{#6}{#6,}}
    \lcIndex{#7}{#8}{#9}}{#1}}%
  \newcommand{\srptstr}{\cramped{{}^{\supsrptstr}%
      \ifboolup _
      \fi{\ifboolup\displaystyle\fi\paren{\RTFvar}%
          \ifboolup {\scriptstyle \subsrptstr} \else _{\subsrptstr} \fi%
        }}}%
  \ifboolup%
    \ifsmasht%
      \smash[t]{
        \raisebox{\depthof{$\srptstr$} * \real{0.3}}{$\srptstr$}%
      }%
    \else%
      \raisebox{\depthof{$\srptstr$} * \real{0.3}}{$\srptstr$}%
    \fi%
  \else%
    \srptstr%
  \fi%
  \endgroup%
}
% \NewDocumentCommand{\RTF}{ %% residue transform function
%   s          %% #1 adding \smash[t] when starred
%   G{\RTFsym} %% #2 symbol body
%   d//        %% #3 for adding superscript k for k-RTF
%   o          %% #4 general superscript
%   >{\SplitArgument{1}{,}} d<> %% #5 superscript in inner product
%   d||        %% #6 superscript in \abs{}^2
%   d()        %% #7 for adding variable (\eps)
%   o          %% #8 subscript for the codimension \sigma
% }{%
%   \begingroup%
%     \newif\ifboolup%
%     \booluptrue%
%     \IfNoValueT{#4}{\IfNoValueT{#5}{\IfNoValueT{#6}{\boolupfalse}}}%
%     \IfNoValueT{#7}{\boolupfalse}%
%     \newcommand{\srptstr}{\cramped{{}^{\IfNoValueF{#4}{#4}\IfNoValueF{#5}{\inner#5}\IfNoValueF{#6}{\abs{#6}^2}}%
%       \ifboolup _
%       \fi{\ifboolup\displaystyle\fi\IfNoValueF{#7}{\paren{#7}}\IfNoValueF{#8}{%
%           \ifboolup {\scriptstyle #8} \else _{#8} \fi%
%         }}}}%
%     \ifboolup%
%       \IfBooleanTF{#1}{
%         \smash[t]{
%           \IfNoValueF{#3}{{}^{#3}}#2\raisebox{\depthof{$\srptstr$} * \real{0.3}}{$\srptstr$}%
%         }%
%       }{\IfNoValueF{#3}{{}^{#3}}#2\raisebox{\depthof{$\srptstr$} * \real{0.3}}{$\srptstr$}}%
%     \else%
%       \IfNoValueF{#3}{{}^{#3}}#2\srptstr%
%     \fi%
%   \endgroup%
% } 

\def\RTI{\RTF{\mathfrak{I}}}


\NewDocumentCommand{\mtlog}{O{e} d() D||{\defaultpsi}}{\log\!#1^{\paren{#2}}\abs{#3}}
\NewDocumentCommand{\slog}{O{e} D||{\defaultpsi}}{\log\abs{#1 #2}}
\NewDocumentCommand{\dlog}{O{e} D||{\defaultpsi}}{\mtlog[#1](2)|#2|}


\NewDocumentCommand{\logpole}{ %% log-pole in the residue transform
                               %% function
  D||{\defaultpsi}       %% #1 log singularity defining function
  D//{\defaultlcIndex}   %% #2 codim of lc centres in question
  E{.^}{{e}{1+\eps}}     %% #3 multiplicative constant in logarithm 
                         %% #4 exponent in the log-psi term
  s                      %% #5 no parentheses and exponent on log|\psi| when starred
}{\abs{#1}^{#2} \IfBooleanTF{#5}{\slog[#3]|#1|}{\paren{\slog[#3]|#1|}^{#4}}}

\DeclareFontFamily{OMX}{MnSymbolE}{}
\DeclareSymbolFont{MnLargeSymbols}{OMX}{MnSymbolE}{m}{n}
\SetSymbolFont{MnLargeSymbols}{bold}{OMX}{MnSymbolE}{b}{n}
\DeclareFontShape{OMX}{MnSymbolE}{m}{n}{
    <-6>  MnSymbolE5
   <6-7>  MnSymbolE6
   <7-8>  MnSymbolE7
   <8-9>  MnSymbolE8
   <9-10> MnSymbolE9
  <10-12> MnSymbolE10
  <12->   MnSymbolE12
}{}
\DeclareFontShape{OMX}{MnSymbolE}{b}{n}{
    <-6>  MnSymbolE-Bold5
   <6-7>  MnSymbolE-Bold6
   <7-8>  MnSymbolE-Bold7
   <8-9>  MnSymbolE-Bold8
   <9-10> MnSymbolE-Bold9
  <10-12> MnSymbolE-Bold10
  <12->   MnSymbolE-Bold12
}{}
\DeclareMathDelimiter{\llangle}{\mathopen}%
{MnLargeSymbols}{'164}{MnLargeSymbols}{'164}
\DeclareMathDelimiter{\rrangle}{\mathclose}%
{MnLargeSymbols}{'171}{MnLargeSymbols}{'171}


\newcommand{\iinner}[2]{\left\llangle#1,#2\right\rrangle}
\newcommand{\eqcls}[1]{\left[#1\right]}


\NewDocumentCommand{\idxup}{ %% operator for raising indices via a
                             %% hermitian metric on X
  m                  %% #1 the differential form whose indices to be raised
  O{\defaultMetric}  %% #2 the hermitian metric on X
  t{,}               %% #3 separator
  o                  %% #4 extra superscripts
  s                  %% #5 smash the vertical spacing on the top of the metric if present
  t{.}               %% #6 with contraction operator \ctrt if '.'-ed
}{\paren{#1}^{
    % \mathrlap{
    \!\IfBooleanTF{#5}{\smash[t]{#2}}{#2}\IfNoValueF{#4}{, #4}
    % }
    % \makebox[\maxof{\widthof{$#2$}-\widthof{$\!\omega$}}{0pt}]{}
  }\IfBooleanT{#6}{\!\!\ctrt}}
% \NewDocumentCommand{\idxup}{ %% operator for raising indices via a
%                              %% hermitian metric on X
%   m                  %% #1 the differential form whose indices to be raised
%   O{*}               %% #2 the hermitian metric on X
%   s                  %% #3 smash the vertical spacing on the top of the metric if present
% }{\paren{#1}^{
%     \!\IfBooleanTF{#3}{\smash[t]{#2}}{#2}
%     % \makebox[\maxof{\widthof{$\scriptstyle #2$}-\widthof{$\!\omega$}}{0pt}]{}
%   }
% }

\newcommand{\dbadj}{\dbar^{\smash{\mathrlap{*}\;\:}}}


\NewDocumentCommand{\dep}{t{;} d<> O{\nu} m}{#4\IfBooleanTF{#1}{_}{^}{\IfNoValueF{#2}{#2\:}(#3)}}

\NewDocumentCommand{\sm}{s m}{{#2}\IfBooleanTF{#1}{_}{^}\text{sm}}

\newcommand{\tlog}{{\text{log}}}


\NewDocumentCommand{\idx}{ %% multi-indices
  O{i} %% #1 symbol of the indices
  m    %% #2 starting subscript
  o    %% #3 additional stuff to add before \dotsm
  t{.} %% #4 display "\dotsm" if '.'-ed
  t{,} %% #5 display ",\dots," if ','-ed
  o    %% #6 additional stuff to add after \dotsm
  m    %% #7 ending subscript
}{{#1}_{#2} \IfNoValueF{#3}{#3}
  \IfBooleanT{#4}{\dotsm} \IfBooleanT{#5}{,\dots,}
  \IfNoValueF{#6}{#6} {#1}_{#7}}



\newcommand{\charfct}{\mathbbm 1}


\newcommand{\cvr}[1]{\mathfrak{#1}} %% set of covering subsets
% \newcommand{\rs}[1]{\widetilde{#1}} %% putting ~ on objects on the
%                                     %% log-resolution %%
\NewDocumentCommand{\rs}{ %% putting ~ on objects on the
                          %% log-resolution %%
  s  %% when * is given, \smash[t] is applied
  m  %% the main object 
}{\IfBooleanTF{#1}{\smash[t]{\widetilde{#2}}}{\widetilde{#2}}}

% \NewDocumentCommand{\clt}{m}{\widetilde{#1}} %% element in complete space
% \NewDocumentCommand{\clomega}{O{\omega}}{{\clt{#1}}} %% complete metric

\newcommand{\BK}{\text{(BK)}}
\newcommand{\tBK}{\text{(tBK)}}
\DeclareMathOperator{\Ann}{Ann}  %% Annihilator 
\DeclareMathOperator{\mlc}{mlc} %% minimal lc centre
\DeclareMathOperator{\sym}{sym} %% symmetric polynomial
\newcommand{\Diff}{\operatorname{Diff}^*} %% general different (adjunction formula)

\newcommand{\sect}[1][s]{\mathtt{#1}} %% canonical section
\newcommand{\bphi}{\boldsymbol{\vphi}}
\newcommand{\bphip}[1][p]{\res\bphi_{#1}} %% retract-extension of
                                          %% \bphi from lc centre
                                          %% S^\sigam_p
\newcommand{\btau}{\boldsymbol{\tau}}
\newcommand{\shfP}{\sheaf P}  %% polar ideal sheaf
\NewDocumentCommand{\cbn}{  %% group of combinations
  D//{\defaultlcIndex_V}
  D||{\defaultlcIndex}
}{\mathfrak{C}^{#1}_{#2}} 
\NewDocumentCommand{\Iset}{  %% index set for lc centres on log-resolution
  D||{\defaultlcIndex}    %% #1
  e{+-}                   %% #2,#3
  O{\defaultlclocus}      %% #4
  d()                     %% #5 open set on which the index set is valid
}{I^{\lcIndex{#1}{#2}{#3}}_{#4}\IfNoValueF{#5}{\paren{#5}}} 
% }{I^{#1\IfNoValueF{#2}{+#2}\IfNoValueF{#3}{-#3}}_{#4}\IfNoValueF{#5}{\paren{#5}}} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifcsname defineNoThmInMarionotations\endcsname
  \relax
\else 

  \newtheorem{THMprop}{Proposition}[subsection]
  \newtheorem{THMlemma}[THMprop]{Lemma}
  \newtheorem{THMthm}[THMprop]{Theorem}
  \newtheorem{THMcor}[THMprop]{Corollary}
  % \newtheorem{SNCassumption}[THMprop]{Snc assumption}
  % \newtheorem{SNCassumptionx}{Snc assumption}
  % \renewcommand{\theSNCassumptionx}{\theSNCassumption${}^*$}

  % \newtheorem{definition-thm}[THMprop]{Definition-Theorem}

  \newtheorem{THMconjecture}[THMprop]{Conjecture}
  \newtheorem*{THMclaim}{Claim}

  \def\makeparenletter{\catcode`\(=11 \catcode`\)=11 }
  \def\makeparenother{\catcode`\(=12 \catcode`\)=12 }
  \def\makeparenactive{\catcode`\(=\active\catcode`\)=\active}

  \makeparenactive
  \NewDocumentEnvironment{textupparenenvir}{}{
    %%%%% This code may cause error when parentheses appear in places
    %%%%% where macro is not accepted, like \ref{...} or optional
    %%%%% arguments of enumerate. 
    % \catcode1=12
    % \catcode2=12
    % \mathcode1=\the\mathcode`\(
    % \delcode1=\the\delcode`\(
    % \mathcode2=\the\mathcode`\)
    % \delcode2=\the\delcode`\)

    % \begingroup
    % \lccode`\~=`\^^A
    % \lowercase{\endgroup
    % \everymath\expandafter{\the\everymath\let(^^28\let)^^29}
    % \everydisplay\expandafter{\the\everydisplay\let(^^28\let)^^29}
    % }

    \everymath\expandafter{\makeparenother}
    \everydisplay\expandafter{\makeparenother}

    \def({\textup{\char`\(}}
    \def){\textup{\char`\)}}

    \makeparenactive
    % \let\zzzlabel\label
    % \let\zzzref\ref
    % \let\zzznewlabel\newlabel

    % \def\label{\makeparenletter\wwwlabel}
    % \def\ref{\makeparenletter\wwwref}
    % \def\newlabel{\makeparenletter\wwwnewlabel}

    % \def\wwwlabel#1{\makeparenactive\zzzlabel{#1}}
    % \def\wwwref#1{\makeparenactive\zzzref{#1}}
    % \def\wwwnewlabel#1{\makeparenactive\zzznewlabel{#1}}
  }{\makeparenother}
  \makeparenother

  \NewDocumentEnvironment{prop}{ +o }{
    \IfNoValueTF{#1}{\begin{THMprop}}{\begin{THMprop}[{#1}]}
      \begin{textupparenenvir}
  }{
      \end{textupparenenvir}
    \end{THMprop}
  }

  \NewDocumentEnvironment{lemma}{ +o }{
    \IfNoValueTF{#1}{\begin{THMlemma}}{\begin{THMlemma}[{#1}]}
      \begin{textupparenenvir}
  }{
      \end{textupparenenvir}
    \end{THMlemma}
  }

  \NewDocumentEnvironment{thm}{ +o }{
    \IfNoValueTF{#1}{\begin{THMthm}}{\begin{THMthm}[{#1}]}
      \begin{textupparenenvir}
  }{
      \end{textupparenenvir}
    \end{THMthm}
  }

  \NewDocumentEnvironment{cor}{ +o }{
    \IfNoValueTF{#1}{\begin{THMcor}}{\begin{THMcor}[{#1}]}
      \begin{textupparenenvir}
  }{
      \end{textupparenenvir}
    \end{THMcor}
  }

  \NewDocumentEnvironment{conjecture}{ +o }{
    \IfNoValueTF{#1}{\begin{THMconjecture}}{\begin{THMconjecture}[{#1}]}
      \begin{textupparenenvir}
  }{
      \end{textupparenenvir}
    \end{THMconjecture}
  }

  \NewDocumentEnvironment{claim}{ +o }{
    \IfNoValueTF{#1}{\begin{THMclaim}}{\begin{THMclaim}[{#1}]}
      \begin{textupparenenvir}
  }{
      \end{textupparenenvir}
    \end{THMclaim}
  }

  \theoremstyle{remark}
  \newtheorem{remark}[THMprop]{Remark}

  \theoremstyle{definition}
  \newtheorem{definition}[THMprop]{Definition}
  \newtheorem{example}[THMprop]{Example}
  \newtheorem{notation}[THMprop]{Notation}

  \numberwithin{equation}{subsection}
  \renewcommand{\theequation}{eq$\,$\thesubsection.\arabic{equation}}


  
\fi

\allowdisplaybreaks  %% allow multi-line equations to spread across
                     %% pages 



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "Injectivity-Fujino"
%%% End:
