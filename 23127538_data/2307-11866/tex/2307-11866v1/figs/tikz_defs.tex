\pgfdeclarelayer{bg0}
\pgfdeclarelayer{bg1}
\pgfdeclarelayer{bg2}
\pgfdeclarelayer{bg3}
\pgfdeclarelayer{foreground}
\pgfsetlayers{bg0,bg1,bg2,bg3,main,foreground}
% colors
\definecolor{lightblue}{HTML}{B1DDF0}
\definecolor{lightorange}{HTML}{FFE6CC}
\definecolor{lightred}{HTML}{FAD9D5}
\definecolor{lightgreen}{HTML}{B9E0A5}

\tikzset{
    title/.style={font=\fontsize{10pt}{10pt}\color{black!90}\bfseries,anchor=center,text centered,align=center},
    outerbox/.style={rectangle, draw=black!80, rounded corners,line width=.9pt, minimum size=0.5cm, minimum width=1cm,minimum height=2cm},
    box/.style={rectangle,font=\fontsize{10pt}{10pt}\color{black!90}\bfseries, draw=black!80, line width=.9, fill=white!100, line width=.5pt, minimum size=1cm, minimum width=2.5cm,minimum height=.5cm},
    dot/.style = {circle, fill, minimum size=3pt, inner sep=0pt, outer sep=0pt},
    fp/.style={rectangle,font=\fontsize{10pt}{10pt}\color{black!90}\bfseries, draw=black!80, line width=.9, fill=lightgreen, line width=.5pt, minimum size=1cm, minimum height=1cm, minimum width=1cm,align=center},
}

\newcommand{\plothdots}[1]{
    \node (dt#1) [dot] [below=.1cm and 0cm of #1] {};
    \node (dt1#1) [dot] [below=.1cm and 0cm of dt#1] {};
    \node (dt2#1) [dot] [below=.1cm and 0cm of dt1#1] {};
}

\newcommand{\plotvdots}[1]{
    \node (dt#1) [dot] [right=0cm and 0.6cm of #1] {};
    \node (dt1#1) [dot] [right=0cm and .2cm of dt#1] {};
    \node (dt2#1) [dot] [right=0cm and .2cm of dt1#1] {};
}

\newcommand{\block}[5]{
    \node (blk#1) [title] [#4] {Block #5};
    \node (pg1#1) [box,fill=gray!15] [below=.15cm and 0cm of blk#1] {Page 1};
    \node (pg2#1) [box,fill=gray!15] [below=-0.5pt and 0cm of pg1#1] {Page 2};
    \node (dt#1) [dot] [below=.1cm and 0cm of pg2#1] {};
    \node (dt1#1) [dot] [below=.1cm and 0cm of dt#1] {};
    \node (dt2#1) [dot] [below=.1cm and 0cm of dt1#1] {};
    \node (pgn#1) [box,fill=gray!15] [below=.1cm and 0cm of dt2#1] {Page $n$};
    \begin{pgfonlayer}{bg3}
        \node (#2) [outerbox,rounded corners=0,fill=lightorange] [fit=(blk#1) (pg1#1) (pg2#1) (dt#1) (dt1#1) (dt2#1) (pgn#1),#3] {};
    \end{pgfonlayer}
}

\newcommand{\plane}[2]{
    \block{0p#1}{blkbox0p#1}{}{}{0}
    \plothdots{blkbox0p#1}
    \block{mp#1}{blkboxmp#1}{below=0.1cm and 0cm of dt2blkbox0p#1}{below=0.1cm and 0cm of dt2blkbox0p#1}{$m$}
    \node (titlep#1) [title] [above=0.4cm and 0cm of blk0p#1]{Plane #1};
    \node (drp#1) [box,fill=lightblue] [below=.2cm and 0cm of blkboxmp#1] {Data Register};
    \node (crp#1) [box,fill=lightred] [below=.15cm and 0cm of drp#1] {Cache Register};
    \begin{pgfonlayer}{bg2}
        \node (p#2) [outerbox,fill=lightgreen] [fit=(titlep#1) (blkbox0p#1) (blkboxmp#1) (drp#1) (crp#1)] {};
    \end{pgfonlayer}
}
