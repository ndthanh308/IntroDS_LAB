% % Figure environment removed

\input{figs/version_tracker}

We keep track of active range queries to make our data structure memory-efficient. Every time we merge or split, we physically remove deleted keys that are not required in the future. Deleted keys with a timestamp lower than the timestamp of the oldest active range query can be safely removed from a leaf node’s linked list. This is because every active range query will not include the key in their result, as the key was deleted before they started. To keep track of the times every active range query started, we built a data structure called Version Tracker.

\input{algorithm/version_tracker/remove_head}

% \input{algorithm/version_tracker/add_timestamp}

A version tracker is a list where each node records the timestamp of a range query and whether that range query has been completed or not. The structural design of the version tracker can be seen in Figure \ref{fig:version_tracker}. It is essentially a linked list where operations only occur at either end. Whenever a range query starts, its timestamp is added atomically to the tail of the version tracker. Thus the nodes in the linked list are sorted by their timestamp. Please refer to Figure \ref{alg:remHead} for more algorithmic details. 

Whenever a split or merge leaf operation begins, we fetch the timestamp of the oldest range query using the version tracker. Every key marked deleted with a timestamp lesser than the minimum timestamp fetched from the version tracker will not be included in the new nodes created due to splitting or merging. To fetch the oldest range query’s timestamp, we traverse the list from the head and remove the nodes containing finished range queries. The first unfinished node's timestamp is the minimum timestamp among active range queries. Please refer to Figure \ref{alg:remHead} for more algorithmic details.