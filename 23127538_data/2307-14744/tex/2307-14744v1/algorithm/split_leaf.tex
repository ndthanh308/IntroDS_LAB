\begin{algorithm}[H]
\label{splitleaf}
\caption{\texttt{splitLeaf}(prevNode,\ prevIdx,\ currNode,\ currIdx)}
$\textup{Node* } leftChild :=$ \texttt{new leafNode()}\;
$\textup{Node* } rightChild :=$ \texttt{new leafNode()}\;
$leftChild \rightarrow next := rightChild$ \; \label{alg19:line237}
$rightChild \rightarrow next := next$ \;
Split \textit{\textbf{this}} node into a pair of nodes pointed to by $leftChild$ and $rightChild$\;
\label{alg19:line233}
\If{\textup{!}$\ newNext$.\texttt{\textup{CAS}}($nullptr,\ leftChild$)}{
    \label{alg19:line234}
    $leftChild := newNext$\;
    $rightChild := leftChild \rightarrow next$\;
}

$\textup{Node* } newNode :=$ \texttt{new internalNode()}\;
Copy elements from $currNode$ to $newNode$ replacing $currChild$ with the two pointers $leftChild$ and $rightChild$\; \label{alg19:line239}
\If{$prevNode =$ \textup{\texttt{nullptr}}}
{
    \textbf{if} \textup{!}$\,root$.\texttt{CAS}($currNode,\ newNode$) \textbf{then} \textbf{return} \texttt{nullptr}\; \label{alg19:line241}
}
\textbf{else if} (!$\,prevNode \rightarrow ptr[prevIdx]$.\texttt{CAS}($currNode,\ newNode$) \textbf{then} \textbf{return} \texttt{nullptr}\; \label{alg19:line242}
\textbf{return} $newNode$\;
\end{algorithm}