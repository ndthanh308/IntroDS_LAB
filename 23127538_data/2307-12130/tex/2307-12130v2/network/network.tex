% https://github.com/HarisIqbal88/PlotNeuralNet
\documentclass[border=8pt, multi, tikz]{standalone}
%\usepackage{blocks}
\usepackage{import}
\subimport{layers/}{init}
\usetikzlibrary{positioning}
\usetikzlibrary{3d} %for including external image 

\def\ConvColor{rgb:yellow,5;red,2.5;white,5}
\def\TColor{rgb:magenta,1}
\def\SkipColor{rgb:blue,1}
\def\ReluColor{rgb:red,10}
\def\ConvReluColor{rgb:yellow,5;red,5;white,5}
\def\PoolColor{rgb:green,1}
\def\UnpoolColor{rgb:cyan,1}
\def\FcColor{rgb:blue,5;red,2.5;white,5}
\def\FcReluColor{rgb:blue,5;red,5;white,4}
\def\SoftmaxColor{rgb:magenta,5;black,7}

\newcommand{\nChannels}{$\delta$}
\newcommand{\nLevels}{$\alpha$}

\newcommand{\copymidarrow}{\tikz \draw[-Stealth,line width =0.8mm,draw={rgb:blue,4;red,1;green,1;black,3}] (-0.3,0) -- ++(0.3,0);}

\begin{document}
\begin{tikzpicture}
\tikzstyle{connection}=[ultra thick,every node/.style={sloped,allow upside down},draw=\edgecolor,opacity=0.7]
\tikzstyle{connDash}=[ultra thick,dashed,draw=\edgecolor,opacity=1.0]
\tikzstyle{copyconnection}=[ultra thick,every node/.style={sloped,allow upside down},draw={rgb:blue,4;red,1;green,1;black,3},opacity=0.7]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Draw Encoder
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node[canvas is zy plane at x=0] (temp) at (-2,0,0) {% Figure removed};

%%%%%%
% skips
\pic[shift={(0,0,0)}] at (0,0,0) {RightBandedBox={name=sk1,xlabel={{"\nChannels","\nChannels"}},
    fill=\SkipColor,bandfill=none,opacity=1.0,height=42,width=2,depth=40}};
\pic[shift={(0,0,0)}] at (sk1-east) {RightBandedBox={name=skr1,%
    fill=\ReluColor,,bandfill=none,opacity=1.0,height=42,width=1,depth=40}};
\pic[shift={(0,0,0)}] at (skr1-east) {RightBandedBox={name=sk2, caption=Encoder,%
    fill=\SkipColor,bandfill=none,opacity=1.0,height=42,width=2,depth=40}};
\pic[shift={(0,0,0)}] at (sk2-east) {RightBandedBox={name=skr2,%
    xlabel={{"\nChannels","\nChannels"}},zlabel=I,fill=\ReluColor,,bandfill=none,opacity=1.0,height=42,width=1,depth=40}};

% conv1_1,conv1_2
\pic[shift={(1,0,0)}] at (skr2-east) {RightBandedBox={name=cr11,%
        xlabel={{"\nChannels","\nChannels"}},fill=\ConvColor,bandfill=\ReluColor,%
        opacity=1.0,height=40,width=2,depth=40}};
\pic[shift={(0,0,0)}] at (cr11-east) {RightBandedBox={name=cr12,%
        xlabel={{"\nChannels","\nChannels"}}, zlabel=I,fill=\ConvColor,bandfill=\ConvColor,%
        opacity=1.0,height=40,width=2,depth=40}};
        
%pool1
\pic[shift={(0,0,0)}] at (cr12-east) {Box={name=p1,%
        fill=\PoolColor,opacity=0.8,height=32,width=1,depth=32}};


% conv2_1,conv2_2
\pic[shift={(1,0,0)}] at (p1-east) {RightBandedBox={name=cr21,%
        xlabel={{"2\nChannels","2\nChannels"}},fill=\ConvColor,bandfill=\ReluColor,%
        opacity=1.0,height=32,width=3.5,depth=32}};
\pic[shift={(0,0,0)}] at (cr21-east) {RightBandedBox={name=cr22,%
        xlabel={{"2\nChannels","2\nChannels"}}, zlabel=I/2,fill=\ConvColor,bandfill=\ConvColor,%
        opacity=1.0,height=32,width=3.5,depth=32}};
        
%pool2
\pic[shift={(0,0,0)}] at (cr22-east) {Box={name=p2,%
        fill=\PoolColor,opacity=0.8,height=25,width=1,depth=25}};
        

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Bottleneck
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\pic[shift={(3,0,0)}] at (p2-east) {RightBandedBox={name=t5, fill=\TColor,opacity=1.0,bandfill=none,height=8,width=1,depth=8}};
\pic[shift={(0,0,0)}] at (t5-east) {RightBandedBox={name=cr51,%
        xlabel={{"\nLevels\nChannels","\nLevels\nChannels"}},fill=\ConvColor,bandfill=\ReluColor,%
        opacity=1.0,height=8,width=8,depth=8}};
\pic[shift={(0,0,0)}] at (cr51-east) {RightBandedBox={name=cr52,%
        xlabel={{"\nLevels\nChannels","\nLevels\nChannels"}}, fill=\ConvColor,bandfill=\ConvColor,%
        opacity=1.0,height=8,width=8,depth=8}};
        
% unpool5
\pic[shift={(0,0,0)}] at (cr52-east) {Box={name=up5,zlabel=I/\nLevels,
        fill=\UnpoolColor,opacity=1.0,height=8,width=1,depth=8}};
        
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Labels
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\pic[shift={(1,-7,0)}] at (p1-east) {RightBandedBox={name=labelConv, caption=$T_{C}$, fill=\TColor,opacity=1.0,bandfill=none,height=4,width=0.5,depth=4}};
\pic[shift={(2,0,0)}] at (labelConv-east) {RightBandedBox={name=labelConv, caption=3x3 Conv, fill=\ConvColor,opacity=1.0,bandfill=none,height=4,width=0.5,depth=4}};
\pic[shift={(2,0,0)}] at (labelConv-east) {RightBandedBox={name=labelConv, caption=1x1 Conv, fill=\SkipColor,opacity=1.0,bandfill=none,height=4,width=0.5,depth=4}};
\pic[shift={(2,0,0)}] at (labelConv-east) {RightBandedBox={name=labelConv, caption=Act., fill=\ReluColor,opacity=1.0,bandfill=none,height=4,width=0.5,depth=4}};
\pic[shift={(2,0,0)}] at (labelConv-east) {RightBandedBox={name=labelConv, caption=Pooling, fill=\PoolColor,opacity=1.0,bandfill=none,height=4,width=0.5,depth=4}};
\pic[shift={(2,0,0)}] at (labelConv-east) {RightBandedBox={name=labelConv,  caption=Upsample, fill=\UnpoolColor,opacity=1.0,bandfill=none,height=4,width=0.5,depth=4}};

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Draw Decoder 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% unpool2, 
\pic[shift={(3,0,0)}] at (up5-east) {RightBandedBox={name=t2, fill=\TColor,opacity=1.0,bandfill=none,height=32,width=1,depth=32}};
\pic[shift={(0,0,0)}] at (t2-east) {RightBandedBox={name=cat21,%
        xlabel={{"2\nChannels","2\nChannels"}},fill=\ConvColor,bandfill=\ReluColor,%
        opacity=1.0,height=32,width=3.5,depth=32}};
\pic[shift={(0,0,0)}] at (cat21-east) {RightBandedBox={name=cat22,%
        xlabel={{"2\nChannels","2\nChannels"}}, fill=\ConvColor,bandfill=\ConvColor,%
        opacity=1.0,height=32,width=3.5,depth=32}};
\pic[shift={(0,0,0)}] at (cat22-east) {Box={name=up2,zlabel=I/2,
    fill=\UnpoolColor,opacity=1.0,height=32,width=1,depth=32}};

%%%%%%%%%%
%% unpool1, 
\pic[shift={(1,0,0)}] at (up2-east) {RightBandedBox={name=t1, fill=\TColor,opacity=1.0,bandfill=none,height=40,width=1,depth=40}};
\pic[shift={(0,0,0)}] at (t1-east) {RightBandedBox={name=cat11,%
        xlabel={{"\nChannels","\nChannels"}},fill=\ConvColor,bandfill=\ReluColor,%
        opacity=1.0,height=40,width=2.5,depth=40}};
\pic[shift={(0,0,0)}] at (cat11-east) {RightBandedBox={name=cat12,%
        xlabel={{"\nChannels","\nChannels"}},fill=\ConvColor,bandfill=\ConvColor,%
        opacity=1.0,height=40,width=2.5,depth=40}};
\pic[shift={(0,0,0)}] at (cat12-east) {Box={name=up1,zlabel=I,
    fill=\UnpoolColor,opacity=1.0,height=40,width=1,depth=40}};

%%%%%%%%%%
%% estimator
\pic[shift={(1,0,0)}] at (up1-east) {RightBandedBox={name=t0, fill=\TColor,opacity=1.0,bandfill=none,height=42,width=1,depth=40}};
\pic[shift={(0,0,0)}] at (t0-east) {RightBandedBox={name=est0,%
        xlabel={{"\nChannels","\nChannels"}},fill=\SkipColor,bandfill=none,%
        opacity=1.0,height=42,width=1,depth=40}};
\pic[shift={(0,0,0)}] at (est0-east) {RightBandedBox={name=est0r,caption=Decoder,%
    fill=\ReluColor,,bandfill=none,opacity=1.0,height=42,width=1,depth=40}};
\pic[shift={(0,0,0)}] at (est0r-east) {RightBandedBox={name=est1,%
        xlabel={{"\nChannels","\nChannels"}},fill=\ConvColor,bandfill=\ReluColor,%
        opacity=1.0,height=42,width=2.5,depth=40}};
\pic[shift={(0,0,0)}] at (est1-east) {RightBandedBox={name=est2,%
        xlabel={{"\nChannels","\nChannels"}}, zlabel=I,fill=\ConvColor,bandfill=\ConvColor,%
        opacity=1.0,height=42,width=2.5,depth=40}};

%%%%%%%%%%%
%%% Output
\node[canvas is zy plane at x=2] (temp1) at (est2-east) {% Figure removed};


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Draw connections
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\draw [connDash]  (p2-east)    -- node {\midarrow} (t5-west);
\draw [connDash]  (up5-east)    -- node {\midarrow} (t2-west);

\path (cr22-southeast) -- (cr22-northeast) coordinate[pos=1.25] (cr22-top) ;
\path (cr12-southeast) -- (cr12-northeast) coordinate[pos=1.25] (cr12-top) ;
\path (skr2-southeast) -- (skr2-northeast) coordinate[pos=1.25] (skr2-top) ;
\path (cr51-southeast) -- (cr51-northeast) coordinate[pos=1.25] (cr51-top) ;
\path (cr52-southeast) -- (cr52-northeast) coordinate[pos=1.25] (cr52-top) ;
\path (t5-southeast) -- (t5-northeast) coordinate[pos=1.25] (t5-top) ;
\path (est2-southeast) -- (est2-northeast) coordinate[pos=1.26] (est2-top) ;
\path (cat21-south)  -- (cat21-north)  coordinate[pos=1.25] (cat21-top)  ;
\path (cat11-south)  -- (cat11-north)  coordinate[pos=1.25] (cat11-top)  ;



\draw [copyconnection]  (skr2-northeast)  
-- node {\copymidarrow}(skr2-top)
-- node {\copymidarrow}(est2-top)
-- node {\copymidarrow} (est2-north);


\draw [copyconnection]  (cr22-northeast)  
-- node {\copymidarrow}(cr22-top)
-- node {\copymidarrow}(cat21-top)
-- node {\copymidarrow} (cat21-north);

\draw [copyconnection]  (cr12-northeast)  
-- node {\copymidarrow}(cr12-top)
-- node {\copymidarrow}(cat11-top)
-- node {\copymidarrow} (cat11-north);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{tikzpicture}
\end{document}
