\subsection{Object temperature dependence}\label{sec:method:characterization:temperatureDependency}
\noindent The camera response for a given object temperature and ambient temperature can be estimated as a polynomial for each pixel:
\begin{equation}\label{eq:supp:charactarization:simulation}
    \simulatedCameraResponse{\tamb}{\tobj}[x,y] = \sum_{m=0}^{\mGrayLevels}{\coefficientsPixelwise{m}(\tamb)[x,y]} \cdot \tobj^m[x,y]
\end{equation} where $\tobj$ is the temperature of the object, $\tamb$ is the ambient temperature of the camera, $\simulatedCameraResponse{\tamb}{\tobj}[x,y]$ is the estimated camera response, $\mGrayLevels$ is the degree of the polynomial fit, and $\coefficientsPixelwise{m}(\tamb)$ is the pixel-wise coefficient of the polynomial that depends on the ambient temperature.

Below, we outline the methods to estimate the coefficients of the camera response from measured data. In \cref{sec:method:characterization:applyToNew}, we show how these coefficients enable the synthesis of new images.

To estimate the coefficient vector $\coefficientsPixelwiseVec(\tamb)$, first the dependence of the response on ambient temperature was determined and fitted.
The dependence was determined from the \opPoint measurements by estimating the polynomial coefficients for each $\tamb$. A matrix of object temperatures at each \opPoint and a vector of camera responses is built for each $\tamb$, and the polynomial coefficients are found \emph{per pixel} using Least Squares. We denote:
\begin{align*}
    \mat{A}_O[\tamb]               & =
    \begin{bmatrix}
        \Tobj^0[1]           & \dots  & \Tobj^{\mGrayLevels}[1]           \\
        \vdots               & \ddots & \vdots                      \\
        \Tobj^0[\NumTempObj] & \dots  & \Tobj^{\mGrayLevels}[\NumTempObj]
    \end{bmatrix}_{\NumTempObj\times \mGrayLevels} \\
    \coefficientsRadiance{}[\tamb] & =
    \begin{bmatrix}
        c_0[\tamb] \\ \vdots \\ c_{\mGrayLevels}[\tamb]
    \end{bmatrix}_{\mGrayLevels\times1}                    \\
    \vec{R}[\tamb]                 & =
    \begin{bmatrix}
        R\left(\tamb,\Tobj[0]\right) \\\vdots\\R\left(\tamb,\Tobj[\NumTempObj]\right)
    \end{bmatrix}_{\NumTempObj\times1}
\end{align*} where $\vec{R}[\tamb]$ are the frames acquired by the low-cost IR camera, $\mGrayLevels$ is the degree of the polynomial to fit, and $\NumTempObj$ is the length of $\Tobj$.
Then the values of $\coefficientsRadiance{}[\tamb][x,y]$ are estimated by solving the inverse problem:
\begin{subequations}
    \begin{align}
        \vec{R}[\tamb][x,y]                 & = \mat{A}_O[\tamb] \cdot \coefficientsRadiance{}[\tamb][x,y] \label{eq:LsSolutionFPA} \rightarrow \\ 
        \coefficientsRadiance{}[\tamb][x,y] & = \mat{A}_O^{+}[\tamb]\cdot\vec{R}[\tamb][x,y] 
    \end{align}
\end{subequations}
where $\mat{A}_O^{+}$ is the Moore–Penrose inverse of $\mat{A}_O$.

A set of coefficients $\coefficientsRadiance{}\nolinebreak\in\nolinebreak\mathcal{R}^{\mGrayLevels}$ exists for each $\tamb\nolinebreak\in\nolinebreak\Tamb$. These coefficients are \textit{pixel-wise}, meaning there are $\mGrayLevels$ coefficient maps with spatial dimensions of $h\nolinebreak\times\nolinebreak w$ for $h,w$ the dimensions of each image. These coefficient maps were filtered using a Gaussian filter with $\sigma=1$ to remove high-frequency noise stemming from dead pixels in the camera.

\cref{fig:fitGl2BB} presents an example of the fitting results between the gray levels at an \opPoint an the real blackbody temperatures, as described in \cref{eq:LsSolutionFPA}. The number of coefficients was chosen empirically as $\mGrayLevels=3$. The fit provides a good estimation to the data ($R^2\geq0.99$).

% Figure environment removed

\cref{fig:coefObjTemp} is a scheme of the coefficients for a given object temperature as described in \cref{eq:LsSolutionFPA}. Each coefficient map is two-dimensional.
\input{content/suppMat/fig_radiance_from_coefs.tex}

The measurements are expected to be symmetrical around the middle of the image~\cite{Tempelhahn2016}, but practical effects can create skew. The skewing limits the usability of the model because the skewed model does not accurately depict a general symmetrical case.
% The skewing can originate for the \blackbody because the uniformity across the blackbody emitter is $\pm0.015^\circ$. Other possible sources include direct heat to a single side of the camera, imprecise position of the camera not directly perpendicular to the blackbody, optical aberrations, etc. 
The effect of the skewing on real data can be seen in \cref{fig:skew}.

% Figure environment removed%

\subsection{Spatial dependence}\label{sec:method:characterization:spatialDependency}
\noindent So far, the polynomial dependence of the camera's readings on $\tobj,\tamb$\ were found for each pixel. To overcome the skewing, the coefficients from \cref{eq:LsSolutionFPA} are fitted to a spatial function. The spatial fitting is performed separately on each set of coefficients~$\coefficientsRadiance{m},\forall m\in[0,\ldots,\mGrayLevels]$.
The spatial fitting is performed twice: for a quadratic polynomial and for a high-degree polynomial. The coefficients that have the most profound effect on the skewing are the quadratic coefficients. The ideal form of nonuniformity is expected to be axis-symmetric, and a quadratic function can be viewed as a low-frequency distortion of this symmetry. Thus, subtraction of the polynomials up to the quadratic coefficient removes the low-frequency distortion and alleviates the skew. An example of the skewing effect on real data and fitting results can be seen in \cref{fig:skew}.

Under these assumptions, we intend to find a skew-less axis-symmetric polynomial approximation of the measurements. This will be achieved by first fitting the results to a spatial function, and then fitting again to a radial function.

The first step, fitting the coefficients of the camera response to a spatial function, exploits the correlation between neighboring pixels. The spatial fitting reduces the number of coefficients considerably, from $\propto h\times s$ - the number of pixels - to $\propto\mSpatial$ - the number of coefficients in the spatial fit where $\mSpatial<<h\times w$.

To fit to a spatial function, we first define two matrices of dimensions $h\times w$. The matrices are built from vectors in the range $[-0.5,0.5]$, in $\mat{H}$ as columns and in $\mat{W}$ as rows:
$$\mat{W} = \begin{bmatrix}
        -0.5   & \ldots & 0.5    \\
        \vdots & \ddots & \vdots \\
        -0.5   & \ldots & 0.5
    \end{bmatrix}_{h,w},
    \quad \mat{H}=\mat{W}^T $$

The spatial fit is defined as:
\begin{equation} \label{eq:spatialFit}
    \coefficientsSpatialRaw[\tamb]  =\argmin_{\coefficientsSpatialRaw[\tamb]}\left(\coefficientsRadiance{m}[\tamb] - \sum_{q=0}^{\mSpatial}\sum_{z=0}^{\mSpatial}  \coefficientsSpatialRaw[\tamb][q,z]\cdot\mat{H}^{q}\cdot \mat{W}^{z}\right), \qquad\coefficientsSpatialRaw[\tamb]\in\mathcal{R}^{\mSpatial\times\mSpatial}
\end{equation} where $\mSpatial$ is the number of coefficients in the spatial fit. The powers $q,z$ are applied respectively to matrices $\mat{H},\mat{W}$ element-wise.

To reduce the skewing (\cref{fig:skew}), we define $\coefficientsSpatialSkewless$ a skew-less fit, which is the subtraction between the quadratic fit and the fine fit. We also define $\coefficientsSpatialQuadratic$ as the quadratic fit with $\mSpatial\nolinebreak=\nolinebreak2$, and $\coefficientsSpatialFine$ as the fine fit with $\mSpatial\nolinebreak>>\nolinebreak2$:
\begin{equation}\label{eq:spatialFitSubtraction}
    \coefficientsSpatialSkewless[\tamb] =
    \begin{cases}
        \text{Mean}(\coefficientsSpatialQuadratic[q,z],\coefficientsSpatialFine[q,z]), & q=z=0            \\
        \coefficientsSpatialFine[q,z]-\coefficientsSpatialQuadratic[q,z],              & \forall q,z\neq0
    \end{cases}, \qquad\coefficientsSpatialSkewless[\tamb]\in\mathcal{R}^{\mSpatial\times\mSpatial}
\end{equation}
The bias coefficient is averaged between the fits. Empirically, this is found to produce better results.

\cref{fig:spatialFitSideView} shows a horizontal cross-sectional view of \cref{fig:skew}, along with the results of the spatial fitting in \cref{eq:spatialFitSubtraction}. The cross-section of the measurements, fine fit, quadratic fit and subtraction fitting are presented. The subtraction fitting is calculated by subtracting the quadratic polynomial from the fine polynomial. The number of coefficients for the fine fit were set to $\mSpatial=15$. The final fit does indeed alleviate the skewing, while remaining faithful to the measurements.

\subsection{Axis-symmetric fitting}\label{sec:method:characterization:axisSymmetry}
\noindent To exploit the radial symmetry around the middle of the image, the spatial fit results of \cref{eq:spatialFitSubtraction} are fitted to a radial kernel. For each ambient temperature $\tamb\in\TambAsVec$ in the discrete set of measurements, there is a unique vector of radial coefficients $\coefficientsRadiiVec[\tamb]$:
\begin{subequations}\label{eq:spatialRadiiFit}
    \begin{align}
        \mat{P}                      & = \sqrt{\mat{H}^2 + \mat{W}^2},\quad\quad \mat{P}\in\mathcal{R}^{h\times w}                                                                                                                                            \\
        \coefficientsRadiiVec[\tamb] & =\argmin_{\coefficientsRadiiVec[\tamb]}\left(\sum_{q=0}^{\mSpatial}\sum_{z=0}^{\mSpatial}  \coefficientsSpatialSkewless[\tamb][q,z]\cdot\mat{H}^{q}\cdot \mat{W}^{z} - \sum_{r=0}^{\mRadial} \coefficientsRadii{r}[\tamb]\cdot\mat{P}^r\right),\qquad\coefficientsRadiiVec[\tamb]\in\mathcal{R}^{\mRadial}
    \end{align}
\end{subequations}
where $\mRadial$ is the number of coefficients in the radial fit and $\coefficientsRadii{r}\nolinebreak\in\nolinebreak\mathcal{R}^{\mRadial}$ are the radial fitting coefficients.

% The result of \cref{eq:spatialRadiiFit} should output the following approximation:
% \begin{equation}
    %     \coefficientsAmbRadiiVec(\tamb) \approx \sum_{m=0} ^{\mFPA}{\Gamma[m] \cdot \tamb^m},\qquad\coefficientsAmbRadiiVec(\tamb)\in\mathcal{R}^{\mFPA}
    % \end{equation}
    % where $\Gamma$ are the coefficients of the ambient temperature polynomial and $\mFPA$ is the degree of the polynomial.
    % Notice that the $\Gamma$ coefficients are not dependent on the spatial dimension. The approximated coefficients $\coefficientsAmbRadiiVec(\tamb)$ will be used with $\mat{P}$ the radial kernel, to approximate the spatial nonuniformity.
    
The last step in the estimation process is to express a polynomial approximation of the radial coefficients by $\tamb$; specifically, to approximate $\coefficientsRadiiVec(t)$ in the continuous range $t\in\TambAsVec$ for $\NumFPA$ the length of $\Tamb$.
We make several denotations. $\mat{A}_C$ is a matrix containing the powers of all $\tamb\in\TambAsVec$:
\begin{equation}
    \mat{A}_C =
    \begin{bmatrix}
        \Tamb^0[1]       & \cdot & \Tamb^{\mFPA}[1]       \\
        \vdots           & \cdot & \vdots                 \\
        \Tamb^0[\NumFPA] & \cdot & \Tamb^{\mFPA}[\NumFPA]
    \end{bmatrix}_{\NumFPA\times \mFPA}
\end{equation}

$\coefficientsRadiiVec\{m\}$ is a vector of the $m$th coefficient in $\coefficientsRadiiVec$ for all $\tamb\in\TambAsVec$:
\begin{equation}
    \coefficientsRadiiVec\{r\} =
    \begin{bmatrix}
        \coefficientsRadiiVec\left[\Tamb[0]\right][r] \\
        \vdots                                        \\
        \coefficientsRadiiVec\left[\Tamb[\NumFPA]\right][r]
    \end{bmatrix}_{\NumFPA\times1}
\end{equation}

$\mat{R}_{C}$ is a matrix of all the $\coefficientsRadiiVec\{r\}$:
\begin{equation}
    \mat{R}_{C} =
    \begin{bmatrix}
        \coefficientsRadiiVec\left[\Tamb[0]\right][0] & \hdots & \coefficientsRadiiVec\left[\Tamb[0]\right][\mRadial] \\
        \vdots           & \ddots & \vdots                  \\
        \coefficientsRadiiVec\left[\Tamb[\NumFPA]\right][0] & \hdots & \coefficientsRadiiVec\left[\Tamb[\NumFPA]\right][\mRadial] \\
    \end{bmatrix}_{\NumFPA\times \mRadial},\qquad\forall r\in[0,\ldots,\mRadial]
\end{equation}

$\Gamma$, the radial coefficient matrix, is comprised of $\gamma_{i,j}$ coefficients:
\begin{equation}
    \Gamma =
    \begin{bmatrix}
        \gamma_{0,0}     & \hdots & \gamma_{0,\mRadial}     \\
        \vdots           & \ddots & \vdots                  \\
        \gamma_{\mFPA,0} & \hdots & \gamma_{\mFPA,\mRadial}
    \end{bmatrix}_{\mFPA\times\mRadial} \label{eq:fitRadiiFPA:coef}
\end{equation}

Then the values of $\Gamma$ can be found by solving the inverse problem:
\begin{equation}\label{eq:fitRadiiFPA}
    \mat{R}_C = \mat{A}_C \cdot \Gamma \quad \rightarrow\quad
    \Gamma = \mat{A}_C^{+}\cdot\mat{R}_C,\qquad\Gamma\in\mathcal{R}^{\mFPA\times \mRadial}
\end{equation}
$\mat{A}_C^{+}$ is the Moore–Penrose inverse of $\mat{A}_C$.

We denote the approximation of $\coefficientsRadiiVec[\tamb]$ by $\tamb$ as $\coefficientsAmbRadiiVec(\tamb)$.
\cref{fig:coefRadial} demonstrates how $\coefficientsPixelwiseVec(\tamb)$ are found using $\Gamma$.
The algorithm used to find $\Gamma$ the $\tamb$-dependent radial nonuniformity coefficients is depicted in \cref{alg:estimateNonUniformity}.
\input{content/suppMat/fig_radii_coefs_gamma.tex}

\subsection{Applying the camera simulator to new data}\label{sec:method:characterization:applyToNew}
\noindent We can now use the coefficients $\Gamma$ to simulate the low-cost IR camera response in gray-levels from a new object temperature $\tobj$ and ambient temperature $\tamb$.
First, the radial coefficients are estimated for a given ambient temperature $\tamb$:
\begin{equation}\label{eq:estimationOfMeas:sp}
    \coefficientsAmbRadiiVec(\tamb) = \sum_{m=0} ^{\mFPA}{\Gamma[m] \cdot \tamb^m},\qquad\coefficientsAmbRadiiVec(\tamb)\in\mathcal{R}^{\mRadial}
\end{equation}

Next, the pixel-wise coefficients are found from the radial coefficients $\coefficientsAmbRadiiVec(\tamb)$ and the radial kernel $\mat{P}$:
\begin{equation} \label{eq:estimationOfMeas:fpa}
    \coefficientsPixelwiseVec(\tamb)[x,y] = \sum_{m=0}^{\mRadial}{\coefficientsAmbRadii{m}(\tamb)\cdot P^m},\qquad\coefficientsPixelwiseVec(\tamb)\in\mathcal{R}^{\mGrayLevels\times h\times w}
\end{equation} Notice that the coefficients $\coefficientsPixelwiseVec(\tamb)$ are pixel-wise and that for $P^m$, the power $m$ is applied element-wise on the matrix $P$.

Lastly, the estimated response of the camera $\simulatedCameraResponse{\tamb}{\tobj}$ is approximated using the given object temperature and the pixel-wise coefficients $\coefficientsPixelwiseVec(\tamb)$. The equation is stated at the beginning of \cref{sec:method:characterization:temperatureDependency}, as \cref{eq:supp:charactarization:simulation}:
$$ \simulatedCameraResponse{\tamb}{\tobj}[x,y] = \sum_{m=0}^{\mGrayLevels}{\coefficientsPixelwise{m}(\tamb)[x,y]} \cdot \tobj^m[x,y],\qquad\simulatedCameraResponse{\tamb}{\tobj}\in\mathcal{R}^{h\times w} $$
where $\tobj$ can have dimensions similar to a frame. The power $m$ is applied element-wise.

The simulator is illustrated in \cref{fig:method:simulator} of the main article.
% 
% The process of applying the nonuniformity to a new measurement is described in \cref{alg:applyNonUniformity}.
% The characterization process produces synthetic nonuniformity maps.
% The process also handles error in the measured data, such as skewing around the middle of the image.
% 
% The degradation maps enable training different supervised algorithms for the nonuniformity correction. The maps are noise-less and perfectly symmetrical around the middle of the image. Different augmentations can be applied by the user to simulate noises of varying degrees, directional heating on the camera which results in skewing, and FPN on the frames. These augmentations increase generalization, making it possible to perform NUC on different cameras with the same training. Details on the exact augmentations performed in this work are given in \cref{sec:method:preprocessing}.
% 
\begin{algorithm}
    \SetAlgoLined
    \KwData{Images of \blackbody blackbody at different \opPoints.}
    \KwIn{$\mathbf{\mGrayLevels}$ is the degree of the polynomial of the object's temperature.\newline
        $\mathbf{\mFPA}$ is the degree of the polynomial.\newline
        $\mathbf{M_F}$ is the degree of the fine spatial fit.\newline
        $\mathbf{\mRadial}$ is the degree of the radial fit.\newline
        $\mathbf{\mFPA}$ is the degree of the camera temperature fit for the radial coefficients.}
    \KwOut{The $\tamb$-dependent radial nonuniformity coefficients $\Gamma\in\mathcal{R}^{\mFPA\times \mRadial}$.}
    \For{$\tamb\in \Tamb  $}{
        $\coefficientsRadiance{}[\tamb][x,y]\longleftarrow$ \cref{eq:LsSolutionFPA}, $\forall x,y\in$ image}
    \For{$m\in[0,\ldots,\mGrayLevels]$}{
        \For{$\tamb\in \Tamb  $}{
            Gaussian filter on $\coefficientsRadiance{m}[\tamb]$\\
            $\coefficientsSpatialQuadratic[\tamb][m]\longleftarrow$ Quadratic spatial fit (\cref{eq:spatialFit})\\
            $\coefficientsSpatialFine[\tamb][m]\longleftarrow$ Fine spatial fit (\cref{eq:spatialFit})\\
            $\coefficientsSpatialSkewless[\tamb][m]\longleftarrow$ Subtract the spatial fit (\cref{eq:spatialFitSubtraction})\\
            $\coefficientsRadiiVec[\tamb][m]\longleftarrow$ Radial spatial fit (\cref{eq:spatialRadiiFit})}
        $\Gamma[m]\longleftarrow$ Fit radial coefficients to $\tamb$ (\cref{eq:fitRadiiFPA})}
    \caption{Estimation of nonuniformity maps.}
    \label{alg:estimateNonUniformity}
\end{algorithm}

\begin{algorithm}
    \SetAlgoLined
    \KwIn{$\mathbf{\tobj}$ is an accurate temperature map of arbitrary dimensions.\newline
        $\mathbf{\tamb}$ to simulate the camera ambient temperature.\newline
        $\mathbf{\Gamma}$ the $\tamb$-dependent radial nonuniformity coefficients.}
    \KwOut{$\simulatedCameraResponse{\tamb}{\tobj}$ a gray-level map simulation at temperature $\tamb$.}
    $\simulatedCameraResponse{\tamb}{\tobj}\longleftarrow\mat{0}_{h\times w}$\\
    \For{$m\in[0,\ldots,\mGrayLevels]$}{
        $\coefficientsAmbRadii{m}(\tamb)\longleftarrow$  Calc.\ radial coefficients (\cref{eq:estimationOfMeas:sp})\\
        $\coefficientsPixelwise{m}(\tamb)\longleftarrow$ Calc.\ per-pixel coefficients using the radial coefficients $\coefficientsAmbRadii{m}$ (\cref{eq:estimationOfMeas:fpa})\\
        \tcp{Multiplication and power of matrices are applied element-wise.}
        $\simulatedCameraResponse{\tamb}{\tobj}\longleftarrow\simulatedCameraResponse{\tamb}{\tobj}+\coefficientsPixelwise{m}(\tamb)\cdot \tobj^m$}
    \caption{Transform an accurate temperature map of arbitrary dimensions into a nonuniform radiation flux.}
    \label{alg:applyNonUniformity}
\end{algorithm}
