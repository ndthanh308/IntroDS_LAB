{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "01881d37",
   "metadata": {},
   "outputs": [],
   "source": [
    "# File name: authors.ipnyb\n",
    "\n",
    "# Created: 24/06/2023 (Mauricio Bustamante, mbustamante@gmail.com)\n",
    "# Last update: 26/06/2023  (Mauricio Bustamante, mbustamante@gmail.com)\n",
    "\n",
    "# Description:\n",
    "# Script to generate a list of GRAND Collaboration authors in text form, for use in publications.\n",
    "\n",
    "# Input:\n",
    "# A pre-generated, external database file (members.db) that can be queried using SQL."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 109,
   "id": "b2ed43e9",
   "metadata": {},
   "outputs": [],
   "source": [
    "import sqlite3\n",
    "from pylatexenc.latexencode import unicode_to_latex # To install: pip install pylatexenc \n",
    "import numpy as np\n",
    "\n",
    "# Comment out the call to pylatexenc above if conversion from Unicode to LaTeX is not needed.\n",
    "# In that case, also set convert_unicode_to_latex = False below."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "id": "4e1aa6af",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Open the database, create a cursor to point at it\n",
    "con = sqlite3.connect('members.db')\n",
    "cur = con.cursor()\n",
    "\n",
    "# Select active members only (those that have is_member==1)\n",
    "active_members = cur.execute('SELECT names, surname, names_local, surname_local, institute1_id, institute2_id, \\\n",
    "                      institute3_id, institute4_id, institute5_id FROM grandmember WHERE is_member=1 \\\n",
    "                      ORDER BY surname COLLATE NOCASE ASC').fetchall()\n",
    "# for member in active_members:\n",
    "#     print(member)\n",
    "\n",
    "# Fetch the institutions\n",
    "institutions = cur.execute('SELECT id, name, name_local, address, address_local FROM institute').fetchall()\n",
    "# for inst in institutions:\n",
    "#     print(inst)\n",
    "\n",
    "# Close the database\n",
    "con.close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 128,
   "id": "0a9ae9fd",
   "metadata": {},
   "outputs": [],
   "source": [
    "use_initials = True             # True: use initials for names; False: use full names\n",
    "convert_unicode_to_latex = True # True: convert Unicode characters to LaTex; False: don't (need pylatexenc)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 129,
   "id": "70484a75",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['J.~Alvarez-Muniz$^{1}$,' 'R.~A.~Batista$^{2}$,' 'A.~Benoit-Levy$^{3}$,'\n",
      " 'T.~Bister$^{4, 5}$,' 'J.~Bolmont$^{6}$,' 'M.~Bustamante$^{7}$,'\n",
      " 'D.~Charrier$^{8}$,' 'Y.~Chen$^{9}$,' 'L.~Cheng$^{10}$,'\n",
      " 'S.~Chiche$^{11}$,' 'J.~Colley$^{6}$,' 'P.~Correa$^{6}$,'\n",
      " 'N.~Cucu Laurenciu$^{4}$,' 'Z.~Dai$^{12}$,' 'R.~M.~de Almeida$^{13}$,'\n",
      " 'S.~de Jong$^{4}$,' 'J.~R.~T.~de Mello Neto$^{14}$,'\n",
      " 'K.~D.~de Vries$^{15}$,' 'P.~B.~Denton$^{16}$,' 'V.~Deocoene$^{11}$,'\n",
      " 'K.~Duan$^{9}$,' 'R.~Duan$^{10}$,' 'B.~Duan$^{9}$,'\n",
      " 'R.~Engel$^{17, 18}$,' 'Y.~Fan$^{9}$,' 'K.~Fang$^{19}$,'\n",
      " 'A.~Ferri\\\\`ere$^{20}$,' 'Q.~Gou$^{21}$,' 'J.~Gu$^{10}$,'\n",
      " 'M.~Guelfand$^{6, 11}$,' 'L.~Guelzow$^{17}$,' 'C.~Guepin$^{22, 23}$,'\n",
      " 'J.~Guo$^{9}$,' 'Y.~Guo$^{21}$,' 'V.~Gupta$^{17}$,' 'A.~Haungs$^{17}$,'\n",
      " 'H.~He$^{9}$,' 'E.~Hivon$^{11}$,' 'H.~Hu$^{21}$,' 'X.~Huang$^{9}$,'\n",
      " 'Y.~Huang$^{10}$,' 'T.~Huege$^{24, 17}$,' 'W.~Jiang$^{25}$,'\n",
      " 'R.~Koirala$^{26, 27}$,' 'K.~Kotera$^{28, 11}$,' 'J.~K\\\\\"ohler$^{17}$,'\n",
      " 'B.~L.~Lago$^{29}$,' 'S.~Le Coz$^{6}$,' 'F.~Legrand$^{6}$,'\n",
      " 'J.~Lenain$^{6}$,' 'H.~Li$^{25}$,' 'R.~Li$^{25}$,' 'C.~Liu$^{21}$,'\n",
      " 'R.~Liu$^{26, 27}$,' 'W.~Liu$^{21}$,' 'P.~Ma$^{9}$,' 'F.~Magnard$^{11}$,'\n",
      " 'O.~Martineau-Huynh$^{10, 6, 11}$,' 'A.~Mikhno$^{11}$,'\n",
      " 'P.~Mitra$^{30}$,' \"M.~Mostaf\\\\'a$^{31, 32}$,\" 'F.~Mottez$^{33}$,'\n",
      " 'J.~Mouette$^{11}$,' 'K.~Murase$^{31, 32}$,' 'V.~Niess$^{34}$,'\n",
      " 'S.~Ogio$^{35}$,' 'F.~Oikonomou$^{36}$,' 'Z.~Ou$^{37}$,'\n",
      " 'T.~Pierog$^{17}$,' 'L.~W.~Piotrowski$^{30}$,' 'P.~Poisvert$^{6}$,'\n",
      " 'S.~Prunet$^{38}$,' 'X.~Qian$^{39}$,' 'O.~M.~Ramirez$^{40}$,'\n",
      " 'M.~Roth$^{17}$,' 'T.~Sako$^{35}$,' 'H.~Schoorlemmer$^{4, 5}$,'\n",
      " 'F.~Schussler$^{20}$,' 'B.~Steeman$^{4}$,'\n",
      " \"D.~Sz\\\\'alas-Motesiczky$^{4}$,\" \"S.~S{\\\\l}awi\\\\'nski$^{30}$,\"\n",
      " 'A.~Timmermans$^{15, 4}$,' 'C.~Timmermans$^{4, 5}$,' 'M.~Tueros$^{41}$,'\n",
      " 'S.~Wang$^{9}$,' 'X.~Wang$^{26, 27}$,' 'X.~Wang$^{25}$,'\n",
      " 'X.~Wang$^{39}$,' 'R.~Wang$^{25}$,' 'C.~Watanabe$^{14}$,' 'D.~Wei$^{9}$,'\n",
      " 'F.~Wei$^{25}$,' 'X.~Wu$^{10, 42}$,' 'X.~Wu$^{43}$,' 'X.~Xu$^{25}$,'\n",
      " 'X.~Xu$^{9}$,' 'L.~Yang$^{37}$,' 'X.~Yang$^{9}$,' 'Q.~Yuan$^{9}$,'\n",
      " 'P.~Zarka$^{44}$,' 'H.~Zeng$^{9}$,' 'C.~Zhang$^{45, 46, 17}$,'\n",
      " 'J.~Zhang$^{10}$,' 'K.~Zhang$^{9}$,' 'P.~Zhang$^{25}$,'\n",
      " 'S.~Zhang$^{43}$,' 'H.~Zhang$^{25}$,' 'H.~Zhou$^{47}$']\n"
     ]
    }
   ],
   "source": [
    "# Export author names and institutions in this format:\n",
    "# Name Surname^{m,n}\n",
    "# ${^m}$Institution1\n",
    "# ${^n}$Institution2\n",
    "\n",
    "# First create the author entries\n",
    "member_list = np.array([])\n",
    "# selected_institutions stores stores the database IDs and print IDs of the institutions that have already appeared\n",
    "selected_institutions = np.array([]) \n",
    "dict_selected_institutions = {}\n",
    "inst_index_print = 1\n",
    "num_active_members = len(active_members)\n",
    "for i, member in enumerate(active_members):\n",
    "#     print(member)\n",
    "    # For each member, create a text string containing the name and affiliation call\n",
    "    names, surname, names_local, surname_local, institute1_id, institute2_id, institute3_id, institute4_id, \\\n",
    "        institute5_id = member\n",
    "    if convert_unicode_to_latex:\n",
    "        names = unicode_to_latex(names)\n",
    "        surname = unicode_to_latex(surname)\n",
    "        names_local = unicode_to_latex(unicode_to_latex)\n",
    "        surname_local = unicode_to_latex(surname_local)\n",
    "    if use_initials:\n",
    "        names = ''.join([x[0].upper()+r'.~' for x in names.split(' ')])\n",
    "        member_string = names+surname # Name Surname    \n",
    "    else:\n",
    "        member_string = names+' '+surname # Name Surname\n",
    "    member_string += r'$^{'\n",
    "    flag_first_inst = True\n",
    "    for inst_index in [institute1_id, institute2_id, institute3_id, institute4_id, institute5_id]:\n",
    "        if inst_index is not None:\n",
    "            if not inst_index in np.array(list(dict_selected_institutions.keys())):\n",
    "                dict_selected_institutions[inst_index] = inst_index_print\n",
    "                inst_index_print += 1\n",
    "            if not flag_first_inst: member_string += r', '\n",
    "            member_string += str(dict_selected_institutions[inst_index]) #str(inst)\n",
    "            flag_first_inst = False\n",
    "    member_string += r'}$'\n",
    "    if (i != num_active_members-1):\n",
    "        member_string += ','\n",
    "    member_list = np.append(member_list, member_string)\n",
    "#     print(member_string)\n",
    "print(member_list)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 131,
   "id": "f42893c6",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['$^{1}$Departamento de Fisica de Particulas \\\\& Instituto Galego de Fisica de Altas Enerxias, Universidad de Santiago de Compostela, 15782 Santiago de Compostela, Spain'\n",
      " \"$^{2}$Instituto de F{\\\\'\\\\i}sica Te\\\\'orica, Universidad Aut\\\\'onoma de Madrid - CSIC, 28049 Madrid, Spain\"\n",
      " \"$^{3}$CEA List, Universit\\\\'e Paris-Saclay,  F-91120 Palaiseau, France\"\n",
      " '$^{4}$Institute for Mathematics, Astrophysics and Particle Physics, Radboud Universiteit, Nijmegen, Netherlands'\n",
      " '$^{5}$Nationaal Instituut voor Kernfysica en Hoge Energie Fysica, '\n",
      " '$^{6}$Universite Paris Diderot, Sorbonne Paris Cite, CNRS Laboratoire de Physique Nucleaire et de Hautes Energies, 4 place Jussieu F-75252, Paris Cedex 5, France'\n",
      " '$^{7}$Niels Bohr International Academy, Niels Bohr Institute, University of Copenhagen, 2100 Copenhagen, Denmark'\n",
      " '$^{8}$SUBATECH, Institut Mines-Telecom Atlantique, CNRS/IN2P3, Universite de Nantes, Nantes, France'\n",
      " '$^{9}$Key Laboratory of Dark Matter and Space Astronomy, Purple Mountain Observatory, Chinese Academy of Sciences, 210023 Nanjing, Jiangsu, China'\n",
      " '$^{10}$National Astronomical Observatories, Chinese Academy of Sciences, Beijing 100101, China'\n",
      " \"$^{11}$ Institut d'Astrophysique de Paris, CNRS  UMR 7095, Sorbonne Universite, 98 bis bd Arago 75014, Paris, France\"\n",
      " '$^{12}$University of Science and Technology of China, 230026 Hefei  Anhui, China'\n",
      " '$^{13}$Universidade Federal Fluminense, EEIMVR Volta Redonda RJ, Brazil'\n",
      " '$^{14}$Instituto de Fisica, Universidade Federal do Rio de Janeiro, '\n",
      " '$^{15}$IIHE/ELEM, Vrije Universiteit Brussel, Pleinlaan 2, 1050 Brussels, Belgium'\n",
      " '$^{16}$High Energy Theory Group, Physics Department Brookhaven National Laboratory, Upton, NY 11973, USA'\n",
      " '$^{17}$Institute for Astroparticle Physics, Karlsruhe Institute of Technology, D-76021 Karlsruhe, Germany'\n",
      " '$^{18}$Institute of Experimental Particle Physics, Karlsruhe Institute of Technology, D-76021 Karlsruhe, Germany'\n",
      " '$^{19}$Wisconsin IceCube Particle Astrophysics Center and Deptartment of Physics, University of Wisconsin-Madison, Madison, WI 53703, USA'\n",
      " '$^{20}$IRFU, CEA Universite Paris-Saclay, F-91191 Gif-sur-Yvette, France'\n",
      " '$^{21}$Institute of High Energy Physics, Chinese Academy of Sciences, 19B YuquanLu, Beijing 100049, China'\n",
      " '$^{22}$Department of Astronomy, University of Maryland, College Park, MD 20742-2421, USA'\n",
      " '$^{23}$Joint Space-Science Institute, College Park, MD 20742-2421, USA'\n",
      " '$^{24}$Astrophysical Institute, Vrije Universiteit Brussel, Pleinlaan 2, 1050 Brussels, Belgium'\n",
      " '$^{25}$Key Laboratory of Antennas and Microwave Technology, Xidian University, Xi{\\\\textquoteright}an 710071, China'\n",
      " '$^{26}$School of Astronomy and Space Science, Nanjing University, Xianlin Road 163, Nanjing 210023, China'\n",
      " '$^{27}$Key laboratory of Modern Astronomy and Astrophysics, Nanjing University, Ministry of Education, Nanjing 210023, China'\n",
      " '$^{28}$Vrije Universiteit Brussel, Pleinlaan 2, B-1050 Brussels, Belgium'\n",
      " \"$^{29}$Centro Federal de Educa\\\\c{c}\\\\~ao Tecnol\\\\'ogica Celso Suckow da Fonseca, Nova Friburgo, Brazil\"\n",
      " '$^{30}$Faculty of Physics, University of Warsaw, Pasteura 5, 02-093 Warsaw, Poland'\n",
      " '$^{31}$Department of Astronomy \\\\& Astrophysics, Pennsylvania State University, University Park, PA 16802, USA'\n",
      " '$^{32}$Center for Multimessenger Astrophysics, Pennsylvania State University, University Park, PA 16802, USA'\n",
      " '$^{33}$LUTH, Obs. de Paris CNRS Universite Paris Diderot, PSL Research University, 5 place Jules Janssen 92190, Meudon, France'\n",
      " \"$^{34}$CNRS/IN2P3 LPC, Universit\\\\'e Clermont Auvergne, F-63000 Clermont-Ferrand, France\"\n",
      " '$^{35}$Institute for Cosmic Ray Research, University of Tokyo, 5 Chome-1-5 Kashiwanoha, Kashiwa, Chiba 277-0882, Japan'\n",
      " '$^{36}$Institutt for fysikk, NTNU, Trondheim, Norway'\n",
      " '$^{37}$School of Physics and Astronomy, Sun Yat-sen University, Zhuhai 519082, China'\n",
      " \"$^{38}$Laboratoire Lagrange, Observatoire de la C\\\\^ote d{\\\\textquoteright}Azur, Universite C\\\\^ote d'Azur, CNRS, Parc Valrose 06104, Nice Cedex 2, France\"\n",
      " '$^{39}$Department of Mechanical and Electrical Engineering, Shandong Management University,  Jinan 250357, China'\n",
      " '$^{40}$Gravitation Astroparticle Physics Amsterdam, Univesity of Amsterdam, Science Park 904, 1098 XH Amsterdam, Netherlands'\n",
      " '$^{41}$Instituto de Fisica La Plata, CONICET  Boulevard 120 y 63 (1900)  La Plata'\n",
      " '$^{42}$Shanghai Astronomical Observatory, Chinese Academy of Sciences, 80 Nandan Road, Shanghai 200030, China'\n",
      " '$^{43}$Purple Mountain Observatory, Chinese Academy of Sciences, Nanjing 210023, China'\n",
      " '$^{44}$LESIA, Observatoire de Paris, CNRS, PSL/SU/UPD/SPC, Place J. Janssen 92195, Meudon, France'\n",
      " '$^{45}$Kavli Institute for Astronomy and Astrophysics, Peking University, Beijing 100871, China'\n",
      " '$^{46}$Department of Astronomy, School of Physics, Peking University, Beijing 100871, China'\n",
      " '$^{47}$Tsung-Dao Lee Institute \\\\& School of Physics and Astronomy, Shanghai Jiao Tong University, 200240 Shanghai, China']\n"
     ]
    }
   ],
   "source": [
    "# Now create the institution entries\n",
    "institutions = np.array(institutions)\n",
    "institution_list = np.array([])\n",
    "# print(list(dict_selected_institutions.keys()))\n",
    "for inst_index in list(dict_selected_institutions.keys()):\n",
    "    inst_index_print = dict_selected_institutions[inst_index]\n",
    "    inst = institutions[institutions[:,0] == str(inst_index), :][0]\n",
    "#     print(inst)\n",
    "    name = inst[1]\n",
    "    address = inst[3]\n",
    "    if convert_unicode_to_latex:\n",
    "        name = unicode_to_latex(name)\n",
    "        address = unicode_to_latex(address)\n",
    "    inst_string = r'$^{'+str(inst_index_print) + r'}$' + name + ', ' + address\n",
    "    institution_list = np.append(institution_list, inst_string)\n",
    "print(institution_list)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 136,
   "id": "b8e6b3df",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Now export this to a file\n",
    "filename = 'authors.tex'\n",
    "# Save authors\n",
    "np.savetxt(filename, member_list, fmt='%s')\n",
    "# Save institutions\n",
    "with open(filename, 'a') as f:\n",
    "    np.savetxt(f, ['\\\\newline'], fmt='%s')\n",
    "    np.savetxt(f, institution_list, fmt='%s')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "4f7b926c",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}