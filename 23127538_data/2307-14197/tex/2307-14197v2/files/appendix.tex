\section{Convergence tests}
\label{sec:appendix_robustnesstest}

Given the two-step approach to fit the HOD model, there is the important question of convergence that has to be answered. Thus, we study whether the $\Sigma_\mathrm{diff}$ estimates well the noise in our HOD fitting process.


Figure~\ref{fig:ratio_clustering_error_bars} illustrates that the magnitude of the errors estimated after the second HOD fitting step for all six hod fitting scenarios are consistent between themselves within at most 10 to 20 per cent. However, there seems to be a slight divergence between the error estimations when one approaches the lowest scales.


% Figure environment removed


Finally, compared to the square root of the diagonal of $\Sigma_\mathrm{diff}$, the six standard deviations for both 2PCF and power spectrum are found within at most 20 per cent deviation. In order to quantify these discrepancies, we have built the difference covariance matrix using each of the six best-fitting \textsc{FastPM} (of the second HOD fitting step, see Table~\ref{tab:fitting_intervals_n_bins}) set of galaxies. Furthermore, we have computed the $\chi_\nu^2$ for the same best-fitting \textsc{FastPM} of the second HOD fitting step, but using these six new difference covariance matrices. The results are summarised in Figure~\ref{fig:chi2_after_second_step_6_covariances}.

% Figure environment removed

Even though for most of the fitting cases, the six new difference covariance matrices seem to provide coherent biased $\chi^2_\nu$ values compared to the $\Sigma_\mathrm{diff}$, the biases do not share the same sign between the fitting cases. In addition, most $\chi^2_\nu$ values are within the error bars shown in Table~\ref{tab:error_on_chisq} with respect to the reference. This suggests that given the error bars, the hypothetical best-fittings obtained using the six new covariance matrices, would be indistinguishable from the best-fitting \textsc{FastPM} of the second HOD step. Consequently, we argue that the $\Sigma_\mathrm{diff}$ is a good approximation of the noise in the difference of the (\textsc{FastPM}, \textsc{SLICS}) clustering, thus a hypothetical third step HOD would not drastically change the best-fitting \textsc{FastPM} compared to the ones after the second step. 

\section{Uncertainty of the goodness-of-fit}
\label{sec:appendix_chi2uncertainty}

In this section, we are studying the uncertainty introduced by the covariance matrix and the finite number of HOD realisations per \textsc{FastPM} halo catalogue in the values of $\chi^2_\nu$, as defined in Eq.~\eqref{eq:reduced_chi2}. The results are summarised in Table~\ref{tab:error_on_chisq}.

\subsection{Covariance matrix induced uncertainty}
Due to the fact that we have only $N^\mathrm{cov}_\mathrm{mocks} = 123$ \textsc{SLICS} and \textsc{FastPM} realisations that share the same initial conditions, we are bound to use the JackKnife (JK) method to estimate the uncertainty introduced by the covariance matrix. Additionally, the HOD fitting is computationally expensive ($\approx6000$ CPU-hours), thus we are not able to perform hundreds of HOD fittings with different covariance matrices. Consequently, after obtaining one set of best-fitting HOD parameters, we computed the $\chi^2_\nu$ with the same best-fitting \textsc{FastPM} clustering, but with $N^\mathrm{cov}_\mathrm{mocks}$ different covariance matrices. 

The covariance matrices -- $\Sigma_\chi^i$, with $i$ from 1 to $N^\mathrm{cov}_\mathrm{mocks}$ -- are estimated using Eq.~\eqref{eq:inverse_unbiased_covaraince}, but with only $N^\mathrm{cov}_\mathrm{mocks}-1$ clustering realisations.
Furthermore, we compute $\chi^{2,i}_{\nu, \mathrm{JK}}$ for each $\Sigma_\chi^i$, as defined in Eq.~\eqref{eq:reduced_chi2} and we calculate the mean $\bar{\chi}^2_{\nu,\mathrm{JK}}$ and the variance $\sigma_{\chi,\mathrm{JK}}^2$:
\begin{equation}
    \label{eq:appendix_chi2_jk}
    \bar{\chi}^2_{\nu,\mathrm{JK}} = \frac{1}{N^\mathrm{cov}_\mathrm{mocks}}\sum_{i=1}^{N^\mathrm{cov}_\mathrm{mocks}} \chi^{2,i}_{\nu, \mathrm{JK}},
\end{equation}
\begin{equation}
    \label{eq:appendix_chi2_var_jk}
    \sigma_{\chi,\mathrm{JK}}^2 = \left[ \frac{N^\mathrm{cov}_\mathrm{mocks}-1}{N^\mathrm{cov}_\mathrm{mocks}} \sum_{i=1}^{N^\mathrm{cov}_\mathrm{mocks}} \left(\chi^{2,i}_{\nu, \mathrm{JK}} - \bar{\chi}^2_{\nu,\mathrm{JK}} \right)^2 \right].
\end{equation}

\subsection{HOD induced uncertainty}
\begin{table}
    \centering
    \begin{tabular}{l | l | l }
        \hline
                & $P(k)$ & $\xi(s)$   \\
         \hline
        Large                                                            &               &                \\
        $\chi^2_\nu$ from Figure~\ref{fig:reduced_chi2}                  & $1.15$        & $16.94$        \\
        $\bar{\chi}^2_{\nu,\mathrm{HOD}} \pm \sigma_{\chi,\mathrm{HOD}}$ & $1.38\pm0.26$ & $17.03\pm1.65$ \\
        $\bar{\chi}^2_{\nu,\mathrm{JK}}  \pm \sigma_{\chi,\mathrm{JK}}$  & $1.16\pm0.31$ & $16.97\pm2.68$ \\
                                                                    \\           
         Medium &                        &                          \\
                & $1.00$                 & $2.16$                   \\
                & $1.13\pm0.23$          & $2.19\pm0.42$            \\
                & $1.00\pm0.19$          & $2.16\pm0.32$            \\
                                                                    \\
         Small  &                        &                          \\
                & $1.50$                 & $1.59$                   \\
                & $1.50\pm0.29$          & $1.68\pm0.41$            \\
                & $1.51\pm0.25$          & $1.59\pm0.26$            \\
         \hline
         
    \end{tabular}
    \caption{The values of the $\chi^2_\nu$ and their uncertainties introduced by the covariance matrix (Eqs.~\eqref{eq:appendix_chi2_jk} and \eqref{eq:appendix_chi2_var_jk}) and the finite number of HOD realisations per \textsc{FastPM} halo catalogue (Eqs.~\eqref{eq:appendix_chi2_hod} and \eqref{eq:appendix_chi2_var_hod}). The estimations have been performed on the LR ($1296^3$) \textsc{FastPM} galaxy catalogues and on both the 2PCF and the power spectrum for the three specific fitting ranges defined in Table~\ref{tab:fitting_intervals_n_bins}. \label{tab:error_on_chisq}} 
\end{table}


During the HOD fitting, for each \textsc{FastPM} halo catalogue we create a single galaxy realisation, in order to reduce the optimisation time. As a consequence, we introduce additional noise in the HOD fitting process, that is not considered in the covariance matrix.

With the aim of estimating the effect of this noise on the $\chi^2_\nu$, we compute 100 galaxy realisations for a given set of best-fitting HOD parameters and per \textsc{FastPM} halo catalogue. Furthermore, using the 20 galaxy realisations corresponding to the halo catalogues used in the HOD fitting process and the same covariance matrix, we compute $\chi^{2,i}_{\nu, \mathrm{HOD}}$ as in Eq.~\eqref{eq:reduced_chi2}, where $i=1,...,100$. Finally, we calculate the mean and the standard deviation of the 100 $\chi^{2,i}_{\nu, \mathrm{HOD}}$ values:
\begin{equation}
    \label{eq:appendix_chi2_hod}
    \bar{\chi}^2_{\nu,\mathrm{HOD}} = \frac{1}{100}\sum_{i=1}^{100} \chi^{2,i}_{\nu, \mathrm{HOD}},
\end{equation}
\begin{equation}
    \label{eq:appendix_chi2_var_hod}
    \sigma_{\chi,\mathrm{HOD}}^2 = \left[ \frac{1}{100 - 1} \sum_{i=1}^{100} \left(\chi^{2,i}_{\nu, \mathrm{HOD}} - \bar{\chi}^2_{\nu,\mathrm{HOD}} \right)^2 \right].
\end{equation}



\section{Covariance matrix comparison}
\label{sec:appendix_cov_mat_comp}

Analysing Figures~\ref{fig:correlation_pspec_1296_780} and \ref{fig:correlation_2pcf_1296_780} one can observe that the ($s_\mathrm{min}=5$, $s_\mathrm{min}=10$) and ($k_\mathrm{max}=0.3$, $k_\mathrm{max}=0.4$) pairs have very similar correlation matrices. Consequently, we only show $k_\mathrm{max}=0.3$ and $s_\mathrm{min}=10$ in the main text.

% Figure environment removed


% Figure environment removed

Figures~\ref{fig:pspec_fit_avg_b0_b2} and \ref{fig:2pcf_fit_avg_b0_b2} show the results of fitting the clustering with the simplified model detailed in Section~\ref{sec:cov_mat_constrain_power}.  Since most results are consistent with the expected value of one, we only display the values for $\mathcal{K}=0.25\,\ku$ and $\mathcal{S}=20\,\su$ in the main text.

% Figure environment removed

% Figure environment removed


