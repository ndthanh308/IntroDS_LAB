%\subsection{Proofs for Section~\ref{sec:tableaux}}


\begin{restatable}[Termination]{theorem}{Termination}
	\label{thm:termination}
	%Having started on the initial completion set $\T_{\p} =  \{0 : \p
	%0 : \top(x)
	%\}$, 
		The $\LnALC$ tableau algorithm for $\p$ terminates after at most $2^{p(|\fg(\p)|)}$ steps, where $p$ is a polynomial function.
%	\nb{O: strange here, talk about non-determinism}
%	The non-deterministic $\LnALC$ tableau algorithm with $\p$ as input terminates after at most $2^{p(|\fg(\p)|)}$ steps, where $p$ is a polynomial function.
%%	\nb{O: strange here, talk about non-determinism}
\end{restatable}
%




%%\vspace{3cm}
%\begin{theorem}[Termination]
%\label{thm:termination}
%The $\LnALC$ tableau algorithm terminates for every formula $\p$.
%\end{theorem}
%%\begin{proof}
%%The theorem follows as a consequence of the following two claims:
%%(i) For each label $n$, the algorithm generates finitely many $n$-labelled constraints.
%%``The algorithm behaves `locally' (i.e., with respect to a label $n$) as a standard terminating tableaux algorithm for ALC''.
%%(ii) The algorithm generates finitely many labels.
%%%$n$.
%%Then, the number of
%%%the
%%labels
%%%$n$
%%that can be generated by the algorithm is bounded by the number of possible combinations of modal subformulas (possibly converted into their NNF) and modalised concepts occurring in the initial formula $\p$.
%%\end{proof}
%\begin{proof}
%The theorem follows as a consequence of the following two claims:
%\begin{itemize}
%\item[(i)] For each label $n$, the algorithm generates finitely many $n$-labelled constraints.
%\item[(ii)] The algorithm generates finitely many labels $n$.
%\end{itemize}
%For (i), observe that for each $S_n$, the algorithm standardly builds an ALC-tableaux ... \textcolor{red}{size??}
%``The algorithm behaves `locally' (i.e., with respect to a label $n$) as a standard terminating tableaux algorithm for ALC''.
%%%$n$.
%%Then, the number of
%%%the
%%labels
%%%$n$
%%that can be 
%For (ii), observe that the number of labels $n$
%generated by the algorithm is bounded by the number of possible combinations of modal subformulas (possibly converted into their NNF) and modalised concepts occurring in the initial formula $\p$.
%\textcolor{red}{number of combinations??}
%\end{proof}





%%% SOUNDNESS




%\Termination*
\begin{proof}
We first require the following claims.
%The statement is a consequence of the following claims.
\begin{claim}
\label{cla:termlocal}
Let $\T$ be a completion set obtained by applying the $\LnALC$ tableau algorithm for $\p$.
For each $n \in \mathsf{L}_{\T}$,
%Let $S_{n}$ be a $n$-labelled constraint system for $\p$ in 
%$\T$.
the number of 
%constraints
$n$-labelled constraints
%of the form $n: \psi$, or $n: C(x)$, or $n: r(x, y)$ 
for $\p$
in $\T$ does not exceed $2^{q(|\fg(\p)|)}$, where $q$ is a polynomial function. 
\end{claim}
\begin{proof}[Proof of Claim]
%\nb{M: changed, to be checked}
We remark that, for each $S_n\subseteq\T$, the $\LnALC$ tableaux algorithm behaves exactly like a standard (non-modal) $\ALC$ tableaux algorithm (cf. e.g.~\cite[Theorem 15.4]{GabEtAl03}), 
%{{noting also that in our case we do not have to deal with individual names}}),
%\todo{T:Now we have individual names. Need to modify the proof?}
%\todo{T:Deleted sentence ``noting also that in our case we do not have to deal with individual names''}
{{except possibly for the additional rule $\mathsf{R}_{\mathit{L}\mathbf{T}}$ which introduces at most
$| \fg(\p) |$ $n$-labelled contraints}}.
\end{proof}

%% Old claim and proof, only for E, M , C, N
%\begin{claim}
%\label{cla:termglobal}
%Let $\mathbf{T}$ be a completion set obtained by applying the $\LnALC$ tableau algorithm for $\p$.
%For
%$\mathit{L} \in \{\mathbf{E}, \mathbf{M}, \mathbf{N}\}$,
%%when started on $\mathbf{T}_{\p}$,
%%the number of labels generated by the $\LnALC$ tableau algorithm does not exceed $|\fg(\p)|^2$.
%$|\mathsf{L}_{\mathbf{T}}| \leq |\fg(\p)|^2$.
%%%the cardinality of $\mathsf{L}_{\mathbf{T}}$
%%%does not exceed
%%%$|\fg(\p)|^2$.
%For
%$\mathit{L} = \mathbf{C}$,
%%when started on $\mathbf{T}_{\p}$,
%%the number of labels generated by the $\LnALC$ tableau algorithm does not exceed
%%$2^{|\fg(\p)|} \cdot |\fg(\p)|$.
%$|\mathsf{L}_{\mathbf{T}}| \leq 2^{|\fg(\p)|} \cdot |\fg(\p)|$.
%%%the cardinality of $\mathsf{L}_{\mathbf{T}}$
%%%does not exceed
%%%$2^{|\fg(\p)|} \cdot |\fg(\p)|$.
%\end{claim}
%\begin{proof}[Proof of Claim]
%%World
%Labels $n$ are generated in $\mathbf{T}$ by means
%of the application of the rule $\mathsf{R}_{\mathit{L}}$.
%For $\mathit{L} \in \{\mathbf{E}, \mathbf{M}, \mathbf{N}\}$,
%this rule is applied to two $n$-labelled contraints
%$n: \Box_i\gamma, n: \Diamond_{i}\delta$
%(for $\mathit{L} = \mathbf{N}$ possibly also to a single constraint
%$n: \Diamond_{i}\delta$),
%%whereas 
%while for $\mathit{L} = \mathbf{C}$
%it is applied to $k+1$ $n$-labelled contraints
%$n: \Box_i\gamma_1, ... n: \Box_i\gamma_{k}, n: \Diamond_{i}\delta$.
%By the application condition of $\mathsf{R}_{\mathit{L}}$,
%each such combination
%of
%%\textcolor{red}{modal
%constraints
%%}
%generates at most one label $m$.
%Therefore, the number of
%%world
%labels that can be generated in $\mathbf{T}$ is bounded by the number of possible
%such
%combinations,
%% of this kind,
%which is at most $|\fg(\p)|^2$, for $\mathit{L} \in \{\mathbf{E}, \mathbf{M}, \mathbf{N}\}$,
%and at most $2^{|\fg(\p)|} \cdot |\fg(\p)|$, for $\mathit{L} = \mathbf{C}$.
%%\nb{T: which symbol for multiplication? M: this one you used}
%\end{proof}

%% Claim and proof extended to all systems
\begin{claim}
\label{cla:termglobal}
{{Let $\T$ be a completion set obtained by applying the $\LnALC$ tableau algorithm for $\p$.
%If $\mathbf{C} \notin \mathit{L}$, then $|\mathsf{L}_{\T}| \leq c |\fg(\p)|^2$
%for some constant $c$.
%If $\mathbf{C} \in \mathit{L}$, then 
%$|\mathsf{L}_{\T}| \leq 2^{c |\fg(\p)|}$
%for some constant $c$.
Then $|\mathsf{L}_{\T}| \leq r( |\fg(\p)| )$
if $\mathbf{C} \notin \mathit{L}$, and 
$|\mathsf{L}_{\T}| \leq 2^{r'(|\fg(\p)|)}$
if $\mathbf{C} \in \mathit{L}$,
for some for some polynomial functions $r$ and $r'$.
}}
\end{claim}
\begin{proof}[Proof of Claim]
{{
Labels $n$ are generated in $\T$ by means
of the application of the rules $\mathsf{R}_{\mathit{L}}$,
$\mathsf{R}_{\mathit{L}\mathbf{N}}$,
$\mathsf{R}_{\mathit{L}\mathbf{P}}$,
$\mathsf{R}_{\mathit{L}\mathbf{Q}}$,
$\mathsf{R}_{\mathit{L}\mathbf{D}}$.
If $\mathbf{C}\notin\mathit{L}$,
these rules are applied to either one or two $n$-labelled contraints,
while if $\mathbf{C}\in\mathit{L}$,
they are applied to $k$, $k+1$ or $k + h$ $n$-labelled contraints.
By the application conditions of the rules,
each such combination
of constraints
generates at most one label $m$.
Therefore, the number of
labels that can be generated in $\T$ is bounded by the number of possible
such
combinations,
which is at most $2 \cdot |\fg(\p)|^2 + 3 \cdot |\fg(\p)|$,  if $\mathbf{C}\not\in\mathit{L}$,
and at most 
$2^{|\fg(\p)|} \cdot |\fg(\p)| +
|\fg(\p)| +
2^{|\fg(\p)| + 1} + 
2^{2|\fg(\p)|}$, 
if $\mathbf{C}\in\mathit{L}$.
}}
\end{proof}

{{
The theorem is then a consequence of the following observations.
Given a completion set $\T$ constructed by the $\LnALC$ tableau algorithm for $\p$,
we have by Claim~\ref{cla:termglobal} that
the number of applications of 
the rules
$\mathsf{R}_{\mathit{L}}$, $\mathsf{R}_{\mathit{L}\mathbf{N}}$, $\mathsf{R}_{\mathit{L}\mathbf{P}}$, $\mathsf{R}_{\mathit{L}\mathbf{Q}}$, and $\mathsf{R}_{\mathit{L}\mathbf{D}}$ 
is bounded by $| \mathsf{L}_{\T} |$, which is at most 
$r( |\fg(\p)| )$,
for
$\mathit{L}$ such that $\mathbf{C}\notin\Lvar$,
and at most
$2^{r'(|\fg(\p)|)}$, for $\Lvar$ such that
 $\mathbf{C} \in \mathit{L}$,
%for some for some polynomial functions $p$ and $q$.
where $r$ and $r'$ are polynomial functions.
%Moreover, since every application of the rules
%$\mathsf{R}_{\land}$ and $\mathsf{R}_{\lor}$ introduces a new formula to an $n$-labelled constraint, the total number of such rule applications is bounded by $| \mathsf{L}_{\T} | \cdot | \fg(\p) |$.
Moreover, for a given label $n$, 
the number of possible applications of the rules
$\mathsf{R}_{\land}$, $\mathsf{R}_{\lor}$ and $\mathsf{R}_{\mathit{L}\mathbf{T}}$ to constraints of the form $n: \psi$
is linearly bounded by $\fg(\p)$,
hence there are at most $| \mathsf{L}_{\T} | \cdot q'(| \fg(\p) |)$ such rule applications, where $q'$ is a polynominal function.
%Finally, by Claim~\ref{cla:termlocal}, the number of applications of rules
%$\mathsf{R}_{\sqcap}, \mathsf{R}_{\sqcup}, \mathsf{R}_{\forall}, \mathsf{R}_{\exists}, \mathsf{R}_{=}, \mathsf{R}_{\neq}$ per label $n$ is bounded by $2^{q(|\fg(\p)|)}$, where $q$ is a polynomial function, since these rules add a new constraint to an $n$-labelled constraint system.
%Thus, the overall number of such rule applications is bounded by $| \mathsf{L}_{\T} | \cdot 2^{q(|\fg(\p)|)}$.
Finally, by Claim~\ref{cla:termlocal}, 
for each label $n$, the number of applications of the rules
$\mathsf{R}_{\sqcap}, \mathsf{R}_{\sqcup}, \mathsf{R}_{\forall}, \mathsf{R}_{\exists}, \mathsf{R}_{\sqsubseteq}, \mathsf{R}_{\not\sqsubseteq}$  and $\mathsf{R}_{\mathit{L}\mathbf{T}}$ %per label $n$
 to constraints of the form $n: C(x)$ or $n: r(x, y)$ is bounded by $2^{q(|\fg(\p)|)}$, where $q$ is a polynomial function,
hence there are at most $| \mathsf{L}_{\T} | \cdot 2^{q(|\fg(\p)|)}$ such rule applications.
%Thus, 
It follows that the overall number of rule applications is bounded by 
%$| \mathsf{L}_{\T} | \cdot 2^{r(|\fg(\p)|)}$
$2^{p(|\fg(\p)|)}$
for some polynomial function $p$.
}}
\end{proof}





















We now proceed to prove that the $\LnALC$ tableau algorithm is sound. 
%\nb{O: maybe change the wording or even rewrite the theorems as one, now that the proofs were moved to the appendix}

%\newpage
%\begin{theorem}[Soundness]
%\label{thm:soundness}
%If, having started on the initial completion set $\T_{\p}$, the $\LnALC$ tableau algorithm constructs an $\LnALC$-complete and clash-free completion set for $\p$, then $\p$ is $\LnALC$ satisfiable.
%\end{theorem}
\begin{restatable}[Soundness]{theorem}{Soundness}
	\label{thm:soundness}
	If there exists an execution of the $\LnALC$ tableau algorithm for $\p$ that constructs a complete and clash-free completion set, then $\p$ is $\LnALC$ satisfiable.
%	If %, having started on the initial completion set $\T_{\p}$, %changed because this would make us look inside the alg, so simpler to say "the alg with blah as input"
%	the $\LnALC$ tableau algorithm with $\p$ as input returns $\mathsf{satisfiable}$, then $\p$ is $\LnALC$ satisfiable.
\end{restatable}
%






%\Soundness*
\begin{proof}
Suppose that  the $\LnALC$ tableau algorithm for $\p$
%returns $\mathsf{satisfiable}$.
%This means that it
constructs
 an $\LnALC$-complete and clash-free completion set $\T$ for $\p$.
% Given $\T$,
%let $\mathsf{L}_{\T} = \{ n \in \mathsf{N_{L}} \mid S_{n} \subseteq \T \}$.
We define, for $n \in \mathsf{L}_{\T}$, $\psi \in \forneg(\p)$, $C \in \conneg(\p)$, and $x$ occurring in $\T$,
%\begin{align*}
%	\lfloor \psi \rfloor & = \{ n \in \mathsf{L}_{\mathbf{T}} \mid n : \psi \in S_{n} \}, \\
%	\lfloor C \rfloor_{x} & = \{ n \in \mathsf{L}_{\mathbf{T}} \mid n : C(x) \in S_{n} \},
%\end{align*}
%and
%\begin{align*}
%	\lceil \psi \rceil & = \mathsf{L}_{\mathbf{T}} \setminus \{ n \in \mathsf{L}_{\mathbf{T}} \mid n : \dnot\psi \in S_{n}\}, \\
%	\lceil C \rceil_{x} & = \mathsf{L}_{\mathbf{T}} \setminus \{ n \in \mathsf{L}_{\mathbf{T}} \mid n : \dnot C(x) \in S_{n} \}.
%\end{align*}

%\begin{center}
\begin{align*}
	\lfloor C \rfloor_{x} & = \{ n \in \mathsf{L}_{\T} \mid n : C(x) \in S_{n} \}, \\
	\lceil C \rceil_{x} & = \mathsf{L}_{\T} \setminus \{ n \in \mathsf{L}_{\T} \mid n : \dnot C(x) \in S_{n} \}, \\
	\lfloor \psi \rfloor & = \{ n \in \mathsf{L}_{\T} \mid n : \psi \in S_{n} \}, \\
	\lceil \psi \rceil & = \mathsf{L}_{\T} \setminus \{ n \in \mathsf{L}_{\T} \mid n : \dnot\psi \in S_{n}\}. \\
\end{align*}
%\end{center}

\noindent
Moreover, define $\Gamma^{x}_{n} =  \{ \psi \mid n : \psi \in S_{n} \} \cup \{ C \mid  n : C(x) \in S_{n} \}$ and let $\gamma, \delta$ range over $\MLnALC$ formulas or concepts,
where: $\lfloor \gamma \rfloor_{x} = \lfloor \psi \rfloor$, if $\gamma = \psi$, and $\lfloor \gamma \rfloor_{x}  = \lfloor C \rfloor_{x} $, if $\gamma = C$; and similarly for $\lceil \gamma \rceil_{x}$.
%so that: if $\gamma = C$ and $\Box_{i}\gamma \in \Gamma^{x}_{n} $, then $\lceil \gamma \rceil = \lceil C \rceil_{x}$, $\rfloor \gamma \lfloor = \rfloor C \lfloor_{x}$; whereas, if $\gamma = \psi$ and $\Box_{i}\gamma \in \Gamma^{x}_{n} $< then $\lceil \gamma \rceil = \lceil \psi \rceil$, $\rfloor \gamma \lfloor = \rfloor \psi \lfloor$.
%
We set $\Mmc = (\Fmc, \Imc)$, with $\Fmc = (\Wmc, \{ \Nmc_{i} \}_{i \in J})$ and $\Imc_{n} = (\Delta_{n}, \cdot^{\Imc_{n}})$, for $n \in \Wmc$, defined as follows:
\begin{itemize}
	\item $\Wmc =  \mathsf{L}_{\T}$;
	\item for every $i \in J = \{1, \ldots, n\}$, we set $\Nmc_{i} \colon \W \rightarrow 2^{2^{\Wmc}}$ such that: %\todo{T: we are using $n$ in too many ways here}
%	\nb{M: to fix $\rfloor_{x}$}
%old&good
%		\begin{enumerate}[leftmargin=*, align=left]
%%		{{
%			\item[for $\mathit{L} = \mathbf{E}$:]
%			\[
%				\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \ \Box_{i}\gamma \in \Gamma^{x}_{n}  \colon \lfloor \gamma \rfloor_{x} \subseteq \alpha \subseteq \lceil \gamma \rceil_{x} \big\};
%			\]
%			\item[for $\mathit{L} = \mathbf{M}$:]
%			\[
%				\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \  \Box_{i}\gamma \in \Gamma^{x}_{n}  \colon \lfloor \gamma \rfloor_{x} \subseteq \alpha \big\};
%			\]
%			\item[for $\mathit{L} = \mathbf{C}$:]
%			\[
%				\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \ \Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n} \colon
%				\bigcap^{k}_{j = 1} \lfloor \gamma_{j} \rfloor_{{{x}_{j}}}
%				\subseteq \alpha \subseteq
%				\bigcap^{k}_{j = 1} \lceil \gamma_{j} \rceil_{{{x}_{j}}} \big\};
%			\]
%			\item[for $\mathit{L} = \mathbf{N}$:]
%%			\nb{M: changed, to check}
%				\[
%				\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \ \Box_{i}\gamma \in \Gamma^{x}_{n}  \colon \lfloor \gamma \rfloor_{x} \subseteq \alpha \subseteq \lceil \gamma \rceil_{x} \big\} \cup \Wmc;
%			\]
%		\end{enumerate}	
%		\begin{enumerate}[leftmargin=*, align=left]
%%		{{
%			\item[for $\mathit{L} = \mathbf{E}$:]
%			 \ \ $\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \ \Box_{i}\gamma \in \Gamma^{x}_{n}  \colon \lfloor \gamma \rfloor_{x} \subseteq \alpha \subseteq \lceil \gamma \rceil_{x} \big\}$;
%			\item[for $\mathit{L} = \mathbf{M}$:]
%			\ \ $\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \  \Box_{i}\gamma \in \Gamma^{x}_{n}  \colon \lfloor \gamma \rfloor_{x} \subseteq \alpha \big\}$;
%			\item[for $\mathit{L} = \mathbf{C}$:]
%			\[
%				\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \ \Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n} \colon
%				\bigcap^{k}_{j = 1} \lfloor \gamma_{j} \rfloor_{{{x}_{j}}}
%				\subseteq \alpha \subseteq
%				\bigcap^{k}_{j = 1} \lceil \gamma_{j} \rceil_{{{x}_{j}}} \big\};
%			\]
%			\item[for $\mathit{L} = \mathbf{N}$:]
%%			\nb{M: changed, to check}
%				\[
%				\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \ \Box_{i}\gamma \in \Gamma^{x}_{n}  \colon \lfloor \gamma \rfloor_{x} \subseteq \alpha \subseteq \lceil \gamma \rceil_{x} \big\} \cup \Wmc;
%			\]
%		\end{enumerate}

{{
		\begin{align*}
			\Nmc_{i}(n) =
			\big\{ \alpha \mid & \textnormal{\ for some \ }
%			1 \leq h \leq \mathsf{k} \textnormal{\ such that \ } \\
%			& \ \Box_{i}\gamma_{h}  \in \Gamma^{{x}_{h}}_{n}
%			\colon
%			\mathsf{LB}
%				\subseteq \alpha \subseteq
%				\mathsf{UB}
%				\big\}				
			\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{\mathsf{k}} \in \Gamma^{{x}_{\mathsf{k}}}_{n}
			\colon \\
			& \mathsf{LB}(\overline{\gamma_{\mathsf{k}}})
				\subseteq \alpha \subseteq
				\mathsf{UB}(\overline{\gamma_{\mathsf{k}}})
				\big\}
				\cup \mathsf{S};
		\end{align*}
	where:
		\begin{itemize}
			\item $\mathsf{LB}(\overline{\gamma_{\mathsf{k}}}) = \bigcap^{\mathsf{k}}_{j = 1} \lfloor \gamma_{j} \rfloor_{{{x}_{j}}}$;
			\item
			$\mathsf{UB}(\overline{\gamma_{\mathsf{k}}}) =
			\begin{cases}
				\Wmc, & \text{if $\mathbf{M} \in L$} \\
				\bigcap^{\mathsf{k}}_{j = 1} \lceil \gamma_{j} \rceil_{{{x}_{j}}}, & \text{if $\mathbf{M} \not \in L$}
			\end{cases};
			$
%			\item $\mathsf{UB} = \Wmc$ if $\mathbf{M} \in L$, 
%			$\mathsf{UB} = \bigcap^{\mathsf{k}}_{j = 1} \lceil \gamma_{j} \rceil_{{{x}_{j}}}$ if $\mathbf{M} \not \in L$;
			\item
			$\mathsf{k}
			\begin{cases}
				\geq 1, & \text{if $\mathbf{C} \in L$} \\
				= 1, & \text{if $\mathbf{C} \not \in L$}
			\end{cases};
			$
			\item
			$\mathsf{S} =
			\begin{cases}
				\{ \Wmc \}, & \text{if $\mathbf{N} \in L$} \\
				\emptyset, & \text{if $\mathbf{N} \not \in L$}
			\end{cases};
			$
		\end{itemize}

}}
%%% OLD - NEIGHBOURHOOD FUNCTION DEFINITION
%\begin{itemize}
%	\item for $\mathit{L} = \mathbf{E}$:
%		\begin{align*}
%			\Nmc_{i}(n) = \big\{ \alpha \mid & \textnormal{\ for some} \ \Box_{i}\gamma \in \Gamma^{x}_{n} \colon \\
%			& \lfloor \gamma \rfloor_{x} \subseteq \alpha \subseteq \lceil \gamma \rceil_{x} \big\};
%		\end{align*}
%	\item for $\mathit{L} = \mathbf{M}$:
%		\[
%			\Nmc_{i}(n) = \big\{ \alpha \mid \textnormal{for some} \  \Box_{i}\gamma \in \Gamma^{x}_{n}  \colon \lfloor \gamma \rfloor_{x} \subseteq \alpha \big\};
%		\]
%	\item for $\mathit{L} = \mathbf{C}$:
%%		\[
%		\begin{align*}
%			\Nmc_{i}(n) =
%			\big\{ \alpha \mid & \textnormal{\ for some \ }\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n} \colon \\
%%\phantom{\Nmc_{i}(n) = \{  \alpha \mid \, }
%			& \bigcap^{k}_{j = 1} \lfloor \gamma_{j} \rfloor_{{{x}_{j}}}
%				\subseteq \alpha \subseteq
%				\bigcap^{k}_{j = 1} \lceil \gamma_{j} \rceil_{{{x}_{j}}} \big\};
%		\end{align*}
%%		\]
%	\item for $\mathit{L} = \mathbf{N}$:
%		\begin{align*}
%			\Nmc_{i}(n) = \big\{ \alpha \mid & \textnormal{\ for some\ } \ \Box_{i}\gamma \in \Gamma^{x}_{n} \colon \\
%			& \lfloor \gamma \rfloor_{x} \subseteq \alpha \subseteq \lceil \gamma \rceil_{x} \big\} \cup \Wmc;
%		\end{align*}
%\end{itemize}

	\item
	{{
	$\Delta_{n} = \{ x \mid x \ \text{is a term occurring in} \ S_{n} \}$;
	}}
%	$\Delta_{n} = \{ x \in \mathsf{N_{V}} \mid x \ \text{occurs in} \ S_{n} \}$;
	\item $A^{\Imc_{n}} = \{ x \in \Delta_{n} \mid n : A(x) \in S_{n} \}$;
	\item
	{{
	$a^{\Imc_{n}} =
	\begin{cases}
		a, & \text{if $a$ occurs in $S_{n}$} \\
		\text{arbitrary}, & \text{otherwise}
	\end{cases}$
	;
%	\todo{M: todo discuss}
	}}
	\item $r^{\Imc_{n}} = \{ (x, y) \in \Delta_{n} \times \Delta_{n} \mid n : r(x, y) \in S_{n} \ \text{or} \ n : r(z, y) \in S_{n}, $
	for some $z$ blocking $x$ in $S_{n}\}$.
\end{itemize}

%First, we observe the following.
We require the following claims.

\begin{claim}
\label{cla:modelcond}
  For $\mathbf{X}\in\{\mathbf{M,C,N,T,P,Q,D}\}$,
  if $\mathbf{X}\in\Lvar$,
  then $\Mmc$ satisfies the $X$-condition.
\end{claim}
%\begin{proof}[Proof of Claim]
%
%\begin{itemize}
%\item For $\mathit{L}  = \mathbf{M}$, we have that $\Mmc = (\Fmc, \Int)$ is such that $\Fmc = (\Wmc,  \{\Nmc_i \}_{i \in I})$ is supplemented. Indeed,
%for all $n \in \Wmc$, $\alpha,\beta\subseteq \Wmc$, suppose that $\alpha\in \Nmc_{i}(n)$ and $\alpha \subseteq \beta$. By definition, this implies that: for some $\Box_{i} \gamma \in \Gamma^{x}_{n} $, $\lfloor \gamma \rfloor_{x} \subseteq \alpha \subseteq \beta$. Hence, $\beta \in \Nmc_{i}(n)$.
%	\item For $\mathit{L}  = \mathbf{C}$, we have that $\Mmc = (\Fmc, \Int)$ is such that $\Fmc = (\Wmc,  \{\Nmc_i \}_{i \in I})$ is closed under intersection. Indeed, for all $n \in \Wmc$, $\alpha,\beta\subseteq \Wmc$, suppose that $\alpha\in \Nmc_{i}(n)$ and $\beta\in \Nmc_{i}(n)$.
%	Now suppose that, for some
%				$\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n} \colon
%				\bigcap^{k}_{j = 1} \lfloor \gamma_{j} \rfloor_{{x}_{j}}
%				\subseteq \alpha \subseteq
%				\bigcap^{k}_{j = 1} \lceil \gamma_{j} \rceil_{{x}_{j}}$
%	and, for some
%				$\Box_{i}\delta_{1} \in \Gamma^{y_{1}}_{n}, \ldots, \Box_{i}\delta_{h} \in \Gamma^{y_{h}}_{n}  \colon
%				 \bigcap^{h}_{j = 1} \lfloor \delta_{j} \rfloor_{y_{j}}
%				  \subseteq \beta \subseteq
%				  \bigcap^{h}_{j = 1} \lceil \delta_{j} \rceil_{y_{j}}$.
%%				 This implies that, for some $\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n}$ and some $\Box_{i}\delta_{1} \in \Gamma^{y_{1}}_{n}, \ldots, \Box_{i}\delta_{h} \in \Gamma^{y_{h}}_{n} $, we have
%%				 \[
%%				 \bigcap^{k}_{j = 1} \lfloor \gamma_{j} \rfloor_{{x}_{j}} \cap \bigcap^{h}_{j = 1} \lfloor \delta_{j} \rfloor_{y_{j}}
%%				 \subseteq
%%				 \alpha \cap \beta
%%				 \subseteq
%%				 \bigcap^{k}_{j = 1} \lceil \gamma_{j} \rceil_{{x}_{j}} \cap \bigcap^{h}_{j = 1} \lceil \delta_{j} \rceil_{y_{j}}
%%				 \]
%%	This implies that $\alpha\cap\beta\in \Nmc_{i}(n)$.
%				 Then for some $\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n}$ and some $\Box_{i}\delta_{1} \in \Gamma^{y_{1}}_{n}, \ldots, \Box_{i}\delta_{h} \in \Gamma^{y_{h}}_{n} $ the following holds, which in turn implies that
%				 $\alpha\cap\beta\in \Nmc_{i}(n)$:
%%				 \[
%%				 \bigcap^{k}_{j = 1} \lfloor \gamma_{j} \rfloor_{{x}_{j}} \cap \bigcap^{h}_{j = 1} \lfloor \delta_{j} \rfloor_{y_{j}}
%%				 \subseteq
%%				 \alpha \cap \beta
%%				 \subseteq
%%				 \bigcap^{k}_{j = 1} \lceil \gamma_{j} \rceil_{{x}_{j}} \cap \bigcap^{h}_{j = 1} \lceil \delta_{j} \rceil_{y_{j}}
%%				 \]				
%				 \begin{center}$\bigcap^{k}_{j = 1} \lfloor \gamma_{j} \rfloor_{{x}_{j}} \cap \bigcap^{h}_{j = 1} \lfloor \delta_{j} \rfloor_{y_{j}}
%				 \subseteq
%				 \alpha \cap \beta
%				 \subseteq
%				 \bigcap^{k}_{j = 1} \lceil \gamma_{j} \rceil_{{x}_{j}} \cap \bigcap^{h}_{j = 1} \lceil \delta_{j} \rceil_{y_{j}}$\end{center}
%				 
%	\item For $\mathit{L}  = \mathbf{N}$, we have that $\Mmc = (\Fmc, \Int)$, with $\Fmc = (\Wmc,  \{\Nmc_i \}_{i \in I})$, is such that $\Fmc$ contains the unit. Indeed, by construction, for all $n \in \Wmc$, $\Wmc \in \Nmc_{i}(n)$.
%\end{itemize}
%\end{proof}
\begin{proof}[Proof of Claim]

\quad

\begin{enumerate}[leftmargin=*, align=left]
	\item[$\mathbf{M}\in\Lvar$.] Suppose that $\alpha\in \Nmc_{i}(n)$ and $\alpha \subseteq \beta \subseteq \Wmc$. 
By definition, there are
$\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n}$ 
%\todo{T:specify where}
such that $\mathsf{LB}(\overline{\gamma_{k}}) \subseteq \alpha$. 
Then $\mathsf{LB}(\overline{\gamma_{k}}) \subseteq \beta$, 
hence $\beta \in \Nmc_{i}(n)$.

	\item[$\mathbf{C}\in\Lvar$.] Suppose that $\alpha,\beta\in \Nmc_{i}(n)$.
Then there are
$\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n}$ 
such that $\mathsf{LB}(\overline{\gamma_{k}}) \subseteq \alpha \subseteq \mathsf{UB}(\overline{\gamma_{k}})$,
and there are
$\Box_{i}\delta_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\delta_{h} \in \Gamma^{{x}_{h}}_{n}$ 
such that $\mathsf{LB}(\overline{\delta_{h}}) \subseteq \beta \subseteq \mathsf{UB}(\overline{\delta_{h}})$.
Then 
$\mathsf{LB}(\overline{\gamma_{k}}) \cap \mathsf{LB}(\overline{\delta_{h}}) = \mathsf{LB}(\overline{\gamma_{k},\delta_h}) \subseteq \alpha\cap\beta
\subseteq \mathsf{UB}(\overline{\gamma_{k}}) \cap \mathsf{UB}(\overline{\delta_{h}}) = \mathsf{UB}(\overline{\gamma_{k},\delta_h})$,
which implies $\alpha\cap\beta\in \Nmc_{i}(n)$.
%				 \begin{center}$\bigcap^{k}_{j = 1} \lfloor \gamma_{j} \rfloor_{{x}_{j}} \cap \bigcap^{h}_{j = 1} \lfloor \delta_{j} \rfloor_{y_{j}}
%				 \subseteq
%				 \alpha \cap \beta
%				 \subseteq
%				 \bigcap^{k}_{j = 1} \lceil \gamma_{j} \rceil_{{x}_{j}} \cap \bigcap^{h}_{j = 1} \lceil \delta_{j} \rceil_{y_{j}}$\end{center}
				 
	\item[$\mathbf{N}\in\Lvar$.] By construction, $\Wmc \in \Nmc_{i}(n)$ for all $n \in \Wmc$.
	
	\item[$\mathbf{P}\in\Lvar$.] Suppose that $\alpha\in\Nmc_{i}(n)$. 
Then there are
$\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n}$ 
such that $\mathsf{LB}(\overline{\gamma_{k}}) \subseteq \alpha \subseteq \mathsf{UB}(\overline{\gamma_{k}})$.
Since $\T$ is $\LnALC$-complete,
by the rule $\mathsf{R}_{\mathit{L}\mathbf{P}}$,
there is 
%$m\in\mathsf{L}_{\T}$ 
$m$
such that 
%$m\in \lfloor \gamma_{j} \rfloor_{{{x}_{j}}}$
$m: \gamma_{j} \in \T$ for all $1 \leq j \leq k$, that is $m\in\mathsf{LB}(\overline{\gamma_{k}})$.
Then $\alpha\not=\emptyset$.

	\item[$\mathbf{Q}\in\Lvar$.] Suppose that $\alpha\in\Nmc_{i}(n)$. 
Then there are
$\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n}$ 
such that $\mathsf{LB}(\overline{\gamma_{k}}) \subseteq \alpha \subseteq \mathsf{UB}(\overline{\gamma_{k}})$.
Since $\T$ is $\LnALC$-complete,
by the rule $\mathsf{R}_{\mathit{L}\mathbf{Q}}$,
there is $m$ %$m\in\mathsf{L}_{\T}$ 
such that 
$m: \dot{\lnot}\gamma_{j} \in \T$ for some $1 \leq j \leq k$, that is $m\in\Wmc$ and $m\notin\lceil \gamma_{j} \rceil_{{{x}_{j}}}$,
hence $m\notin\mathsf{UB}(\overline{\gamma_{k}})$.
Then $\alpha\not=\Wmc$.

	\item[$\mathbf{D}\in\Lvar$.] Suppose that $\alpha,\beta\in \Nmc_{i}(n)$.
Then there are
$\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n}$ 
such that $\mathsf{LB}(\overline{\gamma_{k}}) \subseteq \alpha \subseteq \mathsf{UB}(\overline{\gamma_{k}})$,
and there are
$\Box_{i}\delta_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\delta_{h} \in \Gamma^{{x}_{h}}_{n}$ 
such that $\mathsf{LB}(\overline{\delta_{h}}) \subseteq \beta \subseteq \mathsf{UB}(\overline{\delta_{h}})$.
Since $\T$ is $\LnALC$-complete,
b the rule $\mathsf{R}_{\mathit{L}\mathbf{D}}$,
there is $m$ %$m\in\mathsf{L}_{\T}$ 
such that 
$m: \gamma_{j}, m: \delta_{\ell} \in \T$
for all $1\leq j\leq k$, $1\leq \ell \leq h$;
or
$m: \dot{\lnot}\gamma_{j}, m: \dot{\lnot}\delta_{\ell} \in \T$
for some $1\leq j\leq k$, $1\leq \ell \leq h$.
In the first case,
$m \in \mathsf{LB}(\overline{\gamma_{k}}) \cap \mathsf{LB}(\overline{\delta_{h}})$,
% = \mathsf{LB}(\overline{\gamma_{k},\delta_h})$; 
%which implies 
hence $m\in\alpha\cap\beta$.
In the second case, 
$m\in(\Wmc\setminus\mathsf{UB}(\overline{\gamma_{k}})) \cap (\Wmc\setminus\mathsf{UB}(\overline{\delta_{h}}))$,
hence 
$m\in(\Wmc\setminus\alpha)\cap(\Wmc\setminus\beta)$.
In either case $\beta\neq\Wmc\setminus\alpha$.

	\item[$\mathbf{T}\in\Lvar$.] Suppose that $\alpha\in\Nmc_{i}(n)$. 
Then there are
$\Box_{i}\gamma_{1}  \in \Gamma^{{x}_{1}}_{n}, \ldots, \Box_{i}\gamma_{k} \in \Gamma^{{x}_{k}}_{n}$ 
such that $\mathsf{LB}(\overline{\gamma_{k}}) \subseteq \alpha \subseteq \mathsf{UB}(\overline{\gamma_{k}})$.
Since $\T$ is $\LnALC$-complete,
by the rule $\mathsf{R}_{\mathit{L}\mathbf{T}}$,
$n: \gamma_{j} \in \T$ for all $1 \leq j \leq k$,
then $n\in \mathsf{LB}(\overline{\gamma_{k}})$,
thus $n\in\alpha$.\qedhere
\end{enumerate}
\end{proof}

%We then require the following claims.
%
\begin{claim}
\label{cla:conind}
For every $n \in \Wmc$, $C \in \conneg(\p)$, and $x \in \Delta_{n}$: if $n : C(x) \in S_{n}$, then $x \in C^{\Imc_{n}}$.
\end{claim}
\begin{proof}[Proof of Claim]
We show the claim by induction on the weight of $C$ (in NNF).
The base case of $C = A$ comes immediately from the definitions.
For the base case of $C = \lnot A$, suppose that $n : \lnot A(x) \in S_{n}$. Since $\T$ is clash-free, we have that $n : A(x) \not \in S_{n}$, and thus $x \not \in A^{\Imc_{n}}$ by definition of $A^{\Imc_{n}}$, meaning $x \in (\lnot A)^{\Imc_{n}}$.
The inductive cases of $C = D \sqcap E$ and $C = D \sqcup E$ come from the fact that $S_{n}$ is closed under $\mathsf{R}_{\sqcap}$ and $\mathsf{R}_{\sqcup}$, respectively, and straightforward applications of the inductive hypothesis.
We show the remaining cases (cf. also~\cite[Claim 15.2]{GabEtAl03}).

%\nb{M: added, to be checked}
\begin{enumerate}[leftmargin=*, align=left]
	\item[$C = \exists r.D$.]
Let $n : \exists r.D(x) \in S_{n}$, meaning that $\exists r.D \in \Gamma^{x}_{n}$. We distinguish two cases.
\begin{itemize}
\item[$(i)$] $x$ is not blocked by any variable in $S_{n}$. Since $S_{n}$ is closed under $\mathsf{R}_{\exists}$, there exists $y$ occurring in $S_{n}$ such that $n : r(x,y) \in S_{n}$ and $n : D(y) \in S_{n}$. Thus, by definition, $(x, y) \in r^{\Imc_{n}}$ and $n : D(y) \in S_{n}$. By inductive hypothesis, we obtain that $x \in (\exists r.D)^{\Imc_{n}}$.

\item[$(ii)$] $x$ is blocked by a variable in $S_{n}$, implying that there exists a $<$-minimal (since $<$ is a well-ordering) $y$ occurring in $S_{n}$ such that $y < x$ and $\{ E \mid n : E(x) \in S_{n} \} \subseteq \{ E \mid n : E(y) \in S_{n} \}$.
In turn, this implies that $y$ is not blocked by any other variable $z$ in $S_{n}$ (for otherwise $z$ would block $x$, with $z < y$, against the fact that $y$ is $<$-minimal).
By reasoning as in the case above, since $y$ is not blocked and $S_{n}$ is closed under $\mathsf{R}_{\exists}$, we have a variable $z$ occurring in $S_{n}$ such that $n : r(y,z) \in S_{n}$ and $n : D(z) \in S_{n}$.
Since $y$ blocks $x$, by definition we have that $(x, z) \in r^{\Imc_{n}}$, and by inductive hypothesis we get from $n : D(z)$ that $z \in D^{\Imc_{n}}$.
Thus, $x \in (\exists r.D)^{\Imc_{n}}$.
\end{itemize}

\item[$C = \forall r.D$.]
Let $n : \forall r.D(x) \in S_{n}$, meaning that $\forall r.D \in \Gamma^{x}_{n}$, and suppose that $(x, y) \in r^{\Imc_{n}}$. By definition, either $n : r(x,y) \in S_{n}$ or $n : r(z,y) \in S_{n}$, for some $z$ blocking $x$ in $S_{n}$.
In the former case, since $S_{n}$ is closed under $\mathsf{R}_{\forall}$, we get that $n : D(y) \in S_{n}$.
In the latter case, since $z$ blocks $x$ in $S_{n}$, we obtain $n : \forall r.D(z) \in S_{n}$; again, since $S_{n}$ is closed under $\mathsf{R}_{\forall}$, this implies that $n : D(y) \in S_{n}$.
Hence, in both cases, we have $n : D(y) \in S_{n}$.
By inductive hypothesis, this means that $y \in D^{\Imc_{n}}$.
Since $y$ was arbitrary, we conclude that $x \in (\forall r.D)^{\Imc_{n}}$.

%The inductive cases of $C = \exists r.D$ and $C = \forall r.D$ can be proved analogously to~\cite[Claim 15.2]{GabEtAl03}.\nb{M: todo add?}
%We show the %remaining
%modal cases.

%$C = \exists r.D$. \ldots\nb{M: todo add}
%
%$C = \forall r.D$. \ldots\nb{M: todo add}

\item[$C = \Box_{i} D$.]
Let $n : \Box_{i} D(x) \in S_{n}$, meaning that $\Box_{i} D \in \Gamma^{x}_{n}$.
		We have by inductive hypothesis that
	$\lfloor D \rfloor_{x} = \{ n \in \Wmc \mid n : D(x) \in S_{n} \} \subseteq \{ n \in \Wmc \mid x \in D^{\Imc_{n}} \} = \llbracket D \rrbracket^{\Mmc}_{x}$.
	By inductive hypothesis %(since $| D | = | \dnot D |$), 
	(since $| \dnot D | = | D |$), 
	we also have that
	$\{ n \in \Wmc \mid n : \dnot D(x) \in S_{n} \} \subseteq \{ n \in \Wmc \mid x \in (\dnot D)^{\Imc_{n}} \} = \llbracket \dnot D \rrbracket^{\Mmc}_{x} = \Wmc \setminus \llbracket D \rrbracket^{\Mmc}_{x}$.
	Hence, $\llbracket D \rrbracket^{\Mmc}_{x} \subseteq \Wmc \setminus \{ w \in \Wmc \mid n : \dnot D(x) \in S_{n} \} = \lceil D \rceil_{x}$. In conclusion, we have $\Box_{i} D \in \Gamma^{x}_{n} $ such that $\lfloor D \rfloor_{x} \subseteq \llbracket D \rrbracket^{\Mmc}_{x} \subseteq \lceil D \rceil_{x}$. Thus, by definition, $\llbracket D \rrbracket^{\Mmc}_{x} \in \Nmc_{i}(n)$, as required.
(If $\mathbf{M}\in\Lvar$, $\lfloor D \rfloor_{x} \subseteq \llbracket D \rrbracket^{\Mmc}_{x}$, and by definition this means $\llbracket D \rrbracket^{\Mmc}_{x} \in \Nmc_{i}(n)$, as required.)

	\item[$C = \Diamond_{i} D$.]
Let $n : \Diamond_{i}D(x) \in S_{n}$. 
We distinguish two cases.

\begin{itemize}
\item[$(i)$] There exists no $\Box_{i} \gamma \in \Gamma^{y}_{n}$.
Then if $\mathbf{N}\notin\Lvar$, $\Nmc_{i}(n) = \emptyset$, thus $\Wmc \setminus \llbracket D \rrbracket^{\Mmc}_{x} \not \in \Nmc_{i}(n)$, meaning that $x \in (\Diamond_{i}D)^{\Imc_{n}}$.
If instead $\mathbf{N}\in\Lvar$,
then $\Nmc_{i}(n) = \Wmc$.
Moreover, since $\T$ is $\LnALC$-complete, 
by the rule $\mathsf{R}_{\mathit{L}\mathbf{N}}$,
there is 
$m$
such that 
$m : D(x) \in S_{m}$. By inductive hypothesis, this implies $x \in D^{\Imc_{m}}$, that is, $\llbracket D \rrbracket^{\Mmc}_{x} \neq \emptyset$. Then we have $\Wmc \setminus \llbracket D \rrbracket^{\Mmc}_{x} \neq \Wmc$, and thus $\Wmc \setminus \llbracket D \rrbracket^{\Mmc}_{x} \not \in \Nmc_{i}(n)$. Hence, $x \in (\Diamond_{i}D)^{\Imc_{n}}$.


\item[$(ii)$] There exist $\Box_{i} \gamma_{1} \in \Gamma^{y_{1}}_{n}, \ldots, \Box_{i} \gamma_{k} \in \Gamma^{y_{k}}_{n}$.
		Since $\T$ is $\LnALC$-complete, there exists $m \in \Wmc$ such that:
$\gamma_{1}  \in \Gamma^{y_{1}}_{m}, \ldots, \gamma_{k} \in \Gamma^{y_{k}}_{m}$ and $D \in \Gamma^{x}_{m}$; or
$\dnot \gamma_{j} \in \Gamma^{y_{j}}_{m}$ and $\dnot D \in \Gamma^{x}_{m}$, for some $j\leq k$.
				By inductive hypothesis, the previous step implies that there exists $m \in \Wmc$ such that:
$\gamma_{1} \in \Gamma^{y_{1}}_{m}, \ldots, \gamma_{k} \in \Gamma^{y_{k}}_{m}$ and $x \in D^{\Imc_{m}}$; or
$\dnot \gamma_{j} \in \Gamma^{y_{j}}_{m}$ and $x \in \dnot D^{\Imc_{m}}$, for some $j\leq k$.
Thus
$\bigcap_{j = 1}^{k} \lfloor \gamma_{j} \rfloor_{y_{j}} \not\subseteq \Wmc \setminus \llbracket D \rrbracket^{\Mmc}_{x}$; or
$\Wmc \setminus \llbracket D \rrbracket^{\Mmc}_{x} \not\subseteq \bigcap_{j = 1}^{k}\lceil \gamma_{l} \rceil_{y_{l}}$.
Since this holds for every $\Box_{i} \gamma_{1} \in \Gamma^{y_{1}}_{n}, \ldots, \Box_{i} \gamma_{k} \in \Gamma^{y_{k}}_{n}$, we conclude that $\Wmc \setminus  \llbracket D \rrbracket^{\Mmc}_{x} \not \in \Nmc_{i}(n)$, i.e., $x \in (\Diamond_{i}D)^{\Imc_{n}}$, as required.
(If $\mathbf{M}\in\Lvar$, 
there exists $m \in \Wmc$ such that
$\gamma_{1}  \in \Gamma^{y_{1}}_{m}, \ldots, \gamma_{k} \in \Gamma^{y_{k}}_{m}$ and $D \in \Gamma^{x}_{m}$,
thus
$x \in D^{\Imc_{m}}$,
hence
$\bigcap_{j = 1}^{k} \lfloor \gamma_{j} \rfloor_{y_{j}} \not\subseteq \Wmc \setminus \llbracket D \rrbracket^{\Mmc}_{x}$,
therefore $\Wmc \setminus  \llbracket D \rrbracket^{\Mmc}_{x} \not \in \Nmc_{i}(n)$.)\qedhere
\end{itemize}
\end{enumerate}
\end{proof}



\begin{claim}
\label{cla:forind}
For every $n \in \Wmc$ and $\psi \in \conneg(\p)$: if $n : \psi \in S_{n}$, then $\Mmc, n \models \psi$.
\end{claim}
\begin{proof}[Proof of Claim]
We prove the claim by induction on the weight of $\p$ (in NNF).

%\todo{M: to discuss. T: What?}

\begin{enumerate}[leftmargin=*, align=left]
	\item[$\psi = C(a)$.] 
	{{Let $n : C(a) \in S_{n}$. By definition of $\Imc_{n}$ and Claim~\ref{cla:conind}, we have that $a^{\Imc_{n}} \in C^{\Imc_{n}}$, hence $\Mmc, n \models C(a)$. (For $\psi = \lnot C(a)$, recall that $\lnot C(a)$ is equivalent to $D(a)$ with $D = \lnot C$).}}



	\item[$\psi = r(a,b)$.]
{{Let $n: r(a,b) \in S_{n}$. By definition of $\Imc_{n}$, this implies $(a^{\Imc_{n}}, b^{\Imc_{n}}) \in r^{\Imc_{n}}$, hence $\Mmc, n \models r(a,b)$.}}

	\item[$\psi = \lnot r(a,b)$.]
{{ Let $n: \lnot r(a,b) \in S_{n}$. Since $\mathbf{T}$ is clash-free, we have that $n: r(a,b) \not \in S_{n}$. Thus, by definition
of $\Imc_{n}$
%$r^{\Imc_{n}}$,
we have $(a^{\Imc_{n}}, b^{\Imc_{n}}) \not \in r^{\Imc_{n}}$, meaning that $\Mmc, n \not \models r(a,b)$.
}}

	\item[$\psi = (\top \sqsubseteq C)$.] Let $n : \top \sqsubseteq C \in S_{n}$ and let $x \in \Delta_{n}$. Since $S_{n}$ is closed under $(\mathsf{R}_{\sqsubseteq})$ and $x$ occurs in $S_{n}$, we have that $n : C(x) \in S_{n}$. By Claim~\ref{cla:conind}, we have that $x \in C^{\Imc_{n}}$. Given that $x$ is arbitrary, we conclude that $\Mmc, n \models \top \sqsubseteq C$.

	\item[$\psi = \lnot (\top \sqsubseteq C)$.] Let $n : \lnot (\top \sqsubseteq C) \in S_{n}$. Since $S_{n}$ is closed under $(\mathsf{R}_{\not\sqsubseteq})$, there exists $x$ occurring in $S_{n}$ such that $n : \dnot C(x) \in S_{n}$. By Claim~\ref{cla:conind}, we obtain that $x \in (\dnot C)^{\Imc_{n}}$, for some $x \in \Delta_{w}$. Hence, $\Mmc, n \models \lnot (\top \sqsubseteq C)$.
\end{enumerate}

The inductive cases of 
$\psi = \chi \land \vartheta$
and
$\psi = \chi \lor \vartheta$ follow from the definitions and straighforward applications of the inductive hypothesis.
%
%The inductive cases of 
Moreover the inductive cases of 
$\psi = \Box_{i} \chi$
and 
$\psi = \Diamond_{i} \chi$ can be proved analogously to Claim~\ref{cla:conind}.
\end{proof}
%

Since,
%by~$(\mathbf{P0})$,
by definition,
we have 
$0 : \p \in S_{0} \subseteq \mathbf{T}$,
%there exists $w_{\p} \in \Wmc$ such that $\p \in \qs(w_{\p})$,
thanks to Claim~\ref{cla:forind} we obtain $\Mmc, 0 \models \p$.
{{Moreover,
by Claim~\ref{cla:modelcond}, $\Mmc$ is a
$\mathit{L}^n$ model.
Therefore $\p$ is $\LnALC$ satisfiable.}}
%for some $w_{\p} \in \Wmc$.
\end{proof}



















%%% COMPLETENESS

We finally show completeness of the $\LnALC$ tableau algorithm.

\begin{restatable}[Completeness]{theorem}{Completeness}
	\label{thm:completeness}
	If $\p$ is $\LnALC$ satisfiable, then there exists an execution of the $\LnALC$ tableau algorithm for $\p$ that constructs a complete and clash-free completion set.
%			If $\p$ is $\LnALC$ satisfiable, then
%			%, having started on the initial completion set $\T_{\p}$, 
%			the $\LnALC$ tableau algorithm
%			with $\p$ as input returns $\mathsf{satisfiable}$.
%			%}}
%	% constructs an $\LnALC$-complete and clash-free completion set for $\p$.
\end{restatable}
%






%\Completeness*
\begin{proof}
%We assume that $\mathbf{C}\in\Lvar$ and $\mathbf{M}\notin\Lvar$,
%the proof for the cases where $\mathbf{C}\notin\Lvar$ or $\mathbf{M}\in\Lvar$ can be obtained as a simplification
%of the present one.
In the proof we assume $\mathbf{C}\in\Lvar$,
for the case $\mathbf{C}\notin\Lvar$ consider $k = h = 1$.
Let $\Mmc = (\Fmc, \Imc)$ be an $\LnALC$-model satisfying $\p$, with $\Fmc = (\Wmc, \{ \Nmc \}_{i \in J})$, i.e.,
$\Mmc, w_{\p} \models \p$, for some $w_{\p} \in \Wmc$.
%
We require the following definitions and technical results.
%
%For every $d \in \Delta_{w}$, define $\tp^{\Imc_{w}}(d) = \{ C \in \conneg(\p) \mid d \in C^{\Imc_{w}} \}$,
%and let $T_{w} = \{ \tp^{\Imc_{w}}(d) \mid d \in \Delta_{w} \}$.
%Moreover, for every $t = \tp^{\Imc_{w}}(d)$, select a variable $x_{t} \in \NV$.
First, we let $\gamma, \delta$ (possibly indexed) range over $\MLnALC$ concepts and formulas, with $\llbracket \gamma \rrbracket^{\Mmc}_{d} = \llbracket \psi \rrbracket^{\Mmc}$, if $\gamma = \psi$, and $\llbracket \gamma \rrbracket^{\Mmc}_{d} = \llbracket C \rrbracket^{\Mmc}_{d}$, if $\gamma = C$.
%
Then, for $w \in \Wmc$ and $d \in \bigcup_{v \in \Wmc} \Delta_{v}$, define
$\Phi^{d}_{w} = \{ \psi \in \forneg(\p) \mid \Mmc, w \models \psi \} \cup \{ C \in \conneg(\p) \mid d \in C^{\Imc_{w}} \}$.
Observe that, if $C \in \Phi^{d}_{w}$, then $d \in \Delta_{w}$.
%%
%We now show that the following holds.
%\begin{claim}
%\label{cla:truth}
%For every $w \in \Wmc$ and every $d_{1}, \ldots, d_{k}, e \in \bigcup_{v \in \Wmc} \Delta_{v}$:
%				if $\Box_{i}\gamma_{1} \in \Phi^{d_{1}}_{w}, \ldots, \Box_{i} \gamma_{k} \in \Phi^{d_{k}}_{w}$ and $\Diamond_{i} \delta \in \Phi^{e}_{w}$, then there exists $v \in \Wmc$ such that:
%				\begin{enumerate}[label=$(\arabic*)$, start=0]
%					\item $\gamma_{1} \in \Phi^{d_{1}}_{v}, \ldots, \gamma_{k} \in \Phi^{d_{k}}_{v}$ and $\delta \in \Phi^{e}_{v}$; or
%					\item $\dnot \gamma_{1} \in \Phi^{d_{1}}_{v}$ and $\dnot \delta \in \Phi^{e}_{v}$; or
%					\item[] $\vdots$
%					\item[$(l)$] $\dnot \gamma_{l} \in \Phi^{d_{k}}_{v}$ and $\dnot \delta \in \Phi^{e}_{v}$;
%				\end{enumerate}
%where:
%for $\mathit{L} = \mathbf{E}$, $k = l = 1$;
%for $\mathit{L} = \mathbf{M}$, $k = 1$ and $l = 0$;
%for $\mathit{L} = \mathbf{C}$, $k \geq 1$ and $l = k$;
%for $\mathit{L} = \mathbf{N}$, $k = l = 1$ or $k = l = 0$.
%\end{claim}
%\begin{proof}
%
%We consider each $\mathit{L} \in \Log$.
%
%\begin{enumerate}[leftmargin=*, align=left]
%	\item[$\mathit{L} = \mathbf{E}$.] 
%		Assume $\Box_{i} \gamma \in \Phi^{d}_{w}, \Diamond_{i} \delta \in \Phi^{e}_{w}$, meaning that $\llbracket \gamma \rrbracket^{\Mmc}_{d} \in \Nmc_{i}(w)$ and $\Wmc \setminus \llbracket \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$, i.e., $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$. Towards a contradiction, suppose that, for every $v \in \Wmc$, the following holds:
%%		\begin{center}
%			($\gamma \not \in \Phi^{d}_{v}$ or $\delta \not \in \Phi^{e}_{v}$) and
%			($\dnot \gamma \not \in \Phi^{d}_{v}$ or $\dnot \delta \not \in \Phi^{e}_{v}$).
%%		\end{center}
%	Equivalently, for every $v \in \Wmc$:
%%		\begin{center}
%			($\gamma\in \Phi^{d}_{v}$ implies $\delta \not \in \Phi^{e}_{v}$) and
%			($\dnot \delta \in \Phi^{e}_{v}$ implies $\dnot \gamma \not \in \Phi^{d}_{v}$).
%%			($\dnot \gamma \in \Phi^{d}_{v}$ implies $\dnot \delta \not \in \Phi^{e}_{v}$).
%%		\end{center}
%	By definition, we have that $\gamma \in \Phi^{d}_{v}$ iff $\dnot \gamma \not \in \Phi^{d}_{v}$ and $\delta \not \in \Phi^{e}_{v}$ iff $\dnot \delta \in \Phi^{e}_{v}$. Thus, the previous step means:
%%		\begin{center}
%			($ \llbracket \gamma \rrbracket^{\Mmc}_{d} \subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$) and
%			($  \llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \subseteq \llbracket \gamma \rrbracket^{\Mmc}_{d}$),
%			i.e.,
%%			($\llbracket \dnot \gamma \rrbracket^{\Mmc}_{d} \subseteq \llbracket \delta \rrbracket^{\Mmc}_{e}$).
%%		From this
%%%		since $W \setminus [ \dnot \psi ]^{\Mmc} = \llbracket \psi \rrbracket^{\Mmc}$,
%%		we have equivalently that
%			$\llbracket \gamma \rrbracket^{\Mmc}_{d} = \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$,
%		contradicting the assumption that $\llbracket \gamma \rrbracket^{\Mmc}_{d} \in \Nmc_{i}(w)$ and $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$.
%	
%		
%			
%	\item[$\mathit{L} = \mathbf{M}$.] 
%	Assume $\Box_{i} \gamma \in \Phi^{d}_{w}, \Diamond_{i} \delta \in \Phi^{e}_{w}$, meaning that $\llbracket \gamma \rrbracket^{\Mmc}_{d} \in \Nmc_{i}(w)$ and $\Wmc \setminus \llbracket \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$, i.e., $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$. Towards a contradiction, suppose that, for every $v \in \Wmc$, the following holds:
%			$\gamma \not \in \Phi^{d}_{v}$ or $\delta \not \in \Phi^{e}_{v}$.
%	Equivalently, for every $v \in \Wmc$:
%			$\gamma\in \Phi^{d}_{v}$ implies $\delta \not \in \Phi^{e}_{v}$.
%%	By definition of $\qs(v)$, we have that $\gamma \in \Phi^{d}_{v}$ iff $\dnot \gamma \not \in \Phi^{d}_{v}$ and $\delta \not \in \Phi^{e}_{v}$ iff $\dnot \delta \in \Phi^{e}_{v}$.
%%	Thus,
%	By definition,
%	the previous step means
%			$ \llbracket \gamma \rrbracket^{\Mmc}_{d} \subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$.
%			Since $\Mmc$ is supplemented, we have that $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \in \Nmc_{i}(w)$,
%			which is impossible.
%%		contrary to the assumption that $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$.
%
%	
%	\item[$\mathit{L} = \mathbf{C}$.] 
%		Assume $\Box_{i} \gamma_{1} \in \Phi^{d_{1}}_{w}, \ldots, \Box_{i} \gamma_{k} \in \Phi^{d_{k}}_{w}, \Diamond_{i} \delta \in \Phi^{e}_{w}$, meaning that $\llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \in \Nmc_{i}(w)$, for $j = 1, \ldots, k$, and $\Wmc \setminus \llbracket \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$, i.e., $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$. Towards a contradiction, suppose that, for every $v \in \Wmc$, 
%%it is not the case that the following holds:
%%				\begin{itemize}
%%%				[label=$(\arabic*)$, start=0]
%%					\item $\gamma_{1} \in \Phi^{d_{1}}_{v}, \ldots, \gamma_{k} \in \Phi^{d_{k}}_{v}$ and $\delta \in \Phi^{e}_{v}$; or
%%					\item $\dnot \gamma_{1} \in \Phi^{d_{1}}_{v}$ and $\dnot \delta \in \Phi^{e}_{v}$; or
%%					\item[] $\vdots$
%%					\item $\dnot \gamma_{k} \in \Phi^{d_{k}}_{v}$ and $\dnot \delta \in \Phi^{e}_{v}$.
%%				\end{itemize}
%none of the following holds:
%%it is not the case that the following holds:
%$(0)$ $\gamma_{1} \in \Phi^{d_{1}}_{v}, \ldots, \gamma_{k} \in \Phi^{d_{k}}_{v}$ and $\delta \in \Phi^{e}_{v}$; 
%%or
%$(1)$ $\dnot \gamma_{1} \in \Phi^{d_{1}}_{v}$ and $\dnot \delta \in \Phi^{e}_{v}$; ...;
%%or
%$(k)$ $\dnot \gamma_{k} \in \Phi^{d_{k}}_{v}$ and $\dnot \delta \in \Phi^{e}_{v}$.
%Equivalently, for every $v \in \Wmc$,
%%				\begin{itemize}
%%%				[label=$(\arabic*)$, start=0]
%%					\item $\gamma_{1} \in \Phi^{d_{1}}_{v}, \ldots, \gamma_{k} \in \Phi^{d_{k}}_{v}$ implies $\delta \not \in \Phi^{e}_{v}$; and
%%					\item $\dnot \delta \in \Phi^{e}_{v}$ implies $\dnot \gamma_{1} \not \in \Phi^{d_{1}}_{v}$; and
%%					\item[] $\vdots$
%%					\item $\dnot \delta \in \Phi^{e}_{v}$ implies $\dnot \gamma_{k} \not \in \Phi^{d_{k}}_{v}$.
%%				\end{itemize}
%it holds that
%$(0)$ $\gamma_{1} \in \Phi^{d_{1}}_{v}, \ldots, \gamma_{k} \in \Phi^{d_{k}}_{v}$ implies $\delta \not \in \Phi^{e}_{v}$; and
%$(1)$ $\dnot \delta \in \Phi^{e}_{v}$ implies $\dnot \gamma_{1} \not \in \Phi^{d_{1}}_{v}$; ...
%and 
%$(k)$ $\dnot \delta \in \Phi^{e}_{v}$ implies $\dnot \gamma_{k} \not \in \Phi^{d_{k}}_{v}$.
%	By definition, from the previous step we obtain
%%					\begin{itemize}
%%%				[label=$(\arabic*)$, start=0]
%%					\item $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$; and
%%					\item $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \subseteq \llbracket \gamma_{1} \rrbracket^{\Mmc}_{d_{1}}$; and
%%					\item[] $\vdots$
%%					\item $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \subseteq \llbracket \gamma_{k} \rrbracket^{\Mmc}_{d_{k}}$.
%%				\end{itemize}
%$(0)$ $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$; and
%$(1)$ $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \subseteq \llbracket \gamma_{1} \rrbracket^{\Mmc}_{d_{1}}$; ...
%and
%$(k)$ $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \subseteq \llbracket \gamma_{k} \rrbracket^{\Mmc}_{d_{k}}$.
%				Hence $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} =  \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$.
%			Since $\Mmc$ is closed under intersection, we obtain $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \in \Nmc_{i}(w)$,
%			a contradiction.
%	
%	
%	
%\item[$\mathit{L} = \mathbf{N}$.] 
%	We distinguish two cases:
%%	\begin{itemize}
%%		\item Let $k = l = 0$. That is, there exists no $\Box_{i} \gamma \in \Phi^{d}_{w}$, while $\Diamond_{i} \delta \in \Phi^{e}_{w}$, meaning that $\Wmc \setminus \llbracket \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$.
%%		Towards a contradiction, suppose that, for every $v \in \Wmc$, $\delta \not \in \Phi^{e}_{v}$.
%%			Since, by definition, we have $\delta \not \in \Phi^{e}_{v}$ iff $\dnot \delta \in \Phi^{e}_{v}$, the previous step means that $\Wmc \subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$, and hence $\llbracket \delta \rrbracket^{\Mmc}_{e} = \emptyset$. Thus, $\Wmc \not \in \Nmc_{i}(w)$, contradicting the fact that $\Mmc$ contains the unit.
%%
%%		\item Let $k = l = 1$. Hence, there exists $\Box_{i} \gamma \in \Phi^{e}_{w}$ and  $\Diamond_{i} \delta \in \Phi^{e}_{w}$. We then reason similarly to the case for $\mathit{L} = \mathbf{E}$.
%%	\end{itemize}
%$(i)$ Let $k = l = 0$. That is, there exists no $\Box_{i} \gamma \in \Phi^{d}_{w}$, while $\Diamond_{i} \delta \in \Phi^{e}_{w}$, meaning that $\Wmc \setminus \llbracket \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(w)$.
%		Towards a contradiction, suppose that, for every $v \in \Wmc$, $\delta \not \in \Phi^{e}_{v}$.
%			Since, by definition, we have $\delta \not \in \Phi^{e}_{v}$ iff $\dnot \delta \in \Phi^{e}_{v}$, the previous step means that $\Wmc \subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$, and hence $\llbracket \delta \rrbracket^{\Mmc}_{e} = \emptyset$. Thus, $\Wmc \not \in \Nmc_{i}(w)$, contradicting the fact that $\Mmc$ contains the unit.
%$(ii)$ Let $k = l = 1$. Hence, there exists $\Box_{i} \gamma \in \Phi^{e}_{w}$ and  $\Diamond_{i} \delta \in \Phi^{e}_{w}$. We then reason similarly to the case for $\mathit{L} = \mathbf{E}$.	\qedhere
%\end{enumerate}
%\end{proof}
%\bigskip
%\todo{T:merge text}
%
Moreover, given a completion set $\T$ for $\p$
and $S_{n} \subseteq \T$,
%let
%$\mathsf{L}_{\T} = \{ n \in \mathsf{N_{L}} \mid S_{n} \subseteq \T \}$.
%Moreover,
let $\Gamma^{x}_{n} = \{ \psi \mid n : \psi \in S_{n} \} \cup \{ C \mid n : C(x) \in S_{n} \}$.
%
We say that a completion set $\T$ for $\p$ is \emph{$\Mmc$-compatible} if
there exists a function $\pi$ from $\mathsf{L}_{\T}$ to $\Wmc$, and, for every $n \in \mathsf{L}_{\T}$, there exists a function $\pi_{n}$ from the set of 
%variables 
{{terms}}
occurring in $S_{n}$ to $\Delta_{\pi(n)}$, such that
$\gamma \in \Gamma^{x}_{n}$ implies $\gamma \in \Phi^{\pi_{n}(x)}_{\pi(n)}$.
%\pi(n) \in \llbracket \gamma \rrbracket^{\Mmc}_{\pi_{n}(x)}$.
%\nb{M: todo fix}
%\begin{itemize}
%	\item there exists a function $\pi \colon \mathsf{L}_{\T} \to \Wmc$
%%	from $N$ to $\Wmc$
%%	the set of labels of the labelled constraints in $\T$
%	such that $n : \psi \in S_{n}$ implies $\Mmc, \pi(n) \models \psi$, for every $\psi \in \for(\p)$;
%	\item for every $n \in \mathsf{L}_{\T}$, there exists a function $\pi_{n}$ from the set of variables occurring in $S_{n}$ to $\Delta_{\pi(n)}$ such that $n: C(x) \in S_{n}$ implies $\pi_{n}(x) \in C^{\Imc_{\pi(n)}}$.
%\end{itemize}
We  require the following claim.

\begin{claim}
\label{cla:compatible}
If a completion set $\T$ for $\p$ is $\Mmc$-compatible
{{and $\Mmc$ is an $\LnALC$-model}},
%\todo{T:added condition that $\Mmc$ is an $\LnALC$-model. \\ M: thanks}
then for every  $\LnALC$-rule $\mathsf{R}$ applicable to $\T$, there exists a completion set $\T'$ obtained from $\T$ by an application of $\mathsf{R}$ such that $\T'$ is $\Mmc$-compatible.
%If a completion set $\mathbf{T}$ for $\p$ is $\Mmc$-compatible and $\mathbf{T}'$ is obtained from $\mathbf{T}$ by an application of an $\LnALC$-rule $\mathsf{R}$, then $\mathbf{T}'$ is $\Mmc$-compatible.
\end{claim}
%%Old proof
%\begin{proof}
%{{Given an $\Mmc$-compatible completion set $\T$ for $\p$ and a label $n \in \mathsf{L}_{\T}$, let $\pi$ and $\pi_{n}$ be the functions provided by the definition of $\Mmc$-compatibility.
%We need to consider each $\LnALC$-rule $\mathsf{R}$.
% For $\mathsf{R} \in \{ \mathsf{R}_{\land}, \mathsf{R}_{\lor}, \mathsf{R}_{\sqcap}, \mathsf{R}_{\sqcup}, \mathsf{R}_{\forall}, \mathsf{R}_{\exists}, \mathsf{R}_{\sqsubseteq}, \mathsf{R}_{\not\sqsubseteq} \}$, we proceed similarly to~\cite[Claim 15.14]{GabEtAl03}.
%Here we consider %the case of $\mathsf{R}_{\mathit{L}}$:
%the modal rules.
%}}
%Suppose that $\mathsf{R}_{\mathit{L}}$ is applicable to $\T$.
%	Let $\Box_{i} \gamma_{1} \in \Gamma^{x_{1}}_{n}, \ldots, \Box_{i} \gamma_{k} \in \Gamma^{x_{k}}_{n}, \Diamond_{i} \delta \in \Gamma^{y}_{n}$.
%	 Since $\T$ is $\Mmc$-compatible,
%	 we have that $\Box_{i}\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{\pi(n)}, \ldots, \Box_{i} \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{\pi(n)}$ and $\Diamond_{i} \delta \in \Phi^{\pi_{n}(y)}_{\pi(n)}$.
%Thus, by Claim~\ref{cla:truth}, there exists $v \in \Wmc$ such that:
%%\begin{itemize}
%%\item $\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{v}, \ldots, \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{v}$ and $\delta \in \Phi^{\pi_{n}(y)}_{v}$; or
%%\item $\dnot \gamma_{j} \in \Phi^{\pi_{n}(x_{j})}_{v}$ and $\dnot \delta \in \Phi^{\pi_{n}(y)}_{v}$,
%%for some $j\leq l$;
%%\end{itemize}
%$\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{v}, \ldots, \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{v}$ and $\delta \in \Phi^{\pi_{n}(y)}_{v}$; or
%$\dnot \gamma_{j} \in \Phi^{\pi_{n}(x_{j})}_{v}$ and $\dnot \delta \in \Phi^{\pi_{n}(y)}_{v}$,
%for some $j\leq l$;
%%$(0)$ $\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{v}, \ldots, \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{v}$ and $\delta \in \Phi^{\pi_{n}(y)}_{v}$; or
%%$(1)$ $\dnot \gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{v}$ and $\dnot \delta \in \Phi^{\pi_{n}(y)}_{v}$; or
%%...
%%$(l)$ $\dnot \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{v}$ and $\dnot \delta \in \Phi^{\pi_{n}(y)}_{v}$;
%where:
%for $\mathit{L} = \mathbf{E}$, $k = l = 1$;
%for $\mathit{L} = \mathbf{M}$, $k = 1$ and $l = 0$;
%for $\mathit{L} = \mathbf{C}$, $k \geq 1$ and $l = k$;
%for $\mathit{L} = \mathbf{N}$, $k = l = 1$ or $k = l = 0$.
%%
%By applying the rule $\mathsf{R}_{\mathit{L}}$ accordingly, one can obtain $\T'$ by adding
%$m : \gamma_1, \ldots, m : \gamma_k, m : \delta$, or $m : \dot{\lnot}\gamma_j, m : \dnot \delta $, for some $j\leq l$, to $\T$
%(recall that $m$ is fresh for $\T$ and $\gamma_{j}$ is either $\psi_{j} \in \forneg(\p)$ or $C_{j}(x_{j})$, with $C_{j} \in \conneg(\p)$, for $j = 1, \ldots, k$, and $\delta$ is either $\chi \in \forneg(\p)$ or $D(y)$, with $D \in \conneg(\p)$).
%%	 The application of $\mathsf{R}_{\mathit{L}}$ non-deterministically chooses to add to $\T$ either $\{ m : \gamma_1, \ldots, m: \gamma_k, m: \delta\}$, or $\{ m: \dot{\lnot}\gamma_j, o: \dot{\lnot}\delta\}$, for some $j\leq l$, where $m$ is the $\ll$-minimal label fresh for $\T$.
%%	 We set $\pi(m) = \ldots$
%By extending $\pi$ with $\pi(m) = v$, and $\pi_{m}$ with $\pi_{m}(x_{1}) = \pi_{n}(x_{1})$, \ldots, $\pi_{m}(x_{k}) = \pi_{n}(x_{k})$, $\pi_{m}(y) = \pi_{n}(y)$, we obtain that $\T'$ is $\Mmc$-compatible.
%\end{proof}
%
%To conclude, let $\T_{\p} = \{0 : \p
%%0 : \top(x)
%\}$ be the initial completion set for $\p$.
%%with $0$ being the label in $\mathbf{T}_{\p}$ and $x$ be the variable occurring in $\mathbf{T}_{\p}$.
%Define $\pi(0) = w_{\p}$ (where $\Mmc, w_{\p} \models \p$) and $\pi_{0}(x) = d$, for an arbitrary $d \in \Delta_{w_{\p}}$.
%Clearly, these functions ensure that $\T_{\p}$ is $\Mmc$-compatible.
%By Claim~\ref{cla:compatible}, we can apply the $\LnALC$-rules so that the obtained completion sets are $\Mmc$-compatible as well.
%From Theorem~\ref{thm:termination}, we have that the $\LnALC$ tableau algorithm eventually terminates, %returning an $\LnALC$-complete completion set for $\p$ that is clash-free by construction.
%providing an $\LnALC$-complete completion set for $\p$ that is clash-free by construction.
%\end{proof}
\begin{proof}
{{Given an $\Mmc$-compatible completion set $\T$ for $\p$ and a label $n \in \mathsf{L}_{\T}$, let $\pi$ and $\pi_{n}$ be the functions provided by the definition of $\Mmc$-compatibility.
We need to consider each $\LnALC$-rule $\mathsf{R}$.
 For $\mathsf{R} \in \{ \mathsf{R}_{\land}, \mathsf{R}_{\lor}, \mathsf{R}_{\sqcap}, \mathsf{R}_{\sqcup}, \mathsf{R}_{\forall}, \mathsf{R}_{\exists}, \mathsf{R}_{\sqsubseteq}, \mathsf{R}_{\not\sqsubseteq} \}$, we proceed similarly to~\cite[Claim 15.14]{GabEtAl03}.
Here we consider %the case of $\mathsf{R}_{\mathit{L}}$:
the modal rules.

%\todo{T: shouldn't we replace $\Nmc_{i}(w)$ with $\Nmc_{i}(\pi(n))$?}
\begin{enumerate}[leftmargin=*, align=left]
	\item[($\mathsf{R}_{\mathit{L}}$)]
Suppose that $\mathsf{R}_{\mathit{L}}$ is applicable to $\T$.
	Then there are $\Box_{i} \gamma_{1} \in \Gamma^{x_{1}}_{n}, \ldots, \Box_{i} \gamma_{k} \in \Gamma^{x_{k}}_{n}, \Diamond_{i} \delta \in \Gamma^{y}_{n}$.
	 Since $\T$ is $\Mmc$-compatible,
	 we have that $\Box_{i}\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{\pi(n)}, \ldots, \Box_{i} \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{\pi(n)}$ and $\Diamond_{i} \delta \in \Phi^{\pi_{n}(y)}_{\pi(n)}$,
	 meaning that $\llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \in \Nmc_{i}(\pi(n))$, for $j = 1, \ldots, k$, 
	 hence by the $C$-condition  $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}}  \in \Nmc_{i}(\pi(n))$,
	 and $\Wmc \setminus \llbracket \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(\pi(n))$, i.e., $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(\pi(n))$.
	 Then 
	 $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \neq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$
	 (if $\mathbf{M}\in\Lvar$, 
	 $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \not\subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$).
It follows that there exists $v \in \Wmc$ such that
$\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{v}, \ldots, \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{v}$ and $\delta \in \Phi^{\pi_{n}(y)}_{v}$; or
$\dnot \gamma_{j} \in \Phi^{\pi_{n}(x_{j})}_{v}$ and $\dnot \delta \in \Phi^{\pi_{n}(y)}_{v}$,
for some $j\leq k$.
%To see this, suppose towards a contradiction that
%$\gamma_{1} \in \Phi^{d_{1}}_{v}, \ldots, \gamma_{k} \in \Phi^{d_{k}}_{v}$ implies $\delta \not \in \Phi^{e}_{v}$; and
%$\dnot \delta \in \Phi^{e}_{v}$ implies $\dnot \gamma_{j} \not \in \Phi^{d_{j}}_{v}$ for all $j\leq k$.
%This means that
%$\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$; and
%$\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \subseteq \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}}$
%for all $j \leq k$, 
%that is
%$\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \subseteq \bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}}$;
%hence $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} =  \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$.
%Since $\Mmc$ is closed under intersection, we obtain $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \in \Nmc_{i}(\pi(n))$,
%a contradiction.
%
Then by applying the rule $\mathsf{R}_{\mathit{L}}$ %to $\T$ 
accordingly, 
%Then, depending on the case, we apply the rule $\mathsf{R}_{\mathit{L}}$ accordingly and 
we expand $\T$ to $\T'$ with
$m : \gamma_1, \ldots, m : \gamma_k, m : \delta$, or with $m : \dot{\lnot}\gamma_j, m : \dnot \delta $, for some $j\leq k$,
for some $m$ satisfying the application condition of $\mathsf{R}_{\mathit{L}}$.
Since $m$ is fresh, we can extend $\pi$ with $\pi(m) = v$, and $\pi_{m}$ with $\pi_{m}(x_{1}) = \pi_{n}(x_{1})$, \ldots, $\pi_{m}(x_{k}) = \pi_{n}(x_{k})$, $\pi_{m}(y) = \pi_{n}(y)$, thus obtaining that $\T'$ is $\Mmc$-compatible.

	\item[($\mathsf{R}_{\mathit{L}\mathbf{N}}$)]
	Suppose that $\mathsf{R}_{\mathit{L}\mathbf{N}}$ is applicable to $\T$.
	Then there is $\Diamond_{i} \delta \in \Gamma^{y}_{n}$.
	 Since $\T$ is $\Mmc$-compatible,
	 we have that $\Diamond_{i} \delta \in \Phi^{\pi_{n}(y)}_{\pi(n)}$,
%	 meaning that $\Wmc \setminus \llbracket \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(\pi(n))$, i.e., $\llbracket \dnot \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(\pi(n))$.
%	 It follows that there exists $v \in \Wmc$ such that $\delta \in \Phi^{\pi_{n}(y)}_{v}$. 
%	 To see this, suppose towards a contradiction that
%	 for every $v \in \Wmc$, $\delta \not \in \Phi^{e}_{v}$.
%	Since, by definition, we have $\delta \not \in \Phi^{e}_{v}$ iff $\dnot \delta \in \Phi^{e}_{v}$, the previous step means that $\Wmc \subseteq \llbracket \dnot \delta \rrbracket^{\Mmc}_{e}$, and hence $\llbracket \delta \rrbracket^{\Mmc}_{e} = \emptyset$. Thus, $\Wmc \not \in \Nmc_{i}(\pi(n))$, contradicting the fact that $\Mmc$ contains the unit.
	 meaning that $\Wmc \setminus \llbracket \delta \rrbracket^{\Mmc}_{e} \not \in \Nmc_{i}(\pi(n))$.
	 At the same time, by the $N$-condition, $\Wmc \in \Nmc_{i}(\pi(n))$,
	  hence $\llbracket \delta \rrbracket^{\Mmc}_{e} \not= \emptyset$,
	 that is there exists $v \in \Wmc$ such that $\delta \in \Phi^{\pi_{n}(y)}_{v}$. 
	Then we expand $\T$ with $m : \delta$, for some $m$ satisfying the application condition of $\mathsf{R}_{\mathit{L}\mathbf{N}}$.
Since $m$ is fresh, we can extend $\pi$ with $\pi(m) = v$, and $\pi_{m}$ with $\pi_{m}(y) = \pi_{n}(y)$, thus obtaining that $\T'$ is $\Mmc$-compatible.
	
	\item[($\mathsf{R}_{\mathit{L}\mathbf{P}}$)]
Suppose that $\mathsf{R}_{\mathit{L}\mathbf{P}}$ is applicable to $\T$.
	Then there are $\Box_{i} \gamma_{1} \in \Gamma^{x_{1}}_{n}, \ldots, \Box_{i} \gamma_{k} \in \Gamma^{x_{k}}_{n}$.
	 Since $\T$ is $\Mmc$-compatible,
	 we have that $\Box_{i}\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{\pi(n)}, \ldots, \Box_{i} \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{\pi(n)}$, 
	 meaning that $\llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \in \Nmc_{i}(\pi(n))$, for $j = 1, \ldots, k$,
	 hence $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \in \Nmc_{i}(\pi(n))$.
	 At the same time, by the $P$-condition, 
	 $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \neq \emptyset$,
	that is there exists $v \in \Wmc$ such that
	$\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{v}, \ldots, \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{v}$.
	Then we expand $\T$ with $m : \gamma_1, \ldots, m : \gamma_k$,
	for some $m$ satisfying the application condition of $\mathsf{R}_{\mathit{L}\mathbf{P}}$.
	Since $m$ is fresh, we can extend $\pi$ with $\pi(m) = v$, and $\pi_{m}$ with $\pi_{m}(x_{1}) = \pi_{n}(x_{1})$, \ldots, $\pi_{m}(x_{k}) = \pi_{n}(x_{k})$, thus obtaining that $\T'$ is $\Mmc$-compatible.

	\item[($\mathsf{R}_{\mathit{L}\mathbf{Q}}$)]
	Suppose that $\mathsf{R}_{\mathit{L}\mathbf{Q}}$ is applicable to $\T$.
	Then there are $\Box_{i} \gamma_{1} \in \Gamma^{x_{1}}_{n}, \ldots, \Box_{i} \gamma_{k} \in \Gamma^{x_{k}}_{n}$.
	 Since $\T$ is $\Mmc$-compatible,
	 we have that $\Box_{i}\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{\pi(n)}, \ldots, \Box_{i} \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{\pi(n)}$, 
	 meaning that $\llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \in \Nmc_{i}(\pi(n))$, for $j = 1, \ldots, k$,
	 hence $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \in \Nmc_{i}(\pi(n))$.
	 At the same time, by the $Q$-condition, 
	 $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \neq \Wmc$,
	that is there exists $v \in \Wmc$ such that
	$\gamma_{j} \notin \Phi^{\pi_{n}(x_{j})}_{v}$ for some $j\leq k$.
	Then by applying $\mathsf{R}_{\mathit{L}\mathbf{Q}}$ accordingly, we expand $\T$ with $m : \dot{\lnot}\gamma_j$,
	for some $m$ satisfying the application condition of $\mathsf{R}_{\mathit{L}\mathbf{Q}}$.
	Since $m$ is fresh, we can extend $\pi$ with $\pi(m) = v$, and 
%	\todo{AM: to discuss?}
	{{$\pi_{m}$ with $\pi_{m}(x_{j}) = \pi_{n}(x_{j})$,  thus obtaining that $\T'$ is $\Mmc$-compatible.}}

	\item[($\mathsf{R}_{\mathit{L}\mathbf{D}}$)]
	Suppose that $\mathsf{R}_{\mathit{L}\mathbf{D}}$ is applicable to $\T$.
	Then there are $\Box_{i} \gamma_{1} \in \Gamma^{x_{1}}_{n}, \ldots, \Box_{i} \gamma_{k} \in \Gamma^{x_{k}}_{n}, \Box_{i} \delta_{1} \in \Gamma^{y_{1}}_{n}, \ldots, \Box_{i} \delta_{h} \in \Gamma^{y_{h}}_{n}$.
	Since $\T$ is $\Mmc$-compatible,
	we have that $\Box_{i}\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{\pi(n)}, \ldots, \Box_{i} \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{\pi(n)}$,
	and $\Box_{i}\delta_{1} \in \Phi^{\pi_{n}(y_{1})}_{\pi(n)}, \ldots, \Box_{i} \delta_{h} \in \Phi^{\pi_{n}(y_{h})}_{\pi(n)}$, 
	meaning that $\llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \in \Nmc_{i}(\pi(n))$, for $j = 1, \ldots, k$,
	and $\llbracket \delta_{\ell} \rrbracket^{\Mmc}_{e_{\ell}} \in \Nmc_{i}(\pi(n))$, for $\ell = 1, \ldots, h$;
	hence $\bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}} \in \Nmc_{i}(\pi(n))$,
	and $\bigcap_{\ell = 1}^{h} \llbracket \delta_{\ell} \rrbracket^{\Mmc}_{e_{\ell}} \in \Nmc_{i}(\pi(n))$.
	By the $D$-condition, 
	$\bigcap_{\ell = 1}^{h} \llbracket \delta_{\ell} \rrbracket^{\Mmc}_{e_{\ell}} \not=\Wmc \setminus \bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}}$
	(if $\mathbf{M}\in\Lvar$, $\bigcap_{\ell = 1}^{h} \llbracket \delta_{\ell} \rrbracket^{\Mmc}_{e_{\ell}} \not \subseteq \Wmc \setminus \bigcap_{j = 1}^{k} \llbracket \gamma_{j} \rrbracket^{\Mmc}_{d_{j}}$).
	This means that there exists $v \in \Wmc$ such that
$\gamma_{1} \in \Phi^{\pi_{n}(x_{1})}_{v}, \ldots, \gamma_{k} \in \Phi^{\pi_{n}(x_{k})}_{v},
\delta_{1} \in \Phi^{\pi_{n}(y_{1})}_{v}, \ldots, \delta_{h} \in \Phi^{\pi_{n}(y_{h})}_{v}$; or
$\dnot \gamma_{j} \in \Phi^{\pi_{n}(x_{j})}_{v}$ and $\dnot \delta_{\ell} \in \Phi^{\pi_{n}(y_{\ell})}_{v}$,
for some $j\leq k$, $\ell \leq h$.
Then by applying the rule $\mathsf{R}_{\mathit{L}\mathbf{D}}$ %to $\T$ 
accordingly, 
we expand $\T$ to $\T'$ with
$m : \gamma_1, \ldots, m : \gamma_k, m : \delta_1, \ldots, m : \delta_h$, or with $m : \dot{\lnot}\gamma_j, m : \dnot \delta_{\ell} $, for some $j\leq k$, $\ell \leq h$,
and some $m$ satisfying the application condition of $\mathsf{R}_{\mathit{L}\mathbf{D}}$.
Since $m$ is fresh, we can extend $\pi$ with $\pi(m) = v$, 
and $\pi_{m}$ with $\pi_{m}(x_{j}) = \pi_{n}(x_{j})$, for $j \leq k$, 
$\pi_{m}(y_{\ell}) = \pi_{n}(y_{\ell})$, for $\ell \leq h$; thus obtaining that $\T'$ is $\Mmc$-compatible.


	\item[($\mathsf{R}_{\mathit{L}\mathbf{T}}$)]
	Suppose that $\mathsf{R}_{\mathit{L}\mathbf{T}}$ is applicable to $\T$.
	Then there is $\Box_{i} \gamma \in \Gamma^{x}_{n}$.
	 Since $\T$ is $\Mmc$-compatible,
	 we have that $\Box_{i}\gamma \in \Phi^{\pi_{n}(x)}_{\pi(n)}$, 
	 meaning that $\llbracket \gamma \rrbracket^{\Mmc}_{d} \in \Nmc_{i}(\pi(n))$.
	By the $T$-condition, 
	$\pi(n) \in \llbracket \gamma \rrbracket^{\Mmc}_{d}$,
	that is $\gamma \in \Phi^{\pi_{n}(x)}_{\pi(n)}$.
	Then the expansion $\T'$ of $\T$ with $n: \gamma$, obtained by the application of $\mathsf{R}_{\mathit{L}\mathbf{T}}$,
	 is $\Mmc$-compatible.\qedhere
\end{enumerate}
}}
By the argument of Theorem~\ref{thm:termination},
it can be seen that
after finitely many steps we obtain a complete completion set $\Tmc'$. Moreover, $\Tmc'$ is $\Mmc$-compatible, hence clearly clash-free.
\end{proof}


By Theorem~\ref{thm:termination}, we have that the $\LnALC$ tableau algorithm terminates after exponentially many steps in the size of the input formula. By Theorems~\ref{thm:soundness} and~\ref{thm:completeness}, the non-deterministic decision procedure based on the $\LnALC$ tableau algorithm is sound and complete with respect to satisfiability in varying domain neighbourhood models. 
%
Thus, we obtain the following result.
%\nb{M: todo fix notation in Preliminaries}

\begin{theorem}
	\label{thm:upperbound}
	Satisfiability in $\LnALC$  on varying domain neighbourhood models is decidable in $\NExpTime$.
\end{theorem}

To conclude, let $\T_{\p} = \{0 : \p
%0 : \top(x)
\}$ be the initial completion set for $\p$.
%with $0$ being the label in $\mathbf{T}_{\p}$ and $x$ be the variable occurring in $\mathbf{T}_{\p}$.
Define $\pi(0) = w_{\p}$ (where $\Mmc, w_{\p} \models \p$) and $\pi_{0}(x) = d$, for an arbitrary $d \in \Delta_{w_{\p}}$.
Clearly, these functions ensure that $\T_{\p}$ is $\Mmc$-compatible.
By Claim~\ref{cla:compatible}, we can apply the $\LnALC$-rules so that the obtained completion sets are $\Mmc$-compatible as well.
From Theorem~\ref{thm:termination}, we have that the $\LnALC$ tableau algorithm eventually terminates, %returning an $\LnALC$-complete completion set for $\p$ that is clash-free by construction.
providing an $\LnALC$-complete completion set for $\p$ that is clash-free by construction.
\end{proof}

























\Fmp*
\begin{proof}
By Theorem \ref{thm:completeness}, if $\p$ is $\LnALC$ satisfiable, then 
there is a $\LnALC$-complete and clash-free completion set $\T$ for it.
Then by Theorem \ref{thm:soundness},
%basing on $\mathbf{T}$ we can define a
there exists a model 
$\Mmc = (\Wmc, \{ \Nmc_{i} \}_{i \in J}, \Imc)$
for $\p$ where $\Wmc =  \mathsf{L}_{\T}$
and for each $n\in\Wmc$, $\Delta_{n} = \{ x \in \mathsf{N_{V}} \mid x \ \text{occurs in} \ S_{n} \}$.
By Theorem~\ref{thm:termination}, Claim~\ref{cla:termglobal}, it follows
$|\Wmc| \leq p(|\fg(\p)|)$,
if $\mathbf{C}\notin\Lvar$, 
and $|\Wmc| \leq 2^{q(|\fg(\p)|)}$, 
if $\mathbf{C}\in\Lvar$,
where $p$ and $q$ are polynomial functions.
Finally by Theorem~\ref{thm:termination}, Claim~\ref{cla:termlocal}, 
for each $n\in\Wmc$, $|\Delta_n|$ does not exceed $2^{r(|\fg(\p)|)}$,
where $r$ is a polynomial function.
\end{proof}



