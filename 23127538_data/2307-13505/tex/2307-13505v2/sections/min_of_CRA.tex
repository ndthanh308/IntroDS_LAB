% !TEX root =  ../main.tex

\subsection{Zariski topologies and invariants of WA}
\label{subsec:Zariski}

Let $\mathbb{K}$ be a field and $n\in \mathbb{N}$.
The \emph{Zariski topology} on $\mathbb{K}^n$ is defined
as the topology whose closed sets are the sets of common roots of a finite collection of polynomials of $\mathbb{K}[X_1, \dots, X_n]$.
A linear version of this topology, called the \emph{linear Zariski topology},
was introduced by Bell and Smertnig in~\cite{BellS21}.
Its closed sets, which we will call \emph{Z-linear sets},
are finite unions of vector subspaces of $\mathbb{K}^n$.

A set $S \subseteq \mathbb{K}^n$ is called \emph{irreducible} if,
for all closed sets $C_1$ and $C_2$,
such that $S \subseteq C_1 \cup C_2$, we have either $S \subseteq C_1$ or $S \subseteq C_2$.
The Zariski topologies defined above are Noetherian topologies in which every closed set
can be written as a finite union of irreducible components.
We then define the \emph{dimension} of a Z-linear set as the maximum dimension of
its irreducible components and their number will be called its \emph{length}.

For a set $S \subseteq \mathbb{K}^n$, $\linClosure{S}$
will denote its closure in the linear Zariski topology.
In this topology, closed irreducible sets are vector subspaces of $\mathbb{K}^n$
and linear maps are continuous and closed maps (mapping closed sets to closed sets).
In particular, for all $S \subseteq \mathbb{K}^n$ and linear map
$f : \mathbb{K}^n \to \mathbb{K}^n$,$\linClosure{f(S)}= f(\linClosure{S})$.
Moreover, if $S \subseteq \mathbb{K}^n$ is irreducible and $f : \mathbb{K}^n \to \mathbb{K}^n$
is continuous, then $f(S)$ is irreducible.
These properties will be used implicitly in the following
(see~\cite[Lemma 3.5]{BellS21} for more details and references).

We will also define an affine version of this topology that enjoy the same properties
in Subsection~\ref{subsec:affine}.

\begin{definition}
  Let $\Sigma$ be a finite alphabet and let $\mathcal{R} = (u,\mu,v)$
  be a $\dWA$-dimensional \WA on $\Sigma$ over $\mathbb{K}$.
  A subset $I \subseteq \mathbb{K}^\dWA$ is called an \emph{invariant} of $\mathcal{R}$
  if $u \in I$ and, for all $w \in I$ and $a \in \Sigma$, $w \mu(a) \in I$.
  For two invariants $I_1$ and $I_2$, we say that $I_1$ is \emph{stronger} than $I_2$
  if $I_1 \subseteq I_2$.
  In particular, the strongest invariant of $\mathcal{R}$
  is its \emph{reachability set} $\lReachSet{\mathcal{R}} = u \mu(\Sigma^*)$.

  An invariant that is also a Z-linear set will be called a \emph{Z-linear} invariant.
  The strongest Z-linear invariant of $\mathcal{R}$ is the closure of
  $\lReachSet{\mathcal{R}}$ in the linear Zariski topology
  (which is well-defined since the topology is Noetherian).
\end{definition}

\begin{example}[Example~\ref{ex:WA} continued]
  \label{ex:linHullWA}
  The reachability set of the $\WA$ considered in Example~\ref{ex:WA}
  is $\lReachSet{\mathcal{R}} = \big\{ (2^{2n}, 0) \,\big|\, \allowbreak n \in \mathbb{N} \big\}
  \cup \left\{ (0, 2^{2n+1}) \,\middle|\, n \in \mathbb{N}\right\}$.
  Its \LH is then the union of the two coordinate axes of the plane
  $\linHull{\mathcal{R}} = \linSpan{1,0} \cup \linSpan{0,1}$.

  Indeed, the inclusion $\subseteq$ comes from the fact that $u = (1,0) \in \linSpan{1,0}$
  and $\linSpan{1,0} \cup \linSpan{0,1}$ is stable by multiplication by $\mu(a)$
  and the inclusion $\supseteq$ comes from the fact that, for the linear Zariski topology,
  $\left\{ (1,0) \right\}$ is dense in $\linSpan{1,0}$
  and $\left\{ (0,2) \right\}$ is dense in $\linSpan{0,1}$.
\end{example}

\begin{remark}\label{rk:lin_not_alg}
In the previous example, the strongest Z-linear invariant is actually the strongest
algebraic invariant (\emph{i.e.} closed in the Zariski topology).
Of course, this is not always the case.
\end{remark}

The Z-linear invariants of two \WA
realizing the same function do not necessarily coincide but,
since $\mathbb{K}$ is a field, it is well-known that for every rational series $f$,
there exists a (computable) minimal \WA realizing $f$
that is unique up to similarity in the following sense
(see~\cite[Proposition 4.10 (Chapter III)]{Sakarovitch09}):

\begin{definition}
  Let $\mathcal{R} = (u,\mu,v)$ and $\mathcal{R}' = (u',\mu',v')$
  be two $\dWA$-dimensional \WA over $\mathbb{K}$.

  $\mathcal{R}$ and $\mathcal{R}'$ are said to be \emph{similar}
  if there exists an invertible (change of basis) matrix $P \in \sqmatrSet{\mathbb{K}}{\dWA}$
  such that $u' = u P$, $\mu'(a) = P^{-1} \mu(a) P$ for all $a \in \Sigma$
  and $v' = P^{-1}v$.
\end{definition}

\begin{remark}
  \label{rmk:similarRep}
  The Z-linear invariants of two similar \WA $\mathcal{R}$ and $\mathcal{R}'$
  only differ by a change of basis.
  \ie there is a bijection between the Z-linear invariants
  of $\mathcal{R}$ and those of $\mathcal{R}'$ that, in particular, preserves the length and dimension.
\end{remark}

\subsection{Strongest invariants and  characterization}

The notion of \LH was introduced by Bell and Smertnig in~\cite{BellS21}, under the name ``linear hull''.
They showed, in~\cite{BS23}, that it is computable and can be used to decide
whether a \WA is equivalent to a deterministic (or an unambiguous) one.

\begin{theorem}[{\cite[Theorem 1.3]{BellS21}}]
  \label{thm:seqWA}
  A rational series $f$ can be realized by a sequential $\WA$
  iff the \LH of a minimal \WA realizing $f$ has dimension at most 1.
\end{theorem}

The following result 
generalizes this theorem by linking linear $\CRA$ to Z-linear invariants.
It constitutes the key characterization that will allow us to solve the minimization problems.
\begin{theorem}[Characterization]
  \label{thm:mainThm}
  Let $f$ be a rational series.
  Then $f$ can be realized by a linear $\CRA$ with $\sCRA$ states and $\rCRA$ registers
  iff there exists a minimal \WA realizing $f$ that has a Z-linear invariant
  of length at most $\lInv$ and dimension at most $\dInv$.
\end{theorem}

As we will see in Subsection~\ref{subsec:affine},
this theorem can also be extended to affine \CRA.

Observe that, thanks to Remark~\ref{rmk:similarRep}, the property of the above characterization
is actually valid for \emph{every} minimal \WA realizing $f$.
Moreover, since the dimension of the \LH is minimal, finding this dimension
allows to solve the register minimization problem for linear $\CRA$.
This is formalized in the following result, which generalizes
Theorem~\ref{thm:seqWA} thanks to Remark~\ref{rk:seq}.

\begin{corollary}
  \label{cor:minRegLH}
  The register complexity of a rational series $f$ w.r.t.\ the class of linear \CRA
  is the dimension of the \LH of any minimal \WA realizing $f$.
\end{corollary}

An immediate consequence of this result is that computing the strongest invariant
allows to decide the register minimization problem.

\begin{example}[Example~\ref{ex:WA} continued]
  As we have seen in Example~\ref{ex:linHullWA},
  $\linHull{\mathcal{R}}$ is 1-dimensional and has two irreducible components,
  thus $\llbracket \mathcal{R} \rrbracket$ can be realized by a
  $\CRA$ with two states and one register (depicted on the right of Figure~\ref{fig:CRA}).
\end{example}

\subsection{Invariants of minimal WA and correspondence with CRA}
\label{subsec:invWA_CRA}

\begin{proposition}
  \label{prop:dimLHMin}
  Let $\mathcal{R}$ be a \WA realizing a rational series $f$.
  If $\mathcal{R}$ has a Z-linear
  invariant of length $\lInv$ and dimension $\dInv$,
  then every minimal \WA realizing $f$ has a Z-linear
  invariant of length $\leq \lInv$ and dimension $\leq \dInv$.
\end{proposition}

Thanks to Remark~\ref{rmk:similarRep}, it suffices to show the existence of one
minimal \WA verifying the proposition, since they are all similar.
It is known (see Proposition~\ref{prop:caracMinRep}) that a minimal \WA can be obtained from a \WA by alternating
between two constructions which reduce the dimension to make it match
the one of the span of the left (resp. right) reachability set. The result then
follows from the next lemma, which states that both constructions
decrease the length and dimension of the invariants.
We prove it by considering an adequate change of basis, and
verifying that it preserves invariants.

\begin{lemma}
  \label{lem:leftRightMin}
  Let $\mathcal{R}$ be a \WA realizing a rational series $f$,
  let $S_{\mathcal{R}}$ be a Z-linear invariant of $\mathcal{R}$ of length $\lInv$ and dimension $\dInv$
  and let $r = \dim(\linSpan{\lReachSet{\mathcal{R}}})$.
  We can construct an $r$-dimensional \WA
  $\mathcal{R}'$ realizing $f$, with a Z-linear invariant $S_{\mathcal{R}'}$ of length $\leq \lInv$
  and dimension $\leq \dInv$.
  The same holds with $r = \dim(\linSpan{\rReachSet{\mathcal{R}}})$.
\end{lemma}

The next proposition allows to go from Z-linear invariants of \WA to \CRA.
This construction builds on the one of~\cite[Lemma 3.13]{BellS21}, in which they build an equivalent \WA from
the strongest Z-linear invariant of a \WA.
We show that an analogous construction is valid for any Z-linear invariant,
and that we can use states of \CRA to represent the different irreducible components of the invariant,
thus reducing the number of registers used to the dimension of the invariant.

\begin{proposition}
  \label{prop:linRepToCRA}
  Let $\mathcal{R}$ be a \WA.
  If $\mathcal{R}$ has a Z-linear invariant of length $\lInv$ and dimension $\dInv$,
  then there exists a linear \CRA $\mathcal{A}$, with $\sCRA$ states and $\rCRA$ registers,
  such that $\llbracket \mathcal{A} \rrbracket = \llbracket \mathcal{R} \rrbracket $.
\end{proposition}

The next proposition shows the converse direction, from \CRA to invariants
of \WA.
The construction is the classical one from \CRA to \WA.
The existence of the adequate invariant follows from the determinism of the \CRA which ensures
that in any reachable configuration, only coordinates associated with the reachable state of the \CRA can be non-zero.

\begin{proposition}
  \label{prop:CRATolinRep}
  Let $\mathcal{A}$ be a linear \CRA.
  If $\mathcal{A}$ has $\sCRA$ states and $\rCRA$ registers, then there exists a \WA $\mathcal{R}$,
  with a Z-linear invariant of length $\lInv$ and dimension $\dInv$,
  such that $\llbracket \mathcal{A} \rrbracket = \llbracket \mathcal{R} \rrbracket $.
\end{proposition}

Using the three previous propositions, we can finally prove the main characterization:
\begin{proof}[Proof of Theorem \ref{thm:mainThm}]
  Given a linear $\CRA$ with $\sCRA$ states and $\rCRA$ registers, we can construct,
  thanks to Proposition~\ref{prop:CRATolinRep},
  an equivalent \WA with a Z-linear invariant
  of length $\lInv$ and dimension $\dInv$.
  Then the desired minimal \WA exists thanks to Proposition~\ref{prop:dimLHMin}.

  Reciprocally, applying the construction of Proposition~\ref{prop:linRepToCRA}
  to any minimal \WA gives the desired linear $\CRA$.
\end{proof}

As we will discuss in the next subsection below,
the three propositions we used for this proof can also be adapted to yield the same result
for affine \CRA.

\subsection{Z-affine invariants and affine CRA} \label{subsec:affine}
All the results of Section~\ref{sec:characterization} can actually be extended to affine \CRA
using the \emph{affine Zariski topology} instead of the linear one.
It is a slight generalization of the linear Zariski topology where closed sets,
called \emph{Z-affine} sets, are finite unions of affine spaces instead of vector spaces,
with lengths and dimensions defined like in the linear case.
It is still a Noetherian topology coarser than the Zariski topology,
affine maps are continuous and closed maps in this topology
and, more broadly, it enjoys the same properties as the linear Zariski topology
we considered throughout this section.
For a set $S \subseteq \mathbb{K}^n$, we will denote by $\affClosure{S}$ it closure
in the affine Zariski topology and, similarly to the linear case,
for a \WA $\mathcal{R} = (u,\mu,v)$, we will call any invariant of $\mathcal{R}$ that is a Z-affine set
a \emph{Z-affine invariant} of $\mathcal{R}$.
Of course, the strongest Z-affine invariant of $\mathcal{R}$ is still the closure of its reachability set
\ie its ``affine hull'' $\affHull{\mathcal{R}}$ and Remark~\ref{rmk:similarRep} is still true
for Z-affine invariants.

We obtain the same characterization of Theorem~\ref{thm:mainThm} in the affine setting :
\begin{theorem}[Characterization]
  \label{thm:charAff}
  Let $f$ be a rational series.
  Then $f$ can be realized by an affine $\CRA$
  with $\sCRA$ states and $\rCRA$ registers iff there exists a minimal \WA realizing $f$ that has a Z-affine invariant
  of length at most $\lInv$ and dimension at most $\dInv$.
\end{theorem}

We can show that Propositions~\ref{prop:dimLHMin},~\ref{prop:linRepToCRA} and~\ref{prop:CRATolinRep}
are also true if we replace Z-linear invariants by Z-affine ones and linear \CRA by affine ones.
So, the proof of Theorem~\ref{thm:charAff} remains the same as Theorem~\ref{thm:mainThm}.
All the details can be found in Appendix~\ref{apx:proofChar}.

Of course, this theorem has the same consequences of its linear counterpart
and we obtain an affine version of Corollary~\ref{cor:minRegLH}
\begin{corollary}
  \label{cor:minRegLHAff}
  The register complexity of a rational series $f$ w.r.t.\ the class of affine \CRA
  is the dimension of the \AH of any minimal \WA realizing $f$.
\end{corollary}

Working in the affine Zariski topology instead of the linear one can decrease
the dimension of the strongest invariant by one, as shown in the following example.
\begin{example}
  \label{ex:sumPow2}
  On the alphabet $\Sigma = \left\{ a \right\}$,
  let $\mathcal{R} = (u, \mu, v)$,
  where $u = (1, 2)$, $\mu(a) = \begin{pmatrix}
                                  1 & 0 \\
                                  1 & 2
  \end{pmatrix}$ and $v = (1, 0)^t$,
  be a \WA (over $\mathbb{R}$) realizing the rational series $f$ defined by
  $f(a^n) = \sum_{i=0}^{n} 2^i = 2^{n+1}-1$.

  The reachability set of $\mathcal{R}$ is $\lReachSet{\mathcal{R}}
  = \big\{ \left(\sum_{i=0}^{n} 2^i , 2^{n+1}\right) \,\big|\, n \in \mathbb{N} \big\}$.

  For the linear Zariski topology, $\lReachSet{\mathcal{R}}$ is dense in $\mathbb{R}^2$.
  So the \LH $\linHull{\mathcal{R}} = \mathbb{R}^2$ is two-dimensional.
  However, note that, for all $(x,y) \in \lReachSet{\mathcal{R}}$, $y = x+1$.
  So, by an argument of density in the affine Zariski topology,
  the \AH $\affHull{\mathcal{R}}$ is the affine line $y=x+1$, which is one-dimensional.
\end{example}

Thus, in the case where the dimensions of the affine and linear hulls doesn't match,
using affine \CRA instead of linear \CRA can allow to save one register :

\begin{example}[Example~\ref{ex:sumPow2} continued]
  \label{ex:sumPow2CRA}
  The two $\CRA$ depicted on Figure~\ref{fig:sumPow2CRA} both realize the function of Example~\ref{ex:sumPow2}.
  On the left we have a linear $\CRA$ with two registers and, on the right,
  an affine $\CRA$ with only one register.
  The characterization theorems show that both have the minimal number of
  registers for their respective classes of $\CRA$.
\end{example}

\input{figures/fig-affCRA}