\section{Theoretical Analysis}
\label{sec:theoretical-analysis}


In this section, we conduct a theoretical analysis to analyse the severity of wallet attacks. 
% \begin{itemize}
%     \item \textbf{General CVSS Applicability } no impact metrics such as CIA
%     \item \textbf{Find CVSS Top Papers}
% \end{itemize}

\subsection{Methodology}
\label{sec:methodology-theoretical}

Following systematising attack vectors from academic papers, we analyse the severity of each attack vector to software and hardware wallets. To quantify the attack vectors, we employ the \acf{cvss}.

% and \acf{cc} Attack Potential. 

% \subsubsection{Threat Model}
% The first stage, threat model (see \autoref{sec:threat-model}), involves representing the crypto wallet system through a detailed \acf{dfd} (see \autoref{fig:dfd}) to illustrate the communication channel between components of the wallet. This diagrammatic representation serves as a foundation for identifying potential threats, utilising the STRIDE analysis framework in \autoref{sec:stride-technique}. A key component of this stage is the development of an attack tree in \autoref{sec:attack-tree}, which outlines possible threat scenarios in a hierarchical structure.

% \subsubsection{Threat Analysis}
% The second stage, threat analysis (see \autoref{sec:threat-analysis}), takes the findings from the threat modelling stage and translates them into a Fault Tree Analysis (see \autoref{fig:fault-tree-analysis}). This analysis delves deeper into the potential vulnerabilities within the system. 


% By applying \acs{cvss} and \acs{cc} Attack Potential, we aim to pinpoint the most vulnerable aspects of crypto wallets, thereby enabling targeted and effective security enhancements. 

% This two-stage methodology not only identifies existing threats but also anticipates emerging risks, ensuring that the crypto wallet system remains resilient against a constantly evolving landscape of digital threats.

% state the analysis goal first. I don’t even know the purpose of your methodologies, why should I care about the methodology details

% \subsection{Threat Model}
% \label{sec:threat-model}
% We identify potential threats to each wallet component in this threat model to ensure a comprehensive assessment of risks and implement targeted security measures to safeguard crypto wallet systems against a wide array of cyber threats.

% \input{Exhibits/Attack-Vectors}

% % Figure environment removed

% \subsubsection{Attack Vectors}
% \label{sec:attack-vectors}
% Our focus encompassed a diverse array of wallet infrastructures as outlined in \autoref{sec:infrastructure}. We examined a wide spectrum of attack scenarios associated with these wallets, with a particular emphasis on their execution mechanisms and the subsequent impacts. Our analysis led to the systematic categorisation of threats into five distinct groups: Network, Application, Authentication, Physical Access, and Cryptanalysis. Through this process, we have identified and categorised 34 distinct threats within these five categories, as detailed in \autoref{attack-vectors}. 

% \subsubsection{\acf{dfd}}
% \label{sec:data-flow-diagram}

% We crafted a \acf{dfd} as shown in \autoref{fig:dfd} to dissect the architecture of the crypto wallet system, providing a clear visualisation of its operational framework. The 
% \acs{dfd} illustrates the flow and storage of sensitive information in Hot and Cold wallets (see \autoref{sec:internet-connectivity}), acknowledging their increased vulnerability to a spectrum of attack vectors when compared with alternatives like Paper, Brain, and Smart Contract Wallets in \autoref{attack-vectors}. Our delineation incorporates key external entities, such as the User, Download Server, and Blockchain Network, which represent any actors or infrastructures interfacing with the wallet system from outside the defined scope of analysis. The wallet application and hardware wallet serve as data repositories in the system, pivotal for data retention and management. Significantly, the diagram demarcates trust boundaries, articulating transitional points where trust levels amongst various components change. The comprehensive nature of the \acs{dfd} allows us to identify potential vulnerabilities and threats by elucidating the flow of sensitive data in the system. This includes critical user information such as authentication details, recovery phrases, and private keys. For example, if the recovery phrase generated during the wallet's initialisation process is vulnerable to interception via a passive network attack, it presents a significant security risk. An adversary exploiting this vulnerability could potentially use the key derivation function to gain unauthorised access to the private keys, thereby posing a grave threat to the security of the user's digital assets. Therefore, it serves as an essential tool in the preemptive identification and fortification against such threats.

% \subsubsection{STRIDE Technique}
% \label{sec:stride-technique}
% We employed the STRIDE analysis technique to classify potential threats to each component of the crypto wallet system. Crypto wallets have unique security challenges due to blockchain's characteristics, using the STRIDE technique helps to identify and categorise possible security risks in a detailed way. STRIDE categorise threats into six distinct types: Spoofing (S), Tampering (T), Repudiation (R), Information Disclosure (I), Denial of Service (D), and Elevation of Privilege (E) \cite{hans2023blockchain, luo2021threat}. This thorough analysis is essential to ensure security and integrity.

% \input{Exhibits/Stride-Analysis}

% Initially, we compiled extensive attack vectors by collating known attack techniques and vulnerabilities from academic papers, incident and audit reports in \autoref{sec:attack-vectors}. Based on these attack vectors, we identified potential threats across the six STRIDE categories for all components described in the \acs{dfd} which we created in \autoref{sec:data-flow-diagram}. For instance, considering the \quotes{User} component in \autoref{fig:dfd}, we noted the possibility of an attacker disguising themselves as a legitimate user. This type of camouflage attack, derived from the \quotes{Authentication} category in \autoref{attack-vectors}, could lead to the impersonation of a user by circumventing wallet authentication. The STRIDE analysis results for each component, based on the \acs{dfd} of both hot and cold wallets, are presented in \autoref{stride-analysis}. Our stride analysis concluded with the identification of 76 threats in hot wallets and a total of 75 threats in cold wallets.


% \subsubsection{Attack Tree}
% \label{sec:attack-tree}

% The attack tree allows the systematic derivation of various potential attack paths targeting a specific goal. In our research, we utilised this method to craft detailed attack scenarios corresponding to each attack goal identified in the attack trees. This process was designed by the threats we previously identified using the STRIDE technique in \autoref{sec:stride-technique}. In the attack tree, the root node symbolises the ultimate objective of the attack. This is broken down into sub-goals, represented as child nodes, which must be achieved to accomplish the final goal. The branching nodes lead to the final leaf nodes, each representing a tangible attack threat from \autoref{attack-vectors}.

% The key strength of an attack tree lies in its ability to logically deduce specific attack vectors that are essential to realise a given attack objective. We categorised the ultimate attack goals of potential attackers into three primary groups: Privacy Breach, which involves unauthorised access to sensitive user data; Crypto theft, which aims at illicitly acquiring digital currencies; and \acs{dos}, which seeks to disrupt the normal functioning of the wallet. This structured approach in the attack tree enables a comprehensive and clear understanding of the multitude of threats faced by crypto wallets to develop targeted and effective countermeasures.

% \paragraphtitle{Privacy Breach}
% \label{sec:privacy-breach}
% Privacy breaches focus on the unauthorised acquisition of user-sensitive information. The first sub-goal targets the user's account information by eavesdropping on input/output data, primarily through keylogger malware attacks. This type of attack involves installing keylogger malware, which can be executed by introducing the malware through removable media, exploiting rogue access points, or via social engineering techniques.

% The second strategy aims to capture network traffic to obtain user account details. Attackers install network packet sniffers to monitor and analyse traffic for sensitive information. Execution of these sniffers can be facilitated by gaining access to the network through similar means as the keylogger installation, including supply chain infiltration.

% Lastly, attackers strive to obtain personally identifiable information (PII) of the user, which may include details like names, addresses, and social security numbers. Such information can be accessed by bypassing operating system or wallet authentication, potentially through fault injection or code reuse attacks, as well as by deceiving biometric security measures or employing brute-force attacks to crack passwords. The breach of this information can have far-reaching consequences, extending beyond financial losses to identity theft and privacy violations, underscoring the critical need for robust security practices in cryptocurrency operations.

% \paragraphtitle{Crypto Theft}
% \label{sec:crypto-theft}
% The sub-goal in crypto theft is to acquire the user's private key. In the case of hierarchical deterministic wallets, obtaining the recovery phrase effectively equates to securing the private key. The theft can be strategies via several methods, each aiming at different vulnerabilities. One approach is to retrieve sensitive data in RAM, which can be done through cold boot attacks that exploit data remanence to recover information that persists shortly after power has been removed, or through clipboard hijacking where malware monitors the clipboard for wallet addresses. Eavesdropping on input data is another vector, where keylogger malware can be installed and executed to record keystrokes, capturing the private key as it is entered. This can be facilitated through rogue access points or by social engineering tactics that trick the user into installing a keylogger. On the other end of the spectrum, obtaining secret data can involve bypassing the operating system's authentication mechanisms to access restricted areas directly. Attackers can employ methods such as fault injection to induce errors that compromise the system's security or brute force attacks to guess the private key. Furthermore, attackers could calculate the private key by exploiting weak points in cryptographic algorithms by observing nonce reuse in the signature process.

% \input{Exhibits/CVSS}
% \input{Exhibits/CC}

% \paragraphtitle{Denial of Service}
% \label{sec:denial-of-service}
% \acs{dos} aims to disrupt the normal functioning of wallet services and block users' access to their assets. One method attackers use to prevent users from using their private keys is through ransomware attacks, which encrypt the private key, rendering it unusable until a ransom is paid. Ransomware can be deployed through various methods such as installing malware via removable media, exploiting insecure wireless access points, or through social engineering tactics that convince the user to execute the malicious software.

% Another sub-goal is to delete the wallet manager, which is essential for managing the cryptocurrency assets. This could involve direct deletion of wallet-related files from the system by gaining administrative privileges, connecting a debugger to modify wallet operations, or bypassing the operating system's authentication to gain unauthorised access.

% Finally, attackers may aim to prevent the wallet from providing its service entirely. This could be achieved by preventing the downloading of wallet managers through \acs{mitm} attacks that intercept and alter communications, or more directly, through \acs{dos} attacks on the wallet's infrastructure. Techniques such as \acs{arp} spoofing, \acs{dns} spoofing, \acs{icmp} flooding, and \acs{tcp} \acs{syn} flooding are network-level attacks used to overwhelm the wallet service. More sophisticated attackers might deploy botnets to amplify the attack and ensure that the wallet service is incapacitated, thereby denying users access to the blockchain network and their funds.

\subsection{Attack Vector Severity}
\label{sec:threat-analysis}
% To more accurately assess vulnerability, we transform the developed attack trees in \autoref{sec:attack-tree} into a Fault Tree Analysis format by arranging all the attack paths aligned to their goals and merging common attack vectors as shown in \autoref{fig:fault-tree-analysis}. This allows for a more streamlined representation of the attack paths and helps identify critical points of failure.
We then apply \acf{cvss} Attack Potential metrics to evaluate the most severe attacks on wallets.

% the \acf{cvss} and \acf{cc}

% We use \acs{cvss} and \acs{cc} Attack Potential parameters

\subsubsection{Severity Calculation}
\label{sec:probability-calculation}
We employ \acs{cvss} parameters for calculating the severity value for each attack vector (see Appendix \autoref{appendix:severity-calculation}). The \acs{cvss} is a standardised framework for rating the severity of security vulnerabilities \cite{cvss2021specification}. We specifically consider the Exploitability parameters from the \acs{cvss}, which indicates the likelihood of successfully exploiting the threat as shown in \autoref{tab:cvss}. This focus allows us to assess the immediate vulnerability without necessarily quantifying the broader impact, which can vary significantly depending on the specific environment and protective measures in place. 

% The attack potential in the \acs{cc} considers various parameters to assess the level of effort and resources required to exploit a vulnerability in a security product \cite{tony2008attack}. For our assessments, we specifically focus on Elapsed Time and Equipment, as these factors provide a clear quantification of the direct resources and time commitment necessary for an attack, as shown in \autoref{tab:cc}. This focus helps to determine whether a product meets certain Evaluation Assurance Levels (EALs) under the \acs{cc}, while also streamlining the evaluation process by concentrating on the most measurable aspects of attack feasibility. 

These parameters provide a standardised method to quantify the threat severity, offering a more objective basis for risk assessment compared to methods that rely on subjective managerial judgement, as seen in standards such as SP 800-30, FAIR, and EBIOS.

% It was developed to provide a uniform way of describing the security risks associated with vulnerabilities. 

% % Figure environment removed

% Since each metric value has a value of [0, 1], it is suitable for calculating the probability of the attack vectors. We calculate the probability in a similar way to Zhang et al. \cite{zhang2017conditional}. 
Hence, we define \autoref{eq:probability-formula} to calculate the severity value (S) for the occurrence of a threat (T) using \acs{cvss} v3.1 Exploitability and \acs{cc} Attack Potential metric values. 
% To ensure the maximum probability approaches 1, we adjusted the constant value to 2.92. This adjustment was necessary because, when selecting the minimum values from different parameters in tables \autoref{tab:cvss} and \autoref{tab:cc}, the resultant value is 0, but when the maximum values are used, the resultant value was only 0.34. Thus, using a scaling constant of 2.92 allows the maximum probability to be scaled to approximately 1.

\begin{equation}
\label{eq:probability-formula}
\teal{S(\text{T})} = AV \times AC \times PR \times UI \times ET \times E
\end{equation}

% \subsubsection{Fault Tree Analysis}
% \label{sec:fault-tree-analysis}

% Fault Tree Analysis (FTA) is a systematic analytical technique used to analyse the risks related to safety and economically critical assets, like web shops and data centres \cite{ruijters2015fault}. We have utilised this method to identify potential attack paths in the crypto wallet system by quantifying these attacks at every level \cite{lallie2017empirical, kumar2017quantitative}. This quantification helps in assessing the security risk and identifying critical attack vectors in complex systems like crypto wallets.

% A tree-like model is constructed using the attack trees developed in \autoref{sec:attack-tree}, where attacks are represented as nodes. The root node symbolises the ultimate attacker goal, while leaf nodes represent basic attack vectors leading to the ultimate goal. The fault tree structure comprises AND and OR gates to define the relationships between events of different levels. In an AND operation, all input events must occur simultaneously for the output event to occur. This gate is used when an attack is dependent on the occurrence of all contributing factors. The value of the output event in an AND gate is the product of the probabilities of all input events (see \autoref{eq:and-gate}). In an OR operation, the occurrence of any input event leads to the output event. It is used when an attack can result from any one of multiple factors. The value of the output event in an AND gate is shown in \autoref{eq:or-gate}. We have used these gates to calculate the values of attacks in each layer which helps us to understand the most critical attack paths used by the attackers.


% \begin{equation}
% \label{eq:and-gate}
% \teal{P(\text{AND gate})} = \prod_{i=1}^{n} P(T_i)
% \end{equation}

% \begin{equation}
% \label{eq:or-gate}
% \teal{P(\text{OR gate})} = 1 - \prod_{i=1}^{n} (1 - P(T_i))
% \end{equation}

% We employ FTA to analyse the vulnerabilities in crypto wallet systems. We assign empirical and expert-assessed severity values to the attack vectors of the fault tree in \autoref{fig:fault-tree-analysis}, representing the basic events that can lead to the ultimate attacker goals, compromising the security of the crypto wallet system. These values as detailed in Appendix (\autoref{tab:prob}), are derived from using standardised tools such as \acs{cvss} and \acs{cc} Attack Potential (see \autoref{sec:probability-calculation}). These values are crucial as they provide a quantitative basis for assessing the attack paths, enabling a more objective evaluation of system vulnerabilities.

% The systematic approach of FTA is particularly valuable in dissecting the complexities of crypto wallet security. It enables the identification and prioritisation of the most vulnerable aspects of the wallet system and provides insights into how individual vulnerabilities interconnect and contribute to the overall risk. For instance, the value for a successful ransomware attack is calculated using the AND gate, as the attack requires both the successful installation of the malware and its execution which can be represented in the equation \autoref{eq:ransomware-prob}. On the other hand, the value for gaining Admin privilege is calculated using the OR gate, as it can be achieved through the Android root toolkit, code injection, or a row hammer attack as shown in \autoref{eq:admin-privilege-prob}. The value calculation for Clipboard Hijacker is a special case which involves both OR and AND gates in the calculation which is shown in \autoref{eq:clipboard-hijacker-prob}.

% \begin{equation}
% \label{eq:ransomware-prob}
% \begin{split}
% \teal{P(\text{Ransomware Attack})} = P(\text{Install Malware}) \\
% \times P(\text{Execute Malware})
% \end{split}
% \end{equation}

% \begin{equation}
% \label{eq:admin-privilege-prob}
% \begin{split}
% \teal{P(\text{Admin Privilege})} = 1 - & ((1 - P(\text{Android Root Toolkit})) \\
% & \times (1 - P(\text{Code Injection})) \\
% & \times (1 - P(\text{Row Hammer})))
% \end{split}
% \end{equation}

% \begin{equation}
% \label{eq:clipboard-hijacker-prob}
% \begin{split}
% \teal{P(\text{Clipboard Hijacker})} = 1 - & ((1 - P(\text{Admin Privilege})) \\
% & \times (1 - (P(\text{Install Malware}) \\ 
% & \times P(\text{Execute Malware}))))
% \end{split}
% \end{equation}

% It is important to note that our analysis assumes the wallet is vulnerable to all types of attacks, a premise that allows for the identification of all possible attack paths. This assumption yields high probabilities for attacker goals, such as a 92.6\% chance of a Privacy Breach, a 97.3\% chance of Crypto Theft, and a 99.7\% chance of DoS attacks. However, in practice, crypto wallets often implement various security measures to mitigate attack risks, which can significantly reduce the likelihood of successful attacks. While our theoretical analysis serves as a tool for identifying potential vulnerabilities and understanding the attack landscape, the actual probabilities of attacks on real-world wallets may be lower due to the implementation of security defences.


% The likelyhood of the attack vectors (leaf nodes) are derived using \autoref{eq:probability-formula} as shown in \autoref{tab:prob}. We then derive attack paths based on the attack vectors using \autoref{eq:and-gate} and \autoref{eq:or-gate}. We calculate the likelyhood at each step using these equations to design and understand the best attack paths for the attackers to reach their attcker goals. At the same time these attack paths can be used by the developers to implement security features to their wallets. Our analysis assumes the wallet is vulnerable to all types of attacks, a premise that allows for the identification of all possible attack paths. That is the main reason all the calculated values are alarmingly large. However, in practice, crypto wallets often implement various security measures to mitigate attack risks, which can significantly reduce the likelihood of successful attacks. While our theoretical analysis serves as a tool for identifying potential vulnerabilities and understanding the attack landscape, the actual probabilities of attacks on real-world wallets may be lower due to the implementation of security defences.

% The probability figures for the attacker goals should be interpreted as the likelihood of a successful attack given that an attempt has been made by an attacker under the assumptions of our threat model. This does not suggest that each user has a 92.6\% chance of experiencing a privacy breach incidentally but reflects the estimated success rate of an attack if actively attempted using the attack path created in \autoref{fig:fault-tree-analysis}. The high probability values across various threats are derived from our conservative approach, assuming an ideal attacker with maximum capabilities, as per our theoretical framework using fault tree analysis described in this section. This modeling choice is intended to represent a 'worst-case' scenario to ensure that potential vulnerabilities are not underestimated. While this leads to higher calculated probabilities, it is crucial for understanding the most vulnerable points in wallet security, thereby aiding developers in prioritizing and implementing robust countermeasures. In practice, actual attack probabilities on cryptocurrency wallets are expected to be significantly lower due to the varying implementations of security features by different wallet providers. Therefore, while our analysis presents a theoretical upper bound of risk, it serves as a foundational guide for enhancing security practices rather than a direct prediction of everyday user experience.

\subsection{Discussion}
\label{sec:discus_emp_analysis}

% \subsubsection{Insights}
% \label{sec:insight_theoretical-analysis}

\subsubsection{Most Severe Attack Vectors}
\label{sec:most_prob}
% Social Engineering - 0.166
% ICMP Flooding - 0.107
% TCP SYN Fooding - 0.107
% IP Spoofing - 0.099
% DNS Spoofing - 0.099

Our analysis revealed that Social Engineering, with a severity value of 0.166, and \acs{icmp} Flooding and \acs{tcp} \acs{syn} Flooding, each with a severity value of 0.107, along with \acs{ip} Spoofing and \acs{dns} Spoofing, each at 0.099, are the most severe attack vectors. These vectors primarily target key vulnerabilities within the network and application layers, significantly elevating the risk of breaches. 

% The relatively higher severity values associated with these vectors underscore the critical need for robust security measures that address technical vulnerabilities and user behaviours to safeguard against these prevalent threats.

\subsubsection{Least Severe Attack Vectors}
\label{sec:least_prob}
% Connect Debugger - 0.0007
% Fault Injection - 0.0009
% Supply Chain - 0.001
% Fake Biometrics - 0.006

Our analysis identified Debugger Connection attacks and Fault Injection attacks, each with severity values of 0.0007 and 0.0009 respectively, followed by Supply Chain attacks at 0.001, and Fake Biometrics attacks at 0.006, as the least severe attack vectors. These exceptionally low severity values signify the specific and challenging conditions required for such attacks to materialise, emphasising their rarity in practical scenarios. Despite their minimal severity, maintaining preventive measures against these vectors is imperative, as they can potentially exploit critical vulnerabilities if not adequately safeguarded.


% \subsubsection{Attack Path Construction}
% \label{sec:attack_path}
% Utilising FTA \autoref{fig:fault-tree-analysis}, we have delineated attack paths that outline the sequence of malicious actions leading to significant security breaches in wallet systems. This structured reverse engineering of attack scenarios, based on the calculated values of each attack, has allowed for a precise identification of the most critical paths leading to the ultimate attacker objectives.

% For Privacy Breach, which has a calculated value of 0.378, the attack path is constructed as follows: Privacy Breach ← Obtain User Information ← Install Modified Wallet ← \acs{mitm} or Phishing. The \acs{mitm} attacks are executed through attack vectors like \acs{dns} Spoofing, \acs{ip} Spoofing, and \acs{arp} Spoofing. Each method directly contributes to the feasibility of intercepting or redirecting user data, thereby compromising personal and transactional information, which is notably prevalent in custodial wallets due to their compliance requirements with KYC and AML guidelines.

% Crypto theft, with a calculated value of 0.596, follows a path from Crypto Theft ← Obtain Private Key ← Wallet/Firmware Modification ← Install Modified Wallet via \acs{mitm}, Phishing, or Social Engineering attacks targeting Wallet/Firmware Modification. This path highlights the critical vulnerability at the stage of private key access, which is often exploited via social engineering techniques due to the current inadequacies in countermeasures, leading to a significant risk of asset theft.

% The highest valued attacker goal, \acs{dos} attacks at 0.791, is mapped as follows: \acf{dos} ← Prevent Wallet Service ← Prevent Downloading Wallet Manager or Prevent Using Blockchain API through \acs{mitm} or Flooding Attack ← Utilise ARP Spoofing, \acs{dns} Spoofing, \acs{ip} Spoofing, \acs{icmp} Flooding, \acs{tcp} \acs{syn} Flooding, or Botnets. This path indicates that disrupting service availability through network saturation or interference can severely impact users' access to their funds, especially in scenarios involving cryptocurrency exchanges. However, for non-custodial wallets, while the direct impact on users might be mitigated by alternative wallet services, the broader business impacts remain significant due to potential loss of trust and customer migration.