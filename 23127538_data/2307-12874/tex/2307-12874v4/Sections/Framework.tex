
\section{Threat Model Taxonomy}
\label{sec:threat_framework}

We analyse threats to the wallet mechanism, to uncover the adversary's goals, knowledge and capabilities. We factor in the design taxonomy, as shown in \autoref{tab:wlt._taxonomy} to identify threats in the industry. We also demonstrate the gaps in industry and academia as shown in the \autoref{tab:threat_capability} 

% In the following we provide a holistic view of the adversarial utilities, goals, knowledge and capabilities, to engender a common reference frame which we subsequently apply in Section III to relatively compare all observed DeFi attacks.


\subsection{Classification}
\label{sec:threat_class}

Our threat classification is structured on distinct operations within the wallet mechanism in the wallet initialisation, transaction generation and transaction broadcast stages. Regardless of the design decision, threats to the system can be categorised into network, authentication, application, storage and memory, and cryptanalysis.

\input{Exhibits/Threat-Mechanism}

% Figure environment removed

\subsubsection{Network}
\label{sec:vuln_mech}

The wallet communicates with the blockchain to retrieve and broadcast \teal{$state\_trans\_info$} using internet network protocols. The network enables the secure transmission of messages within and outside of the system. Vulnerabilities in the communication channels can be targeted, as shown in \autoref{tab:attack_vectors}. Service providers in the network can also be compromised, rendering messages vulnerable to interception and alteration.

 % These attacks target the communication channels within the operations of the wallet mechanism and between the mechanisms and the blockchain network, as shown in \autoref{tab:attack_vectors}.

\subsubsection{Application}
\label{sec:vuln_mech}

Wallets rely on application libraries \cite{Hu2021SecurityCountermeasures}, and operating systems \cite{he2020security, li2020android}, which may possess vulnerabilities the adversary can exploit. Vulnerabilities in these include application logic vulnerabilities such as key recovery \cite{cve_15302}, signature verification \cite{cve_14199}, and input validation \cite{immunefi} flaws which can result in privilege escalation, Additionally, malware exposure \cite{balakrishnan2023analysis, li2020android}, insecure third-party interactions \cite{ZengoZengo, thodex} and user negligence \cite{weichbroth2023security} can threaten the security of the \teal{$sk$}, \teal{$rdm\_seed$} or \teal{$pw$}.

% These attacks target vulnerabilities in the wallet software and third-party dependencies, and user negligence to perform malicious activities.

\subsubsection{Authentication}
\label{sec:vuln_mech}

Authentication is a critical process in the context of modern wallets (refer to \hyperref[algo:transaction-signing]{Algorithm 2}. Authentication attacks aim to compromise the wallet function which verifies the user's identity to gain unauthorised access to wallets (see \autoref{tab:attack_vectors}). The authentication function, which handles the encryption and decryption of the \teal{$sk$}, can be vulnerable to insecure boot environments \cite{Shaikh2022SurveyExchanges} and single-factor authentication methods and low-strength passwords (\teal{$pw$}).

\subsubsection{Storage and Memory}
\label{sec:vuln_mech}

Data stored can be vulnerable to threats of extraction, manipulation and disruption. Exploitation of the wallet's storage mechanism (see \autoref{sec:key-storage}) can lead to the compromise of \teal{$sk$}, \teal{$rdm\_seed$} or \teal{$pw$}. Storage mechanism vulnerabilities include data remanence \cite{Shaikh2022SurveyExchanges}, unencrypted data \cite{breier2022practical, robinson2022new} and physical security vulnerabilities \cite{courbon2016reverse} can be exploited by the adversary.

\subsubsection{Cryptanalysis}
\label{sec:vuln_mech}

% \_

Cryptographic vulnerabilities may exist in the signature scheme (\teal{$KeyGen$}, \teal{$TnxSign$}, \teal{$TnxVer$}) as a result of the direct implementation or unintended data leakages from side channels. These vulnerabilities include hash function vulnerabilities \cite{shrivas2020disruptive}, weak signature (\teal{$\sigma$}) \cite{Rokhjavan2023SecuringWallets}, predictable \acf{rng} \cite{brengel2018identifying} and data leakages from side-channels \cite{Park2023, kocher1996timing}. 


\subsubsection{Other Threats}
\label{sec:vuln_ext}

Threats can occur via other avenues such as an insider who may have access to transactional information, user credentials and other security details. These can arise from insiders acting maliciously or by exploitation through coercion or social engineering methods. Custodial (\autoref{sec:custodial-wallets}) and shared-custodial (\autoref{sec:semi-custodial-wallets}) architectures are more vulnerable to these threats due to their more centralised architecture. Non-custodial setups (see \autoref{sec:custodial-wallets}) may only also be vulnerable if third-party services are employed for functionalities such as \teal{$pw$} management or inadequate access controls are relied on (e.g. Ledger incident \cite{zerocap}).



% \label{sec:non-custodial-wallets}
% \label{sec:custodial-wallets}

% \subsubsection{Physical Threat}
% \label{sec:vuln_insider}

% \begin{itemize}
%     \item \textbf{USB Debugging:}
%     \item \textbf{Evil Maid:}
% \end{itemize}


% If vulnerabilities in components such as \acs{ip} \cite{shrivas2020disruptive} or \acs{dns} \cite{ahmed2017mitigating, al2020brief} exist the adversary can exploit the network to conduct spoofing attacks.

% \begin{itemize}
%     \item \textbf{Operating System Vulnerability:}  \cite{shrivas2020disruptive}
% \end{itemize}

% \begin{itemize}
%     \item \textbf{Plaintext Storage:}
%     \item \textbf{Insecure boot environment:}
% \end{itemize}

% \begin{itemize}
%     \item \textbf{Weak Signature:}
%     \item \textbf{Predictable \acf{rng}:}
% \end{itemize}

\subsection{Adversary's Goals}
\label{sec:adversary_goal}

 We define an adversary, \teal{$A$}, who aims to exploit threats described above to trigger unauthorised transactions to an adversary-controlled wallet address or disrupt operations. The major goals of \teal{$A$} include:
\begin{itemize}
    \item \textbf{Credential Compromise:} \teal{$A$} aims to compromise \teal{$sk$}, \teal{$rdm\_seed$} and \teal{$pw$} by exploiting several vulnerabilities.
    \item \textbf{State Transition Information Alteration:} \teal{$A$} aims to intercept and modify the \teal{$state\_trans\_info$} created by the user such as \teal{$recipient\_address$}.
    \item \textbf{Operational Disruption:} \teal{$A$} may disrupt the wallet's operational network.
    % \item \textbf{Exploiting Cryptographic Algorithms:} The adversary attempts to exploit vulnerabilities in the cryptographic algorithms used by the wallet mechanism.
\end{itemize}



\subsection{Adversary's Capabilities}
\label{sec:adversary_cap}


\autoref{tab:threat_capability} details the various capabilities of \teal{$A$}, illustrating how identified vulnerabilities can be exploited to achieve an objective with various degrees of knowledge and access. \teal{$A$} can possess public, restricted and insider knowledge. Public knowledge includes information that is openly accessible to anyone, such as open-source code, publicly available audit reports, discussions in open forums, websites, and applications. Restricted knowledge refers to information that is not readily accessible to the public and often requires specific roles, permissions, or effort to obtain. Information that is only accessible to individuals within an organisation is defined as insider knowledge, particularly in setups where custodians have some level of authorisation (\autoref{sec:design-cust}). \teal{$A$} can also execute several attack capabilities remotely or physically. 

% Figure environment removed


% VERY IMPORTANT HOW STATE CHANGE IN TERMS OF PRIVILEGE CAN CHANGE FOR AN ATTACKER
% --
% Dynamic Capabilities: Attackers often move between categories through the course of an attack (e.g., an external attacker becomes an insider by compromising credentials). The model could benefit from incorporating these dynamic aspects, perhaps by outlining common pathways between categories or stages in a typical attack lifecycle.
% --

\subsection{Discussion}
\label{sec:attacks_discussion}

\subsubsection{Insight 1: Influence of Design on Threats}
\label{sec:threats_dis_influence}

Despite a wide range of security setups, we observe that the majority of the design combinations of existing wallets surveyed including desktop, browser, hardware, mobile, smart wallets \acs{mpc} have been threatened by multiple vulnerabilities, as shown in \autoref{tab:wlt._taxonomy}. This is due to similar implementations i.e., the use of replicated libraries, and commonly integrated implementation proposals (e.g. ERC-4337). We also observe some wallets have had numerous vulnerabilities discovered in industry and academia. Most notably Ledger and Trezor have several data remanence, data manipulation and insecure cryptographic vulnerabilities. Furthermore, in mapping vulnerabilities to attacks, we observe that some vulnerabilities can lead to numerous attack vectors as shown in \autoref{fig:wallet-mapping}. These include inadequate authentication, data leakage, insecure permission and insecure user interactions. 


\subsubsection{Insight 2: Signature Verification Logic Flaw Occurrence}
\label{sec:threats_dis_influence}

We observe that signature verification logic flaws account for the most vulnerability occurrences in various wallets surveyed constituting 21\%. Another interesting observation is the occurrence of this vulnerability in three diverse wallet security enhancement architectures, namely hardware, smart contract and \acs{mpc} wallets \cite{cve_14199, fireblocks_23, AccountMedium, UncoveringVulnerability}.


% Figure environment removed

% % Figure environment removed


% Data remanence vulnerabilities were found in Trezor whereby an attacker with physical access could extract the seed from the device \acs{ram} \cite{trezor_memory}


\subsubsection{Insight 3: Gap Analysis on Wallet Threats}
While a gap analysis on executed attacks in industry and academia proves difficult to conduct accurately due to the lack of known industry attack methods, we analyse the gaps in vulnerabilities and threats. We generally observe a high correlation between identified threats in industry and academia, except for insider and external threats. Specifically, in the following threats: malicious insider, compromised insider and compromised service provider threats. Although, there are several custodial designs brought forward by academia with threat models, an investigation into the possible external threats and attacks in custodial setups would be very beneficial for the industry. Notably, most industry attacks target exchanges and other custodial setups, as large funds are concentrated within a few wallet addresses. Additionally, research into these areas will also be pertinent because, wallet designs are gradually evolving into shared-custodial or other setups which require authentication from a centralised party (e.g. passkey, 2FA).


% Threats which are more concurrent on custodial wallet designs are not investigated as much in academia. 
% T However, % Mechanism and system-related vulnerabilities are frequently explored in both academia and industry, which demonstrates 


% \paragraph{Adversary's Access}
% \label{sec:adversary_access}


% Key Shard Secret An adversary may have the secrets of one \teal{$sk$} shard.
% Physical Device LocationThe location of the hardware device may be known to the adversary.

% \subsection{Adversary's Access}
% \label{sec:adversary_access}



% The primary objective of the adversary is to trigger unauthorised transactions to an adversary-controlled wallet address using a stolen or leaked \teal{$sk$} or by altering \teal{$tnx$} messages. This can be conducted by:
% \begin{itemize}
%     \item \textbf{Compromising the Private Key:} The adversary seeks to gain unauthorised access to the private key.
%     \item \textbf{Tampering with Transaction Messages:} The adversary aims to intercept and modify transaction messages submitted by the user, potentially altering transaction details and outcomes.
%     \item \textbf{Exploiting Cryptographic Algorithms:} The adversary attempts to exploit vulnerabilities in the cryptographic algorithms used by the wallet mechanism.
% \end{itemize}


% \subsection{Adversarial Capabilities}

% \input{Exhibits/Threats-New}

% \subsubsection{Network}

% \begin{itemize}
%     \item A can compromise network service providers.
%     \item A can intercept network communication channels.
%     \item A can create malicious connection channels. 
% \end{itemize}

% The attacker can eavesdrop on the network traffic to intercept and modify communication within the wallet system \cite{hu2021security}. Additionally, the adversary can gain control of trusted components on the network layer with which the wallet interacts.

% \subsubsection{Application}

% \begin{itemize}
%     \item \textbf{Compromise of the Private Key:} The adversary may compromise the \teal{$sk$} by theft or leakage.
%     \item \textbf{Alteration of the State Transition Information:} The adversary may to intercept and modify the \teal{$state\_trans\_info$} created by the user.
%     % \item \textbf{Exploiting Cryptographic Algorithms:} The adversary attempts to exploit vulnerabilities in the cryptographic algorithms used by the wallet mechanism.
% \end{itemize}

% \subsubsection{Authentication}

% \begin{itemize}
%     \item \textbf{Compromise of the Private Key:} The adversary may compromise the \teal{$sk$} by theft or leakage.
%     \item \textbf{Alteration of the State Transition Information:} The adversary may to intercept and modify the \teal{$state\_trans\_info$} created by the user.
%     % \item \textbf{Exploiting Cryptographic Algorithms:} The adversary attempts to exploit vulnerabilities in the cryptographic algorithms used by the wallet mechanism.
% \end{itemize}

% \subsubsection{Storage}

% \begin{itemize}
%     \item \textbf{Compromise of the Private Key:} The adversary may compromise the \teal{$sk$} by theft or leakage.
%     \item \textbf{Alteration of the State Transition Information:} The adversary may to intercept and modify the \teal{$state\_trans\_info$} created by the user.
%     % \item \textbf{Exploiting Cryptographic Algorithms:} The adversary attempts to exploit vulnerabilities in the cryptographic algorithms used by the wallet mechanism.
% \end{itemize}

% \subsubsection{Cryptographic}

% \begin{itemize}
%     \item \textbf{Compromise of the Private Key:} The adversary may compromise the \teal{$sk$} by theft or leakage.
%     \item \textbf{Alteration of the State Transition Information:} The adversary may to intercept and modify the \teal{$state\_trans\_info$} created by the user.
%     % \item \textbf{Exploiting Cryptographic Algorithms:} The adversary attempts to exploit vulnerabilities in the cryptographic algorithms used by the wallet mechanism.
% \end{itemize}

% \subsection{Threat Model}
% \label{sec:threat_model} 

% \subsubsection{System Vulnerabilities} 
% \label{sec:incident}

% \paragraph{Key Generation Algorithm}
% This component can be vulnerable to attacks if insufficient randomness is generated. 

% \paragraph{Transaction Signing Algorithm} 

% \paragraph{Transaction Verification Algorithm} 

% \paragraph{Transaction Creation Algorithm} 

% \paragraph{Private Key Storage Medium} 

% \paragraph{User Authentication Algorithm}
% This component is vulnerable to exploits



% These events are illicit or malevolent actions undertaken to undermine blockchain wallets' confidentiality, availability, or integrity. Based on the framework provided, we classify these attacks into two major types:

% \paragraph{Direct Attacks} 
% These are incidents whereby an unauthorised entity conducts malicious activity by attempting to gain sensitive information owned by a user or the application system. Such attacks often target the cryptographic underpinnings of a wallet, such as attempts to decrypt private keys, attacks on key management mechanisms, or employing manipulative tactics such as social engineering to mislead users into divulging their credentials or compromising their security. 

% Private Keys, mnemonic phrases, passphrases and passwords are targeted in these attacks.
% \paragraph{Indirect Attacks} 
% These incidents, when executed in isolation, disrupt the wallet operations without directly leading to financial losses by exploiting vulnerabilities in the system's intercommunication or dependency structures. We include these attacks due to the weakening of a wallet's overall security landscape.

% \subsubsection{Attacker’s Objective}
% We classify the objective of the attacker into four major categories:
% \paragraph{Monetary Gain} The most direct and common motivation for wallet attacks. Adversaries with this objective aim to extract funds from compromised wallets by decrypting private keys, exploiting software vulnerabilities, or via other direct attack vectors. 
% \paragraph{Operational Disruption} As in \autoref{sec:incident}, adversaries might not always seek financial gain. Instead, some aim to disrupt the operations of a wallet, primarily through indirect attacks. By destabilising the wallet's operations, adversaries can attempt other, more significant attacks.
% \paragraph{Privacy Compromise} These less common motivation focuses on de-anonymising the wallet user.
% \paragraph{Information Theft} Personal information, contact details and transactions can also be targeted by attackers in an attempt to undergo further attacks.

% \paragraph{Network-related Capabilities}
% Regarding network-related capabilities, an attacker possesses multiple avenues of potential disruption. Firstly, they can control the system’s network, allowing for significant influence over its operations. Secondly, they can intercept and modify the network's traffic, which can manipulate the data being sent or received. Lastly, the attacker can directly disrupt a system’s network, causing interruptions or complete outages.
% \paragraph{Application-related Capabilities}
% Concerning application-related capabilities, attackers have a wide range of techniques at their disposal. They can manipulate or deceive users into revealing their private keys, putting personal assets at risk. In addition, they can extract sensitive information from devices, potentially leading to further breaches. Vulnerabilities in the application library can also be exploited, as can storage vulnerabilities within devices. Moreover, these adversaries have the know-how to deploy malicious software directly into the application, adding another layer of potential threat.
% \paragraph{Storage-related Capabilities}
% Attacks can exploit vulnerabilities in various storage types, including physical devices and cloud storage systems, employing tactics such as unauthorised access, data tampering, and other breaches to jeopardise data integrity and recovery efforts.
% \paragraph{Authentication-related Capabilities}
% Here, an attacker can capture and alter data during its transmission. An attacker can methodically attempt to derive or decrypt a private key.
% \paragraph{Blockchain-related Capabilities}
% In this case, an attacker can exploit a wide range of vulnerabilities inherent to smart contract wallets.



% --
% Our system model categorises all prominent wallet attacks into four layers: application, network, storage and authentication. Application attacks on crypto wallets encompass software vulnerabilities and manipulative tactics, targeting user interactions, and software libraries to compromise assets and sensitive information. Network attacks target the communication between different consensus and connectivity layers of blockchain wallet networks, encompassing threats such as routing manipulation, de-anonymisation techniques, \acf{mitm} intrusions, \acf{dns} exploits, and \acf{dos} disruptions. Authentication attacks target the private key or sensitive information directly to gain unauthorised access to the accounts of users.

% --
% \subsection{Adversary's Objectives}

% The major goal of the adversary is three-fold; first, the adversary attempts to compromise the security of the private key, second, the adversary attempts to modify transaction messages inputted by the user and thirdly, the adversary attempts to compromise the cryptographic algorithms of the wallet mechanism.