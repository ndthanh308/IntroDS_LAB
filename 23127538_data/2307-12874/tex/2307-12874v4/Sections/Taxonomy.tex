\section{Design Decisions}
\label{sec:wallet-taxonomy}


We propose a design framework for developing wallets that integrates traditional models and recent advancements. To develop this framework, we analyse various designs of wallets within the industry. We also identify known vulnerabilities and previous attacks associated with these wallets, as summarised in \autoref{tab:wlt._taxonomy}. 

% Lastly, we provide a security and privacy evaluation of individual wallet design factors. 

% This evaluation does not serve as a method to aggregate individual factors to evaluate the overall privacy of a wallet.

% Additionally, we examine several academic wallet solutions to ensure applicability. Based on this analysis, we categorise existing wallets according to design factors such as infrastructure, custody, initialisation, distribution, authentication, authorisation, validation, and recovery. Furthermore, we identify known vulnerabilities and previous attacks associated with these wallets, as summarised in \autoref{tab:wlt._taxonomy}. 

% what methodology was used to come to this design taxonomy
% how did you select the wallets in the table

\subsection{Infrastructure}
\label{sec:infrastructure}

This design factor is centred on the private key (\teal{$sk$}) or transaction management infrastructure (see \autoref{sec:wallet_mechanism}) the controlling entity employs. 

% For ease of illustration, we also represent custodial wallet designs as desktop, browser, and mobile; however, this is merely to demonstrate user options as the exchange manages \teal{$sk$} by design.

\subsubsection{Software Wallets}
\label{sec:software-wallets} 

% The first wallet application Bitcoin Core, as well as Electrum, Exodus and Atomic wallets, are examples notable examples.

% However, integration with simplified payment verification (SPV) or a centralised server enables efficient transaction verification \cite{biryukov2019security}. 

Software wallets are applications that manage private keys (\teal{$sk$}) or transaction authorisation conditions within a software environment. Existing software infrastructure designs include desktop, browser, mobile and smart contract wallets. Desktop wallets are installed on computers and typically store \teal{$sk$} on a local file in the computer's file system of the software environment. Browser wallets present an alternative setup, as programs are installed or built into the web browser and credentials are typically stored in the browser's local storage \cite{2024MetaMaskWallet}. Two existing designs are browser extensions such as Metamask and Phantom and built-in browser-native such as Brave \cite{Brave2023BraveBrave}. Another prevalent wallet type is the mobile wallet which is installed on devices with limited computing power and storage capability in comparison with PCs. Mobile wallets also typically store \teal{$sk$} locally and can enhance security with mobile \acs{os} integrations such as the Android Keystore and iOS Keychain \cite{keystore}. However, should vulnerabilities be present in the operating system \autoref{sec:threat_class}, there exists susceptibility to specific attacks that exploit these weaknesses (see \autoref{sec:privilege}). Metamask, Phantom, Brave and Coinbase wallets are available as mobile wallets.

To mitigate the risk of \teal{$sk$} and \teal{$rdm\_seed$} loss, smart contract wallets (e.g. Argent and Safe) are deployed on the blockchain to abstract typical \teal{$sk$} management (see \autoref{sec:wallet_mechanism}) and create advanced transaction functions such as multi-factor authentication, ownership assignments, spending limits, and recovery mechanisms, often through integration with centralised or decentralised relayers \cite{di2020characteristics, erc4337}. Despite these advanced capabilities, these wallets are susceptible to specific vulnerabilities due to the immutable nature of blockchain. Flawed implementation and access control in parity wallet resulted in significant financial losses \cite{palladino2017parity}.

% % Figure environment removed

% scale used to be = 0.11

% \begin{itemize}
%     \item \textbf{Definition}
%     \item \textbf{Mechanism}
%     \item \textbf{Security Features}
%     \item \textbf{Vulnerabilities}
%     \item \textbf{Example}
% \end{itemize}

% accessible on browsers or browser extensions

% Unlike desktop wallets, these wallets offer the advantage of accessibility to cryptocurrencies across multiple devices to enhance user flexibility and minimise the risks associated with reliance on a single device \cite{consensys2}. To achieve this, MetaMask stores \teal{$sk$}, seed phrases, and \teal{$pw$} locally in the browser's data cache. This data is encrypted and can be accessed when \teal{$pw$} is input. However, despite this, some web wallets such as Bitstamp are known to store data on third-party servers.

% These wallets typically store \teal{$sk$} locally and can enhance security with mobile \acs{os} integrations such as the Android Keystore and iOS Keychain, which ensure secure management and isolation from other applications \cite{keystore}.

% \subsubsection{Paper Wallets}
% \label{sec:paper-wallets} 

% Paper wallets were introduced to the broader crypto community through platforms such as Bitaddress.org by Peter Kroll in 2011 \cite{paperwallet}. As one of the earliest forms of offline storage, these wallets emerged following the development of desktop wallets, aiming to mitigate online threats. \teal{$sk$} and \teal{$pub\_key$} pairs are generated, as detailed in \hyperref[algo:cryptocurrency-wallet]{Algorithm} \autoref{algo:cryptocurrency-wallet}, then printed on paper, often encoded as QR codes or mnemonics, to ensure secure offline storage. Unlike typical key storage algorithms that require user authentication, paper wallets simplify the security process by eliminating digital storage \cite{GkaniatsouAndrianaandArapinis2017, bitcoinwallet}. However, this method requires manual input for transaction signing, sacrificing some convenience for increased security.

% Over time, the concept of physical wallets evolved, with notable innovations such as the Casascius coins (similar to paper wallets but the \teal{$secret\_keys$} are concealed under a tamper-resistant hologram), introduced by Mike Caldwell in 2011 \cite{adrianne2013casascius}. Nonetheless, regulatory measures, particularly the FinCEN's order in 2013, significantly curtailed the production of these funded bitcoin tokens \cite{ahonen2016encyclopedia}. 

% The popularity of paper wallets has also waned currently due to their inherent limitations, such as promoting address reuse, reliance on centralised validation, and the risks associated with managing raw private keys and executing transactions. Modern alternatives, including seed phrases and deterministic wallets, have been developed to offer more secure and user-friendly solutions. These advancements address the drawbacks of traditional paper wallets and mitigate the risks associated with their use, marking a significant evolution in cryptocurrency storage solutions.

% \subsubsection{Brain Wallets}
% \label{sec:brain-wallets} 

% As the cryptocurrency ecosystem developed, brain wallets emerged around 2012 as another alternative method of key storage, relying entirely on the cognitive ability of individuals to memorise a passphrase or seed phrase \cite{vasek2017bitcoin}. By eliminating the need for physical storage, these wallets place the security of the funds entirely in the owner's memory.

% However, the simplicity of brain wallets comes with considerable risks. If the passphrase, which acts as the private key, is forgotten or inadequately complex, the funds are irrevocably lost or susceptible to brute-force attacks (see \autoref{sec:brute-force}). The security of brain wallets is wholly dependent on the user's ability to create and recall a sufficiently random and complex passphrase. Despite these vulnerabilities, brain wallets provide a unique method of managing and spending funds securely by importing private keys into wallet clients when necessary for transactions \cite{brain}.

% To address these security issues, recent innovations have sought to enhance the usability and safety of brain wallets. In 2019, a semi-custodial brain wallet was developed, which simplifies the user's burden by only requiring them to remember a username and password, while a server assists in a key generation without storing the complete key \cite{aman2019zerowallet}. This model has been further enhanced with post-quantum cryptography to fortify the security of brain wallets, offering a more robust solution that attempts to balance the ease of use with enhanced security measures \cite{kethepalli2023reinforcing}.

\subsubsection{Hardware Wallets}
\label{sec:hardware-wallets}

Hardware wallets typically involve \teal{$sk$} management within a \acf{se} (e.g. microcontroller or smart card), to protect against tampering and facilitate the execution of cryptographic operations, such as transaction signing (see \autoref{sec:wallet_mechanism}). Isolated in design with no internet connectivity functionality, their mechanism operates by performing all cryptographic operations on an offline hardware device and typically requires a distinct online device to create and broadcast transactions \cite{ledgeracademy}. The connection between both devices can be achieved by Bluetooth (e.g. Ledger), USB (e.g. Trezor), NFC (e.g. Tangem) and QR codes (e.g. Ngrave). Despite these implementations, hardware wallets have been liable to supply chain \cite{ledger_vuln}, software \cite{Cointelegraph2023LedgerRedefined, Ledger2018FirmwareFixed} and other vulnerabilities \cite{CoinDesk2018SecurityAntennae, Freemindtronic2023LedgerHackers}.

% \autoref{sec:threat_class} classifies threats and vulnerabilities in the wallet system. 


% Hardware wallets exist in air-gapped such as Ngrave, USB or Bluetooth such as Ledger and Trezor, and Tangen.

% Hardware wallet design focuses on the physical form of the offline hardware, the internet connectivity method it employs and the mechanism design. Examples of hardware wallets include

% Table to show

% exist in air-gapped such as, USB or Bluetooth such as or smart card

% Hardware wallets exist in various forms, including USB devices, air-gapped setups, and smart cards as shown in \autoref{fig:wallet-taxonomy}. 

% \begin{itemize}
%     \item \textbf{Definition}
%     \item \textbf{Mechanism}
%     \item \textbf{Security Features}
%     \item \textbf{Vulnerabilities}
%     \item \textbf{Example}
% \end{itemize}

% The transaction process in hardware wallets involves two critical stages: transaction creation and transaction transmission \cite{ledgeracademy}. The transaction creation stage begins when the user initiates a transaction through a client interface, such as a wallet or web application. Created transaction details are then securely communicated to the hardware wallet, typically via a physical connection or a secure wireless connection such as Bluetooth. The user then reviews and confirms these details on the device’s secure display, ensuring that the transaction data has not been tampered with, even if the computer or smartphone is compromised \cite{ivanov2021ethclipper}.

% Once confirmed, the hardware wallet cryptographically signs the transaction within its secure environment, utilising a non-extractable private key that never leaves the device \cite{ivanov2021ethclipper}. The signed transaction is then transmitted to the client software, which broadcasts it to the blockchain network. 


% ----
% was commented out before
% This design effectively safeguards against malware, phishing attacks, and other common vectors of cyber theft, ensuring that the transaction signature can only occur with the user's explicit approval \cite{arapinis2019formal}.
% ----

% Designed to operate in potentially malicious environments, hardware wallets can function offline, minimising threats posed by online attacks. The devices require physical user interaction for each transaction, embedding the user in the verification loop and establishing a trusted pathway for confirming transaction authenticity \cite{arapinis2019formal}. This hands-on verification process is critical, especially when the client device might be under the control of an attacker \autoref{sec:attack-framework}.


% ----
% was commented out before
% % Figure environment removed
% ----

% Despite early challenges related to transaction speed and dependency on the physical device, recent advancements have significantly broadened the capabilities of hardware wallets. Modern versions now support multiple currencies, can interact directly with decentralised applications (DApps), and seamlessly integrate with smartphone applications, enhancing user convenience and extending their utility beyond simple storage \cite{8966739}.


% The foundational concept of smart contract wallets stems from the \acf{eip} 86 introduced in 2016. This proposal aimed to enhance the flexibility of signature (\teal{$\sigma$}) verification and facilitate the creation of account contracts \cite{eip86}. The concept was further developed and standardised with the introduction of \acs{eip}-4337 in 2021, which provides a more decentralised framework than earlier smart contract wallet implementations like Argent and Safe \cite{EIP4337}. 

% These wallets also incorporate multi-factor authentication, multi-signature authorisation, and seamless interaction with various blockchain functions and external libraries securely \cite{di2020wallet}.

% Smart contract wallets now represent one of the latest technological advancements in the wallet landscape, enabling highly flexible and secure transaction management (see \autoref{sec:transaction_management} by utilising smart contracts to allow operations to be processed directly on the blockchain. 


% without private key generation (see \hyperref[algo:key-generation]{Algorithm} \autoref{algo:key-generation}) or storage (see \hyperref[algo:key-storage]{Algorithm} \autoref{algo:key-storage})

% Furthermore, the complexity of setting up and managing these wallets, along with the associated gas fees for deployment and operation can pose barriers to entry for some users, potentially limiting their widespread adoption.

\subsection{Custody}
\label{sec:design-cust}

The degree of \teal{$sk$} control by an entity or between one or more entities defines custody design. Custody setups include custodial, non-custodial and semi-custodial.

\subsubsection{Custodial}
\label{sec:custodial-wallets}

\teal{$sk$} is stored by a trusted custodian (e.g. Coinbase, Binance, Kraken) who signs user-initiated transactions in this model. The user relinquishes \teal{$sk$} security to the custodian who fully controls the wallet operations (see \autoref{sec:wallet_mechanism}, while the user solely crafts transaction messages. Although most of the design factors for custodial wallets are not disclosed (see \autoref{tab:wlt._taxonomy}), a classification of their design can be conducted using our framework. Two notable design variations exist: an omnibus setup, where the custodian aggregates and controls all users' funds under a few shared addresses, without a one-to-one correspondence between user accounts and addresses; and a segregated setup, where each user is assigned a unique blockchain address, with the custodian retaining control of the associated private keys (\teal{$sk$}) \cite{chalkias2022broken}.



% Custodial wallets, such Kraken, Coinbase Exchange, Bitbuy, and Xapo \cite{chalkias2022broken} facilitate an indirect blockchain interaction through a central authority which stores the private key and signs transactions on behalf of the user. The wallet initialisation (see \hyperref[algo:cryptocurrency-wallet]{Wallet Initialisation Algorithm}) begins as the user creates an account using email/username and \teal{$pw$}, and the \teal{$sk$} is generated by the custodian. The custodian typically employs a combination of hot and cold private key storage \cite{sans2022decentralized}. While users cannot directly access the private key, they can initiate custodian-signed transactions by providing their credentials (see \hyperref[algo:transaction-signing]{Transaction Generation Algorithm}). The custodian matches the transaction with peers to execute it (see \hyperref[algo:transaction-broadcast]{Transaction Broadcast Algorithm}). This model offers convenience, especially for novices or frequent traders, but it comes with security risks due to its centralised management structure, as user data is stored on servers. 

% The security and reliability of these wallets depend on the trustworthiness of the managing organisation's infrastructure. Furthermore, custodial wallets are subject to stringent regulatory oversight, including compliance with KYC and AML guidelines, which can impact user privacy \cite{vadlamani2023bridging}. Currently, custodial wallets provide functionality exclusively for managing tokens, not decentralised applications.

\subsubsection{Non-Custodial}
\label{sec:non-custodial-wallets}

In non-custodial wallet architectures, (e.g. Metamask, Phantom, Ledger) the user does not relinquish any control to any custodian party. Instead, a direct interaction between the user and the blockchain network exists in these setups with the user in full control of \teal{$sk$}, to facilitate all the wallet operations (see \autoref{sec:wallet_mechanism}). With full autonomy, the user is solely responsible for securing \teal{$sk$} and is more susceptible to insecure user interaction threats as well as other vulnerabilities (see \autoref{sec:threat_class}) and attacks such as social engineering attacks and malware-based attacks (see \autoref{sec:application-attacks}) which aim to exploit user negligence. While non-custodial wallets are expected to not have credential control, a few incidents in the past (e.g. Slope Wallet \cite{CoinTelegraph}) have resulted in \teal{$sk$} compromise due to poor implementation practices, insecure storage of sensitive information, or inadvertent leaks \cite{CoinTelegraph2022SlopeAttack}.


% (\teal{$enc\_secret\_key$}) are employed to store the private keys, with the user setting up a password for protection \cite{goodell2021development}. Users can access their stored private keys by decrypting (\teal{$dec\_secret\_key$}) them with the password to initiate transactions. They create transactions, sign them with their private keys (see \hyperref[algo:transaction-signing]{Transaction Generation Algorithm}), and broadcast them to the network (see \hyperref[algo:transaction-broadcast]{Transaction Broadcast Algorithm}). Non-custodial wallets, exemplified by MetaMask, Safe, and Ledger, are favoured by users who prioritise asset control, privacy, and security. The autonomy of non-custodial wallets comes with the responsibility of securing and managing private keys, posing a risk of irreversible loss if keys are misplaced or inadequately backed up.


\subsubsection{Shared-Custodial}
\label{sec:semi-custodial-wallets}

Shared-custodial wallets strike a balance between custodial and non-custodial models by enabling joint control of the secret key (\teal{$sk$}) between a user and a custodian. In this setup, the \teal{$sk$} is split or distributed across two or more parties, allowing the user to delegate a degree of transaction authorisation rights and trust to the custodian. This arrangement provides both parties with partial control over the wallet's signing and recovery operations. As a result, even if one party's security is compromised, the risk of a complete \teal{$sk$} compromise is mitigated. For example, Zengo’s operational model implements shared custody with \acf{mpc} by storing one part of the \teal{$sk$} on Zengo's centralised server, while the other part remains on the user's device \cite{zengo_rec}. Other shared custodian models are discussed in \autoref{sec:design-distr}.

% The degrees of control can be .

% Despite challenges in user experience, technological advancements are improving accessibility. Non-custodial wallets are less regulated than their custodial counterparts and offer a more flexible operational environment. Additionally, non-custodial crypto wallets can also be used to interact with smart contracts, providing users with a broader range of functionalities \cite{bowler2023non}.


% \subsection{Internet Connectivity}
% \label{sec:internet-connectivity}

% The internet connectivity dimension plays a crucial role in the security and accessibility of crypto wallets. 

% \subsubsection{Hot Wallets}
% \label{sec:hot-wallets}

% Hot wallets, characterised by their constant connectivity to the internet, play a crucial role in the cryptocurrency ecosystem due to their convenience and ease of access \cite{khanum2022exposure}. These wallets, including software wallets (see \autoref{sec:software-wallets}) such as Bitbuy, MetaMask, and smart contract wallets (see \autoref{sec:smart-contract-wallets}) like Safe and Argent, provide users with the ability to perform transactions quickly and efficiently. This feature makes them particularly suitable for frequent traders and those who need regular access to their digital assets. However, this constant online presence inherently increases the vulnerability of hot wallets to various cyber threats \autoref{sec:attack-framework}. 

% Despite these risks, hot wallets continue to evolve, with recent advancements focusing on enhancing security through measures such as biometric authentication and improved encryption methods.

% \subsubsection{Cold Wallets}
% \label{sec:cold-wallets}

% Cold wallets operate entirely offline and are considered to be the secured crypto storage mechanisms \cite{8966739}. These wallets include hardware wallets such as Ledger and Anchorage, as well as paper wallets, which are particularly adept at safeguarding large amounts of cryptocurrency from online threats. Software wallets managed by a few exchanges store \teal{$sk$} isolated from the internet, to mitigate the risk of cyber attacks. However, this security comes at the cost of reduced accessibility and convenience. Users of cold wallets must consider the risks associated with physical damage, loss, or theft, necessitating careful planning for secure storage and backup. 

% Despite these challenges, technological developments in cold wallets are gradually enhancing their user-friendliness, making them more accessible to a broader audience.

\subsection{Initialisation}
\label{sec:design-init}

This pertains to the creation of the wallet through \teal{$sk$} generation (see \autoref{sec:key_generation}) or contract deployment. During initialisation in smart contract wallets, user account contracts are created typically by interactions made by the relayer. In conventional wallets, the \teal{$sk$} generation scheme can be non-deterministic, deterministic, or hierarchical deterministic, depending on the degree of randomness and flexibility required. Another interesting design option is the key derivation factor (KDF) choice. Typically, most wallets (e.g. Ledger \cite{ledger_seed}) employ \acf{pbkdf}, however, novel research into threshold \acf{mfkdf} construction could influence current cryptographic designs \cite{NairMulti-FactorManagement, nair2023decentralizing}. While this improves security, more processing time and power may be required to generate the derived key \cite{trezor_memory}.

% add a little bit of maths notation.

% Another design factor is the distribution during key generation. 

% \subsubsection{Non-Deterministic}

% \subsubsection{Deterministic}

% \subsubsection{Hierarchical Deterministic (HD)}
% \label{sec:bip-32}
% Bitcoin Improvement Proposal 32 (BIP-32) \cite{bip32} introduces a system for creating Bitcoin wallets in a structured, hierarchical way. This system uses complex mathematical problems and secure hashing algorithms (specifically, elliptic curve discrete logarithm problem and HMAC-SHA512) to ensure that the wallet and its sub-wallets (or keys) are very secure. Each \quotes{child} key, or sub-wallet, is generated in a way that makes it extremely difficult to trace back to the \quotes{parent} key, adding an extra layer of security.




% \input{Exhibits/Types-Wallets}


\subsection{Distribution}
\label{sec:design-distr}

This is the degree of authorisation (see \autoref{sec:design-author}) or \teal{$sk$} distribution between storage mechanisms.  Single or variations of shared authorisation between multiple user devices, multiple users or a user and a custodian (see \autoref{sec:design-cust} are observable setups. Single setups allow for sole authorisation by a user or custodian while authorisation is distributed in the shared setup to avoid a single point of failure. Multi-distributed designs typically exist in two forms; smart wallet-enabled multi-sig (on-chain multi-sig) and threshold \acs{mpc}. On-chain multi-sig typically have authorisation dispersed between multiple private keys \teal{$sk$}, while \acs{mpc} wallets divide a single \teal{$sk$} into \enquote{key shares} which are then distributed \cite{bip11, Lindell2020SecureComputation}. Design flexibility in some \acs{mpc} wallets also allows for a hierarchical sub-shard distribution (e.g. Web3Auth) if necessary \cite{web3_auth}. While both offer authorisation distribution, trade-offs exist between the two (see \autoref{sec:design-author} \& \autoref{sec:design-val}).

\subsection{Authentication}
\label{sec:design-authen}

We define authentication as the process of verifying the legitimate wallet owner before granting access, either by decrypting \teal{$sk$} with the \acs{kek} (see \autoref{sec:key-storage}) or by employing other methods defined within the underlying logic. Existing authentication methods include single-factor (\teal{$pw$} or \teal{$PIN$}), multi-factor authentication and novel password-abstracted authentication methods such as passkey enabled by smart contract or MPC wallets. For instance, the Binance Web3 MPC wallet splits cryptographic key shards between the user, a cloud provider (e.g., iCloud or Google Drive), and Binance itself, requiring user authentication to retrieve at least two of the three shards to approve transactions \cite{Binance2023EmbracingWallet}.

% would be also interesting to also talk about authentication between the client and the server, semi-custodian methods of authentication - authentication is very concerned with control ie custodians and non-custodians -- how is the user authentication before the private key is decrypted or accessed or before an authorisation is possible. 

% would be interesting to look at the operations of
% mpc wallets 
% tangem wallets - is very interesting too

% Transaction authorisation can be designed to either require a single or multiple signature, alternatively, a relayer can trigger the process, following approval on a user's behalf.

% transaction authorisation is triggered on the user's behalf by a relayer.

% or a more complex architecture where by a relayer signs transactions on behalf of users.

% in the context of wallet design 


\subsection{Authorisation}
\label{sec:design-author}

Authorisation in the context of wallets is defined as a direct or indirect confirmation of a state change transaction (see \autoref{sec:def:tnx}) by a single signature or multiple signatures. An indirect authorisation is executed via a centralised or decentralised relayer's signature who signs on behalf of a user (e,g, ERC-4337 architecture \cite{erc4337}). \acs{mpc} key shards produce a single signature, while distributed among various parties with individual public addresses hidden. Multi-sig smart wallets demonstrate authorisation through multiple signatures, each associated with an individual public address, which does not enhance privacy since all involved addresses are visible on the blockchain. ERC-4337-enabled smart contract wallets employ a relayer (bundler) to aggregate multiple users' state transfer messages into a single authorised transition. Other factors which influence the authorisation setup include the signature scheme choice.

% requires multiple private keys \teal{$sk$} to sign a transaction 

% Smart multi-sig traditionally required multiple private keys \teal{$sk$} to sign a transaction 


% Rather than safeguarding a single \teal{$sk$}, \ac{mpc} wallets divide \teal{$sk$} into \enquote{shards} or \enquote{key shares} and distribute them among multiple parties, which are then used to sign the transaction. 

% With custom logic and recent developments, smart contract wallets can sign messages 

% mpc blockchain agnostic

% mpc is private

% lower fees - faster transactions

% multi-sig is no protocol agnostic

% multi-sig is not operational flexible


\subsection{Validation}
\label{sec:design-val}
Transaction validation is typically referred to as authentication against the blockchain using the user's \teal{$pk$} \cite{Homoliak2024SoK:Factors, Homoliak2020SmartOTPs:Wallets}. In addition to single distributed wallets, \acs{mpc} wallet also produces a single \teal{$pk$} from key shards, which can be employed to validate the transaction. On the other hand, native multi-sig wallets validate each party's public key. ERC-4337 allows more flexible validation variations, as an EntryPoint contract validates and executes state changes sent by authenticated users \cite{erc4337}. Additionally, recent developments (ERC-1271 \cite{Ethereum2018ERC-1271:Contracts} \& ERC-6492 \cite{Ethereum2023ERC-6492:Contracts}) have enabled standardised and improved signature validation methods for smart contracts. 

% % Figure environment removed


\subsection{Recovery and Other Design Factors}
\label{sec:design-rec}

Recovery serves as a method to retrieve \teal{$sk$} or lost transaction authorisation rights and typically follows the initialisation (see \autoref{sec:design-init}) and the distribution \autoref{sec:design-distr} setup selected. Single-distributed wallets are generally recovered using one method such as \teal{$rdm\_seed$}, while multi-distributed recovery varies based on the implementation. Recovery has different cost implications in smart contract wallets and \acs{mpc} wallets. \acs{mpc} wallets are recovered off-chain and have no costs, while Smart contract wallets (e.g. Coinbase Smart Wallet) generally require you to pay a network for account recovery. However, a smart contract wallet, Argent circumvents this by offering users off-chain recovery \cite{argent_rec}. 

\autoref{tab:wlt._taxonomy} shows other design factors such as transparency and agnosticism. The underlying mechanism of existing hardware, software, non-custodial and semi-custodial wallets often function in degrees of transparency. While open-source models benefit from public audits, open knowledge of mechanisms can provide an advantage to an adversary. Blockchain agnosticism is another important factor. Integration with multiple blockchain networks defines blockchain-agnosticism. As blockchains often operate as fragmented systems, heterogeneous designs foster enhanced interoperability.

% \begin{itemize}
%     \item Bloom Filter Multi-Party Computation Paper \cite{Han2021AnFilter}
%     \item Hardware and Smart Contract Paper \cite{Homoliak2020SmartOTPs:Wallets}
%     \item A Novel Cryptocurrency Wallet Management Scheme Based on Decentralized Multi-Constrained Derangement \cite{He2019ADerangement}
%     % \item New Secure Approach to Backup Cryptocurrency Wallets \cite{rezaeighaleh2019new}
%     \item SBLWT: A Secure Blockchain Lightweight Wallet Based on Trustzone \cite{Dai2018SBLWT:Trustzone}
%     \item A Social-Network-Based Cryptocurrency Wallet-Management Scheme \cite{He2018AScheme}
%     \item A Secure and Flexible Blockchain-Based Offline Payment Protocol \cite{Jie2024AProtocol}
%     \item Multilayered Defense-in-Depth Architecture for Cryptocurrency Wallet \cite{Rezaeighaleh2020MultilayeredWallet}
%     \item Deterministic Sub-Wallet for Cryptocurrencies \cite{Rezaeighaleh2019DeterministicCryptocurrencies}
%     \item An Anti-Quantum Transaction Authentication Approach in Blockchain \cite{Yin2017AnBlockchain}
%     \item CryptoVault - A Secure Hardware Wallet for Decentralized Key Management \cite{Lehto2021}
%     \item Trustzone-based secure lightweight wallet for hyperledger fabric \cite{Dai2021Trustzone-basedFabric}
%     \item Secure wallet-assisted offline bitcoin payments with double-spender revocation \cite{Dai2021Trustzone-basedFabric}
%     \item Enhancing Cold Wallet Security with Native Multi-Signature schemes in Centralized Exchanges \cite{Ebrahimi2021EnhancingExchanges}
%     \item A Two-Party Hierarchical Deterministic Wallets in Practice \cite{Chuang2023APractice}
%     \item Shared-Custodial Password-Authenticated Deterministic Wallets \cite{Das2024Shared-CustodialWallets}
%     % this paper's related work also shows shared custodian settings of  a client and a server jointly generating a key
% \end{itemize}





% \subsection{Security Design Evaluation}
% \label{sec:design-eval}

% We propose a framework to qualitatively evaluate the security of existing wallets on individual design factors as shown in \autoref{tab:design_eval}. We denote the wallet user by \teal{$U$} and the adversary by \teal{$A$}.

% \subsubsection{Custody*}
% \label{sec:design-eval-cust}

% The threat is 
% While the security architecture of custodial 
% The entity authorised to control \teal{$sk$}. 

% \begin{itemize}
%     \item \textbf{High Security:}
%     \item \textbf{Medium Security:}
%     \item \textbf{Low Security:} 
% \end{itemize}

% \subsubsection{Infrastructure}
% \label{sec:design-eval-infra}

% We define this by the degree to which the attack surface area reduces or increases due to inherent vulnerabilities and defence implementations within the infrastructure. All wallet types, with the exception of smart contract wallets, possess traditional cryptographic vulnerabilities. The browser wallet, for instance, exposes \teal{$sk$} to new infrastructural vulnerabilities without providing any notable defence implementations. On the other hand, the hardware wallet provides specific defence implementations that reduce the attack surface area of \teal{$A$}.


% % which is locally stored 

% \begin{itemize}
%     \item \textbf{Typical Traditional Vulnerabilities =:} 
%     \item \textbf{Inherent Infrastructural Vulnerabilities -:}
%     \item \textbf{Inherent Infrastructural Security +:} 
% \end{itemize}


% approach -- 
% 1. define typical wallet vulnerabilities i.e. common vulnerabilities on most wallets i.e cryptographic vulnerabilities common in desktop, browser, mobile and hardware

% 2. define inherent infrastructural vulnerabilities i.e. new vulnerabilities that exist as a result of deployment on a given infrastructure i.e. browser, or smart contracts

% 3. inherent infrastructural security i.e. design in infrastructure which limits attack surface to a degree. 

% 4. classification as high medium or low:
% low: browser: vulnerability to both traditional vulnerabilities -- introduced new vulnerabilities based on the infrastructure -- infrastructure does not provide a significant defence implementation
% medium: desktop: vulnerability to both traditional vulnerabilities -- introduced new vulnerabilities based on the infrastructure -- infrastructure does not provide a significant defence implementation
% high: hardware: vulnerability to traditional -- introduced no or a few vulnerabilities -- infrastructure provides significant defence

% need to decide where to place mobile and smart contract
% -- both are likely to be placed in medium because -- mobile would inherent some vulnerabilities i.e. in OS e.g. android OS vulnerabilities but might also inherent some security features -- smart contract on the other hand removes traditional vulnerabilities but introduces new vulnerabilities -- and also new forms of security. 

% to attacks which leverage the nature

% \begin{itemize}
%     \item \textbf{High Security:} Hardware Airgapped \& Hardware USB
%     \item \textbf{Medium Security:} Desktop Wallet \& Mobile
%     \item \textbf{Low Security:} Browser Wallets
% \end{itemize}

% \subsubsection{Initialisation***}
% \label{sec:design-eval-init}

% We define the initialisation score by determinants which ensure a higher or lower degree of security during this stage. For instance, \acs{dkg} offers a higher level than non-distributed key generation. 

% \begin{itemize}
%     \item \textbf{High Security:}
%     \item \textbf{Medium Security:}
%     \item \textbf{Low Security:} 
% \end{itemize}



% \input{Exhibits/Design-Evaluation}



% \subsubsection{Distribution}
% \label{sec:design-eval-dist}

% We define the distribution by the number of parties to which \teal{$sk$}  is distributed and the relationship between parties i.e. parties which share common themes such as organisation, which may aid the adversary.

% \begin{itemize}
%     \item \textbf{High Security:}
%     \item \textbf{Medium Security:}
%     \item \textbf{Low Security:} Non-distributed
% \end{itemize}


% \paragraph{Number of Parties}
% \label{sec:design-eval}

% \paragraph{Controlling Entity}
% \label{sec:design-eval}

% \subsubsection{Authentication}
% \label{sec:design-eval-authen}

% We define sub-metrics by the level or levels of authentication required before access to \teal{$sk$} or the respective account(s).

% \begin{itemize}
%     \item \textbf{High Security:} MFA
%     \item \textbf{Medium Security:} 2FA
%     \item \textbf{Low Security:} Single authentication
% \end{itemize}


% \subsubsection{Authorisation***}
% \label{sec:design-eval-author}

% \subsubsection{Validation*}
% \label{sec:design-eval-val}

% We define this metric by the security of the validation system. For instance, validation in wallets ranges from cryptographic validation to pre-defined logic validation.

% \begin{itemize}
%     \item \textbf{High Security:} Cryptographically Validated
%     \item \textbf{Medium Security:} 
%     \item \textbf{Low Security:} Contract Validation
% \end{itemize}

% \subsubsection{Recovery}
% \label{sec:design-eval-rec}

% We define this metric by the degree of vulnerability of the recovery method to attacks.

% \begin{itemize}
%     \item \textbf{High Security:} No Seed Phrase / Social Recovery
%     \item \textbf{Medium Security:} Seed Phrase
%     \item \textbf{Low Security:} Files or Duplicated Private Key
% \end{itemize}


% --
% just commented out 
% privacy evaluation 

% \subsection{Privacy Design Evaluation}
% \label{sec:design-eval}

% We also map individual wallet design considerations to privacy implications on \teal{$U$}. 

% \subsubsection{Custody*}
% \label{sec:design-eval-cust}

% \begin{itemize}
%     \item \textbf{High Privacy:} Non-Custodial 
%     \item \textbf{Medium Privacy:} Shared-Custodial
%     \item \textbf{Low Privacy:} Custodial
% \end{itemize}

% \subsubsection{Infrastructure}
% \label{sec:design-eval-infra}

% The browser wallet exposes \teal{$sk$} which is locally stored 

% \begin{itemize}
%     \item \textbf{High Privacy:} Desktop
%     \item \textbf{Medium Privacy:} Hardware
%     \item \textbf{Low Privacy:} Browser Mobile Smart Contract
%     % Hardware Airgapped \& Hardware USB \& Desktop Wallet \& Mobile
% \end{itemize}

% \subsubsection{Initialisation}
% \label{sec:design-eval-init}

% \begin{itemize}
%     \item \textbf{High Privacy:} \acs{hd}
%     \item \textbf{Medium Privacy:}
%     \item \textbf{Low Privacy:} Non-Deterministic
% \end{itemize}

% \subsubsection{Distribution}
% \label{sec:design-eval-dist}

% \begin{itemize}
%     \item \textbf{High Privacy:} \acs{mpc}
%     \item \textbf{Medium Privacy:}
%     \item \textbf{Low Privacy:} Multi-sig
% \end{itemize}

% \subsubsection{Validation*}
% \label{sec:design-eval-val}

% Transaction validation design decisions influence the degree of privacy in wallets.

% \begin{itemize}
%     \item \textbf{High Privacy: Full Node Validation} 
%     \item \textbf{Medium Privacy: Some Light Client} 
%     \item \textbf{Low Privacy: Servers} 
% \end{itemize}

% \input{Exhibits/Types- Academia}


\subsection{Discussion}
\label{sec:tax_discussion}
\subsubsection{Insight 1: Infrastructure Evolution}

The key management infrastructure dimension in our taxonomy has been a product of evolution influenced by two major factors; security and functionality, as shown in \autoref{fig:wallet-evolution}.

% Figure environment removed

\input{Exhibits/Types-Wallets}

\paragraph{\textbf{Security-Focused Evolution}} 
The infrastructural evolution of wallets with a focus on security has been a response to the inherent vulnerabilities associated with software-based systems. This led to the development of hardware wallets as well as paper and brain key storage mediums, which introduce an offline component into traditional wallet architectures, effectively reducing the attack vectors associated with internet connectivity. 

% --
% just commented out 

% Initial forms such as paper and brain wallets, though highly secure due to their offline nature, were not without drawbacks. These wallets compromise on user convenience to improve security. Paper wallets necessitated secure physical storage, while brain wallets relied on the user's ability to memorise and safeguard complex passphrases. The advent of hardware wallets marked a significant milestone, offering an engaging user experience while maintaining the core principle of offline key storage through highly secure, physical devices. Looking forward, we anticipate an improved hardware wallet functionality without compromising its foundational security features.


\paragraph{\textbf{Functionality-Focused Evolution}} 

The drive towards improved functionality has resulted in the development of web, mobile, and smart contract wallets. These wallets marked a notable shift towards enhanced flexibility and user convenience. Web and mobile wallets introduced the ability to manage cryptocurrencies across various platforms, while smart contract wallets further expanded wallet capabilities through advanced and flexible transaction management. 


% Major catalysts for evolution on this axis have been improvement proposals on Bitcoin and Ethereum.

% As the cryptocurrency ecosystem developed, brain wallets emerged around 2012 as another alternative method of key storage, relying entirely on the cognitive ability of individuals to memorise a passphrase or seed phrase \cite{vasek2017bitcoin}. By eliminating the need for physical storage, these wallets place the security of the funds entirely in the owner's memory. However, the simplicity of brain wallets comes with considerable risks. If the passphrase, which acts as the private key, is forgotten or inadequately complex, the funds are irrevocably lost or susceptible to brute-force attacks (see \autoref{sec:brute-force}). The security of brain wallets is wholly dependent on the user's ability to create and recall a sufficiently random and complex passphrase. Despite these vulnerabilities, brain wallets provide a unique method of managing and spending funds securely by importing private keys into wallet clients when necessary for transactions \cite{brain}. To address these security issues, recent innovations have sought to enhance the usability and safety of brain wallets. In 2019, a semi-custodial brain wallet was developed, which simplifies the user's burden by only requiring them to remember a username and password, while a server assists in a key generation without storing the complete key \cite{aman2019zerowallet}. This model has been further enhanced with post-quantum cryptography to fortify the security of brain wallets, offering a more robust solution that attempts to balance the ease of use with enhanced security measures \cite{kethepalli2023reinforcing}.

\subsubsection{Insight 2: Nuanced Wallet Designs}
\label{sec:hybrid-multi-tier-wallets}

% % \subsubsection{Design Decisions}
% % \label{sec:design-decisions}

% The traditional classification of wallets into \enquote{hot} and \enquote{cold} categories based solely on internet connectivity is overly simplistic and fails to capture the nuanced operational mechanisms of modern wallets. While hardware wallets, often labelled as \enquote{cold}, generate \teal{$pk$} and sign transactions internally on an offline component, interaction with an online environment to broadcast transactions to the blockchain network is required for state change executions. This is consistent with how we describe the mechanism of a wallet in \autoref{sec:formalisation}.

We propose a more nuanced framework that considers internet connectivity as an additional factor across various phases of the wallet design. By incorporating connectivity as a dynamic attribute rather than a fixed binary state, we can more accurately assess a wallet's security complexity. Our design taxonomy also aids in the creation of more nuanced wallet solutions, as trade-offs exist within initialisation, distribution, authorisation, validation, authentication and recovery design factors. Therefore, expanding the design spectrum that can be streamlined to meet institutional and retail clients' requirements. We discuss the influence of design on threats in \autoref{sec:threats_dis_influence}.






% \subsubsection{Design Decisions}
% \label{sec:design-decisions}

% \subsubsection{Implication of Design Choice}
% \label{sec:existing-vulnerabilityy}


% have a look at TEE design paper for inspirartion

% The differentiation between cold and hot wallets should not exist, when there are both online and offline operations in 

% There should exist a more

% For instance, a mobile wallet can operate as a hardware wallet if the private key is stored in the secure enclave chip.


% Hardware and Software

% Custodial and Non-custodial

% Cold and Hot




% this was part of the text before but its a bit too long needs to be rewritten concisely

% Furthermore, a hybrid wallet can be formed by integrating functionalities from different types of wallets, effectively amalgamating the accessibility of an online wallet with the robust security features of a hardware wallet. These amalgamations broaden the options available to users and empower them to tailor their crypto wallets to suit their specific needs, striking an optimal balance between accessibility and security \cite{biernacki2021comparative}.

% \cite{kethepalli2023reinforcing}
