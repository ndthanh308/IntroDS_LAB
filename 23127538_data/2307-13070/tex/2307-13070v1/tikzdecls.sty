\usetikzlibrary{scopes,calc,arrows,patterns}
\tikzset{ed/.style={auto,inner sep=1pt,font=\scriptsize}} % edges
\tikzset{re/.style={font=\small}} % regions
%\tikzset{>=}
\tikzset{vert/.style={draw,circle,minimum size=14pt,inner sep=0pt,fill=white}}
%\tikzset{vert/.style={draw,circle,inner sep=1pt,fill=white}}
\tikzset{vert2/.style={draw,circle,inner sep=2pt,fill=white}}
\tikzset{ds/.style={line width=1.3pt}} % distinguished string


%%% Define colors
\newcommand{\colorschemeA}{
\colorlet{color1}{blue!40!white}
\colorlet{color2}{green!50!white}
\colorlet{color3}{red!35!white}
\colorlet{color4}{yellow!30!white}
\colorlet{color5}{pink!60!white}

\colorlet{color1dark}{blue}
\colorlet{color2dark}{green!50!black}
\colorlet{color3dark}{red}
\colorlet{color4dark}{yellow}
\colorlet{color5dark}{pink}
}

\newcommand{\colorschemeB}{
\definecolor{color1}{HTML}{56B4E9}
\definecolor{color2}{HTML}{37C554}
\definecolor{color3}{HTML}{F57272}
\definecolor{color4}{HTML}{E8E074}

\colorlet{color1dark}{blue}
\colorlet{color2dark}{green!50!black}
\colorlet{color3dark}{red}
\colorlet{color4dark}{yellow}
}

\colorschemeA
\tikzset{color1fill/.style={fill=color1}}
\tikzset{color2fill/.style={fill=color2}}
\tikzset{color3fill/.style={fill=color3}}
\tikzset{color4fill/.style={fill=color4}}
\tikzset{color5fill/.style={fill=color5}}
\tikzset{dotsF/.style={pattern=north east lines,pattern color=black!60!white}}
\tikzset{dotsG/.style={pattern=north west lines,pattern color=black!60!white}}

\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{decorations}
\tikzset{transf/.style={decorate,decoration={zigzag,amplitude=1pt,segment length=3pt}}}

\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}

%% Use this to draw a background cylinder, and clip everything
%% afterwards to lie on it.
% #1 = lower-left corner
% #2 = height
% #3 = half width = major semiaxis
% #4 = minor semiaxis
% #5 = front color
% #6 = back color
%% Defines coordinates (ul), (ur), (dl), (dr), (top), and (bot).
\def\bgcylinder#1#2#3#4#5#6{
  \def\cylempty{}\def\cylfrontcolor{#5}\def\cylbackcolor{#6}
  \begin{pgfonlayer}{background}
    \ifx\cylfrontcolor\cylempty\draw\else\fill[fill=#5]\fi
    (#1) coordinate (dl)
    -- ++(0,#2) node[coordinate] (ul) {} % I don't know why "coordinate" fails
    arc (-180:0:#3 and #4) coordinate (ur)
    -- ++(0,-#2) node[coordinate] (dr) {}
    arc (0:-180:#3 and #4);
    \ifx\cylbackcolor\cylempty\draw\else\fill[fill=#6!80!black]\fi
    ($(ul)!.5!(ur)$) node[coordinate] (top) {} ellipse (#3 and #4);
    \path (dl) arc (-180:-90:#3 and #4) node[coordinate] (bot) {};
    % It appears that clipping is defined separately for each layer.
    \clip (dl) -- (ul) arc (-180:0:#3 and #4) -- (dr) arc (0:-180:#3 and #4);
  \end{pgfonlayer}
  \begin{pgfonlayer}{foreground}
    \clip (dl) -- (ul) arc (-180:0:#3 and #4) -- (dr) arc (0:-180:#3 and #4);
  \end{pgfonlayer}
  \clip (dl) -- (ul) arc (-180:0:#3 and #4) -- (dr) arc (0:-180:#3 and #4);
  \path (ul) ++(-0.1,0.1) coordinate (ul');
  \path (ur) ++(0.1,0.1) coordinate (ur');
  \path (dl) ++(-0.1,-0.1) coordinate (dl');
  \path (dr) ++(0.1,-0.1) coordinate (dr');
  \path (top) ++(0,0.1) coordinate (top');
  \path (bot) ++(-0,-0.1) coordinate (bot');
}

%% Use this to assign coordinates to the parts of a theta loop and
%% draw the dashed part around the back of the cylinder.
% #1 = reference point (only y-coordinate matters)
% #2 = vertical offset -- right end of dashed part will be at #1.y + #2
% #3 = vertical distance between right and left ends of dashed part (can be positive or negative) -- left end will be at #1.y + #2 - #3
% #4 = prefix of resulting names (gets L and R added on).
% #5 = additional arguments to draw
\def\drawtheta#1#2#3#4#5{
  \path ($(ur)!#1!(dr) + (0, #2)$) coordinate (#4R);
  \draw[dashed,#5] (#4R) to [out=\ifnum #3>0 -90\else 90\fi,in=\ifnum #3>0 90\else -90\fi,looseness=0.5] ($(ul)!(#4R)!(dl) + (0,-#3)$) coordinate (#4L);
  \path (#4L) -- ++(-0.1,0) coordinate(#4L');
  \path (#4R) -- ++(0.1,0) coordinate(#4R');
}
