% !TEX root = jmlr_version.tex

\begin{lemma}
\label{lemma: estimation of nclusters}
Suppose Condition~\ref{cond: theta distribution-a} holds. Then, we have $\estimator[\nclusters] = \nclusters$ with probability $\nsize^{-\Omega(\log \nsize)}$.
\end{lemma}

\begin{proof}
Note that for any indices $j \in [\nsize]$ we have 
    \begin{align}
    \label{eq: spectral displacement bound}
      |\lambda_j(\probMatrix) - \lambda_j(\adjacencyMatrix)| \le \Vert \displaceMatrix \Vert
    \end{align}
    due to Weyl's inequality. Since $\lambda_j(\probMatrix) = 0$ for $j > \nclusters$, we have $\max_{j > \nclusters} |\lambda_j(\adjacencyMatrix)| \le \Vert \displaceMatrix \Vert$. Let us bound the norm of $\displaceMatrix$ via the matrix Bernstein inequality. Decompose
    \begin{align*}
      \displaceMatrix = \sum_{1 \le i \le j \le \nsize} \displaceMatrix_{i j} (\ev_i \ev_j^{\T} + \ev_j \ev_i^{\T}) \cdot \frac{2 - \delta_{i j}}{2}.
    \end{align*}
    and apply Lemma~\ref{lemma: matrix bernstein inequality} for the summands. We obtain
    \begin{align*}
      \PP \left( 
        \Vert \displaceMatrix \Vert \ge t
      \right)
      \le \exp \left(-\frac{t^2 / 2}{\sigma^2 + \frac{1}{3} t} \right).
    \end{align*}
    where 
    \begin{equation*}
      \sigma^2
      = 
      \left \Vert 
        \sum_{1 \le i \le j \le \nsize} \EE \displaceMatrix_{ij}^2 (\ev_i \ev_j^{\T} + \ev_j \ev_i^{\T}) \frac{(2 - \delta_{ij})^2}{4}
      \right \Vert
      \le
      \left \Vert \diag \left( \sum_{t = 1}^{\nsize} \probMatrix_{i t} (1 - \probMatrix_{i t}) \right)_{i = 1}^{\nsize} \right \Vert
      \le
      \max_{i \in [\nsize]} \sum_{t = 1}^{\nsize} \probMatrix_{i t}.
    \end{equation*}
    %
    Thus,
    \begin{align*}
      \PP \left(
        \Vert \displaceMatrix \Vert \ge \max_{i} \sqrt{\sum_{t = 1}^{\nsize} \probMatrix_{it}} \log \nsize
      \right) = \nsize^{-\Omega(\log \nsize)}.
    \end{align*}
    %
    Meanwhile,
    \begin{align*}
      & \quad \PP \left(
        \sum_{t = 1}^{\nsize} \adjacencyMatrix_{i t} \le \frac{1}{2} \sum_{t = 1}^{\nsize} \probMatrix_{i t}
      \right)
      = 
      \PP \left(
        \sum_{t = 1}^{\nsize} (\adjacencyMatrix_{i t} - \probMatrix_{i t}) \le - \frac{1}{2} \sum_{t = 1}^{\nsize} \probMatrix_{i t}
      \right ) \\
      &=
      \PP \left(
        \sum_{t = 1}^{\nsize} (\probMatrix_{i t} - \adjacencyMatrix_{i t}) \ge \frac{1}{2} \sum_{t = 1}^{\nsize} \probMatrix_{i t}
      \right) 
      \le 
      \exp \left( 
        -\frac{
          \left [\frac{1}{2} \sum_{t = 1}^{\nsize} \probMatrix_{i t} \right ]^2
        }{
          \sparsityParam \nsize + \frac{1}{3} \cdot \frac{1}{2} \sum_{t = 1}^{\nsize} \probMatrix_{i t}
        }
      \right)
      =
      \exp \bigl(-\Omega(\nsize \sparsityParam)\bigr).
    \end{align*}
    %
    Consequently,
    \begin{align*}
      \PP \left( \Vert \displaceMatrix \Vert \ge 2 \max_{i \in [\nsize]} \sqrt{\sum_{t = 1}^{\nsize} \adjacencyMatrix_{i t} \log^2 \nsize}  \right) \le \nsize^{-\Omega(\log \nsize)}.
    \end{align*}
    %
    Hence, combining the above with~\eqref{eq: spectral displacement bound}, we obtain that
    \[
      \estimator[\nclusters] = \min_{j} \left\{\lambda_j(\adjacencyMatrix) \ge 2 \max_{i \in [\nsize]} \sqrt{\sum_{t = 1}^{\nsize} \adjacencyMatrix_{i t} \log^2 \nsize} \right\}
    \]
    is at most $\nclusters$ with probability $\nsize^{-\Omega(\log \nsize)}$. Due to Lemma~\ref{lemma: eigenvalues asymptotics}, we have $\lambda_\nclusters(\probMatrix) = \Theta(\nsize \sparsityParam)$ and, therefore, 
    \begin{align*}
      \PP \left( 
        2 \sqrt{\sum_{t = 1}^{\nsize} \adjacencyMatrix_{i t} \log^2 \nsize} \ge \lambda_{\nclusters} - \Vert \displaceMatrix \Vert
      \right)
      =
      \exp \bigl(-\Omega(\nsize)\bigr).
    \end{align*}
    %
    Consequently, $\estimator[\nclusters] = \nclusters$ with probability $\nsize^{-\Omega(\log \nsize)}$.
\end{proof}
