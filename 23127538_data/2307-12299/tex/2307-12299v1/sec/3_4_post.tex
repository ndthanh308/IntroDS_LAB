\subsection{Topology correction}
\label{sec:tc}

We propose a pipeline to fix the topological defects present in $\hat{\mathcal{M}}$. The WM meshes are prone to having \qq{holes} while the pial meshes tend to have \qq{handles}, which prevent the reconstructed meshes from being genus-0. Four cortical meshes in $\hat{\mathcal{M}}$ can be post-processed in parallel. For simplicity, we will note $\hat{\mathcal{M}}$ as a single mesh (either WM or pial) in this section.

\input{fig/topo_corr}
%%
We first binarize the predicted indicator grids $\hat{\chi}$ into masks, selecting the largest connected component that contains the majority of voxels. The binary masks are then transformed into signed distance grids \cite{butt1998optimum} and smoothed with a Gaussian filter having a standard deviation of 1. 
%%
In Fig.~\ref{fig:topo_corr}, we demonstrate how we transform $\hat{\mathcal{M}}$ into topologically correct $\hat{\mathcal{M}}_{tc'}=(\hat{\mathcal{V}}_{tc'}, \hat{\mathcal{E}}_{tc})$.
%%
To fill the holes in WM meshes (Fig.~\ref{fig:wm_topo}), we extract the $\tau_{wm}$-level set of the smoothed signed distance grid, where $\tau_{wm} = 0.5$. Similarly, to address the handles in pial meshes (Fig.~\ref{fig:gm_topo}), we extract the $\tau_{pial}$-level set of the smoothed singed distance grid, where $\tau_{pial} = -1.8$.
%%

Then, we apply optimization-based diffeomorphic registration to map $\hat{\mathcal{M}}_{tc'}$ to $\hat{\mathcal{M}}$, obtaining the accurate, topologically correct cortical reconstruction results, denoted as $\hat{\mathcal{M}}_{tc}=(\hat{\mathcal{V}}_{tc}, \hat{\mathcal{E}}_{tc})$, as indicated by the dotted red contours in Fig.~\ref{fig:topo_corr}.
%%
To do so, we assume ${\boldsymbol{v}}$ in Eq.~\ref{eq:forward_ode} is stationary and can be modeled via a neural field \cite{xie2022neural, sun2022mirnf}, such that $\mathcal{F}_{\theta}(\boldsymbol{p}) = [\boldsymbol{v}_{p_x}, \boldsymbol{v}_{p_y}, \boldsymbol{v}_{p_z}]^T$, where $\boldsymbol{p}$ and $\theta$ denote the network 3D coordinates and parameters. 
%%
Then, the initial value problem (IVP) in Eq.~\ref{eq:forward_ode} can be solved with a Differentiable ODE Solver (NODE) \cite{chen2018neural} whose dynamic function is set to be $\mathcal{F}_{\theta}$. 

In the forward pass, the destination position $\hat{\boldsymbol{p}}_{tc} \in \hat{\mathcal{V}}_{tc}$ starting from $\hat{\boldsymbol{p}}_{tc'} \in \hat{\mathcal{V}}_{tc'}$ is estimated by integrating $\mathcal{F}_{\theta}(\boldsymbol{p})$ from $t=0$ to $t=1$ via 4th-order Rungeâ€“Kutta methods with step size being 0.2. 
%%
For backpropagation, NODE adopts the adjoint sensitivity method \cite{pontryagin1987mathematical}, which retrieves the gradient by solving the adjoint ODE backwards in time and allows solving with O(1) memory usage no matter how many steps the ODE solver takes.
%%
The network parameters $\theta$ are optimized with chamfer distance using the Adam optimizer for 75 iterations with a step size of 3e-4. To compute the chamfer distance, we sample 150,000 points with normals from both $\hat{\mathcal{M}}_{tc}$ and $\hat{\mathcal{M}}_{tc'}$ per iteration. 

% \vspace{-0.8em}
\subsection{Learning-based Surface Refinement}
\label{sec:refine}
A learning-based diffeomorphic surface registration model, similar to CortexODE~\cite{ma2022cortexode}, is utilized to generate refined cortical meshes $\hat{\mathcal{M}}_f=(\hat{\mathcal{V}}_f, \hat{\mathcal{E}}_{tc})$ given $\hat{M}_{tc}$. It will remove some artifacts introduced during the topology correction procedures and improve the alignment of the cortical surfaces with the original 3D MRI data.
%%
Different from the CortexODE, our refined pial surfaces $\hat{\mathcal{M}}_f^{pial}$ are transformed from $\hat{\mathcal{M}}_{tc}^{pial}$ instead of $\hat{\mathcal{M}}_{tc}^{wm}$. 
%%
