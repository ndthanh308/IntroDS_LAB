% The key idea is replacing the negative log likelihood $\cL^{(1)}_\cD(\cdot)$ with some curve with constant Hessian $\EE_{\nu^{\pi^t, \theta^*}}[\psi^{t, \theta^*} {\psi^{t, \theta^*}}^\top]$ in the neighbourhood of $\theta^*$. Specifically, we first lower bound $\cL^{(1)}_\cD(\hat\theta_\MLE)-\cL^{(1)}_\cD(\theta^*)$ by the Hellinger distance $T^{-1}\cdot\sum_{t=1}^T D_\H^2(\nu^{\pi^t, \hat\theta_\MLE}, \nu^{\pi^t, \theta^*})$ and some $\cO(T^{-1})$ term. Then, a careful scrutiny of the Hellinger distance will show that $$D_\H^2(\nu^{\pi^t, \theta}, \nu^{\pi^t, \theta^*})\ge B_A^{-2} (\theta-\theta^*)^\top\EE^{\nu^{\pi^t, \theta^*}}[\psi^{t, \theta^*} {\psi^{t, \theta^*}}^\top](\theta-\theta^*).$$
% To make the above discussion rigorous, we first invoke the following concentration Lemma.
\begin{proof} 
We prove this lemma by leveraging 
 \Cref{lem:freeman-variation} with $X_t = (-\cL_{h,t}(\theta) + \cL_{h, t}(\theta^*))/2$ where $\cL_{h}^t(\theta)=-\sum_{i=1}^{t-1} \eta A_h^{\pi^i, \theta}(s_h^i,b_h^i)$. 
We choose filtration $\cF_{h, t-1}=\sigma(\tau^{1:t-1})$ where $\sigma(X)$ denotes the $\sigma$-algebra generated by $X$ and $\tau^{1:t-1}$ is just the history up to $t-1$.
Let $\cN_\rho(\Theta, \epsilon)$ be  the covering number for the $\epsilon$-covering net of $\Theta$  with respect to norm $\rho$ defined in \eqref{eq:rho for MLE}. 
Let $\Theta_\epsilon$ be  the $\epsilon$-covering net of $\Theta$. 
To simplify the notation, we define  $\iota =  \log\rbr{ H\cN_\rho(\Theta, \epsilon) / \delta}$.
Then, for all $\theta \in \Theta_{\epsilon}$, 
we have with probability $1-\delta$ for all $h\in[H], t\in[T]$ that
\begin{align}
    &\frac 1 2 \rbr{-\cL_h^t(\theta) + \cL_h^t(\theta^*)} \nend
    &\quad\le \sum_{i=1}^{t-1} \log\EE^{\pi^i   }\sbr{\sqrt{ \nu_h^{\pi^i,\theta}(\cdot\given s_h) \big / \nu_h^{\pi^i, \theta^*}(\cdot\given s_h)}}  + \log\rbr{ H\cN_\rho(\Theta, \epsilon) / \delta} \nend
    &\quad\le -  \sum_{i=1}^{t-1} \EE^{\pi^i }\Bigl [ D_\H^2\bigrbr{\nu_h^{\pi^i, \theta}(\cdot\given s_h ), \nu_h^{\pi^i, \theta^*}(\cdot\given s_h )} \Bigr ] + \log\rbr{ H\cN_\rho(\Theta, \epsilon) / \delta}, \label{eq:MLE-to-hellinger-1}
\end{align}
where the expectation is taken with respect to the true model. 
Here, the first inequality holds by applying  \Cref{lem:freeman-variation} and   taking a union bound over the  $\epsilon$-covering net. 
% Note that $\log(\cN_\rho(\Theta, \epsilon))$ only grows with 
% $\log(\eta T)$ since $\cL_{h,t}(\theta)$ is $2\eta$-Lipschitz with respect to $\theta$. 
The second inequality holds by noting that $\log(x)\le x-1$ and by the definition of the Hellinger distance.


Meanwhile, by the definition of the distance $\rho$ in   \eqref{eq:rho for MLE},
for any $\theta, \tilde \theta \in \Theta$, we have 
\begin{align*}
&|D_\H^2(\nu_h^{\pi,\theta}, \nu_h^{\pi, \theta^*}) - D_\H^2(\nu_h^{\pi,\tilde\theta}, \nu_h^{\pi, \theta^*})|\nend
&\quad \le (D_\H^2(\nu_h^{\pi,\theta}, \nu_h^{\pi, \theta^*}) + D_\H^2(\nu_h^{\pi,\tilde\theta}, \nu_h^{\pi, \theta^*})) \cdot 
\bigabr{D_\H^2(\nu_h^{\pi,\theta}, \nu_h^{\pi, \theta^*}) - D_\H^2(\nu_h^{\pi,\tilde\theta}, \nu_h^{\pi, \theta^*})}\nend
&\quad \le 2 D_\H(\nu_h^{\pi,\tilde\theta}, \nu_h^{\pi,\theta})\nend
&\quad \le 2\rho(\theta, \tilde\theta), 
\end{align*} 
where  the second inequality holds by noting that the Hellinger distance does not exceed 1, and that the Hellinger distance satisfies the triangle inequality as a norm, and the last inequality holds by definition of $\rho$. 
Moreover, by noting that $\cL_h^t(\theta)=-\sum_{i=1}^t \eta A_h^{\pi^i, \theta}(s_h^i,b_h^i)$, we have
\begin{align*}
\bigl | \cL_h^t (\theta ) - \cL_h^t(\tilde \theta ) \bigr |
&\le \eta T \max_{i\in[t-1]}\bigabr{ A_h^{\pi^i, \theta}(s_h^i,b_h^i) - A_h^{\pi^i, \tilde\theta}(s_h^i,b_h^i)}\nend
&\le 2\eta T \max_{i\in[t-1]}\bignbr{ Q_h^{\pi^i, \theta}- Q_h^{\pi^i, \tilde\theta}}_\infty \nend
&\leq 2 T \cdot \rho(\theta, \tilde \theta),
\end{align*}
where the second inequality holds by noting that $|(V_h^{\pi, \theta} - V_h^{\pi, \tilde\theta})(s_h)| \le \onbr{Q_h^{\pi,\theta}-Q_h^{\pi,\tilde\theta}}_\infty$ by the same argument in \eqref{eq:f_2-01} and \eqref{eq:f_2-1}, and the last inequality holds by noting that $\eta\le (\gamma B_A + 1 + \eta)$.
% \Zhuoran{Derive the second one, STOP HERE}
Therefore, 
adding an extra term $3T\epsilon$ to the right-hand side of \eqref{eq:MLE-to-hellinger-1} extends the result to any $\theta\in\Theta$ by definition of the covering net $\Theta_\epsilon$.
We thus obtain for all $\theta\in\Theta, h\in[H], t\in[T]$ with probability $1-\delta$,
\begin{align}
    \frac 1 2 \rbr{-\cL_h^t(\theta) + \cL_h^t(\theta^*)} 
    &\le -  \sum_{i=1}^{t-1} \EE^{\pi^i, \theta^*}D_\H^2\rbr{\nu_h^{\pi^i, \theta}(\cdot\given s_h^i), \nu_h^{\pi^i, \theta^*}(\cdot\given s_h^i)} \nend
    &\qquad + \log\rbr{ H\cN_\rho(\Theta, \epsilon) / \delta} + 3T\epsilon. \label{eq:KL-2-D_H-online}
\end{align}
% As an alternative, we can also take the filtration as $\cF_{h, t-1} = \sigma(\{s_{h}^i \}_{i\in[t]}, \{b_h^i\}_{i\in[t-1]})$ and obtain a similar result
% \begin{align}
%     \frac 1 2 \rbr{-\cL_h^t(\theta) + \cL_h^t(\theta^*)} 
%     &\le - \sum_{i=1}^{t-1} D_\H^2\rbr{\nu_h^{\pi^i, \theta}(\cdot\given s_h^i), \nu_h^{\pi^i, \theta^*}(\cdot\given s_h^i)} + \iota. \label{eq:KL-2-D_H-offline}
% \end{align}
In the sequel, we take $\epsilon=T^{-1}$ and  let $\iota= \log\rbr{ H\cN_\rho(\Theta, T^{-1}) / \delta}+ 3$.
Now, we plug in $\hat\theta_{h,\MLE}=\argmin_{\theta'\in\Theta} \cL_h^t(\theta')$ in \eqref{eq:KL-2-D_H-online}
%  and \eqref{eq:KL-2-D_H-offline},  
and obtain by the nonnegativity of the Hellinger distance that
\begin{align*}
    \cL_h^t(\theta^*) \le \inf_{\theta'\in\Theta} \cL_h^t(\theta' ) + 2\iota \le  \cL_h^t(\hat\theta_{h,\MLE}) + 2\iota  , 
\end{align*}
which guarantees that our confidence set is indeed valid by letting 
$$\beta \ge  2\iota = 2\log(e^3 H\cdot \cN_\rho(\Theta, T^{-1})/\delta). $$
Next, we show that our confidence set is also accurate.
For \eqref{eq:KL-2-D_H-online}, we have that
\begin{align}
    \sum_{i=1}^{t-1} \EE^{\pi^i, \theta^*}D_\H^2\rbr{\nu_h^{\pi^i, \theta}(\cdot\given s_h^i), \nu_h^{\pi^i, \theta^*}(\cdot\given s_h^i)} 
    &\le  \frac 1 2\rbr{\cL_h^t(\theta) - \cL_h^t(\theta^*)} +\iota\nend
    &\le \frac 1 2\rbr{\cL_h^t(\theta) - \cL_h^t(\theta^*)+\beta}, \label{eq:MLE-to-hellinger-2}
\end{align}
% and also 
% \begin{align*}
%     \sum_{i=1}^{t-1} D_\H^2\rbr{\nu_h^{\pi^i, \theta}(\cdot\given s_h^i), \nu_h^{\pi^i, \theta^*}(\cdot\given s_h^i)} \le  \frac 1 2\rbr{\cL_h^t(\theta) - \cL_h^t(\theta^*)} + \log\rbr{\frac{e^2H\cN_\rho(\Theta, T^{-1})}{\delta}}, 
% \end{align*}
Now, if $\theta\in\CI_{h,\Theta}^t(\beta)$, it follows directly from \eqref{eq:MLE-to-hellinger-2} that
\begin{align*}
    \sum_{i=1}^{t-1} \EE^{\pi^i, \theta^*}D_\H^2\rbr{\nu_h^{\pi^i, \theta}(\cdot\given s_h^i), \nu_h^{\pi^i, \theta^*}(\cdot\given s_h^i)} \le \beta, 
\end{align*}
which shows that our confidence set is also valid and gives \eqref{eq:MLE-guarantee-hellinger-2}.
%  since the righthand side can be replaced by $3/2 \beta$ using the fact that $\cL_h^t(\theta) - \cL_h^t(\theta^*)\le \cL_h^t(\theta) - \inf_{\theta'\in\Theta}\cL_h^t(\theta')\le \beta$  for any $\theta\in\CI_\Theta(\beta)$.
We next show how to derive the bound for the Q function. Invoking \Cref{lem:D_H-2-A^2}, we have that
\begin{align}
    8 D_\H^2\rbr{\nu_h^{\pi, \hat\theta}(\cdot\given s_h), \nu_h^{\pi, \theta^*}(\cdot\given s_h)} 
    &\ge \rbr{\frac{\eta}{1+\eta B_A}}^2\cdot \inp[\Big]{\nu_h^{\pi, \theta^*}}{ \orbr{A_h^{\pi, \hat\theta}-A_h^{\pi, \theta^*}}^2} \nend
    &\ge \rbr{\frac{\eta}{1+\eta B_A}}^2\cdot \EE_{s_h}^{\pi, \theta^*}\rbr{\bigrbr{\EE_{s_h, b_h}^{\pi, \theta^*} - \EE_{s_h}^{\pi, \theta^*}}\osbr{A_h^{\pi, \hat\theta}-A_h^{\pi, \theta^*}}}^2\nend
    &= \rbr{\frac{\eta}{1+\eta B_A}}^2\cdot \EE_{s_h}^{\pi, \theta^*}\Bigrbr{\orbr{\EE_{s_h, b_h}^{\pi, \theta^*} - \EE_{s_h}^{\pi, \theta^*}}\osbr{Q_h^{\pi, \hat\theta}-Q_h^{\pi, \theta^*}}}^2, \label{eq:hellinger-2-Q}
\end{align}
where the second inequality follows from the Jensen's inequality, and the last inequality holds by invoking \eqref{eq:A diff-1} in \Cref{lem:AQV-func diff}. One can also swap $\theta^*$ and $\hat\theta$ by the exchangeability of the Hellinger distance and obtain another version.  Note that $C_\eta = \eta^{-1}+B_A$. 
Plugging \eqref{eq:hellinger-2-Q} with $C_\eta$ into the previous accuracy guarantees gives \eqref{eq:MLE_guarantee_Q}.
%  and \eqref{eq:MLE_guarantee_Q-1}. 
Therefore, we have proved \eqref{eq:MLE-guarantee-hellinger-2} and \eqref{eq:MLE_guarantee_Q}. 
For deriving \eqref{eq:MLE-guarantee-hellinger-1} and \eqref{eq:MLE_guarantee_Q-1}, we just change our filtration to $\cF_{h, t-1} = \sigma((s_h^i, b_h^i)_{i\in[t-1]}, s_h^t)$ and everything follows. 

Lastly, we prove the guarantee in \eqref{eq:MLE-guarantee-Q-3}. 
We use \eqref{eq:MLE_guarantee_Q-1} with $\theta'$ replaced by $\theta^*$ and for all $\theta\in\CI_{h, \Theta}^t(\beta)$, 
\begin{align*}
    \sum_{i=1}^{t-1} {\Var_{s_h^i}^{\pi^i, \theta^*} \bigsbr{Q_h^{\pi^i, \theta}(s_h, b_h) - Q_h^{\pi^i, \theta^*}(s_h, b_h)}} \le 4 C_\eta^2 \rbr{\cL_h^t(\theta) - \cL_h^t(\theta^*)+ \beta} \le 8 C_\eta^2 \beta, 
    % \label{eq:MLE_guarantee_Q-1} 
\end{align*}
which is equivalent to saying that for all $h\in[H], \theta\in\CI_{h, \Theta}^t(\beta)$,
\begin{align}
    \sum_{i=1}^{t-1} 
    \EE_{s_h^i}^{\pi^i,\theta^*}\rbr{\rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta*}}(s_h^i, b_h^i)
    -\EE_{s_h^i}^{\pi^i,\theta^*}\sbr{ \rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h, b_h)}}^2 \le 8 C_\eta^2 \beta. \label{eq:MLE-Q-ub-1}
\end{align}
Recall the covering net $\Theta_\epsilon$ we constructed before. For all $\theta\in\Theta_\epsilon \cap \CI_{h,\Theta}^t(\beta), h\in[H]$, and a given $t\in[T]$, we have  by a standard martingale concentration in \Cref{cor:martigale concentration} that with probability at least $1-2\delta$,
\begin{align*}
    &\sum_{i=1}^{t-1} 
    \rbr{\rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h^i, b_h^i)
    -\EE_{s_h^i}^{\pi^i,\theta^*}\sbr{ \rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h, b_h)}}^2 
    \nend
    &\quad \le \frac 3 2\sum_{i=1}^{t-1}\EE_{s_h^i}^{\pi^i,\theta^*} 
    \rbr{\rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h^i, b_h)
    -\EE_{s_h^i}^{\pi^i,\theta^*}\sbr{ \rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h, b_h)}}^2 \nend
    &\qqquad + 32 B_A^2 \log\rbr{2H \cN_\rho(\Theta, \epsilon)\delta^{-1} }\nend
    &\quad \le 12 C_\eta^2 \beta  +32 B_A^2 \log\rbr{2H \cN_\rho(\Theta, \epsilon)\delta^{-1} }\le 28 C_\eta^2 \beta 
\end{align*}
where the second inequality follows from \eqref{eq:MLE-Q-ub-1}. 
Moreover, we note that
\begin{align*}
    &\rbr{\rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h^i, b_h)
    -\EE_{s_h^i}^{\pi^i,\theta^*}\sbr{ \rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h, b_h)}}^2 \nend
    &\qqquad - \rbr{\rbr{Q_h^{\pi^i, \tilde\theta} - Q_h^{\pi^i, \theta*}}(s_h^i, b_h)
    -\EE_{s_h^i}^{\pi^i,\theta^*}\sbr{ \rbr{Q_h^{\pi^i, \tilde\theta} - Q_h^{\pi^i, \theta^*}}(s_h, b_h)}}^2\nend
    &\quad \le 8 \cdot \max_{\pi\in\Pi,\theta\in\Theta}\bignbr{Q_h^{\pi,\theta}}_\infty
    \cdot 2 \bignbr{Q_h^{\pi^i, \theta} -  Q_h^{\pi^i, \tilde\theta}}_\infty \le 16 B_A \rho(\theta, \tilde\theta),
\end{align*}
where the last inequality holds by noting that $B_A$ upper bounds $\max_{\theta\in\Theta, \pi\in\Pi, h\in[H]}\onbr{Q_h^{\pi, \theta}}_\infty$ and using the definition of $\rho$. 
% and $\cN_\varrho (\Theta, \epsilon)$ is the covering number of the smallest $\epsilon$-covering number of $\Theta$ with respect to distance 
% \begin{align*}
%     \varrho(\theta, \tilde\theta) \defeq \max_{\pi\in\Pi, h\in[H]}\nbr{Q_h^{\pi, \theta} - Q_h^{\pi, \tilde\theta}}_\infty.
% \end{align*}
As a result, for all $\theta\in\CI_\Theta(\beta), h\in[H]$, and a given $t\in[T]$, we conclude that with probability at least $1-2\delta$,
\begin{align*}
    &\sum_{i=1}^{t-1} 
    \rbr{\rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i }}(s_h^i, b_h^i)
    -\EE_{s_h^i}^{\pi^i,\theta^*}\sbr{ \rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h, b_h)}}^2  \le 28 C_\eta^2 \beta  + 16 B_A.
\end{align*}
Replace $\delta$ by $\delta/2$, we have for all $\theta\in\CI_\Theta(\beta), h\in[H]$ and a given $t\in[T]$ with probability at least $1-\delta$ that 
\begin{align*}
    &\sum_{i=1}^{t-1} 
    \rbr{\rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i }}(s_h^i, b_h^i)
    -\EE_{s_h^i}^{\pi^i,\theta^*}\sbr{ \rbr{Q_h^{\pi^i, \theta} - Q_h^{\pi^i, \theta^*}}(s_h, b_h)}}^2 
    \nend
    &\quad \le 28 C_\eta^2 \beta + 56 C_\eta^2\log 2 +16 B_A =  \cO(C_\eta^2 \beta).
\end{align*}
which 
finishes the proof of \Cref{lem:MLE-formal}.
\end{proof}