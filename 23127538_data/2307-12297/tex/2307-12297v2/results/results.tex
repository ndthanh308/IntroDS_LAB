% Figure environment removed%
% Difference figure
\newcommand{\heightDiffRes}{13ex}
\newcommand{\makeDiffRow}[1]{\subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}}
\newcommand{\makeDiffFig}[7]{% Figure environment removed}
\makeDiffFig{NeveYaar_210520_1}{NeveYaar_210520_2}{MevoBytar_210818_2}{Tzora_210523_9}{NirEliyho_211005_0}{NirEliyho_211005_10}{MevoBytar_210818_1}
% Patches figure
\newcommand{\heightPatchRes}{0.16\linewidth}%
\newcommand{\makePatchRow}[1]{\subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
}%
\newcommand{\makePatchesFig}[5]{% Figure environment removed}%
\makePatchesFig{180725_Ramon_1}{180805_Peach_31}{180805_Peach_37}{MevoBytar_210818_69}{YanivReshef_190816_32}%
% Figure environment removed%
\noindent To demonstrates the efficacy of our method, we compared the mean absolute error (MAE) of the temperature estimation with different blocks of the network, namely with and without the offset estimation block, and using an end-to-end (E2E) network instead of the KPN architecture. The results are displayed as a function of the number of frames $\nFrames$ in \cref{fig:metrics}.
Whereas our method can handle misalignments between frames, other methods require a perfect alignment, which is impossible in real-world scenarios.
As a result, comparing temperature estimation with other methods is impossible, and we could only compare the NUC between our method and other methods on pivot frame $\mathcal{I}$. Moreover, the other methods are not radiometric, and thus cannot be used for temperature estimation.

\cref{fig:metrics} demonstrates the superiority of our method, evidence by the low MAE for almost every number of frames.
The E2E was a UNET~\cite{unet} architecture similar to our KPN network.
The main difference was that the last layer estimated the per-pixel result instead of outputting the kernel.
A hyperparameter search was also performed for the E2E solution for fair comparison (number of channels and normalization).
The MAE of the E2E network in \cref{fig:metrics} was unaffected by the number of frames, whereas the KPN results improved with the number of frames, indicating that the E2E network only uses the reference frame. Moreover, the MAE results for E2E were worse than for the KPN network.

The offset block greatly improved the results with increasing number of frames as seen in \cref{fig:metrics}, with an over $0.1^\circ C$ improvement for KPN and more than $0.2^\circ C$ improvement relative to E2E for $\nFrames=11$, indicating that the offset block is beneficial. Results suggested that increasing the number of frames without the offset block reaches a plateau at around $\nFrames=5$ and does not improve the results further, in contrast to the offset block which continues to improve the results with more frames. Since the offset block is lightweight, it offers significant improvement with little computational cost.

The effect of the number of frames $\nFrames$ is shown in \cref{fig:results:diff}. The figure shows per-pixel error in the temperature estimation for different numbers of frames.
The left-most figure (column a) shows the GT temperature map. 
The absolute per-pixel difference between the GT and our method's estimation for the area inside the red rectangle is shown in the next columns (b, c, and d). 
Each figure shows the estimated temperature for a different number of frames: (b) $N=7$ frames, (c) $N=9$ frames and (d) $N=11$ frames. 
The color bar on the right of each row shows the error range for the row in degrees Celsius. 
The MAE $^\circ C$ between the GT and the estimation is written in the top-left corner of each difference map. 
Each row is a different frame.
The improvement caused by the number of frames is clearly reflected by the homogeneity in the difference map and the decreasing MAE as a function of $\nFrames$.
More examples are available in the supplementary material, \cref{supp_diff_7,supp_diff_8,supp_diff_9,supp_diff_10,supp_diff_11}.

Because other methods are not radiometric and essentially only improve the appearance of a frame, we could only compare NUC results with other methods. 
\cref{fig:results:patches} displays the NUC results of different methods. Column (a) shows the reference sample frame. Column (b) shows the GT temperature map. Column (c) shows the results of our method. Column (d) shows the results of ADMIRE~\cite{Tendero12} performed on each frame separately and then registered and averaged. Column (e) shows the estimation of DeepIR~\cite{Saragadam2021} and column (f) shows the estimation of He et al.~\cite{He2018}.
All results were obtained with $\nFrames=11$.

As evidenced by \cref{fig:results:patches}, our NUC method was better than the others.
ADMIRE~\cite{Tendero12} failed to rectify the FPN,
DeepIR~\cite{Saragadam2021} hallucinated details (e.g., the deformation in the junction in the fourth row, or the abrupt black to white edge in the fifth row). 
He et al.'s~\cite{He2018} method failed to handle the FPN\@.
Both DeepIR~\cite{Saragadam2021} and He et al.~\cite{He2018} methods oversmoothed the results.
These methods have low fidelity, and thus are unable to serve for temperature estimation.
More results are available in the supplementary material, \cref{supp_patch_1,supp_patch_2,supp_patch_3,supp_patch_4,supp_patch_5,supp_patch_6}.

\cref{fig:results:convergence} depicts the convergence of the validation MAE loss of the E2E and of the KPN with and without the offset block, as a function of the number of frames. 
Notice that the loss for the E2E networks converges to roughly the same value for all numbers of frames, whereas the KPN-based networks give different results as a function of the number of frames $\nFrames$.
When comparing the convergence with and without the offset block, it seems that the offset block has a smoothing effect on the validation loss. This effect might occur because the KPN can concentrate on correcting the NUC, while the offset block handles the temperature estimation.

\subsection{Real data}\label{sec:results:realdata}
    \input{results/realdata.tex}