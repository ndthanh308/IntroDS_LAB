% Figure environment removed%
% Difference figure
\newcommand{\heightDiffRes}{13ex}
\newcommand{\makeDiffRow}[1]{\subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}}
\newcommand{\makeDiffFig}[7]{% Figure environment removed}
\makeDiffFig{NeveYaar_210520_1}{NeveYaar_210520_2}{MevoBytar_210818_2}{Tzora_210523_9}{NirEliyho_211005_0}{NirEliyho_211005_10}{MevoBytar_210818_1}
% Patches figure
\newcommand{\heightPatchRes}{0.16\linewidth}%
\newcommand{\makePatchRow}[1]{\subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
    \hfill
    \subfloat{% Figure removed}
}%
\newcommand{\makePatchesFig}[5]{% Figure environment removed}%
\makePatchesFig{180725_Ramon_1}{180805_Peach_31}{180805_Peach_37}{MevoBytar_210818_69}{YanivReshef_190816_32}%
% Figure environment removed%
\noindent To show the efficacy of our method, we compared the mean absolute error (MAE) of the temperature estimation with different blocks of the network, namely with and without the offset estimation block, and using an end-to-end (E2E) network instead of the KPN architecture. The results are displayed as a function of the number of frames $\nFrames$ in \cref{fig:metrics}.
While our method can handle misalignments between frames, other methods require a perfect alignment, which is impossible in real-world scenarios.
As a results, comparing temperature estimation with other methods is impossible, and we can only compare NUC between our method and other methods on the $\mathcal{I}$ pivot frame. Moreover, the other methods are not radiometric, and thus cannot be used for temperature estimation.

\cref{fig:metrics} demonstrates the superiority of our method, evident by the low MAE for almost every number of frames.
The E2E was a UNET~\cite{unet} architecture similar to our KPN network.
The main difference was that the last layer estimated the per-pixel result instead of outputting the kernel.
An hyperparameter search was also performed for the E2E solution for fair comparison (number of channels and normalization).
The MAE of the E2E network in \cref{fig:metrics} is unaffected by the number of frames, while the KPN results improve with the number of frames, indicating that the E2E network only uses the reference frame. Moreover, the MAE results for E2E were worse than for the KPN network.

The offset block greatly improves the results with the number of frames as seen in \cref{fig:metrics}, with more than a $0.1^\circ C$ improvement for KPN and more than $0.2^\circ C$ improvement relative to E2E for $\nFrames=11$, indicating that the offset block is beneficial. The results suggest that increasing the number of frames without the offset block reaches a plateau around $\nFrames=5$ and does not improve the results further, in contrast to the offset block which continues to improve the results with more frames. Since the offset block is lightweight, it offers significant improvement with little computational cost.

The effect of the number of frames $\nFrames$ is shown in \cref{fig:results:diff}. The figure shows per-pixel error in temperature estimation for different number of frames. The left-most figure (a) shows the GT temperature map. 
The absolute difference per-pixel between the GT and the estimation of our method for the area inside the red rectangle is shown in the next figures (b), (c), (d). 
Each figure shows the estimated temperature for a different number of frames - (b) $N=7$ frames, (c) $N=9$ frames and (d) $N=11$ frames. 
The color bar on the right of each row shows the error range for the row in $^\circ C$. 
The MAE in $^\circ C$ between the GT and the estimation is written in the top-left corner of each difference map. 
Each row is a different frame.
The improvement caused by the number of frames is clear by the homogeneity in the difference map and the MAE decreasing as a function of $\nFrames$.
More examples are available in the supplementary material on \cref{supp_diff_7,supp_diff_8,supp_diff_9,supp_diff_10,supp_diff_11}.

Because other methods are not radiometric and essentially only improve the appearance of a frame, we could only compare NUC results with other methods. \cref{fig:results:patches} displays NUC results of different methods. The first column (a) shows the reference sample frame. The second column (b) shows the GT temperature map. The third column (c) shows the results of our method. The fourth column (d) shows the results of ADMIRE~\cite{Tendero12} performed on each frame separately and than registered and averaged. The fifth column (e) shows the estimation of DeepIR~\cite{Saragadam2021} and the sixth column (f) shows the estimation of He et al.~\cite{He2018}.
All results were obtained with $\nFrames=11$.

Our method NUC is better than other methods, as evident in \cref{fig:results:patches}. ADMIRE~\cite{Tendero12} fails to rectify the FPN, DeepIR~\cite{Saragadam2021} hallucinates details (e.g., the deformation in the junction on the fourth row, or the abrupt black to white edge on the fifth row). He et al.~\cite{He2018} fails to handle the FPN\@. Both DeepIR~\cite{Saragadam2021} and He et al.~\cite{He2018} oversmoothes the results.
These methods have low fidelity, and thus are unable to serve for the purpose of temperature estimation.
More results are available in the supplementary material on \cref{supp_patch_1,supp_patch_2,supp_patch_3,supp_patch_4,supp_patch_5,supp_patch_6}.

\cref{fig:results:convergence} depicts the convergence of the validation MAE loss of the E2E and the KPN with the offset block and the KPN without the offset block, as a function of the number of frames. 
Notice that the loss for the E2E networks convergence to roughly the same value for all number of frames, while the KPN-based networks achieve different results as a function of the number of frames $\nFrames$.
When comparing the convergence with and without the offset block it seems that the offset block has a smoothing effect on the validation loss. This effect might happen because the KPN can concentrate on correcting the NUC, while the offset block handles the temperature estimation.

\subsection{Real data}\label{sec:results:realdata}
    \input{results/realdata.tex}