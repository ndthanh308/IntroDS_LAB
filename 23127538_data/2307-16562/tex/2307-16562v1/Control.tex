\subsection{Control Layer}

The control layer is responsible for matching clients and servers. This layer consists of a set of routers that maintains the state of all servers subscribed to it. It performs load balancing by allocating client requests to servers that optimize cost measured in latency, compute cost, and compliance to SLAs. Servers can subscribe to a router of their choice, and clients can select a router of their choice. The control layer works in conjunction with other layers as depicted in figure \ref{fig:controlLayer} and described below:\\

% Figure environment removed


\noindent {\bf Server state maintenance:} Router maintains a server network state consisting of the following non-exhaustive set of variables:
\begin{itemize}
    \item Server model capacity: The set of AI models that the server can compute inference on 
    \item Server hardware capacity: The compute capacity of each server 
    \item Server request load: The number of clients the server is currently connected to at the service layer 
    \item Server location: Verified server location from the proof layer
\end{itemize}
Some of these variables require the routing trusting serverâ€™s claims - these will be used for soft constraints in routing, whereas other variables such as location will be verified through the proof layer - these can be used for hard constraints such as geo-restricting the inference compute. \\

\noindent {\bf SLA state maintenance:}  The router maintains the state of SLAs signed at the transaction layer between client-aggregators and aggregator-servers so that it can match clients to servers that share a common aggregator. The router watches the transaction layer contracts for events to register or de-register SLAs. \\

\noindent {\bf Client-server matching:} The client submits a request specifying the type of server it would like to be matched to - this request consists of parameters such as model id, location boundary, server uptime, etc. The router runs a matching logic to select a server best suited for that model at that time by utilizing the server state and the SLA state. The router then notifies the service layer to establish a connection between the client and the servers and the transaction layer to anticipate payments through their common aggregator. 

Note on fairness: A malicious router can unfairly route requests leading to a loss in revenue for some servers; if a server sees such behavior, it will migrate to another router that provides better revenue by providing fair routing. This market dynamic facilitates fairness in routing.


