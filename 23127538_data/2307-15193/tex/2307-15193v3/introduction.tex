

\section{Introduction}

Homogeneous multi-unit auctions, a subset of combinatorial auctions, are extensively utilized to auction off large quantities of identical items. Examples include Carbon Emissions Trading Schemes \citep{CarbonTaxVsCapTrade2013, LessonsLearned2017, Kira2019}, US Treasury Auctions \citep{TreasuryAuction2005, TreasuryUnifOrDisc2000}, Procurement Auctions \citep{Procurement2006}, and Wholesale Electricity Markets \citep{WholesaleElectricityMarkets2008, BiddingElectricity2003, DesigningElectricityAuctions2006}. In these auctions, bidders submit bid vectors and are allocated goods and charged payments based on the auction's rules.

The uniform price and pay-as-bid (PAB) mechanisms, natural extensions of the second and first price sealed bid auctions respectively, are commonly used. Bidders are allocated units in descending order of their bids; they are then charged either the lowest winning bid (uniform price) or their own bid (PAB). This paper focuses on the PAB auction format due to the recent industry-wide shift towards first price auctions, spurred by demands for price transparency and simpler revenue management \citep{fpadisplay2021, googlefpa2019}.

Despite their prevalence, PAB auctions pose significant challenges for participants trying to bid effectively, as outlined by \citep{CombinatorialAuctionDesign2003}. Bidders must balance the likelihood of winning units against the potential costs, complicated by the requirement for monotone bid vectors. Bidding too conservatively reduces the chances of securing units in later rounds, whereas overly aggressive bids can lead to inflated payments. This dilemma also affects uniform price auctions, though its impact on bidder behavior, welfare, and revenue remains poorly understood over time.

Consider the context of pollution license auctions under Carbon Emissions Trading Schemes (ETS), which compel large-scale polluters to buy pollution licenses via auction. These licenses, capping permissible carbon emissions, serve dual purposes: they discourage inefficient pollution through payment penalties and fund investments in renewable energy and green technology \citep{gregor2023review, chinagreen2022weng}. However, often the auction prices are significantly lower than the estimated social cost of carbon \citep{epa2023socialcostofcarbon}, reducing the effectiveness of this deterrent and limiting revenue generation. This inefficacy can be attributed to suboptimal auction designs, a consequence of not fully understanding the bidding dynamics and equilibria.



In this paper, we address the issue of learning optimal bidding strategies in repeated multi-unit PAB auctions. As we will elaborate later, we develop efficient no-regret algorithms that simplify the bidding complexity associated with PAB auctions. Through simulating the market dynamics derived from these learning algorithms, we empirically analyze the equilibria of PAB auctions, which have been poorly understood prior to our research. Our empirical findings demonstrate that in the equilibria resulting from these market dynamics, bidders' winning bids converge to nearly the same value, thus addressing concerns regarding price fairness in PAB auctions \citep{TreasuryUnifOrDisc2000, Trilemma2020}. 





We also consistently observe high revenue from these equilibria, especially when compared to its uniform price counterpart. In the context of carbon markets, this additional revenue can be invested into clean-up efforts and green technology; see. e.g., phase 4 of the European Union Emissions Trading System (EU-ETS) \citep{gregor2023review}.

\subsection{Technical Contributions.} {\color{black}Our results are presented in Table \ref{table: summary of main results}, offering a comparison to the established results for uniform price auctions by \cite{br창nzei2023online}. Below, we discuss our findings on equilibrium characterization for PAB and the details provided in the table.}



\begin{table}[h!]
\centering \footnotesize
\begin{tabular}{|>{\centering\arraybackslash}m{1.4cm}||>{\centering\arraybackslash}m{1.7cm}|>{\centering\arraybackslash}m{1.7cm}|>{\centering\arraybackslash}m{4.5cm}|>{\centering\arraybackslash}m{5.7cm}|}
 \hline
  & Regret (Full) & Regret (Bandit) & Regret Lower Bound  (bandit) & Equilibrium Behavior \\ [0.5ex]
 \hline\hline
 PAB & $\bm{O(MT^{\frac{1}{2}})}$ & $\bm{O(MT^{\frac{2}{3}})}$ & $\bm{\Omega(\max(MT^{\frac{1}{2}}, M^{\frac{2}{3}}T^{\frac{2}{3}}))}$ & High revenue, near welfare optimal, near equal winning bids\\  \hline 
 Uniform & $O(M^\frac{3}{2}T^{\frac{1}{2}})$ & $O(M^{\frac{7}{4}}T^{\frac{3}{4}})$ & $\Omega(MT^{\frac{1}{2}})$ & Low revenue, welfare optimal, staggered winning bids\\ [1ex] 
 \hline
\end{tabular}
\caption{\textbf{Summary of our Main Results.} Our contributions are written in bold. We compare to the uniform price auction market dynamics as described in \cite{br창nzei2023online}.}
\label{table: summary of main results}
\end{table}


{\color{black}\textbf{Equilibrium Characterization (Section \ref{sec: equilibria}).} We present  theoretical results characterizing equilibria in PAB, distinguishing between various notions of equilibrium, including Pure Nash Equilibrium (PNE), Coarse Correlated Equilibrium (CCE), and Correlated Equilibrium (CE). We demonstrate that when a PNE exists, the winning bids must be nearly uniform, differing by no more than a discretization factor of \(\delta\). Additionally, we present sufficient conditions under which PNE exists, further reinforcing the aforementioned uniform bidding property. We experimentally show how often these conditions are satisfied as a function of the number of items, the discretization factor, and the number of market participants. However, we show that the uniform bidding property does not necessarily hold for CCEs or CEs via optimizing for the gap between the winning bids using the linear programming characterizations of CCEs and CEs. Nevertheless, our no-regret learning algorithms consistently exhibit the uniform bidding winning bids property (Table \ref{table: learning dynamics full info}), regardless of PNE existence.}

\textbf{New Framework to Study Learning How to Bid in PAB Auctions (Section \ref{sec:repeated}).} Let there be $N$ bidders/agents with $\Nitem$-unit demand in a PAB auction with $\overline{\Nitem}$ supply. Each bidder $n$ is endowed with valuation vector $\bm{v}_n = (v_{n, 1},\ldots,v_{n, \Nitem}) \in [0, 1]^\Nitem$, where $v_{n, i}$ is the marginal value of the $i$-th unit for bidder $n$.
The bidder submits a bid vector $\bm{b}_n = (b_{n, 1},\ldots,b_{n, \Nitem}) \in \mathcal{B}^{\Nitem}$, where $\mathcal{B}$ is some discretization of $[0, 1]$ that represents the set of all possible bids. Agents then receive allocation $x_n \in [\Nitem]$ and  utility $\sum_{\nitem=1}^{x_n} (v_{n, \nitem} - b_{n, \nitem})$ according to the PAB auction rule; see Section \ref{sec:model}. Repeating this auction across $\Nround$ rounds, each agent's goal is to minimize their regret with respect to their hindsight, utility maximizing bid vector.  

\textbf{Dynamic Programming  Scheme for Hindsight Optimal Offline Solution (Section \ref{sec:offline}).} To design low-regret bidding algorithms, we crucially leverage the structure of the hindsight optimal offline solution. In the offline/hindsight problem, the bidder has access to the (historical) dataset of submitted bids by competitors and seeks to find the utility maximizing bid vector on that dataset. (See \cite{RW16, derakhshan2021beating,derakhshan2019lp, golrezaei2021boosted} for works that study similar problems from an auctioneer's perspective.) 


We show that the optimal solution to the offline problem---which is our benchmark in computing the regret of our online learning algorithms---can be solved  using a polynomial time Dynamic Programming (DP) scheme.  To do so, we make the following key observation:  
 to win $\nitem$ units (or equivalently, slots), an agent $n$ must have at least $\nitem$ bids larger than the smallest $\nitem$ among the largest $\overline{\Nitem}$ bids of all other bidders. This observation allows us to devise a DP where in each step of the DP, we decide about the bid for one unit, while considering the externality that this bid will impose on the bids and utilities for other units. This externality is precisely the fundamental tradeoff of PAB auctions aforementioned: bidding too small decreases the probability of winning the current or any subsequent units, however, bidding too large increases the payment of the current and previous units. 

\textbf{Decoupled Exponential Weights Algorithm (Section \ref{sec: decoupled exp weights section}).} 
We present our first set of algorithms to learn in the online setting, in both the full information and bandit feedback regimes. We leverage our DP scheme to obtain decoupled rewards, or reward estimates in the bandit setting, for each unit-bid value pair. In particular, we can obtain an exact expression for the utility estimate for bidding $b_\nitem$ for unit $\nitem$ that is independent of $b_1,\ldots,b_{\nitem-1}$ or $b_{\nitem+1},\ldots,b_\Nitem$, subject to bid vector monotonicity. This allows us to mimic the exponential weights algorithm on the exponentially large bid space in polynomial time and space complexity. We show that our decoupled exponential weights algorithm (Algorithm~\ref{alg: Decoupled Exponential Weights}), which achieves polynomial time and space complexities, attains \(O(M^{\frac{3}{2}} \sqrt{T \log{T}})\) regret in the full information setting and \(O(M^{\frac{4}{3}} T^{\frac{2}{3}} \sqrt{\log{T}})\) regret in the bandit settings, respectively. {\color{black}For an extension of these algorithms to a setting with time-varying stochastic valuations, please refer to Section~\ref{sec: time varying}.}




\textbf{Online Mirror Descent Algorithm (Section \ref{sec:bandit}).}  
In this section, we introduce an alternative learning algorithm based on Online Mirror Descent (OMD) that enhances the regret upper bounds of our decoupled exponential weight algorithm by a factor of \(\sqrt{M}\), albeit with increased computational demands. Utilizing our DP scheme, specifically the graph it induces (see Section \ref{sec:offline}), we maintain probability measures over the DP graph nodes rather than its edges. This modification, informed by the observation that bid vector utility depends solely on the graph's nodes, results in more efficient regret bounds. 



{\color{black}\textbf{Regret Lower Bound (Section~\ref{sec: lower bound}).} To complement our regret upper bound, we construct regret lower bounds for both full information and bandit settings: $\Omega(M\sqrt{T})$ and $\Omega(\max{M^\frac{2}{3} T^{\frac{2}{3}}, M\sqrt{T}})$. To construct the regret lower bound of $\Omega(M\sqrt{T})$, which is a valid lower bound for both settings, we construct two distributions over adversary bid vectors for which any learning agent is guaranteed to incur regret linear in $M$ when trying to learn the optimal bid under these distributions. Observe that the regret of our OMD algorithm matches the dependence of the regret lower bound on $M$. 

For the bandit setting, we present another regret lower bound of $\Omega(M^\frac{2}{3} T^{\frac{2}{3}})$, which matches the regret of both Decoupled Exponential Weights and OMD Algorithms in terms of dependence on $T$. To construct this lower bound, we build upon the well-known $\Omega(T^{\frac{2}{3}})$ regret lower bound for the posted price and first price auctions  in \cite{DemandCurve2003, ContextBanditsCrossLearning2019}. In particular, we consider a distribution over adversary bid vectors such that the marginal distribution of the adversary's bid for any unit is the equal revenue distribution. We then construct a family of hypotheses by perturbing each of these marginals at a different bid value. We make a key simplification that the set of possible perturbations between two units must be disjoint, limiting the impact of cross-learning between units and allowing for stronger dependence in $M$. We show that any learning agent must incur regret at least $\Omega(M^\frac{2}{3} T^{\frac{2}{3}})$ when distinguishing among all possible combinations of perturbations.}









\subsection{Experimental Results and Managerial Implications}\label{sec:insights}




Our experiments yield valuable practical insights for both auction designers and participants. These insights are primarily derived from simulations of PAB market dynamics using the no-regret learning algorithms designed in our paper. Additionally, we compare these results with the market dynamics of uniform price auctions using the algorithms presented  in \cite{br창nzei2023online}. It is important to emphasize that conducting such systematic comparisons was previously challenging due to the inherent difficulty of characterizing equilibria in these auctions prior to our research.

\begin{enumerate}
    \item \textbf{Near-Uniform Bidding in PAB Auctions.} {As shown in Table~\ref{table: learning dynamics full info}, the market dynamics consistently lead to the convergence of the winning bids and the largest losing bids to nearly identical values across all bidders.} This finding partially addresses one of the main concerns regarding the fairness of the PAB auction. Specifically, although the payment for each unit \textit{can} differ across units and bidders, under a reasonable learning and bidding strategy, these payments tend to converge to similar values over the long term.
    \item \textbf{Simplified Bidding Interface is Sufficient for PAB but not for Uniform Price.} In a recent trend of bidding simplification  and automation (e.g.,  \cite{aggarwal2019autobidding, deng2023multi, susan2023multi, lucier2023autobidders}), auctioneers may find it easier to restrict bidders' demand expressiveness by requiring only a single price and quantity, rather than a vector of bids. As per our previous insight, the bid value convergence of the market dynamics suggest appropriateness of this simplified bidding interface. In contrast, we show that the market dynamics of the uniform price auction converge to a staggered bid vector (Table \ref{table: learning dynamics full uniform}), suggesting that the simplified bidding interface may significantly damage the uniform price auction's welfare, revenue, or bidders' utility.
    \item \textbf{PAB Obtains High Revenue but Slightly Lower Welfare than Uniform Price.} From the insights provided by Tables \ref{table: learning dynamics full info} and \ref{table: learning dynamics full uniform}, it is evident that the PAB auction surpasses the uniform price auction in terms of revenue generation. However, it slightly lags behind in welfare, though to a lesser extent. Consequently, auctioneers who prioritize revenue (resp. welfare) should favor the PAB (resp. uniform price) auction over uniform price (resp. PAB) auctions.
\end{enumerate}



\subsection{Other Related Works}




\textbf{Learning in Auctions.} Most of the recent learning-theory-flavored auction design research has focused on the perspective of the auctioneer setting reserve prices \citep{MorgensternR16, mohri2016learning, CaiD17, DudikHLSSV17,kanoria2014dynamic, DemandCurve2003, braverman2018noregretbuyer, golrezaei2019IC, golrezaei2018dynamic, golrezaei2021bidding},
or uniform price auctions \citep{LearningRevOptSPA2013, mohri2016learning, OptReserveMyopic2018, LearningToBidRevenueMaximizing2019, OSPABidding2020}. 
{\color{black} Relatively few works study learning from the bidder's perspective or the resulting market dynamics. The works most closely aligned with our own within this literature \citep{LearningBidOptimallyAdversarialFPA2020, OptimalNoRegretFPA2020, ContextBanditsCrossLearning2019} establish low-regret algorithms for learning to bid in first-price auctions. As the first-price auction is precisely the PAB auction with $M=1$ units, we precisely recover the regret upper bound of $O(T^{\frac{2}{3}})$ established for the bandit feedback setting as described in \cite{ContextBanditsCrossLearning2019}, which is also shown to be tight. The superior rate of $O(T^{\frac{1}{2}})$ achieved in \cite{OptimalNoRegretFPA2020} is incomparable to our bandit feedback $O(T^{\frac{2}{3}})$ regret as they assume a stronger feedback structure where the winning bid is announced at the end of every round. Note that under this feedback structure, unlike the bandit setting, bidders who are not winning the item learn about their competitors. Similarly, the $O(T^{\frac{1}{2}})$ rate in \cite{LearningBidOptimallyAdversarialFPA2020} is obtained in the full-information setting with time-varying valuations. While we obtain matching regret rates (see Section~\ref{sec: time varying}), our result assumes stochastic valuations and compares to an arbitrary valuation-to-bid mapping, whereas their result assumes adversarial valuations and compares to any 1-Lipschitz valuation-to-bid mapping.

Generalizing the aforementioned learning algorithms to the multi-unit setting, however, is difficult as the space of possible bid vectors is exponentially large. To combat this, we take from the expansive structured bandit literature, which includes linear bandits \citep{StochLinearOpt2008, LinStochBandits2011, ContextLinearPayoff2011, Lattimore2020}, combinatorial bandits \citep{CMAB2013, MinimaxCombinatorial2011, niazadeh2021online}, and convex uncertainty set bandits \citep{van2020optimal}. In particular, our algorithm most closely resembles existing algorithms exploiting both these combinatorial and linear aspects in episodic Markov Decision Processes \citep{OREPS2013} or cost minimization on graphs \citep{PathKernel2003}.
In this paper, we contribute to this line of work by proposing a novel regret minimization framework for PAB auctions. Moreover, we numerically analyze the corresponding multi-agent learning dynamics (also for the uniform price auction), which complements our equilibrium analysis in Section \ref{sec: equilibria}.
}

 
\textbf{PAB Mechanism.} There are several multi-unit auction formats that are commonly used in practice; e.g., uniform price \citep{TreasuryUnifOrDisc2000, LastAcceptedBid2020, ImprovedRevenuePPASPA2021, Kira2019}, PAB \citep{Homogeneous2020, FPACollusion2000, LargeMultiUnit2018}, Vickrey-Clarke-Groves (VCG) \citep{MechanismsMultiUnit2007, LonelyVickrey2006}, ascending price \citep{AscendingCramton1998, EfficientAscending2004}. The literature is divided as to which auction is appropriate for various settings. For example, while the PAB mechanism has desirable revenue and welfare guarantees compared to the uniform price auction \citep{Homogeneous2020}, the empirical revenue of the two auctions is often comparable \citep{Turkish2010}, and some argue that guess-the-clearing-price and other strategic behavior \citep{GermaryReserve2021} along with collusion \citep{WholesaleElectricityMarkets2008} can further damage its performance. Furthermore, there are ethical and fairness concerns regarding PAB auctions, as their discriminatory nature implies that agents pay unequally for the same unit. Despite this criticism, and other arguments for (and against) other auction formats \citep{CombinatorialAuctionDesign2003, CombinatorialAuctions2004, InefficiencyStandard2013, DemandReduction2014, Trilemma2020}, we focus on the PAB mechanism  due to the simplicity and transparency of its payment rule, as well as, its widespread use.

Regarding the equilibria, bidding dynamics, efficiency, and other key properties of multi-unit PAB mechanisms, there are some partial results in the economics literature.  For example,
the Bayesian optimal bidding strategy is known for the case of 2-unit demand and supply multi-unit auctions \citep{OptimalBidding1995}, for when valuations follow a class of parametric distributions \citep{Homogeneous2020}, or when the bidders have symmetric valuations \citep{DemandReduction2014}.  The PAB mechanism is also known to be smooth \citep{syrgkanis2012composable}, which yields a number of desirable guarantees on the price of anarchy of the auction \citep{roughgarden2015smooth}, even with the presence of an aftermarket \citep{babaioff2022aftermarkets}. An additional attractive property of the PAB mechanism is complete transparency of payments, as given one's allocation, an agent knows precisely how much they will pay. This is in stark contrast to the uniform price auction, where shill bids can inflate payments by artificially increasing demand \citep{Trilemma2020}.

{\color{black}In this work, we contribute to this line of research by demonstrating that while in PNEs the winning bids are uniform (up to a discretization factor), this is not necessarily the case under CCEs and  CEs. While our work is not the first to show optimality of uniform bidding or characterize an approximately uniform bidding PNE in PAB \citep{inefficiency2013}, to our knowledge, it is the first that does so with the constraint of no marginal overbidding---bidder's cannot submit bids for units larger than their marginal value for that unit.}

\textbf{Relationship to Uniform Price Auctions.} The uniform price auction is an alternative mechanism of allocating multiple homogeneous goods. Closely related to the PAB auction, bidders are allocated units in decreasing order of bids, but instead of charging each bidder their corresponding winning bid, each bidder instead pays the smallest winning bid. The  EU-ETS carbon license auctions use the uniform price auction, rather than the PAB auction, largely due to fairness considerations, as each agent pays the same amount per unit allocated \citep{EUETS}. However, our work shows that price fairness is not a concern in the long term when bidders learn how to bid and converge to a common price. In a study closely aligned with our research, \cite{br창nzei2023online} investigated the problem of learning optimal bidding strategies in multi-unit uniform pricing auctions. Since the uniform price auction employs a distinct payment rule, the bid optimization problem necessitates different approaches compared to the PAB auction. We show more specifically that the payment structure of PAB allows for additional simplifications in the learning task, allowing faster regret rates compared to uniform price.

